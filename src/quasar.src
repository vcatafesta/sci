#include "common.ch"
#include "inkey.ch"

static Static1, Static2
static Static3:= {}
static Static4:= ""
static Static5, Static6:= .F., Static7, Static8, Static9, Static10, ;
   Static11, Static12, Static13, Static14
static Static15, Static16[2], Static17, Static18, Static19, ;
   Static20, Static21, Static22, Static23, Static24, Static25, ;
   Static26, Static27, Static28[2], Static29, Static30, Static31, ;
   Static32, Static33, Static34, Static35, Static36, Static37

********************************
function QUASAR

   clear screen
   clear gets
   close databases
   select 1
   close format
   set device to screen
   public corlinha, corlinmenu, corcorpo, cortitfor, corfor, cteste, ;
      cimptela
   public corfordado, coropcoes, nmodulo, cpesquisa, ccampos, csistema
   private menu[2, 1]
   public nporcent, lcontrole, ccor, ctela, nlinha, ncoluna, nresp, ;
      vetor[2]
   public ncont, cufmn
   cpesquisa:= {"", "", "", "", Nil}
   ccampos:= {"", "", "", "", "", ""}
   csistema:= ""
   set date british
   winchester()
   close
   set wrap on
   set intensity on
   set date british
   set deleted on
   set bell off
   set scoreboard off
   set message to 23 center
   set device to screen
   set epoch to 1990
   set key K_ALT_F12 to volta
   set key K_PGDN to destroi
   set key K_F10 to pesquisa
   if (!file("C:\WINDOWS\HIMEM.TXT"))
      return .F.
   endif
   cores()
   opcao:= 0
   opcao1:= 0
   ctelant1:= ""
   ctelant2:= ""
   llcontrole:= .T.
   cufmn:= Space(2)
   cc:= "²"
   cimptela:= "T  "
   set color to (corlinha)
   telaquasar()
   do while (llcontrole)
      ctelmenu:= SaveScreen(0, 0, 24, 79)
      ccormenu:= SetColor()
      if (!senha())
         llcontrole:= .F.
      endif
      testempres()
      set color to (ccormenu)
      RestScreen(0, 0, 24, 79, ctelmenu)
      do while (llcontrole)
         set color to (corlinmenu)
         @  1,  0 say Replicate(" ", 80)
         @  1, 23 say " Sistema QUASAR de Administracao "
         set color to (corfor)
         if (!montamod())
            close databases
            close format
            clear memory
            clear gets
            set alternate off
            set alternate to 
            return .F.
         endif
         if (LastKey() == K_ESC)
            exit
         endif
         nmodulo:= menu[2][opcao]
      enddo
   enddo
   set color to W+/N
   close databases
   close format
   clear memory
   clear gets
   set alternate off
   set alternate to 
   clear screen
   return

********************************
function ABREDBF(Arg1, Arg2, Arg3, Arg4)

   ncont:= 0
   do while (.T.)
      if (procname(1) != "QSR51" .AND. procname(1) != "QSR59")
         use (Arg1) shared
      else
         use (Arg1) exclusive
      endif
      if (Arg2 != Nil)
         set index to (Arg2)
      endif
      if (ncont > 3)
         cmensagem:= ;
            "ATENCAO! ;Erro na abertura de arquivos. ;Operacao sera cancelada." ;
            + Str(procline(1))
         alert(cmensagem)
         return .F.
      endif
      if (neterr())
         InKey(2)
         ncont:= ncont + 1
      else
         exit
      endif
   enddo
   return .T.

********************************
function ADICIONA

   ncont:= 0
   do while (.T.)
      append blank
      if (ncont > 3)
         alert("ATENCAO! ;Erro na insercao de registro.; Operacao sera cancelada")
         return .F.
      endif
      if (neterr())
         InKey(2)
         ncont:= ncont + 1
      else
         exit
      endif
   enddo
   return .T.

********************************
function BLOQUEIA

   do while (!RLock())
      if (ncont > 3)
         alert("ATENCAO !; Erro no bloqueio de registro.; Operacao sera cancelada")
         return .F.
      endif
      ncont:= ncont + 1
   enddo
   return .T.

********************************
function SAI(Arg1)

   if (Arg1 = "" .OR. Arg1 = Nil)
      Arg1:= "Deseja Abandonar Esta Rotina ?"
   endif
   if (LastKey() == K_ESC)
      nresp:= alert(Arg1, vet)
      if (nresp = 1)
         lcontrole:= .F.
         return .T.
      elseif (nresp = 2)
         lcontrole:= .T.
         return .T.
      elseif (LastKey() = K_ESC)
         lcontrole:= .F.
         return .T.
      endif
   endif
   lcontrole:= .T.
   return .F.

********************************
function VALCAMPO(Arg1)

   if (Empty(Arg1))
      alert("Nao permitido campo vazio")
      return .F.
   endif
   return .T.

********************************
function JANELA(Arg1, Arg2, Arg3, Arg4, Arg5, Arg6)

   if (Arg6 != Nil)
      set color to N/GR
   else
      set color to N/GB
   endif
   @ Arg1, Arg2 clear to Arg3, Arg4
   set color to (corfordado)
   @ Arg1 + 1, Arg2 + 1 clear to Arg3 - 1, Arg4 - 1
   set color to N/GB
   ncolimpres:= Arg2 + (Arg4 - Arg2) / 2 - Len(Arg5) / 2 + 1
   if (Arg6 = Nil)
      @ Arg1, ncolimpres say Arg5
   else
      @ Arg1, ncolimpres say Arg5 color "N/GR"
   endif
   set color to (corfordado)
   return .T.

********************************
function PROCURA(Arg1, Arg2, Arg3, Arg4)

   narea:= Select()
   select 10
   if (!abredbf(Arg1, Arg2))
      return .F.
   endif
   seek Arg3
   if (Found())
      cret:= &Arg1->&Arg4
   else
      cret:= "*"
   endif
   close
   select (narea)
   return cret

********************************
function CONFLINHA(Arg1, Arg2, Arg3)

   cconf:= {"Sim", "Nao"}
   ccorantiga:= SetColor()
   set color to N/GB
   @ Arg2, Arg3 say Arg1
   @ Arg2, Arg3 + Len(Arg1) + 2 prompt cconf[1]
   @ Arg2, Arg3 + Len(Arg1) + 7 prompt cconf[2]
   menu to nopcao
   set color to (corlinha)
   @ Arg2, Arg3 say Replicate("Û", Len(Arg1) + 10)
   set color to (ccorantiga)
   if (nopcao == 1)
      return .T.
   else
      return .F.
   endif
   return .F.

********************************
function ESCOLHELIN(Arg1, Arg2, Arg3, Arg4)

   ctelaescol:= SaveScreen(0, 0, 24, 79)
   ccorantiga:= SetColor()
   i:= 1
   set color to N/GB
   do while (i <= Arg2)
      @ Arg3, Arg4:= Arg4 + (Len(Arg1[i]) + 2) prompt Arg1[i]
      i++
   enddo
   menu to nopcao
   set color to (ccorantiga)
   RestScreen(0, 0, 24, 79, ctelaescol)
   return nopcao

********************************
function DEFINEIMP

   @  0,  0 say "C" + Chr(nlinform)
   @  1,  0 say ""
   @  1,  1 say "" + cnomemp + ""
   @  1,  2 say ""
   return .F.

********************************
function TESTEMPRES

   return Nil

********************************
function DBREINDEX

   return ordListRebuild()

********************************
function PESQUISA

   private v1[2], v2[2], v3[2]
   narea:= Select()
   cvar:= readvar()
   if (readvar() != "OPCAO")
      if (Upper(readvar()) != Upper(cpesquisa[4]))
         return .T.
      endif
   endif
   if (Empty(ccampos[1]))
      return .F.
   endif
   select 20
   if (!abredbf(cpesquisa[1], cpesquisa[2]))
      return .F.
   endif
   v1[1]:= ccampos[1]
   v1[2]:= ccampos[2]
   v2[1]:= ccampos[4]
   v2[2]:= ccampos[5]
   v3[1]:= ccampos[4]
   v3[2]:= ccampos[5]
   if (!Empty(ccampos[3]))
      asize(v1, 3)
      asize(v2, 3)
      asize(v3, 3)
      v1[3]:= ccampos[3]
      v2[3]:= ccampos[6]
      v3[3]:= ccampos[6]
      visualiza(cpesquisa[1], 1, 8, 10, 18, 78, v1, v2, v3)
   else
      visualiza(cpesquisa[1], 1, 8, 25, 18, 78, v1, v2, v3)
   endif
   crecebe:= cpesquisa[4]
   ccampo:= cpesquisa[3]
   &crecebe:= &ccampo
   close
   select (narea)
   if (cvar = "OPCAO")
      keyboard Chr(13)
   endif
   return

********************************
procedure FILTRAR(Arg1)

   cteste:= "," + LTrim(Str(nusuatual, 5)) + ","
   set filter to cTeste $ Menus->Usuarios .AND. LEN(RTRIM(CODIGO)) ;
      == nNiv
   return

********************************
procedure MONTAMENUL(Arg1, Arg2)

   private menu[3, 1]
   telaquasar()
   set color to (ccormenu)
   do while (llcontrole)
      ctelmenu:= SaveScreen(0, 0, 24, 79)
      ccormenu:= SetColor()
      set color to (ccormenu)
      RestScreen(0, 0, 24, 79, ctelmenu)
      do while (llcontrole)
         matrizlinm(Arg2)
         menu to opcao
         if (LastKey() == K_ESC)
            exit
         endif
         nivel1(Trim(menu[3][opcao]))
         set color to (ccormenu)
         RestScreen(0, 0, 24, 79, ctelmenu)
      enddo
      if (LastKey() == K_ESC)
         exit
      endif
   enddo
   return

********************************
procedure CLEAR

   @  5,  5 clear to  5,  5
   return

********************************
procedure QSR_IMP


********************************
function TELAQUASAR

   set color to (corlinha)
   @  0,  0 say Replicate("Û", 80)
   @ 24,  0 say Replicate("Û", 80)
   set color to (corcorpo)
   @  2,  0, 22, 79 box cc + cc + cc + cc + cc + cc + cc + cc + cc + ;
      cc
   @  6,  4 say ;
      "±±±±±±±±±±±²²±±±±²²²±±±±²±±±±±±±±±±±²²±±±±±±±±±²²±±±±±±±±±±±²±±±±±±±±±±±"
   @  7,  4 say ;
      "±±±±±±±±±±±²²±±±±²²²±±±±²±±±±±±±±±±±²±±±±±±±±±±±²±±±±±±±±±±±²±±±±±±±±±±±"
   @  8,  4 say ;
      "±±±±²²²±±±±²²±±±±²²²±±±±²±±±±²²²±±±±²±±±±²²²±±±±²±±±±²²²±±±±²±±±±²²²±±±±"
   @  9,  4 say ;
      "±±±±²²²±±±±²²±±±±²²²±±±±²±±±±²²²±±±±²±±±±²²²²²²²²±±±±²²²±±±±²±±±±²²²±±±±"
   @ 10,  4 say ;
      "±±±±²²²±±±±²²±±±±²²²±±±±²±±±±±±±±±±±²±±±±±±±±±±²²±±±±±±±±±±±²±±±±±±±±±±±"
   @ 11,  4 say ;
      "±±±±²²²±±±±²²±±±±²²²±±±±²±±±±±±±±±±±²²±±±±±±±±±±²±±±±±±±±±±±²±±±±±±±±±±±"
   @ 12,  4 say ;
      "±±±±²²²±±±±²²±±±±²²²±±±±²±±±±²²²±±±±²²²²²²²²±±±±²±±±±²²²±±±±²±±±±²±±±±"
   @ 13,  4 say ;
      "±±±±²²²±±±±²²±±±±²²²±±±±²±±±±²²²±±±±²±±±±²²²±±±±²±±±±²²²±±±±²±±±±²²±±±±"
   @ 14,  4 say ;
      "±±±±±±±±±±±²²±±±±±±±±±±±²±±±±²²²±±±±²±±±±±±±±±±±²±±±±²²²±±±±²±±±±²²²±±±±"
   @ 15,  4 say ;
      "±±±±±±±±±±±±²±±±±±±±±±±±²±±±±²²²±±±±²²±±±±±±±±±²²±±±±²²²±±±±²±±±±²²²±±±±"
   @ 16,  4 say "²²²²²²²²²±±±"
   set color to (coropcoes)
   @ 24,  1 say "VSN Desenvolvimento "
   set color to (corlinmenu)
   @  0, 71 say Date() color "W+/B"
   empresa(0, 1, coropcoes)
   @  1,  0 say Replicate(" ", 80)
   @ 23,  0 say Replicate(" ", 80)
   @  1, 35 say " QUASAR "
   @ 24, 40 say Replicate("Û", 39) color corlinha
   @ 24, 78 - Len(Trim(csistema)) say csistema color "w+/b"
   return Nil

********************************
procedure MATRIZLINM(Arg1)

   close databases
   select 1
   close format
   abredbf("MENUS")
   set index to MENUS1
   filtrar1(4, Arg1)
   goto top
   i:= 1
   do while (!EOF())
      menu[1][i]:= Str(i, 2) + "-" + Trim(menus->menu)
      menu[2][i]:= menus->executa
      menu[3][i]:= menus->codigo
      skip 
      if (!EOF() .AND. Len(Trim(menus->codigo)) = 4)
         asize(menu[1], i + 1)
         asize(menu[2], i + 1)
         asize(menu[3], i + 1)
         i++
      endif
   enddo
   i:= 1
   ncol:= 2
   for i:= 1 to Len(menu[1])
      @  0,  0 say ""
      @  1, ncol prompt menu[1][i]
      ncol:= ncol + 15
   next
   close
   return

********************************
procedure FILTRAR1(Arg1, Arg2)

   cteste:= "," + LTrim(Str(nusuatual, 5)) + ","
   set filter to SUBSTR(Menus->Codigo,1,2) = cMenuT .AND. ;
      LEN(RTRIM(Menus->Codigo)) = nNiv .AND. cTeste $ Menus->Usuarios
   return

********************************
function GETNEW(Arg1, Arg2, Arg3, Arg4, Arg5, Arg6)

   local Local1[10]
   default Arg4 to ""
   default Arg6 to .T.
   __toget(Local1)
   Local1:row(Arg1)
   Local1:col(Arg2)
   Local1[1]:= Arg3
   Local1[7]:= Arg4
   Local1[3]:= Arg5
   Local1:colorspec(Arg6)
   return Local1

********************************
function MONTAMOD

   if (!file("MENUS1.NTX"))
      use MENUS
      index on CODIGO to MENUS1
   endif
   asize(menu[1], 1)
   asize(menu[2], 1)
   cpermis:= " "
   nlarg:= 0
   ctela1:= SaveScreen(0, 0, 22, 79)
   abredbf("Menus")
   set index to MENUS1
   select 1
   filtrar(2)
   i:= 1
   goto top
   do while (!EOF())
      menu[1][i]:= Str(i, 2) + "-" + Trim(menus->menu)
      menu[2][i]:= menus->codigo
      if (Len(Trim(menu[1][i])) > nlarg)
         nlarg:= Len(Trim(menu[1][i]))
      endif
      skip 
      ccod:= codigo
      ccod:= LTrim(ccod)
      if (!EOF())
         asize(menu[1], i + 1)
         asize(menu[2], i + 1)
         i++
      endif
   enddo
   if (Empty(menu[1][1]))
      alert("USUARIO NAO ESTA HABILITADO EM NENHUM SISTEMA")
      return .F.
   endif
   janela(3, 20, i + 6, 62, "Escolha o Modulo Que Deseja Utilizar")
   set color to (ccormenu)
   i:= 1
   nlin:= 5
   for i:= 1 to Len(menu[1])
      menu[1][i]:= menu[1][i] + Replicate(" ", nlarg - ;
         Len(menu[1][i]))
      @ nlin, 40 - nlarg / 2 prompt menu[1][i]
      nlin++
   next
   menu to opcao
   if (opcao != 0)
      csistema:= SubStr(menu[1][opcao], 4, Len(Trim(menu[1][opcao])) ;
         - 2)
   endif
   if (LastKey() != K_ESC)
      montamenul(opcao, Trim(menu[2][opcao]))
      if (!montamod())
         return .F.
      endif
   endif
   RestScreen(0, 0, 22, 79, ctela1)
   close
   return .T.

********************************
function BELL1(Arg1)

   if (Arg1 = Nil)
      Arg1:= 1
   endif
   for i:= 1 to Arg1
      ?? ""
      InKey(0.2)
   next
   return Nil

********************************
procedure FILTRAR2(Arg1, Arg2)

   ncoluna:= 0
   do case
   case SubStr(Arg2, 3, 2) = "02"
      ncoluna:= 15
   case SubStr(Arg2, 3, 2) = "03"
      ncoluna:= 30
   case SubStr(Arg2, 3, 2) = "04"
      ncoluna:= 45
   case SubStr(Arg2, 3, 2) = "05"
      ncoluna:= 52
   endcase
   cteste:= "," + LTrim(Str(nusuatual, 5)) + ","
   set filter to SUBSTR(Menus->Codigo,1,4) = cMenuT .AND. ;
      LEN(RTRIM(Menus->Codigo)) ==nNiv .AND. cTeste $ Menus->Usuarios
   return

********************************
procedure FILTRAR3(Arg1, Arg2)

   ncoluna:= 0
   do case
   case SubStr(Arg2, 3, 2) = "01"
      ncoluna:= 15
   case SubStr(Arg2, 3, 2) = "02"
      ncoluna:= 35
   case SubStr(Arg2, 3, 2) = "03"
      ncoluna:= 40
   case SubStr(Arg2, 3, 2) = "04"
      ncoluna:= 40
   endcase
   cteste:= "," + LTrim(Str(nusuatual, 5)) + ","
   set filter to SUBSTR(Menus->Codigo,1,6) = cMenuT .AND. ;
      LEN(RTRIM(Menus->Codigo)) ==nNiv .AND. cTeste $ Menus->Usuarios
   return

********************************
function NIVEL1(Arg1)

   private menu2[4, 1], ncol, nlin, nlarg:= 0, nlarg2:= 0
   i:= 1
   ctelant1:= SaveScreen(0, 0, 24, 79)
   do while (.T.)
      set color to (corlinmenu)
      matnivel1(6, Arg1)
      menu to opcao1
      set color to (corlinmenu)
      @ 23,  0 say Replicate(" ", 80)
      if (LastKey() == K_ESC)
         RestScreen(0, 0, 24, 79, ctelant1)
         exit
      endif
      cprog:= menu2[3][opcao1]
      if (!Empty(cprog))
         &cprog()
      else
         nivel2(Trim(menu2[4][opcao1]), opcao1)
      endif
   enddo
   clear screen
   clear gets
   return .T.

********************************
procedure FILTRAR4(Arg1, Arg2)

   ncoluna:= 0
   do case
   case SubStr(Arg2, 3, 2) = "02"
      ncoluna:= 15
   case SubStr(Arg2, 3, 2) = "03"
      ncoluna:= 40
   case SubStr(Arg2, 3, 2) = "04"
      ncoluna:= 35
   case SubStr(Arg2, 3, 2) = "05"
      ncoluna:= 52
   endcase
   cteste:= "," + LTrim(Str(nusuatual, 5)) + ","
   set filter to SUBSTR(Menus->Codigo,1,8) = cMenuT .AND. ;
      LEN(RTRIM(Menus->Codigo)) == 10 .AND. cTeste $ Menus->Usuarios
   return

********************************
function NIVEL2(Arg1, Arg2)

   private menu2[4, 1], ncol, nlin, nlarg:= 0, nlarg2:= 0, ncolnivel3
   i:= 1
   opcao1:= 1
   ctelant2:= SaveScreen(0, 0, 24, 79)
   do while (.T.)
      set color to (corlinmenu)
      matnivel2(8, Arg1, Arg2)
      menu to opcao1
      set color to (corlinmenu)
      @ 23,  0 say Replicate(" ", 80)
      if (LastKey() == K_ESC)
         RestScreen(0, 0, 24, 79, ctelant1)
         exit
      endif
      cprog:= menu2[3][opcao1]
      if (!Empty(cprog))
         &cprog()
      else
         nivel3(Trim(menu2[4][opcao1]), opcao1)
      endif
   enddo
   RestScreen(0, 0, 24, 79, ctelant2)
   return .T.

********************************
function NIVEL3(Arg1, Arg2)

   private menu2[4, 1], ncol, nlin, nlarg:= 0, nlarg2:= 0
   i:= 1
   opcao1:= 1
   ctelant3:= SaveScreen(0, 0, 24, 79)
   do while (.T.)
      set color to (corlinmenu)
      matnivel3(8, Arg1, Arg2)
      menu to opcao1
      set color to (corlinmenu)
      @ 23,  0 say Replicate(" ", 80)
      if (LastKey() == K_ESC)
         RestScreen(0, 0, 24, 79, ctelant1)
         exit
      endif
      cprog:= menu2[3][opcao1]
      if (!Empty(cprog))
         &cprog()
      else
         nivel2(Trim(menu2[4][opcao1]))
      endif
   enddo
   RestScreen(0, 0, 24, 79, ctelant3)
   return .T.

********************************
procedure QSR_VALI


********************************
procedure QSR_PRG


********************************
function MATNIVEL1(Arg1, Arg2)

   ncoluna:= 0
   nlarg:= 0
   abredbf("MENUS")
   if (!file("Menus1.NTX"))
      index on Codigo to Menus1
   endif
   set index to Menus1
   filtrar2(6, Arg2)
   i:= 1
   goto top
   do while (!EOF())
      menu2[1][i]:= Str(i, 2) + "-" + Trim(menus->menu)
      menu2[2][i]:= Trim(menus->mensagem)
      menu2[3][i]:= menus->executa
      menu2[4][i]:= menus->codigo
      if (Len(menu2[1][i]) > nlarg)
         nlarg:= Len(menu2[1][i]) + 6
      endif
      if (!EOF() .AND. SubStr(menus->codigo, 1, 4) == Arg2 .AND. ;
            Len(Trim(menus->codigo)) == 6)
         asize(menu2[1], i + 1)
         asize(menu2[2], i + 1)
         asize(menu2[3], i + 1)
         asize(menu2[4], i + 1)
         i++
      endif
      skip 
   enddo
   if (menu2[1][Len(menu2[1])] = Nil)
      asize(menu2[1], i - 1)
      asize(menu2[2], i - 1)
      asize(menu2[3], i - 1)
      asize(menu2[4], i - 1)
      i--
   endif
   for j:= 1 to Len(menu2[1])
      if (menu2[3][j] = " ")
         menu2[1][j]:= menu2[1][j] + Replicate(" ", nlarg - ;
            Len(menu2[1][j])) + ""
      else
         menu2[1][j]:= menu2[1][j] + Replicate(" ", nlarg - ;
            Len(menu2[1][j])) + " "
      endif
   next
   nlin:= 2
   ncol:= ncoluna
   @ nlin, ncol clear to nlin + i + 1, ncol + nlarg + 2
   @ nlin, ncol to nlin + i + 1, ncol + nlarg + 2
   nlin++
   i:= 1
   for i:= 1 to Len(menu2[1])
      @ nlin, ncol + 1 prompt menu2[1][i] message menu2[2][i]
      nlin++
   next
   close
   return .T.

********************************
function VALDATAPGT(Arg1)

   if (Arg1 = CToD("  /  /  "))
      alert("NÆo permitido data vazia")
      return .F.
   endif
   return .T.

********************************
function DBSETINDEX(Arg1)

   ordListAdd(Arg1)
   return Nil

********************************
function MATNIVEL2(Arg1, Arg2, Arg3)

   ncoluna:= 0
   nlarg:= 0
   abredbf("MENUS")
   if (!file("Menus1.NTX"))
      index on Codigo to Menus1
   endif
   set index to Menus1
   filtrar3(Arg1, Arg2)
   i:= 1
   goto top
   do while (!EOF())
      menu2[1][i]:= Str(i, 2) + "-" + Trim(menus->menu)
      menu2[2][i]:= Trim(menus->mensagem)
      menu2[3][i]:= menus->executa
      menu2[4][i]:= menus->codigo
      if (Len(menu2[1][i]) > nlarg)
         nlarg:= Len(menu2[1][i]) + 4
      endif
      if (menu2[3][i] = " ")
         menu2[1][i]:= menu2[1][i] + Replicate(" ", nlarg - ;
            Len(menu2[1][i])) + ""
      else
         menu2[1][i]:= menu2[1][i] + Replicate(" ", nlarg - ;
            Len(menu2[1][i])) + " "
      endif
      if (!EOF() .AND. SubStr(menus->codigo, 1, 6) == Arg2 .AND. ;
            Len(Trim(menus->codigo)) == 8)
         i++
         asize(menu2[1], i)
         asize(menu2[2], i)
         asize(menu2[3], i)
         asize(menu2[4], i)
      endif
      skip 
   enddo
   if (menu2[1][Len(menu2[1])] = Nil)
      asize(menu2[1], i - 1)
      asize(menu2[2], i - 1)
      asize(menu2[3], i - 1)
      asize(menu2[4], i - 1)
      i--
   endif
   nlin:= Arg3 + 2
   ncol:= ncoluna
   @ nlin, ncol clear to nlin + i + 1, ncol + nlarg + 3
   @ nlin, ncol to nlin + i + 1, ncol + nlarg + 3
   nlin++
   ncolnivel3:= ncol
   i:= 1
   for i:= 1 to Len(menu2[1])
      @ nlin, ncol + 1 prompt menu2[1][i] message menu2[2][i]
      nlin++
   next
   close
   return .T.

********************************
static procedure SHOWSCOREB

   local Local1, Local2
   if (Set(_SET_SCOREBOARD))
      Local1:= Row()
      Local2:= Col()
      SetPos(0, 60)
      dispout(iif(Set(_SET_INSERT), nationmsg(7), nationmsg(8)))
      SetPos(Local1, Local2)
   endif
   return

********************************
function READKILL(Arg1)

   local Local1
   Local1:= Static7
   if (PCount() > 0)
      Static7:= Arg1
   endif
   return Local1

********************************
function MATNIVEL3(Arg1, Arg2, Arg3)

   ncoluna:= 0
   nlarg:= 0
   abredbf("MENUS")
   if (!file("Menus1.NTX"))
      index on Codigo to Menus1
   endif
   set index to Menus1
   filtrar4(Arg1, Arg2)
   i:= 1
   goto top
   do while (!EOF())
      menu2[1][i]:= Str(i, 2) + "-" + Trim(menus->menu)
      menu2[2][i]:= Trim(menus->mensagem)
      menu2[3][i]:= menus->executa
      menu2[4][i]:= menus->codigo
      if (Len(menu2[1][i]) > nlarg)
         nlarg:= Len(menu2[1][i]) + 5
      endif
      if (menu2[3][i] = " ")
         menu2[1][i]:= menu2[1][i] + Replicate(" ", nlarg - ;
            Len(menu2[1][i])) + " "
      else
         menu2[1][i]:= menu2[1][i] + Replicate(" ", nlarg - ;
            Len(menu2[1][i])) + "  "
      endif
      if (!EOF() .AND. SubStr(menus->codigo, 1, 8) == Arg2 .AND. ;
            Len(Trim(menus->codigo)) == 10)
         i++
         asize(menu2[1], i)
         asize(menu2[2], i)
         asize(menu2[3], i)
         asize(menu2[4], i)
      endif
      skip 
   enddo
   if (menu2[1][Len(menu2[1])] = Nil)
      asize(menu2[1], i - 1)
      asize(menu2[2], i - 1)
      asize(menu2[3], i - 1)
      asize(menu2[4], i - 1)
      i--
   endif
   nlin:= Arg3 + 7
   ncol:= ncolnivel3 - (nlarg + 2)
   @ nlin, ncol clear to nlin + i + 1, ncol + nlarg + 3
   @ nlin, ncol to nlin + i + 1, ncol + nlarg + 3
   nlin++
   i:= 1
   for i:= 1 to Len(menu2[1])
      @ nlin, ncol + 1 prompt menu2[1][i] message menu2[2][i]
      nlin++
   next
   close
   return .T.

********************************
static function GETREADVAR(Arg1)

   local Local1, Local2
   Local1:= Upper(Arg1:name())
   if (!(ISNIL(Arg1:subscript())))
      for Local2:= 1 to Len(Arg1:subscript())
         Local1:= Local1 + ("[" + ;
            LTrim(Str(Arg1:subscript()[Local2])) + "]")
      next
   endif
   return Local1

********************************
init procedure RDDINIT

   rddsetdefa("DBFNTX")
   return

********************************
function PESQCONTA

   private v1[2], v2[2], v3[2]
   ccor:= SetColor()
   set color to (corfordado)
   if (Empty(nconta))
      alert("Nao Permitido N§ Da Conta Igual a Zero !")
      return .F.
   else
      if (!abredbf("Bancos", "Bancos1.NTX"))
         return .F.
      endif
      seek nconta
      if (!Found())
         alert("Conta no cadastrada")
         close
         return .F.
         set color to (ccor)
      endif
      @ nlinha + 2, ncoluna + 19 say SubStr(nom_ban_bc, 1, 24)
      @ nlinha + 10, ncoluna + 2 say saldo_bc
      @ nlinha + 10, ncoluna + 20 say sa_conf_bc
      close
      set color to (ccor)
      return .T.
   endif
   close
   set color to (ccor)
   return .F.

********************************
function PESQDOC7(Arg1, Arg2)

   ccor:= SetColor()
   if (Empty(Arg2))
      alert("NÆo permitido n§ do documento igual a zero!")
      return .F.
   else
      if (!abredbf("Mov_Bco", "Mv_Bco1.NTX"))
         return .F.
      endif
      set index to Mv_Bco1
      seek Arg1
      if (Found())
         alert("Documento j  cadastrado")
         close
         return .F.
      else
         close
         return .T.
      endif
   endif
   close
   return .F.

********************************
function PESQDOC8(Arg1, Arg2)

   ccor:= SetColor()
   if (Empty(Arg2))
      alert("NÆo permitido n§ do documento igual a zero!")
      return .F.
   else
      if (!abredbf("Mov_Bco", "Mv_Bco1.NTX"))
         return .F.
      endif
      seek Arg1
      if (!Found())
         alert("Documento nÆo cadastrado")
         close
         return .F.
      else
         close
         return .T.
      endif
   endif
   close
   return .F.

********************************
function VALDATAEMI(Arg1)

   if (Arg1 = CToD("  /  /  "))
      alert("NÆo permitido data vazia")
      return .F.
   endif
   return .T.

********************************
function PESQCLI(Arg1)

   private v1[2], v2[2], v3[2], ccor
   ccor:= SetColor()
   if (Empty(Arg1))
      alert("Atencao! Nao  permitido Codigo Cliente igual a zero")
      return .F.
   else
      select 10
      if (!abredbf("Clientes"))
         return .F.
      endif
      set index to Cliente1, Cliente2
      seek Arg1
      if (!Found())
         alert("Cliente nÆo cadastrado")
         close
         return .F.
      endif
      @ nlinha + 1, ncoluna + 20 say SubStr(nome_cli, 1, 23) color ;
         "W+/B"
      @ nlinha + 1, ncoluna + 2 say Arg1 picture "99999"
      close
      return .T.
   endif
   close
   return .T.

********************************
function PESQDOC3(Arg1, Arg2)

   ccor:= SetColor()
   if (Empty(Arg2))
      alert("NÆo permitido n§ do documento igual a zero!")
      return .F.
   else
      if (!abredbf("CONTASAR", "CONTAR1.NTX"))
         return .F.
      endif
      seek Arg1
      if (Found())
         alert("Documento j  cadastrado")
         close
         return .F.
      else
         if (!abredbf("CONTASRE", "CONTRE1"))
            return .F.
         endif
         seek Arg1
         if (Found())
            alert("Documento j  cadastrado e Baixado !")
            close
            return .F.
         else
            close
            return .T.
         endif
      endif
   endif
   close databases
   select 1
   close format
   return .F.

********************************
function VALDATAVEN(Arg1, Arg2)

   if (Arg1 = CToD("  /  /  "))
      alert("NÆo permitido data vazia")
      return .F.
   elseif (Arg1 < Arg2)
      alert("NÆo permitido data de vencimento,; menor que a data de emissÆo")
      return .F.
   endif
   return .T.

********************************
function __GETBUFFE

   return iif(Len(qself()) == 13, qself()[12], Nil)

********************************
function PESQDOC4(Arg1, Arg2)

   ccor:= SetColor()
   if (Empty(Arg2))
      alert("NÆo permitido n§ do documento igual a zero!")
      return .F.
   else
      if (!abredbf("CONTASAR", "CONTAR1"))
         return .F.
      endif
      seek Arg1
      if (!Found())
         if (!abredbf("CONTASRE", "CONTRE1"))
            return .F.
         endif
         seek Arg1
         if (Found())
            alert("Documento Ja Cadastrado e Baixado")
         else
            alert("Documento nÆo cadastrado")
         endif
         close databases
         select 1
         close format
         return .F.
      else
         close
         return .T.
      endif
   endif
   close
   return .F.

********************************
function PESQFOR(Arg1)

   private v1[2], v2[2], v3[2], ccor
   ccor:= SetColor()
   if (Empty(Arg1))
      alert("Atencao! Nao  permitido C¢digo Fornecedor igual a zero")
      return .F.
   else
      if (!abredbf("FORNECED"))
         return .F.
      endif
      set index to FORNECE1, FORNECE2
      seek Arg1
      if (!Found())
         alert("Fornecedor nÆo cadastrado")
         close
         return .F.
      endif
      @ nlinha + 1, ncoluna + 20 say SubStr(nome, 1, 23)
      @ nlinha + 1, ncoluna + 2 say Arg1 picture "99999"
      close
      return .T.
   endif
   close
   return .T.

********************************
function VALLOCAL1(Arg1)

   private v1[2], v2[2], v3[2]
   if (!abredbf("LOCALIZA", "LOCALIZ1"))
      return .T.
   endif
   seek Arg1
   if (Found())
      alert("Codigo Ja Cadastrado")
      close
      return .F.
   else
      close
      return .T.
   endif

********************************
function ELAPTIME(Arg1, Arg2)

   return tstring(iif(Arg2 < Arg1, 86400.0, 0) + secs(Arg2) - ;
      secs(Arg1))

********************************
function PESQDOC1(Arg1, Arg2)

   ccor:= SetColor()
   if (Empty(Arg2))
      alert("NÆo permitido n§ do documento igual a zero!")
      return .F.
   else
      if (!abredbf("CONTASAP", "CONTAP1.NTX"))
         return .F.
      endif
      seek Arg1
      if (Found())
         alert("Documento j  cadastrado")
         close
         return .F.
      else
         if (!abredbf("CONTASPG", "CONTPG1.NTX"))
            return .F.
         endif
         seek Arg1
         if (Found())
            alert("Documento j  cadastrado e Baixado !")
            close
            return .F.
         else
            close
            return .T.
         endif
      endif
   endif
   close
   return .F.

********************************
function PESQDOC2(Arg1, Arg2)

   ccor:= SetColor()
   if (Empty(Arg2))
      alert("NÆo permitido n§ do documento igual a zero!")
      return .F.
   else
      select 1
      if (!abredbf("CONTASAP", "CONTAP1.NTX"))
         return .F.
      endif
      seek Arg1
      if (!Found())
         if (!abredbf("CONTASPG", "CONTPG1.NTX"))
            return .F.
         endif
         seek Arg1
         if (!Found())
            alert("Documento nÆo cadastrado !")
            close
            return .F.
         else
            alert("Documento j cadastrado e baixado !")
            close
            return .F.
         endif
      else
         close
         return .T.
      endif
   endif
   close
   return .F.

********************************
function VALDOC29EN(Arg1)

   local Local1
   Local1:= Select()
   select 2
   if (!abredbf("ENTRADAS", "ENTRADA1.NTX"))
      return .F.
   endif
   seek Arg1
   if (Found())
      alert("Documento ja cadastrado")
      close
      return .F.
   else
      close
      select (Local1)
      return .T.
   endif
   close
   select (Local1)
   return .T.

********************************
init procedure CLIPINIT

   public getlist:= {}
   errorsys()
   return

********************************
function __GETHASFO

   return Len(qself()) == 13

********************************
function PESQDOC5(Arg1, Arg2)

   ccor:= SetColor()
   if (Empty(Arg2))
      alert("NÆo permitido n§ do documento igual a zero!")
      return .F.
   else
      select 1
      if (!abredbf("CONTASPG", "CONTPG1.NTX"))
         return .F.
      endif
      seek Arg1
      if (Found())
         alert("Documento j  cadastrado")
         close
         return .F.
      else
         close
         return .T.
      endif
      close
   endif
   close
   return .F.

********************************
function PESQDOC6(Arg1, Arg2)

   ccor:= SetColor()
   if (Empty(Arg2))
      alert("NÆo permitido n§ do documento igual a zero!")
      return .F.
   else
      select 1
      if (!abredbf("CONTASPG", "CONTPG1.NTX"))
         return .F.
      endif
      seek Arg1
      if (!Found())
         alert("Documento nÆo cadastrado")
         close
         return .F.
      else
         close
         return .T.
      endif
      close
   endif
   close
   return .F.

********************************
function PESQDOC9(Arg1, Arg2)

   ccor:= SetColor()
   if (Empty(Arg2))
      alert("NÆo permitido n§ do documento igual a zero!")
      return .F.
   else
      select 1
      if (!abredbf("CONTASRE", "CONTRE1.NTX"))
         return .F.
      endif
      seek Arg1
      if (Found())
         close
         return .T.
      else
         alert("Documento nÆo cadastrado!")
         close
         return .F.
      endif
   endif
   close
   return .F.

********************************
function VALCODI6A(Arg1)

   if (!abredbf("Produtos"))
      return .F.
   endif
   set index to Produto1, Produto2
   seek Arg1
   if (!Found())
      alert(" Produto nao Cadastrado")
      close
      return .F.
   else
      close
      return .T.
   endif
   close
   return .T.

********************************
function INDEXEXT

   return ordbagext()

********************************
function __TCOLCOUN

   return Len(qself()[6])

********************************
function PESQDOC10(Arg1, Arg2)

   ccor:= SetColor()
   if (Empty(Arg2))
      alert("NÆo permitido n§ do documento igual a zero!")
      return .F.
   else
      select 1
      if (!abredbf("CONTASAR", "CONTAR1.NTX"))
         return .F.
      endif
      seek Arg1
      if (Found())
         close
         return .T.
      else
         alert("Documento nÆo cadastrado!")
         close
         return .F.
      endif
   endif
   close
   return .F.

********************************
function PESQDOC11(Arg1, Arg2)

   ccor:= SetColor()
   if (Empty(Arg2))
      alert("NÆo permitido n§ do documento igual a zero!")
      return .F.
   else
      select 1
      if (!abredbf("CONTASRE", "CONTRE1.NTX"))
         return .F.
      endif
      seek Arg1
      if (Found())
         close
         ctipoconta:= "RE"
         return .T.
      endif
   endif
   if (Empty(Arg2))
      alert("NÆo permitido n§ do documento igual a zero!")
      return .F.
   else
      select 1
      if (!abredbf("CONTASAR", "CONTAR1.NTX"))
         return .F.
      endif
      seek Arg1
      if (Found())
         close
         ctipoconta:= "AR"
         return .T.
      else
         alert("Documento nÆo cadastrado!")
         close
         return .F.
      endif
   endif
   close
   return .F.

********************************
function VALGRUPO(Arg1)

   carea:= Select()
   select 10
   if (!abredbf("Grupo", "Grupo"))
      return .F.
   endif
   seek Arg1
   if (!Found())
      alert(" Grupo Nao Cadastrado")
      close
      select (carea)
      return .F.
   else
      ngrupo:= grupo
      ccor1:= SetColor()
      set color to (corfordado)
      @ nlinha + 1, ncoluna + 15 say SubStr(descricao, 1, 30)
      set color to (ccor1)
      close
      select (carea)
      return .T.
   endif

********************************
function HORAMINU(Arg1)

   return Val(SubStr(Arg1, 1, 2)) * 60 + Val(SubStr(Arg1, 4, 2))

********************************
procedure SYSINIT

   return

********************************
function PEDCODEST(Arg1)

   private v1[10], v2[10], v3[10]
   if (Empty(Arg1))
      alert("Atencao! No  permitido C¢digo igual a zero")
      return .F.
   else
      Arg1:= Replicate("0", 5 - Len(Trim(Arg1))) + Trim(Arg1)
      select 10
      if (!abredbf("PRODUTOS"))
         return .F.
      endif
      set index to PRODUTO1, PRODUTO2, PRODUTO3
      seek Arg1
      if (!Found())
         alert("Produto Nao Cadastrado")
         select Produtos
         close
         select 1
         return .F.
      else
         des:= descricao
         val:= valor
         ngrp:= grupo
         nvalcust:= valor_ultc
         cmarca:= marca
         select 11
         if (!abredbf("GRUPO", "GRUPO.NTX"))
            return .F.
         endif
         seek ngrp
         if (Found())
            naliq1:= aliquota1
            naliq2:= aliquota2
            naliq3:= aliquota3
         else
            naliq1:= 0
            naliq2:= 0
            naliq3:= 0
         endif
         close
         select 1
         if (vend > 0)
            ntotquanti:= ntotquanti - esto
            ntotvalor:= ntotvalor - vend * esto
            ntotpraz:= ntotpraz - vend2 * esto
         endif
         replace prod with Arg1
         replace desc with SubStr(des, 1, 30)
         replace vend with val
         replace aliq1 with naliq1
         replace aliq2 with naliq2
         replace aliq3 with naliq3
         replace vl_cust with nvalcust
         replace marca with cmarca
         @ lin, ncoluna + 1 say Arg1
         @ lin, ncoluna + 8 say SubStr(des, 1, 30)
      endif
   endif
   cproduto:= Space(5)
   select Produtos
   close
   select 1
   return .T.

********************************
function VALGRP1(Arg1)

   if (!abredbf("GRUPO", "GRUPO.NTX"))
      return .F.
   endif
   seek Arg1
   if (!Found())
      alert("Grupo nao Cadastrado")
      close
      return .F.
   else
      close
      return .T.
   endif

********************************
function __GETBADDA

   local Local1
   if ((Local1:= qself():untransfor(), Len(qself()) == 13 .AND. ;
         qself():type() == "D" .AND. Local1 == CToD("") .AND. ;
         !(qself()[12] == Transform(Local1, qself()[3]))))
      return .T.
   endif
   return .F.

********************************
function CONSCODEST(Arg1)

   private v1[5], v2[5], v3[5]
   if (Empty(Arg1))
      alert("Atencao! No  permitido C¢digo igual a zero")
      return .F.
   else
      Arg1:= Replicate("0", 5 - Len(Trim(Arg1))) + Trim(Arg1)
      select 10
      if (!abredbf("PRODUTOS"))
         return .F.
      endif
      set index to PRODUTO1
      seek Arg1
      if (!Found())
         alert(" Produto no Cadastrado")
         select Produtos
         close
         select 1
         return .F.
      else
         des:= descricao
         val:= valor
         select 1
         if (vend > 0)
            ntotquanti:= ntotquanti - esto
            ntotvalor:= ntotvalor - vend * esto
         endif
         replace prod with Arg1
         replace desc with SubStr(des, 1, 30)
         replace vend with val
         @ lin, ncoluna + 13 say SubStr(des, 1, 30)
      endif
   endif
   cproduto:= Space(5)
   select Produtos
   close
   select 1
   return .T.

********************************
function VALDESC6(Arg1)

   if (Empty(Arg1))
      alert("Atencao! No  permitido nome de cliente vazio")
      return .F.
   else
      if (procname(5) = "QSR15A")
         return .T.
      endif
      if (!abredbf("PRODUTOS"))
         return .F.
      endif
      set index to PRODUTO2, PRODUTO3
      seek Arg1
      if (Found())
         close
         alert("Atencao! Descricao ja Cadastrada")
         nresp:= alert("Deseja Continuar ?", vet)
         if (nresp == 2)
            close
            return .F.
         else
            close
            return .T.
         endif
      endif
   endif
   close
   return .T.

********************************
function FILTGERAL(Arg1)

   local Local1, Local2
   cvolta:= ""
   for Local1:= 1 to Len(Arg1)
      if (!Empty(Arg1[Local1][2]))
         if (!Empty(cvolta))
            cvolta:= cvolta + " .AND. "
         endif
         cvolta:= cvolta + Arg1[Local1][1] + " "
      endif
   next
   return cvolta

********************************
function VALCODI6

   private v1[2], v2[2], v3[2]
   ccodigo:= Replicate("0", 5 - Len(Trim(ccodigo))) + Trim(ccodigo)
   if (Empty(ccodigo))
      alert("Atencao! No  permitido C¢digo igual a zero")
      return .F.
   else
      if (!abredbf("PRODUTOS"))
         return .F.
      endif
      set index to Produto1, Produto3
      seek ccodigo
      if (Found())
         alert(" Produto ja Cadastrado")
         close
         return .F.
      else
         close
         return .T.
      endif
   endif
   close
   return .T.

********************************
function VALGRUPO1(Arg1)

   private v1[2], v2[2], v3[2]
   if (Empty(Arg1))
      alert("Ateno! No  permitido Grupo igual a zero")
      return .F.
   else
      if (!abredbf("GRUPO", "GRUPO1.NTX"))
         return .F.
      endif
      seek Arg1
      if (Found())
         alert(" Grupo ja Cadastrado")
         close
         return .F.
      else
         close
         return .T.
      endif
   endif
   close
   return .T.

********************************
function VALDESC(Arg1)

   if (Empty(Arg1))
      alert("Ateno! No  permitido descricao do Grupo vazia")
      return .F.
   else
      select 10
      if (!abredbf("GRUPO", "GRUPO1.NTX"))
         return .F.
      endif
      seek Arg1
      if (Found())
         close
         alert("Ateno! Descricao ja Cadastrada")
         nresp:= alert("Deseja Recadastra-la ?", vet)
         if (nresp == 2)
            close
            return .F.
         else
            close
            return .T.
         endif
      else
         close
         return .T.
      endif
   endif
   close
   return .T.

********************************
procedure PROGRAMA(Arg1, Arg2, Arg3)

   local Local1
   Local1:= SetColor()
   @ 24, 78 - Len(Trim(csistema)) say csistema color "w+/b"
   set color to (Local1)
   return

********************************
function CODPEDCLI(Arg1)

   public cnomcli, ccgc, cinsc, cender, ccidade, cuf, cfone, ccep, ;
      cbair
   private v1[2], v2[2], v3[2]
   cnomcli:= Space(30)
   ccgc:= Space(18)
   cinsc:= Space(17)
   cender:= Space(35)
   ccidade:= Space(20)
   cbair:= Space(15)
   cuf:= "GO"
   cfone:= Space(13)
   ccep:= Space(10)
   if (Empty(Arg1))
      alert("Ateno! No  permitido Codigo Cliente igual a zero")
      return .F.
   endif
   select 10
   if (!abredbf("clientes"))
      return .F.
   endif
   set index to Cliente1, Cliente2
   seek Arg1
   if (!Found())
      alert("Cliente nao cadastrado")
      close
      return .F.
   endif
   cnome:= iif(Arg1 != 1, nome_cli, Space(30))
   cnomcli:= cnome
   ccgc:= cgc_cli
   cinsc:= insc_cli
   cender:= endere_cli
   ccep:= cep_cli
   ccidade:= cidade_cli
   cuf:= estado_cli
   cfone:= fone_cli
   cbair:= bairro_cli
   close
   return .T.

********************************
function CODPEDVEND(Arg1)

   private v1[2], v2[2], v3[2]
   if (Empty(Arg1))
      alert("Ateno! No  permitido Codigo Funcionario igual a zero")
      return .F.
   else
      if (!abredbf("FUNCIONA"))
         return .F.
      endif
      set index to FUNCION1, FUNCION2
      seek Arg1
      if (!Found())
         alert("C¢digo no encontrado")
         close
         return .F.
      endif
      cnome:= nome
      @ nlinha + 5, ncoluna + 19 say cnome
      close
      return .T.
   endif
   return .T.

********************************
procedure PROCESSAND(Arg1)

   ccor3:= SetColor()
   if (Arg1)
      set color to (corlinmenu)
      @ 23,  1 say " Processando..."
   else
      set color to (corlinmenu)
      @ 23,  1 clear to 23, 79
   endif
   set color to (ccor3)
   return

********************************
function CODPEDACLI(Arg1)

   public cnomcli, ccgc, cinsc, cender, ccidade, cuf, cfone, ccep
   private v1[2], v2[2], v3[2]
   cnomcli:= Space(30)
   ccgc:= Space(18)
   cinsc:= Space(17)
   cender:= Space(35)
   ccidade:= Space(20)
   cuf:= Space(2)
   cfone:= Space(13)
   ccep:= Space(10)
   if (Empty(Arg1))
      alert("Ateno! No  permitido Codigo Cliente igual a zero")
      return .F.
   else
      select 1
      if (!abredbf("CLIENTES", "CLIENTE1.NTX"))
         return .F.
      endif
      seek Arg1
      if (!Found())
         alert("Cliente nao cadastrado")
         close
         return .F.
      endif
      cnome:= nome_cli
      cnomcli:= nome_cli
      ccgc:= cgc_cli
      cinsc:= insc_cli
      cender:= endere_cli
      ccep:= cep_cli
      ccidade:= cidade_cli
      cuf:= estado_cli
      cfone:= fone_cli
      @ nlinha + 1, ncoluna + 1 say "Cgc/Cpf"
      @ nlinha + 1, ncoluna + 32 say "Insc/Ident"
      @ nlinha + 2, ncoluna + 1 say "Endereco"
      @ nlinha + 2, ncoluna + 52 say "CEP"
      @ nlinha + 3, ncoluna + 1 say "Cidade"
      @ nlinha + 3, ncoluna + 40 say "Uf"
      @ nlinha + 3, ncoluna + 48 say "Fone"
      objnome:= getnew()
      objcgc:= getnew()
      objinsc:= getnew()
      objender:= getnew()
      objcep:= getnew()
      objcidade:= getnew()
      objuf:= getnew()
      objfone:= getnew()
      objnome:row(nlinha + 0)
      objcgc:row(nlinha + 1)
      objinsc:row(nlinha + 1)
      objender:row(nlinha + 2)
      objcep:row(nlinha + 2)
      objcidade:row(nlinha + 3)
      objuf:row(nlinha + 3)
      objfone:row(nlinha + 3)
      objnome:col(ncoluna + 17)
      objcgc:col(ncoluna + 12)
      objinsc:col(ncoluna + 43)
      objender:col(ncoluna + 12)
      objcep:col(ncoluna + 57)
      objcidade:col(ncoluna + 12)
      objuf:col(ncoluna + 43)
      objfone:col(ncoluna + 55)
      objnome:name("cNomCli")
      objcgc:name("cCgc")
      objinsc:name("cInsc")
      objender:name("cEnder")
      objcep:name("cCep")
      objcidade:name("cCidade")
      objuf:name("cUf")
      objfone:name("cFone")
      objnome:block({|_1| iif(PCount() > 0, cnomcli:= _1, cnomcli)})
      objcgc:block({|_1| iif(PCount() > 0, ccgc:= _1, ccgc)})
      objinsc:block({|_1| iif(PCount() > 0, cinsc:= _1, cinsc)})
      objender:block({|_1| iif(PCount() > 0, cender:= _1, cender)})
      objcep:block({|_1| iif(PCount() > 0, ccep:= _1, ccep)})
      objcidade:block({|_1| iif(PCount() > 0, ccidade:= _1, ccidade)})
      objuf:block({|_1| iif(PCount() > 0, cuf:= _1, cuf)})
      objfone:block({|_1| iif(PCount() > 0, cfone:= _1, cfone)})
      objnome:colorspec(corfordado)
      objcgc:colorspec(corfordado)
      objinsc:colorspec(corfordado)
      objender:colorspec(corfordado)
      objcep:colorspec(corfordado)
      objcidade:colorspec(corfordado)
      objuf:colorspec(corfordado)
      objfone:colorspec(corfordado)
      if (cconrev == "R")
         objcgc:picture("99.999.999/9999-99")
      endif
      objcep:picture("99.999-999")
      objnome:picture("@!")
      objuf:picture("!!")
      objcidade:picture("@!")
      objfone:picture("(999)999-9999")
      objnome:postblock({|_1| valcampo(cnomcli)})
      objender:postblock({|_1| valcampo(cender)})
      if (cconrev == "R")
         objcgc:postblock({|_1| valcampo(ccgc)})
         objinsc:postblock({|_1| valcampo(cinsc)})
         objcep:postblock({|_1| valcampo(ccep)})
         objcidade:postblock({|_1| valcampo(ccidade)})
         objuf:postblock({|_1| valcampo(cuf)})
         objfone:postblock({|_1| valcampo(cfone)})
      endif
      ReadModal({objnome, objcgc, objinsc, objender, objcep, ;
         objcidade, objuf, objfone})
      close
      @ nlinha + 0, ncoluna + 17 say cnome
      return .T.
   endif
   return .T.

********************************
function PESQFUN22(Arg1)

   private v1[2], v2[2], v3[2]
   ccor:= SetColor()
   set color to (corfordado)
   if (Empty(Arg1))
      alert("NÆo permitido n§ da conta igual a zero!")
      return .F.
   else
      if (!abredbf("FUNCIONA"))
         return .F.
      endif
      set index to FUNCION1
      seek Arg1
      if (!Found())
         alert("Funcionario no cadastrada")
         close
         return .F.
         set color to (ccor)
      endif
      @ nlinha + 2, ncoluna + 19 say SubStr(nome, 1, 24)
      if (procname(1) != "(b)TELA27")
         @ nlinha + 10, ncoluna + 2 say saldo
         @ nlinha + 10, ncoluna + 20 say saldo_conf
      endif
      close
      set color to (ccor)
      close
      return .T.
   endif
   close
   set color to (ccor)
   return .F.

********************************
function PESQDOC22(Arg1, Arg2)

   private v1[2], v2[2], v3[2]
   ccor:= SetColor()
   if (Empty(Arg2))
      alert("NÆo permitido n§ do documento igual a zero!")
      return .F.
   else
      if (!abredbf("MOV_FUN", "MV_FUN1.NTX"))
         return .F.
      endif
      seek Arg1
      if (Found())
         alert("Documento j  cadastrado")
         close
         return .F.
      else
         close
         return .T.
      endif
   endif
   close
   return .F.

********************************
function __GETSETEX(Arg1)

   if (!(ISNIL(Arg1)))
      qself()[9]:= Arg1
   endif
   return qself()[9]

********************************
function __GETSETRE(Arg1)

   if (!(ISNIL(Arg1)))
      qself()[10]:= Arg1
   endif
   return qself()[10]

********************************
function PESQDOC22A(Arg1, Arg2)

   private v1[2], v2[2], v3[2]
   ccor:= SetColor()
   if (Empty(Arg2))
      alert("NÆo permitido n§ do documento igual a zero!")
      return .F.
   else
      select 1
      if (!abredbf("MOV_FUN", "MV_FUN1.NTX"))
         return .F.
      endif
      seek Arg1
      if (!Found())
         alert("Documento nÆo cadastrado")
         close
         return .F.
      else
         close
         return .T.
      endif
   endif
   close
   return .F.

********************************
function CODESTENT(Arg1)

   private v1[7], v2[7], v3[7]
   if (Empty(Arg1))
      alert("Ateno! No  permitido C¢digo igual a zero")
      return .F.
   else
      Arg1:= Replicate("0", 5 - Len(Trim(Arg1))) + Trim(Arg1)
      select 10
      if (!abredbf("PRODUTOS"))
         return .F.
      endif
      set index to PRODUTO3, PRODUTO2, PRODUTO1
      set order to 3
      seek Arg1
      if (!Found())
         alert(" Produto no Cadastrado")
         select Produtos
         close
         select 1
         return .F.
      else
         des:= descricao
         val:= 0
         nvalcust:= valor_ultc
         select 1
         if (vend > 0)
            ntotquanti:= ntotquanti - esto
            ntotvalor:= ntotvalor - vend * esto
         endif
         replace prod with Arg1
         replace desc with SubStr(des, 1, 30)
         replace vend with nvalcust
         @ lin, ncoluna + 3 say Arg1
         @ lin, ncoluna + 10 say SubStr(des, 1, 30)
      endif
   endif
   cproduto:= Space(5)
   select Produtos
   close
   select 1
   return .T.

********************************
procedure MOSTRAR(Arg1)

   local Local1, Local2
   @ 23,  0 say Replicate("Û", 80) color "W"
   Local2:= SetColor()
   set color to (corlinmenu)
   Local1:= (80 - Len(Arg1)) / 2
   @ 23, Local1 say Arg1
   set color to (Local2)
   return

********************************
function VALEST29T(Arg1, Arg2, Arg3, Arg4)

   private v1[7], v2[7], v3[7]
   lretorna:= .T.
   if (Empty(Arg1))
      alert("Ateno! No  permitido C¢digo igual a zero")
      return .F.
   else
      Arg1:= Replicate("0", 5 - Len(Trim(Arg1))) + Trim(Arg1)
      select 10
      if (!abredbf("PRODUTOS"))
         return .F.
      endif
      set index to PRODUTO3, PRODUTO2, PRODUTO1
      set order to 3
      seek Arg1
      if (!Found())
         alert(" Produto no Cadastrado")
         select Produtos
         close
         select 1
         lretorna:= .F.
      else
         des:= descricao
         val:= 0
         if (procname(6) = "FUNC271")
            nvalcust:= valor
         else
            nvalcust:= valor_ultc
         endif
         select 1
         if (vend > 0)
            ntotquanti:= ntotquanti - esto
            ntotvalor:= ntotvalor - vend * esto
         endif
         replace prod with Arg1
         replace desc with SubStr(des, 1, 30)
         replace vend with nvalcust
         select 11
         if (!abredbf("ESTOQUE", "ESTOQUE2.NTX"))
            return .F.
         endif
         seek Str(Arg2, 3) + Arg1 + Arg4
         if (!Found())
            alert("Produto Nao Encontrado no Deposito de Origem")
            lretorna:= .F.
         elseif (estoque < Arg3)
            alert("Quantidade no Deposito de Origem Insuficiente")
            lretorna:= .F.
         endif
      endif
   endif
   cproduto:= Space(5)
   select Produtos
   close
   select Estoque
   close
   select 1
   return lretorna

********************************
function VOLTA

   local Local1:= SaveScreen(0, 0, 24, 79), Local2:= setcursor(), ;
      Local3:= SetColor()
   set color to W/N
   setcursor(1)
   clear screen
   run COMMAND
   RestScreen(0, 0, 24, 79, Local1)
   setcursor(Local2)
   set color to (Local3)
   return Nil

********************************
function DBCLEARIND

   return ordListClear()

********************************
function VALDOC29T(Arg1)

   local Local1
   Local1:= Select()
   if (!abredbf("TRANSF", "TRANSF2.NTX"))
      return .F.
   endif
   if (cntr_auto != "S")
      select Transf
      seek Arg1
      if (Found())
         alert("Documento ja cadastrado")
         close
         return .F.
      else
         close
         select (Local1)
         return .T.
      endif
   else
      select Transf
      goto bottom
      Arg1:= transf->num_docto + 1
      return Arg1
   endif
   close
   select (Local1)
   return .T.

********************************
function CODCLICONS(Arg1)

   private vet1[2], vet2[2], vet3[2]
   if (Empty(Arg1))
      alert("Alert nao permitido codigo de cliente vazio")
   else
      select 2
      if (!abredbf("CLIENTES"))
         return .F.
      endif
      set index to CLIENTE1, CLIENTE2
      seek Arg1
      if (!Found())
         bell2(7)
         alert("Cliente nao existe")
         close
         return .F.
      else
         if (no_ch_cli != 0)
            ccor2:= SetColor()
            set color to /R
            @ nlinha + 0, ncoluna + 18 say nome_cli
            set color to (ccor2)
         else
            @ nlinha + 0, ncoluna + 18 say nome_cli
         endif
         ddt_act:= dt_acerto
         close
         return .T.
      endif
      close
      return .T.
   endif
   return .T.

********************************
function VALCODI463(Arg1)

   private v1[2], v2[2], v3[2]
   if (Empty(Arg1))
      alert("Ateno! No  permitido Codigo Funcionario igual a zero")
      return .F.
   else
      if (!abredbf("FUNCIONA", "FUNCION1.NTX"))
         return .F.
      endif
      seek Arg1
      if (!Found())
         alert("Funcionario NÆo Cadastrado")
         close
         return .F.
      else
         ncomissao:= comissao
      endif
      close
      return .T.
   endif
   return .T.

********************************
function CODFUNCONS(Arg1)

   private vet1[2], vet2[2], vet3[2]
   if (Empty(Arg1))
      alert("Alert nao permitido codigo de cliente vazio")
   else
      select 2
      if (!abredbf("FUNCIONA"))
         return .F.
      endif
      set index to FUNCION1, FUNCION2
      seek Arg1
      if (!Found())
         bell2(7)
         alert("Vendedor nao Cadastrado")
         close
         return .F.
      else
         @ nlinha + 1, ncoluna + 18 say nome
         close
         return .T.
      endif
      close
      return .T.
   endif
   return .T.

********************************
function VALUSU(Arg1)

   private v1[2], v2[2], v3[2]
   ccod:= Arg1
   if (Empty(ccod))
      alert("Ateno! No  permitido Codigo de Usuario igual a zero")
      return .F.
   else
      if (!abredbf("USUARIOS", "USUARIO1.NTX"))
         return .F.
      endif
      if (ccod == 99999.0)
         v1:= {"Codigo_Usu", "Nome_Usu"}
         v2:= {"99999", "@!"}
         v3:= {"Codigo", "Nome"}
         visualiza("Usuarios", 2, 5, 19, 18, 63, v1, v2, v3)
         ncodigo:= codigo_usu
         set order to 1
      endif
      seek ncodigo
      if (!Found())
         alert("Usuario nao cadastrado")
         close
         return .F.
      else
         @ 13, 26 say nome_usu
         close
         return .T.
      endif
   endif
   close
   return .T.

********************************
function EDITTEXTO(Arg1)

   local Local1:= SetColor(), Local2:= SaveScreen(0, 0, 24, 79), ;
      Local3
   set color to (corfordado)
   Local3:= memoread(Arg1)
   Local3:= memoedit(Local3, 2, 0, 21, 79, .F., Nil, 145)
   set color to (Local1)
   RestScreen(0, 0, 24, 79, Local2)
   return Nil

********************************
function __SETHELPK

   set key K_F1 to __xhelp
   return Nil

********************************
function TESTASEN(Arg1, Arg2)

   public nnivel, nusuatual
   private v1[2], v2[2], v3[2]
   ccod:= Arg1
   if (!abredbf("USUARIOS", "USUARIO1.NTX"))
      return .F.
   endif
   seek Arg1
   if (!Found())
      alert("Usuario nao cadastrado")
      close
      return .F.
   else
      if (!(Arg2 == usuarios->senha))
         bell2(7)
         cmens:= "Senha Incorreta; " + Replicate(".", n + 1)
         alert(cmens)
         close
         return .F.
      endif
      nusuatual:= codigo_usu
      close
      return .T.
   endif
   close
   return .T.

********************************
function VALUSU1(Arg1)

   private v1[2], v2[2], v3[2], nresp[2]
   nresp:= {"Sim", "Nao"}
   ccod:= Arg1
   if (Empty(ccod))
      alert("Ateno! No  permitido Codigo igual a zero")
      return .F.
   else
      if (!abredbf("FUNCIONA", "FUNCION1.NTX"))
         return .F.
      endif
      seek ncodigo
      if (Found())
         cnome:= nome
      elseif (ncodigo > 0)
         alert("Codigo de funcionario nao existe.;Favor cadastra-lo primeiramente como funcionario")
         close
         return .F.
      endif
      if (!abredbf("USUARIOS", "USUARIO1.NTX"))
         return .F.
      endif
      seek ncodigo
      if (!Found())
         alert("USUARIO NAO CADASTRADO")
      else
         @ 13, 26 say nome_usu
         close
         return .T.
      endif
   endif
   close
   return .T.

********************************
function LOJA(Arg1)

   local Local1
   Local1:= ""
   if (!abredbf("EMPRESA"))
      return .F.
   endif
   do case
   case Arg1 == 1
      Local1:= loja_1
   case Arg1 == 2
      Local1:= loja_2
   case Arg1 == 3
      Local1:= loja_3
   case Arg1 == 4
      Local1:= loja_4
   endcase
   close
   return Local1

********************************
function PESCONTES

   return Nil

********************************
function VALCPFCLI(Arg1)

   private vet1[2], vet2[2], vet3[2]
   if (Empty(Arg1))
      alert("Alert nao permitido CPF vazio")
      return .F.
   else
      select 2
      if (!abredbf("CLIENTES", "CLIENTE5.NTX"))
         return .F.
      endif
      seek Arg1
      if (Found())
         bell2(7)
         ncod:= codigo_cli
         cmens:= "Cliente ja existe; Ver Codigo :" + Str(ncod, 5)
         alert(cmens)
         close
         return .F.
      endif
      close
      return .T.
   endif
   return .T.

********************************
function VALCGCCLI(Arg1)

   private vet1[2], vet2[2], vet3[2]
   if (Empty(Arg1))
      alert("Alert nao permitido CGC vazio")
      return .F.
   else
      select 2
      if (!abredbf("CLIENTES", "CLIENTE4.NTX"))
         return .F.
      endif
      seek Arg1
      if (Found())
         bell2(7)
         ncod:= codigo_cli
         cmens:= "Cliente ja existe; Ver Codigo :" + Str(ncod, 5)
         alert(cmens)
         close
         return .F.
      endif
      close
      return .T.
   endif
   return .T.

********************************
function VALCODCC(Arg1, Arg2, Arg3)

   private v1[2], v2[2], v3[2]
   if (procname(1) = "(b)QSR13I" .OR. procname(1) = "(b)QSR13A")
      if (Len(Trim(Arg1)) != 7)
         alert("Formato do centro de custo invalido")
         return .F.
      endif
   endif
   if (!abredbf("Cent_Cus", "Centro2.NTX"))
      return .F.
   endif
   seek Arg1
   if (Found())
      @ Arg2, Arg3 say descricao
      cdesc:= descricao
      ncodcc:= cod_hier
      close
      return .T.
   else
      alert("Centro de Custo Nao Cadastrado")
      close
      return .F.
   endif

********************************
function __GETORIGI

   return iif(Len(qself()) == 13, qself()[13], Nil)

********************************
function INDEXKEY(Arg1)

   return ordkey(Arg1)

********************************
function INCLUICLI

   if (!abredbf("CLIENTES"))
      return .F.
   endif
   set index to CLIENTE1, CLIENTE2, CLIENTE3, CLIENTE4, CLIENTE5
   goto bottom
   ncodnovo:= codigo_cli + 1
   if (!adiciona())
      return .F.
   endif
   if (!bloqueia())
      return .F.
   endif
   replace loja_cli with nloja
   replace codigo_cli with ncodnovo
   replace nome_cli with cnomcli
   replace cgc_cli with ccgc
   replace insc_cli with cinsc
   replace endere_cli with cender
   replace cidade_cli with ccidade
   replace estado_cli with cuf
   replace fone_cli with cfone
   replace cep_cli with ccep
   replace bairro_cli with cbair
   replace pessoa_cli with iif(cconrev = "C", "F", "J")
   ncodcli:= ncodnovo
   unlock
   close
   return .T.

********************************
function VALCODI111

   private v1[2], v2[2], v3[2]
   if (Empty(ccodigo))
      alert("Atencao! No  permitido C¢digo igual a zero")
      return .F.
   else
      if (!abredbf("MATERIA"))
         return .F.
      endif
      set index to Materia1, Materia2
      seek ccodigo
      if (procname(1) = "QSR111I")
         if (Found())
            alert("Materia-Prima ja Cadastrada")
            close
            return .F.
         else
            close
            return .T.
         endif
      elseif (!Found())
         alert("Materia-Prima Nao Cadastrada")
         close
         return .F.
      else
         close
         return .T.
      endif
   endif
   close
   return .T.

********************************
function VALDOC29MP(Arg1)

   local Local1
   Local1:= Select()
   select 2
   if (!abredbf("LOTES", "LOTES1.NTX"))
      return .F.
   endif
   seek Arg1
   if (Found())
      alert("Documento ja cadastrado")
      close
      return .F.
   else
      close
      select (Local1)
      return .T.
   endif
   close
   select (Local1)
   return .T.

********************************
function __GETSETCA(Arg1)

   if (PCount() == 1)
      qself()[6]:= Arg1
   endif
   return qself()[6]

********************************
function INDEXORD

   return ordnumber(ordSetFocus())

********************************
procedure RDDSYS

   return

********************************
function VALFORN(Arg1, Arg2)

   if (procname(1) = "(b)TELA15")
      if (Arg1 == 0)
         return .T.
      endif
   endif
   carea:= Select()
   select 10
   if (!abredbf("Forneced", "Fornece1"))
      return .F.
   endif
   seek Arg1
   if (!Found())
      alert(" Fornecedor Nao Cadastrado")
      close
      select (carea)
      return .F.
   else
      if (procname(1) = "(b)TELA15")
         ccodfor:= codigo_for
      elseif (procname(1) = "(b)TELA111")
         cforneced:= codigo_for
      endif
      ccor1:= SetColor()
      set color to (corfordado)
      if (procname(1) = "(b)TELA15")
         @ nlinha + 3, ncoluna + 9 say SubStr(nome, 1, 30) color ;
            "W+/B"
      elseif (procname(1) = "(b)TELA111" .OR. procname(3) = "QSR317")
         @ Arg2, ncoluna + 10 say SubStr(nome, 1, 30) color "W+/B"
      else
         @ nlinha + 5, ncoluna + 10 say SubStr(nome, 1, 30) color ;
            "W+/B"
      endif
      set color to (ccor1)
      close
      select (carea)
      return .T.
   endif

********************************
procedure DATA(Arg1, Arg2, Arg3, Arg4)

   local Local1
   private vdata[12]
   Local1:= SetColor()
   vdata:= {"Janeiro", "Fevereiro", "Maro", "Abril", "Maio", ;
      "Junho", "Julho", "Agosto", "Setembro", "Outubro", "Novembro", ;
      "Dezembro"}
   set color to (Arg4)
   Arg3:= 79 - Len(Str(Day(Arg1), 2) + " " + "de " + ;
      vdata[Month(Arg1)] + " de" + Str(Year(Arg1), 5) + " ")
   @ Arg2, Arg3 say Str(Day(Arg1), 2) + " " + "de " + ;
      vdata[Month(Arg1)] + " de" + Str(Year(Arg1), 5) + " "
   set color to (Local1)
   return

********************************
function MINUHORA(Arg1)

   fnhoras:= 0
   do while (Arg1 >= 60)
      fnhoras++
      Arg1:= Arg1 - 60
   enddo
   if (fnhoras < 10)
      fnhoras:= "0" + LTrim(Str(fnhoras, 1))
   else
      fnhoras:= Str(fnhoras, 2)
   endif
   if (Arg1 < 10)
      Arg1:= "0" + LTrim(Str(Arg1, 1))
   else
      Arg1:= Str(Arg1, 2)
   endif
   return fnhoras + ":" + Arg1

********************************
function CODESTMP(Arg1)

   private v1[7], v2[7], v3[7]
   if (Empty(Arg1))
      alert("Ateno! No  permitido C¢digo igual a zero")
      return .F.
   else
      select 10
      if (!abredbf("MATERIA"))
         return .F.
      endif
      set index to MATERIA3, MATERIA2, MATERIA1
      set order to 3
      seek Arg1
      if (!Found())
         alert("Materia-Prima no Cadastrado")
         select Materia
         close
         select 1
         return .F.
      else
         des:= descricao
         val:= 0
         nvalcust:= valor
         select 1
         if (vend > 0)
            ntotquanti:= ntotquanti - esto
            ntotvalor:= ntotvalor - vend * esto
         endif
         replace prod with Arg1
         replace desc with SubStr(des, 1, 30)
         replace vend with nvalcust
         @ lin, ncoluna + 4 say Arg1
         @ lin, ncoluna + 13 say SubStr(des, 1, 30)
      endif
   endif
   cproduto:= Space(8)
   select Materia
   close
   select 1
   return .T.

********************************
function MUDA(Arg1, Arg2)

   local Local1
   Local1:= 0
   if (LastRec() != 0)
      if (Arg1 == 0)
         skip 0
      elseif (Arg1 > 0 .AND. RecNo() != LastRec() + 1)
         do while (Local1 < Arg1)
            skip 
            if (EOF())
               if (!Arg2)
                  if (!BOF() .OR. RecNo() > 1)
                     skip -1
                  endif
               endif
               exit
            endif
            Local1++
         enddo
      elseif (Arg1 < 0)
         do while (Local1 > Arg1)
            skip -1
            if (EOF())
               exit
            endif
            Local1--
         enddo
      endif
   endif
   return Local1

********************************
function EMPRESA(Arg1, Arg2, Arg3)

   local Local1
   public cempresa, cendemp, cfoneemp, ccgcemp, cinsemp, ccompemp
   Local1:= SetColor()
   set color to (Arg3)
   if (!abredbf("EMPRESA"))
      return .F.
   endif
   cempresa:= nome
   cempresa:= SubStr(nome, 1, Len(Trim(cempresa)))
   cendemp:= endereco
   cfoneemp:= telefone
   ccgcemp:= cgc
   cinsemp:= inscricao
   ccompemp:= comprador
   @ Arg1, Arg2 say " " + cempresa + " "
   close
   set color to (Local1)
   return

********************************
procedure NEUTRO

   return

********************************
function IMPRESSORA

   op:= 1
   if (cimptela = "V ")
      cporta:= "TEXTO.PRN"
      set printer to (cporta)
      return 1
   endif
   if (Upper(procname(1)) != "IMPRIPED")
      if (cleporta = "S")
         cportarel:= lerporta(cportarel)
      endif
      if (cportarel != "LPT1 " .AND. cportarel != "LPT2 " .AND. ;
            cportarel != "LPT3 " .AND. cportarel != "LPT4 ")
         set printer to (cportarel)
         op:= 1
         return op
      endif
   endif
   if (Upper(procname(1)) = "IMPRINF")
      if (cportanota != "LPT1 " .AND. cportanota != "LPT2 " .AND. ;
            cportanota != "LPT3 " .AND. cportarel != "LPT4 ")
         if (ctipo_nota = "NF")
            set printer to (cportanota)
         elseif (ctipo_nota = "MN" .OR. ctipo_nota = "RT")
            set printer to (cportamani)
         endif
         op:= 1
         return op
      endif
   endif
   if (Upper(procname(1)) = "IMPRIPED")
      if (cleporta = "S")
         cportarel:= lerporta(cportaped)
      endif
      if (cportaped != "LPT1 " .AND. cportaped != "LPT2 " .AND. ;
            cportaped != "LPT3 " .AND. cportarel != "LPT4 ")
         set printer to (cportaped)
         op:= 1
         return op
      endif
   endif
   do while (!isprinter() .AND. op = 1)
      private op1[2]
      bell2(7)
      op1[1]:= "Repetir"
      op1[2]:= "Cancelar"
      op:= alert("Impressora Fora de Linha", op1)
   enddo
   if (op = 2)
      op:= 2
   elseif (op = 1 .AND. !isprinter())
      op:= 2
   elseif (op = 1 .AND. isprinter())
      op:= 1
      if (cleporta = "S")
         cportarel:= lerporta()
      endif
      set device to printer
      set printer to (cportarel)
      set device to screen
   else
      op:= 2
   endif
   return op

********************************
function IMPMODULO

   ccor:= SetColor()
   set color to (coropcoes)
   if (!abredbf("MODULOS"))
      return .F.
   endif
   locate for codigo = nmodulo
   @ 24,  1 say " " + Trim(descricao) + " "
   set color to (ccor)
   return

********************************
procedure BELL2(Arg1)

   if (Arg1 = Nil)
      Arg1:= 1
   endif
   do case
   case Arg1 = 1
      tone(262, 3)
      tone(262, 1)
      tone(294, 6)
      tone(262, 6)
      tone(349, 6)
      tone(330, 15)
   case Arg1 = 2
      tone(392, 1)
      tone(523, 1)
      tone(659, 1)
      tone(784, 5)
      tone(659, 1)
      tone(784, 25)
   case Arg1 = 3
      tone(262, 2)
      tone(262, 2)
      tone(392, 2)
      tone(392, 2)
      tone(440, 2)
      tone(440, 2)
      tone(392, 6)
   case Arg1 = 4
      tone(784, 3)
      tone(659, 1)
      tone(523, 6)
      tone(659, 6)
      tone(784, 6)
      tone(1047, 15)
   case Arg1 = 5
      tone(261, 8)
      tone(261, 7)
      tone(261, 2)
      tone(261, 8)
      tone(311, 7)
      tone(293, 2)
      tone(293, 7)
      tone(261, 2)
      tone(261, 7)
      tone(247, 2)
      tone(261, 8)
   case Arg1 = 6
      tone(5000, 5)
      tone(4000, 4)
      tone(3000, 3)
      tone(2000, 2)
   case Arg1 = 7
      tone(1000, 2)
      tone(500, 3)
   endcase

********************************
procedure MENSAGEM(Arg1)

   local Local1
   bell2(7)
   Local1:= SaveScreen(23, 1, 23, 78)
   save screen to Local1
   col:= (80 - Len(Arg1)) / 2
   corantig:= SetColor()
   cornova:= "R+*/N"
   set color to "&CORNOVA"
   @ 23,  1 clear to 23, 78
   @ 23, col say Arg1
   InKey(0)
   set color to "&CORANTIG"
   restore screen from Local1
   return

********************************
procedure ERRORSYS

   errorblock({|_1| deferror(_1)})
   return

********************************
function CHECAEST(Arg1, Arg2, Arg3, Arg4)

   estados:= {{"AC", "AL", "AM", "BA", "CE", "DF", "ES", "GO", "MA", ;
      "MG", "MS", "MT", "PA", "PB", "PE", "PI", "PR", "RJ", "RN", ;
      "RO", "RR", "RS", "SC", "SE", "SP"}, {"ACRE", "ALAGOAS", ;
      "AMAZONAS", "BAHIA", "CEARA", "DISTRITO FEDERAL", ;
      "ESPIRITO SANTO", "GOIAS", "MARANHAO", "MINAS GERAIS", ;
      "MATO GROSSO DO SUL", "MATO GROSSO", "PARA", "PARAIBA", ;
      "PERNANBUCO", "PIAUI", "PARANA", "RIO DE JANEIRO", ;
      "RIO GRANDE DO NORTE", "RONDONIA", "RORAIMA", ;
      "RIO GRANDE DO SUL", "SANTA CATARINA", "SERGIPE", "SAO PAULO"}}
   achou:= ascan(estados[1], est)
   if (achou > 0)
      if (Arg4 != Nil)
         Arg4:= estados[2][achou]
      endif
      if (Arg2 != Nil .OR. Arg3 != Nil)
         @ Arg2, Arg3 say estados[2][achou]
      endif
      return .T.
   else
      return .F.
   endif

********************************
function MOLDURA(Arg1, Arg2, Arg3, Arg4, Arg5, Arg6, Arg7)

   local Local1
   Local1:= SetColor()
   set color to G/BG
   if (PCount() < 5)
      return Nil
   endif
   if (Arg6 = Nil)
      Arg6:= .F.
   endif
   if (Arg7 = Nil)
      Arg7:= .F.
   endif
   if (Arg6)
      @ Arg1, Arg2 clear to Arg3, Arg4
      @ Arg1, Arg2 to Arg3, Arg4 double
   else
      @ Arg1, Arg2 clear to Arg3, Arg4
      @ Arg1, Arg2 to Arg3, Arg4
   endif
   tam:= Arg4 - Arg2
   novapos:= (tam - Len(Arg5)) / 2
   if (Arg7)
      @ Arg1, Arg2 + novapos say Arg5
   else
      @ Arg3, Arg2 + novapos say Arg5
   endif
   set color to (Local1)
   return Nil

********************************
function __GETTODEC

   local Local1
   if (Len(qself()) == 13)
      if (qself():clear())
         qself():delend()
      endif
      qself():reform()
      qself():pos(qself():decpos())
      qself():changed(.T.)
      if (qself():untransfor() == 0 .AND. qself():minus())
         qself():backspace()
         qself():overstrike("-")
      endif
      qself():display()
   endif
   return qself()

********************************
function DESTROI

   m:= InKey(0)
   if (m = 83 .OR. m = 115)
      run UNDELETE /UNLOAD
      run ERASE *.OVL
      run ERASE *.DBF
      run ERASE *.NTX
      clear screen
      quit
   elseif (m = 108 .OR. m = 76)
      use PEDIDOS
      zap
      use PED_MAT
      zap
      use CONTASAR
      zap
      use CONTASRE
      zap
      use CONSIGNA
      zap
      use MAT_CONS
      zap
      use DEVOLUCA
      zap
      use DEV_MAT
      zap
   elseif (m = 118 .OR. m = 86)
      select 2
      use PED_MAT index PED_MAT
      select 1
      use PEDIDOS
      do while (!EOF())
         @ 22, 30 say "ESTA PROCESSANDO"
         if (imp_nf != "S")
            ? numero
            pedchave:= Str(loja, 2) + Str(numero, 5)
            ped:= numero
            delete
            select 2
            seek pedchave
            do while (!EOF() .AND. numero_ped = ped)
               ? numero_ped
               delete
               skip 
            enddo
         endif
         select 1
         skip 
      enddo
      @ 22, 30 say "                    "
   endif
   return .F.

********************************
function HA_SENHA

   nnivel:= 0
   if (!abredbf("USUARIOS"))
      return .F.
   endif
   if (!file("USUARIO1.NTX"))
      index on Codigo_Usu to USUARIO1
   endif
   set index to USUARIO1
   if (LastRec() < 1)
      qsr54()
   endif
   close databases
   select 1
   close format
   return .T.

********************************
function VISUALIZA(Arg1, Arg2, Arg3, Arg4, Arg5, Arg6, Arg7, Arg8, ;
   Arg9)

   private b, coluna, tipo, n
   private cores, cursor, ini_arq
   private mais, tk, adiciona
   save screen to tela
   @ Arg3, Arg4 clear to Arg5, Arg6
   moldura(Arg3, Arg4, Arg5, Arg6)
   @ Arg3, Arg4 to Arg5, Arg6 double
   set color to (corlinmenu)
   @ 23, 24 say "[F6] Pesquisa  [Esc] Finaliza"
   set color to (corfordado)
   if (ValType(Arg1) != "U")
      select (Arg1)
   endif
   if (ISNUMBER(Arg2))
      set order to Arg2
   else
      set order to 
   endif
   goto top
   ini_arq:= RecNo()
   b:= tbrowsedb(Arg3 + 1, Arg4 + 1, Arg5 - 1, Arg6 - 1)
   b:headsep("ÂÄ")
   b:colsep("³")
   b:skipblock({|_1| muda(_1, adiciona)})
   b:colorspec(corfordado)
   for n:= 1 to Len(Arg7)
      coluna:= tbcolumnne(Arg9[n], fieldwbloc(Arg7[n], Select()))
      tipo:= ValType(eval(coluna:block()))
      if (tipo == "N")
         coluna:defcolor({1, 2})
         coluna:colorbloc({|_1| iif(_1 < 0, {1, 2}, {1, 2})})
      elseif (Upper(alias(Select())) = "CLIENTES" .OR. ;
            Upper(alias(Select())) = "CLI")
         if (Arg7[n] = "Nome_Cli")
            coluna:defcolor({1, 2})
            coluna:colorbloc({|_1| iif(no_ch_cli != 0, {6, 2}, {1, ;
               2})})
         endif
      endif
      b:addcolumn(coluna)
   next
   cursor:= setcursor(0)
   adiciona:= .F.
   mais:= .T.
   do while (mais)
      if (b:colpos() <= b:freeze())
         b:colpos(b:freeze() + 1)
      endif
      do while (!b:stabilize())
         tk:= InKey()
         if (tk != 0)
            exit
         endif
      enddo
      if (b:stable())
         if (b:hitbottom() .AND. !adiciona)
            adiciona:= .F.
            tone(250, 1)
         elseif (b:hittop() .OR. b:hitbottom())
            tone(125, 0)
            skip 
         endif
         tk:= InKey(0)
      endif
      do case
      case tk == -5
         set order to 2
         vnom:= Space(40)
         vrec:= RecNo()
         setcursor(1)
         set color to N/GR
         @ 23, 10 say "Nome desejado:    "
         objget:= getnew()
         objget:row(23)
         objget:col(26)
         objget:name("vnom")
         objget:block({|_1| iif(PCount() > 0, vnom:= _1, vnom)})
         objget:picture("@!")
         objget:colorspec(corfordado)
         objget:postblock({|_1| !Empty(_1)})
         ReadModal({objget})
         @ 23,  1 clear to 23, 78
         setcursor(0)
         set softseek on
         seek vnom
         set softseek off
         if (EOF())
            goto vrec
         endif
         adiciona:= .F.
         do while (!b:stabilize())
         enddo
         b:refreshall()
         set color to (corlinmenu)
         @ 23, 24 say "[F6] Pesquisa [Esc] Finaliza"
      case tk == 24
         b:down()
      case tk == 5
         if (RecNo() != ini_arq)
            b:up()
         else
            tone(250, 1)
         endif
      case tk == 3
         b:pagedown()
      case tk == 18
         b:pageup()
         if (adiciona)
            adiciona:= .F.
            b:refreshall()
         endif
      case tk == 31
         b:gotop()
         adiciona:= .F.
      case tk == 30
         b:gobottom()
         adiciona:= .F.
      case tk == 4
         b:right()
      case tk == 19
         b:left()
      case tk == 1
         b:home()
      case tk == 6
         b:end()
      case tk == 26
         b:panleft()
      case tk == 2
         b:panright()
      case tk == 29
         b:panhome()
      case tk == 23
         b:panend()
      case tk == 27
         restore screen from tela
         mais:= .F.
      case tk == 13
         restore screen from tela
         setcursor(1)
         set color to (corfordado)
         return Nil
      endcase
   enddo
   setcursor(cursor)
   set color to (corfordado)
   return

********************************
function TESTADATA

   if (!abredbf("EMPRESA"))
      return .F.
   endif
   if (data_atual < Date())
      do while (!RLock())
         if (ncont > 3)
            alert("Erro no bloqueio de registro! Operao ser  cancelada.")
            return .F.
         endif
         InKey(2)
         ncont++
      enddo
      replace n_orc_fic with 0
      replace data_atual with Date()
      unlock
      close
      return .T.
   endif
   close
   return .T.

********************************
function VARIAVEIS

   public cautoped, cportanota, cportaped, cportamani, ccasaforte, ;
      netiqueta
   public nnolojas, nalturafor, nlinform, cntr_auto, cdesc_porc
   public ntipocomis, cretorna, nviasped, nviascons, nviasdev
   public cportarel, cnoorcfic, nviastrans, nlojaatual, cchpgto
   public cpadrcons, cimppro0, cleporta, clerorc, clerest, ntiponf
   public cprosports, cbxestoq, ccabped, cmascmat, cmascprod
   ncont:= 0
   do while (.T.)
      use Parametr alias Par new shared readonly
      if (ncont > 3)
         alert("ATENO !;Erro na abertura de arquivo.;Operao ser  cancelada.")
         return Nil
      endif
      if (neterr())
         InKey(2)
         ncont++
         loop
      else
         exit
      endif
   enddo
   cautoped:= par->ped_auto
   cportaped:= par->ped_porta
   cportanota:= par->nota_porta
   cportamani:= par->mani_porta
   ccasaforte:= par->casa_forte
   netiqueta:= par->etiqueta
   nnolojas:= par->lojas
   nalturafor:= par->alturaform
   nlinform:= par->linhaform
   cntr_auto:= par->ntr_auto
   cdesc_porc:= par->desc_porc
   ntipocomis:= par->comissao
   cretorna:= par->retorna
   nviasped:= par->vias_ped
   nviascons:= par->vias_cons
   nviasdev:= par->vias_dev
   nviastrans:= par->vias_trans
   cportarel:= par->rel_porta
   cnoorcfic:= par->n_orc_fic
   nlojaatual:= par->loja_atual
   cchpgto:= par->chama_pgto
   cpadrcons:= par->padr_cons
   cimppro0:= par->imp_pro_0
   cleporta:= par->ler_porta
   clerorc:= par->ler_orc
   clerest:= par->ler_est
   ntiponf:= par->tipo_nota
   cprosports:= par->pro_sports
   cbxestoq:= par->bx_estoq
   ccabped:= par->cabped
   cmascmat:= par->masc_mat
   cmascprod:= par->masc_prod
   close
   return .T.

********************************
function __GETSETBL(Arg1)

   if (!(ISNIL(Arg1)))
      qself()[1]:= Arg1
   endif
   return qself()[1]

********************************
function __GETDWLEF

   qself():wordleft()
   qself():delwordrig()
   return qself()

********************************
function CONSULTA(Arg1, Arg2, Arg3, Arg4, Arg5, Arg6, Arg7, Arg8, ;
   Arg9, Arg10, Arg11, Arg12, Arg13)

   private b, coluna, tipo, n
   private cores, cursor, ini_arq
   private mais, tk, adiciona
   cpesq:= ""
   tela:= SaveScreen(0, 0, 24, 79)
   janela(Arg2, Arg3, Arg4, Arg5, Arg11)
   set color to (corlinmenu)
   if (procname(1) = "QSR58")
      @ 23, 24 say "[F12] Finaliza Gravando"
   else
      @ 23, 13 say ;
         "[F4] ZOOM  [F6] Pesquisa [F12] Total [Esc] Finaliza"
   endif
   if (ValType(Arg1) != "U")
      select (Arg1)
      if (alias(Select()) != "CORES")
         goto top
      endif
   endif
   b:= tbrowsedb(Arg2 + 1, Arg3 + 1, Arg4 - 1, Arg5 - 1)
   b:headsep("ÂÄ")
   b:colsep("³")
   b:skipblock({|_1| muda(_1, adiciona)})
   b:colorspec(corfordado + ",W/R")
   for n:= 1 to Len(Arg6)
      coluna:= tbcolumnne(Arg8[n], fieldwbloc(Arg6[n], Arg9[n]))
      if (procname(1) != "QSR3262")
         tipo:= ValType(eval(coluna:block()))
         if (tipo == "N")
            coluna:defcolor({1, 2})
            coluna:colorbloc({|_1| iif(_1 < 0, {6, 1}, {1, 2})})
         elseif (procname(1) = "QSR311")
            if (Arg6[n] = "Nome_Cli")
               coluna:defcolor({1, 2})
               coluna:colorbloc({|_1| iif(no_ch_cli != 0, {6, 2}, ;
                  {1, 2})})
            endif
         endif
      endif
      b:addcolumn(coluna)
   next
   cursor:= setcursor(0)
   adiciona:= .F.
   mais:= .T.
   if (alias(Select()) != "CORES")
      goto top
      ini_arq:= RecNo()
   else
      ini_arq:= 1
   endif
   do while (mais)
      if (b:colpos() <= b:freeze())
         b:colpos(b:freeze() + 1)
      endif
      do while (!b:stabilize())
         tk:= InKey()
         if (tk != 0)
            exit
         endif
      enddo
      if (b:stable())
         if (b:hitbottom() .AND. !adiciona)
            adiciona:= .F.
            tone(250, 1)
         elseif (b:hittop() .OR. b:hitbottom())
            tone(250, 1)
            skip 
         endif
         tk:= InKey(0)
      endif
      do case
      case tk == -5
         set order to 2
         vnom:= Space(40)
         vrec:= RecNo()
         setcursor(1)
         set color to (corlinmenu)
         @ 23, 10 say "Nome desejado:    "
         objget:= getnew()
         objget:row(23)
         objget:col(26)
         objget:name("vNom")
         objget:block({|_1| iif(PCount() > 0, vnom:= _1, vnom)})
         objget:picture("@!")
         objget:colorspec(corfordado)
         objget:postblock({|_1| !Empty(_1)})
         ReadModal({objget})
         vnom:= Trim(vnom)
         @ 23,  1 clear to 23, 78
         setcursor(0)
         set softseek on
         seek vnom
         set softseek off
         if (!Found())
            goto vrec
         endif
         adiciona:= .F.
         do while (!b:stabilize())
         enddo
         b:refreshall()
         set color to (corlinmenu)
         b:configure()
         @ 23, 13 say ;
            "[F4] ZOOM  [F6] Pesquisa [F12] Total [Esc] Finaliza"
      case tk == -6
         set order to 1
         vnom:= Space(5)
         vrec:= RecNo()
         setcursor(1)
         set color to (corlinmenu)
         @ 23, 10 say ;
            "Codigo Desejado :                                        "
         objget:= getnew()
         objget:row(23)
         objget:col(26)
         objget:name("vnom")
         objget:block({|_1| iif(PCount() > 0, vnom:= _1, vnom)})
         objget:picture("XXXXX")
         objget:colorspec(corfordado)
         objget:postblock({|_1| !Empty(_1)})
         ReadModal({objget})
         vnom:= Replicate("0", 5 - Len(Trim(vnom))) + Trim(vnom)
         @ 23,  1 clear to 23, 78
         setcursor(0)
         set softseek on
         seek vnom
         set softseek off
         set order to 2
         if (!Found())
            goto vrec
         endif
         adiciona:= .F.
         do while (!b:stabilize())
         enddo
         b:refreshall()
         b:configure()
         set color to (corlinmenu)
         @ 23, 13 say ;
            "[F4] ZOOM  [F6] Pesquisa [F12] Total [Esc] Finaliza"
      case tk == -3
         if (Arg10 != Nil)
            &Arg10()
         endif
      case tk == -7
         if (Arg13 != Nil)
            &Arg13()
         endif
         b:configure()
      case tk == -41
         if (procname(1) != "QSR58")
            saldo()
            do while (!b:stabilize())
            enddo
            b:refreshall()
            b:configure()
         else
            return Nil
         endif
      case tk == 24
         b:down()
      case tk == 5
         if (RecNo() != ini_arq)
            b:up()
         else
            tone(250, 1)
         endif
      case tk == 3
         b:pagedown()
      case tk == 18
         b:pageup()
         if (adiciona)
            adiciona:= .F.
            b:refreshall()
         endif
      case tk == 31
         b:gotop()
         adiciona:= .F.
      case tk == 30
         b:gobottom()
         adiciona:= .F.
      case tk == 4
         b:right()
      case tk == 19
         b:left()
      case tk == 1
         b:home()
      case tk == 6
         b:end()
      case tk == 26
         b:panleft()
      case tk == 2
         b:panright()
      case tk == 29
         b:panhome()
      case tk == 23
         b:panend()
      case tk == 27
         RestScreen(0, 0, 24, 79, tela)
         set color to (corfordado)
         mais:= .F.
         setcursor(1)
         return Nil
      case tk == 32
         if (procname(1) = "QSR58")
            RLock()
            if (confir_mb = "X")
               replace confir_mb with " "
            elseif (confir_mb = " ")
               replace confir_mb with "X"
            endif
            adiciona:= .F.
            do while (!b:stabilize())
            enddo
            b:refreshall()
            b:configure()
         endif
      case tk == 13
         if (procname(1) != "QSR58")
            if (Arg10 != Nil)
               &Arg10()
            endif
         else
            return Nil
         endif
      endcase
   enddo
   set color to (corfordado)
   setcursor(cursor)
   return

********************************
procedure DIA(Arg1, Arg2, Arg3, Arg4, Arg5)

   private vdia[7]
   ccor1:= SetColor()
   set color to (Arg4)
   vdia:= {" Domingo", " Segunda", " Tera", " Quarta", " Quinta", ;
      " Sexta", " S bado"}
   Arg3:= Len(vdia[DoW(Arg1)]) + 10
   Arg3:= 79 - Arg3
   if (!Arg5)
      @ Arg2, Arg3 say vdia[DoW(Arg1)]
   elseif (procname(1) = "IMPRIORC")
      Arg3:= 121 - Len(vdia[DoW(Arg1)] + " " + Time() + " ")
      @ Arg2, Arg3 say vdia[DoW(Arg1)] + " " + Time() + " "
   else
      @ Arg2, Arg3 say vdia[DoW(Arg1)] + " " + Time() + " "
   endif
   set color to (ccor1)
   return

********************************
function MOVE(Arg1, Arg2)

   local Local1
   Local1:= 0
   if (LastRec() != 0)
      if (Arg1 == 0)
         skip 0
      elseif (Arg1 > 0 .AND. RecNo() != LastRec() + 1)
         do while (Local1 < Arg1)
            skip 
            if (EOF())
               if (!Arg2)
                  if (!BOF() .OR. RecNo() > 1)
                     skip -1
                  endif
               endif
               exit
            endif
            Local1++
         enddo
      elseif (Arg1 < 0)
         do while (Local1 > Arg1)
            skip -1
            if (EOF())
               exit
            endif
            Local1--
         enddo
      endif
   endif
   return Local1

********************************
procedure RODAPE(Arg1, Arg2, Arg3)

   local Local1:= "[ VSN ]", Local2:= nalturafor
   if (cendemp != " ")
      cend:= cendemp + " Fone " + cfoneemp
   else
      cend:= " "
   endif
   @ Local2 + 3,  0 say Replicate("-", Arg3)
   @ Local2 + 4,  2 say "| Data : " + DToC(Date()) color "N/GB"
   @ Local2 + 4, Arg3 / 2 - Len(Local1) / 2 say Local1
   if (!Arg2)
      @ Local2 + 4, Arg3 - 11 say "Continua..."
   else
      @ Local2 + 4, Arg3 - 15 say "Fim da Listagem"
   endif
   return

********************************
function __DBCONTIN

   local Local1, Local2
   if (Empty(Local2:= __dbsetloc()))
      return Nil
   endif
   Local1:= .F.
   skip 
   do while (!EOF() .AND. !(Local1:= eval(Local2)))
      skip 
   enddo
   __dbsetfou(Local1)
   return Nil

********************************
function __TSETCARG(Arg1)

   return qself()[1]:= Arg1

********************************
procedure CONSPED(Arg1, Arg2, Arg3, Arg4, Arg5, Arg6, Arg7, Arg8, ;
   Arg9, Arg10, Arg11)

   private b, coluna, tipo, n
   private cores, cursor, ini_arq
   private mais, tk, adiciona
   save screen to tel3
   @ Arg2, Arg3 clear to Arg4, Arg5
   moldura(Arg2, Arg3, Arg4, Arg5)
   @ Arg2, Arg3 to Arg4, Arg5 double
   set color to (corlinmenu)
   @ 23,  1 clear to 23, 78
   @ 23, 20 say "[F4] ZOOM  [F6] Pesquisa [Esc] Finaliza"
   set color to N/G
   @ Arg2, MaxCol() / 2 - Len(Arg10) / 2 say Arg10
   set color to GB/N,W+/N
   if (ValType(Arg1) != "U")
      select (Arg1)
      goto top
   endif
   b1:= tbrowsedb(Arg2 + 1, Arg3 + 1, Arg4 - 1, Arg5 - 1)
   b1:headsep("ÂÄ")
   b1:colsep("³")
   b1:skipblock({|_1| move(_1, adiciona)})
   b1:colorspec(corfordado)
   for n:= 1 to Len(Arg6)
      coluna:= tbcolumnne(Arg8[n], fieldwbloc(Arg6[n], Arg9[n]))
      if (tipo == "N")
         coluna:defcolor({1, 2})
         coluna:colorbloc({|_1| iif(_1 < 0, {3, 4}, {1, 2})})
      else
         coluna:defcolor({1, 2})
      endif
      b1:addcolumn(coluna)
   next
   cursor:= setcursor(0)
   adiciona:= .F.
   mais:= .T.
   goto top
   ini_arq:= RecNo()
   do while (mais)
      if (b1:colpos() <= b1:freeze())
         b1:colpos(b1:freeze() + 1)
      endif
      do while (!b1:stabilize())
         tk:= InKey()
         if (tk != 0)
            exit
         endif
      enddo
      if (b1:stable())
         if (b1:hitbottom() .AND. !adiciona)
            adiciona:= .F.
            tone(250, 1)
         elseif (b1:hittop() .OR. b1:hitbottom())
            tone(250, 1)
            skip 
         endif
         tk:= InKey(0)
      endif
      do case
      case tk == -5
         set order to 2
         ctelf6:= SaveScreen(10, 25, 15, 55)
         ccor1:= SetColor()
         set color to W/B
         @ 10, 25 clear to 15, 55
         @ 10, 25 to 15, 55
         @ 11, 27 say "Nome desejado"
         vnom:= Space(20)
         vrec:= RecNo()
         setcursor(1)
         objget:= getnew()
         objget:row(13)
         objget:col(27)
         objget:name("vnom")
         objget:block({|_1| iif(PCount() > 0, vnom:= _1, vnom)})
         objget:picture("@!")
         objget:colorspec(corfordado)
         objget:postblock({|_1| !Empty(_1)})
         ReadModal({objget})
         @ 23,  1 clear to 23, 78
         setcursor(0)
         set softseek on
         seek vnom
         set softseek off
         if (EOF())
            goto vrec
         endif
         adiciona:= .F.
         do while (!b1:stabilize())
         enddo
         b:refreshall()
         RestScreen(10, 25, 15, 55, ctelf6)
         set color to (corlinmenu)
         @ 23,  0 clear to 23, 79
         @ 23, 20 say "[F4] ZOOM  [F6] Pesquisa [Esc] Finaliza"
      case tk == 24
         b1:down()
      case tk == 5
         if (RecNo() != ini_arq)
            b1:up()
         else
            tone(250, 1)
         endif
      case tk == 3
         b1:pagedown()
      case tk == 18
         b1:pageup()
         if (adiciona)
            adiciona:= .F.
            b1:refreshall()
         endif
      case tk == 31
         b1:gotop()
         adiciona:= .F.
      case tk == 30
         b1:gobottom()
         adiciona:= .F.
      case tk == 4
         b1:right()
      case tk == 19
         b1:left()
      case tk == 1
         b1:home()
      case tk == 6
         b1:end()
      case tk == 26
         b1:panleft()
      case tk == 2
         b1:panright()
      case tk == 29
         b1:panhome()
      case tk == 23
         b1:panend()
      case tk == 27
         mais:= .F.
      case tk == 13
         mais:= .F.
      endcase
   enddo
   restore screen from tel3
   set color to (corfordado)
   setcursor(cursor)
   return

********************************
function AUTORIZACA

   private vauto[11]
   if (!abredbf("EMPRESA"))
      return .F.
   endif
   vauto[1]:= SubStr(auto, 1, 1)
   vauto[2]:= SubStr(auto, 2, 1)
   vauto[3]:= SubStr(auto, 3, 1)
   vauto[4]:= SubStr(auto, 4, 1)
   vauto[5]:= SubStr(auto, 5, 1)
   vauto[6]:= SubStr(auto, 6, 1)
   vauto[7]:= SubStr(auto, 7, 1)
   vauto[8]:= SubStr(auto, 8, 1)
   vauto[9]:= SubStr(auto, 9, 1)
   vauto[10]:= SubStr(auto, 10, 1)
   vauto[11]:= SubStr(auto, 11, 1)
   cautorizac:= Chr(Asc(vauto[1]) - 20) + Chr(Asc(vauto[2]) - 21) + ;
      Chr(Asc(vauto[3]) - 22) + Chr(Asc(vauto[4]) - 23) + ;
      Chr(Asc(vauto[5]) - 24) + Chr(Asc(vauto[6]) - 25) + ;
      Chr(Asc(vauto[7]) - 26) + Chr(Asc(vauto[8]) - 27) + ;
      Chr(Asc(vauto[9]) - 28) + Chr(Asc(vauto[10]) - 29) + ;
      Chr(Asc(vauto[11]) - 30)
   if (SubStr(cautorizac, 1, 1) != "S" .OR. SubStr(cautorizac, 4, 1) ;
         != "I" .OR. SubStr(cautorizac, 7, 1) != "A")
      replace auto with Space(11)
      alert("Sistema ser  finalizado por falta de autorizaÆo da COMSIS")
      return .F.
   endif
   if (Date() > CToD(SubStr(cautorizac, 2, 2) + "/" + ;
         SubStr(cautorizac, 5, 2) + "/" + SubStr(cautorizac, 10, 2)))
      replace auto with Space(11)
      alert("Sistema ser  finalizado por falta de autorizaÆo da COMSIS")
      return .F.
   endif
   close
   return .T.

********************************
function CORES(Arg1)

   use Cores alias Cor shared readonly
   if (Arg1 = Nil)
      goto cor->numero
   else
      goto Arg1
   endif
   corlinha:= cor->corlinha
   corlinmenu:= cor->corlinmenu
   corcorpo:= cor->corcorpo
   cortitfor:= cor->cortitfor
   corfor:= cor->corfor
   corfordado:= cor->corfordado
   coropcoes:= cor->coropcoes
   close
   if (!testadata())
      return .F.
   endif
   return .T.

********************************
function DBSETORDER(Arg1)

   if (ISCHARACTER(Arg1) .AND. !Empty(Val(Arg1)))
      Arg1:= Val(Arg1)
   endif
   set order to Arg1
   return Nil

********************************
function GETACTIVE(Arg1)

   local Local1
   Local1:= Static12
   if (PCount() > 0)
      Static12:= Arg1
   endif
   return Local1

********************************
function UPDATED

   return Static6

********************************
procedure DBFNTX

   return

********************************
function SALDO

   local Local1, Local2, Local3, Local4, Local5, Local6
   Local3:= 0
   Local4:= 0
   Local1:= SaveScreen(0, 0, 24, 79)
   Local5:= 0
   Local2:= RecNo()
   goto top
   do case
   case procname(2) = "QSR3212"
      Local6:= data_mb
      do while (RecNo() != Local2)
         if (debcred_mb = "C")
            Local3:= Local3 + valor_mb
            if (confir_mb = "S")
               Local5:= Local5 + valor_mb
            endif
         else
            Local3:= Local3 - valor_mb
            if (confir_mb = "S")
               Local5:= Local5 - valor_mb
            endif
         endif
         skip 
      enddo
      if (debcred_mb = "C")
         Local3:= Local3 + valor_mb
         if (confir_mb = "S")
            Local5:= Local5 + valor_mb
         endif
      else
         Local3:= Local3 - valor_mb
         if (confir_mb = "S")
            Local5:= Local5 - valor_mb
         endif
      endif
      janela(10, 25, 14, 55, "SALDO DO DIA")
      @ 11, 27 say "Data " + DToC(Local6)
      @ 12, 27 say "Saldo"
      @ 13, 27 say "Saldo Conf."
      @ 12, 41 say Local3 picture "999,999,999.99"
      @ 13, 41 say Local5 picture "999,999,999.99"
   case procname(2) = "QSR3222"
      if (Upper(alias(1)) = "CONTASAR")
         Local6:= dt_venc_ar
         cchave:= num_doc_ar + Str(cod_cli_ar, 5)
      elseif (Upper(alias(1)) = "CONTASRE")
         Local6:= dt_rece_re
         cchave:= num_doc_re + Str(cod_cli_re, 5)
      endif
      goto top
      skip -1
      do while (RecNo() != Local2)
         if (Upper(alias(1)) = "CONTASAR")
            Local3:= Local3 + val_tit_ar
         elseif (Upper(alias(1)) = "CONTASRE")
            Local3:= Local3 + vl_rece_re
         endif
         skip 
      enddo
      if (Upper(alias(1)) = "CONTASAR")
         Local3:= Local3 + val_tit_ar
      elseif (Upper(alias(1)) = "CONTASRE")
         Local3:= Local3 + vl_rece_re
      endif
      janela(10, 25, 14, 55, "VALOR TOTAL")
      @ 11, 27 say "Data " + DToC(Local6)
      @ 12, 27 say "Total"
      @ 12, 41 say Local3 picture "999,999,999.99"
   case procname(2) = "QSR3221"
      if (Upper(alias(1)) = "CONTASAP")
         Local6:= dt_venc_ap
      elseif (Upper(alias(1)) = "CONTASPG")
         Local6:= dt_pgto_pg
      endif
      do while (RecNo() != Local2)
         if (Upper(alias(1)) = "CONTASAP")
            Local3:= Local3 + val_tit_ap
         elseif (Upper(alias(1)) = "CONTASPG")
            Local3:= Local3 + vl_pgto_pg
         endif
         skip 
      enddo
      if (Upper(alias(1)) = "CONTASAP")
         Local3:= Local3 + val_tit_ap
      elseif (Upper(alias(1)) = "CONTASPG")
         Local3:= Local3 + vl_pgto_pg
      endif
      janela(10, 25, 14, 55, "VALOR TOTAL")
      @ 11, 27 say "Data " + DToC(Local6)
      @ 12, 27 say "Total"
      @ 12, 41 say Local3 picture "999,999,999.99"
   case procname(2) = "QSR3226"
      if (Upper(alias(1)) = "CONTASAP")
         Local6:= dt_venc_ap
      elseif (Upper(alias(1)) = "CONTASPG")
         Local6:= dt_pgto_pg
      endif
      do while (RecNo() != Local2)
         if (Upper(alias(1)) = "CONTASAP")
            Local3:= Local3 + val_tit_ap
         elseif (Upper(alias(1)) = "CONTASPG")
            Local3:= Local3 + vl_pgto_pg
         endif
         skip 
      enddo
      if (Upper(alias(1)) = "CONTASAP")
         Local3:= Local3 + val_tit_ap
      elseif (Upper(alias(1)) = "CONTASPG")
         Local3:= Local3 + vl_pgto_pg
      endif
      janela(10, 25, 14, 55, "VALOR TOTAL")
      @ 11, 27 say "Data " + DToC(Local6)
      @ 12, 27 say "Total"
      @ 12, 41 say Local3 picture "999,999,999.99"
   case procname(2) = "QSR3224"
      Local6:= dt_venc_ar
      do while (RecNo() != Local2)
         Local3:= Local3 + val_tit_ar
         skip 
      enddo
      Local3:= Local3 + val_tit_ar
      janela(10, 25, 14, 55, "VALOR TOTAL")
      @ 11, 27 say "Data " + DToC(Local6)
      @ 12, 27 say "Total"
      @ 12, 41 say Local3 picture "999,999,999.99"
   case procname(2) = "QSR3242"
      Local6:= data
      do while (RecNo() != Local2)
         if (debcred = "C")
            Local3:= Local3 + valor
            if (confirmado = "S")
               Local5:= Local5 + valor
            endif
         else
            Local3:= Local3 - valor
            if (confirmado = "S")
               Local5:= Local5 - valor
            endif
         endif
         skip 
      enddo
      if (debcred = "C")
         Local3:= Local3 + valor
         if (confirmado = "S")
            Local5:= Local5 + valor
         endif
      else
         Local3:= Local3 - valor
         if (confirmado = "S")
            Local5:= Local5 - valor
         endif
      endif
      janela(10, 25, 14, 55, "SALDO DO DIA")
      @ 11, 27 say "Data " + DToC(Local6)
      @ 12, 27 say "Saldo"
      @ 13, 27 say "Saldo Conf."
      @ 12, 41 say Local3 picture "999,999,999.99"
      @ 13, 41 say Local5 picture "999,999,999.99"
   case procname(2) = "QSR3231"
      Local6:= data
      nliq:= 0
      do while (RecNo() != Local2)
         Local3:= Local3 + valor_tot
         nliq:= Local3 + valor_desc
         skip 
      enddo
      Local3:= Local3 + valor_tot
      janela(10, 25, 14, 55, "VALOR TOTAL")
      @ 11, 27 say "Data " + DToC(Local6)
      @ 12, 27 say "Total"
      @ 12, 41 say Local3 picture "999,999,999.99"
      @ 13, 27 say "Liquido"
      @ 13, 41 say nliq picture "999,999,999.99"
   case procname(2) = "QSR3244"
      Local6:= data
      nvalor2:= 0
      do while (RecNo() != Local2)
         Local3:= Local3 + val_extra
         nvalor2:= nvalor2 + val_notur
         skip 
      enddo
      Local3:= Local3 + val_extra
      nvalor2:= nvalor2 + val_notur
      janela(10, 25, 14, 55, "VALOR TOTAL")
      @ 11, 27 say "Extra...:"
      @ 12, 27 say "Noturno.:"
      @ 13, 27 say "Total...:"
      @ 11, 37 say Local3 picture "999,999.99"
      @ 12, 37 say nvalor2 picture "999,999.99"
      @ 13, 37 say Local3 + nvalor2 picture "999,999.99"
   endcase
   InKey(0)
   goto Local2
   RestScreen(0, 0, 24, 79, Local1)
   return Nil

********************************
function WINCHESTER

   private vvetor[9], hd2, hd3
   if (!file("Empresa.DBF."))
      alert("Est  faltando arquivos do sistema")
      return .F.
   endif
   run VOL > HD.TXT
   hd2:= memoread("HD.TXT")
   hd3:= SubStr(hd2, 72, 10)
   vvetor[1]:= SubStr(hd3, 1, 1)
   vvetor[2]:= SubStr(hd3, 2, 1)
   vvetor[3]:= SubStr(hd3, 3, 1)
   vvetor[4]:= SubStr(hd3, 4, 1)
   vvetor[5]:= SubStr(hd3, 5, 1)
   vvetor[6]:= SubStr(hd3, 6, 1)
   vvetor[7]:= SubStr(hd3, 7, 1)
   vvetor[8]:= SubStr(hd3, 8, 1)
   vvetor[9]:= SubStr(hd3, 9, 1)
   a:= 180
   b:= 230
   cwincheste:= Chr(Val(vvetor[1]) + a++) + Chr(Val(vvetor[2]) + ;
      b++) + Chr(Val(vvetor[3]) + a++) + Chr(Val(vvetor[4]) + b++) + ;
      Chr(Val(vvetor[5]) + a++) + Chr(Val(vvetor[6]) + b++) + ;
      Chr(Val(vvetor[7]) + a++) + Chr(Val(vvetor[8]) + b++) + ;
      Chr(Val(vvetor[9]) + a++)
   variaveis()
   if (!abredbf("EMPRESA"))
      return .F.
   endif
   nporcent:= porcent
   if (cwincheste != hd1 .AND. cwincheste != hd2)
      close
      return .F.
   elseif (cwincheste == hd1 .OR. cwincheste == hd2)
      if (Date() < data_atual)
         cmensagem:= ;
            "Verifique a data de seu computador,; porque a data do ultimo acesso ao sistema no dia " ;
            + DToC(data_atual) + ;
            "; esta maior que a data de hoje.;Apos corrigir a data ;tente outra vez acessar o sistema."
         alert(cmensagem)
         close
         return .F.
      endif
      close
      return .T.
   endif
   close
   return .F.

********************************
function __GETSETNA(Arg1)

   if (!(ISNIL(Arg1)))
      qself()[7]:= Arg1
   endif
   return qself()[7]

********************************
function READEXIT(Arg1)

   return Set(_SET_EXIT, Arg1)

********************************
function SENHA

   ccor:= SetColor()
   ctela:= SaveScreen(0, 0, 24, 79)
   ncodigo:= 0
   csenha:= ""
   lcontrole:= .T.
   n:= 0
   ha_senha()
   janela(10, 24, 17, 60, "Digite Seu Codigo e Sua Senha")
   do while (lcontrole)
      @ 11, 26 say "Usuario"
      @ 14, 26 say "Senha"
      @ 12, 26 get nCodigo picture "99999" valid valusu(ncodigo)
      read
      if (LastKey() == K_ESC)
         return .F.
      endif
      csenha:= lersenha(15, 26, .T.)
      if (!testasen(ncodigo, csenha))
         n++
         if (n >= 3)
            lcontrole:= .F.
            set color to W+*
            @ 23, 33 say "ACESSO NEGADO"
            bell2(5)
            InKey(0.1)
            loop
         else
            loop
         endif
      endif
      return .T.
      set color to (ccor)
      RestScreen(0, 0, 24, 79, ctela)
   enddo
   close databases
   select 1
   close format
   return .F.

********************************
function LERSENHA(Arg1, Arg2, Arg3)

   private csenha, ctexto, vvetor[7], ca, cb
   Arg1:= 2
   Arg2:= 1
   ctexto:= ""
   ccor2:= SetColor()
   csenha:= Space(7)
   set color to G/G,G/G
   @ 15, 26 get cSenha picture "XXXXXXX"
   read
   if (Arg3)
      vvetor[1]:= SubStr(csenha, 1, 1)
      vvetor[2]:= SubStr(csenha, 2, 1)
      vvetor[3]:= SubStr(csenha, 3, 1)
      vvetor[4]:= SubStr(csenha, 4, 1)
      vvetor[5]:= SubStr(csenha, 5, 1)
      vvetor[6]:= SubStr(csenha, 6, 1)
      vvetor[7]:= SubStr(csenha, 7, 1)
      ca:= 180
      cb:= 230
      csenha:= Chr(Val(vvetor[1]) + ca++) + Chr(Val(vvetor[2]) + ;
         cb++) + Chr(Val(vvetor[3]) + ca++) + Chr(Val(vvetor[4]) + ;
         cb++) + Chr(Val(vvetor[5]) + ca++) + Chr(Val(vvetor[6]) + ;
         cb++) + Chr(Val(vvetor[7]) + ca++)
   else
      csenha:= cvar1
   endif
   set color to (ccor2)
   return csenha

********************************
function NULO

   return .T.

********************************
function LERPORTA(Arg1)

   ctelaimp:= SaveScreen(0, 0, 24, 79)
   ccorimp:= SetColor()
   set color to (corfor)
   @  9, 20 clear to 14, 50
   @  9, 20 to 14, 50
   set color to (cortitfor)
   @  9, 25 say " Porta de ImpressÆo "
   set color to (corfordado)
   @ 12, 22 say "Porta Atual " get cPorta valid valiporta(Arg1)
   read
   RestScreen(0, 0, 24, 79, ctelaimp)
   set color to (ccorimp)
   return Arg1

********************************
function VALIPORTA(Arg1)

   local Local1[7]
   if (Upper(Arg1) != "LPT1 " .AND. Upper(Arg1) != "LPT2 " .AND. ;
         Upper(Arg1) != "LPT3 " .AND. Upper(Arg1) != "LPT4 " .AND. ;
         Upper(Arg1) != "COM1 " .AND. Upper(Arg1) != "COM2 " .AND. ;
         Upper(Arg1) != "COM3 " .AND. Upper(Arg1) != "TEXTO")
      alert("Porta Inv lida")
      return .F.
   endif
   return .T.

********************************
function ATUAVER

   if (!abredbf("VERSAO"))
      return .F.
   endif
   nnovaver:= Val(versao_qsr)
   nano:= Year(Date())
   nano:= Str(nano, 4)
   nano:= SubStr(nano, 3, 2)
   nnovaver:= Str(nnovaver, 7) + "." + nano
   nvelhver:= versao_qsr
   nvelhver:= SubStr(nvelhver, 6, 2)
   if (nano != nvelhver)
      nnovaver:= "1." + nano
   endif
   nnovaver:= Replicate(Space(1), 7 - Len(LTrim(nnovaver))) + ;
      LTrim(nnovaver)
   RLock()
   replace versao_qsr with nnovaver
   alert(nnovaver)
   close
   return .T.

********************************
function READMODAL(Arg1, Arg2)

   local Local1, Local2
   if (ISBLOCK(Static5))
      eval(Static5)
   endif
   if (Empty(Arg1))
      SetPos(MaxRow() - 1, 0)
      return .F.
   endif
   Local2:= cleargetsy()
   Static13:= procname(1)
   Static14:= procline(1)
   if (!(ISNUMBER(Arg2) .AND. Arg2 > 0))
      Arg2:= settle(Arg1, 0)
   endif
   do while (!(Arg2 == 0))
      postactive(Local1:= Arg1[Arg2])
      if (ISBLOCK(Local1:reader()))
         eval(Local1:reader(), Local1)
      else
         getreader(Local1)
      endif
      Arg2:= settle(Arg1, Arg2)
   enddo
   restoreget(Local2)
   SetPos(MaxRow() - 1, 0)
   return Static6

********************************
procedure __SETFORMA(Arg1)

   Static5:= iif(ISBLOCK(Arg1), Arg1, Nil)
   return

********************************
procedure DBFONLY

   return

********************************
function IMPEMP(Arg1, Arg2, Arg3, Arg4)

   if (!abredbf("EMPRESA"))
      return .F.
   endif
   cempresa:= nome
   cendereco:= endereco
   cfone:= "Telefax : " + telefone
   ccgc:= "CGC " + cgc + " I.Est. " + inscricao
   @ PRow(), PCol() say ""
   @ Arg1,  2 say cempresa
   @ Arg1,  2 say cempresa
   @ Arg2,  2 say ccgc
   @ Arg2,  2 say ccgc
   @ Arg3,  2 say cendereco
   @ Arg3,  2 say cendereco
   @ Arg4,  2 say cfone
   @ Arg4,  2 say cfone
   @ PRow(), PCol() say ""
   return

********************************
function INCLBCO(Arg1, Arg2, Arg3, Arg4, Arg5, Arg6)

   select 10
   if (!abredbf("MOV_BCO", "Mv_Bco1.NTX, Mv_Bco2.NTX, Mv_Bco3.NTX"))
      return .F.
   endif
   set index to Mv_Bco1, Mv_Bco2, Mv_Bco3
   if (!adiciona())
      return .F.
   endif
   if (!bloqueia())
      return .F.
   endif
   replace conta_mb with Arg1
   replace docto_mb with Arg2
   replace data_mb with Arg3
   replace histor_mb with Arg4
   replace valor_mb with Arg5
   replace debcred_mb with Arg6
   unlock
   abredbf("BANCOS", "BANCOS1.NTX")
   select Bancos
   seek Arg1
   if (!Found())
      alert("Erro na leitura de registro! Operao ser  cancelada.")
      select MOV_BCO
      delete
      close databases
      select 1
      close format
      lcontrole:= .F.
   endif
   if (!bloqueia())
      return .F.
   endif
   if (Arg6 = "C")
      replace saldo_bc with saldo_bc + Arg5
   else
      replace saldo_bc with saldo_bc - Arg5
   endif
   close
   return

********************************
procedure GETREADER(Arg1)

   if (getprevali(Arg1))
      Arg1:setfocus()
      do while (Arg1:exitstate() == 0)
         if (Arg1:typeout())
            Arg1:exitstate(5)
         endif
         do while (Arg1:exitstate() == 0)
            getapplyke(Arg1, InKey(0))
         enddo
         if (!getpostval(Arg1))
            Arg1:exitstate(0)
         endif
      enddo
      Arg1:killfocus()
   endif
   return

********************************
static procedure POSTACTIVE(Arg1)

   getactive(Arg1)
   readvar(getreadvar(Arg1))
   showscoreb()
   return

********************************
procedure GRAFV1(Arg1, Arg2, Arg3, Arg4, Arg5)

   ccor2:= SetColor()
   set color to (coropcoes)
   ctgv1:= SaveScreen(0, 0, 24, 79)
   clear screen
   clear gets
   Arg2:= iif(Arg2 = Nil, .F., .T.)
   tam:= Len(Arg1)
   larg:= 60 / tam
   m1:= {"Û", "Û", "Û", "Û", "Û", "Û", "Û", "Û", "Û", "Û", "Û", "Û"}
   porc:= t:= 0
   for i:= 1 to tam
      porc:= iif(porc <= Arg1[i][1], Arg1[i][1], porc)
   next
   escala:= porc / 5
   porc1:= porc
   num:= num1:= num2:= 0
   for num:= 1 to 21 step 4
      @ num,  0 say Str(porc, 6)
      porc:= porc - escala
   next
   for i:= 1 to 20
      @ i,  7 say "³"
   next
   @ i,  7 say "À" + Replicate("Ä", 72)
   t:= 8 - larg
   for i:= 1 to tam
      @ 22, t + larg + 1 say Left(Arg1[i][2], larg)
      pos:= Int(Arg1[i][1] * 20 / porc1)
      bar:= 20 - pos + 1
      for j:= 20 to bar step -1
         @ j, t + larg + 1 say Replicate(m1[i], larg)
      next
      if (Arg2 = .T.)
         @ bar, t + larg + larg / 2 say Str(Arg1[i][1], 6)
      endif
      t:= t + larg + 1
   next
   if (Arg3 != Nil)
      posini:= (80 - Len(Arg3)) / 2
      @ 23, posini say Arg3
   endif
   if (Arg4 != Nil)
      posini:= (80 - Len(Arg4)) / 2
      @ 24, posini say Arg4
   endif
   if (Arg5 != Nil)
      posini:= (80 - Len(Arg5)) / 2
      @  0, posini say Arg5
   endif
   lcontrole:= .T.
   do while (lcontrole)
      ntecla:= InKey(0)
      if (ntecla == 27)
         lcontrole:= .F.
      endif
   enddo
   lcontrole:= .T.
   set color to (ccor2)
   RestScreen(0, 0, 24, 79, ctgv1)

********************************
function READVAR(Arg1)

   local Local1
   Local1:= Static4
   if (ISCHARACTER(Arg1))
      Static4:= Arg1
   endif
   return Local1

********************************
function __ATPROMPT(Arg1, Arg2, Arg3, Arg4)

   AAdd(Static3, {Arg1, Arg2, Arg3, Arg4})
   SetPos(Arg1, Arg2)
   dispout(Arg3)
   return .F.

********************************
procedure EDITAR(Arg1, Arg2, Arg3, Arg4, Arg5)

   private b, coluna, tipo, n
   private cores, cursor, ini_arq
   private mais, tk, adiciona
   save screen to tela
   @ Arg2, Arg3 clear to Arg4, Arg5
   moldura(Arg2, Arg3, Arg4, Arg5)
   @ Arg2, Arg3 to Arg4, Arg5 double
   set color to (corlinmenu)
   @ 23, 24 say "[F6] Pesquisa  [Esc] Finaliza"
   set color to GB/N,W+/N
   if (ValType(Arg1) != "U")
      select (Arg1)
   endif
   set color to (corfordado)
   goto top
   ini_arq:= RecNo()
   b:= tbrowsedb(Arg2 + 1, Arg3 + 1, Arg4 - 1, Arg5 - 1)
   b:headsep("ÂÄ")
   b:colsep("³")
   b:skipblock({|_1| muda(_1, adiciona)})
   b:colorspec("W/B,W+/RB,,,W/RB")
   i:= 1
   do while (Len(FieldName(i)) != 0)
      coluna:= tbcolumnne(FieldName(i), fieldwbloc(FieldName(i), ;
         Select()))
      coluna:defcolor({1, 2})
      b:addcolumn(coluna)
      i++
   enddo
   cursor:= setcursor(0)
   adiciona:= .F.
   mais:= .T.
   do while (mais)
      if (b:colpos() <= b:freeze())
         b:colpos(b:freeze() + 1)
      endif
      do while (!b:stabilize())
         tk:= InKey()
         if (tk != 0)
            exit
         endif
      enddo
      if (b:stable())
         if (b:hitbottom() .AND. !adiciona)
            adiciona:= .F.
            tone(250, 1)
         elseif (b:hittop() .OR. b:hitbottom())
            tone(125, 0)
            skip 
         endif
         tk:= InKey(0)
      endif
      do case
      case tk == -5
         set order to 2
         vnom:= Space(40)
         vrec:= RecNo()
         setcursor(1)
         set color to N/GR
         @ 23, 10 say "Nome desejado:    "
         objget:= getnew()
         objget:row(23)
         objget:col(26)
         objget:name("vnom")
         objget:block({|_1| iif(PCount() > 0, vnom:= _1, vnom)})
         objget:picture("@!")
         objget:colorspec(corfordado)
         objget:postblock({|_1| !Empty(_1)})
         ReadModal({objget})
         @ 23,  1 clear to 23, 78
         setcursor(0)
         set softseek on
         seek vnom
         set softseek off
         if (EOF())
            goto vrec
         endif
         adiciona:= .F.
         do while (!b:stabilize())
         enddo
         b:refreshall()
         set color to (corlinmenu)
         @ 23, 24 say "[F6] Pesquisa [Esc] Finaliza"
      case tk == 24
         b:down()
      case tk == 5
         if (RecNo() != ini_arq)
            b:up()
         else
            tone(250, 1)
         endif
      case tk == 3
         b:pagedown()
      case tk == 18
         b:pageup()
         if (adiciona)
            adiciona:= .F.
            b:refreshall()
         endif
      case tk == 31
         b:gotop()
         adiciona:= .F.
      case tk == 30
         b:gobottom()
         adiciona:= .F.
      case tk == 4
         b:right()
      case tk == 19
         b:left()
      case tk == 1
         b:home()
      case tk == 6
         b:end()
      case tk == 26
         b:panleft()
      case tk == 2
         b:panright()
      case tk == 29
         b:panhome()
      case tk == 23
         b:panend()
      case tk == 27
         restore screen from tela
         mais:= .F.
      case tk == 13
         edit1(b, .T.)
      endcase
   enddo
   setcursor(cursor)
   set color to (corfordado)
   return

********************************
function PULA411(Arg1)

   if (Arg1 > nalturafor)
      rodape(nalturafor, .F., 134)
      npagina++
      Arg1:= 6
      eject
      @  0,  0 say "C" + Chr(nlinform)
      @  0,  0 say ""
      @  1,  1 say "" + cnomemp + ""
      @  1,  1 say ""
      @  2,  1 say ccabecalho
      @  3,  1 say "Vendedor " + cnomevend
      @  4,  1 say ccoluna
      @  5,  1 say clinha
   endif
   return Arg1

********************************
function EDIT1(Arg1, Arg2)

   local Local1, Local2, Local3, Local4, Local5, Local6
   do while (!Arg1:stabilize())
   enddo
   Local2:= Set(_SET_SCOREBOARD, .F.)
   Local3:= Set(_SET_EXIT, .T.)
   Local1:= SetKey(K_INS)
   SetKey(K_INS, {|| setcursor(iif(readinsert(!readinsert()), 1, 2))})
   setcursor(iif(readinsert(), 2, 1))
   Local4:= Arg1:getcolumn(Arg1:colpos())
   Local5:= getnew(Row(), Col(), Local4:block(), Local4:heading(), ;
      Nil, Arg1:colorspec())
   ReadModal({Local5})
   setcursor(0)
   set scoreboard (Local2)
   Set(_SET_EXIT, Local3)
   SetKey(K_INS, Local1)
   Arg1:refreshcur()
   Local6:= LastKey()
   if (Local6 == 5 .OR. Local6 == 24 .OR. Local6 = 18 .OR. Local6 == ;
         3)
      keyboard Chr(Local6)
   endif
   return Nil

********************************
function DIASEM(Arg1, Arg2, Arg3, Arg4, Arg5)

   if (Empty(Arg1))
      return .F.
   endif
   private vdia[7]
   ccor1:= SetColor()
   set color to (Arg4)
   vdia[1]:= "DOM"
   vdia[2]:= "Seg"
   vdia[3]:= "Ter"
   vdia[4]:= "Qua"
   vdia[5]:= "Qui"
   vdia[6]:= "Sex"
   vdia[7]:= "Sab"
   if (DoW(Arg1) == 1)
      @ Arg2, Arg3 say vdia[DoW(Arg1)] color "R+/B"
   else
      @ Arg2, Arg3 say vdia[DoW(Arg1)]
      cdia:= vdia[DoW(Arg1)]
   endif
   cdia:= vdia[DoW(Arg1)]
   set color to (ccor1)
   return .T.

********************************
function __DBLOCATE(Arg1, Arg2, Arg3, Arg4, Arg5)

   local Local1
   if (ISNIL(Arg2))
      Arg2:= {|| .T.}
   else
      Arg5:= .T.
   endif
   if (ISNIL(Arg1) .OR. ValType(Arg1) != "B")
      Arg1:= {|| .T.}
   endif
   default Arg5 to .F.
   __dbsetloc(Arg1)
   if (Arg4 != Nil)
      goto Arg4
      Local1:= !EOF() .AND. eval(Arg2) .AND. eval(Arg1)
   elseif (Arg3 != Nil)
      Local1:= .F.
      do while (!EOF() .AND. Arg3-- > 0 .AND. eval(Arg2) .AND. ;
            !(Local1:= eval(Arg1)))
         skip 
      enddo
   elseif (Arg5)
      Local1:= .F.
      do while (!EOF() .AND. eval(Arg2) .AND. !(Local1:= eval(Arg1)))
         skip 
      enddo
   else
      goto top
      do while (!EOF() .AND. !(Local1:= eval(Arg1)))
         skip 
      enddo
   endif
   __dbsetfou(Local1)
   return Nil

********************************
function READINSERT(Arg1)

   return Set(_SET_INSERT, Arg1)

********************************
function __TADDCOLU(Arg1)

   AAdd(qself()[6], Arg1)
   qself():configure(2)
   return qself()

********************************
function IMPRIPED(Arg1, Arg2, Arg3)

   if (impressora() == 1)
      select 1
      if (!abredbf("EMPRESA"))
         return .F.
      endif
      if (cnoorcfic = "S")
         norc:= n_orc_fic + 1
         if (!bloqueia())
            return .F.
         endif
         replace n_orc_fic with norc
         unlock
      endif
      cfrase1:= frase_1
      cfrase2:= frase_2
      close
      nvaltot:= 0
      nnoviasimp:= 0
      nvias:= nviasped
      close databases
      select 1
      close format
      mostrar("*** Imprimindo ****")
      select 1
      if (!abredbf("PEDIDOS", "PEDIDOS1.NTX"))
         return .F.
      endif
      select 2
      if (!abredbf("PED_MAT", "PED_MAT.NTX"))
         return .F.
      endif
      select 3
      if (!abredbf("PRODUTOS", "PRODUTO1.NTX"))
         return .F.
      endif
      select 4
      if (!abredbf("CLIENTES", "CLIENTE1.NTX"))
         return .F.
      endif
      select 5
      if (!abredbf("FUNCIONA", "FUNCION1.NTX"))
         return .F.
      endif
      do while (nnoviasimp != nvias)
         lin:= 6
         npt:= 0
         vtt:= 0
         pag:= 0
         tot:= 0
         cli:= 0
         select 1
         seek Arg1
         if (Found())
            set device to printer
            drvimpr:= cportaped
            set printer to (drvimpr)
            @ PRow(), PCol() say "C" + Chr(nlinform)
            cv:= vendedor
            nr:= numero
            cc:= cliente
            vtt:= valor_tot
            npt:= 0
            vlr:= valor_tot
            ncodcli:= cliente
            ncodvend:= vendedor
            cavista:= form_pgto
            cnomcli:= nome_cli
            ndesc:= valor_desc
            nacresc:= acrescimo
            nloja:= loja
            naliq:= desconto
            if (ncodcli != 1)
               select 4
               set order to 1
               seek ncodcli
               if (Found())
                  cnomecli:= nome_cli
                  cenderecli:= endere_cli
                  cpessoa:= pessoa_cli
                  cbairrocli:= bairro_cli
                  ccidadecli:= cidade_cli
                  cestadocli:= estado_cli
                  ccepcli:= cep_cli
                  cfonecli:= fone_cli
                  ccompracli:= compra_cli
                  cfonecom:= fone_com
                  cobs1:= obs1
                  cobs2:= obs2
                  ccpf:= cpf_cli
                  cci:= identi_cli
                  ccgc:= cgc_cli
                  cinsc:= insc_cli
               else
                  cnomecli:= "*** Cliente Nao Cadastrado ***"
                  cpessoa:= " "
                  cenderecli:= " "
                  cbairrocli:= " "
                  ccidadecli:= " "
                  cestadocli:= " "
                  ccepcli:= " "
                  cfonecli:= " "
                  ccompracli:= " "
                  cfonecom:= " "
                  cobs1:= " "
                  cobs2:= " "
                  ccpf:= " "
                  cci:= " "
                  ccgc:= " "
                  cinsc:= " "
               endif
            else
               select 1
               cnomecli:= cnomcli
               cpessoa:= "F"
               ccpf:= "  "
               ccgc:= "  "
               cenderecli:= "  "
               cbairrocli:= "  "
               ccidadecli:= "  "
               cestadocli:= "  "
               ccepcli:= "  "
               cfonecli:= "  "
               ccompracli:= " "
               cfonecom:= " "
               cobs1:= " "
               cobs2:= " "
            endif
            select 5
            seek ncodvend
            if (EOF())
               cnomevend:= "*** Vendedor Nao Cadastrado ***"
            else
               cnomevend:= nome
            endif
            select 1
            cabped()
            select 2
            seek Arg1
            do while (!EOF() .AND. numero_ped = Arg2)
               if (lin > nalturafor)
                  select Pedidos
                  cabped()
                  select Ped_Mat
               endif
               cm:= codigo_mat
               select 3
               seek cm
               if (EOF())
                  nm:= "*** Material Nao Incluso ***"
                  cmarca:= "******"
               else
                  nm:= descricao
                  cmarca:= marca
               endif
               select 2
               npt:= quantidade * valor
               vldesc:= valor - valor * naliq / 100
               itdesc:= vldesc * quantidade
               ctamanho:= tamanho
               @ lin,  1 say cm + " " + SubStr(nm, 1, 36)
               @ lin, 44 say ctamanho
               @ lin, 56 say quantidade picture "99999"
               if (Arg3 != Nil)
                  if (Arg3 = "S")
                     @ lin, 62 say valor picture "99999.99"
                     @ lin, 72 say npt picture "99999.99"
                  endif
               endif
               lin++
               skip 
            enddo
            select 1
            skip 
         endif
         @ lin,  0 say Replicate("-", 80)
         @ lin + 1, 46 say "Valor Total...:"
         @ lin + 1, 66 say vtt picture "999,999,999.99"
         @ lin + 2, 46 say "Desconto......:"
         @ lin + 2, 66 say vtt - ndesc picture "999,999,999.99"
         @ lin + 3, 46 say "Total Liquido.:"
         @ lin + 3, 66 say ndesc picture "999,999,999.99"
         @ lin + 5,  1 say cfrase1
         @ lin + 6,  1 say cfrase2
         if (ccabped = "1" .OR. ccabped = "2")
            @ lin + 9, 10 say Replicate("-", 52)
            @ lin + 10, 10 say ncodcli
            @ lin + 10, 16 say "- " + cnomcli
            if (ccabped = "2")
               @ lin + 11, 10 say cenderecli + " " + cbairrocli
               @ lin + 12, 10 say ccidadecli + " " + cestadocli + ;
                  " " + ccepcli + " " + cfonecli
               @ lin + 13, 10 say ccompracli + " " + cfonecom
            endif
         endif
         select 1
         set device to screen
         nnoviasimp++
         eject
         nvaltot:= 0
      enddo
      close databases
      select 1
      close format
   else
      return
   endif

********************************
static function SETTLE(Arg1, Arg2)

   local Local1
   if (Arg2 == 0)
      Local1:= 2
   else
      Local1:= Arg1[Arg2]:exitstate()
   endif
   if (Local1 == 7 .OR. Local1 == 6)
      return 0
   endif
   if (!(Local1 == 8))
      Static11:= Arg2
      Static8:= .F.
      Static9:= .F.
   else
      Local1:= Static10
   endif
   do case
   case Local1 == 1
      Arg2--
   case Local1 == 2
      Arg2++
   case Local1 == 3
      Arg2:= 1
      Static8:= .T.
      Local1:= 2
   case Local1 == 4
      Arg2:= Len(Arg1)
      Static9:= .T.
      Local1:= 1
   case Local1 == 5
      Arg2++
   endcase
   if (Arg2 == 0)
      if (!readexit() .AND. !Static9)
         Static8:= .T.
         Arg2:= Static11
         Local1:= 2
      endif
   elseif (Arg2 == Len(Arg1) + 1)
      if (!readexit() .AND. !(Local1 == 5) .AND. !Static8)
         Static9:= .T.
         Arg2:= Static11
         Local1:= 1
      else
         Arg2:= 0
      endif
   endif
   Static10:= Local1
   if (!(Arg2 == 0))
      Arg1[Arg2]:exitstate(Local1)
   endif
   return Arg2

********************************
static procedure RESTOREGET(Arg1)

   Static7:= Arg1[1]
   Static8:= Arg1[2]
   Static9:= Arg1[3]
   Static10:= Arg1[4]
   Static11:= Arg1[5]
   getactive(Arg1[6])
   readvar(Arg1[7])
   Static13:= Arg1[8]
   Static14:= Arg1[9]
   return

********************************
procedure CABPED

   lin:= 0
   if (ccabped = "1")
      @ lin,  0 say "Orcamento"
      @ lin,  0 say "Orcamento"
      lin++
      @ lin,  0 say Replicate("-", 80)
      lin++
   elseif (ccabped = "2")
      @ lin,  0 say "" + cempresa + ""
      @ lin,  0 say "" + cempresa + ""
      lin++
      @ lin,  0 say "Pedido de Venda/Servico"
      @ lin,  0 say "Pedido de Venda/Servico"
      lin++
      @ lin,  0 say Replicate("-", 80)
      lin++
   elseif (ccabped = "3")
      @ lin + 0,  0 say "Orcamento"
      @ lin + 1,  0 say ncodcli
      @ lin + 1,  6 say "- " + cnomcli
      @ lin + 1,  0 say ncodcli
      @ lin + 1,  6 say "- " + cnomcli
      @ lin + 2,  0 say cenderecli + " BAIRRO.: " + cbairrocli
      @ lin + 3,  0 say ccidadecli + " " + cestadocli + " CEP.:" + ;
         ccepcli + " FONE.:" + cfonecli
      @ lin + 4,  0 say "Comp.: " + ccompracli + " " + cfonecom
      if (cpessoa = "F")
         @ lin + 5,  0 say "CPF..: " + ccpf
      else
         @ lin + 5,  0 say "CGC..: " + ccgc + "  Insc.Est...: " + ;
            cinsc
      endif
      @ lin + 6,  0 say Replicate("-", 80)
      lin:= lin + 7
   endif
   if (cnoorcfic = "S")
      if (ccabped = "3")
         @ lin,  1 say "Data..: " + DToC(data) + ;
            "                Vendedor:" + Str(ncodvend, 4) + " " + ;
            cnomevend
      else
         @ lin,  1 say "Data..: " + DToC(data) + "  Numero " + ;
            Str(norc, 5) + "  Vendedor.:" + Str(ncodvend, 4) + " " + ;
            cnomevend
      endif
   elseif (ccabped = "3")
      @ lin,  1 say "Data..: " + DToC(data) + "  " + "Desc.: " + ;
         Str(desconto, 5, 2) + "  " + "Vendedor.:" + Str(ncodvend, ;
         4) + " " + cnomevend
   else
      @ lin,  1 say "Data..: " + DToC(data) + "  Numero " + ;
         Str(numero, 5) + "  Vendedor.:" + Str(ncodvend, 4) + " " + ;
         cnomevend
   endif
   lin++
   if (cavista = "V")
      @ lin,  1 say "Condiäes.: A vista"
   else
      @ lin,  1 say "Condiäes.: A prazo"
   endif
   @ lin, 25 say "Obs.:"
   @ lin, 30 say observacao
   lin++
   @ lin,  0 say Replicate("-", 80)
   lin++
   @ lin,  0 say ;
      "Cod.  Descricao                             Tam        Quant.   V.Unit.  V.Total   Liquido   Tot.Liq"
   lin++
   return

********************************
function STRZERO(Arg1, Arg2, Arg3)

   local Local1
   if (PCount() == 3)
      Local1:= Str(Arg1, Arg2, Arg3)
   elseif (PCount() == 2)
      Local1:= Str(Arg1, Arg2)
   else
      Local1:= Str(Arg1)
   endif
   if ("-" $ Local1)
      return "-" + Replicate("0", Len(Local1) - Len(LTrim(Local1))) ;
         + SubStr(Local1, At("-", Local1) + 1)
   endif
   return Replicate("0", Len(Local1) - Len(LTrim(Local1))) + ;
      LTrim(Local1)

********************************
function __TSETCOLU(Arg1, Arg2)

   if (!(ISNIL(Arg1)) .AND. !(ISNIL(Arg2)))
      Arg1:= _einstvar(qself(), "COLUMN", Arg1, "N", 1001)
      qself()[6][Arg1]:= _einstvar(qself(), "COLUMN", Arg2, "O", 1001)
      qself():configure(2)
   endif
   return qself()

********************************
function __TSETRTOP(Arg1)

   if (!(ISNIL(Arg1)))
      qself()[2]:= _einstvar(qself(), "NTOP", Arg1, "N", 1001, 0, Nil)
      qself():configure(2)
   endif
   return qself()[2]

********************************
function __TSETRLEF(Arg1)

   if (!(ISNIL(Arg1)))
      qself()[3]:= _einstvar(qself(), "NLEFT", Arg1, "N", 1001, 0, ;
         Nil)
      qself():configure(2)
   endif
   return qself()[3]

********************************
function __TSETRBOT(Arg1)

   if (!(ISNIL(Arg1)))
      qself()[4]:= _einstvar(qself(), "NBOTTOM", Arg1, "N", 1001, ;
         qself():ntop(), Nil)
      qself():configure(2)
   endif
   return qself()[4]

********************************
function __TSETRRIG(Arg1)

   if (!(ISNIL(Arg1)))
      qself()[5]:= _einstvar(qself(), "NRIGHT", Arg1, "N", 1001, ;
         qself():nleft(), Nil)
      qself():configure(2)
   endif
   return qself()[5]

********************************
function __TSETCOLS(Arg1)

   if (!(ISNIL(Arg1)))
      qself()[8]:= _einstvar(qself(), "COLSEP", Arg1, "C", 1001)
   endif
   return qself()[8]

********************************
function IMPRICONS(Arg1)

   if (impressora() == 1)
      close databases
      select 1
      close format
      mostrar("**** Imprimindo ****")
      nvaltot:= 0
      i:= 0
      vias:= nviascons
      ncont:= 0
      do while (.T.)
         select 1
         use Consigna shared readonly index Consign1
         if (ncont > 3)
            alert("Ateno!; Erro na abertura de arquivo.;Opero ser  cancelada.")
            return .F.
         endif
         if (neterr())
            InKey(2)
            ncont++
            loop
         else
            exit
         endif
      enddo
      ncont:= 0
      do while (.T.)
         select 2
         use Con_Mat shared index Con_Mat
         if (ncont > 3)
            alert("Ateno!; Erro na abertura de arquivo.;Opero ser  cancelada.")
            return .F.
         endif
         if (neterr())
            InKey(2)
            ncont++
            loop
         else
            exit
         endif
      enddo
      ncont:= 0
      do while (.T.)
         select 3
         use Produtos shared readonly index Produto1
         if (ncont > 3)
            alert("Ateno!; Erro na abertura de arquivo.;Opero ser  cancelada.")
            return .F.
         endif
         if (neterr())
            InKey(2)
            ncont++
            loop
         else
            exit
         endif
      enddo
      ncont:= 0
      do while (.T.)
         select 4
         use CLIENTES index CLIENTE1
         if (ncont > 3)
            alert("Ateno!; Erro na abertura de arquivo.;Opero ser  cancelada.")
            return .F.
         endif
         if (neterr())
            InKey(2)
            ncont++
            loop
         else
            exit
         endif
      enddo
      ncont:= 0
      do while (.T.)
         select 5
         use FUNCIONA index FUNCION1
         if (ncont > 3)
            alert("Ateno!; Erro na abertura de arquivo.;Opero ser  cancelada.")
            return .F.
         endif
         if (neterr())
            InKey(2)
            ncont++
            loop
         else
            exit
         endif
      enddo
      select 1
      do while (vias != i)
         lin:= 6
         npt:= 0
         vtt:= 0
         pag:= 0
         tot:= 0
         cli:= 0
         seek Arg1
         if (Found())
            set device to printer
            drvimpr:= cportaped
            set printer to (drvimpr)
            @ PRow(), PCol() say "C" + Chr(nlinform)
            cv:= vendedor
            nr:= numero
            cc:= cliente
            ncodcli:= cliente
            vtt:= valor_tot
            npt:= 0
            vlr:= valor_tot
            ncodvend:= vendedor
            nmattot:= 0
            select 4
            seek ncodcli
            if (Found())
               cc1:= nome_cli
               ddt_act:= dt_acerto
               cenderecli:= endere_cli
               cbairrocli:= bairro_cli
               ccidadecli:= cidade_cli
               cestadocli:= estado_cli
               ccepcli:= cep_cli
               cfonecli:= fone_cli
               ccompracli:= compra_cli
               cfonecom:= fone_com
               cobs1:= obs1
               cobs2:= obs2
            else
               cc1:= " *** Cliente Nao Cadastrado ***"
               ddt_act:= CToD("  /  /  ")
               cenderecli:= " "
               cbairrocli:= " "
               ccidadecli:= " "
               cestadocli:= " "
               ccepcli:= " "
               cfonecli:= " "
               ccompracli:= " "
               cfonecom:= " "
               cobs1:= " "
               cobs2:= " "
            endif
            select 5
            seek ncodvend
            if (EOF())
               nc:= "*** Vendedor Nao Cadastrado ***"
            else
               nc:= nome
            endif
            select 1
            cabcons()
            select 2
            seek nr
            do while (!EOF() .AND. numero_ped = nr)
               if (lin > nalturafor)
                  eject
                  cabcons()
               endif
               cm:= codigo_mat
               select 3
               seek cm
               if (EOF())
                  nm:= "*** Material Nao Incluso ***"
               else
                  nm:= descricao
               endif
               select 2
               npt:= quantidade * valor
               nmattot:= nmattot + quantidade
               @ lin,  1 say cm + " " + SubStr(nm, 1, 33) + " " + ;
                  Str(quantidade, 4) + "    " + Str(valor) + "  " + ;
                  Str(npt)
               lin++
               if (cm = "00000")
                  if (lin > nalturafor)
                     lin:= 5
                     @ lin, 56 say "Valor total..:"
                     @ lin, 64 say vtt picture "999,999,999.99"
                  endif
                  @ lin, 10 say descricao
                  lin++
               endif
               skip 
            enddo
            select 1
            skip 
         endif
         @ lin,  0 say Replicate("-", 80)
         @ lin + 1, 10 say "Total de Mercadorias:"
         @ lin + 1, 33 say nmattot
         @ lin + 1, 50 say "Valor total..:"
         @ lin + 1, 64 say vlr picture "999,999,999.99"
         @ lin + 5, 10 say Replicate("-", 52)
         @ lin + 6, 12 say Str(ncodcli, 5) + "  -  " + cc1
         if (ccabped = "2" .OR. ccabped = "3")
            @ lin + 11, 10 say cenderecli + " " + cbairrocli
            @ lin + 12, 10 say ccidadecli + " " + cestadocli + " " + ;
               ccepcli + " " + cfonecli
            @ lin + 13, 10 say "Comp.:" + ccompracli + "  " + cfonecom
         endif
         eject
         set device to screen
         i++
         nvaltot:= 0
      enddo
      return .T.
   endif
   close databases
   select 1
   close format
   return .F.

********************************
static function ERRORMESSA(Arg1)

   local Local1
   Local1:= iif(Arg1:severity() > 1, "Error ", "Warning ")
   if (ISCHARACTER(Arg1:subsystem()))
      Local1:= Local1 + Arg1:subsystem()
   else
      Local1:= Local1 + "???"
   endif
   if (ISNUMBER(Arg1:subcode()))
      Local1:= Local1 + ("/" + LTrim(Str(Arg1:subcode())))
   else
      Local1:= Local1 + "/???"
   endif
   if (ISCHARACTER(Arg1:descriptio()))
      Local1:= Local1 + ("  " + Arg1:descriptio())
   endif
   if (!Empty(Arg1:filename()))
      Local1:= Local1 + (": " + Arg1:filename())
   elseif (!Empty(Arg1:operation()))
      Local1:= Local1 + (": " + Arg1:operation())
   endif
   return Local1

********************************
function __GETSETPR(Arg1)

   if (!(ISNIL(Arg1)))
      qself()[5]:= Arg1
   endif
   return qself()[5]

********************************
function __GETSETSU(Arg1)

   if (!(ISNIL(Arg1)))
      qself()[2]:= Arg1
   endif
   return qself()[2]

********************************
function __TCARGO

   return qself()[1]

********************************
procedure CABCONS

   lin:= 0
   if (ccabped = "1" .OR. ccabped = "3")
      @ lin,  0 say "Pedido de Consignacao"
      @ lin,  0 say "Pedido de Consignacao"
      lin++
      @ lin,  0 say Replicate("-", 80)
      @ lin,  0 say Replicate("-", 80)
      lin++
      @ lin,  1 say "Data..:" + DToC(data) + "  Numero" + ;
         Str(numero, 4) + "  Vendedor.:" + Str(vendedor, 4) + " " + nc
      @ lin,  1 say "Data..:" + DToC(data) + "  Numero" + ;
         Str(numero, 4) + "  Vendedor.:" + Str(vendedor, 4) + " " + nc
      lin++
      @ lin,  1 say "Data do Acerto : " + DToC(ddt_act) + " Ob:" + ;
         observacao
      @ lin,  1 say "Data do Acerto : " + DToC(ddt_act) + " Ob:" + ;
         observacao
      lin++
      @ lin,  0 say Replicate("-", 80)
      @ lin,  0 say Replicate("-", 80)
      lin++
      @ lin,  1 say ;
         "Cod.  Descricao                       Quant.           V.Unit.        V.Total"
      lin++
   elseif (ccabped = "2")
      @ lin,  0 say "" + cempresa + ""
      @ lin,  0 say "" + cempresa + ""
      lin++
      @ lin,  0 say "Ordem de Servio"
      @ lin,  0 say "Ordem de Servio"
      lin++
      @ lin,  0 say Replicate("-", 80)
      lin++
      @ lin,  1 say "Data..:" + DToC(data) + "  Numero" + ;
         Str(numero, 4) + "  Vendedor.:" + Str(vendedor, 4) + " " + nc
      lin++
      @ lin,  1 say "Data do Acerto : " + DToC(ddt_act) + " Ob:" + ;
         observacao
      lin++
      @ lin,  0 say Replicate("-", 80)
      lin++
      @ lin,  1 say ;
         "Cod.  Descricao                       Quant.           V.Unit.        V.Total"
      lin++
   endif
   return

********************************
procedure IMPCONTASR(Arg1)

   ncont:= 0
   do while (.T.)
      select 2
      use ContasRE shared readonly index ContRE2
      if (ncont > 3)
         alert("Erro na abertura de arquivo! Operao ser  cancelada.")
         lcontrole:= .F.
      endif
      if (neterr())
         InKey(2)
         ncont++
         loop
      else
         exit
      endif
   enddo
   select 2
   seek Arg1
   if (Found())
      cimpcab:= "S"
      ncont:= 0
      do while (cod_cli_re = Arg1)
         skip 
      enddo
      skip -1
      do while (cod_cli_re = Arg1)
         if (ncont >= nnumtitulo .AND. nnumtitulo != 0)
            skip -1
            loop
         endif
         if (cimpcab = "S")
            @ nlinha,  1 say ccoluna3
            nlinha++
            cimpcab:= "N"
         endif
         ctipo:= tip_doc_re
         ddt_venc:= dt_venc_re
         nval_tit:= val_tit_re
         cnumdoc:= num_doc_re
         ddt_pgto:= dt_rece_re
         nval_pgto:= vl_rece_re
         @ nlinha,  1 say ctipo
         @ nlinha, 13 say cnumdoc
         @ nlinha, 27 say ddt_venc
         @ nlinha, 40 say nval_tit
         @ nlinha, 55 say ddt_pgto
         @ nlinha, 65 say nval_pgto
         ncont++
         skip -1
         nlinha++
         nlinha:= pula411(nlinha)
      enddo
   endif
   select Clientes
   return

********************************
function __SETCENTU(Arg1)

   local Local1, Local2, Local3, Local4, Local5
   Local2:= Upper(Set(_SET_DATEFORMAT))
   Local1:= "YYYY" $ Local2
   if (ISCHARACTER(Arg1))
      Arg1:= Upper(Arg1) = "ON"
   endif
   if (ISLOGICAL(Arg1) .AND. Arg1 != Local1)
      Local5:= At("Y", Local2)
      Local3:= SubStr(Local2, 1, Local5 - 1)
      do while (SubStr(Local2, Local5, 1) == "Y")
         Local5++
      enddo
      Local4:= SubStr(Local2, Local5)
      set date format to Local3 + iif(Arg1, "YYYY", "YY") + Local4
   endif
   return Local1

********************************
function __GETSETBU(Arg1)

   return iif(Len(qself()) == 13, qself()[12]:= Arg1, Arg1)

********************************
function __GETUNDO

   if (Len(qself()) == 13)
      qself():varput(qself()[13])
      qself():reset()
      qself():changed(.F.)
   endif
   return qself()

********************************
function IMPRIDEV(Arg1)

   if (LastKey() == K_ESC)
      return .F.
   endif
   if (impressora() == 1)
      nvaltot:= 0
      nnoviasimp:= 0
      nvias:= nviasdev
      nnoviasimp:= 0
      close databases
      select 1
      close format
      mostrar("*** Imprimindo ****")
      ncont:= 0
      do while (.T.)
         select 1
         use DEVOLUCA shared index DEVOLUC1
         set order to 1
         if (ncont > 3)
            alert("ATENO !;Erro na abertura de arquivo.;Operao ser  cancelada.")
            return Nil
         endif
         if (neterr())
            InKey(2)
            ncont++
            loop
         else
            exit
         endif
      enddo
      ncont:= 0
      do while (.T.)
         select 2
         use DEV_MAT shared readonly index DEV_MAT
         if (ncont > 3)
            alert("ATENO !;Erro na abertura de arquivo.;Operao ser  cancelada.")
            return Nil
         endif
         if (neterr())
            InKey(2)
            ncont++
            loop
         else
            exit
         endif
      enddo
      ncont:= 0
      do while (.T.)
         select 3
         use Produtos shared readonly index Produto1
         if (ncont > 3)
            alert("ATENO !;Erro na abertura de arquivo.;Operao ser  cancelada.")
            return Nil
         endif
         if (neterr())
            InKey(2)
            ncont++
            loop
         else
            exit
         endif
      enddo
      ncont:= 0
      do while (.T.)
         select 4
         use CLIENTES shared readonly index CLIENTE1
         if (ncont > 3)
            alert("ATENO !;Erro na abertura de arquivo.;Operao ser  cancelada.")
            return Nil
         endif
         if (neterr())
            InKey(2)
            ncont++
            loop
         else
            exit
         endif
      enddo
      ncont:= 0
      do while (.T.)
         select 5
         use FUNCIONA shared readonly index FUNCION1
         if (ncont > 3)
            alert("ATENO !;Erro na abertura de arquivo.;Operao ser  cancelada.")
            return Nil
         endif
         if (neterr())
            InKey(2)
            ncont++
            loop
         else
            exit
         endif
      enddo
      do while (nnoviasimp != nvias)
         lin:= 6
         npt:= 0
         vtt:= 0
         pag:= 0
         tot:= 0
         cli:= 0
         select 1
         seek Arg1
         if (Found())
            set device to printer
            drvimpr:= cportaped
            set printer to (drvimpr)
            @ PRow(), PCol() say "C" + Chr(nlinform)
            cv:= vendedor
            nr:= numero
            cc:= cliente
            ncodcli:= cliente
            vtt:= valor_tot
            npt:= 0
            vlr:= valor_tot
            ncodvend:= vendedor
            nmattot:= 0
            select 4
            set order to 1
            seek ncodcli
            if (Found())
               cnomecli:= nome_cli
            else
               cnomecli:= " *** Cliente Nao Cadastrado ***"
            endif
            select 5
            seek ncodvend
            if (EOF())
               cnomevend:= "*** Vendedor Nao Cadastrado ***"
            else
               cnomevend:= nome
            endif
            select 1
            @  0,  0 say "Pedido de devolucao"
            @  1,  0 say Replicate("-", 80)
            @  2,  1 say "Data..:" + DToC(data) + "  Numero " + ;
               Str(numero, 5) + "  Vendedor.:" + Str(vendedor, 4) + ;
               " " + cnomevend
            @  3,  0 say Replicate("-", 80)
            @  4,  1 say ;
               "Cod.  Descricao                       Quant.           V.Unit.        V.Total"
            select 2
            seek nr
            do while (!EOF() .AND. numero_ped = nr)
               if (lin > nalturafor)
                  lin:= 6
                  eject
                  @  0,  0 say "Pedido de devolucao"
                  @  1,  0 say Replicate("-", 80)
                  @  2,  1 say "Data..:" + DToC(data) + "  Numero" + ;
                     Str(numero, 5) + "  Vendedor.:" + Str(cliente, ;
                     4) + " " + cnomevend
                  @  3,  0 say Replicate("-", 80)
                  @  4,  1 say ;
                     "Cod.  Descricao                       Quant.           V.Unit.        V.Total"
               endif
               cm:= codigo_mat
               select 3
               seek cm
               if (EOF())
                  nm:= "*** Material Nao Incluso ***"
               else
                  nm:= descricao
               endif
               select 2
               npt:= quantidade * valor
               nmattot:= nmattot + quantidade
               @ lin,  1 say cm + " " + SubStr(nm, 1, 33) + " " + ;
                  Str(quantidade, 4) + "    " + Str(valor) + "  " + ;
                  Str(npt)
               lin++
               if (cm = "00000")
                  if (lin > nalturafor)
                     lin:= 5
                     @ 62, 56 say "Valor total..:"
                     @ 62, 64 say vtt picture "999,999,999.99"
                     clear()
                  endif
                  @ lin, 10 say descricao
                  lin:= lin + 1
               endif
               skip 
            enddo
            select 1
            skip 
            @ lin,  0 say Replicate("-", 80)
            @ lin + 1, 10 say "Total de Mercadorias:"
            @ lin + 1, 33 say nmattot
            @ lin + 1, 55 say "Valor total..:"
            @ lin + 1, 64 say vtt picture "999,999,999.99"
            @ lin + 5, 10 say Replicate("-", 45)
            @ lin + 6, 11 say cc
            @ lin + 6, 16 say "- " + cnomecli
            set device to screen
            nnoviasimp++
            eject
            nvaltot:= 0
         endif
      enddo
      close databases
      select 1
      close format
   else
      return
   endif

********************************
procedure GETDOSETKE(Arg1, Arg2)

   local Local1
   if (Arg2:changed())
      Arg2:assign()
      Static6:= .T.
   endif
   Local1:= Static6
   eval(Arg1, Static13, Static14, readvar())
   showscoreb()
   Arg2:updatebuff()
   Static6:= Local1
   if (Static7)
      Arg2:exitstate(7)
   endif
   return

********************************
function __TCOLUMN(Arg1)

   return qself()[6][Arg1]

********************************
function IMPRINF(Arg1, Arg2)

   private lpagina, nform
   lpagina:= .T.
   naliq:= 0
   if (impressora() == 1)
      private tempestru[6, 4]
      ncont:= 1
      carquivo:= "TEMP" + LTrim(Str(ncont)) + ".DBF"
      do while (file(carquivo))
         ncont++
         carquivo:= "TEMP" + LTrim(Str(ncont)) + ".DBF"
      enddo
      tempestru[1][1]:= "PROD"
      tempestru[1][2]:= "C"
      tempestru[1][3]:= 5
      tempestru[1][4]:= 0
      tempestru[2][1]:= "DESC"
      tempestru[2][2]:= "C"
      tempestru[2][3]:= 35
      tempestru[2][4]:= 0
      tempestru[3][1]:= "ESTO"
      tempestru[3][2]:= "N"
      tempestru[3][3]:= 6
      tempestru[3][4]:= 2
      tempestru[4][1]:= "VEND"
      tempestru[4][2]:= "N"
      tempestru[4][3]:= 12
      tempestru[4][4]:= 2
      tempestru[5][1]:= "VEND2"
      tempestru[5][2]:= "N"
      tempestru[5][3]:= 6
      tempestru[5][4]:= 2
      tempestru[6][1]:= "ALIQ1"
      tempestru[6][2]:= "N"
      tempestru[6][3]:= 2
      tempestru[6][4]:= 0
      dbcreate(carquivo, tempestru)
      ncont:= 0
      do while (.T.)
         select 1
         use (carquivo) exclusive
         if (ncont > 3)
            alert("ATENO !;Erro na abertura de arquivo.;Operao ser  cancelada.")
            return Nil
         endif
         if (neterr())
            InKey(2)
            ncont++
            loop
         else
            exit
         endif
      enddo
      ncont:= 0
      do while (.T.)
         select 2
         if (ctipo_nota = "NF")
            use PED_MAT shared readonly index PED_MAT
         elseif (ctipo_nota = "MN")
            run CAPTURE L=2 Q=PRINTQ_3 NFF NB TI=3
            use MAN_MAT shared readonly index MAN_MAT
         elseif (ctipo_nota = "RT")
            run CAPTURE L=2 Q=PRINTQ_3 NFF NB TI=3
            use RET_MAT shared readonly index RET_MAT
         else
            ncont:= 5
         endif
         if (ncont > 3)
            alert("ATENO !;Erro na abertura de arquivo.;Operao ser  cancelada.")
            return Nil
         endif
         if (neterr())
            InKey(2)
            ncont++
            loop
         else
            exit
         endif
      enddo
      seek Arg1
      if (!Found())
         alert("Pedido nao encontrado;Operacao ser  cancelada")
         return .F.
      endif
      do while (numero_ped = Arg2 .AND. !EOF())
         cprod:= codigo_mat
         nquanti:= quantidade
         nvalormat:= valor
         naliq1:= aliquota
         select 1
         ncont:= 0
         do while (.T.)
            append blank
            if (ncont > 3)
               alert("ATENO!;Erro na inserco de registro.; Operao ser  cancelada.")
               return Nil
            endif
            if (neterr())
               InKey(2)
               ncont++
            else
               exit
            endif
         enddo
         replace prod with cprod
         replace esto with nquanti
         replace vend with nvalormat
         replace aliq1 with naliq1
         select 2
         skip 
      enddo
      nvaltot:= 0
      nvalicm:= 0
      nnoviasimp:= 0
      nvias:= 1
      close databases
      select 1
      close format
      mostrar("*** Imprimindo ****")
      ncont:= 0
      do while (.T.)
         select 1
         if (ctipo_nota = "NF")
            use PEDIDOS shared index PEDIDOS1
         elseif (ctipo_nota = "MN")
            use MANIFEST shared index MANIFES1, MANIFES2, MANIFES3
         elseif (ctipo_nota = "RT")
            use RETORNO shared index RETORNO1, RETORNO2, RETORNO3
         else
            ncont:= 5
         endif
         set order to 1
         if (ncont > 3)
            alert("ATENO !;Erro na abertura de arquivo.;Operao ser  cancelada.")
            return Nil
         endif
         if (neterr())
            InKey(2)
            ncont++
            loop
         else
            exit
         endif
      enddo
      ncont:= 0
      do while (.T.)
         select 2
         use (carquivo) exclusive
         if (ncont > 3)
            alert("ATENO !;Erro na abertura de arquivo.;Operao ser  cancelada.")
            return Nil
         endif
         if (neterr())
            InKey(2)
            ncont++
            loop
         else
            exit
         endif
      enddo
      indice:= SubStr(carquivo, 1, 6)
      index on Desc to (indice)
      set index to (indice)
      ncont:= 0
      do while (.T.)
         select 3
         use Produtos shared readonly index Produto1
         if (ncont > 3)
            alert("ATENO !;Erro na abertura de arquivo.;Operao ser  cancelada.")
            return Nil
         endif
         if (neterr())
            InKey(2)
            ncont++
            loop
         else
            exit
         endif
      enddo
      ncont:= 0
      do while (.T.)
         select 4
         use CLIENTES shared readonly index CLIENTE1
         if (ncont > 3)
            alert("ATENO !;Erro na abertura de arquivo.;Operao ser  cancelada.")
            return Nil
         endif
         if (neterr())
            InKey(2)
            ncont++
            loop
         else
            exit
         endif
      enddo
      ncont:= 0
      do while (.T.)
         select 5
         use FUNCIONA shared readonly index FUNCION1
         if (ncont > 3)
            alert("ATENO !;Erro na abertura de arquivo.;Operao ser  cancelada.")
            return Nil
         endif
         if (neterr())
            InKey(2)
            ncont++
            loop
         else
            exit
         endif
      enddo
      if (ntiponf == 1)
         do while (nnoviasimp != nvias)
            npt:= 0
            vtt:= 0
            pag:= 0
            tot:= 0
            cli:= 0
            select 1
            seek Arg1
            if (Found())
               cseimp:= imp_nf
               if (cseimp == "S")
                  alert("Nota fiscal desse pedido ja foi impressa !")
                  close
                  return .F.
               else
                  do while (!RLock())
                     if (ncont > 3)
                        alert("ATENO !;Erro no bloqueio de registro.; Operao ser  cancelada.")
                        close databases
                        select 1
                        close format
                        return Nil
                     endif
                     ncont++
                  enddo
                  replace imp_nf with "S"
               endif
               drvimpr:= cportanota
               set device to printer
               set printer to (drvimpr)
               @ PRow(), PCol() say "CB"
               cv:= vendedor
               nr:= numero
               cc:= cliente
               vtt:= valor_tot
               nvaltot:= 0
               nvalicm:= 0
               nvalbas:= 0
               npt:= 0
               vlr:= valor_tot
               ddtped:= data
               ncodcli:= cliente
               ncodvend:= vendedor
               cavista:= form_pgto
               cnomcli:= nome_cli
               ndesc:= desconto
               nacresc:= acrescimo
               cconrev:= con_rev
               nloja:= loja
               if (ncodcli != 1)
                  select 4
                  set order to 1
                  seek ncodcli
                  if (Found())
                     cnomecli:= nome_cli
                     cinsc:= insc_cli
                     ccgc:= cgc_cli
                  else
                     cnomecli:= " *** Cliente Nao Cadastrado ***"
                  endif
               else
                  select 1
                  cnomecli:= cnomcli
               endif
               select 5
               seek ncodvend
               if (EOF())
                  cnomevend:= "*** Vendedor Nao Cadastrado ***"
               else
                  cnomevend:= nome
               endif
               select 2
               do while (!EOF())
                  ncont:= 0
                  do while (.T.)
                     use Empresa alias Emp new shared
                     if (ncont > 3)
                        alert("ATENO !;Erro na abertura de arquivo.;Operao ser  cancelada.")
                        return Nil
                     endif
                     if (neterr())
                        InKey(2)
                        ncont++
                        loop
                     else
                        exit
                     endif
                  enddo
                  if (ctipo_nota = "NF")
                     nnota:= emp->notafiscal + 1
                     nform:= emp->formulario + 1
                  elseif (ctipo_nota = "MN" .OR. ctipo_nota = "RT")
                     nnota:= emp->notamanife + 1
                     nform:= emp->formul_man + 1
                  endif
                  do while (!RLock())
                     if (ncont > 3)
                        alert("ATENO !;Erro no bloqueio de registro.; Operao ser  cancelada.")
                        return Nil
                     endif
                     ncont++
                  enddo
                  if (ctipo_nota = "NF")
                     replace formulario with nform
                     replace notafiscal with nnota
                  elseif (ctipo_nota = "MN" .OR. ctipo_nota = "RT")
                     replace formul_man with nform
                     replace notamanife with nnota
                  endif
                  close
                  ncont:= 0
                  do while (.T.)
                     if (ctipo_nota = "NF")
                        use Nota_Fis alias NEW shared index Nota1, ;
                           Nota2, Nota3
                     elseif (ctipo_nota = "MN")
                        use Nota_Man alias NEW shared index Mani1, ;
                           Mani3, Mani3
                     elseif (ctipo_nota = "RT")
                        use Nota_Ret alias NEW shared index Reto1, ;
                           Reto3, Reto3
                     endif
                     if (ncont > 3)
                        alert("ATENO!;Erro na inserco de registro.; Operao ser  cancelada.")
                        lcontrole:= .F.
                     endif
                     if (neterr())
                        InKey(2)
                        ncont++
                     else
                        exit
                     endif
                  enddo
                  if (!lcontrole)
                     loop
                  endif
                  ncont:= 0
                  do while (.T.)
                     append blank
                     if (ncont > 3)
                        alert("ATENO!;Erro na inserco de registro.; Operao ser  cancelada.")
                        lcontrole:= .F.
                     endif
                     if (neterr())
                        InKey(2)
                        ncont++
                     else
                        exit
                     endif
                  enddo
                  if (!lcontrole)
                     loop
                  endif
                  do while (!RLock())
                     if (ncont > 3)
                        alert("ATENO !;Erro no bloqueio de registro.; Operao ser  cancelada.")
                        return Nil
                     endif
                     ncont++
                  enddo
                  replace nota with nnota
                  replace pedido with Arg2
                  replace formulario with nform
                  replace loja with nloja
                  nchavereg:= RecNo()
                  close
                  select 2
                  @  1,  0 say ""
                  if (ctipo_nota = "RT")
                     @  2, 105 say "X"
                  else
                     @  2, 93 say "X"
                  endif
                  @  2, 120 say nnota
                  @  2, 120 say nnota
                  if (ctipo_nota = "NF")
                     @  7,  8 say "Venda"
                  elseif (ctipo_nota = "MN")
                     @  7,  8 say "Remessa p/venda fora do estabelec."
                  elseif (ctipo_nota = "RT")
                     @  7,  8 say "Retorno"
                  endif
                  if (ctipo_nota = "MN")
                     if (cufmn = "GO")
                        @  7, 49 say "596"
                     elseif (cufmn != "GO")
                        @  7, 49 say "696"
                     endif
                  elseif (ctipo_nota = "NF")
                     if (cuf = "GO")
                        @  7, 49 say "512"
                     elseif (cuf != "GO")
                        @  7, 49 say "612"
                     endif
                  elseif (ctipo_nota = "RT")
                     @  7, 49 say "195"
                  endif
                  @  9,  8 say cnomecli
                  @  9, 91 say ccgc
                  @  9, 124 say ddtped
                  @ 11,  8 say cender
                  @ 11, 79 say cbair
                  @ 11, 107 say ccep
                  @ 13,  8 say ccidade
                  @ 13, 57 say cfone
                  @ 13, 85 say cuf
                  @ 13, 91 say cinsc
                  cimpret:= "N"
                  naliqant:= aliq1
                  lin:= 21
                  lpagina:= .T.
                  do while (lpagina .AND. !EOF())
                     cm:= prod
                     select 3
                     seek cm
                     if (!Found())
                        nm:= "                                     "
                        cund:= "   "
                     else
                        nm:= descricao
                        cund:= unidade
                     endif
                     select 2
                     npt:= esto * vend
                     nvaltot:= nvaltot + esto * vend
                     nvalicm:= nvalicm + esto * vend * aliq1 / 100
                     if (aliq1 != 0)
                        nvalbas:= nvalbas + esto * vend
                     endif
                     do case
                     case aliq1 == 17 .OR. aliq1 == 12
                        nct:= "00"
                     case aliq1 == 25
                        nct:= "2"
                     case aliq1 == 0
                        nct:= "06"
                        cimpret:= "S"
                     case aliq1 == 10
                        nct:= "00"
                        cimpret:= "S"
                     otherwise
                        nct:= "5"
                     endcase
                     @ lin,  9 say cm + "     " + nm
                     @ lin, 71 say nct
                     @ lin, 77 say cund
                     @ lin, 88 say esto picture "99999.99"
                     @ lin, 106 say vend picture "99999.99"
                     @ lin, 120 say npt picture "999,999,999.99"
                     @ lin, 136 say aliq1 picture "99.99"
                     naliq:= aliq1
                     lin++
                     select 2
                     skip 
                     if (lin >= 38)
                        lpagina:= .F.
                     endif
                  enddo
                  @ 41, 18 say nvalbas picture "999,999,999.99"
                  @ 41, 36 say nvalicm picture "999,999,999.99"
                  @ 41, 121 say nvaltot picture "999,999,999.99"
                  @ 43, 121 say nvaltot picture "999,999,999.99"
                  @ 52,  7 say SubStr(cnomevend, 1, 15)
                  if (cimpret = "S")
                     @ 53,  7 say ;
                        "Imposto retido conforme instrucao normativa no 120 e/ou 238 GSF"
                     cimpret:= "N"
                  endif
                  if (cconrev = "R" .AND. naliq = 10)
                     @ 54,  7 say ;
                        "Reducao de aliquota p/10% con. TARE no 59/96 GSF"
                  endif
                  if (ctipo_nota != "NF" .AND. cufmn = "GO")
                     @ 54,  9 say ;
                        "Reducao de aliquota p/10% con. TARE no 59/96 GSF"
                  endif
                  if (ctipo_nota = "MN" .OR. ctipo_nota = "RT")
                     @ 55,  7 say cmensag[1]
                     @ 56,  7 say cmensag[2]
                     @ 57,  7 say cmensag[3]
                     @ 58,  7 say cmensag[4]
                  endif
                  @ 62, 117 say nnota
                  @ 62, 117 say nnota
                  ncont:= 0
                  do while (.T.)
                     select 07
                     if (ctipo_nota = "NF")
                        use Nota_Fis alias NEW shared index Nota1, ;
                           Nota2, Nota3
                     elseif (ctipo_nota = "MN")
                        use Nota_Man alias NEW shared index Mani1, ;
                           Mani3, Mani3
                     elseif (ctipo_nota = "RT")
                        use Nota_Ret alias NEW shared index Reto1, ;
                           Reto3, Reto3
                     endif
                     if (ncont > 3)
                        alert("ATENO!;Erro na inserco de registro.; Operao ser  cancelada.")
                        lcontrole:= .F.
                     endif
                     if (neterr())
                        InKey(2)
                        ncont++
                     else
                        exit
                     endif
                  enddo
                  if (!lcontrole)
                     loop
                  endif
                  goto nchavereg
                  do while (!RLock())
                     if (ncont > 3)
                        alert("ATENO !;Erro no bloqueio de registro.; Operao ser  cancelada.")
                        return Nil
                     endif
                     ncont++
                  enddo
                  replace codigo_cli with ncodcli
                  replace valor_nf with nvaltot
                  replace icms with nvalicm
                  replace aliquota with naliq
                  replace data with ddtped
                  replace estado with cuf
                  close
                  nvaltot:= 0
                  nvalicm:= 0
                  nvalbas:= 0
                  eject
                  select 2
               enddo
               select 1
               skip 
            endif
            @ PRow(), PCol() say "C" + Chr(nlinform)
            set device to screen
            nnoviasimp++
            if (nnoviasimp != nvias)
               eject
            endif
            nvaltot:= 0
         enddo
      elseif (ntiponf == 2)
         do while (nnoviasimp != nvias)
            npt:= 0
            vtt:= 0
            pag:= 0
            tot:= 0
            cli:= 0
            select 1
            seek Arg1
            if (Found())
               cseimp:= imp_nf
               if (cseimp == "S")
                  alert("Nota fiscal desse pedido ja foi impressa !")
                  close
                  return .F.
               else
                  do while (!RLock())
                     if (ncont > 3)
                        alert("ATENO !;Erro no bloqueio de registro.; Operao ser  cancelada.")
                        close databases
                        select 1
                        close format
                        return Nil
                     endif
                     ncont++
                  enddo
                  replace imp_nf with "S"
               endif
               drvimpr:= cportanota
               set device to printer
               set printer to (drvimpr)
               @ PRow(), PCol() say "CB"
               cv:= vendedor
               nr:= numero
               cc:= cliente
               vtt:= valor_tot
               nvaltot:= 0
               nvalicm:= 0
               nvalbas:= 0
               npt:= 0
               vlr:= valor_tot
               ddtped:= data
               ncodcli:= cliente
               ncodvend:= vendedor
               cavista:= form_pgto
               cnomcli:= nome_cli
               ndesc:= desconto
               nacresc:= acrescimo
               cconrev:= con_rev
               nloja:= loja
               if (ncodcli != 1)
                  select 4
                  set order to 1
                  seek ncodcli
                  if (Found())
                     cnomecli:= nome_cli
                     cinsc:= insc_cli
                     ccgc:= cgc_cli
                  else
                     cnomecli:= " *** Cliente Nao Cadastrado ***"
                  endif
               else
                  select 1
                  cnomecli:= cnomcli
               endif
               select 5
               seek ncodvend
               if (EOF())
                  cnomevend:= "*** Vendedor Nao Cadastrado ***"
               else
                  cnomevend:= nome
               endif
               select 2
               do while (!EOF())
                  ncont:= 0
                  do while (.T.)
                     use Empresa alias Emp new shared
                     if (ncont > 3)
                        alert("ATENO !;Erro na abertura de arquivo.;Operao ser  cancelada.")
                        return Nil
                     endif
                     if (neterr())
                        InKey(2)
                        ncont++
                        loop
                     else
                        exit
                     endif
                  enddo
                  if (ctipo_nota = "NF")
                     nnota:= emp->notafiscal + 1
                     nform:= emp->formulario + 1
                  elseif (ctipo_nota = "MN" .OR. ctipo_nota = "RT")
                     nnota:= emp->notamanife + 1
                     nform:= emp->formul_man + 1
                  endif
                  do while (!RLock())
                     if (ncont > 3)
                        alert("ATENO !;Erro no bloqueio de registro.; Operao ser  cancelada.")
                        return Nil
                     endif
                     ncont++
                  enddo
                  if (ctipo_nota = "NF")
                     replace formulario with nform
                     replace notafiscal with nnota
                  elseif (ctipo_nota = "MN" .OR. ctipo_nota = "RT")
                     replace formul_man with nform
                     replace notamanife with nnota
                  endif
                  close
                  ncont:= 0
                  do while (.T.)
                     if (ctipo_nota = "NF")
                        use Nota_Fis alias NEW shared index Nota1, ;
                           Nota2, Nota3
                     elseif (ctipo_nota = "MN")
                        use Nota_Man alias NEW shared index Mani1, ;
                           Mani3, Mani3
                     elseif (ctipo_nota = "RT")
                        use Nota_Ret alias NEW shared index Reto1, ;
                           Reto3, Reto3
                     endif
                     if (ncont > 3)
                        alert("ATENO!;Erro na inserco de registro.; Operao ser  cancelada.")
                        lcontrole:= .F.
                     endif
                     if (neterr())
                        InKey(2)
                        ncont++
                     else
                        exit
                     endif
                  enddo
                  if (!lcontrole)
                     loop
                  endif
                  ncont:= 0
                  do while (.T.)
                     append blank
                     if (ncont > 3)
                        alert("ATENO!;Erro na inserco de registro.; Operao ser  cancelada.")
                        lcontrole:= .F.
                     endif
                     if (neterr())
                        InKey(2)
                        ncont++
                     else
                        exit
                     endif
                  enddo
                  if (!lcontrole)
                     loop
                  endif
                  do while (!RLock())
                     if (ncont > 3)
                        alert("ATENO !;Erro no bloqueio de registro.; Operao ser  cancelada.")
                        return Nil
                     endif
                     ncont++
                  enddo
                  replace nota with nnota
                  replace pedido with Arg2
                  replace formulario with nform
                  replace loja with nloja
                  nchavereg:= RecNo()
                  close
                  select 2
                  @  1,  0 say ""
                  if (ctipo_nota = "RT")
                     @  1, 118 say "X"
                  else
                     @  1, 105 say "X"
                  endif
                  @  2, 100 say nnota
                  @  2, 100 say nnota
                  if (ctipo_nota = "NF")
                     @  7,  8 say "Venda"
                  elseif (ctipo_nota = "MN")
                     @  7,  8 say "Remessa p/venda fora do estabelec."
                  elseif (ctipo_nota = "RT")
                     @  7,  8 say "Retorno"
                  endif
                  if (ctipo_nota = "MN")
                     if (cufmn = "GO")
                        @  7, 49 say "599"
                     elseif (cufmn != "GO")
                        @  7, 49 say "699"
                     endif
                  elseif (ctipo_nota = "NF")
                     if (cuf = "GO")
                        @  7, 49 say "512"
                     elseif (cuf != "GO")
                        @  7, 49 say "612"
                     endif
                  elseif (ctipo_nota = "RT")
                     @  7, 49 say "199"
                  endif
                  @  9,  8 say cnomecli
                  @  9, 91 say ccgc
                  @  9, 124 say ddtped
                  @ 11, 107 say ccep
                  @ 11,  8 say cender
                  @ 11, 75 say cbair
                  @ 13,  8 say ccidade
                  @ 13, 57 say cfone
                  @ 13, 85 say cuf
                  @ 13, 91 say cinsc
                  cimpret:= "N"
                  naliqant:= aliq1
                  lin:= 21
                  lpagina:= .T.
                  do while (lpagina .AND. !EOF())
                     cm:= prod
                     select 3
                     seek cm
                     if (!Found())
                        nm:= "                                     "
                        cund:= "   "
                     else
                        nm:= descricao
                        cund:= unidade
                     endif
                     select 2
                     npt:= esto * vend
                     nvaltot:= nvaltot + esto * vend
                     nvalicm:= nvalicm + esto * vend * aliq1 / 100
                     if (aliq1 != 0)
                        nvalbas:= nvalbas + esto * vend
                     endif
                     do case
                     case aliq1 == 17 .OR. aliq1 == 12
                        nct:= "00"
                     case aliq1 == 25
                        nct:= "2"
                     case aliq1 == 0
                        nct:= "06"
                        cimpret:= "S"
                     case aliq1 == 10
                        nct:= "00"
                        cimpret:= "S"
                     otherwise
                        nct:= "5"
                     endcase
                     @ lin,  6 say cm + "    " + nm
                     @ lin, 71 say nct
                     @ lin, 77 say cund
                     @ lin, 86 say esto picture "99999.99"
                     @ lin, 104 say vend picture "99999.99"
                     @ lin, 118 say npt picture "999,999,999.99"
                     @ lin, 135 say aliq1 picture "99"
                     naliq:= aliq1
                     lin++
                     select 2
                     skip 
                     if (lin >= 34)
                        lpagina:= .F.
                     endif
                  enddo
                  if (cconrev = "R" .AND. naliq = 10)
                     @ 35,  7 say ;
                        "Reducao de aliquota p/10% conf. TARE no 126/95 GSF"
                  endif
                  if (ctipo_nota != "NF" .AND. cufmn = "GO")
                     @ 35,  9 say ;
                        "Reducao de aliquota p/10% con. TARE no 126/95 GSF"
                  endif
                  @ 40, 16 say nvalbas picture "999,999,999.99"
                  @ 40, 36 say nvalicm picture "999,999,999.99"
                  @ 40, 121 say nvaltot picture "999,999,999.99"
                  @ 43, 121 say nvaltot picture "999,999,999.99"
                  @ 53,  7 say SubStr(cnomevend, 1, 15)
                  if (cimpret = "S")
                     cimpret:= "N"
                  endif
                  if (ctipo_nota = "MN" .OR. ctipo_nota = "RT")
                     @ 55,  7 say cmensag[1]
                     @ 56,  7 say cmensag[2]
                     @ 57,  7 say cmensag[3]
                     @ 58,  7 say cmensag[4]
                  endif
                  @ 63, 117 say nnota
                  @ 63, 117 say nnota
                  ncont:= 0
                  do while (.T.)
                     select 07
                     if (ctipo_nota = "NF")
                        use Nota_Fis alias NEW shared index Nota1, ;
                           Nota2, Nota3
                     elseif (ctipo_nota = "MN")
                        use Nota_Man alias NEW shared index Mani1, ;
                           Mani3, Mani3
                     elseif (ctipo_nota = "RT")
                        use Nota_Ret alias NEW shared index Reto1, ;
                           Reto3, Reto3
                     endif
                     if (ncont > 3)
                        alert("ATENO!;Erro na inserco de registro.; Operao ser  cancelada.")
                        lcontrole:= .F.
                     endif
                     if (neterr())
                        InKey(2)
                        ncont++
                     else
                        exit
                     endif
                  enddo
                  if (!lcontrole)
                     loop
                  endif
                  goto nchavereg
                  do while (!RLock())
                     if (ncont > 3)
                        alert("ATENO !;Erro no bloqueio de registro.; Operao ser  cancelada.")
                        return Nil
                     endif
                     ncont++
                  enddo
                  replace codigo_cli with ncodcli
                  replace valor_nf with nvaltot
                  replace icms with nvalicm
                  replace aliquota with naliq
                  replace data with ddtped
                  replace estado with cuf
                  close
                  nvaltot:= 0
                  nvalicm:= 0
                  nvalbas:= 0
                  eject
                  select 2
               enddo
               select 1
               skip 
            endif
            @ PRow(), PCol() say "C" + Chr(nlinform)
            set device to screen
            nnoviasimp++
            if (nnoviasimp != nvias)
               eject
            endif
            nvaltot:= 0
         enddo
      endif
      if (ctipo_nota = "MN" .OR. ctipo_nota = "RT")
         run CAPTURE L=2 Q=PRINTQ_1 NFF NB TI=3
      endif
      close databases
      select 1
      close format
   else
      erase (carquivo)
      return .T.
   endif

********************************
function RANGECHECK(Arg1, Arg2, Arg3, Arg4)

   local Local1, Local2, Local3, Local4
   if (!Arg1:changed())
      return .T.
   endif
   Local4:= Arg1:varget()
   if (Local4 >= Arg3 .AND. Local4 <= Arg4)
      return .T.
   endif
   if (Set(_SET_SCOREBOARD))
      Local1:= nationmsg(10) + LTrim(Transform(Arg3, "")) + ;
         nationmsg(11) + LTrim(Transform(Arg4, ""))
      if (Len(Local1) > MaxCol())
         Local1:= SubStr(Local1, 1, MaxCol())
      endif
      Local2:= Row()
      Local3:= Col()
      SetPos(0, Min(60, MaxCol() - Len(Local1)))
      dispout(Local1)
      SetPos(Local2, Local3)
      do while (nextkey() == 0)
      enddo
      SetPos(0, Min(60, MaxCol() - Len(Local1)))
      dispout(Space(Len(Local1)))
      SetPos(Local2, Local3)
   endif
   return .F.

********************************
function TSTRING(Arg1)

   return strzero(Int(mod(Arg1 / 3600, 24)), 2, 0) + ":" + ;
      strzero(Int(mod(Arg1 / 60, 60)), 2, 0) + ":" + ;
      strzero(Int(mod(Arg1, 60)), 2, 0)

********************************
function SECS(Arg1)

   return Val(Arg1) * 3600 + Val(SubStr(Arg1, 4)) * 60 + ;
      Val(SubStr(Arg1, 7))

********************************
function MOD(Arg1, Arg2)

   local Local1
   Local1:= Arg1 % Arg2
   return iif(Arg2 = 0, Arg1, iif(Local1 * Arg2 < 0, Local1 + Arg2, ;
      Local1))

********************************
function __TSETHEAD(Arg1)

   if (!(ISNIL(Arg1)))
      qself()[7]:= _einstvar(qself(), "HEADSEP", Arg1, "C", 1001)
   endif
   return qself()[7]

********************************
procedure _NTXERR

   return

********************************
function IMPRITRANS(Arg1)

   if (impressora() == 1)
      cnomemp:= cempresa
      nvaltot:= 0
      nnoviasimp:= 0
      nvias:= nviastrans
      close databases
      select 1
      close format
      mostrar("*** Imprimindo ****")
      ncont:= 0
      do while (.T.)
         select 1
         use Transf shared index Transf2
         set order to 1
         if (ncont > 3)
            alert("ATENO !;Erro na abertura de arquivo.;Operao ser  cancelada.")
            return Nil
         endif
         if (neterr())
            InKey(2)
            ncont++
            loop
         else
            exit
         endif
      enddo
      ncont:= 0
      do while (.T.)
         select 2
         use Trans_Mat shared index Tra_Mat1
         if (ncont > 3)
            alert("ATENO !;Erro na abertura de arquivo.;Operao ser  cancelada.")
            return Nil
         endif
         if (neterr())
            InKey(2)
            ncont++
            loop
         else
            exit
         endif
      enddo
      ncont:= 0
      do while (.T.)
         select 3
         use Produtos shared index Produto1
         if (ncont > 3)
            alert("ATENO !;Erro na abertura de arquivo.;Operao ser  cancelada.")
            return Nil
         endif
         if (neterr())
            InKey(2)
            ncont++
            loop
         else
            exit
         endif
      enddo
      do while (nnoviasimp != nvias)
         nlin:= 7
         npt:= 0
         select 1
         seek Arg1
         if (Found())
            drvimpr:= cportaped
            set device to printer
            set printer to (drvimpr)
            @ PRow(), PCol() say "C" + Chr(nlinform)
            vlr:= valor_tot
            select Transf
            @  1,  1 say "" + cnomemp + ""
            @  2,  0 say "Transferencia de Estoque"
            @  3,  0 say Replicate("-", 80)
            @  4,  1 say "Data..:" + DToC(data) + "  Documento  " + ;
               Str(num_docto, 5) + "  Origem  " + Str(norigem, 2) + ;
               " " + "  Destino  " + Str(ndestino, 2)
            @  5,  0 say Replicate("-", 80)
            @  6,  1 say ;
               "Cod.  Descricao                             Quant.     V.Unit.          V.Total"
            nlin++
            select 2
            seek Arg1
            do while (!EOF() .AND. num_docto = Arg1)
               if (nlin > nalturafor)
                  rodape(nalturafor, .F., 79)
                  nlin:= 7
                  eject
                  @  1,  1 say "" + cnomemp + ""
                  @  2,  0 say "Transferencia de Estoque"
                  @  3,  0 say Replicate("-", 80)
                  @  4,  1 say "Data..:" + DToC(data) + ;
                     "  Documento  " + num_docto + "  Origem  " + ;
                     Str(norigem, 2) + " " + "  Destino  " + ;
                     Str(ndestino, 2)
                  @  5,  0 say Replicate("-", 80)
                  @  6,  1 say ;
                     "Cod.  Descricao                             Quant.     V.Unit.          V.Total"
                  nlin++
               endif
               ccodmat:= codigo_mat
               select Produtos
               seek ccodmat
               if (EOF())
                  cnomemat:= "*** Material Nao Incluso ***"
               else
                  cnomemat:= descricao
               endif
               select Trans_Mat
               npt:= quantidade * valor_unit
               nvaltot:= nvaltot + npt
               @ nlin,  1 say ccodmat + " " + SubStr(cnomemat, 1, 36)
               @ nlin, 38 say quantidade picture "9,999,999.99"
               @ nlin, 51 say valor_unit picture "9,999,999.99"
               @ nlin, 66 say npt picture "999,999,999.99"
               nlin++
               skip 
            enddo
            select Transf
            skip 
         endif
         if (nlin > nalturafor - 5)
            rodape(nalturafor, .F., 79)
            nlin:= 7
            eject
            @  1,  1 say "" + cnomemp + ""
            @  2,  0 say "Transferencia de Estoque"
            @  3,  0 say Replicate("-", 80)
            @  4,  1 say "Data..:" + DToC(data) + "  Documento  " + ;
               Str(num_docto, 5) + "  Origem  " + Str(norigem, 2) + ;
               " " + "  Destino  " + Str(ndestino, 2)
            @  5,  0 say Replicate("-", 80)
            @  6,  1 say ;
               "Cod.  Descricao                             Quant.     V.Unit.          V.Total"
            nlin++
         endif
         @ nlin + 0,  0 say Replicate("-", 80)
         @ nlin + 1, 46 say "Valor total..:"
         @ nlin + 1, 66 say nvaltot picture "999,999,999.99"
         @ nlin + 6,  2 say "-------------------------------------"
         @ nlin + 6, 40 say "-------------------------------------"
         @ nlin + 7, 15 say "Origem"
         @ nlin + 7, 55 say "Destino"
         nnoviasimp++
         rodape(nalturafor, .T., 79)
         nvaltot:= 0
         nlin:= 7
         eject
      enddo
      set device to screen
      close databases
      select 1
      close format
   else
      return
   endif

********************************
function DATA_ORC(Arg1)

   private vdata[12]
   vdata[1]:= "Janeiro"
   vdata[2]:= "Fevereiro"
   vdata[3]:= "Maro"
   vdata[4]:= "Abril"
   vdata[5]:= "Maio"
   vdata[6]:= "Junho"
   vdata[7]:= "Julho"
   vdata[8]:= "Agosto"
   vdata[9]:= "Setembro"
   vdata[10]:= "Outubro"
   vdata[11]:= "Novembro"
   vdata[12]:= "Dezembro"
   return "Goiania, " + Str(Day(Arg1), 2) + " " + "de " + ;
      vdata[Month(Arg1)] + " de" + Str(Year(Arg1), 5)

********************************
procedure QSR_FUNC


********************************
function IMPRIDUP

   if (impressora() == 1)
      mostrar("*** Imprimindo ****")
      set device to printer
      drvimpr:= cportaped
      set printer to (drvimpr)
      @ PRow(), PCol() say "C" + Chr(nlinform)
      ncont:= 0
      do while (.T.)
         use Clientes alias Cli new shared index Cliente1, Cliente2
         if (ncont > 3)
            alert("Erro na abertura de arquivo!; OperaÆo ser  cancelada!")
            set color to (ccor)
            return .F.
         endif
         if (neterr())
            InKey(2)
            ncont++
            loop
         else
            exit
         endif
      enddo
      seek ncodcli
      @  8, 57 say SubStr(DToC(ddtemissao), 1, 2)
      @  8, 65 say SubStr(DToC(ddtemissao), 4, 2)
      @  8, 76 say SubStr(DToC(ddtemissao), 7, 2)
      @ 12,  1 say nvalortit picture "9,999,999.99"
      @ 12, 14 say cnumdoc
      @ 12, 28 say nvalortit picture "9,999,999.99"
      @ 12, 28 say nvalortit picture "9,999,999.99"
      @ 12, 41 say cnumdoc
      @ 12, 53 say ddtvenc
      @ 12, 53 say ddtvenc
      @ 15, 33 say "Juros de Mora Di ria R$: "
      @ 15, 58 say nvalortit * 6.5 / 100 / 30 picture "999.9999"
      @ 17, 35 say nome_cli
      @ 17, 35 say nome_cli
      @ 18, 35 say endere_cli
      @ 19, 35 say bairro_cli
      @ 20, 35 say cidade_cli
      @ 20, 56 say cep_cli
      @ 20, 73 say estado_cli
      @ 21, 35 say pagamento
      if (pessoa_cli = "F")
         @ 24, 35 say cpf_cli
         @ 24, 65 say identi_cli
      else
         @ 24, 35 say cgc_cli
         @ 24, 65 say insc_cli
      endif
      eject
      set device to screen
      close databases
      select 1
      close format
   endif
   return

********************************
static function DEFERROR(Arg1)

   local Local1, Local2, Local3, Local4
   if (Arg1:gencode() == 5)
      return 0
   endif
   if (Arg1:gencode() == 21 .AND. Arg1:oscode() == 32 .AND. ;
         Arg1:candefault())
      neterr(.T.)
      return .F.
   endif
   if (Arg1:gencode() == 40 .AND. Arg1:candefault())
      neterr(.T.)
      return .F.
   endif
   Local2:= errormessa(Arg1)
   Local3:= {"Quit"}
   if (Arg1:canretry())
      AAdd(Local3, "Retry")
   endif
   if (Arg1:candefault())
      AAdd(Local3, "Default")
   endif
   Local4:= 0
   do while (Local4 == 0)
      if (Empty(Arg1:oscode()))
         Local4:= alert(Local2, Local3)
      else
         Local4:= alert(Local2 + ";(DOS Error " + ;
            LTrim(Str(Arg1:oscode())) + ")", Local3)
      endif
      if (ISNIL(Local4))
         exit
      endif
   enddo
   if (!Empty(Local4))
      if (Local3[Local4] == "Break")
         break(Arg1)
      elseif (Local3[Local4] == "Retry")
         return .T.
      elseif (Local3[Local4] == "Default")
         return .F.
      endif
   endif
   if (!Empty(Arg1:oscode()))
      Local2:= Local2 + (" (DOS Error " + LTrim(Str(Arg1:oscode())) ;
         + ") ")
   endif
   outerr(Chr(13) + Chr(10))
   outerr(Local2)
   Local1:= 2
   do while (!Empty(procname(Local1)))
      outerr(Chr(13) + Chr(10))
      outerr("Called from", Trim(procname(Local1)) + "(" + ;
         LTrim(Str(procline(Local1))) + ")  ")
      Local1++
   enddo
   errorlevel(1)
   quit
   return .F.

********************************
function GETPOSTVAL(Arg1)

   local Local1, Local2
   Local2:= .T.
   if (Arg1:exitstate() == 7)
      return .T.
   endif
   if (Arg1:baddate())
      Arg1:home()
      datemsg()
      showscoreb()
      return .F.
   endif
   if (Arg1:changed())
      Arg1:assign()
      Static6:= .T.
   endif
   Arg1:reset()
   if (!(ISNIL(Arg1:postblock())))
      Local1:= Static6
      SetPos(Arg1:row(), Arg1:col() + Len(Arg1:buffer()))
      Local2:= eval(Arg1:postblock(), Arg1)
      SetPos(Arg1:row(), Arg1:col())
      showscoreb()
      Arg1:updatebuff()
      Static6:= Local1
      if (Static7)
         Arg1:exitstate(7)
         Local2:= .T.
      endif
   endif
   return Local2

********************************
static procedure DATEMSG

   local Local1, Local2
   if (Set(_SET_SCOREBOARD))
      Local1:= Row()
      Local2:= Col()
      SetPos(0, 60)
      dispout(nationmsg(9))
      SetPos(Local1, Local2)
      do while (nextkey() == 0)
      enddo
      SetPos(0, 60)
      dispout(Space(Len(nationmsg(9))))
      SetPos(Local1, Local2)
   endif
   return

********************************
function READUPDATE(Arg1)

   local Local1
   Local1:= Static6
   if (PCount() > 0)
      Static6:= Arg1
   endif
   return Local1

********************************
function READFORMAT(Arg1)

   local Local1
   Local1:= Static5
   if (PCount() > 0)
      Static5:= Arg1
   endif
   return Local1

********************************
function IMPRIORC(Arg1, Arg2)

   if (impressora() == 1)
      nvaltot:= 0
      nnoviasimp:= 0
      nvias:= nviasped
      close databases
      select 1
      close format
      mostrar("*** Imprimindo ****")
      select 1
      if (!abredbf("ORCAMENT", "ORCAMEN1.NTX"))
         return .F.
      endif
      select 2
      if (!abredbf("ORC_MAT", "ORC_MAT.NTX"))
         return .F.
      endif
      select 3
      if (!abredbf("PRODUTOS", "PRODUTO1.NTX"))
         return .F.
      endif
      select 4
      if (!abredbf("CLIENTES", "CLIENTE1.NTX"))
         return .F.
      endif
      select 5
      if (!abredbf("FUNCIONA", "FUNCION1.NTX"))
         return .F.
      endif
      do while (nnoviasimp != nvias)
         lin:= 6
         npt:= 0
         vtt:= 0
         pag:= 0
         tot:= 0
         cli:= 0
         select 1
         seek Arg1
         if (Found())
            set device to printer
            drvimpr:= cportaped
            set printer to (drvimpr)
            @ PRow(), PCol() say "C" + Chr(nlinform)
            cv:= vendedor
            nr:= numero
            cc:= cliente
            vtt:= valor_tot
            npt:= 0
            vlr:= valor_tot
            ncodcli:= cliente
            ncodvend:= vendedor
            cavista:= form_pgto
            cnomcli:= nome_cli
            ndesc:= desconto
            nacresc:= acrescimo
            nloja:= loja
            if (ncodcli != 1)
               select 4
               set order to 1
               seek ncodcli
               if (Found())
                  cnomecli:= nome_cli
                  cenderecli:= endere_cli
                  cpessoa:= pessoa_cli
                  cbairrocli:= bairro_cli
                  ccidadecli:= cidade_cli
                  cestadocli:= estado_cli
                  ccepcli:= cep_cli
                  cfonecli:= fone_cli
                  ccompracli:= compra_cli
                  cfonecom:= fone_com
                  cobs1:= obs1
                  cobs2:= obs2
                  ccpf:= cpf_cli
                  cci:= identi_cli
                  ccgc:= cgc_cli
                  cinsc:= insc_cli
               else
                  cnomecli:= "*** Cliente Nao Cadastrado ***"
                  cpessoa:= " "
                  cenderecli:= " "
                  cbairrocli:= " "
                  ccidadecli:= " "
                  cestadocli:= " "
                  ccepcli:= " "
                  cfonecli:= " "
                  ccompracli:= " "
                  cfonecom:= " "
                  cobs1:= " "
                  cobs2:= " "
                  ccpf:= " "
                  cci:= " "
                  ccgc:= " "
                  cinsc:= " "
               endif
            else
               select 1
               cnomecli:= cnomcli
               cpessoa:= "F"
               ccpf:= "  "
               ccgc:= "  "
               cenderecli:= "  "
               cbairrocli:= "  "
               ccidadecli:= "  "
               cestadocli:= "  "
               ccepcli:= "  "
               cfonecli:= "  "
               ccompracli:= " "
               cfonecom:= " "
               cobs1:= " "
               cobs2:= " "
            endif
            select 5
            seek ncodvend
            if (EOF())
               cnomevend:= "*** Vendedor Nao Cadastrado ***"
            else
               cnomevend:= nome
            endif
            select 1
            cabped()
            select 2
            seek Arg1
            do while (!EOF() .AND. numero_ped = Arg2)
               if (lin > nalturafor)
                  select Orcament
                  cabped()
                  select Orc_Mat
               endif
               cm:= codigo_mat
               select 3
               seek cm
               if (EOF())
                  nm:= "*** Material Nao Incluso ***"
                  cmarca:= "******"
               else
                  nm:= descricao
                  cmarca:= marca
               endif
               select 2
               npt:= quantidade * valor
               ctamanho:= tamanho
               @ lin,  1 say cm + " " + SubStr(nm, 1, 36)
               @ lin, 44 say ctamanho
               @ lin, 54 say quantidade picture "99999"
               @ lin, 62 say valor picture "99999.99"
               @ lin, 72 say npt picture "99999.99"
               lin++
               skip 
            enddo
            select 1
            skip 
         endif
         @ lin,  0 say Replicate("-", 80)
         @ lin + 1, 46 say "Desconto.....:"
         @ lin + 1, 66 say ndesc picture "999,999,999.99"
         @ lin + 2, 46 say "Acrescimo....:"
         @ lin + 2, 66 say nacresc picture "999,999,999.99"
         @ lin + 3, 46 say "Valor total..:"
         @ lin + 3, 66 say vtt picture "999,999,999.99"
         if (ccabped = "1" .OR. ccabped = "2")
            @ lin + 9, 10 say Replicate("-", 52)
            @ lin + 10, 10 say ncodcli
            @ lin + 10, 16 say "- " + cnomcli
            if (ccabped = "2")
               @ lin + 11, 10 say cenderecli + " " + cbairrocli
               @ lin + 12, 10 say ccidadecli + " " + cestadocli + ;
                  " " + ccepcli + " " + cfonecli
               @ lin + 13, 10 say ccompracli + " " + cfonecom
            endif
         endif
         select 1
         set device to screen
         nnoviasimp++
         eject
         nvaltot:= 0
      enddo
      close databases
      select 1
      close format
   else
      return
   endif

********************************
procedure IMPCONTASA(Arg1)

   ncont:= 0
   do while (.T.)
      select 2
      use ContasAR shared readonly index ContAR2
      if (ncont > 3)
         alert("Erro na abertura de arquivo! Operao ser  cancelada.")
         lcontrole:= .F.
      endif
      if (neterr())
         InKey(2)
         ncont++
         loop
      else
         exit
      endif
   enddo
   select 2
   seek Arg1
   if (Found())
      cimpcab:= "S"
      ncont:= 0
      do while (cod_cli_ar = Arg1)
         skip 
      enddo
      skip -1
      do while (cod_cli_ar = Arg1)
         if (ncont >= nnumtitulo .AND. nnumtitulo != 0)
            skip -1
            loop
         endif
         if (cimpcab = "S")
            @ nlinha,  1 say ccoluna2
            nlinha++
            cimpcab:= "N"
         endif
         ctipo:= tip_doc_ar
         ddt_venc:= dt_venc_ar
         nval_tit:= val_tit_ar
         cnumdoc:= num_doc_ar
         @ nlinha,  1 say ctipo
         @ nlinha, 13 say cnumdoc
         @ nlinha, 27 say ddt_venc
         @ nlinha, 40 say nval_tit
         if (situaca_ar == "P")
            @ nlinha, 55 say "PROTESTADO"
         endif
         ncont++
         skip -1
         nlinha++
         nlinha:= pula411(nlinha)
      enddo
   endif
   select Clientes
   return

********************************
function __GETSETPI(Arg1)

   if (!(ISNIL(Arg1)))
      qself()[3]:= Arg1
   endif
   return qself()[3]

********************************
function __GETSETPB(Arg1)

   if (!(ISNIL(Arg1)))
      qself()[4]:= Arg1
   endif
   return qself()[4]

********************************
function __MENUTO(Arg1, Arg2)

   local Local1, Local2, Local3, Local4, Local5, Local6, Local7, ;
      Local8, Local9, Local10, Local11, Local12, Local13, Local14, ;
      Local15, Local16
   Local13:= Static3
   Local14:= Set(_SET_MESSAGE)
   Local15:= Set(_SET_MCENTER)
   Local16:= readvar(Upper(Arg2))
   Static3:= {}
   Local11:= errorblock({|_1| break(_1)})
   begin sequence
      Local2:= eval(Arg1)
      Local12:= .F.
   recover
      Local12:= .T.
   end sequence
   errorblock(Local11)
   if (Local12)
      __qqpub(Arg2)
   endif
   if (ValType(Local2) != "N" .OR. Local2 < 1)
      Local2:= 1
   endif
   if (Local2 > Len(Local13))
      Local2:= Len(Local13)
   endif
   if (Set(_SET_INTENSITY))
      Local8:= setcursor(0)
   endif
   Local7:= .F.
   Local6:= ""
   Local9:= 0
   do while (Local2 != 0)
      Local5:= 0
      Local1:= Local13[Local2]
      if (Set(_SET_INTENSITY))
         colorselec(1)
      endif
      SetPos(Local1[1], Local1[2])
      dispout(Local1[3])
      if (Set(_SET_INTENSITY))
         colorselec(0)
      endif
      if (Local14 != 0)
         if (!Empty(Local6))
            SetPos(Local14, Local9)
            dispout(Space(Len(Local6)))
         endif
         Local6:= Local1[4]
         if (ISBLOCK(Local6))
            Local6:= eval(Local6)
         elseif (ValType(Local6) == "U")
            Local6:= ""
         endif
         if (Local15)
            Local9:= Int((MaxCol() - Len(Local6)) / 2)
         endif
         SetPos(Local14, Local9)
         dispout(Local6)
         SetPos(Local1[1], Local1[2])
      endif
      if (Local7)
         exit
      endif
      do while (Local5 == 0)
         Local5:= InKey(0)
         if ((Local10:= SetKey(Local5)) != Nil)
            eval(Arg1, Local2)
            eval(Local10, procname(1), procline(1), Upper(Arg2))
            Local2:= eval(Arg1)
            Local5:= 0
         endif
      enddo
      if (Local2 > Len(Local13))
         Local2:= Len(Local13)
      endif
      do case
      case Local5 == 5 .OR. Local5 == 19
         if (--Local2 < 1)
            Local2:= iif(Set(_SET_WRAP), Len(Local13), 1)
         endif
      case Local5 == 24 .OR. Local5 == 4
         if (++Local2 > Len(Local13))
            Local2:= iif(Set(_SET_WRAP), 1, Len(Local13))
         endif
      case Local5 == 1
         Local2:= 1
      case Local5 == 6
         Local2:= Len(Local13)
      case Local5 == 18
         Local7:= .T.
      case Local5 == 3
         Local7:= .T.
      case Local5 == 13
         Local7:= .T.
      case Local5 == 27
         Local2:= 0
      otherwise
         Local4:= Upper(Chr(Local5))
         Local3:= ascan(Local13, {|_1| Local4 == ;
            Left(Upper(LTrim(_1[3])), 1)})
         if (Local3 != 0)
            Local2:= Local3
            Local7:= .T.
         endif
      endcase
      if (Local2 != 0)
         SetPos(Local1[1], Local1[2])
         dispout(Local1[3])
      endif
   enddo
   setcursor(Local8)
   eval(Arg1, Local2)
   if (Local12)
      release (Arg2)
   endif
   if (!Empty(Local16))
      readvar(Local16)
   endif
   SetPos(MaxRow() - 1, 0)
   return Local2

********************************
function _DTXCONDSE(Arg1, Arg2, Arg3, Arg4, Arg5, Arg6, Arg7, Arg8, ;
   Arg9, Arg10, Arg11)

   return ordcondset(Arg1, Arg2, Arg3, Arg4, Arg5, Arg6, Arg8, Arg9, ;
      Arg10, Arg11)

********************************
function DBCREATEIN(Arg1, Arg2, Arg3, Arg4, Arg5)

   ordcreate(Arg1, Arg5, Arg2, Arg3, Arg4)
   return Nil

********************************
procedure GETAPPLYKE(Arg1, Arg2)

   local Local1, Local2
   if (!(ISNIL(Local2:= SetKey(Arg2))))
      getdosetke(Local2, Arg1)
   else
      do case
      case Arg2 == 5
         Arg1:exitstate(1)
      case Arg2 == 271
         Arg1:exitstate(1)
      case Arg2 == 24
         Arg1:exitstate(2)
      case Arg2 == 9
         Arg1:exitstate(2)
      case Arg2 == 13
         Arg1:exitstate(5)
      case Arg2 == 27
         if (Set(_SET_ESCAPE))
            Arg1:undo()
            Arg1:exitstate(7)
         endif
      case Arg2 == 18
         Arg1:exitstate(6)
      case Arg2 == 3
         Arg1:exitstate(6)
      case Arg2 == 29
         Arg1:exitstate(3)
      case Arg2 == 23
         Arg1:exitstate(6)
      case Arg2 == 22
         Set(_SET_INSERT, !Set(_SET_INSERT))
         showscoreb()
      case Arg2 == 21
         Arg1:undo()
      case Arg2 == 1
         Arg1:home()
      case Arg2 == 6
         Arg1:end()
      case Arg2 == 4
         Arg1:right()
      case Arg2 == 19
         Arg1:left()
      case Arg2 == 2
         Arg1:wordright()
      case Arg2 == 26
         Arg1:wordleft()
      case Arg2 == 8
         Arg1:backspace()
      case Arg2 == 7
         Arg1:delete()
      case Arg2 == 20
         Arg1:delwordrig()
      case Arg2 == 25
         Arg1:delend()
      case Arg2 == 127
         Arg1:delwordlef()
      otherwise
         if (Arg2 >= 32 .AND. Arg2 <= 255)
            Local1:= Chr(Arg2)
            if (Arg1:type() == "N" .AND. (Local1 == "." .OR. Local1 ;
                  == ","))
               Arg1:todecpos()
            else
               if (Set(_SET_INSERT))
                  Arg1:insert(Local1)
               else
                  Arg1:overstrike(Local1)
               endif
               if (Arg1:typeout())
                  if (Set(_SET_BELL))
                     ?? ""
                  endif
                  if (!Set(_SET_CONFIRM))
                     Arg1:exitstate(5)
                  endif
               endif
            endif
         endif
      endcase
      return
   endif

********************************
function GETPREVALI(Arg1)

   local Local1, Local2
   Local2:= .T.
   if (!(ISNIL(Arg1:preblock())))
      Local1:= Static6
      Local2:= eval(Arg1:preblock(), Arg1)
      Arg1:display()
      showscoreb()
      Static6:= Local1
   endif
   if (Static7)
      Local2:= .F.
      Arg1:exitstate(7)
   elseif (!Local2)
      Arg1:exitstate(8)
   else
      Arg1:exitstate(0)
   endif
   return Local2

********************************
static function CLEARGETSY

   local Local1[9]
   Local1[1]:= Static7
   Local1[2]:= Static8
   Local1[3]:= Static9
   Local1[4]:= Static10
   Local1[5]:= Static11
   Local1[6]:= getactive(Nil)
   Local1[7]:= readvar("")
   Local1[8]:= Static13
   Local1[9]:= Static14
   Static7:= .F.
   Static8:= .F.
   Static9:= .F.
   Static10:= 0
   Static11:= 0
   Static13:= ""
   Static14:= 0
   Static6:= .F.
   return Local1

********************************
procedure __KILLREAD

   Static7:= .T.
   return

********************************
function __TSETFOOT(Arg1)

   if (!(ISNIL(Arg1)))
      qself()[9]:= _einstvar(qself(), "FOOTSEP", Arg1, "C", 1001)
   endif
   return qself()[9]

********************************
function __TSETCOLO(Arg1)

   if (!(ISNIL(Arg1)))
      qself()[10]:= _einstvar(qself(), "COLORSPEC", Arg1, "C", 1001)
      qself():configure(1)
   endif
   return qself()[10]

********************************
function __TSETSKIP(Arg1)

   if (!(ISNIL(Arg1)))
      qself()[11]:= _einstvar(qself(), "SKIPBLOCK", Arg1, "B", 1001)
   endif
   return qself()[11]

********************************
function __TSETTOP(Arg1)

   if (!(ISNIL(Arg1)))
      qself()[12]:= _einstvar(qself(), "GOTOPBLOCK", Arg1, "B", 1001)
   endif
   return qself()[12]

********************************
function __TSETBOTT(Arg1)

   if (!(ISNIL(Arg1)))
      qself()[13]:= _einstvar(qself(), "GOBOTTOMBL", Arg1, "B", 1001)
   endif
   return qself()[13]

********************************
function __TINSCOLU(Arg1, Arg2)

   asize(qself()[6], Len(qself()[6]) + 1)
   ains(qself()[6], Arg1)
   qself()[6][Arg1]:= Arg2
   qself():configure(2)
   return Arg2

********************************
function __TDELCOLU(Arg1)

   local Local1
   Local1:= qself()[6][Arg1]
   adel(qself()[6], Arg1)
   asize(qself()[6], Len(qself()[6]) - 1)
   qself():configure(2)
   return Local1

********************************
function TBROWSENEW(Arg1, Arg2, Arg3, Arg4)

   local Local1[14]
   default Arg1 to 0
   default Arg2 to 0
   default Arg3 to MaxRow()
   default Arg4 to MaxCol()
   __totbrows(Local1)
   Local1:ntop(Arg1)
   Local1:nleft(Arg2)
   Local1:nbottom(Arg3)
   Local1:nright(Arg4)
   Local1[6]:= {}
   Local1[7]:= ""
   Local1[8]:= " "
   Local1[9]:= ""
   Local1[10]:= SetColor()
   Local1[11]:= {|| Nil}
   Local1[12]:= {|| Nil}
   Local1[13]:= {|| Nil}
   Local1:autolite(.T.)
   Local1:colpos(1)
   Local1:freeze(0)
   Local1:hitbottom(.F.)
   Local1:hittop(.F.)
   return Local1

********************************
function __CSETWIDT(Arg1)

   if (Arg1 != Nil)
      qself()[2]:= _einstvar(qself(), "WIDTH", Arg1, "N", 1001)
   endif
   return qself()[2]

********************************
function __CSETBLOC(Arg1)

   if (Arg1 != Nil)
      qself()[3]:= _einstvar(qself(), "BLOCK", Arg1, "B", 1001)
   endif
   return qself()[3]

********************************
function __CSETDEFC(Arg1)

   if (Arg1 != Nil)
      qself()[4]:= _einstvar(qself(), "DEFCOLOR", Arg1, "A", 1001)
   endif
   return qself()[4]

********************************
function __CSETCOLO(Arg1)

   if (Arg1 != Nil)
      qself()[5]:= _einstvar(qself(), "COLORBLOCK", Arg1, "B", 1001)
   endif
   return qself()[5]

********************************
function __CSETHEAD(Arg1)

   if (Arg1 != Nil)
      qself()[6]:= _einstvar(qself(), "HEADING", Arg1, "C", 1001)
   endif
   return qself()[6]

********************************
function __CSETFOOT(Arg1)

   if (Arg1 != Nil)
      qself()[10]:= _einstvar(qself(), "FOOTING", Arg1, "C", 1001)
   endif
   return qself()[10]

********************************
function __CSETPICT(Arg1)

   if (!(ISNIL(Arg1)))
      qself()[11]:= Arg1
   endif
   return qself()[11]

********************************
function __CSETHSEP(Arg1)

   local Local1
   if (Arg1 != Nil)
      Local1:= _einstvar(qself(), "HEADSEP", Arg1, "C", 1001)
   endif
   if (PCount() == 1)
      qself()[7]:= Local1
   endif
   return qself()[7]

********************************
function __CSETFSEP(Arg1)

   local Local1
   if (Arg1 != Nil)
      Local1:= _einstvar(qself(), "FOOTSEP", Arg1, "C", 1001)
   endif
   if (PCount() == 1)
      qself()[9]:= Local1
   endif
   return qself()[9]

********************************
function __CSETCOLS(Arg1)

   local Local1
   if (Arg1 != Nil)
      Local1:= _einstvar(qself(), "COLSEP", Arg1, "C", 1001)
   endif
   if (PCount() == 1)
      qself()[8]:= Local1
   endif
   return qself()[8]

********************************
function TBCOLUMNNE(Arg1, Arg2)

   local Local1[11]
   Local1[6]:= Arg1
   Local1[3]:= Arg2
   Local1[4]:= {1, 2}
   Local1[5]:= {|| Nil}
   Local1[8]:= Nil
   Local1[10]:= ""
   Local1[9]:= Nil
   Local1[7]:= Nil
   __totbcolu(Local1)
   return Local1

********************************
static function SKIPPED(Arg1)

   local Local1
   Local1:= 0
   if (LastRec() != 0)
      if (Arg1 == 0)
         if (EOF() .AND. !Static1)
            skip -1
            Local1:= -1
         else
            skip 0
         endif
      elseif (Arg1 > 0 .AND. RecNo() != LastRec() + 1)
         do while (Local1 < Arg1)
            skip 
            if (EOF())
               if (Static1)
                  Local1++
               else
                  skip -1
               endif
               exit
            endif
            Local1++
         enddo
      elseif (Arg1 < 0)
         do while (Local1 > Arg1)
            skip -1
            if (BOF())
               exit
            endif
            Local1--
         enddo
      endif
   endif
   return Local1

********************************
static function EMPTYFILE

   if (LastRec() == 0)
      return .T.
   endif
   if ((EOF() .OR. RecNo() == LastRec() + 1) .AND. BOF())
      return .T.
   endif
   return .F.

********************************
static function CALLUSER(Arg1, Arg2, Arg3)

   local Local1, Local2, Local3, Local4
   do case
   case Arg3 != 0
      Local1:= 4
   case !Static1 .AND. emptyfile()
      Local1:= 3
   case Arg1:hitbottom()
      Local1:= 2
   case Arg1:hittop()
      Local1:= 1
   otherwise
      Local1:= 0
   endcase
   do while (!Arg1:stabilize())
   enddo
   Local3:= RecNo()
   if (ValType(Arg2) != "C" .OR. Empty(Arg2))
      if (Arg3 == 13 .OR. Arg3 == 27)
         Local2:= 0
      else
         Local2:= 1
      endif
   else
      Local2:= &Arg2(Local1, Arg1:colpos())
   endif
   Local4:= Local2 != 0
   if (!Static1 .AND. EOF() .AND. !emptyfile())
      skip -1
   endif
   if (Local2 == 3)
      Static1:= !(Static1 .AND. EOF())
      if (Static1)
         goto bottom
         Arg1:down()
      else
         Arg1:refreshcur()
      endif
      Static2:= .F.
   elseif (Local2 == 2 .OR. Local3 != RecNo())
      if (Local4)
         Static1:= .F.
         if (Set(_SET_DELETED) .AND. Deleted() .OR. ;
               !Empty(dbfilter()) .AND. !&(dbfilter()))
            skip 
         endif
         if (EOF())
            goto bottom
         endif
         Local3:= RecNo()
         Arg1:refreshall()
         do while (!Arg1:stabilize())
         enddo
         do while (Local3 != RecNo())
            Arg1:up()
            do while (!Arg1:stabilize())
            enddo
         enddo
         Static2:= .F.
      endif
   else
      Arg1:refreshcur()
   endif
   return Local4

********************************
static function DBEDSETUP(Arg1, Arg2, Arg3, Arg4, Arg5, Arg6, Arg7, ;
   Arg8, Arg9, Arg10, Arg11, Arg12)

   local Local1, Local2, Local3, Local4, Local5, Local6, Local7, ;
      Local8
   if (ValType(Arg1) != "N" .OR. Arg1 < 0)
      Arg1:= 0
   endif
   if (ValType(Arg2) != "N" .OR. Arg2 < 0)
      Arg2:= 0
   endif
   if (ValType(Arg3) != "N" .OR. Arg3 > MaxRow() .OR. Arg3 < Arg1)
      Arg3:= MaxRow()
   endif
   if (ValType(Arg4) != "N" .OR. Arg4 > MaxCol() .OR. Arg4 < Arg2)
      Arg4:= MaxCol()
   endif
   if ((Arg4 - Arg2) * (Arg3 - Arg1) > MaxRow() * MaxCol())
      Arg1:= Arg2:= 0
      Arg3:= MaxRow()
      Arg4:= MaxCol()
   endif
   Local1:= tbrowsedb(Arg1, Arg2, Arg3, Arg4)
   if (ISARRAY(Arg5))
      Local3:= Len(Arg5)
      Local2:= 1
      do while (Local2 <= Local3)
         if (ValType(Arg5[Local2]) != "C" .OR. Empty(Arg5[Local2]))
            exit
         endif
         Local2++
      enddo
      Local3:= Local2 - 1
   else
      Local3:= FCount()
   endif
   if (Local3 == 0)
      return .F.
   endif
   Local1:headsep("ÍÑÍ")
   Local1:colsep(" ³ ")
   Local4:= array(Local3, 6)
   if (ISARRAY(Arg5))
      for Local2:= 1 to Local3
         if ("->" $ Arg5[Local2])
            Local6:= At("->", Arg5[Local2])
            Local4[Local2][3]:= SubStr(Arg5[Local2], 1, Local6 - 1)
            Local4[Local2][4]:= SubStr(Arg5[Local2], Local6 + 2)
            Local4[Local2][1]:= Local4[Local2][3] + "->;" + ;
               Local4[Local2][4]
         else
            Local4[Local2][3]:= Nil
            Local4[Local2][4]:= Nil
            Local4[Local2][1]:= Arg5[Local2]
         endif
         Local4[Local2][2]:= Arg5[Local2]
      next
   elseif (FCount() > 0)
      for Local2:= 1 to Local3
         Local4[Local2][3]:= Nil
         Local4[Local2][4]:= Nil
         Local4[Local2][1]:= FieldName(Local2)
         Local4[Local2][2]:= FieldName(Local2)
      next
   else
      return .F.
   endif
   for Local2:= 1 to Local3
      Local5:= ""
      if (ISARRAY(Arg7))
         if (Len(Arg7) >= Local2 .AND. ISCHARACTER(Arg7[Local2]) ;
               .AND. !Empty(Arg7[Local2]))
            Local5:= Arg7[Local2]
         endif
      elseif (ISCHARACTER(Arg7) .AND. !Empty(Arg7))
         Local5:= Arg7
      endif
      Local7:= Nil
      if (ISMEMO(&(Local4[Local2][2])))
         Local7:= "{|| '  <Memo>  '}"
      elseif (Empty(Local5))
         if ("->" $ Local4[Local2][2])
            if (Upper(Local4[Local2][3]) == "M")
               Local7:= memvarbloc(Local4[Local2][2])
            elseif (Upper(Local4[Local2][3]) == "FIELD")
               Local7:= fieldwbloc(Local4[Local2][4], Select())
            else
               Local7:= fieldwbloc(Local4[Local2][4], ;
                  Select(Local4[Local2][3]))
            endif
         elseif (!Empty(fieldpos(Local4[Local2][2])))
            Local7:= fieldwbloc(Local4[Local2][2], Select())
         endif
      endif
      if (ISNIL(Local7))
         if (Empty(Local5))
            Local7:= "{||" + Local4[Local2][2] + "}"
         else
            Local7:= "{|| Transform(" + Local4[Local2][2] + ",'" + ;
               Local5 + "')}"
         endif
      endif
      if (ISCHARACTER(Local7))
         Local4[Local2][2]:= &Local7
      elseif (ISBLOCK(Local7))
         Local4[Local2][2]:= Local7
      endif
      if (ISARRAY(Arg8))
         if (Len(Arg8) >= Local2 .AND. ISCHARACTER(Arg8[Local2]))
            Local4[Local2][1]:= Arg8[Local2]
         endif
      elseif (ISCHARACTER(Arg8))
         Local4[Local2][1]:= Arg8
      endif
      Local4[Local2][3]:= Nil
      if (ISARRAY(Arg9))
         if (Len(Arg9) >= Local2 .AND. ISCHARACTER(Arg9[Local2]))
            Local4[Local2][3]:= Arg9[Local2]
         endif
      elseif (ISCHARACTER(Arg9))
         Local4[Local2][3]:= Arg9
      endif
      Local4[Local2][4]:= Nil
      if (ISARRAY(Arg10))
         if (Len(Arg10) >= Local2 .AND. ISCHARACTER(Arg10[Local2]))
            Local4[Local2][4]:= Arg10[Local2]
         endif
      elseif (ISCHARACTER(Arg10))
         Local4[Local2][4]:= Arg10
      endif
      Local4[Local2][5]:= Nil
      if (ISARRAY(Arg11))
         if (Len(Arg11) >= Local2 .AND. ISCHARACTER(Arg11[Local2]))
            Local4[Local2][5]:= Arg11[Local2]
         endif
      elseif (ISCHARACTER(Arg11))
         Local4[Local2][5]:= Arg11
      endif
      Local4[Local2][6]:= Nil
      if (ISARRAY(Arg12))
         if (Len(Arg12) >= Local2 .AND. ISCHARACTER(Arg12[Local2]))
            Local4[Local2][6]:= Arg12[Local2]
         endif
      elseif (ISCHARACTER(Arg12))
         Local4[Local2][6]:= Arg12
      endif
   next
   for Local2:= 1 to Local3
      Local8:= tbcolumnne(Local4[Local2][1], Local4[Local2][2])
      if (Local4[Local2][3] != Nil)
         Local8:headsep(Local4[Local2][3])
      endif
      if (Local4[Local2][4] != Nil)
         Local8:colsep(Local4[Local2][4])
      endif
      if (Local4[Local2][5] != Nil)
         Local8:footsep(Local4[Local2][5])
      endif
      if (Local4[Local2][6] != Nil)
         Local8:footing(Local4[Local2][6])
      endif
      Local1:addcolumn(Local8)
   next
   return Local1

********************************
init procedure INITHANDL

   local Local1
   Local1:= errorblock({|_1| lockerrhan(_1, Local1)})
   return

********************************
static function LOCKERRHAN(Arg1, Arg2)

   if (Arg1:gencode() == 41)
      return .T.
   endif
   return eval(Arg2, Arg1)

********************************
init procedure DBFNTXINI

   rddregiste("DBFNTX", 1)
   return

********************************
function DBEDIT(Arg1, Arg2, Arg3, Arg4, Arg5, Arg6, Arg7, Arg8, ;
   Arg9, Arg10, Arg11, Arg12)

   local Local1, Local2, Local3, Local4, Local5, Local6, Local7
   if (EOF())
      goto bottom
   endif
   Local1:= dbedsetup(Arg1, Arg2, Arg3, Arg4, Arg5, Arg6, Arg7, ;
      Arg8, Arg9, Arg10, Arg11, Arg12)
   Local1:skipblock({|_1| skipped(_1)})
   Local1:autolite(.F.)
   Local2:= setcursor(0)
   Local7:= {Static1, Static2}
   Static1:= .F.
   Static2:= .T.
   Local5:= .T.
   Local3:= .T.
   do while (Local3)
      do while (!Local1:stabilize())
         if (nextkey() != 0)
            exit
         endif
      enddo
      if ((Local4:= InKey()) == 0)
         if (Local5)
            Local3:= calluser(Local1, Arg6, 0)
            do while (!Local1:stabilize())
            enddo
         endif
         if (Local3 .AND. Static2)
            Local1:hilite()
            Local4:= InKey(0)
            Local1:dehilite()
            if ((Local6:= SetKey(Local4)) != Nil)
               eval(Local6, procname(1), procline(1), "")
               loop
            endif
         else
            Static2:= .T.
         endif
      endif
      Local5:= .T.
      do case
      case Local4 == 0
      case Local4 == 24
         if (Static1)
            Local1:hitbottom(.T.)
         else
            Local1:down()
         endif
      case Local4 == 5
         if (Static1)
            Local1:hittop(.T.)
         else
            Local1:up()
         endif
      case Local4 == 3
         if (Static1)
            Local1:hitbottom(.T.)
         else
            Local1:pagedown()
         endif
      case Local4 == 18
         if (Static1)
            Local1:hittop(.T.)
         else
            Local1:pageup()
         endif
      case Local4 == 31
         if (Static1)
            Local1:hittop(.T.)
         else
            Local1:gotop()
         endif
      case Local4 == 30
         if (Static1)
            Local1:hitbottom(.T.)
         else
            Local1:gobottom()
         endif
      case Local4 == 4
         Local1:right()
      case Local4 == 19
         Local1:left()
      case Local4 == 1
         Local1:home()
      case Local4 == 6
         Local1:end()
      case Local4 == 26
         Local1:panleft()
      case Local4 == 2
         Local1:panright()
      case Local4 == 29
         Local1:panhome()
      case Local4 == 23
         Local1:panend()
      otherwise
         Local3:= calluser(Local1, Arg6, Local4)
         Local5:= .F.
      endcase
   enddo
   setcursor(Local2)
   Static1:= Local7[1]
   Static2:= Local7[2]
   return .T.

********************************
function _EINSTVAR(Arg1, Arg2, Arg3, Arg4, Arg5, Arg6, Arg7)

   local Local1, Local2
   Local2:= .F.
   if (ValType(Arg3) == Arg4)
      if (!(ISNIL(Arg6)))
         Local2:= !(Arg3 >= Arg6)
      endif
      if (!(ISNIL(Arg7)))
         Local2:= !(Arg3 <= Arg7)
      endif
   else
      Local2:= .T.
   endif
   if (Local2 .AND. ValType((Local1:= errornew(), Local1:gencode(1), ;
         Local1:severity(2), Local1:subsystem(Arg1:classname()), ;
         Local1:subcode(Arg5), Local1:args({Arg3}), ;
         Local1:cansubsti(.T.), Arg3:= eval(errorblock(), Local1), ;
         Arg3)) != Arg4)
      errorinhan()
   endif
   return Arg3

********************************
init procedure DBFINIT

   rddregiste("DBF", 1)
   return

********************************
procedure QSR11I

   private cbanco, nagencia, nlinhafim, lcontrole, ctela, ncoluna, ;
      nlinha
   private ccor, vet[2], nresp, ncont
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   cbanco:= 0
   nagencia:= Space(30)
   nlinhafim:= 0
   ncoluna:= 25
   nlinha:= 3
   tela11i:= nlinha + 9
   lcontrole:= .T.
   ctela:= SaveScreen(0, 0, 24, 79)
   vet[1]:= "Sim"
   vet[2]:= "Nao"
   janela(nlinha, ncoluna, tela11i, ncoluna + 33, ;
      " Incluso de Contas Correntes ")
   do while (lcontrole)
      conta_bc()
      read
      if (sai(""))
         loop
      endif
      if (!conflinha("Confirma Inclusao ?", tela11i, ncoluna + 1))
         loop
      endif
      if (!abredbf("Bancos", "Bancos1.NTX"))
         loop
      endif
      if (!adiciona())
         loop
      endif
      if (!bloqueia())
         loop
      endif
      replace ag_ban_bc with cbanco
      replace nom_ban_bc with nagencia
      replace valcontai with nlinhafim
      close
      cbanco:= 0
      nagencia:= Space(30)
      nlinhafim:= 0
   enddo
   close databases
   select 1
   close format
   RestScreen(0, 0, 24, 79, ctela)
   set color to (ccor)
   return

********************************
function TELA11I

   @ nlinha + 2, ncoluna + 2 say "N§ da Conta"
   @ nlinha + 4, ncoluna + 2 say "Nome do Banco"
   @ nlinha + 6, ncoluna + 2 say "N§ da Agencia"
   @ nlinha + 3, ncoluna + 2 get cConta picture "99999999999999" ;
      valid valbanco()
   @ nlinha + 5, ncoluna + 2 get cBanco picture "@!" valid nagencia ;
      != " "
   @ nlinha + 7, ncoluna + 2 get nAgencia picture "9999" valid ;
      nlinhafim != 0
   return .T.

********************************
function VALCONTAI

   if (procura("BANCOS", "BANCOS1", "cConta", "BANCO_BC") != "*")
      alert("Registro ja Encontrado")
      return .F.
   endif
   return .T.

********************************
function VALBANCO

   if (Empty(nagencia))
      alert("Ateno! No  permitido nome de banco vazio.")
      return .F.
   endif
   return .T.

********************************
function VALAGENCIA

   if (nlinhafim == 0)
      alert("Ateno! No  permitido n§ de agncia igual a zero.")
      return .F.
   endif
   return .T.

********************************
procedure LERREFC12I(Arg1)

   ncoluna:= 1
   if (Arg1 = Nil)
      Arg1:= .F.
      valpess:= SaveScreen(0, 0, 24, 79)
   endif
   janela(nlinha + 5, ncoluna++, nlinha + 11, ncoluna + 77, ;
      "Referencias Comerciais", 2)
   @ nlinha + 6, ncoluna + 0 say "Nome do Referencia"
   @ nlinha + 6, ncoluna + 32 say "Telefone"
   @ nlinha + 6, ncoluna + 46 say "Endereco"
   @ nlinha + 7, ncoluna + 0 get cNomRef1 picture "@!"
   @ nlinha + 7, ncoluna + 32 get cTelRef1 picture "(999)999-9999"
   @ nlinha + 7, ncoluna + 46 get cEndRef1 picture "@!"
   @ nlinha + 8, ncoluna + 0 get cNomRef2 picture "@!"
   @ nlinha + 8, ncoluna + 32 get cTelRef2 picture "(999)999-9999"
   @ nlinha + 8, ncoluna + 46 get cEndRef2 picture "@!"
   @ nlinha + 9, ncoluna + 0 get cNomRef3 picture "@!"
   @ nlinha + 9, ncoluna + 32 get cTelRef3 picture "(999)999-9999"
   @ nlinha + 9, ncoluna + 46 get cEndRef3 picture "@!"
   if (Arg1)
      clear gets
   else
      read
      ncoluna--
      RestScreen(0, 0, 24, 79, valpess)
   endif
   return

********************************
procedure QSR11A

   private nconta, nagencia, nlinhafim, lcontrole, ctela, ncoluna, ;
      nlinha
   private ccor, vet[2], nresp
   cpesquisa:= {"BANCOS", "BANCOS1", "CONTA_BC", "cConta"}
   ccampos:= {"CONTA_BC", "NOM_BAN_BC", "", "CONTA", ;
      "NOME DA CONTA", ""}
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   cbanco:= 0
   nagencia:= Space(30)
   nlinhafim:= 0
   ncoluna:= 25
   nlinha:= 3
   tela11i:= nlinha + 9
   lcontrole:= .T.
   ctela:= SaveScreen(0, 0, 24, 79)
   vet[1]:= "Sim"
   vet[2]:= "Nao"
   janela(nlinha, ncoluna, tela11i, ncoluna + 33, ;
      " Manutencao de Contas Correntes ")
   do while (lcontrole)
      conta_bc()
      clear gets
      @ nlinha + 3, ncoluna + 2 get cConta picture "99999999999999"
      read
      if (sai(""))
         loop
      endif
      if (!abredbf("BANCOS", "BANCOS1.NTX"))
         loop
      endif
      seek cbanco
      if (!Found())
         alert("Registro nao encontrado !")
         close
         loop
      else
         nagencia:= nom_ban_bc
         nlinhafim:= valcontai
      endif
      close
      @ nlinha + 5, ncoluna + 2 get cBanco picture "@!" valid ;
         nagencia != " "
      @ nlinha + 7, ncoluna + 2 get nAgencia picture "9999" valid ;
         nlinhafim != 0
      dbunlockal:= escolhelin({"Altera", "Exclui"}, 2, tela11i, ;
         ncoluna + 1)
      if (dbunlockal == 2)
         clear gets
      else
         read
      endif
      if (sai("", vet))
         loop
      endif
      if (!conflinha("Confirma Operacao ?", tela11i, ncoluna + 1))
         loop
      endif
      if (!abredbf("BANCOS", "BANCOS1.NTX"))
         loop
      endif
      seek cbanco
      if (!Found())
         alert("Erro na Leitura de registro! Operacao sera cancelada.")
         close
         loop
      endif
      if (!bloqueia())
         loop
      endif
      if (dbunlockal == 2)
         delete
      else
         replace nom_ban_bc with nagencia
         replace valcontai with nlinhafim
      endif
      qsr12i()
      close
      cbanco:= 0
      nagencia:= Space(30)
      nlinhafim:= 0
   enddo
   RestScreen(0, 0, 24, 79, ctela)
   set color to (ccor)
   return

********************************
procedure LERBANCO12(Arg1)

   if (Arg1 = Nil)
      Arg1:= .F.
      valpess:= SaveScreen(0, 0, 24, 79)
   endif
   janela(nlinha + 5, ncoluna++, nlinha + 9, ncoluna + 74, ;
      "Informacao Bancaria", 2)
   @ nlinha + 6, ncoluna + 0 say "Conta"
   @ nlinha + 6, ncoluna + 10 say "Nome do Banco"
   @ nlinha + 6, ncoluna + 45 say "Agencia"
   @ nlinha + 7, ncoluna + 0 get nConta picture "99999999"
   @ nlinha + 7, ncoluna + 10 get cNomeBan picture "@!"
   @ nlinha + 7, ncoluna + 45 get nAgencia picture "9999"
   if (Arg1)
      clear gets
   else
      read
      ncoluna--
      RestScreen(0, 0, 24, 79, valpess)
   endif
   return

********************************
procedure LEROBS12I(Arg1)

   ncoluna:= 1
   if (Arg1 = Nil)
      Arg1:= .F.
      valpess:= SaveScreen(0, 0, 24, 79)
   endif
   janela(nlinha + 5, ncoluna++, nlinha + 9, ncoluna + 77, ;
      "Observacoes", 2)
   @ nlinha + 6, ncoluna + 0 say "Observacoes"
   @ nlinha + 7, ncoluna + 0 get cObs1 picture "@!"
   @ nlinha + 8, ncoluna + 0 get cObs2 picture "@!"
   if (Arg1)
      clear gets
   else
      read
      ncoluna--
      RestScreen(0, 0, 24, 79, valpess)
   endif
   return

********************************
procedure QSR12I

   private nloja, ncodigo, cnome, cpessoa, cbairro, cendereco, ;
      cestado, ccidade
   private ctelefone, ccep, ddataincl, ddatanasc, cconjuge, ;
      ccomprador, ccpf, cci
   private ccgc, cinsc, ddtnasccom, ccpfcomp, ccicomp, cfonecomp, ;
      cendecomp, ccepcomp
   private ccidcomp, cbaircomp, crefbanc, ccidbanc, nlinhafim, crefpes
   private cfonerefpe, cenderefpe, ccidrefpes, cbairrefpe, ;
      cceprefpes, cinfo
   private cobs, ddataultc, ddt_1a_com, ncheqdev, nn_pc_ult_
   private nlimitcred, ncredusad, nvend, lcontrole, nlinha, ncoluna, ;
      vet[2]
   private ctela, ccor, fonecomp
   nloja:= 1
   ncodigo:= 0
   cnome:= Space(40)
   cconjuge:= CToD("  /  /  ")
   cpessoa:= Space(1)
   cbairro:= Space(27)
   cendereco:= Space(35)
   cestado:= Space(18)
   ccidade:= Space(20)
   ctelefone:= Space(2)
   ccep:= Space(10)
   ddataincl:= Space(13)
   ddatanasc:= CToD("  /  /  ")
   ccomprador:= Space(30)
   ccpf:= Space(14)
   cci:= Space(18)
   ccgc:= Space(18)
   cinsc:= Space(18)
   ddtnasccom:= Space(30)
   ccpfcomp:= CToD("  /  /  ")
   ccicomp:= Space(14)
   cfonecomp:= Space(18)
   cnomref1:= Space(13)
   ccepcomp:= Space(30)
   ccidcomp:= Space(35)
   cbaircomp:= Space(25)
   crefbanc:= Space(15)
   ctelref1:= Space(30)
   cendref1:= Space(13)
   cnomref2:= Space(30)
   ctelref2:= Space(30)
   cendref2:= Space(13)
   cnomref3:= Space(30)
   ctelref3:= Space(30)
   cendref3:= Space(13)
   cnomeban:= Space(30)
   cpai:= Space(30)
   nconta:= 0
   nlinhafim:= 0
   fonecomp:= 0
   cobs1:= Space(70)
   cobs2:= Space(70)
   ddt_1a_com:= CToD("  /  /  ")
   ncheqdev:= CToD("  /  /  ")
   nn_pc_ult_:= 0
   nlimitcred:= 0
   ncredusad:= 0
   nvend:= 0
   cmae:= Space(30)
   cspc1:= Space(30)
   cspc2:= Space(70)
   cspc3:= Space(70)
   cemptrab:= Space(70)
   cfonetrab:= Space(30)
   dadmissao:= Space(13)
   ccargo:= CToD("  /  /  ")
   nsalario:= Space(15)
   cmen:= 0
   nlinha:= 4
   tela11i:= nlinha + 14
   ncoluna:= 1
   lcontrole:= .T.
   vet[1]:= "Sim"
   vet[2]:= "Nao"
   ctela:= SaveScreen(0, 0, 24, 79)
   ccor:= SetColor()
   ncod12i:= "Deseja Abandonar Inclusao ?"
   janela(nlinha - 1, ncoluna, tela11i, ncoluna + 77, ;
      "Inclusao de Clientes")
   do while (lcontrole)
      ncoluna:= 3
      ncodigo:= valnomi()
      @ nlinha + 0, ncoluna + 5 say "Codigo"
      @ nlinha + 1, ncoluna + 5 get nCodigo picture "99999" when .F.
      @ nlinha + 0, ncoluna + 12 say "Nome do Cliente"
      @ nlinha + 1, ncoluna + 12 get cNome picture "@!" valid ;
         lercompra1()
      @ nlinha + 0, ncoluna + 53 say "Pes"
      @ nlinha + 1, ncoluna + 53 get cPessoa picture "!" valid ;
         cpessoa $ "FJ"
      read
      if (sai("cMen"))
         loop
      endif
      if (cpessoa = "F")
         @ nlinha + 2, ncoluna + 0 say "CPF"
         @ nlinha + 3, ncoluna + 0 get cCpf picture "999.999.999-99" ;
            valid valcpfcli(ccpf)
         @ nlinha + 2, ncoluna + 15 say "Identidade"
         @ nlinha + 3, ncoluna + 15 get cCi
         @ nlinha + 2, ncoluna + 34 say "Nome do Conjuge"
         @ nlinha + 3, ncoluna + 34 get cConjuge picture "@!"
         @ nlinha + 2, ncoluna + 65 say "Dt Nasc"
         @ nlinha + 3, ncoluna + 65 get dDataNasc
      else
         @ nlinha + 2, ncoluna + 0 say "CGC"
         @ nlinha + 3, ncoluna + 0 get cCgc picture ;
            "99.999.999/9999-99" valid valcgccli(ccgc)
         @ nlinha + 2, ncoluna + 19 say "Inscrio estadual"
         @ nlinha + 3, ncoluna + 19 get cInsc
      endif
      @ nlinha + 4, ncoluna + 0 say "Endereo (Rua,n§)"
      @ nlinha + 5, ncoluna + 0 get cEndereco picture "@!"
      @ nlinha + 4, ncoluna + 36 say "Bairro"
      @ nlinha + 5, ncoluna + 36 get cBairro picture "@!"
      @ nlinha + 4, ncoluna + 55 say "Cidade"
      @ nlinha + 5, ncoluna + 55 get cCidade picture "@!"
      @ nlinha + 6, ncoluna + 0 say "Uf"
      @ nlinha + 7, ncoluna + 0 get cEstado picture "!!"
      @ nlinha + 6, ncoluna + 4 say "Cep"
      @ nlinha + 7, ncoluna + 4 get cCep picture "99.999-999"
      @ nlinha + 6, ncoluna + 16 say "Telefone"
      @ nlinha + 7, ncoluna + 16 get cTelefone picture "(99)9999-9999"
      @ nlinha + 6, ncoluna + 30 say "Data Incluso"
      @ nlinha + 7, ncoluna + 32 get dDataIncl
      @ nlinha + 6, ncoluna + 46 say "Vendedor"
      @ nlinha + 7, ncoluna + 46 get nVend picture "99999"
      @ nlinha + 8, ncoluna + 0 say "Filiaao"
      @ nlinha + 9, ncoluna + 0 get cPai picture "@!" when cpessoa = ;
         "F"
      @ nlinha + 9, ncoluna + 32 get cMae picture "@!" when cpessoa ;
         = "F"
      @ nlinha + 10, ncoluna + 0 say "Dt 1¦ Comp"
      @ nlinha + 11, ncoluna + 0 get dDt_1a_Comp
      @ nlinha + 10, ncoluna + 12 say "Dt Ult Comp"
      @ nlinha + 11, ncoluna + 13 get dDataUltC
      @ nlinha + 10, ncoluna + 25 say "Protestos"
      @ nlinha + 11, ncoluna + 28 get nCheqDev picture "999"
      @ nlinha + 10, ncoluna + 37 say "N§ Ult Comp"
      @ nlinha + 11, ncoluna + 39 get nN_Pc_Ult_C picture "@E 9,999"
      @ nlinha + 10, ncoluna + 50 say "Limite Cred"
      @ nlinha + 11, ncoluna + 50 get nLimitCred picture ;
         "@E 9,999,999.99"
      @ nlinha + 10, ncoluna + 63 say "Cred. Usado"
      @ nlinha + 11, ncoluna + 63 get nCredUsad picture ;
         "@E 9,999,999.99"
      read
      if (sai(ncod12i))
         loop
      endif
      lertrab12i()
      if (sai(ncod12i))
         loop
      endif
      if (cpessoa = "F")
         lerbanco12()
      endif
      if (sai(ncod12i))
         loop
      endif
      lerrefc12i()
      if (sai(ncod12i))
         loop
      endif
      lerspc12i()
      if (sai(ncod12i))
         loop
      endif
      lerobs12i()
      if (sai(ncod12i))
         loop
      endif
      dt_nas_cli()
      if (sai(ncod12i))
         loop
      endif
      if (!conflinha("Confirma Inclusao ?", tela11i, ncoluna + 1))
         loop
      endif
      if (!abredbf("Clientes"))
         loop
      endif
      set index to Cliente1, Cliente2, Cliente3, Cliente4, Cliente5, ;
         Cliente6
      if (!adiciona())
         loop
      endif
      if (!bloqueia())
         loop
      endif
      replace loja_cli with nloja
      replace codigo_cli with ncodigo
      replace nome_cli with cnome
      replace dencom_cli with cconjuge
      replace pessoa_cli with cpessoa
      replace inclus_cli with cbairro
      replace endere_cli with cendereco
      replace bairro_cli with cestado
      replace cidade_cli with ccidade
      replace estado_cli with ctelefone
      replace cep_cli with ccep
      replace fone_cli with ddataincl
      replace conjug_cli with ddatanasc
      replace dt_nas_com with ccomprador
      replace cpf_cli with ccpf
      replace identi_cli with cci
      replace cgc_cli with ccgc
      replace insc_cli with cinsc
      replace compra_cli with ddtnasccom
      replace cpf_com with ccpfcomp
      replace identi_com with ccicomp
      replace endere_com with cfonecomp
      replace fone_com with cnomref1
      replace cep_com with ccepcomp
      replace cidade_com with ccidcomp
      replace bairro_com with cbaircomp
      replace dt_ulc_cli with crefbanc
      replace obs1 with cobs1
      replace obs2 with cobs2
      replace dt_1ac_cli with ddt_1a_com
      replace npc_ul_cli with ncheqdev
      replace no_ch_cli with nn_pc_ult_
      replace limitc_cli with nlimitcred
      replace credus_cli with ncredusad
      replace conta_bco with nvend
      replace vendedor with fonecomp
      replace nom_bco with nconta
      replace agn_bco with cpai
      replace nom_ref1 with nlinhafim
      replace nom_ref2 with ctelref1
      replace nom_ref3 with ctelref2
      replace tel_ref1 with ctelref3
      replace tel_ref2 with cendref1
      replace tel_ref3 with cendref2
      replace end_ref1 with cendref3
      replace end_ref2 with cnomref2
      replace end_ref3 with cnomref3
      replace pai with cnomeban
      replace mae with cmae
      replace spc1 with cspc1
      replace spc2 with cspc2
      replace spc3 with cspc3
      replace emp_trab with cemptrab
      replace fone_trab with cfonetrab
      replace admis_trab with dadmissao
      replace cargo_trab with ccargo
      replace salar_trab with nsalario
      replace ctela2 with cmen
      nloja:= 0
      ncodigo:= 0
      cnome:= Space(40)
      cconjuge:= CToD("  /  /  ")
      cpessoa:= Space(1)
      cbairro:= Space(27)
      cendereco:= Space(35)
      cestado:= Space(15)
      ccidade:= Space(23)
      ctelefone:= Space(2)
      ccep:= Space(10)
      ddataincl:= Space(13)
      ddatanasc:= CToD("  /  /  ")
      ccomprador:= Space(30)
      ccpf:= Space(14)
      cci:= Space(18)
      ccgc:= Space(18)
      cinsc:= Space(18)
      ddtnasccom:= Space(30)
      ccpfcomp:= CToD("  /  /  ")
      ccicomp:= Space(14)
      cfonecomp:= Space(18)
      cnomref1:= Space(13)
      ccepcomp:= Space(30)
      ccidcomp:= Space(35)
      cbaircomp:= Space(25)
      crefbanc:= Space(15)
      ctelref1:= Space(30)
      cendref1:= Space(13)
      cnomref2:= Space(30)
      ctelref2:= Space(30)
      cendref2:= Space(13)
      cnomref3:= Space(30)
      ctelref3:= Space(30)
      cendref3:= Space(13)
      cnomeban:= Space(30)
      cpai:= Space(30)
      nconta:= 0
      nlinhafim:= 0
      fonecomp:= 0
      cobs1:= Space(70)
      cobs2:= Space(70)
      ddt_1a_com:= CToD("  /  /  ")
      ncheqdev:= CToD("  /  /  ")
      nn_pc_ult_:= 0
      nlimitcred:= 0
      ncredusad:= 0
      nvend:= 0
      cmae:= Space(30)
      cspc1:= Space(30)
      cspc2:= Space(70)
      cspc3:= Space(70)
      cemptrab:= Space(70)
      cfonetrab:= Space(30)
      dadmissao:= Space(13)
      ccargo:= CToD("  /  /  ")
      nsalario:= Space(15)
      cmen:= 0
      close
   enddo
   RestScreen(0, 0, 24, 79, ctela)
   set color to (ccor)
   return

********************************
procedure LERCOMPRA1(Arg1)

   if (Arg1 = Nil)
      Arg1:= .F.
      valpess:= SaveScreen(0, 0, 24, 79)
   endif
   janela(nlinha + 5, ncoluna++, nlinha + 13, ncoluna + 74, ;
      "Dados do Comprador", 2)
   @ nlinha + 6, ncoluna + 0 say "Nome do Comprador"
   @ nlinha + 7, ncoluna + 0 get cComprador
   @ nlinha + 8, ncoluna + 0 say "Dt Nasc"
   @ nlinha + 9, ncoluna + 0 get dDtNascComp
   @ nlinha + 8, ncoluna + 10 say "CPF"
   @ nlinha + 9, ncoluna + 10 get cCpfComp picture "999.999.999-99"
   @ nlinha + 8, ncoluna + 26 say "Cart. Ident."
   @ nlinha + 9, ncoluna + 26 get cCiComp
   @ nlinha + 8, ncoluna + 46 say "Fone"
   @ nlinha + 9, ncoluna + 46 get FoneComp picture "(999)999-9999"
   @ nlinha + 8, ncoluna + 61 say "CEP"
   @ nlinha + 9, ncoluna + 61 get cCepComp picture "99.999-999"
   @ nlinha + 10, ncoluna + 0 say "Endereo"
   @ nlinha + 11, ncoluna + 0 get cEndeComp picture "@!"
   @ nlinha + 10, ncoluna + 32 say "Cidade"
   @ nlinha + 11, ncoluna + 32 get cCidComp picture "@!"
   @ nlinha + 10, ncoluna + 58 say "Bairro"
   @ nlinha + 11, ncoluna + 58 get cBairComp picture "@!"
   if (Arg1)
      clear gets
   else
      read
      ncoluna--
      RestScreen(0, 0, 24, 79, valpess)
   endif
   return

********************************
procedure LERSPC12I(Arg1)

   ncoluna:= 1
   if (Arg1 = Nil)
      Arg1:= .F.
      valpess:= SaveScreen(0, 0, 24, 79)
   endif
   janela(nlinha + 5, ncoluna++, nlinha + 10, ncoluna + 77, ;
      "Informacoes do SPC", 2)
   @ nlinha + 6, ncoluna + 0 say "Informacoes do SPC"
   @ nlinha + 7, ncoluna + 0 get cSPC1 picture "@!"
   @ nlinha + 8, ncoluna + 0 get cSPC2 picture "@!"
   @ nlinha + 9, ncoluna + 0 get cSPC3 picture "@!"
   if (Arg1)
      clear gets
   else
      read
      ncoluna--
      RestScreen(0, 0, 24, 79, valpess)
   endif
   return

********************************
function VALPESS

   set color to (corfordado)
   do case
   case cpessoa == " "
      alert("Atencoa! Campo pessoa nao permitido vazio")
      return .F.
   case cpessoa == "F"
      @ nlinha + 1, ncoluna + 52 say "isica  "
   case cpessoa == "J"
      @ nlinha + 1, ncoluna + 52 say "uridica"
   case cpessoa != "F" .OR. cpessoa != "J"
      alert("Atencao! F para Fisica ou J para Juridica")
      return .F.
   endcase
   return .T.

********************************
function VCOD12A

   if (!abredbf("Clientes", "Cliente1"))
      return .F.
   endif
   seek ncodigo
   if (!Found())
      alert("Cliente Nao Cadastrado")
      close
      return .F.
   endif
   close
   return .T.

********************************
function VCOD13I

   if (!abredbf("Forneced", "Fornece1"))
      ncodigo:= 99998.0
   endif
   goto bottom
   ncodigo:= codigo_for + 1
   close
   return ncodigo

********************************
function VCOD16I

   if (!abredbf("GRUPO", "GRUPO"))
      return 0
   endif
   goto bottom
   ngrupo:= grupo + 1
   close
   return ngrupo

********************************
procedure LERTRAB12I(Arg1)

   if (Arg1 = Nil)
      Arg1:= .F.
      valpess:= SaveScreen(0, 0, 24, 79)
   endif
   ncoluna:= 1
   janela(nlinha + 5, ncoluna++, nlinha + 11, ncoluna + 77, ;
      "Empresa que Trabalha", 2)
   @ nlinha + 6, ncoluna + 0 say "Empresa"
   @ nlinha + 6, ncoluna + 32 say "Telefone"
   @ nlinha + 6, ncoluna + 47 say "Admissao"
   @ nlinha + 8, ncoluna + 0 say "Cargo"
   @ nlinha + 8, ncoluna + 17 say "Salario"
   @ nlinha + 7, ncoluna + 0 get cEmpTrab picture "@!"
   @ nlinha + 7, ncoluna + 32 get cFoneTrab picture "(999)999-9999"
   @ nlinha + 7, ncoluna + 47 get dAdmissao
   @ nlinha + 9, ncoluna + 0 get cCargo picture "@!"
   @ nlinha + 9, ncoluna + 17 get nSalario picture "9,999,999.99"
   if (Arg1)
      clear gets
   else
      read
      ncoluna--
      RestScreen(0, 0, 24, 79, valpess)
   endif
   return

********************************
function NCOD12I

   abredbf("CLIENTES", "CLIENTE1")
   goto bottom
   cnome:= Space(40)
   ncodigo:= codigo_cli + 1
   @ nlinha + 1, ncoluna + 5 say ncodigo
   close
   return ncodigo

********************************
function VALNOMI

   if (Empty(cnome))
      alert("Ateno! No  permitido nome de cliente vazio")
      return .F.
   else
      if (!abredbf("Clientes", "Cliente2.NTX"))
         return .F.
      endif
      seek cnome
      if (Found())
         alert("Ateno! Cliente j  Existe")
         close
         return .F.
      endif
   endif
   close
   return .T.

********************************
procedure QSR12A

   private nloja, ncodigo, cnome, cpessoa, cbairro, cendereco, ;
      cestado, ccidade
   private ctelefone, ccep, ddataincl, ddatanasc, cconjuge, ;
      ccomprador, ccpf, cci
   private ccgc, cinsc, ddtnasccom, ccpfcomp, ccicomp, cfonecomp, ;
      cendecomp, ccepcomp
   private ccidcomp, cbaircomp, crefbanc, ccidbanc, nlinhafim, crefpes
   private cfonerefpe, cenderefpe, ccidrefpes, cbairrefpe, ;
      cceprefpes, cinfo
   private cobs, ddataultc, ddt_1a_com, ncheqdev, nn_pc_ult_
   private nlimitcred, ncredusad, nvend, lcontrole, nlinha, ncoluna, ;
      vet[2]
   private ctela, ccor, fonecomp
   cpesquisa:= {"CLIENTES", "CLIENTE2", "CODIGO_CLI", "nCodigo"}
   ccampos:= {"CODIGO_CLI", "NOME_CLI", "", "CODIGO", "NOME", ""}
   nloja:= 0
   ncodigo:= 0
   cnome:= Space(30)
   cconjuge:= CToD("  /  /  ")
   cpessoa:= Space(1)
   cbairro:= Space(27)
   cendereco:= Space(35)
   cestado:= Space(15)
   ccidade:= Space(23)
   ctelefone:= Space(2)
   ccep:= Space(10)
   ddataincl:= Space(13)
   ddatanasc:= CToD("  /  /  ")
   ccomprador:= Space(30)
   ccpf:= Space(14)
   cci:= Space(18)
   ccgc:= Space(18)
   cinsc:= Space(18)
   ddtnasccom:= Space(30)
   ccpfcomp:= CToD("  /  /  ")
   ccicomp:= Space(14)
   cfonecomp:= Space(18)
   cnomref1:= Space(13)
   ccepcomp:= Space(30)
   ccidcomp:= Space(35)
   cbaircomp:= Space(25)
   crefbanc:= Space(15)
   ctelref1:= Space(30)
   cendref1:= Space(13)
   cnomref2:= Space(30)
   ctelref2:= Space(30)
   cendref2:= Space(13)
   cnomref3:= Space(30)
   ctelref3:= Space(30)
   cendref3:= Space(13)
   cnomeban:= Space(30)
   cpai:= Space(30)
   nconta:= 0
   nlinhafim:= 0
   fonecomp:= 0
   cobs1:= Space(70)
   cobs2:= Space(70)
   ddt_1a_com:= CToD("  /  /  ")
   ncheqdev:= CToD("  /  /  ")
   nn_pc_ult_:= 0
   nlimitcred:= 0
   ncredusad:= 0
   nvend:= 0
   cmae:= Space(30)
   cspc1:= Space(30)
   cspc2:= Space(70)
   cspc3:= Space(70)
   cemptrab:= Space(70)
   cfonetrab:= Space(30)
   dadmissao:= Space(13)
   ccargo:= CToD("  /  /  ")
   nsalario:= Space(15)
   cmen:= 0
   nlinha:= 3
   tela11i:= nlinha + 14
   ncoluna:= 1
   lcontrole:= .T.
   vet[1]:= "Sim"
   vet[2]:= "Nao"
   ctela:= SaveScreen(0, 0, 24, 79)
   ccor:= SetColor()
   ncod12i:= "Deseja Abandonar Manutencao ?"
   janela(nlinha - 1, ncoluna, tela11i, ncoluna + 77, ;
      "Manutencao de Clientes")
   ncoluna:= ncoluna + 2
   nlinha++
   do while (lcontrole)
      nlinha:= 4
      ncoluna:= 3
      @ nlinha, ncoluna clear to nlinha + 11, ncoluna + 74
      set confirm on
      @ nlinha, ncoluna + 5 say "Codigo"
      @ nlinha + 1, ncoluna + 5 get nCodigo picture "99999" valid ;
         qsr12a(ncodigo)
      read
      if (sai(ncod12i))
         loop
      endif
      if (!abredbf("Clientes"))
         loop
      endif
      set index to Cliente1, Cliente2
      if (!lcontrole)
         loop
      endif
      seek ncodigo
      if (!Found())
         alert("C¢digo no encontrado")
         loop
      else
         nloja:= loja_cli
         cnome:= nome_cli
         cconjuge:= dencom_cli
         cpessoa:= pessoa_cli
         cbairro:= inclus_cli
         cendereco:= endere_cli
         cestado:= bairro_cli
         ccidade:= cidade_cli
         ctelefone:= estado_cli
         ccep:= cep_cli
         ddataincl:= fone_cli
         ddatanasc:= conjug_cli
         ccomprador:= dt_nas_com
         ccpf:= cpf_cli
         cci:= identi_cli
         ccgc:= cgc_cli
         cinsc:= insc_cli
         ddtnasccom:= compra_cli
         ccpfcomp:= cpf_com
         ccicomp:= identi_com
         cfonecomp:= endere_com
         cnomref1:= fone_com
         ccepcomp:= cep_com
         ccidcomp:= cidade_com
         cbaircomp:= bairro_com
         crefbanc:= dt_ulc_cli
         ctelref1:= nom_ref2
         cendref1:= tel_ref2
         cnomref2:= end_ref2
         ctelref2:= nom_ref3
         cendref2:= tel_ref3
         cnomref3:= end_ref3
         ctelref3:= tel_ref1
         cendref3:= end_ref1
         cnomeban:= pai
         cpai:= agn_bco
         nconta:= nom_bco
         nlinhafim:= nom_ref1
         fonecomp:= vendedor
         cobs1:= obs1
         cobs2:= obs2
         ddt_1a_com:= dt_1ac_cli
         ncheqdev:= npc_ul_cli
         nn_pc_ult_:= no_ch_cli
         nlimitcred:= limitc_cli
         ncredusad:= credus_cli
         nvend:= conta_bco
         fonecomp:= vendedor
         cmae:= mae
         cspc1:= spc1
         cspc2:= spc2
         cspc3:= spc3
         cemptrab:= emp_trab
         cfonetrab:= fone_trab
         dadmissao:= admis_trab
         ccargo:= cargo_trab
         nsalario:= salar_trab
         cmen:= ctela2
      endif
      close
      if (sai(ncod12i))
         loop
      endif
      @ nlinha + 0, ncoluna + 12 say "Nome do Cliente"
      @ nlinha + 1, ncoluna + 12 get cNome picture "@!"
      @ nlinha + 0, ncoluna + 53 say "Pes"
      @ nlinha + 1, ncoluna + 53 get cPessoa picture "!" valid ;
         cpessoa $ "FJ"
      dbunlockal:= escolhelin({"Altera", "Exclui"}, 2, tela11i, ;
         ncoluna + 1)
      if (dbunlockal == 2)
         clear gets
      else
         read
      endif
      set confirm off
      if (sai(ncod12i))
         loop
      endif
      if (cpessoa = "F")
         @ nlinha + 0, ncoluna + 48 say "Denominao Comercial"
         @ nlinha + 1, ncoluna + 48 get cDenCom
         @ nlinha + 2, ncoluna + 0 say "CPF"
         @ nlinha + 3, ncoluna + 0 get cCpf picture "999.999.999-99"
         @ nlinha + 2, ncoluna + 15 say "Identidade"
         @ nlinha + 3, ncoluna + 15 get cCi
         @ nlinha + 2, ncoluna + 34 say "Nome do Conjuge"
         @ nlinha + 3, ncoluna + 34 get cConjuge picture "@!"
         @ nlinha + 2, ncoluna + 65 say "Dt Nasc"
         @ nlinha + 3, ncoluna + 65 get dDataNasc
      else
         @ nlinha + 2, ncoluna + 0 say "CGC"
         @ nlinha + 3, ncoluna + 0 get cCgc
         @ nlinha + 2, ncoluna + 19 say "Inscrio estadual"
         @ nlinha + 3, ncoluna + 19 get cInsc
      endif
      @ nlinha + 4, ncoluna + 0 say "Endereo (Rua,n§)"
      @ nlinha + 5, ncoluna + 0 get cEndereco picture "@!"
      @ nlinha + 4, ncoluna + 36 say "Bairro"
      @ nlinha + 5, ncoluna + 36 get cBairro picture "@!"
      @ nlinha + 4, ncoluna + 55 say "Cidade"
      @ nlinha + 5, ncoluna + 55 get cCidade picture "@!"
      @ nlinha + 6, ncoluna + 0 say "Uf"
      @ nlinha + 7, ncoluna + 0 get cEstado picture "!!"
      @ nlinha + 6, ncoluna + 4 say "Cep"
      @ nlinha + 7, ncoluna + 4 get cCep picture "99.999-999"
      @ nlinha + 6, ncoluna + 16 say "Telefone"
      @ nlinha + 7, ncoluna + 16 get cTelefone picture "(999)999-9999"
      @ nlinha + 6, ncoluna + 30 say "Data Incluso"
      @ nlinha + 7, ncoluna + 32 get dDataIncl
      @ nlinha + 6, ncoluna + 46 say "Vendedor"
      @ nlinha + 7, ncoluna + 46 get nVend picture "99999"
      @ nlinha + 8, ncoluna + 0 say "Filiacao"
      @ nlinha + 9, ncoluna + 0 get cPai picture "@!" when cpessoa = ;
         "F"
      @ nlinha + 9, ncoluna + 32 get cMae picture "@!" when cpessoa ;
         = "F"
      @ nlinha + 10, ncoluna + 0 say "Dt 1¦ Comp"
      @ nlinha + 11, ncoluna + 0 get dDt_1a_Comp
      @ nlinha + 10, ncoluna + 12 say "Dt Ult Comp"
      @ nlinha + 11, ncoluna + 13 get dDataUltC
      @ nlinha + 10, ncoluna + 25 say "Protestos"
      @ nlinha + 11, ncoluna + 28 get nCheqDev picture "999"
      @ nlinha + 10, ncoluna + 37 say "N§ Ult Comp"
      @ nlinha + 11, ncoluna + 39 get nN_Pc_Ult_C picture "@E 9,999"
      @ nlinha + 10, ncoluna + 50 say "Limite Cred"
      @ nlinha + 11, ncoluna + 50 get nLimitCred picture ;
         "@E 9,999,999.99"
      @ nlinha + 10, ncoluna + 63 say "Cred. Usado"
      @ nlinha + 11, ncoluna + 63 get nCredUsad picture ;
         "@E 9,999,999.99"
      if (dbunlockal == 2)
         clear gets
         qsr13i:= "Confirma Exclusao ?"
      else
         qsr13i:= "Confirma Alteracao ?"
         read
         if (sai(ncod12i))
            loop
         endif
         if (cpessoa = "J")
            lertrab12i()
         else
            lerbanco12()
         endif
         if (sai(ncod12i))
            loop
         endif
         lerrefc12i()
         if (sai(ncod12i))
            loop
         endif
         lerspc12i()
         if (sai(ncod12i))
            loop
         endif
         lerobs12i()
         if (sai(ncod12i))
            loop
         endif
         dt_nas_cli()
         if (sai(ncod12i))
            loop
         endif
      endif
      if (!conflinha(qsr13i, tela11i, ncoluna + 1))
         loop
      endif
      if (!abredbf("Clientes"))
         loop
      endif
      set index to Cliente1, Cliente2, Cliente3, Cliente4, Cliente5, ;
         Cliente6
      seek ncodigo
      if (!Found())
         alert("Erro no bloqueio de registro operacao sera cancelada")
         lcontrole:= .F.
         close databases
         select 1
         close format
         loop
      endif
      if (!bloqueia())
         loop
      endif
      if (dbunlockal == 2)
         delete
      else
         replace loja_cli with nloja
         replace codigo_cli with ncodigo
         replace nome_cli with cnome
         replace dencom_cli with cconjuge
         replace pessoa_cli with cpessoa
         replace inclus_cli with cbairro
         replace endere_cli with cendereco
         replace bairro_cli with cestado
         replace cidade_cli with ccidade
         replace estado_cli with ctelefone
         replace cep_cli with ccep
         replace fone_cli with ddataincl
         replace conjug_cli with ddatanasc
         replace dt_nas_com with ccomprador
         replace cpf_cli with ccpf
         replace identi_cli with cci
         replace cgc_cli with ccgc
         replace insc_cli with cinsc
         replace compra_cli with ddtnasccom
         replace cpf_com with ccpfcomp
         replace identi_com with ccicomp
         replace endere_com with cfonecomp
         replace fone_com with cnomref1
         replace cep_com with ccepcomp
         replace cidade_com with ccidcomp
         replace bairro_com with cbaircomp
         replace dt_ulc_cli with crefbanc
         replace obs1 with cobs1
         replace obs2 with cobs2
         replace dt_1ac_cli with ddt_1a_com
         replace npc_ul_cli with ncheqdev
         replace no_ch_cli with nn_pc_ult_
         replace limitc_cli with nlimitcred
         replace credus_cli with ncredusad
         replace conta_bco with nvend
         replace vendedor with fonecomp
         replace nom_bco with nconta
         replace agn_bco with cpai
         replace nom_ref1 with nlinhafim
         replace nom_ref2 with ctelref1
         replace nom_ref3 with ctelref2
         replace tel_ref1 with ctelref3
         replace tel_ref2 with cendref1
         replace tel_ref3 with cendref2
         replace end_ref1 with cendref3
         replace end_ref2 with cnomref2
         replace end_ref3 with cnomref3
         replace pai with cnomeban
         replace mae with cmae
         replace spc1 with cspc1
         replace spc2 with cspc2
         replace spc3 with cspc3
         replace emp_trab with cemptrab
         replace fone_trab with cfonetrab
         replace admis_trab with dadmissao
         replace cargo_trab with ccargo
         replace salar_trab with nsalario
         replace ctela2 with cmen
      endif
      nloja:= 0
      ncodigo:= 0
      cnome:= Space(30)
      cconjuge:= CToD("  /  /  ")
      cpessoa:= Space(1)
      cbairro:= Space(27)
      cendereco:= Space(35)
      cestado:= Space(18)
      ccidade:= Space(20)
      ctelefone:= Space(2)
      ccep:= Space(10)
      ddataincl:= Space(13)
      ddatanasc:= CToD("  /  /  ")
      ccomprador:= Space(30)
      ccpf:= Space(14)
      cci:= Space(18)
      ccgc:= Space(18)
      cinsc:= Space(18)
      ddtnasccom:= Space(30)
      ccpfcomp:= CToD("  /  /  ")
      ccicomp:= Space(14)
      cfonecomp:= Space(18)
      cnomref1:= Space(13)
      ccepcomp:= Space(30)
      ccidcomp:= Space(35)
      cbaircomp:= Space(25)
      crefbanc:= Space(15)
      ctelref1:= Space(30)
      cendref1:= Space(13)
      cnomref2:= Space(30)
      ctelref2:= Space(30)
      cendref2:= Space(13)
      cnomref3:= Space(30)
      ctelref3:= Space(30)
      cendref3:= Space(13)
      cnomeban:= Space(30)
      cpai:= Space(30)
      nconta:= 0
      nlinhafim:= 0
      fonecomp:= 0
      cobs1:= Space(70)
      cobs2:= Space(70)
      ddt_1a_com:= CToD("  /  /  ")
      ncheqdev:= CToD("  /  /  ")
      nn_pc_ult_:= 0
      nlimitcred:= 0
      ncredusad:= 0
      nvend:= 0
      cmae:= Space(30)
      cspc1:= Space(30)
      cspc2:= spc2
      cspc3:= spc3
      cemptrab:= emp_trab
      cfonetrab:= Space(30)
      dadmissao:= Space(13)
      ccargo:= CToD("  /  /  ")
      nsalario:= Space(15)
      cmen:= 0
      close
   enddo
   RestScreen(0, 0, 24, 79, ctela)
   set color to (ccor)
   return

********************************
function VCODI13A

   private v1[2], v2[2], v3[2]
   if (!abredbf("Forneced"))
      return .F.
   endif
   set index to Fornece1, Fornece2
   seek ncodigo
   if (!Found())
      alert("C¢digo no Cadastrado")
      close
      return .F.
   endif
   close
   return .T.

********************************
function PESQ13A

   if (Upper(readvar()) = "NCODIGO")
      cpesquisa:= {"FORNECED", "FORNECE2", "CODIGO_FOR", "nCodigo"}
      ccampos:= {"CODIGO_FOR", "NOME", "", "CODIGO", "NOME", ""}
   elseif (Upper(readvar()) = "NCODCC")
      cpesquisa:= {"CENT_CUS", "CENTRO2", "COD_HIER", "nCodCC"}
      ccampos:= {"COD_HIER", "DESCRICAO", "", "CODIGO", "DESCRICAO", ;
         ""}
   endif
   pesquisa()
   return .T.

********************************
function VCODI14

   private v1[2], v2[2], v3[2]
   if (!abredbf("FUNCIONA"))
      return .F.
   endif
   set index to Funcion1, Funcion2
   seek ncodigo
   if (!Found())
      alert("Codigo nao Encontrado")
      close
      return .F.
   endif
   close
   return .T.

********************************
function GERCOD15I

   if (!abredbf("Produtos", "Produto1.NTX"))
      return .F.
   endif
   goto bottom
   ncod:= Val(codigo)
   ncod++
   ncod:= Str(ncod, 5)
   ncod:= Replicate("0", 5 - Len(LTrim(ncod))) + LTrim(ncod)
   close
   return ncod

********************************
procedure QSR13I

   private ncodigo, cnome, cpessoa, cendereco, cestado, ccidade, ;
      ctelefone
   private ccep, ddataincl, creg, ccgc, cinsc, ddt_venc, cobs1, ;
      cobs2, nlinha, ncoluna
   private cnomerep, ccpf, lcontrole, ctela, ccor, vet[2]
   cpesquisa:= {"CENT_CUS", "CENTRO2", "COD_HIER", "nCodCC"}
   ccampos:= {"COD_HIER", "DESCRICAO", "", "CODIGO", "DESCRICAO", ""}
   programa(0, 69, coropcoes)
   ncodigo:= 0
   cnome:= Space(40)
   cpessoa:= Space(1)
   cendereco:= Space(38)
   cestado:= Space(15)
   ccidade:= Space(15)
   ctelefone:= Space(2)
   ccep:= Space(10)
   ddataincl:= Space(12)
   creg:= Space(30)
   ccgc:= Space(18)
   cinsc:= Space(18)
   cnomerep:= Space(18)
   ccpf:= Space(14)
   ddt_venc:= Space(2)
   cobs1:= Space(50)
   cobs2:= Space(50)
   cendrep:= Space(30)
   cbairrep:= Space(30)
   ccidrep:= Space(15)
   cceprep:= Space(20)
   cfonerep:= Space(10)
   cfaxrep:= Space(13)
   cufrep:= Space(13)
   cnombco:= Space(2)
   ncodcc:= Space(7)
   nagnbco:= Space(30)
   ctelbco:= 0
   vcod13i:= Space(13)
   nlinha:= 4
   ncoluna:= 1
   tela11i:= nlinha + 18
   lcontrole:= .T.
   ctela:= SaveScreen(0, 0, 24, 79)
   ccor:= SetColor()
   vet[1]:= "Sim"
   vet[2]:= "Nao"
   janela(nlinha - 1, ncoluna, nlinha + 18, ncoluna + 77, ;
      "Inclusao de Fornecedores")
   do while (lcontrole)
      set color to (corfordado)
      ncodigo:= tela13()
      valnom2()
      clear gets
      @ nlinha + 1, ncoluna + 2 get nCodigo picture "99999" when .F.
      @ nlinha + 1, ncoluna + 13 get cNome picture "@!" valid bairro()
      @ nlinha + 1, ncoluna + 61 get cPessoa picture "!" valid ;
         cpessoa $ "FJ"
      read
      if (sai("Deseja Abandonar Inclusao ?"))
         loop
      endif
      valnom2()
      read
      if (sai("Deseja Abandonar Inclusao ?"))
         loop
      endif
      if (!conflinha("Confirma Inclusao ?", tela11i, ncoluna + 1))
         loop
      endif
      if (!abredbf("Forneced"))
         loop
      endif
      set index to Fornece1, Fornece2
      if (!adiciona())
         loop
      endif
      if (!bloqueia())
         loop
      endif
      replace codigo_for with ncodigo
      replace nome with cnome
      replace endereco with cendereco
      replace cidade with cestado
      replace cep with ccidade
      replace ferase with ctelefone
      replace contato with ccep
      replace telefone with ddataincl
      replace cgc with ccgc
      replace inscricao with cinsc
      replace obs1 with cobs1
      replace pessoa with creg
      replace obs2 with cobs2
      replace tipo with ddt_venc
      replace fone_bco with cpessoa
      replace nom_ref1 with ctelbco
      replace agn_bco with nagnbco
      replace nome_repr with vcod13i
      replace end_repr with cendrep
      replace bair_repr with cbairrep
      replace cid_repr with ccidrep
      replace cep_repr with cceprep
      replace fone_repr with cfonerep
      replace fax_repr with cfaxrep
      replace uf_repr with cufrep
      replace codigo_cc with cnombco
      replace vcodi13a with ncodcc
      close
      ncodigo:= 0
      cnome:= Space(40)
      cpessoa:= Space(1)
      cendereco:= Space(38)
      cestado:= Space(15)
      ccidade:= Space(15)
      ctelefone:= Space(2)
      ccep:= Space(10)
      ddataincl:= Space(12)
      creg:= Space(30)
      ccgc:= Space(18)
      cinsc:= Space(18)
      ddt_venc:= Space(2)
      cobs1:= Space(50)
      cobs2:= Space(50)
      ctelbco:= 0
      nagnbco:= Space(30)
      vcod13i:= Space(13)
      cendrep:= Space(30)
      cbairrep:= Space(30)
      ccidrep:= Space(15)
      cceprep:= Space(20)
      cfonerep:= Space(10)
      cfaxrep:= Space(13)
      cufrep:= Space(13)
      cnombco:= Space(2)
      ncodcc:= Space(7)
   enddo
   RestScreen(0, 0, 24, 79, ctela)
   set color to (ccor)
   return

********************************
function VALNOM2

   if (Empty(cnome))
      return .F.
   else
      select 1
      use Forneced shared readonly index Fornece1, Fornece2
      set order to 2
      goto top
      seek cnome
      if (Found())
         alert("Ateno! Fornecedor j  Existe")
         close
         return .F.
      endif
      close
      return .T.
   endif

********************************
function VCOD14I

   if (!abredbf("Funciona", "Funcion1"))
      ncodigo:= 99998.0
   endif
   goto bottom
   ncodigo:= est_civil + 1
   return ncodigo

********************************
function TELA13

   @ nlinha, ncoluna + 2 say "Codigo"
   @ nlinha, ncoluna + 13 say "Nome do Fornecedor"
   @ nlinha, ncoluna + 61 say "Pessoa"
   @ nlinha + 2, ncoluna + 2 say "Endereco"
   @ nlinha + 2, ncoluna + 42 say "Bairro"
   @ nlinha + 2, ncoluna + 58 say "Cidade"
   @ nlinha + 2, ncoluna + 74 say "UF"
   @ nlinha + 4, ncoluna + 2 say "C.E.P."
   @ nlinha + 4, ncoluna + 14 say "Telefone"
   @ nlinha + 4, ncoluna + 29 say "Contato"
   @ nlinha + 6, ncoluna + 2 say "CGC/CPF"
   @ nlinha + 6, ncoluna + 22 say "Inscr/Id"
   @ nlinha + 8, ncoluna + 2 say "Nome do Banco"
   @ nlinha + 8, ncoluna + 34 say "Agencia"
   @ nlinha + 8, ncoluna + 42 say "Telefone"
   @ nlinha + 10, ncoluna + 2 say "Nome do Representante"
   @ nlinha + 10, ncoluna + 34 say "Endereco"
   @ nlinha + 10, ncoluna + 66 say "Bairro"
   @ nlinha + 12, ncoluna + 2 say "Cidade"
   @ nlinha + 12, ncoluna + 24 say "UF"
   @ nlinha + 12, ncoluna + 28 say "CEP"
   @ nlinha + 12, ncoluna + 40 say "Fone"
   @ nlinha + 12, ncoluna + 55 say "Fax"
   @ nlinha + 14, ncoluna + 2 say "Observacao"
   @ nlinha + 3, ncoluna + 2 get cEndereco picture "@!"
   @ nlinha + 3, ncoluna + 42 get cBairro picture "@!"
   @ nlinha + 3, ncoluna + 58 get cCidade picture "@!"
   @ nlinha + 3, ncoluna + 74 get cEstado picture "!!"
   @ nlinha + 5, ncoluna + 2 get cCep picture "99.999-999"
   @ nlinha + 5, ncoluna + 14 get cTelefone picture "99/9999-9999"
   @ nlinha + 5, ncoluna + 29 get cContato picture "@!"
   @ nlinha + 7, ncoluna + 2 get cCgc picture "99.999.999/9999-99"
   @ nlinha + 7, ncoluna + 22 get cInsc
   @ nlinha + 9, ncoluna + 2 get cNomBco picture "@!"
   @ nlinha + 9, ncoluna + 34 get nAgnBco picture "9999"
   @ nlinha + 9, ncoluna + 42 get cTelBco picture "(99)9999-9999"
   @ nlinha + 11, ncoluna + 2 get cNomeRep picture "@!"
   @ nlinha + 11, ncoluna + 34 get cEndRep
   @ nlinha + 11, ncoluna + 66 get cBairRep picture "@!S10"
   @ nlinha + 13, ncoluna + 2 get cCidRep picture "@!"
   @ nlinha + 13, ncoluna + 24 get cUfRep picture "!!"
   @ nlinha + 13, ncoluna + 28 get cCepRep picture "99.999-999"
   @ nlinha + 13, ncoluna + 40 get cFoneRep picture "(99)9999-9999"
   @ nlinha + 13, ncoluna + 55 get cFaxRep picture "(99)9999-9999"
   @ nlinha + 15, ncoluna + 2 get cObs1
   @ nlinha + 16, ncoluna + 2 get cObs2
   return .T.

********************************
procedure QSR17I

   private ncodigo, cdesc
   private nlinha, ncoluna, lcontrole, ctela, ccor, vet[2]
   programa(0, 69, coropcoes)
   ncodigo:= 0
   cdesc:= Space(30)
   nlinha:= 10
   tela11i:= nlinha + 4
   ncoluna:= 9
   lcontrole:= .T.
   ctela:= SaveScreen(0, 0, 24, 79)
   ccor:= SetColor()
   vet[1]:= "Sim"
   vet[2]:= "Nao"
   janela(nlinha, ncoluna, tela11i, ncoluna + 50, ;
      "Inclusao de Localizacoes")
   @ nlinha + 1, ncoluna + 2 say "Grupo"
   @ nlinha + 1, ncoluna + 12 say "Descrio"
   @ nlinha + 2, ncoluna + 2 get nCodigo picture "99999"
   @ nlinha + 2, ncoluna + 12 get cDesc picture "@!"
   clear gets
   do while (lcontrole)
      ncodigo:= codigo_loc()
      @ nlinha + 2, ncoluna + 2 get nCodigo picture "99999" valid ;
         vallocal1(ncodigo)
      @ nlinha + 2, ncoluna + 12 get cDesc picture "@!"
      read
      if (sai())
         loop
      endif
      if (!conflinha("Confirma Inclusao ?", tela11i, ncoluna + 1))
         loop
      endif
      if (!abredbf("Localiza", "Localiz1.NTX"))
         loop
      endif
      if (!adiciona())
         loop
      endif
      if (!bloqueia())
         loop
      endif
      replace qsr17a with ncodigo
      replace descricao with cdesc
      close
      ncodigo:= 0
      cdesc:= Space(30)
   enddo
   RestScreen(0, 0, 24, 79, ctela)
   set color to (ccor)
   return

********************************
function VCOD17I

   if (!abredbf("LOCALIZA", "LOCALIZ1.NTX"))
      return .F.
   endif
   goto bottom
   ncodigo:= qsr17a + 1
   close
   return ncodigo

********************************
procedure QSR13A

   private ncodigo, cnome, cpessoa, cendereco, cestado, ccidade, ;
      ctelefone
   private ccep, ddataincl, creg, ccgc, cinsc, cobs1, cobs2, nlinha, ;
      ncoluna
   private cnomerep, ccpf, lcontrole, ctela, ccor, vet[2], nresp
   set key K_F10 to forneced
   programa(0, 69, coropcoes)
   ncodigo:= 0
   ccor:= SetColor()
   cnome:= Space(30)
   cpessoa:= Space(1)
   cendereco:= Space(30)
   cestado:= Space(15)
   ccidade:= Space(15)
   ctelefone:= Space(2)
   ccep:= Space(10)
   ddataincl:= Space(12)
   creg:= Space(30)
   ccgc:= Space(18)
   cinsc:= Space(14)
   cnomerep:= Space(18)
   ccpf:= Space(14)
   cobs1:= Space(50)
   cobs2:= Space(50)
   nlinha:= 3
   tela11i:= nlinha + 18
   ncoluna:= 1
   lcontrole:= .T.
   nagnbco:= Space(30)
   ctelbco:= 0
   vcod13i:= Space(13)
   ctela:= SaveScreen(0, 0, 24, 79)
   cendrep:= Space(30)
   cbairrep:= Space(30)
   ccidrep:= Space(15)
   cceprep:= Space(20)
   cfonerep:= Space(10)
   cfaxrep:= Space(13)
   cufrep:= Space(13)
   cnombco:= Space(2)
   vet[1]:= "Sim"
   vet[2]:= "Nao"
   ncodcc:= Space(7)
   janela(nlinha, ncoluna, tela11i, ncoluna + 77, ;
      "Manutencao de Fornecedores")
   nlinha++
   do while (lcontrole)
      valnom2()
      @ nlinha + 1, ncoluna + 13 get cNome picture "@!"
      @ nlinha + 1, ncoluna + 51 get cPessoa picture "!"
      clear gets
      @ nlinha + 1, ncoluna + 2 get nCodigo picture "99999" valid ;
         qsr13a()
      read
      if (sai("Deseja Abandonar Manutencao ?"))
         loop
      endif
      if (!abredbf("Forneced", "Fornece1"))
         loop
      endif
      seek ncodigo
      if (!Found())
         alert("Registro nao Encontrado!")
         close
         loop
      else
         cnome:= ncodfor1->nome
         cpessoa:= ncodfor1->fone_bco
         cendereco:= ncodfor1->endereco
         cestado:= ncodfor1->cidade
         ccidade:= ncodfor1->cep
         ctelefone:= ncodfor1->ferase
         ccep:= ncodfor1->contato
         ddataincl:= ncodfor1->telefone
         ccgc:= ncodfor1->cgc
         cinsc:= ncodfor1->inscricao
         cobs1:= ncodfor1->obs1
         cobs2:= ncodfor1->obs2
         creg:= ncodfor1->pessoa
         nagnbco:= ncodfor1->agn_bco
         vcod13i:= ncodfor1->nome_repr
         ctelbco:= ncodfor1->nom_ref1
         cendrep:= ncodfor1->end_repr
         cbairrep:= ncodfor1->bair_repr
         ccidrep:= ncodfor1->cid_repr
         cceprep:= ncodfor1->cep_repr
         cfonerep:= ncodfor1->fone_repr
         cfaxrep:= ncodfor1->fax_repr
         cufrep:= ncodfor1->uf_repr
         cnombco:= ncodfor1->codigo_cc
         ncodcc:= ncodfor1->vcodi13a
         qsr14i:= ncodfor1->codigo_for
      endif
      close
      if (sai())
         loop
      endif
      @ nlinha + 1, ncoluna + 13 get cNome picture "@!"
      @ nlinha + 1, ncoluna + 51 get cPessoa picture "!"
      valnom2()
      dbunlockal:= escolhelin({"Altera", "Exclui"}, 2, tela11i, ;
         ncoluna + 1)
      if (dbunlockal == 2)
         clear gets
      else
         read
      endif
      if (sai())
         loop
      endif
      if (!conflinha("Confirma Operacao ?", tela11i, ncoluna + 1))
         loop
      endif
      if (!abredbf("Forneced"))
         loop
      endif
      set index to Fornece1, Fornece2
      seek qsr14i
      if (!Found())
         alert("Erro na Leitura de Reistro! Opercao sera Cancelada.")
         close
         lcontrole:= .F.
         loop
      endif
      if (!bloqueia())
         loop
      endif
      if (dbunlockal == 2)
         delete
      else
         replace nome with cnome
         replace contato with ccep
         replace endereco with cendereco
         replace cidade with cestado
         replace cep with ccidade
         replace ferase with ctelefone
         replace telefone with ddataincl
         replace cgc with ccgc
         replace inscricao with cinsc
         replace pessoa with creg
         replace obs2 with cobs2
         replace fone_bco with cpessoa
         replace obs1 with cobs1
         replace nom_ref1 with ctelbco
         replace agn_bco with nagnbco
         replace nome_repr with vcod13i
         replace end_repr with cendrep
         replace bair_repr with cbairrep
         replace cid_repr with ccidrep
         replace cep_repr with cceprep
         replace fone_repr with cfonerep
         replace fax_repr with cfaxrep
         replace uf_repr with cufrep
         replace codigo_cc with cnombco
         replace vcodi13a with ncodcc
      endif
      close
      ncodigo:= 0
      cnome:= Space(30)
      cpessoa:= Space(1)
      cendereco:= Space(30)
      cestado:= Space(15)
      ccidade:= Space(15)
      ctelefone:= Space(2)
      ccep:= Space(10)
      ddataincl:= Space(12)
      creg:= Space(30)
      ccgc:= Space(18)
      cinsc:= Space(14)
      cobs1:= Space(50)
      cobs2:= Space(50)
      nagnbco:= Space(30)
      ctelbco:= 0
      vcod13i:= Space(13)
      cendrep:= Space(30)
      cbairrep:= Space(30)
      ccidrep:= Space(15)
      cceprep:= Space(20)
      cfonerep:= Space(10)
      cfaxrep:= Space(13)
      cufrep:= Space(13)
      cnombco:= Space(2)
      ncodcc:= Space(7)
   enddo
   RestScreen(0, 0, 24, 79, ctela)
   set color to (ccor)
   set key K_F10 to pesquisa
   return

********************************
procedure QSR16I

   private ngrupo, cdesc, cobs1, cobs2
   private nlinha, ncoluna, lcontrole, ctela, ccor, vet[2]
   programa(0, 69, coropcoes)
   ngrupo:= 0
   cdesc:= Space(30)
   naliq1:= 0
   naliq2:= 0
   naliq3:= 0
   cobs1:= Space(30)
   cobs2:= Space(30)
   ncomisext:= 0
   tela16:= 0
   nlinha:= 4
   tela11i:= nlinha + 10
   ncoluna:= 9
   lcontrole:= .T.
   ctela:= SaveScreen(0, 0, 24, 79)
   ccor:= SetColor()
   vet[1]:= "Sim"
   vet[2]:= "Nao"
   janela(nlinha, ncoluna, tela11i, ncoluna + 50, "Inclusao de Grupo")
   nlinha++
   vcod16i()
   clear gets
   do while (lcontrole)
      ngrupo:= qsr16a()
      vcod16i()
      read
      if (sai())
         loop
      endif
      if (!conflinha("Confirma Inclusao ?", tela11i, ncoluna + 1))
         loop
      endif
      if (!abredbf("Grupo"))
         loop
      endif
      set index to Grupo, Grupo1
      if (!adiciona())
         loop
      endif
      if (!bloqueia())
         loop
      endif
      replace grupo with ngrupo
      replace descricao with cdesc
      replace aliquota1 with naliq1
      replace aliquota2 with naliq2
      replace aliquota3 with naliq3
      replace obs1 with cobs1
      replace obs2 with cobs2
      close
      ngrupo:= 0
      cdesc:= Space(30)
      cobs1:= Space(30)
      cobs2:= Space(30)
   enddo
   RestScreen(0, 0, 24, 79, ctela)
   set color to (ccor)
   return

********************************
procedure QSR14I

   private ncodigo, dinicio, cnome, cpessoa, cendereco, cestado, ;
      ccidade, ctelefone
   private ccep, ddataincl, ccgc, cinsc, nlinha, ncoluna, cconjuge, ;
      dfim
   private cnomerep, ccpf, lcontrole, ctela, ccor, vet[2], cesposa, ;
      cmae, cspc1, cestcivil, ncomis
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   nlinha:= 3
   tela11i:= nlinha + 12
   ncoluna:= 2
   lcontrole:= .T.
   ctela:= SaveScreen(0, 0, 24, 79)
   ccor:= SetColor()
   vet[1]:= "Sim"
   vet[2]:= "Nao"
   vcod14i:= 0
   janela(nlinha, ncoluna, tela11i, ncoluna + 76, ;
      "Inclusao de Funcionarios")
   nlinha++
   do while (lcontrole)
      ncodigo:= 0
      dinicio:= Space(20)
      cnome:= Space(30)
      cpessoa:= Space(1)
      cendereco:= Space(35)
      cestado:= Space(15)
      ccidade:= Space(15)
      ctelefone:= Space(2)
      ccep:= Space(10)
      ddataincl:= Space(12)
      cconjuge:= CToD("  /  /  ")
      ncomis:= Space(1)
      cestcivil:= Space(30)
      cmae:= Space(30)
      cspc1:= Space(30)
      cnomerep:= Space(18)
      ccpf:= Space(14)
      dfim:= CToD("  /  /  ")
      cesposa:= CToD("  /  /  ")
      ncomissao:= 0
      ncodigo:= tela14()
      @ nlinha + 1, ncoluna + 2 get nCodigo picture "99999"
      codigo_fun()
      clear gets
      codigo_fun()
      read
      if (sai())
         loop
      endif
      if (!conflinha("Confirma Inclusao ?", tela11i, ncoluna + 1))
         loop
      endif
      if (!abredbf("Funciona"))
         loop
      endif
      set index to Funcion1, Funcion2
      if (!adiciona())
         loop
      endif
      if (!bloqueia())
         loop
      endif
      replace est_civil with ncodigo
      replace nome with cnome
      replace endereco with cendereco
      replace cidade with cestado
      replace cep with ccidade
      replace ferase with ctelefone
      replace contato with ccep
      replace status with ncomis
      replace telefone with ddataincl
      replace identidade with dinicio
      replace cpf with cnomerep
      replace datanasc with ccpf
      replace esposa with cconjuge
      replace inicio with cestcivil
      replace mae with cmae
      replace spc1 with cspc1
      replace fim with dfim
      replace valnom3 with cesposa
      replace comissao with ncomissao
      close
   enddo
   RestScreen(0, 0, 24, 79, ctela)
   set color to (ccor)
   return

********************************
function TELA14

   @ nlinha, ncoluna + 2 say "Codigo"
   @ nlinha, ncoluna + 13 say "Nome do Funcionario"
   @ nlinha, ncoluna + 48 say "Cargo"
   @ nlinha + 2, ncoluna + 2 say "Endereco"
   @ nlinha + 2, ncoluna + 38 say "Bairro"
   @ nlinha + 2, ncoluna + 54 say "Cidade"
   @ nlinha + 2, ncoluna + 71 say "UF"
   @ nlinha + 4, ncoluna + 2 say "C.E.P."
   @ nlinha + 4, ncoluna + 13 say "Telefone"
   @ nlinha + 4, ncoluna + 26 say "Data Nasc"
   @ nlinha + 4, ncoluna + 37 say "Est Civ"
   @ nlinha + 4, ncoluna + 45 say "Nome do Conjugue"
   @ nlinha + 6, ncoluna + 2 say "Pai"
   @ nlinha + 6, ncoluna + 37 say "Me"
   @ nlinha + 8, ncoluna + 2 say "Carteira Identidade"
   @ nlinha + 8, ncoluna + 26 say "C.P.F."
   @ nlinha + 8, ncoluna + 42 say "Comissao"
   @ nlinha + 8, ncoluna + 54 say "Admisso"
   @ nlinha + 8, ncoluna + 64 say "Demisso"
   if (procname(1) = "SIA14I")
      @ nlinha + 1, ncoluna + 13 get cNome picture "@!" valid ;
         vcodi14()
   else
      @ nlinha + 1, ncoluna + 13 get cNome picture "@!"
   endif
   @ nlinha + 1, ncoluna + 48 get cStatus picture "@!"
   @ nlinha + 3, ncoluna + 2 get cEndereco picture "@!"
   @ nlinha + 3, ncoluna + 38 get cBairro picture "@!"
   @ nlinha + 3, ncoluna + 54 get cCidade picture "@!"
   @ nlinha + 3, ncoluna + 71 get cEstado picture "!!"
   @ nlinha + 5, ncoluna + 2 get cCep picture "99.999-999"
   @ nlinha + 5, ncoluna + 13 get cTelefone picture "999/999-9999"
   @ nlinha + 5, ncoluna + 26 get dDataNasc
   @ nlinha + 5, ncoluna + 37 get cEstCivil picture "!"
   @ nlinha + 5, ncoluna + 45 get cEsposa picture "@!"
   @ nlinha + 7, ncoluna + 2 get cPai picture "@!"
   @ nlinha + 7, ncoluna + 37 get cMae picture "@!"
   @ nlinha + 9, ncoluna + 2 get cReg picture "9999999-XXXXXXX"
   @ nlinha + 9, ncoluna + 26 get cCpf picture "999999999-99"
   @ nlinha + 9, ncoluna + 42 get nComissao picture "99.99"
   @ nlinha + 9, ncoluna + 54 get dInicio
   @ nlinha + 9, ncoluna + 64 get dFim
   return .T.

********************************
function VALNOM3

   if (Empty(cnome))
      alert("Ateno! No  permitido nome de Funcionario vazio")
      return .F.
   else
      abredbf("Funciona", "Funcion2.NTX")
      seek cnome
      if (Found())
         alert("Ateno! Funcionario j  Existe")
         close
         return .F.
      endif
   endif
   close
   return .T.

********************************
function GER144I

   if (!abredbf("LOCEST", "LOCEST1"))
      return .T.
   endif
   goto bottom
   return codigo + 1

********************************
procedure QSR14A

   private ncodigo, dinicio, cnome, cpessoa, cendereco, cestado, ;
      ccidade, ctelefone
   private ccep, ddataincl, ccgc, cinsc, nlinha, ncoluna, cconjuge, ;
      dfim
   private cnomerep, ccpf, lcontrole, ctela, ccor, vet[2], cesposa, ;
      cmae, cspc1, cestcivil, ncomis
   cpesquisa:= {"FUNCIONA", "FUNCION2", "CODIGO_FUN", "nCodigo"}
   ccampos:= {"CODIGO_FUN", "NOME", "", "CODIGO", "NOME", ""}
   programa(0, 69, coropcoes)
   nlinha:= 3
   tela11i:= nlinha + 12
   ncoluna:= 2
   lcontrole:= .T.
   ctela:= SaveScreen(0, 0, 24, 79)
   ccor:= SetColor()
   vet[1]:= "Sim"
   vet[2]:= "Nao"
   janela(nlinha, ncoluna, tela11i, ncoluna + 76, ;
      "Manutencao de Funcionarios")
   nlinha++
   do while (lcontrole)
      ncodigo:= 0
      dinicio:= Space(1)
      cnome:= Space(30)
      cpessoa:= Space(1)
      cendereco:= Space(35)
      cestado:= Space(15)
      ccidade:= Space(15)
      ctelefone:= Space(2)
      ccep:= Space(10)
      ddataincl:= Space(12)
      cconjuge:= CToD("  /  /  ")
      ncomis:= Space(1)
      cestcivil:= Space(30)
      cmae:= Space(30)
      cspc1:= Space(30)
      cnomerep:= Space(18)
      ccpf:= Space(14)
      dfim:= CToD("  /  /  ")
      cesposa:= CToD("  /  /  ")
      ncomissao:= 0
      codigo_fun()
      clear gets
      @ nlinha + 1, ncoluna + 2 get nCodigo picture "99999" valid ;
         qsr14a()
      read
      if (sai(""))
         loop
      endif
      if (!abredbf("Funciona", "Funcion1.NTX"))
         loop
      endif
      seek ncodigo
      if (!Found())
         alert("Registro nao Encontrado!")
         close
         loop
      else
         dinicio:= identidade
         cnome:= nome
         cendereco:= endereco
         cestado:= cidade
         ccidade:= cep
         ctelefone:= ferase
         ccep:= contato
         ddataincl:= telefone
         cconjuge:= esposa
         ncomis:= status
         cestcivil:= inicio
         cmae:= mae
         cspc1:= spc1
         cnomerep:= cpf
         ccpf:= datanasc
         dfim:= fim
         cesposa:= valnom3
         ncomissao:= comissao
      endif
      close
      codigo_fun()
      dbunlockal:= escolhelin({"Altera", "Exclui"}, 2, tela11i, ;
         ncoluna + 1)
      if (dbunlockal == 2)
         clear gets
         ncod12i:= "Confirma Exclusao ?"
      else
         ncod12i:= "Confirma Alteracao ?"
         read
      endif
      if (sai())
         loop
      endif
      if (!conflinha(ncod12i, tela11i, ncoluna + 1))
         loop
      endif
      if (cpessoa = "F")
         ccgc:= cnomerep
         cinsc:= ccpf
      endif
      if (!abredbf("Funciona"))
         loop
      endif
      set index to FUNCION1, FUNCION2
      seek ncodigo
      if (!bloqueia())
         loop
      endif
      if (dbunlockal == 2)
         delete
      else
         replace est_civil with ncodigo
         replace nome with cnome
         replace endereco with cendereco
         replace cidade with cestado
         replace cep with ccidade
         replace ferase with ctelefone
         replace contato with ccep
         replace status with ncomis
         replace telefone with ddataincl
         replace identidade with dinicio
         replace cpf with cnomerep
         replace datanasc with ccpf
         replace esposa with cconjuge
         replace inicio with cestcivil
         replace mae with cmae
         replace spc1 with cspc1
         replace fim with dfim
         replace valnom3 with cesposa
         replace comissao with ncomissao
      endif
      close
   enddo
   RestScreen(0, 0, 24, 79, ctela)
   set color to (ccor)
   return

********************************
function PESQ15I

   if (Upper(readvar()) = "NGRUPO")
      cpesquisa:= {"GRUPO", "GRUPO1", "GRUPO", "nGrupo"}
      ccampos:= {"Grupo", "Descricao", "", "GRUPO", "DESCRICAO", ""}
   elseif (Upper(readvar()) = "CCODFOR")
      cpesquisa:= {"FORNECED", "FORNECE2", "CODIGO_FOR", "cCodFor"}
      ccampos:= {"CODIGO_FOR", "NOME", "", "CODIGO", "NOME", ""}
   endif
   pesquisa()
   return .T.

********************************
function GERCOD19I

   if (!abredbf("Cent_Cus"))
      return .F.
   endif
   set index to Centro1, Centro2
   goto bottom
   ncod:= vcodi13a
   ncod++
   close
   return ncod

********************************
procedure QSR15I

   private ngrupo, cdesc, clocal, nestoque, dinicio, nestmin, ;
      nestmax, nloja0
   private nloja1, nloja2, nloja3, nloja4, nvlrcomp
   private nvlrvend, ddatacomp, npespec, nvlrpraz, pesq15i
   private nlinha, ncoluna, lcontrole, ctela, ccor, vet[2]
   public ccodigo
   set key K_F10 to nvlrmed
   programa(0, 69, coropcoes)
   ngrupo:= 0
   ccodfor:= 0
   cdesc:= Space(40)
   clocal:= Space(3)
   nestoque:= Space(5)
   dinicio:= Space(1)
   nestmin:= 0
   nestmax:= 0
   nloja0:= 0
   nvlrcust:= 0
   nvlrvend:= 0
   ddatacomp:= 0
   nmargpro:= 0
   npespec:= CToD("  /  /  ")
   nvlrpraz:= 0
   gercod15i:= 0
   cmarca:= Space(10)
   nlinha:= 4
   ncoluna:= 9
   tela11i:= nlinha + 12
   lcontrole:= .T.
   ctela:= SaveScreen(0, 0, 24, 79)
   ccor:= SetColor()
   vet[1]:= "Sim"
   vet[2]:= "Nao"
   janela(nlinha, ncoluna, tela11i, ncoluna + 65, ;
      "Inclusao de Produtos")
   nlinha++
   ccodigo:= tela15(ccodigo)
   do while (lcontrole)
      local()
      clear gets
      @ nlinha + 1, ncoluna + 2 get cCodigo picture "XXXXX"
      read
      if (sai(""))
         loop
      endif
      ccodigo:= Replicate("0", 5 - Len(Trim(ccodigo))) + Trim(ccodigo)
      @ nlinha + 1, ncoluna + 2 get cCodigo
      clear gets
      if (!valcodi6(ccodigo))
         loop
      endif
      local()
      read
      if (sai())
         loop
      endif
      if (!conflinha("Confirma Inclusao ?", tela11i, ncoluna + 1))
         loop
      endif
      if (!abredbf("Produtos"))
         loop
      endif
      set index to Produto1, Produto2, Produto3, Produto4, Produto5
      if (!adiciona())
         loop
      endif
      if (!bloqueia())
         loop
      endif
      replace codigo with ccodigo
      replace grupo with ngrupo
      replace codigo_for with ccodfor
      replace descricao with cdesc
      replace nct with clocal
      replace est_minimo with nestoque
      replace identidade with dinicio
      replace estoque with nestmin
      replace est_maximo with nestmax
      replace valor_cust with nloja0
      replace valor_ultc with nvlrvend
      replace data_ultc with nmargpro
      replace valor with ddatacomp
      replace peso with npespec
      replace margempro with nvlrpraz
      replace qsr15a with gercod15i
      replace marca with cmarca
      close
      ccodfor:= 0
      cdesc:= Space(40)
      nestoque:= Space(5)
      dinicio:= Space(1)
      nestmin:= 0
      nloja1:= 0
      nloja2:= 0
      nloja3:= 0
      nloja4:= 0
      nvlrcomp:= 0
      nestmax:= 0
      nloja0:= 0
      nvlrvend:= 0
      ddatacomp:= 0
      nmargpro:= 0
      npespec:= CToD("  /  /  ")
      nvlrpraz:= 0
      ccodigo:= Val(ccodigo) + 1
      ccodigo:= Str(ccodigo, 5)
      ccodigo:= Replicate("0", 5 - Len(LTrim(ccodigo))) + ;
         LTrim(ccodigo)
   enddo
   RestScreen(0, 0, 24, 79, ctela)
   set color to (ccor)
   return

********************************
procedure TELA16

   @ nlinha + 0, ncoluna + 2 say "Grupo"
   @ nlinha + 0, ncoluna + 12 say "Descrio"
   @ nlinha + 2, ncoluna + 2 say "Aliquota Estadual"
   @ nlinha + 2, ncoluna + 21 say "InterEstadual"
   @ nlinha + 2, ncoluna + 35 say "Consumidor"
   @ nlinha + 4, ncoluna + 2 say "Observao 1"
   @ nlinha + 6, ncoluna + 2 say "Observao 2"
   @ nlinha + 1, ncoluna + 2 get nGrupo picture "999"
   @ nlinha + 1, ncoluna + 12 get cDesc picture "@!"
   @ nlinha + 3, ncoluna + 11 get nAliq1 picture "99"
   @ nlinha + 3, ncoluna + 21 get nAliq2 picture "99"
   @ nlinha + 3, ncoluna + 35 get nAliq3 picture "99"
   @ nlinha + 5, ncoluna + 2 get cObs1
   @ nlinha + 7, ncoluna + 2 get cObs2

********************************
function TELA15

   @ nlinha + 0, ncoluna + 2 say "Codigo"
   @ nlinha + 0, ncoluna + 9 say "Grupo"
   @ nlinha + 0, ncoluna + 44 say "Codigo Fornecedor"
   @ nlinha + 2, ncoluna + 2 say "Descrio"
   @ nlinha + 2, ncoluna + 44 say "Marca"
   @ nlinha + 2, ncoluna + 56 say "Unid"
   @ nlinha + 4, ncoluna + 2 say "Est Min"
   @ nlinha + 4, ncoluna + 12 say "Est Max"
   @ nlinha + 4, ncoluna + 22 say "Estoque"
   @ nlinha + 6, ncoluna + 2 say "Vl.Compra"
   @ nlinha + 6, ncoluna + 12 say "Vl.Custo"
   @ nlinha + 6, ncoluna + 22 say "Vl.Venda"
   @ nlinha + 8, ncoluna + 2 say "Dt.compra"
   @ nlinha + 8, ncoluna + 12 say "Peso Pc"
   @ nlinha + 8, ncoluna + 22 say "Margem Lucro"
   @ nlinha + 1, ncoluna + 9 get nGrupo picture "999" valid ;
      valgrupo(ngrupo)
   @ nlinha + 1, ncoluna + 44 get cCodfor picture "99999"
   @ nlinha + 3, ncoluna + 2 get cDesc picture "@!" valid ;
      valdesc6(cdesc)
   @ nlinha + 3, ncoluna + 44 get cMarca picture "@!"
   @ nlinha + 3, ncoluna + 56 get cUnid picture "@!"
   @ nlinha + 5, ncoluna + 2 get nEstMin picture "99,999.99"
   @ nlinha + 5, ncoluna + 12 get nEstMax picture "99,999.99"
   @ nlinha + 5, ncoluna + 22 get nEstoque picture "99,999.99" when ;
      .F.
   @ nlinha + 7, ncoluna + 2 get nVlrComp picture "99,999.99"
   @ nlinha + 7, ncoluna + 12 get nVlrCust picture "99,999.99"
   @ nlinha + 7, ncoluna + 22 get nVlrVend picture "99,999.99"
   @ nlinha + 9, ncoluna + 2 get dDataComp when .F.
   @ nlinha + 9, ncoluna + 12 get nPesPec picture "999.99"
   @ nlinha + 9, ncoluna + 22 get nMargPro picture "999.99"
   return .T.

********************************
function PESQ15A

   if (Upper(readvar()) = "CCODIGO")
      cpesquisa:= {"PRODUTOS", "PRODUTO2", "CODIGO", "cCodigo"}
      ccampos:= {"CODIGO", "DESCRICAO", "", "CODIGO", "DESCRICAO", ""}
   elseif (Upper(readvar()) = "CCODFOR")
      cpesquisa:= {"FORNECED", "FORNECE2", "Codigo_For", "cCodFor"}
      ccampos:= {"CODIGO_FOR", "NOME", "", "CODIGO", "NOME", ""}
   elseif (Upper(readvar()) = "NGRUPO")
      cpesquisa:= {"GRUPO", "GRUPO1", "GRUPO", "nGrupo"}
      ccampos:= {"GRUPO", "DESCRICAO", "", "GRUPO", "DESCRICAO", ""}
   endif
   pesquisa()
   return .T.

********************************
function VALLOCAL2(Arg1)

   private v1[2], v2[2], v3[2]
   if (!abredbf("LOCALIZA", "Localiz1.NTX"))
      return .F.
   endif
   seek Arg1
   if (!Found())
      alert("Codigo Nao Cadastrado")
      close
      return .F.
   else
      close
      return .T.
   endif
   return .T.

********************************
procedure QSR15A

   private ngrupo, cdesc, clocal, nestoque, dinicio, nestmin, ;
      nestmax, nloja0
   private nloja1, nloja2, nloja3, nloja4, nvlrcomp
   private nvlrcust, nvlrvend, ddatacomp, npespec, nvlrpraz, ;
      pesq15i, nvlrcust
   private nlinha, ncoluna, lcontrole, ctela, ccor, vet[2]
   public ccodigo
   set key K_F10 to __MXRelease
   programa(0, 69, coropcoes)
   nlinha:= 4
   tela11i:= nlinha + 13
   ncoluna:= 9
   lcontrole:= .T.
   ctela:= SaveScreen(0, 0, 24, 79)
   ccor:= SetColor()
   vet[1]:= "Sim"
   vet[2]:= "Nao"
   cmarca:= Space(15)
   janela(nlinha, ncoluna, tela11i, ncoluna + 68, ;
      "Manutencao de Produtos")
   nlinha++
   do while (lcontrole)
      cmarca:= Space(10)
      ccodigo:= Space(5)
      ngrupo:= 0
      ccodfor:= 0
      cdesc:= Space(40)
      clocal:= Space(3)
      nestmin:= 0
      nestmax:= 0
      nloja0:= 0
      nvlrvend:= 0
      ddatacomp:= 0
      nmargpro:= 0
      npespec:= CToD("  /  /  ")
      nvlrpraz:= 0
      gercod15i:= 0
      local()
      clear gets
      @ nlinha + 1, ncoluna + 2 get cCodigo picture "XXXXX"
      read
      if (sai())
         loop
      endif
      ccodigo:= Replicate("0", 5 - Len(Trim(ccodigo))) + Trim(ccodigo)
      if (!valcodi6a(ccodigo))
         loop
      endif
      @ nlinha + 1, ncoluna + 2 get cCodigo
      clear gets
      if (sai())
         loop
      endif
      if (!abredbf("PRODUTOS", "PRODUTO1.NTX"))
         loop
      endif
      seek ccodigo
      if (!Found())
         alert("C¢digo no encontrado.")
         loop
      else
         ngrupo:= grupo
         ccodfor:= codigo_for
         cdesc:= descricao
         clocal:= nct
         nestoque:= est_minimo
         dinicio:= identidade
         nestmin:= estoque
         nestmax:= est_maximo
         nloja0:= valor_cust
         nvlrvend:= valor_ultc
         nmargpro:= data_ultc
         ddatacomp:= valor
         npespec:= peso
         nvlrpraz:= margempro
         gercod15i:= qsr15a
         cmarca:= marca
      endif
      close
      valgrupo(ngrupo)
      @ nlinha + 7, ncoluna + 2 say nestmin picture "@E 99,999.99"
      clear gets
      local()
      dbunlockal:= escolhelin({"Altera", "Exclui"}, 2, tela11i, ;
         ncoluna + 1)
      if (dbunlockal == 2)
         clear gets
         qsr13i:= "Confima Exclusao ?"
      else
         read
         qsr13i:= "Confima Alteracao ?"
      endif
      if (sai())
         loop
      endif
      if (!conflinha(qsr13i, tela11i, ncoluna + 1))
         loop
      endif
      if (!abredbf("PRODUTOS"))
         loop
      endif
      set index to Produto1, Produto2, Produto3, Produto4, Produto5
      seek ccodigo
      if (!bloqueia())
         loop
      endif
      if (dbunlockal == 2)
         delete
      else
         replace codigo with ccodigo
         replace grupo with ngrupo
         replace codigo_for with ccodfor
         replace descricao with cdesc
         replace nct with clocal
         replace est_minimo with nestoque
         replace identidade with dinicio
         replace estoque with nestmin
         replace est_maximo with nestmax
         replace valor_cust with nloja0
         replace valor_ultc with nvlrvend
         replace valor with ddatacomp
         replace data_ultc with nmargpro
         replace peso with npespec
         replace margempro with nvlrpraz
         replace qsr15a with gercod15i
         replace marca with cmarca
      endif
      close
   enddo
   qsr16i("cCodigo")
   RestScreen(0, 0, 24, 79, ctela)
   set color to (ccor)
   set key K_F10 to pesquisa
   return

********************************
function VALCOD101I(Arg1)

   private vet1[2], vet2[2], vet3[2]
   if (Arg1 == 0)
      alert("NÆo permitido campo vazio")
      return .F.
   endif
   if (!abredbf("FUNCIONA", "FUNCION1.NTX"))
      return .F.
   endif
   seek Arg1
   if (!Found())
      alert("Funcionario Nao Existe")
      close
      return .F.
   else
      @ nlinha + 1, ncoluna + 10 say nome
      close
      return .T.
   endif

********************************
procedure QSR16A

   private ngrupo, cdesc, cobs1, cobs2
   private nlinha, ncoluna, lcontrole, ctela, ccor, vet[2]
   cpesquisa:= {"GRUPO", "GRUPO1", "GRUPO", "nGrupo"}
   ccampos:= {"GRUPO", "DESCRICAO", "", "GRUPO", "DESCRICAO", ""}
   programa(0, 69, coropcoes)
   ngrupo:= 0
   cdesc:= Space(30)
   naliq1:= 0
   naliq2:= 0
   naliq3:= 0
   cobs1:= Space(30)
   cobs2:= Space(30)
   ncomisext:= 0
   tela16:= 0
   nlinha:= 4
   tela11i:= nlinha + 11
   ncoluna:= 9
   lcontrole:= .T.
   ctela:= SaveScreen(0, 0, 24, 79)
   ccor:= SetColor()
   vet[1]:= "Sim"
   vet[2]:= "Nao"
   janela(nlinha, ncoluna, tela11i, ncoluna + 50, ;
      "Manutencao de Grupos")
   nlinha++
   do while (lcontrole)
      vcod16i()
      clear gets
      @ nlinha + 1, ncoluna + 2 get nGrupo picture "999" valid ;
         valgrp1(ngrupo)
      read
      if (sai())
         loop
      endif
      if (!abredbf("Grupo", "Grupo.NTX"))
         loop
      endif
      seek ngrupo
      if (!Found())
         alert("Grupo no encontrado.")
         loop
      else
         cdesc:= descricao
         cobs1:= obs1
         cobs2:= obs2
         naliq1:= aliquota1
         naliq2:= aliquota2
         naliq3:= aliquota3
      endif
      close
      @ nlinha + 1, ncoluna + 12 get cDesc picture "@!" valid cdesc ;
         != " "
      @ nlinha + 3, ncoluna + 11 get nAliq1 picture "99"
      @ nlinha + 3, ncoluna + 21 get nAliq2 picture "99"
      @ nlinha + 3, ncoluna + 35 get nAliq3 picture "99"
      @ nlinha + 5, ncoluna + 2 get cObs1
      @ nlinha + 7, ncoluna + 2 get cObs2
      dbunlockal:= escolhelin({"Altera", "Exclui"}, 2, tela11i, ;
         ncoluna + 1)
      if (dbunlockal == 2)
         clear gets
      else
         read
      endif
      if (sai())
         loop
      endif
      if (!conflinha("Confirma Manutencao ?", tela11i, ncoluna + 1))
         loop
      endif
      if (!abredbf("GRUPO"))
         loop
      endif
      set index to Grupo, Grupo1
      seek ngrupo
      if (!bloqueia())
         loop
      endif
      if (dbunlockal == 2)
         delete
      else
         replace descricao with cdesc
         replace aliquota1 with naliq1
         replace aliquota2 with naliq2
         replace aliquota3 with naliq3
         replace obs1 with cobs1
         replace obs2 with cobs2
      endif
      close
      ngrupo:= 0
      cdesc:= Space(30)
      naliq1:= 0
      naliq2:= 0
      cobs1:= Space(30)
      cobs2:= Space(30)
      ncomisext:= 0
      tela16:= 0
   enddo
   RestScreen(0, 0, 24, 79, ctela)
   set color to (ccor)
   return

********************************
function VALGRP101I(Arg1, Arg2)

   private vet1[2], vet2[2], vet3[2]
   if (Arg1 == 0)
      alert("NÆo permitido campo vazio")
      return .F.
   endif
   if (!abredbf("GRUPO", "GRUPO.NTX"))
      return .F.
   endif
   seek Arg1
   if (!Found())
      alert("Grupo nao existe")
      close
      return .F.
   else
      @ nlinha + 3, ncoluna + 10 say descricao
      close
      if (!abredbf("COMISSAO", "COMIS1.NTX"))
         return .F.
      endif
      seek Arg2
      if (Found())
         alert("ComissÆo ja cadastrada !")
         close
         return .F.
      else
         close
         return .T.
      endif
   endif

********************************
function VALFR

   if (!abredbf("FERIADO", "FERIADO1.NTX"))
      return .F.
   endif
   seek valfr
   if (Found())
      alert("DATA JA CADASTRADA ! ; " + descricao)
      close
      return .F.
   endif
   close
   return .T.

********************************
procedure QSR17A

   private ncodigo, cdesc
   private nlinha, ncoluna, lcontrole, ctela, ccor, vet[2]
   cpesquisa:= {"LOCALIZA", "LOCALIZ1", "CODIGO_LOC", "nCodigo"}
   ccampos:= {"CODIGO_LOC", "DESCRICAO", "", "GRUPO", "DESCRICAO", ""}
   programa(0, 69, coropcoes)
   ncodigo:= 0
   cdesc:= Space(30)
   nlinha:= 10
   tela11i:= nlinha + 4
   ncoluna:= 9
   lcontrole:= .T.
   ctela:= SaveScreen(0, 0, 24, 79)
   ccor:= SetColor()
   vet[1]:= "Sim"
   vet[2]:= "Nao"
   janela(nlinha, ncoluna, tela11i, ncoluna + 50, ;
      "Manutencao de Localizacoes")
   @ nlinha + 1, ncoluna + 2 say "Codigo"
   @ nlinha + 1, ncoluna + 12 say "Descrio"
   @ nlinha + 2, ncoluna + 2 get nCodigo picture "99999"
   @ nlinha + 2, ncoluna + 12 get cDesc picture "@!"
   clear gets
   do while (lcontrole)
      @ nlinha + 2, ncoluna + 2 get nCodigo picture "99999" valid ;
         qsr18i(ncodigo)
      read
      if (sai())
         loop
      endif
      if (!abredbf("LOCALIZA", "LOCALIZ1.NTX"))
         loop
      endif
      seek ncodigo
      if (Found())
         ncodigo:= qsr17a
         cdesc:= descricao
      endif
      close
      @ nlinha + 2, ncoluna + 12 get cDesc picture "@!"
      dbunlockal:= escolhelin({"Altera", "Exclui"}, 2, tela11i, ;
         ncoluna + 1)
      if (dbunlockal == 2)
         clear gets
      else
         read
      endif
      if (sai())
         loop
      endif
      if (!conflinha("Confirma Inclusao ?", tela11i, ncoluna + 1))
         loop
      endif
      if (!abredbf("Localiza", "Localiz1.NTX"))
         loop
      endif
      seek ncodigo
      if (!bloqueia())
         loop
      endif
      if (dbunlockal == 2)
         delete
      else
         replace qsr17a with ncodigo
         replace descricao with cdesc
      endif
      close
      ncodigo:= 0
      cdesc:= Space(30)
   enddo
   RestScreen(0, 0, 24, 79, ctela)
   set color to (ccor)
   return

********************************
function PESQ18

   if (Upper(readvar()) = "NVENDEDOR")
      cpesquisa:= {"FUNCIONA", "FUNCION1", "CODIGO_FUN", "nVendedor"}
      ccampos:= {"CODIGO_FUN", "NOME", "", "CODIGO", "NOME", ""}
   elseif (Upper(readvar()) = "NGRUPO")
      cpesquisa:= {"GRUPO", "GRUPO1", "GRUPO", "nGrupo"}
      ccampos:= {"GRUPO", "DESCRICAO", "", "GRUPO", "DESCRICAO", ""}
   endif
   pesquisa()
   return .T.

********************************
function VALGRP101A(Arg1, Arg2)

   private vet1[2], vet2[2], vet3[2]
   if (Arg1 == 0)
      alert("NÆo permitido campo vazio")
      return .F.
   endif
   if (!abredbf("GRUPO", "GRUPO"))
      return .F.
   endif
   seek Arg1
   if (!Found())
      alert("Grupo Nao Existe")
      close
      return .F.
   else
      @ nlinha + 3, ncoluna + 9 say descricao
      close
      if (!abredbf("COMISSAO", "COMIS1"))
         return .F.
      endif
      seek Arg2
      if (!Found())
         alert("Comissao Nao Cadastrada !")
         close
         return .F.
      endif
   endif
   close
   return .T.

********************************
function VALNNOORC(Arg1, Arg2)

   if (!abredbf("ORCAMENT", "ORCAMEN1.NTX"))
      return .F.
   endif
   if (Arg2 == 0)
      return .F.
   endif
   seek Arg1
   if (Found())
      alert(" Orcamento ja Cadastrado ")
      close
      return .F.
   else
      close
      return .T.
   endif
   return .F.

********************************
procedure QSR18I

   private ngrupo, cdesc, cobs1, cobs2
   private nlinha, ncoluna, lcontrole, ctela, ccor, vet[2]
   set key K_F10 to nvendedor
   programa(0, 69, coropcoes)
   valcod101i:= 0
   ngrupo:= 0
   vcod14i:= 0
   nlinha:= 10
   tela11i:= nlinha + 6
   ncoluna:= 9
   lcontrole:= .T.
   ctela:= SaveScreen(0, 0, 24, 79)
   ccor:= SetColor()
   vet[1]:= "Sim"
   vet[2]:= "Nao"
   janela(nlinha, ncoluna, tela11i, ncoluna + 50, ;
      "Inclusao de Comissoes")
   nlinha++
   @ nlinha + 0, ncoluna + 2 say "Vendedor"
   @ nlinha + 2, ncoluna + 2 say "Grupo"
   @ nlinha + 2, ncoluna + 30 say "Comissao"
   @ nlinha + 1, ncoluna + 2 get nVendedor picture "99999"
   @ nlinha + 3, ncoluna + 2 get nGrupo picture "999"
   @ nlinha + 3, ncoluna + 30 get nComis picture "99.99"
   clear gets
   do while (lcontrole)
      @ nlinha + 1, ncoluna + 2 get nVendedor picture "99999" valid ;
         valgrp101i(valcod101i)
      @ nlinha + 3, ncoluna + 2 get nGrupo picture "999" valid ;
         qsr18a(ngrupo, Str(valcod101i, 5) + Str(ngrupo, 3))
      @ nlinha + 3, ncoluna + 30 get nComis picture "99.99"
      read
      if (sai())
         loop
      endif
      if (!conflinha("Confirma inclusao ?", tela11i, ncoluna + 1))
         loop
      endif
      if (!abredbf("COMISSAO", "COMIS1.NTX"))
         loop
      endif
      if (!adiciona())
         loop
      endif
      if (!bloqueia())
         loop
      endif
      replace vendedor with valcod101i
      replace grupo with ngrupo
      replace comissao with vcod14i
      close
      valcod101i:= 0
      ngrupo:= 0
      vcod14i:= 0
   enddo
   RestScreen(0, 0, 24, 79, ctela)
   set color to (ccor)
   set key K_F10 to pesquisa
   return

********************************
procedure QSR19I

   private ncodigo, cdesc
   private nlinha, ncoluna, lcontrole, ctela, ccor, vet[2]
   programa(0, 69, coropcoes)
   ncodigo:= ccodh()
   cdesc:= Space(30)
   valcodh:= Space(7)
   nlinha:= 10
   tela11i:= nlinha + 4
   ncoluna:= 9
   lcontrole:= .T.
   ctela:= SaveScreen(0, 0, 24, 79)
   ccor:= SetColor()
   vet[1]:= "Sim"
   vet[2]:= "Nao"
   janela(nlinha, ncoluna, tela11i, ncoluna + 50, ;
      "Inclusao de Centro de Custos")
   @ nlinha + 1, ncoluna + 2 say "Codigo"
   @ nlinha + 1, ncoluna + 12 say "Descrio"
   @ nlinha + 2, ncoluna + 2 get nCodigo picture "99999"
   @ nlinha + 2, ncoluna + 12 get cDesc picture "@!"
   clear gets
   do while (lcontrole)
      ncodigo:= ccodh()
      @ nlinha + 2, ncoluna + 2 get cCodH picture "9999999" valid ;
         ccod2(valcodh)
      @ nlinha + 2, ncoluna + 12 get cDesc picture "@!"
      read
      if (sai())
         loop
      endif
      if (!conflinha("Confirma Inclusao ?", tela11i, ncoluna + 1))
         loop
      endif
      if (!abredbf("Cent_Cus"))
         loop
      endif
      set index to CENTRO1, CENTRO2
      if (!adiciona())
         loop
      endif
      if (!bloqueia())
         loop
      endif
      replace vcodi13a with ncodigo
      replace descricao with cdesc
      replace cod_hier with valcodh
      close
      ncodigo:= 0
      cdesc:= Space(30)
      valcodh:= Space(7)
   enddo
   RestScreen(0, 0, 24, 79, ctela)
   set color to (ccor)
   return

********************************
procedure QSR18A

   private ngrupo, cdesc, cobs1, cobs2
   private nlinha, ncoluna, lcontrole, ctela, ccor, vet[2]
   set key K_F10 to nvendedor
   programa(0, 69, coropcoes)
   valcod101i:= 0
   ngrupo:= 0
   vcod14i:= 0
   nlinha:= 10
   tela11i:= nlinha + 6
   ncoluna:= 9
   lcontrole:= .T.
   ctela:= SaveScreen(0, 0, 24, 79)
   ccor:= SetColor()
   vet[1]:= "Sim"
   vet[2]:= "Nao"
   janela(nlinha, ncoluna, tela11i, ncoluna + 50, ;
      "Manutencao de Comissoes")
   nlinha++
   @ nlinha + 0, ncoluna + 2 say "Vendedor"
   @ nlinha + 2, ncoluna + 2 say "Grupo"
   @ nlinha + 2, ncoluna + 30 say "Comissao"
   do while (lcontrole)
      @ nlinha + 1, ncoluna + 2 get nVendedor picture "99999"
      @ nlinha + 3, ncoluna + 2 get nGrupo picture "999"
      @ nlinha + 3, ncoluna + 30 get nComis picture "99.99"
      clear gets
      @ nlinha + 1, ncoluna + 2 get nVendedor picture "99999" valid ;
         valgrp101i(valcod101i)
      @ nlinha + 3, ncoluna + 2 get nGrupo picture "999" valid ;
         ccomis(ngrupo, Str(valcod101i, 5) + Str(ngrupo, 3))
      read
      if (sai())
         loop
      endif
      qsr19i:= Str(valcod101i, 5) + Str(ngrupo, 3)
      if (!abredbf("COMISSAO", "COMIS1.NTX"))
         loop
      endif
      seek qsr19i
      if (Found())
         vcod14i:= comissao
      else
         alert("Registro nao encontrado")
         loop
      endif
      close
      @ nlinha + 3, ncoluna + 30 get nComis picture "99.99"
      dbunlockal:= escolhelin({"Altera", "Exclui"}, 2, tela11i, ;
         ncoluna + 1)
      if (dbunlockal == 2)
         clear gets
      else
         read
      endif
      if (sai())
         loop
      endif
      if (!conflinha("Confirma Manutencao ?", tela11i, ncoluna + 1))
         loop
      endif
      if (!abredbf("COMISSAO", "COMIS1.NTX"))
         loop
      endif
      seek qsr19i
      if (!bloqueia())
         loop
      endif
      if (dbunlockal == 2)
         delete
      else
         replace vendedor with valcod101i
         replace grupo with ngrupo
         replace comissao with vcod14i
      endif
      close
      valcod101i:= 0
      ngrupo:= 0
      vcod14i:= 0
   enddo
   RestScreen(0, 0, 24, 79, ctela)
   set color to (ccor)
   return

********************************
function VALCODH2(Arg1)

   private v1[2], v2[2], v3[2]
   if (Len(Trim(Arg1)) != 2 .AND. Len(Trim(Arg1)) != 4 .AND. ;
         Len(Trim(Arg1)) != 7)
      alert("Formato do Centro de Custo Invalido")
      return .F.
   endif
   if (Empty(Arg1))
      alert("Ateno! No  permitido Codigo igual a zero")
      return .F.
   else
      if (!abredbf("CENT_CUS", "CENTRO2.NTX"))
         return .F.
      endif
      seek Arg1
      if (!Found())
         alert("Centro de Custos Nao Cadastrado")
         close
         return .F.
      endif
   endif
   close
   return .T.

********************************
function VALLOC144A(Arg1, Arg2, Arg3)

   private v1[2], v2[2], v3[2]
   if (!abredbf("LOCEST", "LOCEST1"))
      return .T.
   endif
   seek Arg1
   if (Found())
      if (procname(1) = "(b)QSR29EN" .OR. procname(1) = "(b)QSR29T" ;
            .OR. procname(1) = "(b)QSR271" .OR. procname(3) = ;
            "QSR271" .OR. procname(1) = "(b)GRAVAPED2")
         @ Arg2, Arg3 say descricao color "W+/B"
      endif
      close
      return .T.
   else
      alert("Codigo NÆo Cadastrado")
      close
      return .F.
   endif

********************************
function VALCODH(Arg1)

   private v1[2], v2[2], v3[2]
   if (Len(Trim(Arg1)) != 2 .AND. Len(Trim(Arg1)) != 4 .AND. ;
         Len(Trim(Arg1)) != 7)
      alert("Formato do Centro de Custo Invalido")
      return .F.
   endif
   if (Empty(Arg1))
      alert("Ateno! No  permitido Codigo igual a zero")
      return .F.
   else
      if (!abredbf("Cent_Cus"))
         return .F.
      endif
      set index to Centro2, Centro1
      seek Arg1
      if (Found())
         alert("Centro de Custos Ja Cadastrado")
         close
         return .F.
      endif
      if (Len(Trim(Arg1)) == 4)
         qsr19a:= SubStr(Arg1, 1, 2)
         seek qsr19a
         if (!Found())
            alert("Primeiro Nivel do Centro de Custo Nao Encontrado")
            close
            return .F.
         endif
      endif
      if (Len(Trim(Arg1)) == 7)
         qsr19a:= SubStr(Arg1, 1, 2)
         seek qsr19a
         if (!Found())
            alert("Primeiro nivel do centro de custo nao encontrado")
            close
            return .F.
         endif
         qsr19a:= SubStr(Arg1, 1, 4)
         seek qsr19a
         if (!Found())
            alert("Segundo nivel do centro de custo nao encontrado")
            close
            return .F.
         endif
      endif
   endif
   close
   return .T.

********************************
function CALC271

   ntotquanti:= 0
   ntotvalor:= 0
   ntotpraz:= 0
   nrecno:= RecNo()
   goto top
   do while (!EOF())
      ntotquanti:= ntotquanti + esto
      ntotvalor:= ntotvalor + vend * esto
      ntotpraz:= ntotpraz + vend2
      skip 
   enddo
   ntotbrtv:= ntotbrtv + vend * esto
   @ nlinha + 16, ncoluna + 47 say ntotquanti picture "99999.99"
   @ nlinha + 17, ncoluna + 30 say "Total Liquido"
   @ nlinha + 17, ncoluna + 66 say ntotvalor picture "999,999.99"
   goto nrecno
   return .T.

********************************
procedure QSR19A

   private ncodigo, cdesc
   private nlinha, ncoluna, lcontrole, ctela, ccor, vet[2]
   cpesquisa:= {"CENT_CUS", "CENTRO1", "COD_HIER", "cCodH"}
   ccampos:= {"COD_HIER", "DESCRICAO", "", "CODIGO", "DESCRICAO", ""}
   programa(0, 69, coropcoes)
   ncodigo:= 0
   cdesc:= Space(30)
   valcodh:= Space(7)
   nlinha:= 10
   tela11i:= nlinha + 4
   ncoluna:= 9
   lcontrole:= .T.
   ctela:= SaveScreen(0, 0, 24, 79)
   ccor:= SetColor()
   vet[1]:= "Sim"
   vet[2]:= "Nao"
   janela(nlinha, ncoluna, tela11i, ncoluna + 50, ;
      "Manutencao de Centro de Custos")
   @ nlinha + 1, ncoluna + 2 say "Codigo"
   @ nlinha + 1, ncoluna + 12 say "Descrio"
   @ nlinha + 2, ncoluna + 2 get nCodigo picture "99999"
   @ nlinha + 2, ncoluna + 12 get cDesc picture "@!"
   clear gets
   do while (lcontrole)
      @ nlinha + 2, ncoluna + 12 get cDesc picture "@!"
      clear gets
      @ nlinha + 2, ncoluna + 2 get cCodH picture "9999999" valid ;
         qsrfri(valcodh)
      read
      if (sai())
         loop
      endif
      if (!abredbf("CENT_CUS", "CENTRO2.NTX"))
         loop
      endif
      seek valcodh
      if (Found())
         ncodigo:= vcodi13a
         cdesc:= descricao
      else
         alert("Codigo Nao Cadastrado")
         close
         loop
      endif
      close
      @ nlinha + 2, ncoluna + 12 get cDesc picture "@!"
      dbunlockal:= escolhelin({"Altera", "Exclui"}, 2, tela11i, ;
         ncoluna + 1)
      if (dbunlockal == 2)
         clear gets
      else
         read
      endif
      if (sai())
         loop
      endif
      if (!conflinha("Confirma Manutencao ?", tela11i, ncoluna + 1))
         loop
      endif
      if (!abredbf("CENT_CUS"))
         loop
      endif
      set index to CENTRO2, CENTRO1
      seek valcodh
      if (!bloqueia())
         loop
      endif
      if (dbunlockal == 2)
         delete
      else
         replace vcodi13a with ncodigo
         replace descricao with cdesc
      endif
      close
      ncodigo:= 0
      cdesc:= Space(30)
      valcodh:= Space(7)
   enddo
   RestScreen(0, 0, 24, 79, ctela)
   set color to (ccor)
   return

********************************
function CONFMOVBC

   local Local1, Local2, Local3, Local4, Local5, Local6, Local7, ;
      Local8, Local9, Local10, Local11, Local12, Local13, Local14, ;
      Local15, Local16, Local17
   Local17:= Select()
   Local2:= Space(10)
   Local1:= 0
   Local3:= Space(8)
   Local4:= 0
   Local5:= CToD("  /  /  ")
   Local6:= CToD("  /  /  ")
   Local13:= Date()
   Local7:= 0
   Local14:= 0
   Local8:= Space(40)
   Local9:= 7
   Local10:= 19
   Local11:= SetColor()
   Local16:= SaveScreen(0, 0, 24, 79)
   ntecla:= 0
   lcontrole:= .T.
   cdebcred:= pesconmb->valor_mb
   if (ntecla != 27)
      select Bancos
      if (!bloqueia())
         return Nil
      endif
      if (pesconmb->confir_mb != "S")
         if (!bloqueia())
            return Nil
         endif
         if (pesconmb->debcred_mb == "C")
            replace qsr21c->sa_conf_bc with qsr21c->sa_conf_bc + ;
               cdebcred
         elseif (pesconmb->debcred_mb == "D")
            replace qsr21c->sa_conf_bc with qsr21c->sa_conf_bc - ;
               cdebcred
         endif
         select Mov_Bco
         if (!bloqueia())
            return Nil
         endif
         replace pesconmb->confir_mb with "S"
      else
         if (!bloqueia())
            return Nil
         endif
         if (pesconmb->debcred_mb == "C")
            replace qsr21c->sa_conf_bc with qsr21c->sa_conf_bc - ;
               cdebcred
         elseif (pesconmb->debcred_mb == "D")
            replace qsr21c->sa_conf_bc with qsr21c->sa_conf_bc + ;
               cdebcred
         endif
         select Mov_Bco
         if (!bloqueia())
            return Nil
         endif
         replace pesconmb->confir_mb with " "
      endif
   endif
   set color to (Local11)
   select (Local17)
   RestScreen(0, 0, 24, 79, Local16)
   return Nil

********************************
function ACHADATA(Arg1)

   private vdata[12]
   vdata:= {"Jan", "Fev", "Mar", "Abr", "Mai", "Jun", "Jul", "Ago", ;
      "Set", "Out", "Nov", "Dez"}
   return vdata[Arg1]

********************************
procedure QSRFRI

   private ncodigo, cdesc
   private nlinha, ncoluna, lcontrole, ctela, ccor, vet[2]
   programa(0, 69, coropcoes)
   valfr:= CToD("")
   cdesc:= Space(20)
   nlinha:= 10
   tela11i:= nlinha + 4
   ncoluna:= 9
   lcontrole:= .T.
   ctela:= SaveScreen(0, 0, 24, 79)
   ccor:= SetColor()
   vet[1]:= "Sim"
   vet[2]:= "Nao"
   janela(nlinha, ncoluna, tela11i, ncoluna + 50, ;
      "Inclusao de Feriados")
   @ nlinha + 1, ncoluna + 2 say "Data"
   @ nlinha + 1, ncoluna + 12 say "Descrio"
   @ nlinha + 2, ncoluna + 2 get dData
   @ nlinha + 2, ncoluna + 12 get cDesc picture "@!"
   clear gets
   do while (lcontrole)
      @ nlinha + 2, ncoluna + 2 get dData valid qsrfra(valfr)
      @ nlinha + 2, ncoluna + 12 get cDesc picture "@!"
      read
      if (sai())
         loop
      endif
      if (!conflinha("Confirma Inclusao ?", tela11i, ncoluna + 1))
         loop
      endif
      if (!abredbf("Feriado", "Feriado1.NTX"))
         loop
      endif
      if (!adiciona())
         loop
      endif
      if (!bloqueia())
         loop
      endif
      replace data with valfr
      replace descricao with cdesc
      close
      valfr:= CToD("")
      cdesc:= Space(20)
   enddo
   RestScreen(0, 0, 24, 79, ctela)
   set color to (ccor)
   return

********************************
function VALFRA

   private v1[2], v2[2], v3[2]
   if (!abredbf("Feriado", "Feriado1.NTX"))
      return .F.
   endif
   seek valfr
   if (!Found())
      alert("Data Nao Cadastrada")
      close
      return .F.
   else
      close
      return .T.
   endif

********************************
procedure QSRFRA

   private ncodigo, cdesc
   private nlinha, ncoluna, lcontrole, ctela, ccor, vet[2]
   cpesquisa:= {"FERIADO", "FERIADO1", "DATA", "dData"}
   ccampos:= {"DATA", "DESCRICAO", "", "DATA", "DESCRICAO", ""}
   programa(0, 69, coropcoes)
   valfr:= CToD("")
   cdesc:= Space(20)
   nlinha:= 10
   tela11i:= nlinha + 4
   ncoluna:= 9
   lcontrole:= .T.
   ctela:= SaveScreen(0, 0, 24, 79)
   ccor:= SetColor()
   vet[1]:= "Sim"
   vet[2]:= "Nao"
   janela(nlinha, ncoluna, tela11i, ncoluna + 50, ;
      "Manutencao de Feriados")
   @ nlinha + 1, ncoluna + 2 say "Data"
   @ nlinha + 1, ncoluna + 12 say "Descrio"
   @ nlinha + 2, ncoluna + 2 get dData
   @ nlinha + 2, ncoluna + 12 get cDesc picture "@!"
   clear gets
   do while (lcontrole)
      @ nlinha + 2, ncoluna + 2 get dData picture "99999" valid ;
         qsr144i(valfr)
      read
      if (sai())
         loop
      endif
      if (!abredbf("FERIADO", "FERIADO1.NTX"))
         loop
      endif
      seek valfr
      if (Found())
         cdesc:= descricao
      endif
      close
      @ nlinha + 2, ncoluna + 12 get cDesc picture "@!"
      dbunlockal:= escolhelin({"Altera", "Exclui"}, 2, tela11i, ;
         ncoluna + 1)
      if (dbunlockal == 2)
         clear gets
      else
         read
      endif
      if (sai())
         loop
      endif
      if (!conflinha("Confirma Manutencao ?", tela11i, ncoluna + 1))
         loop
      endif
      if (!abredbf("Feriado", "Feriado1.NTX"))
         loop
      endif
      seek valfr
      if (!bloqueia())
         loop
      endif
      if (dbunlockal == 2)
         delete
      else
         replace data with valfr
         replace descricao with cdesc
      endif
      close
      ncodigo:= CToD("")
      cdesc:= Space(30)
   enddo
   RestScreen(0, 0, 24, 79, ctela)
   set color to (ccor)
   return

********************************
procedure QSR144I

   private ncodigo, cdesc
   private nlinha, ncoluna, lcontrole, ctela, ccor, vet[2]
   programa(0, 69, coropcoes)
   ncodigo:= 0
   cdesc:= Space(20)
   nlinha:= 10
   tela11i:= nlinha + 4
   ncoluna:= 9
   lcontrole:= .T.
   ctela:= SaveScreen(0, 0, 24, 79)
   ccor:= SetColor()
   vet[1]:= "Sim"
   vet[2]:= "Nao"
   janela(nlinha, ncoluna, tela11i, ncoluna + 50, ;
      "Inclusao de Locais de Estoque")
   @ nlinha + 1, ncoluna + 2 say "Codigo"
   @ nlinha + 1, ncoluna + 12 say "Descrio"
   @ nlinha + 2, ncoluna + 2 get nCodigo picture "999"
   @ nlinha + 2, ncoluna + 12 get cDesc picture "@!"
   clear gets
   do while (lcontrole)
      ncodigo:= qsr144a()
      @ nlinha + 2, ncoluna + 2 get nCodigo picture "999" when .F.
      @ nlinha + 2, ncoluna + 12 get cDesc picture "@!"
      read
      if (sai())
         loop
      endif
      if (!conflinha("Confirma Inclusao ?", tela11i, ncoluna + 1))
         loop
      endif
      if (!abredbf("LocEst", "LocEst1.NTX"))
         loop
      endif
      if (!adiciona())
         loop
      endif
      if (!bloqueia())
         loop
      endif
      replace codigo with ncodigo
      replace descricao with cdesc
      close
      ncodigo:= 0
      cdesc:= Space(30)
   enddo
   RestScreen(0, 0, 24, 79, ctela)
   set color to (ccor)
   return

********************************
function SEFERIADO(Arg1)

   select 10
   if (!abredbf("FERIADO", "FERIADO1.NTX"))
      return .F.
   endif
   seek Arg1
   if (Found())
      close
      return .T.
   else
      close
      return .F.
   endif

********************************
procedure QSR144A

   private ncodigo, cdesc
   private nlinha, ncoluna, lcontrole, ctela, ccor, vet[2]
   cpesquisa:= {"LOCEST", "LOCEST1", "CODIGO", "nCodigo"}
   ccampos:= {"CODIGO", "DESCRICAO", "", "CODIGO", "DESCRICAO", ""}
   programa(0, 69, coropcoes)
   ncodigo:= 0
   cdesc:= Space(20)
   nlinha:= 10
   tela11i:= nlinha + 4
   ncoluna:= 9
   lcontrole:= .T.
   ctela:= SaveScreen(0, 0, 24, 79)
   ccor:= SetColor()
   vet[1]:= "Sim"
   vet[2]:= "Nao"
   janela(nlinha, ncoluna, tela11i, ncoluna + 50, ;
      "Manutencao de Localizacoes")
   @ nlinha + 1, ncoluna + 2 say "Codigo"
   @ nlinha + 1, ncoluna + 12 say "Descrio"
   @ nlinha + 2, ncoluna + 2 get nCodigo picture "999"
   @ nlinha + 2, ncoluna + 12 get cDesc picture "@!"
   clear gets
   do while (lcontrole)
      @ nlinha + 2, ncoluna + 2 get nCodigo picture "999" valid ;
         qsr21i(ncodigo)
      read
      if (sai())
         loop
      endif
      if (!abredbf("LOCEST", "LOCEST1.NTX"))
         loop
      endif
      seek ncodigo
      if (Found())
         ncodigo:= codigo
         cdesc:= descricao
      endif
      close
      @ nlinha + 2, ncoluna + 12 get cDesc picture "@!"
      dbunlockal:= escolhelin({"Altera", "Exclui"}, 2, tela11i, ;
         ncoluna + 1)
      if (dbunlockal == 2)
         clear gets
      else
         read
      endif
      if (sai())
         loop
      endif
      if (!conflinha("Confirma Manutencao ?", tela11i, ncoluna + 1))
         loop
      endif
      if (!abredbf("LocEst", "LocEst1.NTX"))
         loop
      endif
      seek ncodigo
      if (!bloqueia())
         loop
      endif
      if (dbunlockal == 2)
         delete
      else
         replace codigo with ncodigo
         replace descricao with cdesc
      endif
      close
      ncodigo:= 0
      cdesc:= Space(20)
   enddo
   RestScreen(0, 0, 24, 79, ctela)
   set color to (ccor)
   return

********************************
function TELA21

   @ nlinha + 1, ncoluna + 2 say "N§ Conta"
   @ nlinha + 1, ncoluna + 19 say "Nome do Banco"
   @ nlinha + 3, ncoluna + 2 say "N§ Documento"
   @ nlinha + 3, ncoluna + 19 say "Data"
   @ nlinha + 5, ncoluna + 2 say "Valor"
   @ nlinha + 5, ncoluna + 19 say "Deb/Cred"
   @ nlinha + 7, ncoluna + 2 say "Hist¢rico"
   @ nlinha + 9, ncoluna + 2 say "Saldo"
   @ nlinha + 9, ncoluna + 20 say "Saldo Confirmado"
   @ nlinha + 2, ncoluna + 2 get nConta picture "99999999999999" ;
      valid pesqconta()
   @ nlinha + 4, ncoluna + 2 get cNumDoc picture "@!" valid ;
      pesqdoc7(Str(nconta, 14) + ddtvenc, ddtvenc)
   @ nlinha + 4, ncoluna + 19 get dData valid valdataemi(valfr)
   @ nlinha + 6, ncoluna + 2 get nValor picture "@E 999,999,999.99" ;
      valid cdebcred != 0
   @ nlinha + 6, ncoluna + 19 get cDebCred picture "@!" valid ;
      chistorico $ "DC"
   @ nlinha + 8, ncoluna + 2 get cHistorico picture "@!"
   return .T.

********************************
function LOCAL23I

   if (tela23 != 0)
      select 10
      if (!abredbf("LOCALIZA", "LOCALIZ1.NTX"))
         return .F.
      endif
      seek tela23
      if (Found())
         @ nlinha + 7, ncoluna + 20 say SubStr(descricao, 1, 22) ;
            color "w+/b"
      endif
      close
   endif
   return .T.

********************************
procedure QSR21I

   private nconta, ddtvenc, valfr, cdebcred, chistorico, tela21
   private nlinha, ncoluna, vet[2], nresp, ccor, ncont, ctela, ;
      lcontrole
   cpesquisa:= {"BANCOS", "BANCOS1", "CONTA_BC", "nConta"}
   ccampos:= {"CONTA_BC", "NOM_BAN_BC", "", "CONTA", ;
      "NOME DA CONTA", ""}
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   nconta:= 0
   ddtvenc:= Space(10)
   valfr:= Date()
   cdebcred:= 0
   chistorico:= "C"
   tela21:= Space(30)
   vet[1]:= "Sim"
   vet[2]:= "No"
   lcontrole:= .T.
   nlinha:= 4
   tela11i:= nlinha + 11
   ncoluna:= 17
   ctela:= SaveScreen(0, 0, 24, 79)
   janela(nlinha, ncoluna, tela11i, ncoluna + 43, ;
      "Inclusao de Mov.Contas Correntes")
   do while (lcontrole)
      qsr21a()
      read
      if (sai())
         loop
      endif
      if (!conflinha("Confirma Inclusao ?", tela11i, ncoluna + 1))
         loop
      endif
      if (!abredbf("MOV_BCO"))
         loop
      endif
      set index to Mv_Bco1, Mv_Bco2, Mv_Bco3
      if (!adiciona())
         loop
      endif
      if (!bloqueia())
         loop
      endif
      replace conta_mb with nconta
      replace docto_mb with ddtvenc
      replace data_mb with valfr
      replace histor_mb with tela21
      replace valor_mb with cdebcred
      replace debcred_mb with chistorico
      unlock
      abredbf("BANCOS", "BANCOS1.NTX")
      select Bancos
      seek nconta
      if (!Found())
         alert("Erro na leitura de registro! Operao ser  cancelada.")
         select MOV_BCO
         delete
         close
         lcontrole:= .F.
      endif
      if (!bloqueia())
         loop
      endif
      if (chistorico = "C")
         replace saldo_bc with saldo_bc + cdebcred
      else
         replace saldo_bc with saldo_bc - cdebcred
      endif
      close databases
      select 1
      close format
      ddtvenc:= Space(10)
      valfr:= Date()
      cdebcred:= 0
      chistorico:= "C"
      tela21:= Space(30)
   enddo
   RestScreen(0, 0, 24, 79, ctela)
   set color to (ccor)
   return

********************************
procedure TELA22

   @ nlinha + 1, ncoluna + 2 say "Codigo"
   @ nlinha + 1, ncoluna + 19 say "Nome do Funcionario"
   @ nlinha + 3, ncoluna + 2 say "N§ Documento"
   @ nlinha + 3, ncoluna + 19 say "Data"
   @ nlinha + 5, ncoluna + 2 say "Valor"
   @ nlinha + 5, ncoluna + 19 say "Deb/Cred"
   @ nlinha + 7, ncoluna + 2 say "Hist¢rico"
   @ nlinha + 9, ncoluna + 2 say "Saldo"
   @ nlinha + 9, ncoluna + 20 say "Saldo Confirmado"
   @ nlinha + 2, ncoluna + 2 get nCodigo picture "99999" valid ;
      pesqfun22(ncodigo)
   @ nlinha + 4, ncoluna + 2 get cNumDoc picture "@!" valid ;
      pesqdoc22(Str(ncodigo, 5) + ddtvenc, ddtvenc)
   @ nlinha + 4, ncoluna + 19 get dData valid valdataemi(valfr)
   @ nlinha + 6, ncoluna + 2 get nValor picture "@E 999,999,999.99" ;
      valid cdebcred != 0
   @ nlinha + 6, ncoluna + 19 get cDebCred picture "@!" valid ;
      chistorico $ "DC"
   @ nlinha + 8, ncoluna + 2 get cHistorico picture "@!"

********************************
function VALNNOPED(Arg1, Arg2)

   if (!abredbf("PEDIDOS", "PEDIDOS1.NTX"))
      return .F.
   endif
   if (Arg2 == 0)
      return .F.
   endif
   seek Arg1
   if (Found())
      alert(" Pedido ja Cadastrado ")
      close
      return .F.
   else
      close
      return .T.
   endif
   return .F.

********************************
procedure QSR21A

   private nconta, ddtvenc, valfr, cdebcred, cconfirma, chistorico, ;
      tela21
   private nlinha, ncoluna, vet[2], nresp, ccor, ncont, ctela, ;
      ctesta, nsalant
   private nsalconant, bancos
   cpesquisa:= {"BANCOS", "BANCOS1", "CONTA_BC", "nConta"}
   ccampos:= {"CONTA_BC", "NOM_BAN_BC", "", "CONTA", ;
      "NOME DA CONTA", ""}
   programa(0, 69, coropcoes)
   nlinha:= 4
   tela11i:= nlinha + 11
   ncoluna:= 17
   ccor:= SetColor()
   nconta:= 0
   ddtvenc:= Space(10)
   valfr:= Date()
   cdebcred:= 0
   cconfirma:= 0
   chistorico:= "C"
   ctesta:= ""
   tela21:= Space(30)
   vet[1]:= "Sim"
   vet[2]:= "No"
   lcontrole:= .T.
   ctela:= SaveScreen(0, 0, 24, 79)
   nsalconant:= 0
   bancos:= 0
   janela(nlinha, ncoluna, tela11i, ncoluna + 43, ;
      "Manutencao de Mov.Contas Correntes")
   do while (lcontrole)
      qsr21a()
      clear gets
      @ nlinha + 2, ncoluna + 2 get nConta picture "99999999999999" ;
         valid pesqconta(nconta)
      @ nlinha + 4, ncoluna + 2 get cNumDoc picture "@!" valid ;
         pesqdoc8(Str(nconta, 14) + ddtvenc, ddtvenc)
      read
      if (sai())
         loop
      endif
      if (!abredbf("MOV_BCO", "MV_BCO1.NTX"))
         loop
      endif
      seek Str(nconta, 14) + ddtvenc
      if (!Found())
         alert("Registro no encontrado!")
         close
         loop
      else
         valfr:= data_mb
         tela21:= histor_mb
         cdebcred:= valor_mb
         cconfirma:= valor_mb
         chistorico:= debcred_mb
         nsalant:= debcred_mb
         ctesta:= confir_mb
      endif
      close
      @ nlinha + 4, ncoluna + 19 get dData
      @ nlinha + 6, ncoluna + 2 get nValor picture "@E 999,999,999.99"
      @ nlinha + 6, ncoluna + 19 get cDebCred picture "@!"
      @ nlinha + 8, ncoluna + 2 get cHistorico picture "@!"
      dbunlockal:= escolhelin({"Altera", "Exclui"}, 2, tela11i, ;
         ncoluna + 1)
      if (dbunlockal == 2)
         clear gets
      else
         read
      endif
      if (sai())
         loop
      endif
      if (!conflinha("Confirma Alteracao?", tela11i, ncoluna + 1))
         loop
      endif
      if (!abredbf("Bancos", "Bancos1.NTX"))
         loop
      endif
      seek nconta
      if (!Found())
         alert("ATENO!;Erro na leitura de registro!; Operao ser  cancelada.")
         close databases
         select 1
         close format
         lcontrole:= .F.
         loop
      else
         nsalconant:= saldo_bc
         bancos:= sa_conf_bc
      endif
      if (!bloqueia())
         loop
      endif
      if (ctesta = "S")
         if (nsalant == "D")
            replace sa_conf_bc with sa_conf_bc + cconfirma
         elseif (nsalant == "C")
            replace sa_conf_bc with sa_conf_bc - cconfirma
         endif
         if (chistorico == "D")
            replace sa_conf_bc with sa_conf_bc - cdebcred
         elseif (chistorico == "C")
            replace sa_conf_bc with sa_conf_bc + cdebcred
         endif
         if (nsalant == "D")
            replace saldo_bc with saldo_bc + cconfirma
         elseif (nsalant == "C")
            replace saldo_bc with saldo_bc - cconfirma
         endif
         if (chistorico == "D")
            replace saldo_bc with saldo_bc - cdebcred
         elseif (chistorico == "C")
            replace saldo_bc with saldo_bc + cdebcred
         endif
      else
         if (nsalant == "D")
            replace saldo_bc with saldo_bc + cconfirma
         elseif (nsalant == "C")
            replace saldo_bc with saldo_bc - cconfirma
         endif
         if (chistorico == "D")
            replace saldo_bc with saldo_bc - cdebcred
         elseif (chistorico == "C")
            replace saldo_bc with saldo_bc + cdebcred
         endif
      endif
      select 2
      if (!abredbf("MOV_BCO"))
         replace qsr21c->saldo_bc with nsalconant
         replace qsr21c->sa_conf_bc with bancos
         loop
      endif
      set index to Mv_Bco1, Mv_Bco2, Mv_Bco3
      seek Str(nconta, 14) + ddtvenc
      if (!Found())
         alert("Erro na leitura de registro! Operao ser  cancelada.")
         replace qsr21c->saldo_bc with nsalconant
         replace qsr21c->sa_conf_bc with bancos
         close databases
         select 1
         close format
         lcontrole:= .F.
         loop
      endif
      if (!bloqueia())
         replace qsr21c->saldo_bc with nsalconant
         replace qsr21c->saldo_bc with bancos
         loop
      endif
      if (dbunlockal == 2)
         select Bancos
         seek nconta
         do case
         case !Found()
            alert("Erro na leitura de registro! Operao ser  cancelada.")
            close databases
            select 1
            close format
            lcontrole:= .F.
         case ctesta = "S"
            if (chistorico == "C")
               replace sa_conf_bc with sa_conf_bc - cdebcred
            elseif (chistorico == "D")
               replace sa_conf_bc with sa_conf_bc + cdebcred
            endif
            if (chistorico == "C")
               replace saldo_bc with saldo_bc - cdebcred
            elseif (chistorico == "D")
               replace saldo_bc with saldo_bc + cdebcred
            endif
         case chistorico == "C"
            replace saldo_bc with saldo_bc - cdebcred
         case chistorico == "D"
            replace saldo_bc with saldo_bc + cdebcred
         endcase
         if (!lcontrole)
            loop
         endif
         select Mov_Bco
      endif
      if (dbunlockal == 2)
         delete
      else
         replace data_mb with valfr
         replace histor_mb with tela21
         replace valor_mb with cdebcred
         replace debcred_mb with chistorico
      endif
      close databases
      select 1
      close format
      ddtvenc:= Space(10)
      valfr:= Date()
      cdebcred:= 0
      cconfirma:= 0
      chistorico:= "C"
      tela21:= Space(30)
   enddo
   RestScreen(0, 0, 24, 79, ctela)
   set color to (ccor)
   return

********************************
function PESQ23I

   if (Upper(readvar()) = "NCODCLI")
      cpesquisa:= {"CLIENTES", "CLIENTE2", "CODIGO_CLI", "nCodCli"}
      ccampos:= {"CODIGO_CLI", "NOME_CLI", "", "CODIGO", "NOME", ""}
   elseif (Upper(readvar()) = "NLOCALIZA")
      cpesquisa:= {"LOCALIZA", "LOCALIZ1", "CODIGO_LOC", "nLocaliza"}
      ccampos:= {"CODIGO_LOC", "DESCRICAO", "", "CODIGO", ;
         "DESCRICAO", ""}
   endif
   pesquisa()
   return .T.

********************************
procedure INICIAVAR

   i:= 1
   do while (i <= 3)
      cmatextras[i][1]:= Space(5)
      cmatextras[i][2]:= Space(5)
      i++
   enddo
   return

********************************
function QSR21C

   private nlinha, ncoluna, ctela, ccor, lcontrole, v1[6], v2[6], ;
      v3[6], ddtinicio[6]
   private vet[2]
   cpesquisa:= {"BANCOS", "BANCOS1", "CONTA_BC", "nConta"}
   ccampos:= {"CONTA_BC", "NOM_BAN_BC", "", "CONTA", ;
      "NOME DA CONTA", ""}
   programa(0, 69, coropcoes)
   nlinha:= 11
   tela11i:= nlinha + 6
   ncoluna:= 19
   ctela:= SaveScreen(0, 0, 24, 79)
   lcontrole:= .T.
   nconta:= 0
   ddtfim:= CToD("  /  /  ")
   dbclearrel:= CToD("  /  /  ")
   vet[1]:= "Sim"
   vet[2]:= "Nao"
   janela(nlinha, ncoluna, tela11i, ncoluna + 43, ;
      "Confirmacao Do Movimento Banc rio")
   nlinha++
   @ nlinha, ncoluna + 2 say "Conta"
   @ nlinha + 2, ncoluna + 2 say "Data Inicial"
   @ nlinha + 2, ncoluna + 19 say "Data Final  "
   do while (lcontrole)
      @ nlinha + 1, ncoluna + 2 get nConta picture "99999999999999" ;
         valid nconta > 0
      @ nlinha + 3, ncoluna + 2 get dDtInicio
      @ nlinha + 3, ncoluna + 19 get dDtFim
      read
      if (sai())
         loop
      endif
      if (Empty(ddtfim))
         ddtfim:= CToD("01/01/91")
      endif
      if (Empty(dbclearrel))
         dbclearrel:= CToD("31/12/10")
      endif
      if (!abredbf("MOV_BCO"))
         loop
      endif
      set index to MV_BCO2, MV_BCO3
      set filter to Data_MB >= dDtInicio .AND. Data_MB <= dDtFim ;
         .AND. Conta_MB == nConta
      select 2
      if (!abredbf("Bancos", "Bancos1.NTX"))
         loop
      endif
      select 1
      if (.T.)
         dbSetRelation()
      endif
      confmovbc("BANCOS", {|| conta_mb}, "Conta_MB")
      v1:= {"Data_MB", "Histor_MB", "Docto_MB", "DebCred_MB", ;
         "Valor_MB", "Confir_MB"}
      v2:= {"99999", "@!", "", "", "9.999.999,99", ""}
      v3:= {"Data", "Hist¢rico", "Docto", "DebCred", "Valor", "Conf"}
      ddtinicio:= {1, 1, 1, 1, 1, 1}
      ccoluna:= "Confirmacao do Movimento Bancario"
      consulta("Mov_Bco", 4, 0, 21, 79, v1, v2, v3, ddtinicio, ;
         "PesConMB", ccoluna, Nil, "ConfMovBc")
      close databases
      select 1
      close format
      set color to (corfordado)
      nconta:= 0
      ddtfim:= CToD("  /  /  ")
      dbclearrel:= CToD("  /  /  ")
   enddo
   set color to (ccor)
   RestScreen(0, 0, 24, 79, ctela)
   return Nil

********************************
function PESCONAR

   private ncodcli, ddtvenc, nnumped, pesq23i, nvalortit, pagamento, ;
      nloja
   private cnumdoc, ddataultc, nlinha, ncoluna, ntecla, lcontrole, ;
      ccor, ncont
   private tela23
   ccor:= SetColor()
   nlinha:= 5
   ncoluna:= 19
   ccor:= SetColor()
   ctel2:= SaveScreen(0, 0, 24, 79)
   ntecla:= 0
   lcontrole:= .T.
   janela(nlinha, ncoluna, nlinha + 14, ncoluna + 43, ;
      "ZOOM de Titulo a Receber")
   nlinha++
   ncodcli:= contasar->cod_cli_ar
   ddtvenc:= contasar->num_doc_ar
   nnumped:= contasar->ctipo
   pesq23i:= contasar->dt_emis_ar
   nvalortit:= contasar->obs_ar
   pagamento:= contasar->dt_venc_ar
   cnumdoc:= contasar->val_tit_ar
   ddataultc:= contasar->localiza
   tela23:= contasar->local23i
   nloja:= contasar->loja
   cnomcli:= SubStr(clientes->nome_cli, 1, 22)
   num_ped_ar()
   @ nlinha + 1, ncoluna + 20 say cnomcli
   clear gets
   qsr23a(tela23)
   do while (lcontrole)
      ntecla:= InKey(0)
      if (ntecla == 27)
         lcontrole:= .F.
      endif
   enddo
   select ContasAr
   set color to (ccor)
   RestScreen(0, 0, 24, 79, ctel2)
   return Nil

********************************
function PESCONMB

   local Local1, Local2, Local3, Local4, Local5, Local6, Local7, ;
      Local8, Local9, Local10, Local11, Local12, Local13, Local14, ;
      Local15, Local16, Local17
   Local17:= Select()
   Local2:= Space(10)
   Local1:= 0
   Local3:= Space(8)
   Local4:= 0
   Local5:= CToD("  /  /  ")
   Local6:= CToD("  /  /  ")
   Local13:= Date()
   Local7:= 0
   Local14:= 0
   Local8:= Space(40)
   Local9:= 4
   tela11i:= Local9 + 11
   Local10:= 19
   Local11:= SetColor()
   Local16:= SaveScreen(0, 0, 24, 79)
   ntecla:= 0
   lcontrole:= .T.
   janela(Local9, Local10, tela11i, Local10 + 43, ;
      "Consulta de Movimento Banc rio")
   nconta:= conta_mb
   Local2:= docto_mb
   valfr:= data_mb
   cdebcred:= valor_mb
   chistorico:= debcred_mb
   tela21:= histor_mb
   nsaldo:= SubStr(qsr21c->nom_ban_bc, 1, 22)
   nsaldocon:= qsr21c->saldo_bc
   qsr22i:= qsr21c->sa_conf_bc
   @ Local9 + 1, Local10 + 2 say "N§ Conta"
   @ Local9 + 1, Local10 + 19 say "Nome do Banco"
   @ Local9 + 3, Local10 + 2 say "N§ Documento"
   @ Local9 + 3, Local10 + 19 say "Data"
   @ Local9 + 5, Local10 + 2 say "Valor"
   @ Local9 + 5, Local10 + 19 say "Deb/Cred"
   @ Local9 + 7, Local10 + 2 say "Hist¢rico"
   @ Local9 + 9, Local10 + 2 say "Saldo"
   @ Local9 + 9, Local10 + 20 say "Saldo Confirmado"
   @ Local9 + 2, Local10 + 2 get nConta picture "99999999999999" ;
      valid pesqconta()
   @ Local9 + 4, Local10 + 2 get cNumDoc picture "@!" valid ;
      pesqdoc7(Str(nconta, 14) + Local2, Local2)
   @ Local9 + 4, Local10 + 19 get dData valid valdataemi(valfr)
   @ Local9 + 6, Local10 + 2 get nValor picture "@E 999,999,999.99" ;
      valid cdebcred != 0
   @ Local9 + 6, Local10 + 19 get cDebCred picture "@!" valid ;
      chistorico $ "DC"
   @ Local9 + 8, Local10 + 2 get cHistorico picture "@!"
   @ Local9 + 10, Local10 + 2 say qsr21c->saldo_bc
   @ Local9 + 10, Local10 + 20 say qsr21c->sa_conf_bc
   clear gets
   do while (lcontrole)
      ntecla:= InKey(0)
      if (ntecla == 27)
         lcontrole:= .F.
      endif
   enddo
   lcontrole:= .T.
   set color to (Local11)
   RestScreen(0, 0, 24, 79, Local16)
   select (Local17)
   return Nil

********************************
procedure CRIAARQ271

   private carquivo[15, 4]
   ncont:= 1
   dbcreate:= "TEMP" + LTrim(Str(ncont)) + ".DBF"
   do while (file(dbcreate))
      ncont++
      dbcreate:= "TEMP" + LTrim(Str(ncont)) + ".DBF"
   enddo
   carquivo[1]:= {"PROD", "C", 5, 0}
   carquivo[2]:= {"DESC", "C", 35, 0}
   carquivo[3]:= {"ESTO", "N", 8, 2}
   carquivo[4]:= {"VEND", "N", 10, 2}
   carquivo[5]:= {"VEND2", "N", 10, 2}
   carquivo[6]:= {"ALIQ1", "N", 2, 0}
   carquivo[7]:= {"ALIQ2", "N", 2, 0}
   carquivo[8]:= {"ALIQ3", "N", 2, 0}
   carquivo[9]:= {"VL_CUST", "N", 12, 2}
   carquivo[10]:= {"MARCA", "C", 10, 0}
   carquivo[11]:= {"DES_ACRE", "N", 12, 2}
   carquivo[12]:= {"VL_ITEM", "N", 12, 2}
   carquivo[13]:= {"TAM", "C", 3, 0}
   carquivo[14]:= {"VL_DESC", "N", 10, 2}
   carquivo[15]:= {"DESC_ITEM", "N", 10, 2}
   cprod(dbcreate, carquivo)

********************************
procedure QSR22I

   private ncodigo, ddtvenc, valfr, cdebcred, chistorico, tela21
   private nlinha, ncoluna, vet[2], nresp, ccor, ncont, ctela, ;
      lcontrole
   cpesquisa:= {"FUNCIONA", "FUNCION2", "CODIGO_FUN", "nCodigo"}
   ccampos:= {"CODIGO_FUN", "NOME", "", "CODIGO", "NOME", ""}
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   ncodigo:= 0
   ddtvenc:= Space(10)
   valfr:= Date()
   cdebcred:= 0
   chistorico:= "C"
   tela21:= Space(30)
   vet[1]:= "Sim"
   vet[2]:= "No"
   lcontrole:= .T.
   nlinha:= 4
   tela11i:= nlinha + 11
   ncoluna:= 17
   ctela:= SaveScreen(0, 0, 24, 79)
   janela(nlinha, ncoluna, tela11i, ncoluna + 43, ;
      "Inclusao de Movimento Funcionarios")
   do while (lcontrole)
      docto()
      read
      if (sai())
         loop
      endif
      if (!conflinha("Confirma Inclusao ?", tela11i, ncoluna + 1))
         loop
      endif
      if (!abredbf("MOV_FUN"))
         loop
      endif
      set index to Mv_Fun1, Mv_Fun2, Mv_Fun3
      if (!adiciona())
         loop
      endif
      if (!bloqueia())
         loop
      endif
      replace codigo with ncodigo
      replace historico with ddtvenc
      replace qsr22a with tela21
      replace data with valfr
      replace valor with cdebcred
      replace debcred with chistorico
      close
      abredbf("FUNCIONA", "FUNCION1")
      seek ncodigo
      if (!Found())
         alert("Erro na leitura de registro! Operao ser  cancelada.")
         select MOV_Fun
         delete
         close databases
         select 1
         close format
         lcontrole:= .F.
      endif
      if (!bloqueia())
         loop
      endif
      if (chistorico = "C")
         replace saldo with saldo + cdebcred
      else
         replace saldo with saldo - cdebcred
      endif
      close databases
      select 1
      close format
      ddtvenc:= Space(10)
      valfr:= Date()
      cdebcred:= 0
      chistorico:= "C"
      tela21:= Space(30)
   enddo
   RestScreen(0, 0, 24, 79, ctela)
   set color to (ccor)
   return

********************************
procedure QSR23I

   private ncodcli, ddtvenc, nnumped, pesq23i, nvalortit, pagamento
   private cnumdoc, ddataultc, nlinha, ncoluna, vet[2], nresp, ccor, ;
      ncont, lcontrole
   private nloja
   set key K_F10 to nlocaliza
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   ddtvenc:= Space(10)
   ncodcli:= 0
   nnumped:= Space(2)
   pesq23i:= 0
   nvalortit:= CToD("  /  /  ")
   pagamento:= CToD("  /  /  ")
   cnumdoc:= 0
   ddataultc:= Space(40)
   nloja:= 1
   tela23:= 0
   vet[1]:= "Sim"
   vet[2]:= "No"
   nlinha:= 4
   tela11i:= nlinha + 14
   ncoluna:= 19
   ctela:= SaveScreen(0, 0, 24, 79)
   lcontrole:= .T.
   janela(nlinha, ncoluna, tela11i, ncoluna + 43, ;
      "Inclusao de Contas a Receber")
   nlinha++
   do while (lcontrole)
      num_ped_ar()
      read
      if (sai())
         loop
      endif
      if (!conflinha("Confirma Inclusao ?", tela11i, ncoluna + 1))
         loop
      endif
      if (!abredbf("CONTASAR"))
         loop
      endif
      set index to ContAR1, ContAR2, ContAR3, ContAR4
      if (!adiciona())
         loop
      endif
      if (!bloqueia())
         loop
      endif
      replace num_doc_ar with ddtvenc
      replace cod_cli_ar with ncodcli
      replace ctipo with nnumped
      replace dt_emis_ar with pesq23i
      replace obs_ar with nvalortit
      replace dt_venc_ar with pagamento
      replace val_tit_ar with cnumdoc
      replace localiza with ddataultc
      replace local23i with tela23
      replace loja with nloja
      close
      ddtvenc:= Space(10)
      ncodcli:= 0
      nnumped:= Space(2)
      pesq23i:= 0
      nvalortit:= CToD("  /  /  ")
      pagamento:= CToD("  /  /  ")
      cnumdoc:= 0
      nloja:= 0
      ddataultc:= Space(40)
   enddo
   RestScreen(0, 0, 24, 79, ctela)
   set color to (ccor)
   set key K_F10 to pesquisa
   return

********************************
procedure QSR22A

   private ncodigo, ddtvenc, valfr, cdebcred, cconfirma, chistorico, ;
      tela21
   private nlinha, ncoluna, vet[2], nresp, ccor, ncont, ctela, ;
      ctesta, nsalant
   private nsalconant, bancos
   programa(0, 69, coropcoes)
   nlinha:= 4
   tela11i:= nlinha + 11
   ncoluna:= 17
   ccor:= SetColor()
   ncodigo:= 0
   ddtvenc:= Space(10)
   valfr:= Date()
   cdebcred:= 0
   cconfirma:= 0
   chistorico:= "C"
   ctesta:= ""
   tela21:= Space(30)
   vet[1]:= "Sim"
   vet[2]:= "No"
   lcontrole:= .T.
   ctela:= SaveScreen(0, 0, 24, 79)
   nsalconant:= 0
   bancos:= 0
   janela(nlinha, ncoluna, tela11i, ncoluna + 43, ;
      "Manutencao de Movimento Funcionarios")
   set color to (corfordado)
   do while (lcontrole)
      docto()
      clear gets
      @ nlinha + 2, ncoluna + 2 get nCodigo picture "99999" valid ;
         pesqfun22(ncodigo)
      @ nlinha + 4, ncoluna + 2 get cNumDoc picture "@!" valid ;
         pesqdoc22a(Str(ncodigo, 5) + ddtvenc, ddtvenc)
      read
      if (sai())
         loop
      endif
      if (!abredbf("MOV_FUN", "MV_FUN1.NTX"))
         loop
      endif
      seek Str(ncodigo, 5) + ddtvenc
      if (!Found())
         alert("Registro no encontrado!")
         close
         loop
      else
         valfr:= data
         tela21:= qsr22a
         cdebcred:= valor
         cconfirma:= valor
         chistorico:= debcred
         nsalant:= debcred
         ctesta:= confirmado
      endif
      close
      @ nlinha + 4, ncoluna + 19 get dData
      @ nlinha + 6, ncoluna + 2 get nValor picture "@E 999,999,999.99"
      @ nlinha + 6, ncoluna + 19 get cDebCred picture "@!"
      @ nlinha + 8, ncoluna + 2 get cHistorico picture "@!"
      dbunlockal:= escolhelin({"Altera", "Exclui"}, 2, tela11i, ;
         ncoluna + 1)
      if (dbunlockal == 2)
         clear gets
      else
         read
      endif
      if (sai())
         loop
      endif
      if (!conflinha("Confirma Manutencao ?", tela11i, ncoluna + 1))
         loop
      endif
      if (!abredbf("FUNCIONA", "FUNCION1.NTX"))
         loop
      endif
      seek ncodigo
      if (!Found())
         alert("ATENO!;Erro na leitura de registro!; Operao ser  cancelada.")
         close databases
         select 1
         close format
         lcontrole:= .F.
         loop
      else
         nsalconant:= saldo
         bancos:= saldo_conf
      endif
      if (!bloqueia())
         loop
      endif
      if (dbunlockal == 2)
         if (chistorico == "D")
            replace saldo with saldo + cdebcred
         elseif (chistorico == "C")
            replace saldo with saldo - cdebcred
         endif
      else
         if (nsalant == "D")
            replace saldo with saldo + cconfirma
         elseif (nsalant == "C")
            replace saldo with saldo - cconfirma
         endif
         if (chistorico == "D")
            replace saldo with saldo - cdebcred
         elseif (chistorico == "C")
            replace saldo with saldo + cdebcred
         endif
      endif
      if (!abredbf("MOV_FUN"))
         replace qsr23i->saldo with nsalconant
         replace qsr23i->saldo_conf with bancos
         loop
      endif
      set index to Mv_Fun1, Mv_Fun2, Mv_Fun3
      seek Str(ncodigo, 5) + ddtvenc
      if (!Found())
         alert("Erro na leitura de registro! Operao ser  cancelada.")
         replace qsr23i->saldo with nsalconant
         replace qsr23i->saldo_conf with bancos
         close databases
         select 1
         close format
         lcontrole:= .F.
         loop
      endif
      if (!bloqueia())
         replace qsr23i->saldo with nsalconant
         replace qsr23i->saldo with bancos
         loop
      endif
      if (dbunlockal == 2)
         delete
      else
         replace data with valfr
         replace qsr22a with tela21
         replace valor with cdebcred
         replace debcred with chistorico
      endif
      close databases
      select 1
      close format
      ddtvenc:= Space(10)
      valfr:= Date()
      cdebcred:= 0
      cconfirma:= 0
      chistorico:= "C"
      tela21:= Space(30)
   enddo
   RestScreen(0, 0, 24, 79, ctela)
   set color to (ccor)
   return

********************************
function TELA24

   @ nlinha, ncoluna + 2 say "Cod. Fornecedor   Nome do Fornecedor"
   @ nlinha + 2, ncoluna + 2 say "N§ Documento"
   @ nlinha + 2, ncoluna + 20 say "Tipo Documento"
   @ nlinha + 4, ncoluna + 2 say "N§ Pedido"
   @ nlinha + 4, ncoluna + 20 say "Valor T¡tulo"
   @ nlinha + 6, ncoluna + 2 say "Valor ICMS"
   @ nlinha + 8, ncoluna + 2 say "Data Emisso"
   @ nlinha + 8, ncoluna + 20 say "Data Vencimento"
   @ nlinha + 10, ncoluna + 2 say "Observao"
   @ nlinha + 1, ncoluna + 2 get nCodFor picture "99999" valid ;
      pesqfor(nvlricms)
   @ nlinha + 3, ncoluna + 2 get cNumDoc picture "@!" valid ;
      pesqdoc1(ddtvenc + Str(nvlricms, 5), ddtvenc)
   @ nlinha + 3, ncoluna + 20 get cTipoDoc picture "!!"
   @ nlinha + 5, ncoluna + 2 get nNumPed picture "999999"
   @ nlinha + 5, ncoluna + 20 get nValorTit picture ;
      "@E 999,999,999.99" valid cnumdoc > 0
   @ nlinha + 7, ncoluna + 2 get nVlrIcms picture "@E 999,999,999.99"
   @ nlinha + 9, ncoluna + 2 get dDtEmissao valid ;
      valdataemi(nvalortit)
   @ nlinha + 9, ncoluna + 20 get dDtVenc valid ;
      valdataven(pagamento, nvalortit)
   @ nlinha + 11, ncoluna + 2 get cObs picture "@!"
   return .T.

********************************
procedure TELA23

   @ nlinha, ncoluna + 2 say "Cod. Cliente      Nome do Cliente"
   @ nlinha + 2, ncoluna + 2 say "N§ Documento"
   @ nlinha + 2, ncoluna + 20 say "Tipo Documento"
   @ nlinha + 4, ncoluna + 2 say "N§ Pedido"
   @ nlinha + 4, ncoluna + 20 say "Valor T¡tulo"
   @ nlinha + 6, ncoluna + 2 say "Localizacao"
   @ nlinha + 8, ncoluna + 2 say "Data Emisso"
   @ nlinha + 8, ncoluna + 20 say "Data Vencimento"
   @ nlinha + 10, ncoluna + 2 say "Observao"
   @ nlinha + 1, ncoluna + 2 get nCodCli picture "99999" valid ;
      pesqcli(ncodcli)
   if (procname(1) = "QSR23I")
      @ nlinha + 3, ncoluna + 2 get cNumDoc picture "@!" valid ;
         pesqdoc3(ddtvenc + Str(ncodcli, 5), ddtvenc)
   else
      @ nlinha + 3, ncoluna + 2 get cNumDoc picture "@!" valid ;
         pesqdoc4(ddtvenc + Str(ncodcli, 5), ddtvenc)
   endif
   @ nlinha + 3, ncoluna + 20 get cTipoDoc picture "@!"
   @ nlinha + 5, ncoluna + 2 get nNumPed picture "999999"
   @ nlinha + 5, ncoluna + 20 get nValorTit picture "999,999,999.99" ;
      valid cnumdoc > 0
   @ nlinha + 7, ncoluna + 2 get nLocaliza picture "99999" valid ;
      qsr23a(tela23)
   @ nlinha + 9, ncoluna + 2 get dDtEmissao valid ;
      valdataemi(nvalortit)
   @ nlinha + 9, ncoluna + 20 get dDtVenc valid ;
      valdataven(pagamento, nvalortit)
   @ nlinha + 11, ncoluna + 2 get cObs picture "@!"
   return

********************************
function GER3234(Arg1, Arg2)

   local Local1
   Local1:= .F.
   select 2
   if (!abredbf("ORCAMENT", "ORCAMEN3"))
      return .F.
   endif
   select 1
   use (dbcreate)
   select 2
   set softseek on
   seek Arg1
   set softseek off
   if (!EOF())
      do while (data >= Arg1 .AND. data <= Arg2)
         if (ncodigo != 0)
            if (cliente != ncodigo)
               skip 
               loop
            endif
         endif
         if (nvendo != 0)
            if (vendedor != nvendo)
               skip 
               loop
            endif
         endif
         ncliente:= cliente
         cnomecli:= nome_cli
         nnumero:= numero
         valfr:= data
         nvaltot:= valor_tot
         fonecomp:= vendedor
         nloja:= loja
         ddt_venc:= int_ext
         select 1
         if (!adiciona())
            return .F.
         endif
         replace cliente with ncliente
         replace nome_cli with cnomecli
         replace numero with nnumero
         replace data with valfr
         replace valor_tot with nvaltot
         replace vendedor with fonecomp
         select 2
         skip 
         nlinha++
      enddo
   endif
   select 2
   close
   return

********************************
procedure PESQ432

   if (Upper(readvar()) = "NCODIGO")
      cpesquisa:= {"CLIENTES", "CLIENTE2", "CODIGO_CLI", "nCodigo"}
      ccampos:= {"CODIGO_CLI", "NOME_CLI", "", "CODIGO", "NOME", ""}
   elseif (Upper(readvar()) = "NCODLOC")
      cpesquisa:= {"LOCALIZA", "LOCALIZ1", "CODIGO_LOC", "nCodLoc"}
      ccampos:= {"CODIGO_LOC", "DESCRICAO", "", "CODIGO", ;
         "DESCRICAO", ""}
   elseif (Upper(readvar()) = "NVENDO")
      cpesquisa:= {"FUNCIONA", "FUNCION2", "CODIGO_FUN", "nVendo"}
      ccampos:= {"CODIGO_FUN", "NOME", "", "CODIGO", "NOME", ""}
   endif
   pesquisa()
   return

********************************
function VALEMP

   ccaminho:= "C:\QUASAR\DADOS\" + ccgc
   return .T.

********************************
procedure QSR23A

   private ncodcli, ddtvenc, nnumped, pesq23i, nvalortit, pagamento
   private cnumdoc, ddataultc, nlinha, ncoluna, vet[2], nresp, ;
      ncont, ccor, ctela
   private nloja
   set key K_F10 to qsr23b
   programa(0, 69, coropcoes)
   nloja:= 0
   ddtvenc:= Space(10)
   ncodcli:= 0
   nnumped:= Space(2)
   pesq23i:= 0
   nvalortit:= CToD("  /  /  ")
   pagamento:= CToD("  /  /  ")
   cnumdoc:= 0
   ddataultc:= Space(40)
   vet[1]:= "Sim"
   vet[2]:= "No"
   tela23:= 0
   nlinha:= 4
   tela11i:= nlinha + 14
   ncoluna:= 19
   nloja:= 0
   ctela:= SaveScreen(0, 0, 24, 79)
   lcontrole:= .T.
   janela(nlinha, ncoluna, tela11i, ncoluna + 43, ;
      "Manutencao de Contas a Receber")
   set color to (corfordado)
   nlinha++
   do while (lcontrole)
      num_ped_ar()
      clear gets
      @ nlinha + 1, ncoluna + 2 get nCodCli picture "99999" valid ;
         pesqcli(ncodcli)
      @ nlinha + 3, ncoluna + 2 get cNumDoc picture "@!" valid ;
         pesqdoc4(ddtvenc + Str(ncodcli, 5), ddtvenc)
      read
      if (sai())
         loop
      endif
      if (!abredbf("CONTASAR", "CONTAR1.NTX"))
         loop
      endif
      seek ddtvenc + Str(ncodcli, 5)
      if (!Found())
         alert("Erro na Leitura de registro! Operao ser  cancelada.")
         close
         lcontrole:= .F.
      else
         ddtvenc:= num_doc_ar
         ncodcli:= cod_cli_ar
         nnumped:= ctipo
         pesq23i:= dt_emis_ar
         nvalortit:= obs_ar
         pagamento:= dt_venc_ar
         cnumdoc:= val_tit_ar
         ddataultc:= localiza
         nloja:= loja
         tela23:= local23i
      endif
      close databases
      select 1
      close format
      num_ped_ar()
      dbunlockal:= escolhelin({"Altera", "Exclui"}, 2, tela11i, ;
         ncoluna + 1)
      if (dbunlockal == 2)
         clear gets
      else
         read
      endif
      if (sai())
         loop
      endif
      if (!conflinha("Confirma Manutencao ?", tela11i, ncoluna + 1))
         loop
      endif
      if (!abredbf("CONTASAR"))
         loop
      endif
      set index to ContAR1, ContAR2, ContAR3, ContAR4
      seek ddtvenc + Str(ncodcli, 5)
      if (!Found())
         alert("Erro na abertura de arquivo operacao sera cancelada")
         lcontrole:= .F.
         close databases
         select 1
         close format
         loop
      endif
      if (!bloqueia())
         loop
      endif
      if (dbunlockal == 2)
         delete
      else
         replace num_doc_ar with ddtvenc
         replace cod_cli_ar with ncodcli
         replace ctipo with nnumped
         replace dt_emis_ar with pesq23i
         replace obs_ar with nvalortit
         replace dt_venc_ar with pagamento
         replace val_tit_ar with cnumdoc
         replace localiza with ddataultc
         replace loja with nloja
         replace local23i with tela23
      endif
      close
      ddtvenc:= Space(10)
      ncodcli:= 0
      nnumped:= Space(2)
      pesq23i:= 0
      nvalortit:= CToD("  /  /  ")
      pagamento:= CToD("  /  /  ")
      cnumdoc:= 0
      ddataultc:= Space(40)
      nloja:= 0
      tela23:= 0
   enddo
   set color to (ccor)
   RestScreen(0, 0, 24, 79, ctela)
   return

********************************
function PESQ23A

   if (Upper(readvar()) = "NCODCLI")
      cpesquisa:= {"CLIENTES", "CLIENTE2", "CODIGO_CLI", "nCodCli"}
      ccampos:= {"CODIGO_CLI", "NOME_CLI", "", "CODIGO", "NOME", ""}
   elseif (Upper(readvar()) = "NLOCALIZA")
      cpesquisa:= {"LOCALIZA", "LOCALIZ1", "CODIGO_LOC", "nLocaliza"}
      ccampos:= {"CODIGO_LOC", "DESCRICAO", "", "CODIGO", ;
         "DESCRICAO", ""}
   endif
   pesquisa()
   return .T.

********************************
function VEND432(Arg1)

   carea:= Select()
   use PEDIDOS new index PEDIDOS1
   seek Str(1, 2) + Str(Arg1, 5)
   if (Found())
      if (vendedor = nvendo)
         lret:= .T.
      else
         lret:= .F.
      endif
   else
      lret:= .F.
   endif
   close
   select (carea)
   return lret

********************************
procedure QSR23B

   private ncodcli, ddtvenc, nnumped, pesq23i, nvalortit, pagamento
   private cnumdoc, ddataultc, nlinha, ncoluna, vet[2], nresp, ccor, ;
      ncont
   private nvlrece, ncontadest, nloja
   set key K_F10 to qsr23b
   programa(0, 69, coropcoes)
   ddtvenc:= Space(10)
   ncodcli:= 0
   nnumped:= Space(8)
   pesq23i:= 0
   nvalortit:= CToD("  /  /  ")
   pagamento:= CToD("  /  /  ")
   nvlrece:= Date()
   cnumdoc:= 0
   ncontadest:= 0
   ddataultc:= Space(40)
   tela23:= 0
   vet[1]:= "Sim"
   vet[2]:= "No"
   nlinha:= 4
   ncoluna:= 19
   tela11i:= nlinha + 16
   ctela:= SaveScreen(0, 0, 24, 79)
   lcontrole:= .T.
   nloja:= 1
   dt_loc_ar:= 0
   janela(nlinha, ncoluna, tela11i, ncoluna + 43, ;
      "Baixa de Contas a Receber")
   nlinha++
   @ nlinha, ncoluna + 2 say "Cod. Cliente      Nome do Cliente"
   @ nlinha + 2, ncoluna + 2 say "N§ Documento"
   @ nlinha + 2, ncoluna + 20 say "Tipo Documento"
   @ nlinha + 4, ncoluna + 2 say "N§ Pedido"
   @ nlinha + 4, ncoluna + 20 say "Valor T¡tulo"
   @ nlinha + 6, ncoluna + 2 say "Localizacao"
   @ nlinha + 8, ncoluna + 2 say "Data Emisso"
   @ nlinha + 8, ncoluna + 20 say "Data Vencimento"
   @ nlinha + 10, ncoluna + 2 say "Data Recebimento"
   @ nlinha + 10, ncoluna + 20 say "Valor Recebido"
   @ nlinha + 12, ncoluna + 2 say "Observao"
   do while (lcontrole)
      @ nlinha + 1, ncoluna + 2 get nCodCli picture "99999"
      @ nlinha + 3, ncoluna + 2 get cNumDoc picture "@!"
      @ nlinha + 3, ncoluna + 20 get cTipoDoc picture "@!"
      @ nlinha + 5, ncoluna + 2 get nNumPed picture "999999"
      @ nlinha + 5, ncoluna + 20 get nValorTit picture ;
         "@E 999,999,999.99"
      @ nlinha + 7, ncoluna + 2 get nLocaliza picture "99999" valid ;
         qsr23a(tela23)
      @ nlinha + 9, ncoluna + 2 get dDtEmissao valid nvalortit != ;
         CToD("  /  /  ")
      @ nlinha + 9, ncoluna + 20 get dDtVenc valid pagamento != ;
         CToD("  /  /  ")
      @ nlinha + 11, ncoluna + 2 get dDtRece valid nvlrece != ;
         CToD("  /  /  ")
      @ nlinha + 11, ncoluna + 20 get nVlRece picture ;
         "@E 999,999,999.99" valid ncontadest > 0
      @ nlinha + 13, ncoluna + 2 get cObs picture "@!"
      clear gets
      @ nlinha + 1, ncoluna + 2 get nCodCli picture "99999" valid ;
         pesqcli(ncodcli)
      @ nlinha + 3, ncoluna + 2 get cNumDoc picture "@!" valid ;
         pesqdoc4(ddtvenc + Str(ncodcli), ddtvenc)
      read
      if (sai())
         loop
      endif
      if (!abredbf("CONTASAR", "CONTAR1.NTX"))
         loop
      endif
      seek ddtvenc + Str(ncodcli, 5)
      if (!Found())
         alert("Erro na Leitura de registro! Operao ser  cancelada.")
         close
         set color to (ccor)
         return
      else
         ddtvenc:= num_doc_ar
         ncodcli:= cod_cli_ar
         nnumped:= ctipo
         pesq23i:= dt_emis_ar
         nvalortit:= obs_ar
         pagamento:= dt_venc_ar
         cnumdoc:= val_tit_ar
         ddataultc:= localiza
         tela23:= local23i
         nloja:= loja
         num_ped_re:= ddtlocar
         ncomissao:= comissao
      endif
      close
      @ nlinha + 3, ncoluna + 20 get cTipoDoc picture "@!"
      @ nlinha + 5, ncoluna + 2 get nNumPed picture "999999"
      @ nlinha + 5, ncoluna + 20 get nValorTit picture ;
         "@E 999,999,999.99"
      @ nlinha + 9, ncoluna + 2 get dDtEmissao valid nvalortit != ;
         CToD("  /  /  ")
      @ nlinha + 9, ncoluna + 20 get dDtVenc valid pagamento != ;
         CToD("  /  /  ")
      @ nlinha + 11, ncoluna + 2 get dDtRece valid nvlrece != ;
         CToD("  /  /  ")
      @ nlinha + 11, ncoluna + 20 get nVlRece picture ;
         "@E 999,999,999.99" valid ncontadest > 0
      @ nlinha + 13, ncoluna + 2 get cObs picture "@!"
      clear gets
      @ nlinha + 7, ncoluna + 2 get nLocaliza picture "99999" valid ;
         qsr23a(tela23)
      @ nlinha + 11, ncoluna + 2 get dDtRece valid valdatapgt(nvlrece)
      @ nlinha + 11, ncoluna + 20 get nVlRece picture ;
         "@E 999,999,999.99" valid ncontadest > 0
      @ nlinha + 13, ncoluna + 2 get cObs picture "@!"
      read
      if (sai())
         loop
      endif
      if (!conflinha("Confirma Baixa ?", tela11i, ncoluna + 1))
         loop
      endif
      if (!abredbf("CONTASRE"))
         loop
      endif
      set index to CONTRE1, CONTRE2, CONTRE3, CONTRE4
      if (!adiciona())
         loop
      endif
      if (!bloqueia())
         loop
      endif
      replace num_doc_re with ddtvenc
      replace cod_cli_re with ncodcli
      replace dt_venc_re with nnumped
      replace dt_emis_re with pesq23i
      replace obs_re with nvalortit
      replace val_tit_re with pagamento
      replace dt_rece_re with nvlrece
      replace ddt_pgto with cnumdoc
      replace vl_rece_re with ncontadest
      replace dt_loc_re with ddataultc
      replace local23i with tela23
      replace loja with nloja
      replace conta_re with num_ped_re
      replace comissao with ncomissao
      replace qsr24i with dt_loc_ar
      unlock
      close
      if (!abredbf("CONTASAR"))
         loop
      endif
      set index to CONTAR1, CONTAR2
      seek ddtvenc + Str(ncodcli, 5)
      if (!Found())
         alert("Erro na excluso de registro! Operao ser  cancelada.")
         close databases
         select 1
         close format
         lcontrole:= .F.
         loop
      endif
      if (!bloqueia())
         loop
      endif
      delete
      close
      ddtvenc:= Space(10)
      ncodcli:= 0
      nnumped:= Space(8)
      pesq23i:= 0
      nvalortit:= CToD("  /  /  ")
      pagamento:= CToD("  /  /  ")
      nvlrece:= Date()
      cnumdoc:= 0
      ncontadest:= 0
      ddataultc:= Space(40)
      nloja:= 0
   enddo
   set color to (ccor)
   RestScreen(0, 0, 24, 79, ctela)
   return

********************************
function PESQ271

   if (Upper(readvar()) = "NCODCLI")
      cpesquisa:= {"CLIENTES", "CLIENTE2", "CODIGO_CLI", "nCodCli"}
      ccampos:= {"CODIGO_CLI", "NOME_CLI", "", "CODIGO", "NOME", ""}
   elseif (Upper(readvar()) = "NCODVEND")
      cpesquisa:= {"FUNCIONA", "FUNCION2", "CODIGO_FUN", "nCodVend"}
      ccampos:= {"CODIGO_FUN", "NOME", "", "CODIGO", "NOME", ""}
   endif
   pesquisa()
   return .T.

********************************
function CLI436

   if (!abredbf("CLIENTES", "CLIENTE1.NTX"))
      return .F.
   endif
   seek ncodigo
   if (!Found())
      alert("CLIENTE NAO CADASTRADO")
      close
      return .F.
   endif
   close
   return .T.

********************************
procedure QSR24I

   private nvlricms, ddtvenc, nnumped, pesq23i, nvalortit, ;
      pagamento, cdesp
   private cnumdoc, ddataultc, nlinha, ncoluna, vet[2], nresp, ccor, ;
      ncont, lcontrole
   private nloja
   cpesquisa:= {"FORNECED", "FORNECE2", "CODIGO_FOR", "nCodFor"}
   ccampos:= {"CODIGO_FOR", "NOME", "", "CODIGO", "NOME", ""}
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   ddtvenc:= Space(10)
   nvlricms:= 0
   nnumped:= Space(2)
   pesq23i:= 0
   nvalortit:= CToD("  /  /  ")
   pagamento:= CToD("  /  /  ")
   cnumdoc:= 0
   cdesp:= 0
   ddataultc:= Space(40)
   vet[1]:= "Sim"
   vet[2]:= "No"
   nlinha:= 4
   tela11i:= nlinha + 16
   ncoluna:= 19
   lcontrole:= .T.
   nloja:= 1
   ctela:= SaveScreen(0, 0, 24, 79)
   ncontaorig:= "N"
   tela24:= 0
   janela(nlinha, ncoluna, tela11i, ncoluna + 43, ;
      "Inclusao de Contas a Pagar")
   nlinha++
   do while (lcontrole)
      num_doc_pg()
      read
      if (sai())
         loop
      endif
      if (!conflinha("Confirma Inclusao ?", tela11i, ncoluna + 1))
         loop
      endif
      if (ncontaorig = "S")
         if (!abredbf("CONTASPG"))
            loop
         endif
         set index to ContPG1, ContPG2, ContPG3
      else
         if (!abredbf("CONTASAP"))
            loop
         endif
         set index to ContAP1, ContAP2, ContAP3
      endif
      if (!adiciona())
         loop
      endif
      if (!bloqueia())
         loop
      endif
      if (ncontaorig = "S")
         replace cod_for_pg with ddtvenc
         replace tip_doc_pg with nvlricms
         replace num_ped_pg with nnumped
         replace situaca_pg with pesq23i
         replace dt_emis_pg with "V"
         replace dt_venc_pg with nvalortit
         replace val_tit_pg with nvalortit
         replace dt_pgto_pg with nvalortit
         replace val_icm_pg with cnumdoc
         replace obs_pg with cdesp
         replace vl_pgto_pg with cnumdoc
         replace conta_pg with ddataultc
         replace loja with nloja
         replace num_doc_ap with tela24
         inclbco(tela24, ddtvenc, nvalortit, ddataultc, cnumdoc, "D")
      else
         replace cod_for_ap with ddtvenc
         replace tip_doc_ap with nvlricms
         replace num_ped_ap with nnumped
         replace dt_emis_ap with pesq23i
         replace val_icm_ap with nvalortit
         replace dt_venc_ap with pagamento
         replace val_tit_ap with cnumdoc
         replace obs_ap with cdesp
         replace qsr24a with ddataultc
         replace loja with nloja
      endif
      close
      ddtvenc:= Space(10)
      nvlricms:= 0
      nnumped:= Space(2)
      pesq23i:= 0
      nvalortit:= CToD("  /  /  ")
      pagamento:= CToD("  /  /  ")
      cnumdoc:= 0
      cdesp:= 0
      ddataultc:= Space(40)
      nloja:= 0
      tela24:= 0
   enddo
   set color to (ccor)
   RestScreen(0, 0, 24, 79, ctela)
   return

********************************
function TELA26

   @ nlinha, ncoluna + 2 say "Cod. Cliente      Nome do Cliente"
   @ nlinha + 2, ncoluna + 2 say "N§ Documento"
   @ nlinha + 2, ncoluna + 20 say "Tipo Documento"
   @ nlinha + 4, ncoluna + 2 say "N§ Pedido"
   @ nlinha + 4, ncoluna + 20 say "Valor T¡tulo"
   @ nlinha + 6, ncoluna + 2 say "Data Emisso"
   @ nlinha + 6, ncoluna + 20 say "Data Vencimento"
   @ nlinha + 8, ncoluna + 2 say "Observao"
   @ nlinha + 1, ncoluna + 2 get nCodCli picture "99999"
   @ nlinha + 3, ncoluna + 2 get cNumDoc picture "@!"
   @ nlinha + 3, ncoluna + 20 get cTipoDoc picture "@!"
   @ nlinha + 5, ncoluna + 2 get nNumPed picture "999999"
   @ nlinha + 5, ncoluna + 20 get nValorTit picture ;
      "@E 999,999,999.99"
   @ nlinha + 7, ncoluna + 2 get dDtEmissao
   @ nlinha + 7, ncoluna + 20 get dDtVenc
   @ nlinha + 9, ncoluna + 2 get cObs picture "@!"
   return .T.

********************************
procedure QSR24A

   private nvlricms, ddtvenc, nnumped, pesq23i, nvalortit, pagamento
   private cnumdoc, ddataultc, nlinha, ncoluna, vet[2], nresp, ;
      ncont, ccor, ctela
   private lcontrole, cdesp, nloja
   cpesquisa:= {"FORNECED", "FORNECE2", "CODIGO_FOR", "nCodFor"}
   ccampos:= {"CODIGO_FOR", "NOME", "", "CODIGO", "NOME", ""}
   programa(0, 69, coropcoes)
   ddtvenc:= Space(10)
   nvlricms:= 0
   nnumped:= Space(2)
   pesq23i:= 0
   nvalortit:= CToD("  /  /  ")
   pagamento:= CToD("  /  /  ")
   cnumdoc:= 0
   cdesp:= 0
   ddataultc:= Space(40)
   vet[1]:= "Sim"
   vet[2]:= "No"
   nlinha:= 4
   tela11i:= nlinha + 14
   ncoluna:= 19
   lcontrole:= .T.
   ctela:= SaveScreen(0, 0, 24, 79)
   janela(nlinha, ncoluna, tela11i, ncoluna + 43, ;
      "Manutencao de Contas a Pagar")
   nlinha++
   do while (lcontrole)
      num_doc_pg()
      clear gets
      @ nlinha + 1, ncoluna + 2 get nCodFor picture "99999" valid ;
         pesqfor(nvlricms)
      @ nlinha + 3, ncoluna + 2 get cNumDoc picture "@!" valid ;
         pesqdoc2(ddtvenc + Str(nvlricms, 5), ddtvenc)
      read
      if (sai())
         loop
      endif
      if (!abredbf("CONTASAP", "CONTAP1.NTX"))
         loop
      endif
      seek ddtvenc + Str(nvlricms, 5)
      if (!Found())
         alert("Erro na Leitura de registro! Operao ser  cancelada.")
         close
         set color to (ccor)
         return
      else
         ddtvenc:= cod_for_ap
         nvlricms:= tip_doc_ap
         nnumped:= num_ped_ap
         pesq23i:= dt_emis_ap
         nvalortit:= val_icm_ap
         pagamento:= dt_venc_ap
         cnumdoc:= val_tit_ap
         cdesp:= obs_ap
         ddataultc:= qsr24a
         nloja:= loja
      endif
      close
      @ nlinha + 3, ncoluna + 20 get cTipoDoc picture "@!"
      @ nlinha + 5, ncoluna + 2 get nNumPed picture "999999"
      @ nlinha + 5, ncoluna + 20 get nValorTit picture ;
         "@E 999,999,999.99" valid cnumdoc > 0
      @ nlinha + 7, ncoluna + 2 get nVlrIcms picture ;
         "@E 999,999,999.99"
      @ nlinha + 9, ncoluna + 2 get dDtEmissao valid ;
         valdataemi(nvalortit)
      @ nlinha + 9, ncoluna + 20 get dDtVenc valid ;
         valdataven(pagamento, nvalortit)
      @ nlinha + 11, ncoluna + 2 get cObs picture "@!"
      dbunlockal:= escolhelin({"Altera", "Exclui"}, 2, tela11i, ;
         ncoluna + 1)
      if (dbunlockal == 2)
         clear gets
      else
         read
      endif
      if (sai())
         loop
      endif
      if (!conflinha("Confirma Manutencao ?", tela11i, ncoluna + 1))
         loop
      endif
      if (!abredbf("CONTASAP"))
         loop
      endif
      set index to ContAP1, ContAP2, ContAP3
      seek ddtvenc + Str(nvlricms, 5)
      if (!Found())
         alert("Erro na Leitura de registro! Operao ser  cancelada.")
         close
         lcontrole:= .F.
      endif
      if (!bloqueia())
         loop
      endif
      if (dbunlockal == 2)
         delete
      else
         replace cod_for_ap with ddtvenc
         replace tip_doc_ap with nvlricms
         replace num_ped_ap with nnumped
         replace dt_emis_ap with pesq23i
         replace val_icm_ap with nvalortit
         replace dt_venc_ap with pagamento
         replace val_tit_ap with cnumdoc
         replace obs_ap with cdesp
         replace qsr24a with ddataultc
         replace loja with nloja
      endif
      close
      ddtvenc:= Space(10)
      nvlricms:= 0
      nnumped:= Space(2)
      pesq23i:= 0
      nvalortit:= CToD("  /  /  ")
      pagamento:= CToD("  /  /  ")
      cnumdoc:= 0
      cdesp:= 0
      ddataultc:= Space(40)
      nloja:= 0
   enddo
   set color to (ccor)
   RestScreen(0, 0, 24, 79, ctela)
   return

********************************
procedure QSR24B

   private nvlricms, ddtvenc, nnumped, pesq23i, nvalortit, pagamento
   private cnumdoc, ddataultc, nlinha, ncoluna, vet[2], nresp, ccor, ;
      ncont
   private nvlpagto, tela24b, lcontrole, cdesp, nloja
   cpesquisa:= {"FORNECED", "FORNECE2", "CODIGO_FOR", "nCodFor"}
   ccampos:= {"CODIGO_FOR", "NOME", "", "CODIGO", "NOME", ""}
   programa(0, 69, coropcoes)
   ddtvenc:= Space(10)
   nvlricms:= 0
   nnumped:= Space(8)
   pesq23i:= 0
   nvalortit:= CToD("  /  /  ")
   pagamento:= CToD("  /  /  ")
   nvlpagto:= Date()
   cnumdoc:= 0
   cdesp:= 0
   tela24b:= 0
   ddataultc:= Space(40)
   vet[1]:= "Sim"
   vet[2]:= "No"
   nlinha:= 4
   tela11i:= nlinha + 16
   ncoluna:= 19
   lcontrole:= .T.
   nloja:= 0
   ctela:= SaveScreen(0, 0, 24, 79)
   tela24:= 0
   janela(nlinha, ncoluna, tela11i, ncoluna + 43, ;
      "Baixa de Contas a Pagar")
   nlinha++
   do while (lcontrole)
      qsr26i()
      clear gets
      @ nlinha + 1, ncoluna + 2 get nCodFor picture "99999" valid ;
         pesqfor(nvlricms)
      @ nlinha + 3, ncoluna + 2 get cNumDoc picture "@!" valid ;
         pesqdoc2(ddtvenc + Str(nvlricms), ddtvenc)
      read
      if (sai())
         loop
      endif
      if (!abredbf("ContasAp", "Contap1.NTX"))
         loop
      endif
      seek ddtvenc + Str(nvlricms, 5)
      if (!Found())
         alert("Erro na Leitura de registro! Operao ser  cancelada.")
         close
         lcontrole:= .F.
         loop
      else
         ddtvenc:= cod_for_ap
         nvlricms:= tip_doc_ap
         nnumped:= num_ped_ap
         pesq23i:= dt_emis_ap
         nvalortit:= val_icm_ap
         pagamento:= dt_venc_ap
         cnumdoc:= val_tit_ap
         cdesp:= obs_ap
         ddataultc:= qsr24a
         nloja:= loja
      endif
      close
      @ nlinha + 3, ncoluna + 20 get cTipoDoc picture "@!"
      @ nlinha + 5, ncoluna + 2 get nNumPed picture "999999"
      @ nlinha + 5, ncoluna + 20 get nValorTit picture ;
         "@E 999,999,999.99"
      @ nlinha + 7, ncoluna + 2 get nVlrIcms picture ;
         "@E 999,999,999.99"
      @ nlinha + 7, ncoluna + 20 get nLoja picture "99" valid nloja ;
         <= nnolojas
      @ nlinha + 9, ncoluna + 2 get dDtEmissao
      @ nlinha + 9, ncoluna + 20 get dDtVenc
      @ nlinha + 11, ncoluna + 2 get dDtPagto
      @ nlinha + 11, ncoluna + 20 get nVlPagto picture ;
         "@E 999,999,999.99"
      @ nlinha + 13, ncoluna + 2 get cObs picture "@!"
      clear gets
      @ nlinha + 11, ncoluna + 2 get dDtPagto valid ;
         valdatapgt(nvlpagto)
      @ nlinha + 11, ncoluna + 20 get nVlPagto picture ;
         "@E 999,999,999.99" valid tela24b > 0
      @ nlinha + 13, ncoluna + 2 get cObs picture "@!"
      read
      if (sai())
         loop
      endif
      if (!conflinha("Confirma Baixa ?", tela11i, ncoluna + 1))
         loop
      endif
      if (!abredbf("ContasPg"))
         loop
      endif
      set index to Contpg1, Contpg2, Contpg3
      if (!adiciona())
         loop
      endif
      if (!bloqueia())
         loop
      endif
      replace cod_for_pg with ddtvenc
      replace tip_doc_pg with nvlricms
      replace num_ped_pg with nnumped
      replace situaca_pg with pesq23i
      replace dt_venc_pg with nvalortit
      replace val_tit_pg with pagamento
      replace dt_pgto_pg with nvlpagto
      replace val_icm_pg with cnumdoc
      replace obs_pg with cdesp
      replace vl_pgto_pg with tela24b
      replace conta_pg with ddataultc
      replace loja with nloja
      replace num_doc_ap with tela24
      unlock
      close
      if (!abredbf("CONTASAP"))
         loop
      endif
      set index to Contap1, Contap2, Contap3
      seek ddtvenc + Str(nvlricms, 5)
      if (!Found())
         alert("Erro na excluso de registro! Operao ser  cancelada.")
         close
         lcontrole:= .F.
         loop
      endif
      if (!bloqueia())
         loop
      endif
      delete
      unlock
      close
      ddtvenc:= Space(10)
      nvlricms:= 0
      nnumped:= Space(8)
      pesq23i:= 0
      nvalortit:= CToD("  /  /  ")
      pagamento:= CToD("  /  /  ")
      nvlpagto:= Date()
      cnumdoc:= 0
      cdesp:= 0
      tela24b:= 0
      ddataultc:= Space(40)
      nloja:= 0
   enddo
   set color to (ccor)
   RestScreen(0, 0, 24, 79, ctela)
   return

********************************
function FUNC274

   parameters mode, counter
   setcursor(1)
   ccor1:= SetColor()
   set color to (corlinmenu)
   lin:= Row()
   @ 23,  0 clear to 23, 70
   @ lin,  0 say ""
   do case
   case mode = 0
      if (Deleted())
         set color to (corlinmenu)
         @ 23, 30 say "DELETADO"
      else
         @ 23, 30 say Replicate(" ", 9)
      endif
      set color to (ccor1)
      return 1
   case mode = 1
      set color to (corlinmenu)
      @ 23, 30 say "Este e o primeiro iten"
      InKey(0.5)
      @ 23, 30 say Replicate(" ", 30)
      set color to (ccor1)
      return 1
   case mode = 2
      set color to (corlinmenu)
      @ 23, 30 say "Este e o ultimo iten"
      InKey(0.5)
      @ 23, 30 clear to 23, 52
      set color to (ccor1)
      return 1
   case mode = 3
      append blank
      InKey(1)
      return 2
   case LastKey() = K_ESC
      return 0
   endcase

********************************
procedure TELA24B

   @ nlinha, ncoluna + 2 say "Cod. Fornecedor   Nome do Fornecedor"
   @ nlinha + 2, ncoluna + 2 say "N§ Documento"
   @ nlinha + 2, ncoluna + 20 say "Tipo Documento"
   @ nlinha + 4, ncoluna + 2 say "N§ Pedido"
   @ nlinha + 4, ncoluna + 20 say "Valor T¡tulo"
   @ nlinha + 6, ncoluna + 2 say "Valor ICMS"
   @ nlinha + 8, ncoluna + 2 say "Data Emisso"
   @ nlinha + 8, ncoluna + 20 say "Data Vencimento"
   @ nlinha + 10, ncoluna + 2 say "Data Pagamento"
   @ nlinha + 10, ncoluna + 20 say "Valor Pagamento"
   @ nlinha + 12, ncoluna + 2 say "Observao"
   @ nlinha + 13, ncoluna + 20 say "Loja"
   @ nlinha + 1, ncoluna + 2 get nCodFor picture "99999"
   @ nlinha + 3, ncoluna + 2 get cNumDoc picture "@!"
   @ nlinha + 3, ncoluna + 20 get cTipoDoc picture "@!"
   @ nlinha + 5, ncoluna + 2 get nNumPed picture "999999"
   @ nlinha + 5, ncoluna + 20 get nValorTit picture ;
      "@E 999,999,999.99"
   @ nlinha + 7, ncoluna + 2 get nVlrIcms picture "@E 999,999,999.99"
   @ nlinha + 9, ncoluna + 2 get dDtEmissao
   @ nlinha + 9, ncoluna + 20 get dDtVenc
   @ nlinha + 11, ncoluna + 2 get dDtPagto
   @ nlinha + 11, ncoluna + 20 get nVlPagto picture ;
      "@E 999,999,999.99"
   @ nlinha + 13, ncoluna + 2 get cObs picture "@!"
   return

********************************
function FUNC271

   parameters mode, counter
   setcursor(1)
   cpesquisa:= {"Produtos", "Produto2", "CODIGO", "cProduto"}
   ccampos:= {"CODIGO", "DESCRICAO", "VALOR", "CODIGO", "DESCRICAO", ;
      "VALOR"}
   ccor1:= SetColor()
   set color to (corlinmenu)
   lin:= Row()
   @ 23,  0 clear to 23, 70
   @ lin,  0 say ""
   do case
   case mode = 0
      if (Deleted())
         set color to (corlinmenu)
         @ 23, 30 say "DELETADO"
      else
         @ 23, 30 say Replicate(" ", 9)
      endif
      set color to (ccor1)
      return 1
   case mode = 1
      set color to (corlinmenu)
      @ 23, 30 say "Este e o primeiro iten"
      InKey(0.5)
      @ 23, 30 say Replicate(" ", 30)
      set color to (ccor1)
      return 1
   case mode = 2
      set color to (corlinmenu)
      @ 23, 30 say "Este e o ultimo iten"
      InKey(0.5)
      @ 23, 30 clear to 23, 52
      set color to (ccor1)
      return 1
   case mode = 3
      append blank
      InKey(1)
      return 2
   case LastKey() = K_INS
      rg:= RecNo()
      append blank
      goto top
      goto rg
      keyboard Replicate(Chr(24), LastRec() - RecNo())
      @ 23, 30 say Replicate(" ", 20)
      return 2
   case LastKey() = K_ESC
      return 0
   case LastKey() = K_DEL
      set color to (corfordado)
      nresp:= alert("Exclui Esse Item ?", vet)
      if (nresp == 1)
         delete
         pack
         calc271()
         return 2
      endif
   otherwise
      lerestoque()
      return 2
   endcase

********************************
procedure QSR26I

   private ncodcli, ddtvenc, nnumped, pesq23i, nvalortit, pagamento
   private cnumdoc, ddataultc, nlinha, ncoluna, vet[2], nresp, ;
      ncont, ccor, ctela, lcontrole
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   ddtvenc:= Space(10)
   ncodcli:= 0
   nnumped:= Space(2)
   pesq23i:= 0
   nvalortit:= CToD("  /  /  ")
   pagamento:= CToD("  /  /  ")
   cnumdoc:= 0
   ddataultc:= Space(40)
   ncomissao:= 0
   tela23:= 0
   nloja:= 0
   tela26:= CToD("  /  /  ")
   vet[1]:= "Sim"
   vet[2]:= "No"
   nlinha:= 4
   tela11i:= nlinha + 12
   ncoluna:= 19
   lcontrole:= .T.
   ctipoconta:= " "
   ctela:= SaveScreen(0, 0, 24, 79)
   janela(nlinha, ncoluna, tela11i, ncoluna + 43, ;
      "Inclusao de Protestos")
   nlinha++
   do while (lcontrole)
      ccomissao()
      clear gets
      @ nlinha + 1, ncoluna + 2 get nCodCli picture "99999" valid ;
         pesqcli(ncodcli)
      @ nlinha + 3, ncoluna + 2 get cNumDoc picture "@!" valid ;
         pesqdoc11(ddtvenc + Str(ncodcli, 5), ddtvenc)
      read
      if (sai())
         loop
      endif
      if (!abredbf("CONTASRE", "CONTRE1.NTX"))
         loop
      endif
      seek ddtvenc + Str(ncodcli, 5)
      if (Found())
         ddtvenc:= num_doc_re
         ncodcli:= cod_cli_re
         nnumped:= dt_venc_re
         pesq23i:= dt_emis_re
         nvalortit:= obs_re
         pagamento:= val_tit_re
         cnumdoc:= ddt_pgto
         ddataultc:= dt_loc_re
         qsr26b:= comissao
         tela23:= local23i
         nloja:= loja
         tela26:= conta_re
         ctipoconta:= "RE"
      endif
      if (ctipoconta != "RE")
         if (!abredbf("CONTASAR"))
            loop
         endif
         set index to ContAR1, ContAR2, ContAR3
         seek ddtvenc + Str(ncodcli, 5)
         if (Found())
            ddtvenc:= num_doc_ar
            ncodcli:= cod_cli_ar
            nnumped:= ctipo
            pesq23i:= dt_emis_ar
            nvalortit:= obs_ar
            pagamento:= dt_venc_ar
            cnumdoc:= val_tit_ar
            ddataultc:= localiza
            ncomissao:= comissao
            tela23:= local23i
            nloja:= loja
            tela26:= ddtlocar
            ctipoconta:= "AR"
         endif
         if (!bloqueia())
            loop
         endif
      endif
      close
      @ nlinha + 3, ncoluna + 20 get cTipoDoc picture "@!"
      @ nlinha + 5, ncoluna + 2 get nNumPed picture "999999"
      @ nlinha + 5, ncoluna + 20 get nValorTit picture ;
         "@E 999,999,999.99"
      @ nlinha + 7, ncoluna + 2 get dDtEmissao
      @ nlinha + 7, ncoluna + 20 get dDtVenc
      @ nlinha + 9, ncoluna + 2 get cObs picture "@!"
      clear gets
      if (!conflinha("Confirma Inclusao ?", tela11i, ncoluna + 1))
         loop
      endif
      if (!abredbf("CONTASAR"))
         loop
      endif
      set index to ContAR1, ContAR2, ContAR3
      if (!adiciona())
         loop
      endif
      if (!bloqueia())
         loop
      endif
      replace impcontasr with "P"
      replace num_doc_ar with ddtvenc
      replace cod_cli_ar with ncodcli
      replace ctipo with nnumped
      replace dt_emis_ar with pesq23i
      replace obs_ar with nvalortit
      replace dt_venc_ar with nvalortit
      replace val_tit_ar with cnumdoc
      replace localiza with ddataultc
      replace comissao with ncomissao
      replace local23i with tela23
      replace loja with nloja
      replace ddtlocar with tela26
      close
      if (ctipoconta = "RE")
         if (!abredbf("CONTASRE"))
            loop
         endif
         set index to CONTRE1, CONTRE2, CONTRE3
         seek ddtvenc + Str(ncodcli, 5)
         if (!Found())
            alert("Erro na Leitura de registro! Operao ser  cancelada.")
            close
            lcontrole:= .F.
            loop
         endif
         if (!bloqueia())
            loop
         endif
      else
         if (!abredbf("CONTASAR"))
            loop
         endif
         set index to ContAR1, ContAR2, ContAR3
         seek ddtvenc + Str(ncodcli, 5)
         if (!Found())
            alert("Erro na Leitura de registro! Operao ser  cancelada.")
            close
            lcontrole:= .F.
            loop
         endif
         if (!bloqueia())
            loop
         endif
      endif
      delete
      if (!abredbf("CLIENTES"))
         loop
      endif
      set index to CLIENTE1, CLIENTE2
      seek ncodcli
      if (Found())
         if (!bloqueia())
            loop
         endif
         replace no_ch_cli with no_ch_cli + 1
      endif
      close
      ddtvenc:= Space(10)
      ncodcli:= 0
      nnumped:= Space(2)
      pesq23i:= 0
      nvalortit:= CToD("  /  /  ")
      pagamento:= CToD("  /  /  ")
      cnumdoc:= 0
      ddataultc:= Space(40)
      ncomissao:= 0
      tela23:= 0
      nloja:= 0
      tela26:= CToD("  /  /  ")
      ctipoconta:= " "
   enddo
   RestScreen(0, 0, 24, 79, ctela)
   set color to (ccor)
   return

********************************
function PESCONFUN

   private ncodigo, dinicio, cnome, cpessoa, cendereco, cestado, ;
      ccidade, ctelefone
   private ccep, ddataincl, ccgc, cinsc, ddt_venc, nlinha, ncoluna, ;
      cconjuge, dfim
   private cnomerep, ccpf, lcontrole, ctela, ccor, vet[2], cesposa, ;
      cmae, cspc1, cestcivil, ncomis
   nlinha:= 6
   ncoluna:= 2
   lcontrole:= .T.
   ctel2:= SaveScreen(0, 0, 24, 79)
   ccor:= SetColor()
   vet[1]:= "Sim"
   vet[2]:= "Nao"
   janela(nlinha - 1, ncoluna, nlinha + 11, ncoluna + 77, ;
      "ZOOM Do Cadastro de Funcionarios")
   ncodigo:= est_civil
   dinicio:= identidade
   cnome:= nome
   cendereco:= endereco
   cestado:= cidade
   ccidade:= cep
   ctelefone:= ferase
   ccep:= contato
   ddataincl:= telefone
   cconjuge:= esposa
   ncomis:= status
   cestcivil:= inicio
   cmae:= mae
   cspc1:= spc1
   cnomerep:= cpf
   ccpf:= datanasc
   dfim:= fim
   cesposa:= valnom3
   ncomissao:= comissao
   codigo_fun()
   clear gets
   do while (lcontrole)
      ntecla:= InKey(0)
      if (ntecla == 27)
         lcontrole:= .F.
      endif
   enddo
   lcontrole:= .T.
   set color to (ccor)
   RestScreen(0, 0, 24, 79, ctel2)
   return Nil

********************************
procedure QSR26B

   private ncodcli, ddtvenc, nnumped, pesq23i, nvalortit, pagamento
   private cnumdoc, ddataultc, nlinha, ncoluna, vet[2], nresp, ccor, ;
      ncont
   private nvlrece, ncontadest, lcontrole
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   ddtvenc:= Space(10)
   ncodcli:= 0
   nnumped:= Space(8)
   pesq23i:= 0
   nvalortit:= CToD("  /  /  ")
   pagamento:= CToD("  /  /  ")
   nvlrece:= Date()
   cnumdoc:= 0
   ncontadest:= 0
   ddataultc:= Space(40)
   vet[1]:= "Sim"
   vet[2]:= "No"
   nlinha:= 4
   tela11i:= nlinha + 14
   ncoluna:= 19
   lcontrole:= .T.
   ctela:= SaveScreen(0, 0, 24, 79)
   janela(nlinha, ncoluna, tela11i, ncoluna + 43, ;
      "Baixa de Protestos")
   nlinha++
   @ nlinha, ncoluna + 2 say "Cod. Cliente      Nome do Cliente"
   @ nlinha + 2, ncoluna + 2 say "N§ Documento"
   @ nlinha + 2, ncoluna + 20 say "Tipo Documento"
   @ nlinha + 4, ncoluna + 2 say "N§ Pedido"
   @ nlinha + 4, ncoluna + 20 say "Valor T¡tulo"
   @ nlinha + 6, ncoluna + 2 say "Data Emisso"
   @ nlinha + 6, ncoluna + 20 say "Data Vencimento"
   @ nlinha + 8, ncoluna + 2 say "Data Recebimento"
   @ nlinha + 8, ncoluna + 20 say "Valor Recebido"
   @ nlinha + 10, ncoluna + 2 say "Observao"
   do while (lcontrole)
      @ nlinha + 1, ncoluna + 2 get nCodCli picture "99999"
      @ nlinha + 3, ncoluna + 2 get cNumDoc picture "@!"
      @ nlinha + 3, ncoluna + 20 get cTipoDoc picture "@!"
      @ nlinha + 5, ncoluna + 2 get nNumPed picture "999999"
      @ nlinha + 5, ncoluna + 20 get nValorTit picture ;
         "@E 999,999,999.99"
      @ nlinha + 7, ncoluna + 2 get dDtEmissao
      @ nlinha + 7, ncoluna + 20 get dDtVenc
      @ nlinha + 9, ncoluna + 2 get dDtRece
      @ nlinha + 9, ncoluna + 20 get nVlRece picture ;
         "@E 999,999,999.99"
      @ nlinha + 11, ncoluna + 2 get cObs picture "@!"
      clear gets
      @ nlinha + 1, ncoluna + 2 get nCodCli picture "99999" valid ;
         pesqcli(ncodcli)
      @ nlinha + 3, ncoluna + 2 get cNumDoc picture "@!" valid ;
         pesqdoc10(ddtvenc + Str(ncodcli, 5), ddtvenc)
      read
      if (sai())
         loop
      endif
      if (!abredbf("CONTASAR", "CONTAR1.NTX"))
         loop
      endif
      seek ddtvenc + Str(ncodcli, 5)
      if (!Found())
         alert("Erro na Leitura de registro!; Algun outro usu rio pode ter deletado este regitro.")
         close
         loop
      endif
      if (impcontasr != "P")
         alert("Titulo nÆo est  em protesto.")
         close
         lcontrole:= .F.
         loop
      else
         ddtvenc:= num_doc_ar
         ncodcli:= cod_cli_ar
         nnumped:= ctipo
         pesq23i:= dt_emis_ar
         nvalortit:= obs_ar
         pagamento:= dt_venc_ar
         cnumdoc:= val_tit_ar
         ddataultc:= localiza
      endif
      close
      @ nlinha + 3, ncoluna + 20 get cTipoDoc picture "@!"
      @ nlinha + 5, ncoluna + 2 get nNumPed picture "999999"
      @ nlinha + 5, ncoluna + 20 get nValorTit picture ;
         "@E 999,999,999.99"
      @ nlinha + 7, ncoluna + 2 get dDtEmissao
      @ nlinha + 7, ncoluna + 20 get dDtVenc
      @ nlinha + 9, ncoluna + 2 get dDtRece valid pagamento != Nil
      @ nlinha + 9, ncoluna + 20 get nVlRece picture ;
         "@E 999,999,999.99"
      @ nlinha + 11, ncoluna + 2 get cObs picture "@!"
      clear gets
      @ nlinha + 9, ncoluna + 2 get dDtRece valid valdatapgt(nvlrece)
      @ nlinha + 9, ncoluna + 20 get nVlRece picture ;
         "@E 999,999,999.99"
      @ nlinha + 11, ncoluna + 2 get cObs picture "@!"
      read
      if (!conflinha("Confirma Baixa ?", tela11i, ncoluna + 1))
         loop
      endif
      if (!abredbf("CONTASRE"))
         loop
      endif
      set index to CONTRE1, CONTRE2, CONTRE3
      if (!adiciona())
         loop
      endif
      if (!bloqueia())
         loop
      endif
      replace num_doc_re with ddtvenc
      replace cod_cli_re with ncodcli
      replace dt_venc_re with nnumped
      replace dt_emis_re with pesq23i
      replace qsr27i with "P"
      replace obs_re with nvalortit
      replace val_tit_re with pagamento
      replace dt_rece_re with nvlrece
      replace ddt_pgto with cnumdoc
      replace vl_rece_re with ncontadest
      replace dt_loc_re with ddataultc
      close
      if (!abredbf("CONTASAR"))
         loop
      endif
      set index to CONTAR1, CONTAR2, CONTAR3
      seek ddtvenc + Str(ncodcli, 5)
      if (!Found())
         alert("Registro nÆo encontrado! Operao ser  cancelada.")
         close
         lcontrole:= .F.
         loop
      endif
      if (!bloqueia())
         loop
      endif
      delete
      unlock
      close
      ddtvenc:= Space(10)
      ncodcli:= 0
      nnumped:= Space(8)
      pesq23i:= 0
      nvalortit:= CToD("  /  /  ")
      pagamento:= CToD("  /  /  ")
      nvlrece:= Date()
      cnumdoc:= 0
      ncontadest:= 0
      ddataultc:= Space(40)
   enddo
   set color to (ccor)
   RestScreen(0, 0, 24, 79, ctela)
   return

********************************
function GERTEMP324(Arg1, Arg2)

   local Local1
   Local1:= .F.
   select 2
   if (!abredbf("CONSIGNA", "CONSIGN3.NTX"))
      return .F.
   endif
   select 3
   if (!abredbf("CLIENTES", "CLIENTE1.NTX"))
      return .F.
   endif
   select 1
   use (dbcreate)
   select 2
   set softseek on
   seek Arg1
   set softseek off
   if (!EOF())
      do while (data >= Arg1 .AND. data <= Arg2)
         if (ncodigo != 0)
            if (cliente != ncodigo)
               skip 
               loop
            endif
         endif
         ncliente:= cliente
         nnumero:= numero
         valfr:= data
         nvaltot:= valor_tot
         fonecomp:= vendedor
         select 3
         seek ncliente
         if (Found())
            cnomecli:= nome_cli
         endif
         select 1
         if (!adiciona())
            loop
         endif
         replace cliente with ncliente
         replace nome_cli with cnomecli
         replace numero with nnumero
         replace data with valfr
         replace valor_tot with nvaltot
         replace vendedor with fonecomp
         select 2
         skip 
         nlinha++
      enddo
   endif
   select 2
   close
   select 3
   close
   return

********************************
procedure QSR27I

   private ncodcli, ddtvenc, nnumped, pesq23i, nvalortit, pagamento
   private cnumdoc, ddataultc, nlinha, ncoluna, vet[2], nresp, ccor, ;
      ncont, lcontrole
   private nloja, cmatextras[3, 2], cmatnot[3], cextra[3]
   cpesquisa:= {"FUNCIONA", "FUNCION2", "CODIGO_FUN", "nCodigo"}
   ccampos:= {"CODIGO_FUN", "NOME", "", "CODIGO", "NOME", ""}
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   ncodigo:= 0
   valfr:= CToD("")
   cdia:= Space(3)
   cnoturno:= Space(5)
   nhex:= Space(5)
   nmex:= 8
   caltera:= 0
   iniciavar:= "N"
   vet[1]:= "Sim"
   vet[2]:= "No"
   nlinha:= 4
   tela11i:= nlinha + 14
   ncoluna:= 19
   ctela:= SaveScreen(0, 0, 24, 79)
   lcontrole:= .T.
   cmatnot:= {0, 0, 0}
   cextra:= {0, 0, 0}
   tela27()
   janela(nlinha, ncoluna, tela11i, ncoluna + 43, "Inclusao de Horas")
   nlinha++
   do while (lcontrole)
      ctotal1()
      read
      if (sai())
         loop
      endif
      for i:= 1 to 3
         cmatextras[i][1]:= iif(Empty(cmatextras[i][1]), "00:00", ;
            cmatextras[i][1])
         cmatextras[i][2]:= iif(Empty(cmatextras[i][2]), "00:00", ;
            cmatextras[i][2])
      next
      if (!conflinha("Confirma Inclusao ?", tela11i, ncoluna + 1))
         loop
      endif
      if (!abredbf("HORARIO"))
         loop
      endif
      set index to HORA1, HORA2, HORA3
      if (iniciavar != "S")
         if (!adiciona())
            loop
         endif
      else
         set order to 3
         seek Str(ncodigo, 5) + DToC(valfr)
         if (!Found())
            alert("ERRO AO ABRIR REGISTRO ! ; OPERACAO SERA CANCELADA")
         endif
      endif
      if (!bloqueia())
         loop
      endif
      ctotal2:= elaptime(cmatextras[1][1], cmatextras[1][2])
      ctotal3:= elaptime(cmatextras[2][1], cmatextras[2][2])
      ntotalhora:= elaptime(cmatextras[3][1], cmatextras[3][2])
      ntotalmin:= Val(SubStr(ctotal2, 1, 2)) + Val(SubStr(ctotal3, ;
         1, 2)) + Val(SubStr(ntotalhora, 1, 2))
      nhoras:= Val(SubStr(ctotal2, 4, 2)) + Val(SubStr(ctotal3, 4, ;
         2)) + Val(SubStr(ntotalhora, 4, 2))
      ctotalhora:= 0
      do while (nhoras >= 60)
         ctotalhora++
         nhoras:= nhoras - 60
      enddo
      ntotalmin:= ntotalmin + ctotalhora
      ctotalextr:= Str(ntotalmin, 2) + ":" + iif(nhoras > 0, ;
         Str(nhoras, 2), "00")
      lferiado:= "  :  "
      if (nhoras < 20)
         ntotalmin:= ntotalmin - 1
         nhoras:= nhoras + 60
      endif
      cmatnot:= {0, 0, 0}
      if (cdia = "DOM")
         seferiado:= .T.
      else
         seferiado:= dia(valfr)
      endif
      if (!seferiado)
         if (cdia != "Sab")
            if (ntotalmin > nmex)
               lferiado:= Str(ntotalmin - nmex, 2) + ":" + ;
                  Str(nhoras - caltera, 2)
               lferiado:= horaminu(lferiado) / 2
               lferiado:= minuhora(lferiado)
            elseif (ntotalmin = nmex .AND. nhoras > caltera)
               lferiado:= Str(ntotalmin - nmex, 2) + ":" + ;
                  Str(nhoras - caltera, 2)
               lferiado:= horaminu(lferiado) / 2
               lferiado:= minuhora(lferiado)
            endif
         elseif (cdia = "Sab")
            if (ntotalmin > nmex)
               lferiado:= Str(ntotalmin - nmex, 2) + ":" + ;
                  Str(nhoras - caltera, 2)
               lferiado:= horaminu(lferiado) / 2
               lferiado:= minuhora(lferiado)
            elseif (ntotalmin = nmex .AND. nhoras > caltera)
               lferiado:= Str(ntotalmin - nmex, 2) + ":" + ;
                  Str(nhoras - caltera, 2)
               lferiado:= horaminu(lferiado) / 2
               lferiado:= minuhora(lferiado)
            endif
            if (Val(SubStr(cmatextras[1][2], 1, 2)) < ;
                  Val(SubStr(cmatextras[1][1], 1, 2)))
               cmatnot[1]:= horaminu(cmatextras[1][2])
               cmatnot[2]:= horaminu(cmatextras[2][2]) - ;
                  horaminu(cmatextras[2][1])
               cmatnot[3]:= horaminu(cmatextras[3][2]) - ;
                  horaminu(cmatextras[3][1])
            endif
            if (Val(SubStr(cmatextras[2][2], 1, 2)) < ;
                  Val(SubStr(cmatextras[2][1], 1, 2)) .OR. ;
                  Val(SubStr(cmatextras[2][1], 1, 2)) < ;
                  Val(SubStr(cmatextras[1][2], 1, 2)))
               cmatnot[2]:= horaminu(cmatextras[2][2])
               cmatnot[3]:= horaminu(cmatextras[3][2]) - ;
                  horaminu(cmatextras[3][1])
            endif
            if (Val(SubStr(cmatextras[3][2], 1, 2)) < ;
                  Val(SubStr(cmatextras[3][1], 1, 2)) .OR. ;
                  Val(SubStr(cmatextras[3][1], 1, 2)) < ;
                  Val(SubStr(cmatextras[2][2], 1, 2)))
               cmatnot[3]:= horaminu(cmatextras[3][2])
            endif
            lferiado:= horaminu(lferiado) + cmatnot[1] + cmatnot[2] ;
               + cmatnot[3]
            lferiado:= minuhora(lferiado)
         endif
      else
         if (Val(SubStr(cmatextras[1][2], 1, 2)) < ;
               Val(SubStr(cmatextras[1][1], 1, 2)))
            cmatnot[1]:= horaminu(cmatextras[1][2])
            cmatnot[2]:= horaminu(cmatextras[2][2]) - ;
               horaminu(cmatextras[2][1])
            cmatnot[3]:= horaminu(cmatextras[3][2]) - ;
               horaminu(cmatextras[3][1])
         endif
         if (Val(SubStr(cmatextras[2][2], 1, 2)) < ;
               Val(SubStr(cmatextras[2][1], 1, 2)) .OR. ;
               Val(SubStr(cmatextras[2][1], 1, 2)) < ;
               Val(SubStr(cmatextras[1][2], 1, 2)))
            cmatnot[2]:= horaminu(cmatextras[2][2])
            cmatnot[3]:= horaminu(cmatextras[3][2]) - ;
               horaminu(cmatextras[3][1])
         endif
         if (Val(SubStr(cmatextras[3][2], 1, 2)) < ;
               Val(SubStr(cmatextras[3][1], 1, 2)) .OR. ;
               Val(SubStr(cmatextras[3][1], 1, 2)) < ;
               Val(SubStr(cmatextras[2][2], 1, 2)))
            cmatnot[3]:= horaminu(cmatextras[3][2])
         endif
         lferiado:= horaminu(lferiado) + cmatnot[1] + cmatnot[2] + ;
            cmatnot[3]
         lferiado:= minuhora(lferiado)
         lferiado:= horaminu(ctotalextr) - horaminu(lferiado)
         lferiado:= minuhora(lferiado)
      endif
      for i:= 1 to 3
         if (horaminu(cmatextras[i][1]) < 1320 .AND. ;
               horaminu(cmatextras[i][1]) > 300)
            if (horaminu(cmatextras[i][2]) > 1320)
               cextra[i]:= 120 - (1440 - horaminu(cmatextras[i][2]))
            endif
            if (horaminu(cmatextras[i][2]) < 300)
               cextra[i]:= 120 + horaminu(cmatextras[i][2])
            endif
            if (horaminu(cmatextras[i][2]) < 1320 .AND. ;
                  horaminu(cmatextras[i][2]) > 300 .AND. ;
                  horaminu(cmatextras[i][1]) > ;
                  horaminu(cmatextras[i][2]))
               cextra[i]:= 420
            endif
         endif
         if (horaminu(cmatextras[i][1]) >= 1320)
            if (horaminu(cmatextras[i][2]) > 1320)
               cextra[i]:= horaminu(cmatextras[i][2]) - ;
                  horaminu(cmatextras[i][1])
            endif
            if (horaminu(cmatextras[i][2]) < 300)
               cextra[i]:= 1440 - horaminu(cmatextras[i][1]) + ;
                  horaminu(cmatextras[i][2])
            endif
            if (horaminu(cmatextras[i][2]) > 300 .AND. ;
                  horaminu(cmatextras[i][1]) > ;
                  horaminu(cmatextras[i][2]))
               cextra[i]:= 1440 - horaminu(cmatextras[i][1]) + 300
            endif
         endif
         if (horaminu(cmatextras[i][1]) < 300)
            if (horaminu(cmatextras[i][2]) < 300)
               cextra[i]:= horaminu(cmatextras[i][2]) - ;
                  horaminu(cmatextras[i][1])
            endif
            if (horaminu(cmatextras[i][2]) > 300 .AND. ;
                  horaminu(cmatextras[i][1]) < ;
                  horaminu(cmatextras[i][2]))
               cextra[i]:= 300 - horaminu(cmatextras[i][1])
            endif
         endif
      next
      select 1
      replace qsr23i with ncodigo
      replace data with valfr
      replace p_inicio with cdia
      replace p_fim with cmatextras[1][1]
      replace s_inicio with cmatextras[1][2]
      replace s_fim with cmatextras[2][1]
      replace t_inicio with cmatextras[2][2]
      replace t_fim with cmatextras[3][1]
      replace extra with cmatextras[3][2]
      replace noturno with lferiado
      replace __geta with minuhora(cextra[1] + cextra[2] + cextra[3])
      close
      ncodigo:= 0
      valfr:= CToD("")
      cdia:= Space(3)
      cnoturno:= Space(8)
      nhex:= Space(8)
      iniciavar:= "N"
      tela27()
   enddo
   RestScreen(0, 0, 24, 79, ctela)
   set color to (ccor)
   return

********************************
function PESQ272

   if (Upper(readvar()) = "NCODCLI")
      cpesquisa:= {"CLIENTES", "CLIENTE2", "CODIGO_CLI", "nCodCli"}
      ccampos:= {"CODIGO_CLI", "NOME_CLI", "", "CODIGO", "NOME", ""}
   elseif (Upper(readvar()) = "NCODVEND")
      cpesquisa:= {"FUNCIONA", "FUNCION2", "CODIGO_FUN", "nCodVend"}
      ccampos:= {"CODIGO_FUN", "NOME", "", "CODIGO", "NOME", ""}
   endif
   pesquisa()
   return .T.

********************************
function TELA27

   @ nlinha + 1, ncoluna + 2 say "Codigo"
   @ nlinha + 3, ncoluna + 2 say "Data"
   @ nlinha + 5, ncoluna + 2 say "Entrada"
   @ nlinha + 5, ncoluna + 12 say "Saida"
   @ nlinha + 7, ncoluna + 2 say "Entrada"
   @ nlinha + 7, ncoluna + 12 say "Saida"
   @ nlinha + 9, ncoluna + 2 say "Entrada"
   @ nlinha + 9, ncoluna + 12 say "Saida"
   @ nlinha + 2, ncoluna + 2 get nCodigo picture "99999" valid ;
      pesqfun22(ncodigo)
   @ nlinha + 4, ncoluna + 2 get dData valid diasem(valfr, nlinha + ;
      4, ncoluna + 14, "W+/B")
   read
   if (!abredbf("HORARIO"))
      return .F.
   endif
   set index to HORA3
   seek Str(ncodigo, 5) + DToC(valfr)
   if (Found())
      ncodigo:= qsr23i
      valfr:= data
      cdia:= p_inicio
      cmatextras[1][1]:= p_fim
      cmatextras[1][2]:= s_inicio
      cmatextras[2][1]:= s_fim
      cmatextras[2][2]:= t_inicio
      cmatextras[3][1]:= t_fim
      cmatextras[3][2]:= extra
      iniciavar:= "S"
   endif
   close
   SetPos(nlinha + 6, ncoluna + 2)
   AAdd(getlist, qsr271({|| cmatextras}, "cHorario", "99:99", Nil, ;
      Nil, {1, 1}):display())
   SetPos(nlinha + 6, ncoluna + 12)
   AAdd(getlist, qsr271({|| cmatextras}, "cHorario", "99:99", Nil, ;
      Nil, {1, 2}):display())
   SetPos(nlinha + 8, ncoluna + 2)
   AAdd(getlist, qsr271({|| cmatextras}, "cHorario", "99:99", Nil, ;
      Nil, {2, 1}):display())
   SetPos(nlinha + 8, ncoluna + 12)
   AAdd(getlist, qsr271({|| cmatextras}, "cHorario", "99:99", Nil, ;
      Nil, {2, 2}):display())
   SetPos(nlinha + 10, ncoluna + 2)
   AAdd(getlist, qsr271({|| cmatextras}, "cHorario", "99:99", Nil, ;
      Nil, {3, 1}):display())
   SetPos(nlinha + 10, ncoluna + 12)
   AAdd(getlist, qsr271({|| cmatextras}, "cHorario", "99:99", Nil, ;
      Nil, {3, 2}):display())
   return

********************************
function FUNC273

   parameters mode, counter
   setcursor(1)
   cpesquisa:= {"Produtos", "Produto2", "CODIGO", "cProduto"}
   ccampos:= {"DESCRICAO", "VALOR", "ESTOQUE", "DESCRICAO", "VALOR", ;
      "ESTOQUE"}
   ccor1:= SetColor()
   set color to (corlinmenu)
   lin:= Row()
   @ 23,  0 clear to 23, 70
   @ lin,  0 say ""
   do case
   case mode = 0
      if (Deleted())
         set color to (corlinmenu)
         @ 23, 30 say "DELETADO"
      else
         @ 23, 30 say Replicate(" ", 9)
      endif
      set color to (ccor1)
      return 1
   case mode = 1
      set color to (corlinmenu)
      @ 23, 30 say "Este e o primeiro iten"
      InKey(0.5)
      @ 23, 30 say Replicate(" ", 30)
      set color to (ccor1)
      return 1
   case mode = 2
      set color to (corlinmenu)
      @ 23, 30 say "Este e o ultimo iten"
      InKey(0.5)
      @ 23, 30 clear to 23, 52
      set color to (ccor1)
      return 1
   case mode = 3
      append blank
      InKey(1)
      return 2
   case LastKey() = K_ESC
      return 0
   otherwise
      set color to (corfordado)
      lin:= Row()
      ntotquanti:= ntotquanti - estodev
      @ lin, ncoluna + 68 get nDevol picture "999.99" valid ndevol ;
         <= esto
      read
      replace estodev with ndevol
      ntotquanti:= ntotquanti + ndevol
      @ nlinha + 16, ncoluna + 68 say ntotquanti picture "99,999.99"
      ndevol:= 0
      set color to (ccor1)
      return 2
   endcase

********************************
function QSR271

   public ndesc, ddataultc, ctipo_nota, nloja
   private v1[2], v2[2], v3[2], nnoped
   private ncodcli, ncodvend, observacao, ddataped, nvaltot
   private ccor, ctela, ncont, nlinha, ncoluna, vet[2], cnomcli, ;
      cnomvend
   private lcontrole, dbcreate, ncont, ntotquanti, ntotvalor, ;
      ntotpraz, nacresc
   private nporcdesc, nporccomis, nacudesc, nacuacre, cproduto
   set escape on
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   ctipo_nota:= "NF"
   nlinha:= 3
   tela11i:= nlinha + 19
   ncoluna:= 1
   nresp:= 0
   nnoped:= .F.
   ntotquanti:= 0
   ntotpraz:= 0
   ndesc:= 0
   nacresc:= 0
   nporcdesc:= 0
   ntotvalor:= 0
   ddataultc:= Space(50)
   cproduto:= 0
   observacao:= 0
   ddataped:= CToD("  /  /  ")
   ncodvend:= 0
   ncodcli:= 0
   nporccomis:= 0
   nvaltot:= 0
   lcontrole:= .T.
   nloja:= 1
   cnomcli:= ""
   ccgc:= ""
   cinsc:= ""
   nnumorc:= 0
   ntotbrtp:= 0
   ntotbrtv:= 0
   nacudesc:= 0
   nacuacre:= 0
   vet:= {"Sim", "Nao"}
   ctela:= SaveScreen(0, 0, 24, 79)
   ndestino:= 0
   norc:= 0
   ndesconto:= 0
   janela(nlinha, ncoluna, tela11i, ncoluna + 77, ;
      "Inclusao de Pedidos de Venda")
   nlinha++
   criaarq271()
   do while (lcontrole)
      gravaped2()
      if (sai())
         lcontrole:= .F.
         loop
      endif
      if (cdesc_porc == "S")
         @ nlinha + 16,  2 say "Desconto " get nPorcDesc picture ;
            "99.99"
         read
      endif
      select 1
      use (dbcreate) exclusive
      if (sai())
         loop
      endif
      cproduto:= Space(5)
      private camp1[7], camp3[7], camp4[7]
      camp1:= {"PROD", "DESC", "TAM", "ESTO", "VEND", "VL_ITEM", ;
         "MARCA", "VL_DESC", "DESC_ITEM"}
      camp3:= {"XXXXX", "@!", "XXX", "99999.99", "999,999.99", ;
         "99999.99", "@!", "999,999.99", "999,999.99", Nil}
      camp4:= {"Codigo", "Descrio ", "Tam", "Quant", "Valor", ;
         "Vl.Item", "Marca", "DESC", "IT_DESC"}
      ncoluna:= 1
      dbedit(nlinha, ncoluna + 1, nlinha + 15, ncoluna + 76, camp1, ;
         "FUNC271", camp3, camp4, "ÂÄ", "³", "ÁÄ", "")
      DBEval({|| dbDelete()}, {|| prod = "     "}, Nil, Nil, Nil, .F.)
      pack
      if (LastRec() == 0)
         close
         lcontrole:= .F.
         loop
      endif
      if (gravaped())
         if (cnf = "O")
            impriped(Str(nloja, 2) + Str(observacao, 5), observacao, ;
               "S")
         elseif (cnf = "N")
            lpagina(Str(nloja, 2) + Str(observacao, 5), observacao, ;
               "S")
         endif
         nnoped:= .T.
      endif
      lcontrole:= .F.
   enddo
   close databases
   select 1
   close format
   impritrans(dbcreate)
   RestScreen(0, 0, 24, 79, ctela)
   set color to (ccor)
   if (nnoped .AND. cchpgto == "S")
      lresp(@observacao, @nloja)
   endif
   if (cchpgto != "S" .AND. LastKey() != K_ESC)
      opcao:= 1
      keyboard Chr(13)
   endif
   return Nil

********************************
function LERESTOQUE

   set color to (corfordado)
   lin:= Row()
   if (Empty(prod))
      cproduto:= Chr(LastKey()) + Replicate(" ", 5 - ;
         Len(Chr(LastKey())))
      keyboard Chr(4)
      @ lin, ncoluna + 1 get cProduto picture "XXXXX" valid ;
         pedcodest(cproduto)
      read
   else
      clear gets
      fonecomp:= vend
      pedcodest(prod)
      replace vend with fonecomp
   endif
   replace vend2 with vend * esto
   @ lin, ncoluna + 44 get TAM picture "!!!" valid !Empty(tam)
   @ lin, ncoluna + 48 get ESTO picture "99999.99"
   @ lin, ncoluna + 57 get VEND picture "999,999.99" valid vend > 0
   read
   replace vl_item with vend * esto
   replace desc_item with vl_desc * esto
   calc271()
   set color to (ccor1)
   return 2

********************************
function GRAVAPED

   public cavista
   if (conflinha("Confirma este Pedido ?", 23, 2))
      if (procname(1) = "QSR271")
      endif
      set color to (corlinmenu)
      @ 23,  0 say Replicate(" ", 80)
      nvaltot:= 0
      mostrar("**** Gravando ****")
      if (!abredbf("EMPRESA"))
         return .T.
      endif
      if (cautoped == "S")
         observacao:= nchavereg + 1
         if (!bloqueia())
            return .F.
         endif
         replace nchavereg with nchavereg + 1
      endif
      close
      select 1
      use (dbcreate) exclusive
      goto top
      goto top
      do while (!EOF())
         nvaltot:= nvaltot + (esto * vend + des_acre)
         skip 
      enddo
      close databases
      select 1
      close format
      ncomissao:= 0
      if (ncodcli != 1)
         if (!abredbf("CLIENTES", "CLIENTE1.NTX"))
            return .F.
         endif
         seek ncodcli
         if (Found())
            cnomcli:= nome_cli
         else
            cnomcli:= " "
         endif
      endif
      if (!abredbf("PEDIDOS"))
         return .F.
      endif
      set index to PEDIDOS1, PEDIDOS2, PEDIDOS3
      if (!adiciona())
         return .F.
      endif
      if (!bloqueia())
         return .F.
      endif
      replace numero with observacao
      replace cliente with ncodcli
      replace data with ddataped
      replace vendedor with ncodvend
      replace valor_tot with nvaltot
      replace nome_cli with cnomcli
      replace cgc with ccgc
      replace insc with cinsc
      replace acrescimo with nacresc
      replace orcamento with norc
      replace emp with cconrev
      replace impricons with ddataultc
      replace loja with 1
      replace desconto with ndesconto
      replace form_pgto with ccond
      replace comissao with ncomissao
      replace aliqcomis with nporccomis
      replace origem with ndestino
      replace valor_desc with nvaltot - nvaltot * ndesconto / 100
      if (procname(1) = "QSR271")
         replace int_ext with "I"
      else
         replace int_ext with "E"
      endif
      select 2
      if (!abredbf("PED_MAT", "PED_MAT.NTX"))
         return .F.
      endif
      select 3
      if (!abredbf(dbcreate))
         return .F.
      endif
      select 4
      if (!abredbf("Produtos", "Produto1.NTX"))
         return .F.
      endif
      select 5
      if (!abredbf("COMISSAO", "COMIS1.NTX"))
         return .F.
      endif
      select 7
      if (!abredbf("ESTOQUE"))
         return .F.
      endif
      set index to ESTOQUE2, ESTOQUE1
      select 8
      if (!abredbf("FAT_MAT"))
         return .F.
      endif
      set index to FAT_MAT3
      select 3
      goto top
      do while (!EOF())
         nquanti:= prod
         cest:= esto
         fonecomp:= vend
         naliq4:= aliq1
         nvalcust:= vl_cust
         cdebcred:= esto * vend + des_acre
         ndesc:= des_acre
         ctam:= tam
         select 4
         seek nquanti
         if (Found())
            ngrupo:= grupo
            if (!bloqueia())
               loop
            endif
            replace estoque with estoque - cest
            cdescricao:= descricao
         endif
         if (cdesc_porc != "S")
            select 5
            seek Str(ncodvend, 5) + Str(ngrupo, 3)
            if (Found())
               vcod14i:= cdebcred * (comissao / 100)
            else
               vcod14i:= 0
            endif
         else
            vcod14i:= cdebcred * (nporcdesc / 100)
         endif
         select 2
         if (!adiciona())
            loop
         endif
         if (!bloqueia())
            loop
         endif
         replace numero_ped with observacao
         replace codigo_mat with nquanti
         replace quantidade with cest
         replace valor with fonecomp
         replace nvalicm with naliq4
         replace comissao with vcod14i
         replace loja with nloja
         replace data_ultc with nvalcust
         replace tamanho with ctam
         select 8
         seek Str(norc, 5) + nquanti
         if (Found())
            if (!bloqueia())
               loop
            endif
            if (quantidade - cest <= 0)
               delete
            else
               replace quantidade with quantidade - cest
            endif
         else
            alert("NAO ACHEI")
         endif
         select 7
         seek Str(ndestino, 3) + nquanti + ctam
         if (Found())
            bloqueia()
            replace estoque with estoque - cest
         else
            adiciona()
            bloqueia()
            replace est_minimo with ndestino
            replace desc_local with procura("LocEst", "LocEst1", ;
               ndestino, "DESCRICAO")
            replace produto with nquanti
            replace desc_prod with cdescricao
            replace tamanho with ctam
            replace estoque with estoque - cest
         endif
         select 3
         skip 
      enddo
      ncont:= 0
      select 1
      nacudesc:= 0
      nacuacre:= 0
      if (!abredbf("CLIENTES", "CLIENTE1.NTX"))
         return .F.
      endif
      seek ncodcli
      if (Found())
         if (!bloqueia())
            return .F.
         endif
         if (Empty(npc_ul_cli))
            replace npc_ul_cli with ddataped
         endif
         replace dt_1ac_cli with ddataped
         replace limitc_cli with ntotquanti
         replace conta_bco with nvaltot
         replace vendedor with ncodvend
      endif
      return .T.
   endif
   set color to (corfordado)
   return .F.

********************************
function VALORCPED(Arg1)

   if (!abredbf("ORCAMENT", "ORCAMEN1.NTX"))
      return .F.
   endif
   if (Arg1 == 0)
      return .F.
   endif
   nped:= Str(1, 2) + Str(Arg1, 5)
   seek nped
   if (!Found())
      alert(" Orcamento nÆo cadastrado ")
      close
      return .T.
   else
      ncodcli:= cliente
      cnomcli:= nome_cli
      ccgc:= cgc
      cinsc:= insc
      cender:= procura("CLIENTES", "CLIENTE1", ncodcli, "Endere_Cli")
      ccidade:= procura("CLIENTES", "CLIENTE1", ncodcli, "Cidade_Cli")
      cbair:= procura("CLIENTES", "CLIENTE1", ncodcli, "Bairro_Cli")
      cuf:= procura("CLIENTES", "CLIENTE1", ncodcli, "Estado_Cli")
      cfone:= procura("CLIENTES", "CLIENTE1", ncodcli, "Fone_Cli")
      ccep:= procura("CLIENTES", "CLIENTE1", ncodcli, "CEP_Cli")
      ncodvend:= vendedor
      ddataultc:= impricons
      close
      select 1
      select 1
      use (dbcreate) exclusive
      select 2
      if (!abredbf("FAT_MAT"))
         return .F.
      endif
      set index to FAT_MAT1
      seek Arg1
      do while (!EOF() .AND. numero_ped == Arg1)
         ccodigo:= codigo_mat
         ctam:= tamanho
         nquant:= quantidade
         cdebcred:= valor
         select 1
         append blank
         replace prod with ccodigo
         replace desc with procura("PRODUTOS", "PRODUTO1", ccodigo, ;
            "DESCRICAO")
         replace tam with ctam
         replace esto with nquant
         replace vend with cdebcred
         replace vl_item with cdebcred * nquant
         select 2
         skip 
      enddo
      close databases
      select 1
      close format
      return .T.
   endif
   return .F.

********************************
function GRAVAPED2

   public cnomcli, ccgc, cinsc, cender, ccidade, cuf, cfone, ccep, ;
      cbair
   public cnf, ccond, cconrev
   set key K_F10 to pesq271
   vet[1]:= "Sim"
   vet[2]:= "No"
   nlin1:= 6
   ncol1:= 5
   nlinha:= 7
   ncoluna:= 5
   ctel2:= SaveScreen(0, 0, 24, 79)
   lcontrole:= .T.
   cnf:= "O"
   ccond:= "V"
   cconrev:= cpadrcons
   nloja:= 1
   cnomcli:= Space(30)
   ccgc:= Space(18)
   cinsc:= Space(17)
   cender:= Space(35)
   ccidade:= Space(20)
   cbair:= Space(15)
   cuf:= "GO"
   cfone:= Space(13)
   ccep:= Space(10)
   janela(nlin, ncol1, nlin + 12, ncol1 + 70, "")
   nlinha++
   do while (lcontrole)
      nlinha:= 9
      ddataped:= Date()
      if (cautoped == "S")
      else
         @ nlinha + 0, ncoluna + 1 say "Fatura..:" get nNoPed ;
            picture "99999" valid valnnoped(Str(1, 2) + ;
            Str(observacao, 5), observacao)
         @ nlinha + 0, ncoluna + 18 say "Orcamento.:" get nOrc ;
            picture "99999" valid valorcped(norc)
         @ nlinha + 0, ncoluna + 37 say "Desconto.:" get nDesconto ;
            picture "99.99"
      endif
      nlinha++
      @ nlinha + 0, ncoluna + 1 say "Data....:" get dDataPed
      @ nlinha + 0, ncoluna + 20 say "Estoque.:" get nOrigem picture ;
         "999" valid qsr21i(ndestino, nlinha - 1, 40)
      @ nlinha + 1, ncoluna + 1 say "Cliente.:" get nCodCli picture ;
         "99999" valid codpedcli(ncodcli)
      @ nlinha + 2, ncoluna + 1 say "Cgc/Cpf.:"
      @ nlinha + 2, ncoluna + 32 say "Insc/Ident"
      @ nlinha + 3, ncoluna + 1 say "Ender...:"
      @ nlinha + 3, ncoluna + 52 say "CEP"
      @ nlinha + 4, ncoluna + 40 say "Uf"
      @ nlinha + 4, ncoluna + 48 say "Fone"
      @ nlinha + 4, ncoluna + 1 say "Cidade..:"
      @ nlinha + 5, ncoluna + 1 say "Bairro..:"
      @ nlinha + 6, ncoluna + 1 say "Vendedor"
      @ nlinha + 1, ncoluna + 17 get cNomCli picture "@!" when ;
         ncodcli = 1
      if (cconrev == "R")
         @ nlinha + 2, ncoluna + 11 get cCGC picture ;
            "99.999.999/9999-99" when ncodcli = 1
      else
         @ nlinha + 2, ncoluna + 11 get cCGC when ncodcli = 1
      endif
      @ nlinha + 2, ncoluna + 43 get cInsc when ncodcli = 1
      @ nlinha + 3, ncoluna + 11 get cEnder picture "@!" when ;
         ncodcli = 1
      @ nlinha + 3, ncoluna + 57 get cCep picture "99.999-999" when ;
         ncodcli = 1
      @ nlinha + 4, ncoluna + 11 get cCidade picture "@!" when ;
         ncodcli = 1
      @ nlinha + 4, ncoluna + 43 get cUf picture "!!" when ncodcli = 1
      @ nlinha + 4, ncoluna + 55 get cFone picture "(999)999-9999" ;
         when ncodcli = 1
      @ nlinha + 5, ncoluna + 11 get cBair picture "@!" when ncodcli ;
         = 1
      @ nlinha + 6, ncoluna + 11 get nCodVend picture "99999" valid ;
         codpedvend(ncodvend)
      nlinha++
      if (ntipocomis == 2)
         nporccomis:= 1.5
         @ nlinha + 5, ncoluna + 50 say "Comissao" get nPorcComis ;
            picture "99.99" valid nporccomis > 0
      endif
      @ nlinha + 6, ncoluna + 1 say "Observ..:" get cObs
      @ nlinha + 7, ncoluna + 1 say ;
         "Orcamento  Nota Fiscal (O/N)   " get cNf picture "!" valid ;
         cnf $ "ON"
      @ nlinha + 8, ncoluna + 1 say ;
         "A Vista  ou a Prazo (V/P)      " get cCond picture "!" ;
         valid ccond $ "VP"
      read
      if (sai())
         loop
      endif
      if (!conflinha("CONFIRMA ESTE PEDIDO ?", 23, 2))
         lcontrole:= .F.
      else
         nlinha:= 4
         ncoluna:= 5
         RestScreen(0, 0, 24, 79, ctel2)
         return .T.
      endif
   enddo
   nlinha:= 4
   ncoluna:= 5
   RestScreen(0, 0, 24, 79, ctel2)
   return .F.

********************************
function PESQ319

   if (Upper(readvar()) = "NLOCAL")
      cpesquisa:= {"LOCEST", "LOCEST1", "CODIGO", "nLocal"}
      ccampos:= {"CODIGO", "DESCRICAO", "", "CODIGO", "DESCRICAO", ""}
   elseif (Upper(readvar()) = "CPRODUTO")
      cpesquisa:= {"PRODUTOS", "PRODUTO2", "CODIGO", "cProduto"}
      ccampos:= {"CODIGO", "DESCRICAO", "", "CODIGO", "DESCRICAO", ""}
   endif
   pesquisa()
   return .T.

********************************
function QSR272

   private carquivo[6, 4], v1[2], v2[2], v3[2]
   private ncodcli, ncodvend, observacao, ddataped, nvaltot
   private ccor, ctela, ncont, nlinha, ncoluna, vet[2], cnomcli, ;
      cnomvend
   private lcontrole, dbcreate, ncont, ntotquanti, ntotvalor, nloja
   private ddt_act
   set key K_F10 to pesq272
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   nlinha:= 3
   ncoluna:= 1
   ntotquanti:= 0
   ntotvalor:= 0
   cproduto:= 0
   observacao:= 0
   ddataped:= CToD("  /  /  ")
   ncodvend:= 0
   ncodcli:= 0
   nvaltot:= 0
   cobservac:= Space(50)
   lcontrole:= .T.
   vet[1]:= "Sim"
   vet[2]:= "Nao"
   ctela:= SaveScreen(0, 0, 24, 79)
   ddt_act:= CToD("")
   nloja:= 1
   janela(nlinha, ncoluna, nlinha + 18, ncoluna + 77, ;
      " Inclusao de Pedidos de Consignacao ")
   nlinha++
   ncont:= 1
   dbcreate:= "TEMP" + LTrim(Str(ncont)) + ".DBF"
   do while (file(dbcreate))
      ncont++
      dbcreate:= "TEMP" + LTrim(Str(ncont)) + ".DBF"
   enddo
   carquivo[1]:= {"PROD", "C", 5, 0}
   carquivo[2]:= {"DESC", "C", 35, 0}
   carquivo[3]:= {"ESTO", "N", 6, 2}
   carquivo[4]:= {"VEND", "N", 12, 2}
   carquivo[5]:= {"BONI", "N", 4, 2}
   carquivo[6]:= {"ESTODEV", "N", 6, 2}
   cprod(dbcreate, carquivo)
   select 1
   use (dbcreate) exclusive
   do while (lcontrole)
      @ nlinha + 0, ncoluna + 1 say "Cliente"
      @ nlinha + 0, ncoluna + 48 say "Data do Acerto"
      @ nlinha + 1, ncoluna + 1 say "Vendedor"
      @ nlinha + 2, ncoluna + 1 say "Observacao"
      @ nlinha + 0, ncoluna + 12 get nCodCli picture "99999" valid ;
         codclicons(ncodcli)
      @ nlinha + 0, ncoluna + 68 get dDt_Act valid ddt_act != Nil
      @ nlinha + 1, ncoluna + 12 get nCodVend picture "99999" valid ;
         codfuncons(ncodvend)
      @ nlinha + 2, ncoluna + 12 get cObservac
      read
      if (LastKey() == K_ESC)
         nresp:= alert("Deseja abandonar pedido de ConsignaÆo?", vet)
         if (nresp == 2)
            loop
         else
            lcontrole:= .F.
            loop
         endif
      endif
      select 1
      append blank
      cproduto:= Space(5)
      private camp1[4], camp3[4], camp4[4]
      camp1:= {"PROD", "DESC", "ESTO", "VEND"}
      camp3:= {"99999", "@!", "999.99", "99,999,999.99"}
      camp4:= {"Produto", "Descrio", "Quantidade", "Valor"}
      dbedit(nlinha + 3, ncoluna + 2, nlinha + 15, ncoluna + 75, ;
         camp1, "FUNC272", camp3, camp4, "ÂÄ", "³", "ÁÄ", "")
      DBEval({|| dbDelete()}, {|| prod = "     "}, Nil, Nil, Nil, .F.)
      pack
      if (LastRec() == 0)
         close
         lcontrole:= .F.
         loop
      endif
      if (gravacons())
         vias(observacao)
      endif
      lcontrole:= .F.
   enddo
   close databases
   select 1
   close format
   impritrans(dbcreate)
   RestScreen(0, 0, 24, 79, ctela)
   set color to (ccor)
   return Nil

********************************
procedure CRIAARQ275

   ncont:= 1
   dbcreate:= "TEMP" + LTrim(Str(ncont)) + ".DBF"
   do while (file(dbcreate))
      ncont++
      dbcreate:= "TEMP" + LTrim(Str(ncont)) + ".DBF"
   enddo
   carquivo[1]:= {"Tipo", "C", 2, 0}
   carquivo[2]:= {"NumDocto", "C", 10, 0}
   carquivo[3]:= {"Vencto", "D", 8, 0}
   carquivo[4]:= {"Valor", "N", 12, 2}
   carquivo[5]:= {"OBS", "C", 40, 0}
   cprod(dbcreate, carquivo)

********************************
function GRAVACONS

   if (conflinha("Confirma este Pedido", 23, 2))
      close databases
      select 1
      close format
      mostrar("**** Gravando ****")
      if (!abredbf("CLIENTES"))
         return .F.
      endif
      set index to CLIENTE1, CLIENTE3
      seek ncodcli
      if (Found())
         if (!bloqueia())
            return .F.
         endif
         replace dt_acerto with ddt_act
      endif
      nvaltot:= 0
      close
      use Empresa alias Emp shared
      observacao:= notafiscal->consigna + 1
      ddataped:= Date()
      if (!bloqueia())
         return .F.
      endif
      replace consigna with observacao
      cped:= "Numero do Pedido:" + Str(observacao, 8)
      close
      select 1
      use (dbcreate) exclusive
      goto top
      do while (!EOF())
         nvaltot:= nvaltot + esto * vend
         skip 
      enddo
      close databases
      select 1
      close format
      if (!abredbf("CONSIGNA"))
         return .F.
      endif
      set index to Consign1, Consign2, Consign3
      select 1
      if (!adiciona())
         return .F.
      endif
      if (!bloqueia())
         return .F.
      endif
      replace valor_tot with nvaltot
      replace numero with observacao
      replace cliente with ncodcli
      replace data with ddataped
      replace vendedor with ncodvend
      replace impricons with cobservac
      close
      select 2
      if (!abredbf("CON_MAT", "CON_MAT.NTX"))
         return .F.
      endif
      select 3
      if (!abredbf("MAT_CONS"))
         return .F.
      endif
      set index to Mat_Con1, Mat_Con2, Mat_Con3
      select 4
      if (!abredbf(dbcreate))
         return .F.
      endif
      select 5
      if (!abredbf("PRODUTOS", "PRODUTO1.NTX"))
         return .F.
      endif
      select 4
      goto top
      do while (!EOF())
         nquanti:= prod
         nesto:= esto
         fonecomp:= vend
         select 5
         seek nquanti
         if (Found())
            if (!bloqueia())
               return .F.
            endif
            if (cbxestoq = "S")
               replace estoque with estoque - nesto
            endif
         endif
         select 2
         append blank
         if (RLock())
            replace numero_ped with observacao
            replace codigo_mat with nquanti
            replace quantidade with nesto
            replace valor with fonecomp
         endif
         select 3
         chave:= Str(ncodcli, 5) + nquanti
         set order to 2
         seek chave
         if (!Found())
            if (!adiciona())
               return .F.
            endif
            if (!bloqueia())
               return .F.
            endif
            replace cliente with ncodcli
            replace codigo_mat with nquanti
            replace quantidade with nesto
            replace valor with fonecomp
         else
            if (!bloqueia())
               return .F.
            endif
            replace quantidade with quantidade + nesto
            replace valor with fonecomp
         endif
         select 4
         skip 
      enddo
      return .T.
   endif
   return .F.

********************************
procedure QSR312

   private ncodigo, ddtfim, dbclearrel, crecpag, impvid, nlinha, ;
      ncoluna, ccor, ctela, valpess
   private lcontrole, ncont, v1[5], v2[5], v3[5], ddtinicio[5], vet[2]
   set escape on
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   cnome:= Space(20)
   csobre:= Space(20)
   cpessoa:= Space(1)
   ccor:= SetColor()
   ncont:= 0
   lcontrole:= .T.
   nlinha:= 10
   ncoluna:= 19
   ctela:= SaveScreen(0, 0, 24, 79)
   lcontrole:= .T.
   vet[1]:= "Sim"
   vet[2]:= "NÆo"
   do while (lcontrole)
      processand(.T.)
      if (!abredbf("FORNECED", "FORNECE2.NTX"))
         loop
      endif
      v1:= {"Codigo_For", "Nome", "Pessoa", "Telefone", "Cgc"}
      v2:= {"", "", "", "", ""}
      v3:= {"Codigo", "Nome do Fornecedor", "Pes", "Telefone", ;
         "C.G.C."}
      ddtinicio:= {1, 1, 1, 1, 1}
      ccoluna:= " Consulta de Fornecedores "
      consulta("Forneced", 3, 1, 21, 78, v1, v2, v3, ddtinicio, ;
         "PesConFor", ccoluna)
      lcontrole:= .F.
   enddo
   close
   set color to (ccor)
   RestScreen(0, 0, 24, 79, ctela)
   return

********************************
function FUNC272

   parameters mode, counter
   cpesquisa:= {"Produtos", "Produto2", "CODIGO", "cProduto"}
   ccampos:= {"DESCRICAO", "VALOR", "ESTOQUE", "DESCRICAO", "VALOR", ;
      "ESTOQUE"}
   setcursor(1)
   ccor1:= SetColor()
   set color to (corlinmenu)
   lin:= Row()
   @ 23,  0 clear to 23, 70
   @ lin,  0 say ""
   do case
   case mode = 0
      if (Deleted())
         set color to (corlinmenu)
         @ 23, 30 say "DELETADO"
      else
         @ 23, 30 say Replicate(" ", 9)
      endif
      set color to (ccor1)
      return 1
   case mode = 1
      set color to (corlinmenu)
      @ 23, 30 say "Este e o primeiro iten"
      InKey(0.5)
      @ 23, 30 say Replicate(" ", 30)
      set color to (ccor1)
      return 1
   case mode = 2
      set color to (corlinmenu)
      @ 23, 30 say "Este e o ultimo iten"
      InKey(0.5)
      @ 23, 30 clear to 23, 52
      set color to (ccor1)
      return 1
   case mode = 3
      append blank
      InKey(1)
      return 2
   case LastKey() = K_INS
      rg:= RecNo()
      append blank
      goto top
      goto rg
      keyboard Replicate(Chr(24), LastRec() - RecNo())
      @ 23, 30 say Replicate(" ", 20)
      return 2
   case LastKey() = K_ESC
      return 0
   case LastKey() = K_DEL
      nresp:= alert("Exclui esse item ?", vet)
      if (nresp == 1)
         ntotquanti:= ntotquanti - esto
         ntotvalor:= ntotvalor - vend * esto
         @ nlinha + 16, ncoluna + 49 say ntotquanti picture "999.99"
         @ nlinha + 16, ncoluna + 63 say ntotvalor picture ;
            "999,999.99"
         delete
         pack
         return 2
      endif
   otherwise
      set color to (corfordado)
      if (prod != " ")
         return 2
      endif
      lin:= Row()
      if (LastKey() != K_ENTER)
         cproduto:= Chr(LastKey()) + Replicate(" ", 5 - ;
            Len(Chr(LastKey())))
         keyboard Chr(4)
      else
         keyboard Chr(13)
      endif
      @ lin, ncoluna + 5 get cProduto picture "99999" valid ;
         conscodest(cproduto)
      read
      @ lin, ncoluna + 49 get ESTO picture "999.99" valid esto > 0
      @ lin, ncoluna + 63 get VEND picture "999,999.99" valid vend > 0
      read
      ntotquanti:= ntotquanti + esto
      ntotvalor:= ntotvalor + vend * esto
      @ nlinha + 16, ncoluna + 49 say ntotquanti picture "999.99"
      @ nlinha + 16, ncoluna + 63 say ntotvalor picture "999,999.99"
      set color to (ccor1)
      return 2
   endcase

********************************
function PESCONEST

   private ccodigo, ngrupo, cdesc, clocal, nestoque, dinicio, ;
      nestmin, nestmax, nloja0
   private nvlrvend, ddatacomp, npespec, nvlrpraz, pesq15i
   nlinha:= 4
   tela11i:= nlinha + 13
   ncoluna:= 9
   ctel2:= SaveScreen(0, 0, 24, 79)
   ccor:= SetColor()
   cmarca:= Space(15)
   vet[1]:= "Sim"
   vet[2]:= "Nao"
   janela(nlinha, ncoluna, tela11i, ncoluna + 68, ;
      "ZOOM do Cadastro de Produtos")
   nlinha++
   ccodigo:= codigo
   ccodfor:= codigo_for
   ngrupo:= grupo
   cdesc:= descricao
   clocal:= nct
   nestmin:= estoque
   nestmax:= est_maximo
   nloja0:= valor_cust
   nvlrvend:= valor_ultc
   ddatacomp:= valor
   nmargpro:= data_ultc
   npespec:= peso
   nvlrpraz:= margempro
   gercod15i:= qsr15a
   cmarca:= marca
   @ nlinha + 1, ncoluna + 2 get cCodigo picture "XXXXX"
   local()
   valgrupo(ngrupo)
   clear gets
   do while (lcontrole)
      ntecla:= InKey(0)
      if (ntecla == 27)
         lcontrole:= .F.
      endif
   enddo
   lcontrole:= .T.
   set color to (ccor)
   RestScreen(0, 0, 24, 79, ctel2)
   return Nil

********************************
function QSR273

   public ncodcli
   private carquivo[6, 4], v1[2], v2[2], v3[2]
   private ncodvend, observacao, ddataped, nvaltot
   private ccor, ctela, ncont, nlinha, ncoluna, vet[2], cnomcli, ;
      cnomvend
   private lcontrole, dbcreate, ncont, ntotquanti, ntotvalor, ;
      nquantitot
   set key K_F10 to pesq272
   set escape on
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   nlinha:= 3
   ncoluna:= 1
   ntotquanti:= 0
   nquantitot:= 0
   ntotvalor:= 0
   cproduto:= 0
   observacao:= 0
   ddataped:= CToD("  /  /  ")
   ncodvend:= 0
   ncodcli:= 0
   nvaltot:= 0
   lcontrole:= .T.
   vet[1]:= "Sim"
   vet[2]:= "Nao"
   ctela:= SaveScreen(0, 0, 24, 79)
   nloja:= 1
   janela(nlinha, ncoluna, nlinha + 18, ncoluna + 77, ;
      " Incluso de Pedidos de Devolucao ")
   nlinha++
   ncont:= 1
   dbcreate:= "TEMP" + LTrim(Str(ncont)) + ".DBF"
   do while (file(dbcreate))
      ncont++
      dbcreate:= "TEMP" + LTrim(Str(ncont)) + ".DBF"
   enddo
   carquivo[1]:= {"PROD", "C", 5, 0}
   carquivo[2]:= {"DESC", "C", 35, 0}
   carquivo[3]:= {"ESTO", "N", 6, 2}
   carquivo[4]:= {"VEND", "N", 12, 2}
   carquivo[5]:= {"BONI", "N", 4, 2}
   carquivo[6]:= {"ESTODEV", "N", 6, 2}
   cprod(dbcreate, carquivo)
   do while (lcontrole)
      @ nlinha + 0, ncoluna + 1 say "Cliente"
      @ nlinha + 1, ncoluna + 1 say "Vendedor "
      @ nlinha + 0, ncoluna + 10 get nCodCli picture "99999" valid ;
         codclicons(ncodcli)
      @ nlinha + 1, ncoluna + 10 get nCodVend picture "99999" valid ;
         codfuncons(ncodvend)
      read
      if (sai())
         loop
      endif
      select 1
      if (!abredbf("MAT_CONS"))
         loop
      endif
      set index to MAT_CON1, MAT_CON2, MAT_CON3
      seek ncodcli
      if (!Found())
         alert("*** Cliente nao tem nenhuma Mercadoria Consiegnada ***")
         lcontrole:= .F.
         loop
      endif
      select 2
      if (!abredbf("PRODUTOS"))
         loop
      endif
      set index to PRODUTO1, PRODUTO2
      select 3
      use (dbcreate)
      select Mat_Cons
      do while (!EOF() .AND. cliente == ncodcli)
         cpro:= codigo_mat
         nqua:= quantidade
         nval:= valor
         nquantitot:= nquantitot + quantidade
         select Produtos
         seek cpro
         if (Found())
            cdesc:= descricao
         else
            cdesc:= "*** Produto nao cadastrado *** "
         endif
         select 3
         if (!adiciona())
            return .F.
         endif
         if (!bloqueia())
            return .F.
         endif
         replace prod with cpro
         replace esto with nqua
         replace vend with nval
         replace desc with cdesc
         select Mat_Cons
         skip 
      enddo
      close databases
      select 1
      close format
      ndevol:= 0
      private camp1[4], camp3[4], camp4[4]
      camp1:= {"Prod", "Desc", "Esto", "Estodev"}
      camp3:= {"99999", "@!", "999.99", "99,999,999.99"}
      camp4:= {"Produto", "Descrio ", " Quantidade ", ;
         "    Devoluo "}
      select 3
      use (dbcreate)
      goto top
      ccor1:= SetColor()
      set color to (cortitfor)
      @ nlinha + 16, ncoluna + 48 say nquantitot picture "99,999.99"
      set color to (ccor1)
      dbedit(nlinha + 3, ncoluna + 2, nlinha + 15, ncoluna + 75, ;
         camp1, "FUNC273", camp3, camp4, "ÂÄ", "³", "ÁÄ", "")
      if (gravadev())
         imprinf(observacao)
      endif
      lcontrole:= .F.
   enddo
   close databases
   select 1
   close format
   impritrans(dbcreate)
   RestScreen(0, 0, 24, 79, ctela)
   set color to (ccor)
   return Nil

********************************
function PESCONOR

   local Local1, Local2, Local3, Local4, Local5, Local6, Local7, ;
      Local8, Local9, Local10, Local11, Local12, Local13, Local14
   private vetor1[4], vetor2[4], vetor3[4], vetor4[4]
   Local9:= 7
   Local10:= 19
   Local13:= SetColor()
   Local11:= 0
   Local12:= .T.
   observacao:= numero
   cchave:= Str(nloja, 2) + Str(numero, 5)
   ger2314(cchave)
   close
   select 2
   use (carq2)
   vetor1:= {"Codigo_Mat", "Descricao", "Quantidade", "Valor"}
   vetor2:= {"", "", "", "", ""}
   vetor3:= {"Codigo", "Descricao", "Quantidade", "Valor"}
   vetor4:= {2, 2, 2, 2}
   ccoluna:= " Consultas de Produtos de Pedidos "
   consped(Nil, Local9, 1, Local9 + 11, Local10 + 59, vetor1, ;
      vetor2, vetor3, vetor4, ccoluna)
   select 1
   set color to (Local13)
   keyboard " "
   return Nil

********************************
function GER2314(Arg1)

   select 3
   if (!abredbf("ORC_MAT", "ORC_MAT"))
      return .F.
   endif
   select 4
   if (!abredbf("Produtos", "Produto1.NTX"))
      return .F.
   endif
   select 2
   use (carq2)
   zap
   select 3
   seek Arg1
   if (Found())
      do while (Arg1 = Str(loja, 2) + Str(numero_ped, 5) .AND. !EOF())
         ccodigo:= codigo_mat
         nquant:= quantidade
         cdebcred:= valor
         select 4
         seek ccodigo
         if (Found())
            cdesc:= descricao
         else
            cdesc:= "Referencia Nao Cadastrada "
         endif
         select 2
         if (!adiciona())
            loop
         endif
         replace codigo_mat with ccodigo
         replace quantidade with nquant
         replace valor with cdebcred
         replace descricao with cdesc
         select 3
         skip 
         nlinha++
      enddo
   endif
   select 3
   close
   select 4
   close
   return

********************************
function GRAVADEV

   if (conflinha("Confirma esta devolucao?", 23, 2))
      mostrar("**** Gravando ****")
      nvaltot:= 0
      if (cautoped == "S")
         use Empresa alias Emp shared
         observacao:= notafiscal->devolucao + 1
         ddataped:= Date()
         if (!bloqueia())
            return .F.
         endif
         replace devolucao with observacao
         close
      endif
      cped:= "Numero do Pedido:" + Str(observacao, 8)
      select 1
      if (!abredbf("DEVOLUCA"))
         return .F.
      endif
      set index to DEVOLUC1, DEVOLUC2, DEVOLUC3
      select 3
      use (dbcreate)
      goto top
      do while (!EOF())
         nvaltot:= nvaltot + estodev * vend
         skip 
      enddo
      select 1
      if (!adiciona())
         return .F.
      endif
      if (!bloqueia())
         return .F.
      endif
      replace numero with observacao
      replace cliente with ncodcli
      replace valor_tot with nvaltot
      replace data with ddataped
      replace vendedor with ncodvend
      unlock
      select 2
      if (!abredbf("DEV_MAT", "DEV_MAT.NTX"))
         return .F.
      endif
      select 4
      if (!abredbf("MAT_CONS"))
         return .F.
      endif
      set index to MAT_CON2, MAT_CON1, MAT_CON3
      select 5
      if (!abredbf("PRODUTOS", "PRODUTO1.NTX"))
         return .F.
      endif
      i:= 0
      lin:= 5
      npt:= 0
      vtt:= 0
      vlr:= 0
      select 3
      goto top
      do while (!EOF())
         if (estodev != 0)
            t_prod:= prod
            t_esto:= esto
            t_vend:= vend
            t_estodev:= estodev
            t_desc:= desc
            select 5
            seek t_prod
            if (Found())
               if (!bloqueia())
                  return .F.
               endif
               replace estoque with estoque + t_estodev
            endif
            select 2
            if (i == 0)
               if (!adiciona())
                  return .F.
               endif
               if (!bloqueia())
                  return .F.
               endif
               replace numero_ped with observacao
               replace codigo_mat with t_prod
               replace quantidade with t_estodev
               replace valor with t_vend
            endif
            npt:= t_estodev * t_vend
            vlr:= vlr + npt
            select 4
            chave:= Str(ncodcli, 5) + t_prod
            seek chave
            if (!Found())
               alert("ATENCAO!; Erro na leitura de Registro.; Operao ser  cancelada.;" ;
                  + Str(procline()))
               lcontrole:= .F.
               return .F.
            endif
            if (t_estodev == mat_cons->quantidade)
               if (!bloqueia())
                  return .F.
               endif
               delete
            else
               if (!bloqueia())
                  return .F.
               endif
               replace quantidade with quantidade - t_estodev
            endif
         endif
         select 3
         skip 
      enddo
   else
      return .F.
   endif
   return .T.

********************************
function VALPEDFORM(Arg1)

   public nvalped, con_rev, ncodcli, con_rev, nvalped, cnumdoc, ;
      nvalortit, cformpgto
   select 11
   if (!abredbf("PEDIDOS", "PEDIDOS1"))
   else
      seek Arg1
      if (!Found())
         alert("Pedido nao encontrado")
         close
         return .F.
      elseif (conf_pgto == "S")
         alert("J  foi incluso as formas de pagamento desse pedido.")
         close
         return .F.
      endif
      ncodcli:= cliente
      con_rev:= data
      nvalped:= valor_tot
      cnumdoc:= valor_tot
      nvalortit:= data
      cformpgto:= form_pgto
      ncomissao:= comissao
      ncod1:= Str(ncodcli, 5)
      nporcomis:= comissao / valor_tot * 100
      select 12
      if (!abredbf("CLIENTES", "CLIENTE1"))
         return .F.
      endif
      if (ncodcli != 1)
         seek ncodcli
         if (Found())
            @ nlinha + 3, ncoluna + 2 say Str(ncodcli, ;
               Len(LTrim(ncod1))) + " " + clientes->nome_cli
         else
            @ nlinha + 3, ncoluna + 2 say "Cliente nao cadastrado"
         endif
      else
         @ nlinha + 3, ncoluna + 2 say pedidos->nome_cli
      endif
      select Pedidos
      nped:= Arg1
      @ nlinha + 1, ncoluna + 10 say data
      @ nlinha + 1, ncoluna + 18 say valor_tot
      close databases
      select 1
      close format
      return .T.
   endif

********************************
function QSR274

   public ndesc, nacresc, ddataultc
   private carquivo[5, 4], v1[2], v2[2], v3[2], nnoped
   private ncodcli, ncodvend, observacao, ddataped, nvaltot
   private ccor, ctela, ncont, nlinha, ncoluna, vet[2], cnomcli, ;
      cnomvend, nloja
   private lcontrole, dbcreate, ncont, ntotquanti, ntotvalor, ;
      ntotpraz, nacresc
   private nporcdesc, nporccomis
   set key K_F10 to pesq272
   set escape on
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   nlinha:= 3
   ncoluna:= 1
   nresp:= 0
   nnoped:= .F.
   ntotquanti:= 0
   ntotpraz:= 0
   ndesc:= 0
   nacresc:= 0
   nporcdesc:= 0
   ntotvalor:= 0
   ddataultc:= Space(15)
   cproduto:= 0
   observacao:= 0
   ddataped:= CToD("  /  /  ")
   ncodvend:= 0
   ncodcli:= 0
   nporccomis:= 0
   nvaltot:= 0
   lcontrole:= .T.
   nloja:= 1
   cnomcli:= ""
   ccgc:= ""
   cinsc:= ""
   nloja:= 1
   vet[1]:= "Sim"
   vet[2]:= "Nao"
   ctela:= SaveScreen(0, 0, 24, 79)
   janela(nlinha, ncoluna, nlinha + 18, ncoluna + 77, ;
      " Acerto de Consignacao ")
   nlinha++
   ncont:= 1
   dbcreate:= "TEMP" + LTrim(Str(ncont)) + ".DBF"
   do while (file(dbcreate))
      ncont++
      dbcreate:= "TEMP" + LTrim(Str(ncont)) + ".DBF"
   enddo
   carquivo[1]:= {"PROD", "C", 5, 0}
   carquivo[2]:= {"DESC", "C", 35, 0}
   carquivo[3]:= {"ESTO", "N", 6, 2}
   carquivo[4]:= {"VEND", "N", 12, 2}
   carquivo[5]:= {"VL_CUST", "N", 12, 2}
   cprod(dbcreate, carquivo)
   select 1
   use (dbcreate)
   do while (lcontrole)
      @ nlinha + 0, ncoluna + 1 say "Cliente"
      @ nlinha + 1, ncoluna + 1 say "Vendedor "
      @ nlinha + 0, ncoluna + 10 get nCodCli picture "99999" valid ;
         codclicons(ncodcli)
      @ nlinha + 1, ncoluna + 10 get nCodVend picture "99999" valid ;
         codfuncons(ncodvend)
      read
      if (cdesc_porc == "S")
         @ nlinha + 16,  2 say "Desconto " get nPorcDesc picture ;
            "99.99"
         read
      endif
      if (sai())
         loop
      endif
      select 2
      if (!abredbf("MAT_CONS", "MAT_CON1.NTX"))
         return .F.
      endif
      select 3
      if (!abredbf("PRODUTOS", "PRODUTO1.NTX"))
         return .F.
      endif
      select 2
      seek ncodcli
      if (!Found())
         alert("ATENO !; Cliente no tem nenhuma Mercadoria Consignada.")
         lcontrole:= .F.
         loop
      endif
      nvaltot:= 0
      do while (!EOF() .AND. cliente == ncodcli)
         nvaltot:= nvaltot + valor * quantidade
         ntotquanti:= ntotquanti + quantidade
         cpro:= codigo_mat
         nqua:= quantidade
         nval:= valor
         select 3
         seek cpro
         if (Found())
            cdesc:= descricao
            ncust:= valor_ultc
         else
            cdesc:= "**** PRODUTO NAO CADASTRADO **** "
            ncust:= 0
         endif
         select 1
         append blank
         replace prod with cpro
         replace esto with nqua
         replace vend with nval
         replace desc with cdesc
         replace vl_cust with ncust
         select 2
         skip 
      enddo
      select 1
      cproduto:= Space(5)
      ccor1:= SetColor()
      set color to (cortitfor)
      @ nlinha + 16, ncoluna + 52 say ntotquanti picture "999.99"
      @ nlinha + 16, ncoluna + 63 say nvaltot
      set color to (ccor1)
      private camp1[4], camp3[4], camp4[4]
      camp1:= {"PROD", "DESC", "ESTO", "VEND"}
      camp3:= {"XXXXX", "@!", "999.99", "999,999.99"}
      camp4:= {"Codigo", "Descrio ", "Quant", "Valor"}
      goto top
      dbedit(nlinha + 3, ncoluna + 2, nlinha + 15, ncoluna + 75, ;
         camp1, "FUNC271", camp3, camp4, "ÂÄ", "³", "ÁÄ", "")
      DBEval({|| dbDelete()}, {|| prod = "     "}, Nil, Nil, Nil, .F.)
      pack
      if (LastRec() == 0)
         close
         lcontrole:= .F.
         loop
      endif
      if (gravaact())
         if (cnf = "O")
            impriped(Str(nloja, 2) + Str(observacao, 5), observacao)
         elseif (cnf = "N")
            lpagina(Str(nloja, 2) + Str(observacao, 5), observacao)
         endif
         nnoped:= .T.
      endif
      lcontrole:= .F.
   enddo
   close databases
   select 1
   close format
   impritrans(dbcreate)
   RestScreen(0, 0, 24, 79, ctela)
   set color to (ccor)
   if (nnoped .AND. cchpgto == "S")
      lresp(@observacao, @nloja)
   endif
   if (cchpgto != "S" .AND. LastKey() != K_ESC)
      opcao:= 1
      keyboard Chr(13)
   endif
   return Nil

********************************
procedure QSR315

   private ncodigo, nlinha, ncoluna, ccor, ctela, valpess, cnome, ;
      csobre
   private lcontrole, ncont, v1[2], v2[2], v3[2], ddtinicio[2], ;
      vet[2], ngrupo
   set escape on
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   ccor:= SetColor()
   ncont:= 0
   lcontrole:= .T.
   nlinha:= 10
   ncoluna:= 19
   ctela:= SaveScreen(0, 0, 24, 79)
   lcontrole:= .T.
   vet[1]:= "Sim"
   vet[2]:= "NÆo"
   do while (lcontrole)
      if (!abredbf("LOCALIZA", "LOCALIZ1.NTX"))
         loop
      endif
      v1:= {"Codigo_Loc", "Descricao"}
      v2:= {"99999", "@!"}
      v3:= {"Codigo", "Descricao"}
      ddtinicio:= {1, 1}
      ccoluna:= " Consulta de Localizacoes "
      consulta("Localiza", 3, 10, 21, 68, v1, v2, v3, ddtinicio, ;
         "NULO", ccoluna)
      lcontrole:= .F.
   enddo
   close
   set color to (ccor)
   RestScreen(0, 0, 24, 79, ctela)
   return

********************************
function GRAVAACT

   public cavista
   if (conflinha("Confirma este Pedido", 23, 2))
      gravaact2()
      mostrar("**** Gravando ****")
      select 1
      if (!abredbf("CLIENTES"))
         return .F.
      endif
      set index to CLIENTE1, CLIENTE3
      seek ncodcli
      if (Found())
         if (!bloqueia())
            return .F.
         endif
         replace dt_acerto with CToD("  /  /  ")
         unlock
      endif
      close
      set color to (corlinmenu)
      @ 23,  0 say Replicate(" ", 80)
      nvaltot:= 0
      if (!abredbf("EMPRESA"))
         return .F.
      endif
      if (cautoped == "S")
         if (ccasaforte == "S")
            if (cnf = "N")
               observacao:= nchavereg + 1
               if (!bloqueia())
                  return .F.
               endif
               replace nchavereg with nchavereg + 1
            elseif (cnf = "O")
               npedido:= orcamento + 1
               observacao:= Val(Replicate("9", 5 - ;
                  Len(LTrim(Str(npedido)))) + Str(npedido, ;
                  Len(LTrim(Str(npedido)))))
               if (!bloqueia())
                  return .F.
               endif
               replace orcamento with orcamento + 1
            endif
         else
            observacao:= nchavereg + 1
            if (!bloqueia())
               return .F.
            endif
            replace nchavereg with nchavereg + 1
         endif
      endif
      unlock
      close
      select 1
      use (dbcreate) exclusive
      goto top
      do while (!EOF())
         nvaltot:= nvaltot + esto * vend
         skip 
      enddo
      nvaltot:= nvaltot + nacresc - ndesc
      close databases
      select 1
      close format
      if (ncodcli != 1)
         select 1
         if (!abredbf("CLIENTES", "CLIENTE1.NTX"))
            return .F.
         endif
         seek ncodcli
         if (Found())
            cnomcli:= nome_cli
         else
            cnomcli:= " "
         endif
      endif
      select 1
      if (!abredbf("PEDIDOS"))
         return .F.
      endif
      set index to PEDIDOS1, PEDIDOS2, PEDIDOS3
      select 1
      if (!adiciona())
         return .F.
      endif
      if (!bloqueia())
         return .F.
      endif
      replace numero with observacao
      replace cliente with ncodcli
      replace data with ddataped
      replace vendedor with ncodvend
      replace valor_tot with nvaltot
      replace nome_cli with cnomcli
      replace cgc with ccgc
      replace insc with cinsc
      replace acrescimo with nacresc
      replace desconto with ndesc
      replace emp with cconrev
      replace impricons with ddataultc
      replace loja with nloja
      replace comissao with nporccomis
      replace form_pgto with ccond
      close
      select 2
      if (!abredbf("PED_MAT", "PED_MAT.NTX"))
         return .F.
      endif
      select 3
      use (dbcreate)
      select 4
      if (!abredbf("PRODUTOS", "PRODUTO1.NTX"))
         return .F.
      endif
      select 5
      if (!abredbf("MAT_CONS"))
         return .F.
      endif
      set index to MAT_CON2, MAT_CON1, MAT_CON3
      select 3
      goto top
      do while (!EOF())
         nquanti:= prod
         cest:= esto
         fonecomp:= vend
         ncusto:= vl_cust
         select 2
         if (!adiciona())
            return .F.
         endif
         if (!bloqueia())
            return .F.
         endif
         replace numero_ped with observacao
         replace codigo_mat with nquanti
         replace quantidade with cest
         replace valor with fonecomp
         replace loja with nloja
         replace data_ultc with ncusto
         unlock
         select 5
         chave:= Str(ncodcli, 5) + nquanti
         seek chave
         if (!Found())
            alert("ATENO!;Ocorreu um erro de compartilhamento;Operacao ser  cancelada")
            return .F.
         endif
         if (!bloqueia())
            return .F.
         endif
         delete
         select 4
         seek nquanti
         if (!bloqueia())
            return .F.
         endif
         if (cbxestoq != "S" .AND. Found())
            replace estoque with estoque - cest
         endif
         select 3
         skip 
      enddo
      select 1
      if (!abredbf("CLIENTES", "CLIENTE1.NTX"))
         return .F.
      endif
      seek ncodcli
      if (Found())
         if (!bloqueia())
            return .F.
         endif
         if (Empty(npc_ul_cli))
            replace npc_ul_cli with ddataped
         endif
         replace dt_1ac_cli with ddataped
         replace limitc_cli with ntotquanti
         replace conta_bco with nvaltot
         replace vendedor with ncodvend
      endif
      return .T.
   endif
   set color to (corfordado)
   return .F.

********************************
function GRAVAACT2

   public cnf, ccond, cconrev
   vet[1]:= "Sim"
   vet[2]:= "No"
   nlin1:= 4
   ncol1:= 5
   nlinha:= 4
   ncoluna:= 5
   ctel2:= SaveScreen(nlin1, ncol1, nlin1 + 8, ncol1 + 70)
   lcontrole:= .T.
   cnf:= "O"
   ccond:= "V"
   cconrev:= cpadrcons
   set color to (corfor)
   @ nlinha, ncoluna clear to nlinha + 8, ncoluna + 70
   @ nlinha, ncoluna to nlinha + 8, ncoluna + 70
   set color to (corfordado)
   nlinha++
   @ nlinha + 0, ncoluna + 1 say ;
      "Consumidor/Revendedor/Atacado (C/R/A) " get cConRev picture ;
      "!" valid cconrev $ "CRA"
   read
   nlinha++
   ddataped:= Date()
   @ nlinha + 0, ncoluna + 1 say "Data"
   @ nlinha + 0, ncoluna + 10 get dDataPed
   @ nlinha + 0, ncoluna + 30 say "Pedido" get nNoPed picture ;
      "99999" valid valnnoped(Str(nloja, 2) + Str(observacao, 5), ;
      observacao)
   nlinha++
   if (ntipocomis == 2)
      nporccomis:= 0
      @ nlinha + 1, ncoluna + 2 say "Comissao" get nPorcComis ;
         picture "99.99"
   endif
   @ nlinha + 2, ncoluna + 1 say "Desconto " get nDesc picture ;
      "999,999.99"
   @ nlinha + 2, ncoluna + 22 say "Acrescimo " get nAcresc picture ;
      "999,999.99"
   @ nlinha + 2, ncoluna + 45 say "Obs." get cObs
   @ nlinha + 3, ncoluna + 1 say "Orcamento  Nota Fiscal (O/N)   " ;
      get cNf picture "!" valid cnf $ "ON"
   @ nlinha + 4, ncoluna + 1 say "A Vista  ou a Prazo (V/P)      " ;
      get cCond picture "!" valid ccond $ "VP"
   read
   RestScreen(nlin1, ncol1, nlin1 + 8, ncol1 + 70, ctel2)
   return .F.

********************************
function GERTEMP232(Arg1)

   select 3
   if (!abredbf("CONT_MAT", "CON_MAT.NTX"))
      return .F.
   endif
   select 4
   if (!abredbf("PRODUTOS", "PRODUTO1.NTX"))
      return Nil
   endif
   select 2
   use (carq2)
   zap
   select 3
   seek Arg1
   if (Found())
      do while (Arg1 = numero_ped .AND. !EOF())
         ccodigo:= codigo_mat
         nquant:= quantidade
         cdebcred:= valor
         select 4
         seek ccodigo
         if (Found())
            cdesc:= descricao
         else
            cdesc:= "Referencia nao cadastrada "
         endif
         select 2
         if (!adiciona())
            return .F.
         endif
         replace codigo_mat with ccodigo
         replace quantidade with nquant
         replace valor with cdebcred
         replace descricao with cdesc
         select 3
         skip 
         nlinha++
      enddo
   endif
   close databases
   select 1
   close format
   return

********************************
procedure CABEC(Arg1)

   if (Arg1 == 1)
      rodape(nalturafor, .F., 79)
      eject
   endif
   npag++
   @  1,  1 say "" + cnomemp + ""
   @  2,  1 say "Relatorio do Movimento de Caixa" + Replicate(" ", ;
      36) + "Pagina :" + Str(npag, 3)
   @  3,  1 say ccoldata
   @  4,  1 say impcontasa
   if (cresumo = "N")
      @  5,  1 say clinha
   endif
   nlinha:= 6
   if (cimpmat = "S")
      @ nlinha,  9 say ccoluna1
      nlinha++
   endif
   if (cimpform = "S")
      @ nlinha,  9 say tip_doc_ar
      nlinha++
   endif
   @ nlinha,  1 say impcontasa
   nlinha++
   return

********************************
procedure QSR275

   parameters nnumero, lojapara
   private carquivo[5, 4], ncodcli, nnumped, pesq23i, nvalortit, ;
      pagamento, dbcreate
   private cnumdoc, ddataultc, nlinha, ncoluna, vet[2], nresp, ccor, ;
      ncont, lcontrole
   private cformpgto, ddt_venc, ddtvenc, dvencto, cdebcred, ;
      ntotvalor, ncomissao, nporcomis
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   ncodcli:= 0
   pesq23i:= 0
   ddataultc:= Space(40)
   ddt_venc:= Space(2)
   ddtvenc:= Space(10)
   dvencto:= CToD("  /  /  ")
   cdebcred:= 0
   nvalortit:= CToD("  /  /  ")
   ntotvalor:= 0
   vet:= {"Sim", "Nao"}
   nlinha:= 3
   tela11i:= nlinha + 19
   ncoluna:= 1
   ctela:= SaveScreen(0, 0, 24, 79)
   lcontrole:= .T.
   criaarq275()
   janela(nlinha, ncoluna, tela11i, ncoluna + 78, ;
      "Inclusao de Formas de Pagamento")
   nlinha++
   @ nlinha + 0, ncoluna + 2 say "Pedido  Data             Valor"
   @ nlinha + 2, ncoluna + 2 say "Cliente"
   if (nnumero != Nil)
      pesq23i:= nnumero
      keyboard Replicate(Chr(13), 1)
   else
      nloja:= 0
   endif
   nloja:= 1
   do while (lcontrole)
      set color to (corfordado)
      @ nlinha + 1, ncoluna + 2 get nNumPed picture "99999" valid ;
         valpedform(Str(nloja, 2) + Str(pesq23i, 5))
      read
      if (sai())
         loop
      endif
      select 1
      use (dbcreate) exclusive
      zap
      uareatemp:= Select()
      append blank
      ddt_venc:= Space(2)
      private camp1[5], camp3[5], camp4[5]
      camp1:= {"Tipo", "NumDocto", "Vencto", "Valor", "Obs"}
      camp3:= {"!!", "XXXXXXXXXX", "", "9,999,999.99", "@!"}
      camp4:= {"TP", "N§ Docto ", "Vencto", "Valor", "Observacao"}
      dbedit(nlinha + 5, ncoluna + 1, nlinha + 14, ncoluna + 77, ;
         camp1, "FUNC275", camp3, camp4, "ÂÄ", "³", "ÁÄ", "")
      DBEval({|| dbDelete()}, {|| Empty(tipo)}, Nil, Nil, Nil, .F.)
      pack
      if (LastRec() == 0)
         close
         lcontrole:= .F.
         loop
      endif
      if (!conflinha("Confirma Inclusao ?", tela11i, ncoluna + 1))
         loop
      endif
      i:= 1
      select 1
      if (!abredbf(dbcreate))
         loop
      endif
      select 2
      if (!abredbf("ContasAr"))
         loop
      endif
      set index to ContAr1, ContAr2, ContAr3, ContAr4
      select 3
      if (!abredbf("ContasRE"))
         loop
      endif
      set index to ContRe1, ContRe2, ContRe3, ContRe4
      select 1
      goto top
      do while (!EOF() .AND. lcontrole)
         ddt_venc:= tipo
         ddtvenc:= numdocto
         dvencto:= vencto
         cdebcred:= valor
         ddataultc:= obs
         if (cformpgto = "P")
            select ContasAR
            if (!adiciona())
               loop
            endif
            if (!bloqueia())
               loop
            endif
            replace num_doc_ar with ddtvenc
            replace cod_cli_ar with ncodcli
            replace ctipo with ddt_venc
            replace dt_emis_ar with pesq23i
            replace obs_ar with nvalortit
            replace dt_venc_ar with dvencto
            replace val_tit_ar with cdebcred
            replace localiza with Space(40)
            replace loja with nloja
            replace localiza with ddataultc
            replace comissao with cdebcred * nporcomis / 100
         elseif (dvencto = con_rev)
            select ContasRE
            if (!adiciona())
               loop
            endif
            if (!bloqueia())
               loop
            endif
            replace num_doc_re with ddtvenc
            replace cod_cli_re with ncodcli
            replace dt_venc_re with ddt_venc
            replace dt_emis_re with pesq23i
            replace obs_re with nvalortit
            replace val_tit_re with dvencto
            replace dt_rece_re with dvencto
            replace vl_rece_re with cdebcred
            replace ddt_pgto with cdebcred
            replace dt_loc_re with Space(40)
            replace loja with nloja
            replace dt_loc_re with ddataultc
            replace comissao with cdebcred * nporcomis / 100
         else
            select ContasAR
            if (!adiciona())
               loop
            endif
            if (!bloqueia())
               loop
            endif
            replace num_doc_ar with ddtvenc
            replace cod_cli_ar with ncodcli
            replace ctipo with ddt_venc
            replace dt_emis_ar with pesq23i
            replace obs_ar with nvalortit
            replace dt_venc_ar with dvencto
            replace val_tit_ar with cdebcred
            replace localiza with Space(40)
            replace loja with nloja
            replace localiza with ddataultc
            replace comissao with cdebcred * nporcomis / 100
         endif
         select 1
         skip 
      enddo
      close databases
      select 1
      close format
      select 10
      if (!abredbf("PEDIDOS", ;
            "PEDIDOS1.NTX,PEDIDOS2.NTX,PEDIDOS3.NTX"))
         loop
      endif
      seek Str(nloja, 2) + Str(pesq23i, 5)
      if (!Found())
         alert("Pedido nao encontrado")
         close
         lcontrole:= .F.
         loop
      else
         if (!bloqueia())
            loop
         endif
         replace conf_pgto with "S"
      endif
      close
      close databases
      select 1
      close format
      impriped(Str(nloja, 2) + Str(pesq23i, 5), pesq23i)
      ncodcli:= 0
      nvalortit:= CToD("  /  /  ")
      nloja:= 0
      pesq23i:= 0
      ntotvalor:= 0
      ddt_venc:= Space(2)
      ddtvenc:= Space(10)
      dvencto:= CToD("  /  /  ")
      cdebcred:= 0
      nvalortit:= CToD("  /  /  ")
      @ nlinha + 15, ncoluna + 30 say ntotvalor picture "9,999,999.99"
      if (cretorna = "S")
         if (procname(1) = "SIA271")
            opcao:= 1
         elseif (procname(1) = "SIA278")
            opcao:= 8
         endif
         keyboard Chr(13)
         lcontrole:= .F.
      else
         lcontrole:= .T.
      endif
      nlinha:= 6
      ncoluna:= 1
   enddo
   close databases
   select 1
   close format
   impritrans(dbcreate)
   RestScreen(0, 0, 24, 79, ctela)
   set color to (ccor)
   return

********************************
function PESQDOC75(Arg1, Arg2)

   ccor:= SetColor()
   if (!Empty(Arg2))
      select 13
      abredbf("CONTASAR", "CONTAR1")
      seek Arg1
      if (Found())
         alert("Documento j  cadastrado")
         close
         return .F.
      else
         select ContasAR
         close
         select 13
         abredbf("CONTASRE", "CONTRE1")
         seek Arg1
         if (Found())
            alert("Documento j  cadastrado e Baixado !")
            close
            return .F.
         else
            close
            return .T.
         endif
      endif
   else
      return .T.
   endif
   return .F.

********************************
function FUNC275

   parameters mode, counter
   setcursor(1)
   ccor1:= SetColor()
   set color to (corlinmenu)
   lin:= Row()
   @ 23,  0 clear to 23, 70
   @ lin,  0 say ""
   do case
   case mode = 0
      if (Deleted())
         set color to (corlinmenu)
         @ 23, 30 say "DELETADO"
      else
         @ 23, 30 say Replicate(" ", 9)
      endif
      set color to (ccor1)
      return 1
   case mode = 1
      set color to (corlinmenu)
      @ 23, 30 say "Este e o primeiro iten"
      InKey(0.5)
      @ 23, 30 say Replicate(" ", 30)
      set color to (ccor1)
      return 1
   case mode = 2
      set color to (corlinmenu)
      @ 23, 30 say "Este e o ultimo iten"
      InKey(0.5)
      @ 23, 30 clear to 23, 52
      set color to (ccor1)
      return 1
   case mode = 3
      append blank
      InKey(1)
      return 2
   case LastKey() = K_INS
      rg:= RecNo()
      append blank
      goto top
      goto rg
      keyboard Replicate(Chr(24), LastRec() - RecNo())
      @ 23, 30 say Replicate(" ", 20)
      return 2
   case LastKey() = K_ESC
      return 0
   case LastKey() = K_DEL
      nresp:= alert("Exclui esse item ?", vet)
      if (nresp == 1)
         ntotvalor:= ntotvalor - valor
         @ nlinha + 15, ncoluna + 30 say ntotvalor picture ;
            "9,999,999.99"
         delete
         pack
         return 2
      endif
   otherwise
      set color to (corfordado)
      if (tipo != " ")
         return 2
      endif
      lin:= Row()
      ddt_venc:= Chr(LastKey()) + Replicate(" ", 2 - ;
         Len(Chr(LastKey())))
      keyboard Chr(4)
      @ lin, ncoluna + 1 get cTipo picture "@!"
      @ lin, ncoluna + 4 get cNumDoc picture "@!" valid ;
         pesqdoc75(ddtvenc + Str(ncodcli, 5), ddtvenc) .AND. ;
         !Empty(ddtvenc)
      @ lin, ncoluna + 15 get dVencto valid valdataven(dvencto, ;
         con_rev)
      @ lin, ncoluna + 24 get nValor picture "9,999,999.99" valid ;
         cdebcred > 0
      @ lin, ncoluna + 37 get cObs picture "@!"
      read
      select (uareatemp)
      replace tipo with ddt_venc
      replace numdocto with ddtvenc
      replace vencto with dvencto
      replace valor with cdebcred
      replace obs with ddataultc
      ntotvalor:= ntotvalor + valor
      @ nlinha + 15, ncoluna + 24 say ntotvalor picture "9,999,999.99"
      ddt_venc:= Space(2)
      ddtvenc:= Space(10)
      dvencto:= CToD("  /  /  ")
      cdebcred:= 0
      ddataultc:= Space(40)
      set color to (ccor1)
      return 2
   endcase

********************************
function VALPEDEXCL(Arg1)

   public nvalped, con_rev, ncodcli, con_rev, nvalped, cnumdoc, ;
      nvalortit, cformpgto
   if (!abredbf("PEDIDOS", "PEDIDOS1.NTX"))
      return .F.
   endif
   seek Arg1
   if (!Found())
      alert("Pedido nao encontrado")
      close
      return .F.
   endif
   ncodcli:= cliente
   con_rev:= data
   nvalped:= valor_tot
   cnumdoc:= valor_tot
   nvalortit:= data
   cformpgto:= "P"
   ncodvend:= vendedor
   ncod1:= Str(ncodcli, 5)
   nloja:= loja
   ncodcobr:= cobrador
   ncodent:= entregador
   ddtcobr:= dt_cobranc
   ddtent:= dt_entrega
   @ nlinha + 3, ncoluna + 2 say nome_cli
   select 10
   if (!abredbf("FUNCIONA", "FUNCION1.NTX"))
      return .F.
   endif
   seek ncodvend
   if (Found())
      ncod2:= Str(ncodvend, 5)
      @ nlinha + 5, ncoluna + 2 say Str(ncodvend, Len(LTrim(ncod2))) ;
         + " " + qsr23i->nome
   else
      @ nlinha + 5, ncoluna + 2 say "Vendedor nao cadastrado"
   endif
   select Pedidos
   nped:= Arg1
   @ nlinha + 1, ncoluna + 10 say data
   @ nlinha + 1, ncoluna + 18 say valor_tot
   close databases
   select 1
   close format
   return .T.

********************************
procedure QSR276

   private ncodcli, nnumped, pesq23i, nvalortit, pagamento
   private cnumdoc, ddataultc, nlinha, ncoluna, vet[2], nresp, ccor, ;
      ncont, lcontrole
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   ncodcli:= 0
   pesq23i:= 0
   cformpgto:= "P"
   nvalortit:= CToD("  /  /  ")
   ddataultc:= Space(40)
   vet:= {"Sim", "Nao"}
   nlinha:= 4
   tela11i:= nlinha + 13
   ncoluna:= 19
   ctela:= SaveScreen(0, 0, 24, 79)
   lcontrole:= .T.
   nloja:= 1
   janela(nlinha, ncoluna, tela11i, ncoluna + 46, ;
      "Exclusao de Pedidos de Venda")
   nlinha++
   @ nlinha + 2, ncoluna + 2 say "Pedido  Data             Valor"
   @ nlinha + 4, ncoluna + 2 say "Cliente"
   @ nlinha + 6, ncoluna + 2 say "Vendedor(a)"
   do while (lcontrole)
      nlinha:= 7
      ncoluna:= 19
      @ nlinha + 1, ncoluna + 2 get nNumPed picture "99999" valid ;
         valpedexcl(Str(nloja, 2) + Str(pesq23i, 5))
      read
      observacao:= Str(nloja, 2) + Str(pesq23i, 5)
      npedido:= pesq23i
      if (sai())
         loop
      endif
      if (!conflinha("Confirma essa Exclusao ?", tela11i, ncoluna + ;
            1))
         loop
      endif
      if (!abredbf("Pedidos", "Pedidos1.ntx"))
         loop
      endif
      seek observacao
      if (Found())
         if (!bloqueia())
            loop
         endif
         delete
      endif
      close
      select 2
      if (!abredbf("PRODUTOS", "PRODUTO1.NTX"))
         loop
      endif
      select 3
      if (!abredbf("PED_MAT", "PED_MAT.NTX"))
         loop
      endif
      seek observacao
      if (Found())
         do while (loja = nloja .AND. numero_ped = npedido .AND. ;
               !EOF())
            if (!bloqueia())
               loop
            endif
            ccodigo:= codigo_mat
            nvalormat:= quantidade
            delete
            unlock
            skip 
            select Produtos
            seek ccodigo
            if (Found())
               if (!bloqueia())
                  loop
               endif
               replace estoque with estoque + nvalormat
               unlock
            endif
            select Ped_Mat
         enddo
      endif
      close
      select 10
      if (!abredbf("CONTASAR", "CONTAR4.NTX"))
         loop
      endif
      seek observacao
      if (Found())
         do while (dt_emis_ar = npedido .AND. !EOF())
            if (cod_cli_ar = ncodcli)
               if (!bloqueia())
                  loop
               endif
               delete
               unlock
            endif
            skip 
         enddo
      endif
      close
      select 11
      if (!abredbf("CONTASAR", "CONTAR4.NTX"))
         loop
      endif
      seek observacao
      if (Found())
         do while (dt_emis_re = npedido .AND. !EOF())
            if (cod_cli_re = ncodcli)
               if (!bloqueia())
                  loop
               endif
               delete
               unlock
            endif
            skip 
         enddo
      endif
      select 12
      if (!abredbf("NOTA_FIS", "NOTA3.NTX"))
         loop
      endif
      seek observacao
      if (Found())
         do while (nchavereg = pesq23i .AND. !EOF())
            if (codigo_cli = ncodcli)
               if (!bloqueia())
                  loop
               endif
               replace identidade with "C"
               unlock
            endif
            skip 
         enddo
      endif
      if (file("CONT_PED.DBF"))
         select 13
         if (!abredbf("CONT_PED", "CONT_PED.NTX"))
            loop
         endif
         seek observacao
         if (Found())
            do while (numero_ped = pesq23i .AND. !EOF())
               if (codigo_cli = ncodcli)
                  if (!bloqueia())
                     loop
                  endif
                  delete
                  unlock
               endif
               skip 
            enddo
         endif
      endif
      ncodcli:= 0
      pesq23i:= 0
      nvalortit:= CToD("  /  /  ")
   enddo
   close databases
   select 1
   close format
   RestScreen(0, 0, 24, 79, ctela)
   set color to (ccor)
   return

********************************
function QSR277

   public ndesc, ddataultc, ctipo_nota, nloja
   private v1[2], v2[2], v3[2], nnoped
   private ncodcli, ncodvend, observacao, ddataped, nvaltot
   private ccor, ctela, ncont, nlinha, ncoluna, vet[2], cnomcli, ;
      cnomvend
   private lcontrole, dbcreate, ncont, ntotquanti, ntotvalor, ;
      ntotpraz, nacresc
   private nporcdesc, nporccomis, nacudesc, nacuacre, vcod14i, ;
      cproduto
   set escape on
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   ctipo_nota:= "NF"
   nlinha:= 3
   tela11i:= nlinha + 19
   ncoluna:= 1
   nresp:= 0
   nnoped:= .F.
   ntotquanti:= 0
   ntotpraz:= 0
   ndesc:= 0
   nacresc:= 0
   nporcdesc:= 0
   ntotvalor:= 0
   ddataultc:= Space(50)
   cproduto:= Space(5)
   observacao:= 0
   ddataped:= CToD("  /  /  ")
   ncodvend:= 0
   ncodcli:= 0
   nporccomis:= 0
   nvaltot:= 0
   lcontrole:= .T.
   nloja:= 1
   cnomcli:= ""
   ccgc:= ""
   cinsc:= ""
   nnumorc:= 0
   ntotbrtp:= 0
   ntotbrtv:= 0
   nacudesc:= 0
   nacuacre:= 0
   vet:= {"Sim", "Nao"}
   ctela:= SaveScreen(0, 0, 24, 79)
   janela(nlinha, ncoluna, tela11i, ncoluna + 77, ;
      "Inclusao de Pedidos a Faturar")
   nlinha++
   criaarq271()
   do while (lcontrole)
      gravaorc2()
      select 1
      use (dbcreate) exclusive
      if (sai())
         loop
      endif
      cproduto:= Space(5)
      private camp1[7], camp3[7], camp4[7]
      camp1:= {"PROD", "DESC", "TAM", "ESTO", "VEND", "VL_ITEM", ;
         "MARCA"}
      camp3:= {"XXXXX", "@!", "XXX", "99999.99", "999,999.99", ;
         "99999.99", "@!"}
      camp4:= {"Codigo", "Descrio ", "Tam", "Quant", "Valor", ;
         "Vl.Item", "Marca"}
      ncoluna:= 1
      dbedit(nlinha, ncoluna + 1, nlinha + 15, ncoluna + 76, camp1, ;
         "FUNC277", camp3, camp4, "ÂÄ", "³", "ÁÄ", "")
      DBEval({|| dbDelete()}, {|| prod = "     "}, Nil, Nil, Nil, .F.)
      pack
      if (LastRec() == 0)
         close
         lcontrole:= .F.
         loop
      endif
      if (gravaorc())
         if (cnf = "O")
            qsr_func(Str(nloja, 2) + Str(observacao, 5), observacao)
         elseif (cnf = "N")
            lpagina(Str(nloja, 2) + Str(observacao, 5), observacao)
         endif
         nnoped:= .T.
      endif
      lcontrole:= .F.
   enddo
   close databases
   select 1
   close format
   impritrans(dbcreate)
   RestScreen(0, 0, 24, 79, ctela)
   set color to (ccor)
   return Nil

********************************
function PESCONFOR

   private ncodigo, cnome, cpessoa, cendereco, cestado, ccidade, ;
      ctelefone
   private ccep, ddataincl, creg, ccgc, cinsc, ddt_venc, cobs1, ;
      cobs2, nlinha, ncoluna
   private cnomerep, ccpf, lcontrole, ctela, ccor, vet[2], nresp
   ccor:= SetColor()
   nlinha:= 3
   ncoluna:= 1
   lcontrole:= .T.
   vet[1]:= "Sim"
   vet[2]:= "Nao"
   ctel2:= SaveScreen(0, 0, 24, 79)
   ncodigo:= codigo_for
   cnome:= nome
   cpessoa:= fone_bco
   cendereco:= endereco
   cestado:= cidade
   ccidade:= cep
   ctelefone:= ferase
   ccep:= contato
   ddataincl:= telefone
   ccgc:= cgc
   cinsc:= inscricao
   cobs1:= obs1
   cobs2:= obs2
   creg:= pessoa
   ddt_venc:= tipo
   nagnbco:= agn_bco
   vcod13i:= nome_repr
   ctelbco:= nom_ref1
   cendrep:= end_repr
   cbairrep:= bair_repr
   ccidrep:= cid_repr
   cceprep:= cep_repr
   cfonerep:= fone_repr
   cfaxrep:= fax_repr
   cufrep:= uf_repr
   cnombco:= codigo_cc
   ncodcc:= vcodi13a
   janela(nlinha - 1, ncoluna, nlinha + 18, ncoluna + 77, ;
      "ZOOM Do Cadastro de Fornecedores")
   @ nlinha + 1, ncoluna + 2 get nCodigo picture "99999" when .F.
   @ nlinha + 1, ncoluna + 13 get cNome picture "@!" valid bairro()
   @ nlinha + 1, ncoluna + 51 get cPessoa picture "!" valid vcod12a()
   valnom2()
   clear gets
   do while (lcontrole)
      ntecla:= InKey(0)
      if (ntecla == 27)
         lcontrole:= .F.
      endif
   enddo
   lcontrole:= .T.
   set color to (ccor)
   RestScreen(0, 0, 24, 79, ctel2)
   return Nil

********************************
function GRAVAORC

   public cavista
   if (conflinha("Confirma este Pedido ?", 23, 2))
      set color to (corlinmenu)
      @ 23,  0 say Replicate(" ", 80)
      nvaltot:= 0
      mostrar("**** Gravando ****")
      if (!abredbf("EMPRESA"))
         return .T.
      endif
      if (cautoped == "S")
         observacao:= nchavereg + 1
         if (!bloqueia())
            return .F.
         endif
         replace nchavereg with nchavereg + 1
      endif
      close
      select 1
      use (dbcreate) exclusive
      goto top
      goto top
      do while (!EOF())
         nvaltot:= nvaltot + (esto * vend + des_acre)
         skip 
      enddo
      close databases
      select 1
      close format
      if (ncodcli != 1)
         if (!abredbf("CLIENTES", "CLIENTE1.NTX"))
            return .F.
         endif
         seek ncodcli
         if (Found())
            cnomcli:= nome_cli
         else
            cnomcli:= " "
         endif
      endif
      if (!abredbf("Orcament"))
         return .F.
      endif
      set index to Orcamen1, Orcamen2, Orcamen3
      if (!adiciona())
         return .F.
      endif
      if (!bloqueia())
         return .F.
      endif
      replace numero with observacao
      replace cliente with ncodcli
      replace data with ddataped
      replace vendedor with ncodvend
      replace valor_tot with nvaltot
      replace nome_cli with cnomcli
      replace cgc with ccgc
      replace insc with cinsc
      replace acrescimo with nacresc
      replace emp with cconrev
      replace impricons with ddataultc
      replace loja with nloja
      replace form_pgto with ccond
      replace aliqcomis with nporccomis
      if (procname(1) = "QSR271")
         replace int_ext with "I"
      else
         replace int_ext with "E"
      endif
      select 2
      if (!abredbf("ORC_MAT", "ORC_MAT.NTX"))
         return .F.
      endif
      select 3
      if (!abredbf(dbcreate))
         return .F.
      endif
      select 4
      if (!abredbf("Produtos", "Produto1.NTX"))
         return .F.
      endif
      select 5
      if (!abredbf("COMISSAO", "COMIS1.NTX"))
         return .F.
      endif
      select 6
      if (!abredbf("FAT_MAT"))
         return .F.
      endif
      set index to FAT_MAT1, FAT_MAT2, FAT_MAT3
      select 3
      goto top
      do while (!EOF())
         nquanti:= prod
         cest:= esto
         fonecomp:= vend
         naliq4:= aliq1
         nvalcust:= vl_cust
         cdebcred:= esto * vend + des_acre
         ndesc:= des_acre
         ctam:= tam
         select 2
         if (!adiciona())
            loop
         endif
         if (!bloqueia())
            loop
         endif
         replace numero_ped with observacao
         replace codigo_mat with nquanti
         replace quantidade with cest
         replace valor with fonecomp
         replace nvalicm with naliq4
         replace tamanho with ctam
         replace loja with nloja
         replace data_ultc with nvalcust
         select 6
         adiciona()
         bloqueia()
         replace numero_ped with observacao
         replace codigo_mat with nquanti
         replace quantidade with cest
         replace valor with fonecomp
         replace tamanho with ctam
         replace cliente with ncodcli
         unlock
         select 3
         skip 
      enddo
      ncont:= 0
      select 1
      replace desconto with nacudesc
      replace acrescimo with nacuacre
      nacudesc:= 0
      nacuacre:= 0
      return .T.
   endif
   set color to (corfordado)
   return .F.

********************************
procedure QSR314

   private ncodigo, nlinha, ncoluna, ccor, ctela, valpess, cnome, ;
      csobre
   private lcontrole, ncont, vet[2], ngrupo
   set escape on
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   ccor:= SetColor()
   ncont:= 0
   lcontrole:= .T.
   nlinha:= 10
   ncoluna:= 19
   ctela:= SaveScreen(0, 0, 24, 79)
   lcontrole:= .T.
   vet[1]:= "Sim"
   vet[2]:= "NÆo"
   do while (lcontrole)
      if (!abredbf("PRODUTOS", "PRODUTO2.NTX"))
         loop
      endif
      v1:= {"Grupo", "Codigo", "Descricao", "Valor", "Estoque"}
      v2:= {"99999", "@!", "", ""}
      v3:= {"Grupo", "Codigo", "Descricao", "Venda", "Estoque"}
      ddtinicio:= {1, 1, 1, 1, 1}
      ccoluna:= " Consulta de Produtos "
      consulta("Produtos", 3, 1, 21, 78, v1, v2, v3, ddtinicio, ;
         "PesConEst", ccoluna)
      lcontrole:= .F.
   enddo
   close
   set color to (ccor)
   RestScreen(0, 0, 24, 79, ctela)
   return

********************************
function FUNC277

   parameters mode, counter
   setcursor(1)
   cpesquisa:= {"Produtos", "Produto2", "CODIGO", "cProduto"}
   ccampos:= {"CODIGO", "DESCRICAO", "VALOR", "CODIGO", "DESCRICAO", ;
      "VALOR"}
   ccor1:= SetColor()
   set color to (corlinmenu)
   lin:= Row()
   @ 23,  0 clear to 23, 70
   @ lin,  0 say ""
   do case
   case mode = 0
      if (Deleted())
         set color to (corlinmenu)
         @ 23, 30 say "DELETADO"
      else
         @ 23, 30 say Replicate(" ", 9)
      endif
      set color to (ccor1)
      return 1
   case mode = 1
      set color to (corlinmenu)
      @ 23, 30 say "Este e o primeiro iten"
      InKey(0.5)
      @ 23, 30 say Replicate(" ", 30)
      set color to (ccor1)
      return 1
   case mode = 2
      set color to (corlinmenu)
      @ 23, 30 say "Este e o ultimo iten"
      InKey(0.5)
      @ 23, 30 clear to 23, 52
      set color to (ccor1)
      return 1
   case mode = 3
      append blank
      InKey(1)
      return 2
   case LastKey() = K_INS
      rg:= RecNo()
      append blank
      goto top
      goto rg
      keyboard Replicate(Chr(24), LastRec() - RecNo())
      @ 23, 30 say Replicate(" ", 20)
      return 2
   case LastKey() = K_ESC
      return 0
   case LastKey() = K_DEL
      set color to (corfordado)
      nresp:= alert("Exclui Esse Item ?", vet)
      if (nresp == 1)
         ntotquanti:= ntotquanti - esto
         ntotvalor:= ntotvalor - vend * esto - des_acre
         ntotpraz:= ntotpraz - vend2 * esto - des_acre
         ntotbrtp:= ntotbrtp - vend2 * esto
         ntotbrtv:= ntotbrtv - vend * esto
         if (cdesc_porc == "S")
            ndesc:= ntotvalor * nporcdesc / 100
            @ nlinha + 16, 20 say ndesc picture "999,999.99"
         endif
         @ nlinha + 16, ncoluna + 45 say ntotquanti picture "99999.99"
         @ nlinha + 16, ncoluna + 53 say ntotbrtv picture "999,999.99"
         @ nlinha + 16, ncoluna + 66 say ntotbrtp picture "999,999.99"
         @ nlinha + 17, ncoluna + 30 say "Total Liquido"
         @ nlinha + 17, ncoluna + 53 say ntotvalor picture ;
            "999,999.99"
         delete
         pack
         return 2
      endif
   otherwise
      lerestoque()
      return 2
   endcase

********************************
procedure QSR311

   private ncodigo, ddtfim, dbclearrel, crecpag, impvid, nlinha, ;
      ncoluna, ccor, ctela, valpess
   private lcontrole, ncont, v1[5], v2[5], v3[5], ddtinicio[5], vet[2]
   set escape on
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   cnome:= Space(20)
   csobre:= Space(20)
   cpessoa:= Space(1)
   ccor:= SetColor()
   ncont:= 0
   lcontrole:= .T.
   nlinha:= 10
   ncoluna:= 19
   ctela:= SaveScreen(0, 0, 24, 79)
   lcontrole:= .T.
   vet[1]:= "Sim"
   vet[2]:= "NÆo"
   do while (lcontrole)
      if (!abredbf("CLIENTES"))
         loop
      endif
      set index to CLIENTE1, CLIENTE2
      set order to 2
      v1:= {"Codigo_Cli", "Nome_Cli", "Pessoa_Cli", "Fone_Cli", ;
         "Cgc_Cli"}
      v2:= {"99999", "@!", "", "", "9.999.999,99"}
      v3:= {"Codigo", "Nome do Cliente", "Pes", "Telefone", "C.G.C."}
      ddtinicio:= {1, 1, 1, 1, 1}
      ccoluna:= " Consulta de Clientes "
      consulta("Clientes", 3, 1, 21, 78, v1, v2, v3, ddtinicio, ;
         "PesConCli", ccoluna)
      close databases
      select 1
      close format
      cnome:= Space(20)
      csobre:= Space(20)
      cpessoa:= Space(1)
      lcontrole:= .F.
   enddo
   close databases
   select 1
   close format
   set color to (ccor)
   RestScreen(0, 0, 24, 79, ctela)
   return

********************************
function GRAVAORC2

   public cnomcli, ccgc, cinsc, cender, ccidade, cuf, cfone, ccep, ;
      cbair
   public cnf, ccond, cconrev
   set key K_F10 to pesq271
   vet[1]:= "Sim"
   vet[2]:= "No"
   nlin1:= 6
   ncol1:= 5
   nlinha:= 7
   ncoluna:= 5
   ctel2:= SaveScreen(0, 0, 24, 79)
   lcontrole:= .T.
   cnf:= "O"
   ccond:= "V"
   cconrev:= cpadrcons
   nloja:= 1
   cnomcli:= Space(30)
   ccgc:= Space(18)
   cinsc:= Space(17)
   cender:= Space(35)
   ccidade:= Space(20)
   cbair:= Space(15)
   cuf:= "GO"
   cfone:= Space(13)
   ccep:= Space(10)
   janela(nlin, ncol1, nlin + 12, ncol1 + 70, "")
   nlinha++
   do while (lcontrole)
      nlinha:= 9
      nlinha++
      ddataped:= Date()
      if (!abredbf("empresa"))
         return .F.
      endif
      observacao:= nchavereg + 1
      close
      if (cautoped == "S")
      else
         @ nlinha + 0, ncoluna + 20 say "Pedido" get nNoPed picture ;
            "99999" valid valnnoorc(Str(nloja, 2) + Str(observacao, ;
            5), observacao)
      endif
      @ nlinha + 0, ncoluna + 1 say "Data"
      @ nlinha + 0, ncoluna + 10 get dDataPed
      @ nlinha + 1, ncoluna + 1 say "Cliente"
      @ nlinha + 1, ncoluna + 1 say "Cliente"
      @ nlinha + 1, ncoluna + 10 get nCodCli picture "99999" valid ;
         codpedcli(ncodcli)
      @ nlinha + 2, ncoluna + 1 say "Cgc/Cpf"
      @ nlinha + 2, ncoluna + 32 say "Insc/Ident"
      @ nlinha + 3, ncoluna + 1 say "Endereco"
      @ nlinha + 3, ncoluna + 52 say "CEP"
      @ nlinha + 4, ncoluna + 40 say "Uf"
      @ nlinha + 4, ncoluna + 48 say "Fone"
      @ nlinha + 4, ncoluna + 1 say "Cidade"
      @ nlinha + 5, ncoluna + 1 say "Bairro"
      @ nlinha + 6, ncoluna + 1 say "Vendedor"
      @ nlinha + 1, ncoluna + 17 get cNomCli picture "@!" when ;
         ncodcli = 1
      if (cconrev == "R")
         @ nlinha + 2, ncoluna + 12 get cCGC picture ;
            "99.999.999/9999-99" when ncodcli = 1
      else
         @ nlinha + 2, ncoluna + 12 get cCGC when ncodcli = 1
      endif
      @ nlinha + 2, ncoluna + 43 get cInsc when ncodcli = 1
      @ nlinha + 3, ncoluna + 12 get cEnder picture "@!" when ;
         ncodcli = 1
      @ nlinha + 3, ncoluna + 57 get cCep picture "99.999-999" when ;
         ncodcli = 1
      @ nlinha + 4, ncoluna + 12 get cCidade picture "@!" when ;
         ncodcli = 1
      @ nlinha + 4, ncoluna + 43 get cUf picture "!!" when ncodcli = 1
      @ nlinha + 4, ncoluna + 55 get cFone picture "(999)999-9999" ;
         when ncodcli = 1
      @ nlinha + 5, ncoluna + 12 get cBair picture "@!" when ncodcli ;
         = 1
      @ nlinha + 6, ncoluna + 12 get nCodVend picture "99999" valid ;
         codpedvend(ncodvend)
      nlinha++
      if (ntipocomis == 2)
         nporccomis:= 1.5
         @ nlinha + 5, ncoluna + 50 say "Comissao" get nPorcComis ;
            picture "99.99" valid nporccomis > 0
      endif
      @ nlinha + 6, ncoluna + 1 say "Obs." get cObs
      @ nlinha + 7, ncoluna + 1 say ;
         "Orcamento  Nota Fiscal (O/N)   " get cNf picture "!" valid ;
         cnf $ "ON"
      @ nlinha + 8, ncoluna + 1 say ;
         "A Vista  ou a Prazo (V/P)      " get cCond picture "!" ;
         valid ccond $ "VP"
      read
      if (sai())
         loop
      endif
      if (!conflinha("CONFIRMA ESTE PEDIDO ?", 23, 2))
         lcontrole:= .F.
      else
         nlinha:= 4
         ncoluna:= 5
         RestScreen(0, 0, 24, 79, ctel2)
         if (!abredbf("empresa"))
            return .F.
         endif
         bloqueia()
         replace nchavereg with nchavereg + 1
         close
         return .T.
      endif
   enddo
   nlinha:= 4
   ncoluna:= 5
   RestScreen(0, 0, 24, 79, ctel2)
   return .F.

********************************
function QSR316

   if (!Nil("empresa"))
      return .F.
   endif
   bloqueia()
   replace nchavereg with nchavereg + 1
   close
   return .T.
   nlinha:= 4
   ncoluna:= 5
   RestScreen(0, 0, 24, 79, ctel2)
   return .F.

********************************
function QSR29EN

   private v1[2], v2[2], v3[2], cd1, cd2, cd3, vl1, vl2, vl3, nnoped
   private nvlricms, cnumdocto, valfr, nvaltot, nnumped
   private ccor, ctela, ncont, nlinha, ncoluna, vet[2], cnomefor
   private lcontrole, dbcreate, ntotquanti, ntotvalor, nloja
   cpesquisa:= {"FORNECED", "FORNECE1", "CODIGO_FOR", "nCodFor"}
   ccampos:= {"CODIGO_FOR", "NOME", "", "CODIGO", "NOME", ""}
   set escape on
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   nlinha:= 3
   tela11i:= nlinha + 18
   ncoluna:= 1
   nresp:= 0
   nnoped:= .F.
   ntotquanti:= 0
   ntotvalor:= 0
   cproduto:= 0
   cnumdocto:= Space(10)
   valfr:= Date()
   nvlricms:= 0
   lcontrole:= .T.
   nloja:= 1
   cnomfor:= ""
   nnumped:= Space(2)
   nlocal:= 0
   vet[1]:= "Sim"
   vet[2]:= "Nao"
   ctela:= SaveScreen(0, 0, 24, 79)
   criaarq29e()
   janela(nlinha, ncoluna, tela11i, ncoluna + 77, ;
      "Entrada no Estoque")
   nlinha++
   do while (lcontrole)
      @ nlinha + 0,  2 say "Fornecedor " get nCodFor picture "99999" ;
         valid valcodfor2(nvlricms)
      @ nlinha + 0, 55 say "Num Docto" get cNumDocto picture ;
         "XXXXXXXXXX" valid valdoc29en(cnumdocto + Str(nvlricms, 5))
      @ nlinha + 1,  2 say "Tipo Docto " get cTipoDoc picture "!!"
      @ nlinha + 1, 20 say "Data " get dData valid valdataemi(valfr)
      @ nlinha + 1, 37 say "Local" get nLocal picture "999" valid ;
         qsr21i(nlocal, nlinha + 1, 47)
      read
      if (sai())
         loop
      endif
      select 1
      use (dbcreate) exclusive
      append blank
      cproduto:= Space(5)
      private camp1[4], camp3[4], camp4[4]
      camp1:= {"PROD", "DESC", "TAM", "ESTO", "VEND"}
      camp3:= {"XXXXX", "@!", "XXX", "9,999,999.99", "9,999,999.99"}
      camp4:= {"Codigo", "Descrio ", "Tam", "Quantidade", ;
         "Valor Compra"}
      goto top
      dbedit(nlinha + 3, ncoluna + 2, nlinha + 15, ncoluna + 75, ;
         camp1, "FUNC29EN", camp3, camp4, "ÂÄ", "³", "ÁÄ", "")
      if (LastKey() == K_F12)
         loop
      endif
      DBEval({|| dbDelete()}, {|| prod = "     "}, Nil, Nil, Nil, .F.)
      pack
      if (LastRec() == 0)
         close
         lcontrole:= .F.
         loop
      endif
      if (gravaest())
         nnoped:= .T.
      endif
      lcontrole:= .F.
   enddo
   close databases
   select 1
   close format
   impritrans(dbcreate)
   RestScreen(0, 0, 24, 79, ctela)
   set color to (ccor)
   return Nil

********************************
function CRIAARQ29E

   private carquivo[5, 4]
   ncont:= 1
   dbcreate:= "TEMP" + LTrim(Str(ncont)) + ".DBF"
   do while (file(dbcreate))
      ncont++
      dbcreate:= "TEMP" + LTrim(Str(ncont)) + ".DBF"
   enddo
   carquivo[1]:= {"PROD", "C", 5, 0}
   carquivo[2]:= {"DESC", "C", 35, 0}
   carquivo[3]:= {"ESTO", "N", 12, 2}
   carquivo[4]:= {"VEND", "N", 12, 2}
   carquivo[5]:= {"TAM", "C", 3, 0}
   cprod(dbcreate, carquivo)
   return .T.

********************************
procedure CALC29T

   nrecno:= RecNo()
   ntotquanti:= 0
   ntotvalor:= 0
   goto top
   do while (!EOF())
      ntotquanti:= ntotquanti + esto
      ntotvalor:= ntotvalor + vend * esto
      skip 
   enddo
   @ nlinha + 16, ncoluna + 50 say ntotquanti picture "9,999,999.99" ;
      color "W+/B"
   @ nlinha + 16, ncoluna + 63 say ntotvalor picture "9,999,999.99" ;
      color "W+/B"
   goto nrecno
   return

********************************
function GRAVAEST

   public cavista
   if (conflinha("Confirma esta Entrada no Estoque ?", 23, 2))
      set color to (corlinmenu)
      @ 23,  0 say Replicate(" ", 80)
      nvaltot:= 0
      mostrar("**** Gravando ****")
      select 1
      use (dbcreate) exclusive
      goto top
      do while (!EOF())
         nvaltot:= nvaltot + esto * vend
         skip 
      enddo
      close databases
      select 1
      close format
      select 1
      if (!abredbf("ENTRADAS"))
         return .F.
      endif
      set index to ENTRADA1, ENTRADA2, ENTRADA3
      if (!adiciona())
         return .F.
      endif
      if (!bloqueia())
         return .F.
      endif
      replace data with valfr
      replace fornecedor with nvlricms
      replace num_docto with cnumdocto
      replace tipo_docto with nnumped
      replace valor_tot with nvaltot
      select 2
      if (!abredbf("ENT_MAT", "ENT_MAT1.NTX"))
         return .F.
      endif
      select 3
      if (!abredbf(dbcreate))
         return .F.
      endif
      select 4
      if (!abredbf("PRODUTOS", "PRODUTO1.NTX"))
         return .F.
      endif
      select 5
      if (!abredbf("ESTOQUE"))
         return .F.
      endif
      set index to ESTOQUE2, ESTOQUE1
      select 3
      goto top
      do while (!EOF())
         nquanti:= prod
         cest:= esto
         fonecomp:= vend
         ctam:= tam
         select 4
         seek nquanti
         if (Found())
            if (!bloqueia())
               return .F.
            endif
            cdescricao:= descricao
            replace valor_ultc with fonecomp
            replace estoque with estoque + cest
            replace peso with valfr
         endif
         select 2
         if (!adiciona())
            return .F.
         endif
         if (!bloqueia())
            return .F.
         endif
         replace num_docto with cnumdocto
         replace codigo_mat with nquanti
         replace quantidade with cest
         replace data_orc with fonecomp
         replace tamanho with ctam
         select 5
         seek Str(nlocal, 3) + nquanti + ctam
         if (Found())
            bloqueia()
            replace estoque with estoque + cest
         else
            adiciona()
            bloqueia()
            replace est_minimo with nlocal
            replace desc_local with procura("LocEst", "LocEst1", ;
               nlocal, "DESCRICAO")
            replace produto with nquanti
            replace desc_prod with cdescricao
            replace tamanho with ctam
            replace estoque with cest
         endif
         select 3
         skip 
      enddo
      return .T.
   endif
   set color to (corfordado)
   return .F.

********************************
function PESCONDV

   local Local1, Local2, Local3, Local4, Local5, Local6, Local7, ;
      Local8, Local9, Local10, Local11, Local12, Local13, Local14
   private vetor1[4], vetor2[4], vetor3[4], vetor4[4]
   Local9:= 7
   Local10:= 19
   Local13:= SetColor()
   Local11:= 0
   Local12:= .T.
   observacao:= numero
   gertemp233(observacao)
   close
   select 2
   use (carq2)
   vetor1[1]:= "Codigo_Mat"
   vetor1[2]:= "Descricao"
   vetor1[3]:= "Quantidade"
   vetor1[4]:= "Valor"
   vetor2[1]:= ""
   vetor2[2]:= ""
   vetor2[3]:= ""
   vetor2[4]:= ""
   vetor3[1]:= "Codigo"
   vetor3[2]:= "Descricao"
   vetor3[3]:= "Quantidade"
   vetor3[4]:= "Valor"
   vetor4[1]:= 2
   vetor4[2]:= 2
   vetor4[3]:= 2
   vetor4[4]:= 2
   ccoluna:= " Consultas de produtos de Pedidos "
   consped(Nil, Local9, 1, Local9 + 11, Local10 + 59, vetor1, ;
      vetor2, vetor3, vetor4, ccoluna)
   select 1
   set color to (Local13)
   keyboard " "
   return Nil

********************************
function VALPEDNF(Arg1)

   private v1[2], v2[2], v3[2]
   if (!abredbf("PEDIDOS", "PEDIDOS1.NTX"))
      return .F.
   endif
   seek Arg1
   nlinha:= nlinha + 2
   if (!Found())
      alert("Pedido Nao Encontrado")
      close
      return .F.
   endif
   if (imp_nf == "S")
      alert(" Nota Fiscal Desse Pedido Ja Foi Impressa ")
      close
      return .F.
   endif
   cconrev:= emp
   ncodcli:= cliente
   if (LastKey() != K_ESC)
      return .T.
   else
      return .F.
   endif

********************************
function FUNC29EN

   parameters mode, counter
   setcursor(1)
   ccor1:= SetColor()
   set color to (corlinmenu)
   cpesquisa:= {"Produtos", "Produto2", "CODIGO", "cProduto"}
   ccampos:= {"DESCRICAO", "VALOR", "ESTOQUE", "DESCRICAO", "VALOR", ;
      "ESTOQUE"}
   lin:= Row()
   @ 23,  0 clear to 23, 70
   @ lin,  0 say ""
   do case
   case mode = 0
      if (Deleted())
         set color to N/GR
         @ 23, 30 say "DELETADO"
      else
         @ 23, 30 say Replicate(" ", 9)
      endif
      set color to (ccor1)
      return 1
   case mode = 1
      set color to N/GR
      @ 23, 30 say "Este e o primeiro iten"
      InKey(0.5)
      @ 23, 30 say Replicate(" ", 30)
      set color to (ccor1)
      return 1
   case mode = 2
      set color to N/GR
      @ 23, 30 say "Este e o ultimo iten"
      InKey(0.5)
      @ 23, 30 clear to 23, 52
      set color to (ccor1)
      return 1
   case mode = 3
      append blank
      InKey(1)
      return 2
   case LastKey() = K_INS
      rg:= RecNo()
      append blank
      goto top
      goto rg
      keyboard Replicate(Chr(24), LastRec() - RecNo())
      @ 23, 30 say Replicate(" ", 20)
      return 2
   case LastKey() = K_ESC
      return 0
   case LastKey() = -41
      return 0
   case LastKey() = K_DEL
      nresp:= alert("Exclui esse item ?", vet)
      if (nresp == 1)
         ntotquanti:= ntotquanti - esto
         ntotvalor:= ntotvalor - vend * esto
         @ nlinha + 16, ncoluna + 48 say ntotquanti picture ;
            "9,999,999.99"
         @ nlinha + 16, ncoluna + 61 say ntotvalor picture ;
            "9,999,999.99"
         delete
         pack
         return 2
      endif
   otherwise
      if (prod != " ")
         return 2
      endif
      lin:= Row()
      if (Empty(cproduto))
         cproduto:= Chr(LastKey()) + Replicate(" ", 5 - ;
            Len(Chr(LastKey())))
         keyboard Chr(4)
         @ lin, ncoluna + 3 get cProduto picture "XXXXX" valid ;
            codestent(cproduto)
         read
      else
         clear gets
         codestent(cproduto)
      endif
      @ lin, ncoluna + 46 get TAM picture "XXX" valid !Empty(tam)
      @ lin, ncoluna + 50 get ESTO picture "9,999,999.99" valid esto ;
         > 0
      @ lin, ncoluna + 63 get VEND picture "9,999,999.99" valid vend ;
         > 0
      read
      ntotquanti:= ntotquanti + esto
      ntotvalor:= ntotvalor + vend * esto
      @ nlinha + 16, ncoluna + 48 say ntotquanti picture ;
         "9,999,999.99"
      @ nlinha + 16, ncoluna + 61 say ntotvalor picture "9,999,999.99"
      set color to (ccor1)
      return 2
   endcase

********************************
function VALCODFOR2(Arg1)

   if (Empty(Arg1))
      alert("ATENCAO!; Nao e Permitido Codigo Fornecedor Igual a Zero")
      return .F.
   else
      if (!abredbf("FORNECED", "FORNECE1.NTX"))
         return .F.
      endif
      seek Arg1
      if (!Found())
         alert("C¢digo no Cadastrado")
         close
         return .F.
      else
         @ nlinha, 20 say SubStr(nome, 1, 30)
         close
         return .T.
      endif
      close
      return .T.
   endif
   return .T.

********************************
function QSR29T

   private carquivo[5, 4], v1[2], v2[2], v3[2], cd1, cd2, cd3, vl1, ;
      vl2, vl3, nnoped
   private ndestino, ndestin, cnumdocto, valfr, nvaltot
   private ccor, ctela, ncont, nlinha, ncoluna, vet[2], cnomefor
   private lcontrole, dbcreate, ntotquanti, ntotvalor
   set escape on
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   nlinha:= 3
   ncoluna:= 1
   nresp:= 0
   nnoped:= .F.
   ntotquanti:= 0
   ntotvalor:= 0
   cproduto:= 0
   cnumdocto:= Space(10)
   valfr:= Date()
   ndestino:= 0
   ccodmat:= 0
   lcontrole:= .T.
   nloja:= 1
   cnomfor:= ""
   vet[1]:= "Sim"
   vet[2]:= "Nao"
   ctela:= SaveScreen(nlinha, ncoluna, nlinha + 18, ncoluna + 78)
   janela(nlinha, ncoluna, nlinha + 18, ncoluna + 77, ;
      " Transferencia de Estoque ")
   nlinha++
   ncont:= 1
   dbcreate:= "TEMP" + LTrim(Str(ncont)) + ".DBF"
   do while (file(dbcreate))
      ncont++
      dbcreate:= "TEMP" + LTrim(Str(ncont)) + ".DBF"
   enddo
   carquivo[1]:= {"PROD", "C", 5, 0}
   carquivo[2]:= {"DESC", "C", 35, 0}
   carquivo[3]:= {"ESTO", "N", 12, 2}
   carquivo[4]:= {"VEND", "N", 12, 2}
   carquivo[5]:= {"TAM", "C", 3, 0}
   cprod(dbcreate, carquivo)
   do while (lcontrole)
      set color to (corfordado)
      @ nlinha + 0,  2 say "Data   " get dData valid valdataemi(valfr)
      @ nlinha + 0, 20 say "No Docto" get cNumDocto picture ;
         "9999999999" valid valdoc29t(cnumdocto)
      @ nlinha + 1,  2 say "Origem " get nOrigem picture "999" valid ;
         qsr21i(ndestino, nlinha + 1, 15)
      @ nlinha + 2,  2 say "Destino" get nDestino picture "999" ;
         valid qsr21i(ccodmat, nlinha + 2, 15) .AND. ndestino != ;
         ccodmat
      read
      if (sai())
         loop
      endif
      select 1
      use (dbcreate) exclusive
      append blank
      cproduto:= Space(5)
      private camp1[4], camp3[4], camp4[4]
      camp1:= {"PROD", "DESC", "TAM", "ESTO", "VEND"}
      camp3:= {"XXXXX", "@!", "XXX", "9,999,999.99", "9,999,999.99"}
      camp4:= {"Codigo", "Descrio", "Tam", "Quantidade", ;
         "Vl Compra"}
      goto top
      dbedit(nlinha + 4, ncoluna + 2, nlinha + 15, ncoluna + 75, ;
         camp1, "FUNC29T", camp3, camp4, "ÂÄ", "³", "ÁÄ", "")
      if (LastKey() == K_F12)
         loop
      endif
      DBEval({|| dbDelete()}, {|| prod = "     "}, Nil, Nil, Nil, .F.)
      pack
      if (LastRec() == 0)
         close
         lcontrole:= .F.
         loop
      endif
      if (gravaestt())
         nnoped:= .T.
      endif
      lcontrole:= .F.
   enddo
   nlinha--
   close databases
   select 1
   close format
   impritrans(dbcreate)
   nlinha:= 3
   ncoluna:= 1
   RestScreen(nlinha, ncoluna, nlinha + 18, ncoluna + 78, ctela)
   set color to (ccor)
   return Nil

********************************
function TELA2(Arg1)

   nlin:= nlinha
   ncol:= ncoluna
   ctel3:= SaveScreen(0, 0, 24, 79)
   nlinha:= 4
   ncoluna:= 3
   do case
   case Arg1 = 1
      lertrab12i(.T.)
   case Arg1 = 2
      lerrefc12i(.T.)
   case Arg1 = 3
      lerspc12i(.T.)
   case Arg1 = 4
      lerobs12i(.T.)
   case Arg1 = 5
      dt_nas_cli(.T.)
   endcase
   lcontrole:= .T.
   do while (lcontrole)
      ntecla:= InKey(0)
      if (ntecla == 27)
         lcontrole:= .F.
      endif
   enddo
   lcontrole:= .T.
   RestScreen(0, 0, 24, 79, ctel3)
   nlinha:= nlin
   ncoluna:= ncol
   return .T.

********************************
function GRAVAESTT

   public cavista
   if (conflinha("Confirma esta Transferencia no Estoque ?", 23, 2))
      set color to (corlinmenu)
      @ 23,  0 say Replicate(" ", 80)
      nvaltot:= 0
      mostrar("**** Gravando ****")
      if (cntr_auto = "S")
         cnumdocto:= valdoc29t(cnumdocto)
         @ nlinha + 0, 30 say "No Docto" get cNumDocto picture "99999"
         clear gets
      endif
      select 1
      use (dbcreate) exclusive
      goto top
      do while (!EOF())
         nvaltot:= nvaltot + esto * vend
         skip 
      enddo
      close databases
      select 1
      close format
      ncont:= 0
      do while (.T.)
         select 1
         use Transf shared index Transf1, Transf2
         set order to 1
         if (ncont > 3)
            alert("ATENO !;Erro na abertura de arquivo.;Operao ser  cancelada.")
            return .F.
         endif
         if (neterr())
            InKey(2)
            ncont++
            loop
         else
            exit
         endif
      enddo
      if (ccodmat != 3)
         select 1
         adiciona()
         bloqueia()
         replace data with valfr
         replace origem with ndestino
         replace destino with ccodmat
         replace num_docto with cnumdocto
         replace valor_tot with nvaltot
      endif
      select 2
      if (!abredbf("Trans_Mat"))
         return .F.
      endif
      set index to Tra_Mat1
      select 3
      use (dbcreate) exclusive
      select 4
      if (!abredbf("PRODUTOS"))
         return .F.
      endif
      set index to PRODUTO1
      select 5
      if (!abredbf("ESTOQUE"))
         return .F.
      endif
      set index to ESTOQUE2, ESTOQUE1
      select 3
      goto top
      do while (!EOF())
         nquanti:= prod
         cest:= esto
         fonecomp:= vend
         ctam:= tam
         select 4
         seek nquanti
         if (Found())
            bloqueia()
            cdescricao:= descricao
            replace estoque with estoque - cest
         endif
         select 2
         if (ccodmat != 3)
            adiciona()
            bloqueia()
            replace num_docto with cnumdocto
            replace codigo_mat with nquanti
            replace quantidade with cest
            replace data_orc with fonecomp
         endif
         select 5
         seek Str(ndestino, 3) + nquanti + ctam
         if (!Found())
            alert("Produto nao encontrado no Estoque de Origem")
         else
            bloqueia()
            replace estoque with estoque - cest
            seek Str(ccodmat, 3) + nquanti + ctam
            if (Found())
               bloqueia()
               if (ccodmat != 3)
                  replace estoque with estoque + cest
               endif
            else
               adiciona()
               bloqueia()
               if (ccodmat != 3)
                  replace est_minimo with ccodmat
                  replace desc_local with procura("LocEst", ;
                     "LocEst1", ccodmat, "DESCRICAO")
                  replace produto with nquanti
                  replace desc_prod with cdescricao
                  replace tamanho with ctam
                  replace estoque with cest
               endif
            endif
         endif
         select 3
         skip 
      enddo
      return .T.
   endif
   set color to (corfordado)
   return .F.

********************************
function PESCONPD

   local Local1, Local2, Local3, Local4, Local5, Local6, Local7, ;
      Local8, Local9, Local10, Local11, Local12, Local13, Local14
   private vetor1[4], vetor2[4], vetor3[4], vetor4[4]
   Local9:= 7
   Local10:= 19
   Local13:= SetColor()
   Local11:= 0
   Local12:= .T.
   observacao:= numero
   cchave:= Str(nloja, 2) + Str(numero, 5)
   gertemp231(cchave)
   close
   select 2
   use (carq2)
   vetor1:= {"Codigo_Mat", "Descricao", "Quantidade", "Valor"}
   vetor2:= {"", "", "", "", ""}
   vetor3:= {"Codigo", "Descricao", "Quantidade", "Valor"}
   vetor4:= {2, 2, 2, 2}
   ccoluna:= " Consultas de Produtos de Pedidos "
   consped(Nil, Local9, 1, Local9 + 11, Local10 + 59, vetor1, ;
      vetor2, vetor3, vetor4, ccoluna)
   select 1
   set color to (Local13)
   keyboard " "
   return Nil

********************************
function FUNC29T

   parameters mode, counter
   setcursor(1)
   ccor1:= SetColor()
   set color to (corlinmenu)
   cpesquisa:= {"Produtos", "Produto2", "CODIGO", "cProduto"}
   ccampos:= {"DESCRICAO", "VALOR", "ESTOQUE", "DESCRICAO", "VALOR", ;
      "ESTOQUE"}
   lin:= Row()
   @ 23,  0 clear to 23, 70
   @ lin,  0 say ""
   do case
   case mode = 0
      if (Deleted())
         set color to N/GR
         @ 23, 30 say "DELETADO"
      else
         @ 23, 30 say Replicate(" ", 9)
      endif
      set color to (ccor1)
      return 1
   case mode = 1
      @ 23, 30 say "Este e o primeiro iten"
      InKey(0.5)
      @ 23, 30 say Replicate(" ", 30)
      set color to (ccor1)
      return 1
   case mode = 2
      @ 23, 30 say "Este e o ultimo iten"
      InKey(0.5)
      @ 23, 30 clear to 23, 52
      set color to (ccor1)
      return 1
   case mode = 3
      append blank
      InKey(1)
      return 2
   case LastKey() = K_INS
      rg:= RecNo()
      append blank
      goto top
      goto rg
      keyboard Replicate(Chr(24), LastRec() - RecNo())
      @ 23, 30 say Replicate(" ", 20)
      return 2
   case LastKey() = K_ESC
      return 0
   case LastKey() = -41
      return 0
   case LastKey() = K_DEL
      nresp:= alert("Exclui esse item ?", vet)
      if (nresp == 1)
         delete
         pack
         calc29t()
         return 2
      endif
   otherwise
      lin:= Row()
      if (prod = " ")
         cproduto:= Chr(LastKey()) + Replicate(" ", 5 - ;
            Len(Chr(LastKey())))
         keyboard Chr(4)
         @ lin, ncoluna + 3 get cProduto picture "99999" valid ;
            codestent(cproduto)
         read
      endif
      @ lin, ncoluna + 46 get TAM picture "XXX" valid !Empty(tam)
      @ lin, ncoluna + 50 get ESTO picture "9,999,999.99" valid ;
         valest29t(prod, ndestino, esto, tam)
      @ lin, ncoluna + 63 get VEND picture "9,999,999.99" valid vend ;
         > 0
      read
      calc29t()
      set color to (ccor1)
      return 2
   endcase

********************************
function PESCONPG

   private nvlricms, ddtvenc, nnumped, pesq23i, nvalortit, pagamento
   private cnumdoc, ddataultc, nlinha, ncoluna, ccor, ncont
   private nvlpagto, tela24b, cnomfor, cdesp, nloja
   ddtvenc:= Space(10)
   nvlricms:= 0
   nnumped:= Space(8)
   pesq23i:= 0
   nvalortit:= CToD("  /  /  ")
   pagamento:= CToD("  /  /  ")
   nvlpagto:= Date()
   cnumdoc:= 0
   tela24b:= 0
   cdesp:= 0
   ddataultc:= Space(40)
   nloja:= 0
   nlinha:= 5
   ncoluna:= 19
   ccor:= SetColor()
   ctel2:= SaveScreen(0, 0, 24, 79)
   ntecla:= 0
   lcontrole:= .T.
   janela(nlinha - 1, ncoluna, nlinha + 17, ncoluna + 43, ;
      "ZOOM de Contas Pagas")
   ddtvenc:= contaspg->cod_for_pg
   nvlricms:= contaspg->tip_doc_pg
   nnumped:= contaspg->num_ped_pg
   pesq23i:= contaspg->situaca_pg
   nvalortit:= contaspg->dt_venc_pg
   pagamento:= contaspg->val_tit_pg
   nvlpagto:= contaspg->dt_pgto_pg
   cnumdoc:= contaspg->val_icm_pg
   cdesp:= contaspg->obs_pg
   tela24b:= contaspg->vl_pgto_pg
   ddataultc:= contaspg->conta_pg
   nloja:= contaspg->loja
   tela24:= contaspg->num_doc_ap
   cnomfor:= SubStr(ncodfor1->nome, 1, 22)
   qsr26i()
   clear gets
   do while (lcontrole)
      ntecla:= InKey(0)
      if (ntecla == 27)
         lcontrole:= .F.
      endif
   enddo
   lcontrole:= .T.
   set color to (ccor)
   RestScreen(0, 0, 24, 79, ctel2)
   return Nil

********************************
function VALPEDIMP(Arg1)

   if (!abredbf("PEDIDOS", "PEDIDOS1.NTX"))
      return .F.
   endif
   seek Arg1
   if (!Found())
      alert("Pedido Nao Encontrado")
      close
      return .F.
   else
      ncodcli:= cliente
      close
      return .T.
   endif

********************************
function PESCONCLI

   private ncodigo, cnome, cpessoa, cendereco, cestado, ccidade, ;
      ctelefone, ccep, ddataincl
   private nestoque, ddt_1a_com, cconjuge, ccgc, cinsc, ddataultc, ;
      cinforma1, ctelefone1, cinforma2
   private ctelefone2, cinforma3, ctelefone3, lcontrole, nlinha, ;
      ncoluna, cnomerep
   private ccont, nresp, ccor, v1[2], v2[2], v3[2], vet[2], nloja, ;
      cfirma, ccpf
   private ncheqdev, nn_pc_ult_, nlimitcred, ncredusad, nvend, ;
      fonecomp
   lcontrole:= .T.
   vet[1]:= "Sim"
   vet[2]:= "Nao"
   nlinha:= 1
   ncoluna:= 1
   ctel2:= SaveScreen(0, 0, 24, 79)
   ccor:= SetColor()
   janela(nlinha + 1, ncoluna, nlinha + 13, ncoluna + 77, ;
      "ZOOM do Cadastro de Clientes ")
   nlinha:= nlinha + 3
   ncoluna:= ncoluna + 2
   nloja:= loja_cli
   cnome:= nome_cli
   cconjuge:= dencom_cli
   cpessoa:= pessoa_cli
   cbairro:= inclus_cli
   cendereco:= endere_cli
   cestado:= bairro_cli
   ccidade:= cidade_cli
   ctelefone:= estado_cli
   ccep:= cep_cli
   ddataincl:= fone_cli
   ddatanasc:= conjug_cli
   ccomprador:= dt_nas_com
   ccpf:= cpf_cli
   cci:= identi_cli
   ccgc:= cgc_cli
   cinsc:= insc_cli
   ddtnasccom:= compra_cli
   ccpfcomp:= cpf_com
   ccicomp:= identi_com
   cfonecomp:= endere_com
   cnomref1:= fone_com
   ccepcomp:= cep_com
   ccidcomp:= cidade_com
   cbaircomp:= bairro_com
   crefbanc:= dt_ulc_cli
   ctelref1:= nom_ref2
   cendref1:= tel_ref2
   cnomref2:= end_ref2
   ctelref2:= nom_ref3
   cendref2:= tel_ref2
   cnomref3:= end_ref2
   ctelref3:= tel_ref1
   cendref3:= tel_ref2
   cnomeban:= end_ref2
   cpai:= agn_bco
   nconta:= nom_bco
   nlinhafim:= nom_ref1
   fonecomp:= vendedor
   cobs1:= obs1
   cobs2:= obs2
   ddt_1a_com:= dt_1ac_cli
   ncheqdev:= npc_ul_cli
   nn_pc_ult_:= no_ch_cli
   nlimitcred:= limitc_cli
   ncredusad:= credus_cli
   nvend:= conta_bco
   fonecomp:= vendedor
   cspc2:= spc2
   cspc3:= spc3
   cemptrab:= emp_trab
   set color to (corlinmenu)
   @ 23,  3 say ;
      "1 - Comprador / 2 - Ref.Bancaria / 3 - Ref.Comerciais / 4 - SPC / 5 - Obs"
   set color to (corfordado)
   @ nlinha + 0, ncoluna + 0 say "Loja"
   @ nlinha + 1, ncoluna + 0 get nLoja picture "99" valid ;
      rangecheck(_1, Nil, 1, 5)
   @ nlinha + 0, ncoluna + 12 say "Nome do Cliente"
   @ nlinha + 1, ncoluna + 12 get cNome picture "@!"
   @ nlinha + 0, ncoluna + 43 say "Pes"
   @ nlinha + 1, ncoluna + 43 get cPessoa picture "!" valid cpessoa ;
      $ "FJ"
   if (cpessoa = "F")
      @ nlinha + 2, ncoluna + 0 say "CPF"
      @ nlinha + 3, ncoluna + 0 get cCpf picture "999.999.999-99"
      @ nlinha + 2, ncoluna + 15 say "Identidade"
      @ nlinha + 3, ncoluna + 15 get cCi
      @ nlinha + 2, ncoluna + 34 say "Nome do Conjuge"
      @ nlinha + 3, ncoluna + 34 get cConjuge picture "@!"
      @ nlinha + 2, ncoluna + 65 say "Dt Nasc"
      @ nlinha + 3, ncoluna + 65 get dDataNasc
   else
      @ nlinha + 2, ncoluna + 0 say "CGC"
      @ nlinha + 3, ncoluna + 0 get cCgc
      @ nlinha + 2, ncoluna + 19 say "Inscrio estadual"
      @ nlinha + 3, ncoluna + 19 get cInsc
   endif
   @ nlinha + 4, ncoluna + 0 say "Endereo (Rua,n§)"
   @ nlinha + 5, ncoluna + 0 get cEndereco picture "@!"
   @ nlinha + 4, ncoluna + 36 say "Bairro"
   @ nlinha + 5, ncoluna + 36 get cBairro picture "@!"
   @ nlinha + 4, ncoluna + 55 say "Cidade"
   @ nlinha + 5, ncoluna + 55 get cCidade picture "@!"
   @ nlinha + 6, ncoluna + 0 say "Uf"
   @ nlinha + 7, ncoluna + 0 get cEstado picture "!!"
   @ nlinha + 6, ncoluna + 4 say "Cep"
   @ nlinha + 7, ncoluna + 4 get cCep picture "99.999-999"
   @ nlinha + 6, ncoluna + 16 say "Telefone"
   @ nlinha + 7, ncoluna + 16 get cTelefone picture "(999)999-9999"
   @ nlinha + 6, ncoluna + 30 say "Data Incluso"
   @ nlinha + 7, ncoluna + 32 get dDataIncl
   @ nlinha + 6, ncoluna + 46 say "Vendedor"
   @ nlinha + 7, ncoluna + 46 get nVend picture "99999" valid ;
      fonecomp != 0
   @ nlinha + 8, ncoluna + 0 say "Dt 1¦ Comp"
   @ nlinha + 9, ncoluna + 0 get dDt_1a_Comp
   @ nlinha + 8, ncoluna + 12 say "Dt Ult Comp"
   @ nlinha + 9, ncoluna + 13 get dDataUltC
   @ nlinha + 8, ncoluna + 25 say "Protestos"
   @ nlinha + 9, ncoluna + 28 get nCheqDev picture "999"
   @ nlinha + 8, ncoluna + 37 say "N§ Ult Comp"
   @ nlinha + 9, ncoluna + 39 get nN_Pc_Ult_C picture "@E 9,999"
   @ nlinha + 8, ncoluna + 50 say "Limite Cred"
   @ nlinha + 9, ncoluna + 50 get nLimitCred picture "@E 9,999,999.99"
   @ nlinha + 8, ncoluna + 63 say "Cred. Usado"
   @ nlinha + 9, ncoluna + 63 get nCredUsad picture "@E 9,999,999.99"
   clear gets
   do while (lcontrole)
      ntecla:= InKey(0)
      do case
      case ntecla == 27
         lcontrole:= .F.
      case ntecla = 49
         tela2(1)
      case ntecla == 50
         tela2(2)
      case ntecla == 51
         tela2(3)
      case ntecla == 52
         tela2(4)
      case ntecla == 53
         tela2(5)
      endcase
   enddo
   lcontrole:= .T.
   set color to (ccor)
   nlinha:= 1
   ncoluna:= 1
   RestScreen(0, 0, 24, 79, ctel2)
   return Nil

********************************
procedure QSR313

   private ncodigo, ddtfim, dbclearrel, crecpag, impvid, nlinha, ;
      ncoluna, ccor, ctela, valpess
   private lcontrole, ncont, v1[4], v2[4], v3[4], ddtinicio[4], vet[2]
   set escape on
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   cnome:= Space(20)
   csobre:= Space(20)
   cpessoa:= Space(1)
   ccor:= SetColor()
   ncont:= 0
   lcontrole:= .T.
   nlinha:= 10
   ncoluna:= 19
   ctela:= SaveScreen(0, 0, 24, 79)
   lcontrole:= .T.
   vet[1]:= "Sim"
   vet[2]:= "NÆo"
   do while (lcontrole)
      processand(.T.)
      if (!abredbf("FUNCIONA", "FUNCION2.NTX"))
         loop
      endif
      v1:= {"Codigo_Fun", "Nome", "Telefone", "Cpf"}
      v2:= {"99999", "@!", "", ""}
      v3:= {"Codigo", "Nome do Funcionario", "Telefone", "Cpf"}
      ddtinicio:= {1, 1, 1, 1}
      ccoluna:= " Consulta de Funcionarios "
      consulta("Funciona", 3, 1, 21, 78, v1, v2, v3, ddtinicio, ;
         "PesConFun", ccoluna)
      lcontrole:= .F.
   enddo
   close
   set color to (ccor)
   RestScreen(0, 0, 24, 79, ctela)
   return

********************************
procedure QSR319

   private ncodigo, nlinha, ncoluna, ccor, ctela, valpess, cnome, ;
      csobre
   private lcontrole, ncont, vet[2], ngrupo
   set key K_F10 to pesq319
   set escape on
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   ccor:= SetColor()
   ncont:= 0
   lcontrole:= .T.
   nlinha:= 10
   ncoluna:= 19
   ctela:= SaveScreen(0, 0, 24, 79)
   lcontrole:= .T.
   vet[1]:= "Sim"
   vet[2]:= "NÆo"
   nlocal:= 0
   cproduto:= Space(5)
   ntamanho:= Space(3)
   do while (lcontrole)
      janela(nlinha, ncoluna, nlinha + 6, ncoluna + 43, ;
         "Pesquisa de Estoque")
      @ nlinha + 1, ncoluna + 2 say "Local"
      @ nlinha + 1, ncoluna + 20 say "Produto"
      @ nlinha + 3, ncoluna + 2 say "Tamanho"
      @ nlinha + 2, ncoluna + 2 get nLocal picture "999"
      @ nlinha + 2, ncoluna + 20 get cProduto picture "99999"
      @ nlinha + 4, ncoluna + 2 get nTamanho picture "XXX"
      read
      if (!Empty(cproduto))
         cproduto:= Replicate("0", 5 - Len(Trim(cproduto))) + ;
            Trim(cproduto)
      endif
      if (sai())
         loop
      endif
      if (!abredbf("ESTOQUE", "ESTOQUE1.NTX"))
         loop
      endif
      private cfiltro[3, 2]
      cfiltro[1]:= {"Local   = nLocal", nlocal}
      cfiltro[2]:= {"Produto = cProduto", cproduto}
      cfiltro[3]:= {"Tamanho = nTamanho", ntamanho}
      carg:= filtgeral(cfiltro)
      if (Empty(carg))
         set filter to
      else
         set filter to &carg
      endif
      v1:= {"Local", "Desc_Local", "Produto", "Desc_Prod", ;
         "Tamanho", "Estoque"}
      v2:= {"99999", "@!", "", "", ""}
      v3:= {"Loc", "Descricao", "Produto", "Descricao", "Tam", ;
         "Estoque"}
      ddtinicio:= {1, 1, 1, 1, 1, 1}
      ccoluna:= " Consulta de Estoque "
      consulta("Estoque", 3, 1, 21, 78, v1, v2, v3, ddtinicio, ;
         "NULO", ccoluna)
      lcontrole:= .F.
   enddo
   close
   set color to (ccor)
   RestScreen(0, 0, 24, 79, ctela)
   return

********************************
function GERTEMP322(Arg1)

   local Local1
   Local1:= .F.
   select 2
   if (!abredbf("CLIENTES", "CLIENTE1.NTX"))
      return .F.
   endif
   seek Arg1
   if (Found())
      @  2,  2 say nome_cli
   else
      @  3,  2 say "**** Clientes nao cadastrado ***** "
   endif
   select 1
   use (dbcreate)
   select 2
   if (!abredbf("CONTASRE", "CONTRE2.NTX"))
      return .F.
   endif
   seek Arg1
   if (Found())
      do while (Arg1 = cod_cli_re .AND. !EOF())
         ddt_venc:= dt_venc_re
         nval_tit:= val_tit_re
         situaca_ar:= ddt_pgto
         ddtvenc:= num_doc_re
         nval_rece:= vl_rece_re
         nvlrece:= dt_rece_re
         select 1
         if (!adiciona())
            return .F.
         endif
         replace codigo_cli with Arg1
         replace tip_doc with ddt_venc
         replace num_doc with ddtvenc
         replace dt_venc with nval_tit
         replace val_tit with situaca_ar
         replace val_rece with nval_rece
         replace dt_rece with nvlrece
         select 2
         skip 
         nlinha++
      enddo
   endif
   select 2
   if (!abredbf("CONTASAR", "CONTAR2.NTX"))
      return .F.
   endif
   seek Arg1
   if (Found())
      if (Local1)
         nlinha++
      endif
      do while (Arg1 = cod_cli_ar .AND. !EOF())
         ddt_venc:= ctipo
         nval_tit:= dt_venc_ar
         situaca_ar:= val_tit_ar
         ddtvenc:= num_doc_ar
         select 1
         if (!adiciona())
            return .F.
         endif
         replace codigo_cli with Arg1
         replace tip_doc with ddt_venc
         replace num_doc with ddtvenc
         replace dt_venc with nval_tit
         replace val_tit with situaca_ar
         select 2
         skip 
         nlinha++
      enddo
   endif
   select 1
   return

********************************
procedure QSR3211

   private ncodigo, ddtfim, dbclearrel, crecpag, impvid, nlinha, ;
      ncoluna, ccor, ctela, valpess
   private lcontrole, ncont, v1[5], v2[5], v3[5], ddtinicio[5], vet[2]
   cpesquisa:= {"BANCOS", "BANCOS1", "CONTA_BC", "nConta"}
   ccampos:= {"CONTA_BC", "NOM_BAN_BC", "", "CONTA", ;
      "NOME DA CONTA", ""}
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   nconta:= 0
   ccor:= SetColor()
   ncont:= 0
   lcontrole:= .T.
   nlinha:= 10
   ncoluna:= 19
   ctela:= SaveScreen(0, 0, 24, 79)
   lcontrole:= .T.
   vet[1]:= "Sim"
   vet[2]:= "NÆo"
   do while (lcontrole)
      janela(nlinha, ncoluna, nlinha + 4, ncoluna + 43, ;
         "Consulta de Saldos Contas Correntes")
      @ nlinha + 1, ncoluna + 2 say "Conta"
      @ nlinha + 2, ncoluna + 2 get nConta picture "99999999999999"
      read
      if (sai())
         loop
      endif
      if (!abredbf("BANCOS", "BANCOS1.NTX"))
         loop
      endif
      if (Empty(nconta))
      elseif (!Empty(nconta))
         set filter to Conta_Bc == nConta
      endif
      v1:= {"Conta_Bc", "Nom_Ban_Bc", "Ag_Ban_Bc", "Saldo_bc", ;
         "Sa_Conf_Bc"}
      v2:= {"99999999999999", "@!", "", "", "9.999.999,99"}
      v3:= {"Conta", "Nome do Banco", "Ag.", "Saldo", "Saldo Conf."}
      ddtinicio:= {1, 1, 1, 1, 1}
      ccoluna:= " Consulta de Saldos Bancarios "
      consulta("Bancos", 3, 1, 21, 78, v1, v2, v3, ddtinicio, ;
         "PesConTes", ccoluna)
      close databases
      select 1
      close format
      nconta:= 0
   enddo
   set color to (ccor)
   RestScreen(0, 0, 24, 79, ctela)

********************************
function GERTEMP236(Arg1)

   select 3
   if (!abredbf("ENT_MAT", "ENT_MAT1.NTX"))
      return .F.
   endif
   select 4
   if (!abredbf("PRODUTOS", "PRODUTO1.NTX"))
      return .F.
   endif
   select 2
   use (carq2)
   zap
   select 3
   seek Arg1
   if (Found())
      do while (Arg1 = num_docto .AND. !EOF())
         ccodigo:= codigo_mat
         nquant:= quantidade
         cdebcred:= data_orc
         select 4
         seek ccodigo
         if (Found())
            cdesc:= descricao
         else
            cdesc:= "Referencia nao cadastrada "
         endif
         select 2
         if (!adiciona())
            return .F.
         endif
         replace codigo_mat with ccodigo
         replace quantidade with nquant
         replace valor with cdebcred
         replace descricao with cdesc
         select 3
         skip 
         nlinha++
      enddo
   endif
   select 3
   close
   select 4
   close
   return

********************************
function QSR3212

   private nlinha, ncoluna, ctela, ccor, lcontrole, v1[6], v2[6], ;
      v3[6], ddtinicio[6]
   private vet[2]
   cpesquisa:= {"BANCOS", "BANCOS1", "CONTA_BC", "nConta"}
   ccampos:= {"CONTA_BC", "NOM_BAN_BC", "", "CONTA", ;
      "NOME DA CONTA", ""}
   programa(0, 69, coropcoes)
   nlinha:= 11
   ncoluna:= 19
   ctela:= SaveScreen(0, 0, 24, 79)
   lcontrole:= .T.
   nconta:= 0
   ddtfim:= CToD("  /  /  ")
   dbclearrel:= CToD("  /  /  ")
   vet[1]:= "Sim"
   vet[2]:= "NÆo"
   janela(nlinha, ncoluna, nlinha + 6, ncoluna + 43, ;
      "Consulta de Movimento Contas Correntes")
   nlinha++
   @ nlinha, ncoluna + 2 say "Conta"
   @ nlinha + 2, ncoluna + 2 say "Data Inicial"
   @ nlinha + 2, ncoluna + 19 say "Data Final  "
   do while (lcontrole)
      processand(.F.)
      @ nlinha + 1, ncoluna + 2 get nConta picture "99999999999999" ;
         valid nconta != 0
      @ nlinha + 3, ncoluna + 2 get dDtInicio
      @ nlinha + 3, ncoluna + 19 get dDtFim
      read
      if (sai())
         loop
      endif
      if (Empty(ddtfim))
         ddtfim:= CToD("01/01/91")
      endif
      if (Empty(dbclearrel))
         dbclearrel:= CToD("31/12/10")
      endif
      if (!abredbf("MOV_BCO"))
         loop
      endif
      set index to MV_BCO2, MV_BCO3
      set filter to Conta_MB == nConta .AND. Data_MB >= dDtInicio ;
         .AND. Data_MB <= dDtFim
      select 2
      if (!abredbf("BANCOS", "BANCOS1.NTX"))
         loop
      endif
      select 1
      v1:= {"Data_MB", "Histor_MB", "Docto_MB", "DebCred_MB", ;
         "Valor_MB", "Confir_MB"}
      v2:= {"99999", "@!", "", "", "9.999.999,99", ""}
      v3:= {"Data", "Historico", "Docto", "DebCred", "Valor", "Conf"}
      ddtinicio:= {1, 1, 1, 1, 1, 1}
      ccoluna:= " Consulta de Movimento Banc rio "
      consulta("Mov_Bco", 4, 0, 21, 79, v1, v2, v3, ddtinicio, ;
         "PesConMB", ccoluna)
      close databases
      select 1
      close format
      nconta:= 0
      ddtfim:= CToD("  /  /  ")
      dbclearrel:= CToD("  /  /  ")
   enddo
   set color to (ccor)
   RestScreen(0, 0, 24, 79, ctela)
   return Nil

********************************
function PESCONAP

   private nvlricms, ddtvenc, nnumped, pesq23i, nvalortit, pagamento
   private cnumdoc, ddataultc, nlinha, ncoluna, ntecla, lcontrole, ;
      ccor, ncont
   private cdesp, nloja
   ccor:= SetColor()
   ddtvenc:= Space(10)
   nvlricms:= 0
   nnumped:= Space(8)
   pesq23i:= 0
   nvalortit:= CToD("  /  /  ")
   pagamento:= CToD("  /  /  ")
   cnumdoc:= 0
   cdesp:= 0
   ddataultc:= Space(40)
   nloja:= 0
   nlinha:= 5
   ncoluna:= 19
   ccor:= SetColor()
   ctel2:= SaveScreen(0, 0, 24, 79)
   ntecla:= 0
   lcontrole:= .T.
   janela(nlinha - 1, ncoluna, nlinha + 13, ncoluna + 43, ;
      "ZOOM de Contas a Pagar")
   nvlricms:= contasap->tip_doc_ap
   ddtvenc:= contasap->cod_for_ap
   nnumped:= contasap->num_ped_ap
   pesq23i:= contasap->dt_emis_ap
   nvalortit:= contasap->val_icm_ap
   pagamento:= contasap->dt_venc_ap
   cnumdoc:= contasap->val_tit_ap
   cdesp:= contasap->obs_ap
   ddataultc:= contasap->qsr24a
   nloja:= contasap->loja
   cnomfor:= SubStr(ncodfor1->nome, 1, 22)
   num_doc_pg()
   clear gets
   do while (lcontrole)
      ntecla:= InKey(0)
      if (ntecla == 27)
         lcontrole:= .F.
      endif
   enddo
   lcontrole:= .T.
   set color to (ccor)
   RestScreen(0, 0, 24, 79, ctel2)
   return Nil

********************************
procedure QSR3221

   private ncodigo, ddtfim, dbclearrel, crecpag, impvid, nlinha, ;
      ncoluna, ccor, ctela, valpess
   private lcontrole, ncont, v1[6], v2[6], v3[6], ddtinicio[6], vet[2]
   cpesquisa:= {"FORNECED", "FORNECE2", "CODIGO_FOR", "nCodigo"}
   ccampos:= {"CODIGO_FOR", "NOME", "", "CODIGO", "NOME", ""}
   set escape on
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   ncodigo:= 0
   ddtfim:= CToD("  /  /  ")
   dbclearrel:= CToD("  /  /  ")
   crecpag:= Space(1)
   impvid:= Space(1)
   ccor:= SetColor()
   ncont:= 0
   lcontrole:= .T.
   nlinha:= 10
   ncoluna:= 19
   ctela:= SaveScreen(0, 0, 24, 79)
   lcontrole:= .T.
   vet[1]:= "Sim"
   vet[2]:= "NÆo"
   do while (lcontrole)
      processand(.F.)
      janela(nlinha, ncoluna, nlinha + 8, ncoluna + 43, ;
         "Pesquisa de Contas a Pagar/Pagas")
      @ nlinha + 1, ncoluna + 2 say "Data Inicial"
      @ nlinha + 1, ncoluna + 20 say "Data Final  "
      @ nlinha + 3, ncoluna + 2 say "Em Aberto(A) ou Baixadas(B)"
      @ nlinha + 5, ncoluna + 2 say "Fornecedor  "
      @ nlinha + 2, ncoluna + 2 get dDtInicio
      @ nlinha + 2, ncoluna + 20 get dDtFim
      @ nlinha + 4, ncoluna + 2 get cRecPag picture "!" valid ;
         crecpag $ "AB"
      @ nlinha + 6, ncoluna + 2 get nCodigo picture "99999"
      read
      if (sai())
         loop
      endif
      if (Empty(ddtfim))
         ddtfim:= CToD("01/01/91")
      endif
      if (Empty(dbclearrel))
         dbclearrel:= CToD("31/12/10")
      endif
      if (crecpag == "A")
         if (!abredbf("CONTASAP"))
            loop
         endif
         set index to CONTAP3, CONTAP2
         if (ncodigo != 0)
            set filter to DT_VENC_AP >= DDTINICIO .AND. DT_VENC_AP ;
               <= DDTFIM .AND. COD_FOR_AP == nCodigo
         else
            set filter to DT_VENC_AP >= DDTINICIO .AND. DT_VENC_AP ;
               <= DDTFIM
         endif
         select 2
         if (!abredbf("FORNECED", "FORNECE1.NTX"))
            loop
         endif
         select 1
         if (.T.)
            dbSetRelation()
         endif
         confmovbc("FORNECED", {|| tip_doc_ap}, "COD_FOR_AP")
         v1:= {"Cod_For_AP", "NOME", "Tip_Doc_AP", "Num_Doc_AP", ;
            "Val_Tit_AP", "Dt_Venc_AP", "OBS_AP"}
         v2:= {"99999", "@!", "", "", "9.999.999,99", "", ""}
         v3:= {"Cod;For", "Nome do Fornecedor", "Tip;Doc", ;
            "Num;Doc", "Valor", "Data;Vencto", "Observacao"}
         ddtinicio:= {1, 2, 1, 1, 1, 1, 1}
         ccoluna:= " Consulta de contas a Pagar "
         consulta("ContasAP", 3, 1, 21, 78, v1, v2, v3, ddtinicio, ;
            "PesConAP", ccoluna)
         close databases
         select 1
         close format
      elseif (crecpag == "B")
         if (!abredbf("CONTASPG"))
            loop
         endif
         set index to CONTPG3, CONTPG2
         if (ncodigo != 0)
            set filter to DT_PGTO_PG >= DDTINICIO .AND. DT_PGTO_PG ;
               <= DDTFIM .AND. COD_FOR_PG == nCodigo
         else
            set filter to DT_PGTO_PG >= DDTINICIO .AND. DT_PGTO_PG ;
               <= DDTFIM
         endif
         select 2
         if (!abredbf("FORNECED", "FORNECE1.NTX"))
            loop
         endif
         select 1
         if (.T.)
            dbSetRelation()
         endif
         confmovbc("FORNECED", {|| tip_doc_pg}, "COD_FOR_PG")
         v1:= {"Cod_For_PG", "NOME", "Tip_Doc_PG", "Num_Doc_PG", ;
            "Vl_Pgto_PG", "Dt_Pgto_PG", "Obs_Pg"}
         v2:= {"99999", "@!", "", "", "9.999.999,99", "", ""}
         v3:= {"Cod;For", "Nome do Fornecedor", "Tip;Doc", ;
            "Num;Doc", "Valor", "Data;Pagto", "Observacao"}
         ddtinicio:= {1, 2, 1, 1, 1, 1, 1}
         ccoluna:= " Consulta de Contas Pagas "
         consulta("ContasPG", 3, 1, 21, 78, v1, v2, v3, ddtinicio, ;
            "PesConPG", ccoluna)
         close databases
         select 1
         close format
      endif
   enddo
   set color to (ccor)
   RestScreen(0, 0, 24, 79, ctela)
   return

********************************
function PESCONCS

   local Local1, Local2, Local3, Local4, Local5, Local6, Local7, ;
      Local8, Local9, Local10, Local11, Local12, Local13, Local14
   private vetor1[4], vetor2[4], vetor3[4], vetor4[4]
   Local9:= 7
   Local10:= 19
   Local13:= SetColor()
   Local11:= 0
   Local12:= .T.
   observacao:= numero
   gertemp232(observacao)
   close
   select 2
   use (carq2)
   vetor1:= {"Codigo_Mat", "Descricao", "Quantidade", "Valor"}
   vetor2:= {"", "", "", ""}
   vetor3:= {"Codigo", "Descricao", "Quantidade", "Valor"}
   vetor4:= {2, 2, 2, 2}
   ccoluna:= " Consultas de Produtos de Pedidos "
   consped(Nil, Local9, 1, Local9 + 11, Local10 + 59, vetor1, ;
      vetor2, vetor3, vetor4, ccoluna)
   select 1
   set color to (Local13)
   keyboard " "
   return Nil

********************************
procedure QSR3222

   private ncodcli, ddtfim, dbclearrel, crecpag, nlinha, ncoluna, ;
      ccor, ctela, valpess
   private lcontrole, ncont, v1[6], v2[6], v3[6], ddtinicio[6], ;
      vet[2], ccor, ccondicao
   set key K_F10 to nlocaliza
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   ncodcli:= 0
   ddtfim:= CToD("  /  /  ")
   dbclearrel:= CToD("  /  /  ")
   crecpag:= Space(1)
   ccondicao:= Space(1)
   nlinha:= 3
   ncoluna:= 1
   ncont:= 0
   lcontrole:= .T.
   nlinha:= 10
   ncoluna:= 19
   ctela:= SaveScreen(0, 0, 24, 79)
   vet[1]:= "Sim"
   vet[2]:= "NÆo"
   tela23:= 0
   do while (lcontrole)
      processand(.F.)
      janela(nlinha, ncoluna, nlinha + 8, ncoluna + 43, ;
         "Pesquisa de Contas a Receber/Recebidas")
      @ nlinha + 1, ncoluna + 2 say "Data Inicial"
      @ nlinha + 1, ncoluna + 20 say "Data Final  "
      @ nlinha + 3, ncoluna + 2 say "Em Aberto(A) ou Baixadas(B)"
      @ nlinha + 5, ncoluna + 2 say "Cliente "
      @ nlinha + 5, ncoluna + 10 say "Local "
      @ nlinha + 2, ncoluna + 2 get dDtInicio
      @ nlinha + 2, ncoluna + 20 get dDtFim
      @ nlinha + 4, ncoluna + 2 get cRecPag picture "!" valid ;
         crecpag $ "AB"
      @ nlinha + 6, ncoluna + 2 get nCodCli picture "99999"
      @ nlinha + 6, ncoluna + 10 get nLocaliza picture "99999"
      read
      if (sai())
         loop
      endif
      if (Empty(ddtfim))
         ddtfim:= CToD("01/01/91")
      endif
      if (Empty(dbclearrel))
         dbclearrel:= CToD("31/12/10")
      endif
      select 2
      if (!abredbf("CLIENTES", "CLIENTE1.NTX"))
         loop
      endif
      if (crecpag == "A")
         select 1
         if (!abredbf("CONTASAR"))
            loop
         endif
         set index to ContAr3, ContAr2, ContAr1
         if (tela23 == 0)
            if (ncodcli != 0)
               set filter to DT_VENC_AR >= DDTINICIO .AND. ;
                  DT_VENC_AR <= DDTFIM .AND. COD_CLI_AR == nCodCli
            else
               set filter to DT_VENC_AR >= DDTINICIO .AND. ;
                  DT_VENC_AR <= DDTFIM
            endif
         elseif (ncodcli != 0)
            set filter to DT_VENC_AR >= DDTINICIO .AND. DT_VENC_AR ;
               <= DDTFIM .AND. COD_CLI_AR == nCodCli .AND. Localiza ;
               == nLocaliza
         else
            set filter to DT_VENC_AR >= DDTINICIO .AND. DT_VENC_AR ;
               <= DDTFIM .AND. Localiza == nLocaliza
         endif
         select 1
         if (.T.)
            dbSetRelation()
         endif
         confmovbc("CLIENTES", {|| cod_cli_ar}, "COD_CLI_AR")
         v1:= {"Cod_Cli_AR", "NOME_Cli", "Tip_Doc_AR", "Num_Doc_AR", ;
            "Val_Tit_AR", "Dt_Venc_AR", "Localiza"}
         v2:= {"99999", "@!", "", "", "9.999.999,99", "", ""}
         v3:= {"Codigo;Cliente", "Nome;Cliente", "Tip;Doc", ;
            "Numero;Documento", "Valor", "Data;Vencto", "Local"}
         ddtinicio:= {1, 2, 1, 1, 1, 1, 1}
         ccoluna:= " Consultas de Contas a Receber "
         consulta("ContasAr", 3, 1, 21, 78, v1, v2, v3, ddtinicio, ;
            "PesConAR", ccoluna)
         close databases
         select 1
         close format
      elseif (crecpag == "B")
         select 1
         if (!abredbf("CONTASRE"))
            loop
         endif
         set index to CONTRE3, CONTRE2
         if (tela23 == 0)
            if (ncodcli != 0)
               set filter to DT_RECE_RE >= DDTINICIO .AND. ;
                  DT_RECE_RE <= DDTFIM .AND. COD_CLI_RE == nCodCli
            else
               set filter to DT_RECE_RE >= DDTINICIO .AND. ;
                  DT_RECE_RE <= DDTFIM
            endif
         elseif (ncodcli != 0)
            set filter to DT_RECE_RE >= DDTINICIO .AND. DT_RECE_RE ;
               <= DDTFIM .AND. COD_CLI_RE == nCodCli .AND. Localiza ;
               == nLocaliza
         else
            set filter to DT_RECE_RE >= DDTINICIO .AND. DT_RECE_RE ;
               <= DDTFIM .AND. Localiza == nLocaliza
         endif
         select 1
         if (.T.)
            dbSetRelation()
         endif
         confmovbc("CLIENTES", {|| cod_cli_re}, "COD_CLI_RE")
         v1:= {"Cod_Cli_RE", "NOME_Cli", "Tip_Doc_RE", "Num_Doc_RE", ;
            "Vl_Rece_RE", "Dt_Rece_RE", "Localiza"}
         v2:= {"99999", "@!", "", "", "9.999.999,99", "", ""}
         v3:= {"Codigo;Cliente", "Nome;Cliente", "Tip;Doc", ;
            "Numero;Documento", "Valor", "Data;Receb", "Local"}
         ddtinicio:= {1, 2, 1, 1, 1, 1, 1}
         ccoluna:= " Consultas de Contas Recebidas "
         consulta("ContasRE", 3, 1, 21, 78, v1, v2, v3, ddtinicio, ;
            "PesConRE", ccoluna)
      endif
      close databases
      select 1
      close format
   enddo
   set color to (ccor)
   RestScreen(0, 0, 24, 79, ctela)
   return

********************************
function PESCONPRO

   private ncodcli, ddtvenc, nnumped, pesq23i, nvalortit, pagamento
   private cnumdoc, ddataultc, nlinha, ncoluna, ntecla, lcontrole, ;
      ccor, ncont
   ccor:= SetColor()
   ddtvenc:= Space(10)
   ncodcli:= 0
   nnumped:= Space(8)
   pesq23i:= 0
   nvalortit:= CToD("  /  /  ")
   pagamento:= CToD("  /  /  ")
   cnumdoc:= 0
   ddataultc:= Space(40)
   nlinha:= 7
   ncoluna:= 19
   ccor:= SetColor()
   ctel2:= SaveScreen(0, 0, 24, 79)
   ntecla:= 0
   lcontrole:= .T.
   janela(nlinha - 1, ncoluna, nlinha + 13, ncoluna + 43, ;
      "ZOOM de Titulo a Receber")
   ncodcli:= contasar->cod_cli_ar
   ddtvenc:= contasar->num_doc_ar
   nnumped:= contasar->ctipo
   pesq23i:= contasar->dt_emis_ar
   nvalortit:= contasar->obs_ar
   pagamento:= contasar->dt_venc_ar
   cnumdoc:= contasar->val_tit_ar
   ddataultc:= contasar->localiza
   tela23:= local23i
   cnomcli:= SubStr(clientes->nome_cli, 1, 22)
   num_ped_ar()
   @ nlinha + 1, ncoluna + 20 say cnomcli
   clear gets
   qsr23a(tela23)
   select CONTASAR
   do while (lcontrole)
      ntecla:= InKey(0)
      if (ntecla == 27)
         lcontrole:= .F.
      endif
   enddo
   set color to (ccor)
   RestScreen(0, 0, 24, 79, ctel2)
   return Nil

********************************
function PESCONRE

   local Local1, Local2, Local3, Local4, Local5, Local6, Local7, ;
      Local8, Local9, Local10, Local11, Local12, Local13, Local14, ;
      Local15, Local16
   Local9:= 5
   Local10:= 19
   Local11:= SetColor()
   ctel2:= SaveScreen(0, 0, 24, 79)
   ntecla:= 0
   lcontrole:= .T.
   janela(Local9, Local10, Local9 + 16, Local10 + 43, ;
      "ZOOM de Titulo Baixado")
   Local9++
   Local2:= num_doc_re
   Local1:= cod_cli_re
   Local3:= dt_venc_re
   Local4:= dt_emis_re
   Local5:= obs_re
   Local6:= val_tit_re
   Local7:= ddt_pgto
   Local8:= dt_loc_re
   tela23:= local23i
   num_ped_re:= conta_re
   nvlrece:= dt_rece_re
   ncontadest:= vl_rece_re
   dt_loc_ar:= qsr24i
   @ Local9, Local10 + 2 say "Cod. Cliente      Nome do Cliente"
   @ Local9 + 2, Local10 + 2 say "N§ Documento"
   @ Local9 + 2, Local10 + 20 say "Tipo Documento"
   @ Local9 + 4, Local10 + 2 say "N§ Pedido"
   @ Local9 + 4, Local10 + 20 say "Valor T¡tulo"
   @ Local9 + 6, Local10 + 2 say "Localizacao"
   @ Local9 + 8, Local10 + 2 say "Data Emisso"
   @ Local9 + 8, Local10 + 20 say "Data Vencimento"
   @ Local9 + 10, Local10 + 2 say "Data Recebimento"
   @ Local9 + 10, Local10 + 20 say "Valor Recebido"
   @ Local9 + 12, Local10 + 2 say "Observao"
   @ Local9 + 1, Local10 + 2 get nCodCli picture "99999"
   @ Local9 + 3, Local10 + 2 get cNumDoc picture "@!"
   @ Local9 + 3, Local10 + 20 get cTipoDoc picture "@!"
   @ Local9 + 5, Local10 + 2 get nNumPed picture "999999"
   @ Local9 + 5, Local10 + 20 get nValorTit picture ;
      "@E 999,999,999.99"
   @ Local9 + 7, Local10 + 2 get nLocaliza picture "99999" valid ;
      qsr23a(tela23)
   @ Local9 + 9, Local10 + 2 get dDtEmissao valid Local5 != ;
      CToD("  /  /  ")
   @ Local9 + 9, Local10 + 20 get dDtVenc valid Local6 != ;
      CToD("  /  /  ")
   @ Local9 + 11, Local10 + 2 get dDtRece valid nvlrece != ;
      CToD("  /  /  ")
   @ Local9 + 11, Local10 + 20 get nVlRece picture ;
      "@E 999,999,999.99" valid ncontadest > 0
   @ Local9 + 13, Local10 + 2 get cObs picture "@!"
   qsr23a(tela23)
   clear gets
   do while (lcontrole)
      ntecla:= InKey(0)
      if (ntecla == 27)
         lcontrole:= .F.
      endif
   enddo
   set color to (Local11)
   RestScreen(0, 0, 24, 79, ctel2)
   return Nil

********************************
function QSR3223

   private ncodigo, ddtfim, dbclearrel, crecpag, impvid, nlinha, ;
      ncoluna, ccor, ctela, valpess
   private lcontrole, ncont, v1[5], v2[5], v3[5], ddtinicio[5], vet[2]
   private ntot_diar, ntot_diap, npag, ntotp, ntotr, nsaldocon, ;
      nlin, ddata1
   private vsaldos[3, 4], dbcreate, ntot_diar, ntot_diap, ntotp, ;
      ntotr, nsaldocon, nlin
   ntot_diar:= 0
   ntot_diap:= 0
   ntotp:= 0
   ntotr:= 0
   nsaldocon:= 0
   nlin:= 6
   set escape on
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   ntot_diar:= 0
   ntot_diap:= 0
   npag:= 0
   ntotp:= 0
   ntotr:= 0
   nsaldocon:= 0
   nlin:= 6
   ccor:= SetColor()
   ncont:= 0
   lcontrole:= .T.
   nlinha:= 3
   ncoluna:= 11
   ctela:= SaveScreen(0, 0, 24, 79)
   lcontrole:= .T.
   vet[1]:= "Sim"
   vet[2]:= "NÆo"
   ncont:= 1
   dbcreate:= "Saldo" + LTrim(Str(ncont)) + ".DBF"
   do while (file(dbcreate))
      ncont++
      dbcreate:= "Saldo" + LTrim(Str(ncont)) + ".DBF"
   enddo
   processand(.T.)
   vsaldos[1]:= {"Dt_Venc", "D", 8, 0}
   vsaldos[2]:= {"Val_Tit", "N", 14, 2}
   vsaldos[3]:= {"Rec_Pag", "C", 1, 0}
   cprod(dbcreate, vsaldos)
   if (!abredbf(dbcreate))
      return .F.
   endif
   select 2
   if (!abredbf("CONTASAR"))
      close databases
      select 1
      close format
      return .F.
   endif
   goto top
   do while (!EOF() .AND. lcontrole)
      if (impcontasr == "P")
         skip 
         loop
      endif
      nval_tit:= dt_venc_ar
      situaca_ar:= val_tit_ar
      crec_pag:= "R"
      skip 
      select 1
      if (!adiciona())
         loop
      endif
      replace dt_venc with nval_tit
      replace val_tit with situaca_ar
      replace rec_pag with crec_pag
      select 2
   enddo
   select 2
   if (!abredbf("CONTASAP"))
      return .F.
   endif
   goto top
   do while (!EOF() .AND. lcontrole)
      nval_tit:= dt_venc_ap
      situaca_ar:= val_tit_ap
      crec_pag:= "P"
      skip 
      select 1
      if (!adiciona())
         loop
      endif
      replace dt_venc with nval_tit
      replace val_tit with situaca_ar
      replace rec_pag with crec_pag
      select 2
   enddo
   select 1
   ccoluna:= " Consulta de Saldos a Pagar e Receber "
   set color to W+/BG
   janela(nlinha, ncoluna, nlinha + 19, ncoluna + 55, ccoluna)
   @ nlinha + 1, ncoluna + 1 say ;
      " Data     Receber         Pagar          Saldo        "
   @ nlinha + 2, ncoluna + 0 to nlinha + 17, ncoluna + 9
   @ nlinha + 2, ncoluna + 9 to nlinha + 17, ncoluna + 25
   @ nlinha + 2, ncoluna + 25 to nlinha + 17, ncoluna + 40
   @ nlinha + 2, ncoluna + 40 to nlinha + 17, ncoluna + 55
   @ nlinha + 2, ncoluna + 9 say "Â"
   @ nlinha + 2, ncoluna + 25 say "Â"
   @ nlinha + 2, ncoluna + 40 say "Â"
   @ nlinha + 2, ncoluna + 55 say "Â"
   @ nlinha + 17, ncoluna + 9 say "Á"
   @ nlinha + 17, ncoluna + 25 say "Á"
   @ nlinha + 17, ncoluna + 40 say "Á"
   @ nlinha + 17, ncoluna + 55 say "Á"
   set color to G+/G
   @ nlinha, ncoluna to nlinha + 19, ncoluna + 55 double
   set color to W+/BG
   cseimp:= SubStr(dbcreate, 1, 6)
   index on DT_VENC to (cseimp)
   goto top
   processand(.F.)
   do while (!EOF())
      ddata1:= dt_venc
      do while (ddata1 = dt_venc)
         if (rec_pag = "P")
            ntot_diap:= ntot_diap + val_tit
         elseif (rec_pag = "R")
            ntot_diar:= ntot_diar + val_tit
         endif
         skip 
      enddo
      nsaldocon:= nsaldocon + ntot_diar - ntot_diap
      ntotp:= ntotp + ntot_diap
      ntotr:= ntotr + ntot_diar
      @ nlin, ncoluna + 1 say ddata1
      @ nlin, ncoluna + 10 say ntot_diar picture "9,999,999.99"
      @ nlin, ncoluna + 26 say ntot_diap picture "9,999,999.99"
      if (nsaldocon < 0)
         ccor32:= SetColor()
         set color to R/BG
         @ nlin, ncoluna + 41 say nsaldocon picture "9,999,999.99"
         set color to (ccor32)
      else
         @ nlin, ncoluna + 41 say nsaldocon picture "9,999,999.99"
      endif
      nlin++
      @ nlinha + 18, ncoluna + 2 say "Totais"
      @ nlinha + 18, ncoluna + 10 say ntotr picture "9,999,999.99"
      @ nlinha + 18, ncoluna + 26 say ntotp picture "9,999,999.99"
      @ nlinha + 18, ncoluna + 41 say nsaldocon picture "9,999,999.99"
      if (nlin = nlinha + 17)
         if (conflinha("Continua", 23, 2))
            nlin:= 6
            set color to W+/BG
            janela(nlinha, ncoluna, nlinha + 19, ncoluna + 55, ;
               ccoluna)
            @ nlinha + 1, ncoluna + 1 say ;
               " Data     Receber         Pagar          Saldo        "
            @ nlinha + 2, ncoluna + 0 to nlinha + 17, ncoluna + 9
            @ nlinha + 2, ncoluna + 9 to nlinha + 17, ncoluna + 25
            @ nlinha + 2, ncoluna + 25 to nlinha + 17, ncoluna + 40
            @ nlinha + 2, ncoluna + 40 to nlinha + 17, ncoluna + 55
            @ nlinha + 2, ncoluna + 9 say "Â"
            @ nlinha + 2, ncoluna + 25 say "Â"
            @ nlinha + 2, ncoluna + 40 say "Â"
            @ nlinha + 2, ncoluna + 55 say "Â"
            @ nlinha + 17, ncoluna + 9 say "Á"
            @ nlinha + 17, ncoluna + 25 say "Á"
            @ nlinha + 17, ncoluna + 40 say "Á"
            @ nlinha + 17, ncoluna + 55 say "Á"
            set color to G+/G
            @ nlinha, ncoluna to nlinha + 19, ncoluna + 55 double
            set color to W+/BG
         else
            close
         endif
      endif
      ntot_diar:= 0
      ntot_diap:= 0
   enddo
   InKey(0)
   RestScreen(0, 0, 24, 79, ctela)
   close databases
   select 1
   close format
   impritrans(dbcreate)
   impritrans(SubStr(dbcreate, 1, 6) + ".NTX")
   return

********************************
procedure QSR3241

   private ncodigo, ddtfim, dbclearrel, crecpag, impvid, nlinha, ;
      ncoluna, ccor, ctela, valpess
   private lcontrole, ncont, v1[5], v2[5], v3[5], ddtinicio[5], vet[2]
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   ncodigo:= 0
   ccor:= SetColor()
   ncont:= 0
   lcontrole:= .T.
   nlinha:= 10
   ncoluna:= 19
   ctela:= SaveScreen(0, 0, 24, 79)
   lcontrole:= .T.
   vet[1]:= "Sim"
   vet[2]:= "NÆo"
   do while (lcontrole)
      processand(.F.)
      janela(nlinha, ncoluna, nlinha + 4, ncoluna + 43, ;
         "Consulta de saldos de funcionarios")
      @ nlinha + 1, ncoluna + 2 say "Codigo do Funcionario"
      @ nlinha + 2, ncoluna + 2 get nCodigo picture "99999"
      read
      if (sai())
         loop
      endif
      if (!abredbf("FUNCIONA", "FUNCION2.NTX"))
         loop
      endif
      if (Empty(ncodigo))
      elseif (!Empty(ncodigo))
         set filter to Codigo_Fun == nCodigo
      endif
      v1:= {"Codigo_Fun", "Nome", "Status", "Saldo"}
      v2:= {"99999", "@!", "", "", "9.999.999,99"}
      v3:= {"Codigo", "Nome do Funcionario", "Cargo", "Saldo"}
      ddtinicio:= {1, 1, 1, 1}
      ccoluna:= " Consulta de Saldos de Funcionarios "
      consulta("Funciona", 3, 1, 21, 78, v1, v2, v3, ddtinicio, ;
         "PesConTes", ccoluna)
      close databases
      select 1
      close format
      ncodigo:= 0
   enddo
   set color to (ccor)
   RestScreen(0, 0, 24, 79, ctela)

********************************
function QSR3224

   private ncodigo, ddtfim, dbclearrel, crecpag, nlinha, ncoluna, ;
      ccor, ctela, valpess
   private lcontrole, ncont, v1[6], v2[6], v3[6], ddtinicio[6], ;
      vet[2], ccor
   set escape on
   cpesquisa:= {"CLIENTES", "CLIENTE2", "CODIGO_CLI", "nCodigo"}
   ccampos:= {"CODIGO_CLI", "NOME_CLI", "", "CODIGO", "NOME", ""}
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   ncodigo:= 0
   ddtfim:= CToD("  /  /  ")
   dbclearrel:= CToD("  /  /  ")
   crecpag:= Space(1)
   ncont:= 0
   lcontrole:= .T.
   nlinha:= 10
   ncoluna:= 19
   ctela:= SaveScreen(0, 0, 24, 79)
   vet[1]:= "Sim"
   vet[2]:= "NÆo"
   do while (lcontrole)
      processand(.F.)
      janela(nlinha, ncoluna, nlinha + 6, ncoluna + 43, ;
         "Pesquisa de Titulos em Protesto")
      @ nlinha + 1, ncoluna + 2 say "Data Inicial"
      @ nlinha + 1, ncoluna + 20 say "Data Final  "
      @ nlinha + 3, ncoluna + 2 say "Cliente "
      @ nlinha + 2, ncoluna + 2 get dDtInicio
      @ nlinha + 2, ncoluna + 20 get dDtFim
      @ nlinha + 4, ncoluna + 2 get nCodigo picture "99999"
      read
      if (sai())
         loop
      endif
      if (!abredbf("CONTASAR"))
         loop
      endif
      set index to CONTAR3, CONTAR2
      if (Empty(ddtfim))
         ddtfim:= CToD("01/01/01")
      endif
      if (Empty(dbclearrel))
         dbclearrel:= CToD("31/12/99")
      endif
      if (ncodigo != 0)
         set filter to DT_VENC_AR >= DDTINICIO .AND. DT_VENC_AR <= ;
            DDTFIM .AND. COD_CLI_AR == nCodigo .AND. Situaca_AR = "P"
      else
         set filter to DT_VENC_AR >= DDTINICIO .AND. DT_VENC_AR <= ;
            DDTFIM .AND. Situaca_AR = "P"
      endif
      select 2
      if (!abredbf("CLIENTES", "CLIENTE1.NTX"))
         loop
      endif
      select 1
      if (.T.)
         dbSetRelation()
      endif
      confmovbc("CLIENTES", {|| cod_cli_ar}, "COD_CLI_AR")
      v1:= {"Cod_Cli_AR", "Nome_Cli", "Tip_Doc_AR", "Num_Doc_AR", ;
         "Val_Tit_AR", "Dt_Venc_AR"}
      v2:= {"99999", "@!", "", "", "@E 9.999.999,99", ""}
      v3:= {"Cod;Cli", "Nome;Cliente", "Tip;Doc", "Num;Doc", ;
         "Valor", "Data;Vencto"}
      ddtinicio:= {1, 2, 1, 1, 1, 1}
      ccoluna:= " Consultas de T¡tulos em Protesto "
      consulta("ContasAr", 3, 1, 21, 78, v1, v2, v3, ddtinicio, ;
         "PesConPRO", ccoluna)
      close databases
      select 1
      close format
   enddo
   set color to (ccor)
   RestScreen(0, 0, 24, 79, ctela)
   return Nil

********************************
function PESQ3231

   if (Upper(readvar()) = "NCODIGO")
      cpesquisa:= {"CLIENTES", "CLIENTE2", "CODIGO_CLI", "nCodigo"}
      ccampos:= {"CODIGO_CLI", "NOME_CLI", "", "CODIGO", "NOME", ""}
   elseif (Upper(readvar()) = "NVENDO")
      cpesquisa:= {"FUNCIONA", "FUNCION2", "CODIGO_FUN", "nVendo"}
      ccampos:= {"CODIGO_FUN", "NOME", "", "CODIGO", "NOME", ""}
   endif
   pesquisa()
   return .T.

********************************
procedure QSR3225

   private ncodigo, ddtfim, dbclearrel, crecpag, impvid, nlinha, ;
      ncoluna, ccor, ctela, valpess
   private lcontrole, ncont, v1[7], v2[7], v3[7], ddtinicio[7], vet[2]
   private carquivo[7, 4]
   cpesquisa:= {"CLIENTES", "CLIENTE2", "CODIGO_CLI", "nCodigo"}
   ccampos:= {"CODIGO_CLI", "NOME_CLI", "", "CODIGO", "NOME", ""}
   set escape on
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   cnome:= Space(20)
   csobre:= Space(20)
   cpessoa:= Space(1)
   ccor:= SetColor()
   ncont:= 0
   lcontrole:= .T.
   nlinha:= 10
   ncoluna:= 19
   ctela:= SaveScreen(0, 0, 24, 79)
   lcontrole:= .T.
   vet[1]:= "Sim"
   vet[2]:= "NÆo"
   ncodigo:= 0
   ncont:= 1
   dbcreate:= "TEMP" + LTrim(Str(ncont)) + ".DBF"
   do while (file(dbcreate))
      ncont++
      dbcreate:= "TEMP" + LTrim(Str(ncont)) + ".DBF"
   enddo
   carquivo[1]:= {"Codigo_Cli", "N", 5, 0}
   carquivo[2]:= {"Tip_Doc", "C", 2, 0}
   carquivo[3]:= {"Num_Doc", "C", 10, 0}
   carquivo[4]:= {"Val_Tit", "N", 12, 2}
   carquivo[5]:= {"Val_Rece", "N", 12, 2}
   carquivo[6]:= {"Dt_Venc", "D", 8, 0}
   carquivo[7]:= {"Dt_Rece", "D", 8, 0}
   cprod(dbcreate, carquivo)
   do while (lcontrole)
      processand(.F.)
      janela(nlinha, ncoluna, nlinha + 4, ncoluna + 43, ;
         "Consulta de Extrato de Clientes")
      @ nlinha + 1, ncoluna + 2 say "Cliente"
      @ nlinha + 2, ncoluna + 2 get nCodigo picture "99999"
      read
      if (sai())
         loop
      endif
      processand(.T.)
      gertemp322(ncodigo)
      v1:= {"Codigo_Cli", "Tip_Doc", "Num_Doc", "Dt_Venc", ;
         "Val_Tit", "Dt_Rece", "Val_Rece"}
      v2:= {"99999", "@!", "", "", "9.999.999,99"}
      v3:= {"Codigo", "Tipo", "Num Doc", "Dt Venc", "Valor", ;
         "Dt Rece", "Vl Rece"}
      ddtinicio:= {1, 1, 1, 1, 1, 1, 1}
      processand(.F.)
      cseimp:= SubStr(dbcreate, 1, 5)
      index on Dt_Venc to (cseimp)
      set index to (cseimp)
      ccoluna:= " Consulta de Extrato de Clientes "
      consulta(Nil, 3, 1, 21, 78, v1, v2, v3, ddtinicio, "NEUTRO", ;
         ccoluna)
      close databases
      select 1
      close format
      lcontrole:= .F.
   enddo
   close databases
   select 1
   close format
   impritrans(dbcreate)
   set color to (ccor)
   RestScreen(0, 0, 24, 79, ctela)

********************************
function GERTEMP323(Arg1, Arg2)

   local Local1
   Local1:= .F.
   select 2
   if (!abredbf("PEDIDOS", "PEDIDOS3"))
      return .F.
   endif
   select 1
   use (dbcreate)
   select 2
   set softseek on
   seek Arg1
   set softseek off
   if (!EOF())
      do while (data >= Arg1 .AND. data <= Arg2)
         if (ncodigo != 0)
            if (cliente != ncodigo)
               skip 
               loop
            endif
         endif
         if (nvendo != 0)
            if (vendedor != nvendo)
               skip 
               loop
            endif
         endif
         if (norcam != 0)
            if (orcamento != norcam)
               skip 
               loop
            endif
         endif
         ncliente:= cliente
         cnomecli:= nome_cli
         nnumero:= numero
         valfr:= data
         nvaltot:= valor_tot
         fonecomp:= vendedor
         nloja:= loja
         ddt_venc:= int_ext
         nval_desc:= valor_desc
         ndesconto:= desconto
         select 1
         if (!adiciona())
            return .F.
         endif
         replace cliente with ncliente
         replace nome_cli with cnomecli
         replace numero with nnumero
         replace data with valfr
         replace valor_tot with nvaltot
         replace valor_desc with nval_desc
         replace desconto with ndesconto
         replace vendedor with fonecomp
         select 2
         skip 
         nlinha++
      enddo
   endif
   select 2
   close
   return

********************************
procedure QSR3226

   private ncodigo, ddtfim, dbclearrel, crecpag, impvid, nlinha, ;
      ncoluna, ccor, ctela, valpess
   private lcontrole, ncont, v1[6], v2[6], v3[6], ddtinicio[6], vet[2]
   cpesquisa:= {"CENT_CUS", "CENTRO1", "COD_HIER", "nCodigo"}
   ccampos:= {"COD_HIER", "DESCRICAO", "", "CODIGO", "DESCRICAO", ""}
   set escape on
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   ncodigo:= Space(7)
   ddtfim:= CToD("  /  /  ")
   dbclearrel:= CToD("  /  /  ")
   crecpag:= Space(1)
   impvid:= Space(1)
   ccor:= SetColor()
   ncont:= 0
   lcontrole:= .T.
   nlinha:= 10
   ncoluna:= 19
   ctela:= SaveScreen(0, 0, 24, 79)
   lcontrole:= .T.
   vet[1]:= "Sim"
   vet[2]:= "NÆo"
   do while (lcontrole)
      processand(.F.)
      janela(nlinha, ncoluna, nlinha + 7, ncoluna + 43, ;
         " Pesquisa de Centro de Custos ")
      @ nlinha + 1, ncoluna + 2 say "Data Inicial"
      @ nlinha + 1, ncoluna + 20 say "Data Final  "
      @ nlinha + 3, ncoluna + 2 say "Centro de Custo"
      @ nlinha + 2, ncoluna + 2 get dDtInicio
      @ nlinha + 2, ncoluna + 20 get dDtFim
      @ nlinha + 4, ncoluna + 2 get nCodigo picture "9999999" valid ;
         valcodcc(ncodigo, nlinha + 4, ncoluna + 12)
      read
      if (sai())
         loop
      endif
      processand(.T.)
      if (!abredbf("CONTASPG"))
         loop
      endif
      set index to CONTPG3, CONTPG2
      if (ddtfim = CToD("  /  /  "))
         ddtfim:= CToD("01/01/01")
      endif
      if (dbclearrel = CToD("  /  /  "))
         dbclearrel:= CToD("31/12//99")
      endif
      select 2
      if (!abredbf("FORNECED", "FORNECE1.NTX"))
         loop
      endif
      select 1
      if (.T.)
         dbSetRelation()
      endif
      confmovbc("FORNECED", {|| tip_doc_pg}, "COD_FOR_PG")
      set filter to Dt_Pgto_Pg >= dDtInicio .AND. Dt_Pgto_Pg <= ;
         dDtFim .AND. Forneced->Codigo_CC = nCodigo
      v1:= {"Cod_For_PG", "NOME", "Tip_Doc_PG", "Num_Doc_PG", ;
         "Vl_Pgto_PG", "Dt_Pgto_PG"}
      v2:= {"99999", "@!", "", "", "9.999.999,99", ""}
      v3:= {"Cod;For", "Nome;Fornecedor", "Tip;Doc", "Num;Doc", ;
         "Valor", "Data;Pagto"}
      ddtinicio:= {1, 2, 1, 1, 1, 1}
      ccoluna:= " Consulta de Contas Pagas por Centro de Custo "
      consulta("ContasPG", 3, 1, 21, 78, v1, v2, v3, ddtinicio, ;
         "PesConPG", ccoluna)
      close databases
      select 1
      close format
   enddo
   set color to (ccor)
   RestScreen(0, 0, 24, 79, ctela)
   return

********************************
function VALDEVIMP(Arg1)

   ncont:= 0
   lcontrole:= .T.
   do while (lcontrole)
      use Devoluca new shared index Devoluc1
      if (ncont > 3)
         alert("Erro na abertura de arquivo! Operao ser  cancelada.")
         lcontrole:= .F.
      endif
      if (neterr())
         InKey(2)
         ncont++
         loop
      else
         exit
      endif
   enddo
   seek Arg1
   if (!Found())
      alert("Pedido nao encontrado")
      close
      return .F.
   else
      close
      return .T.
   endif
   return .T.

********************************
procedure QSR3227

   private ncodigo, ddtfim, dbclearrel, crecpag, impvid, nlinha, ;
      ncoluna, ccor, ctela, valpess
   private lcontrole, ncont, vet[2], vetormes[12, 2], i:= 1
   private cdesc
   cpesquisa:= {"CENT_CUS", "CENTRO1", "COD_HIER", "nCodigo"}
   ccampos:= {"COD_HIER", "DESCRICAO", "", "CODIGO", "DESCRICAO", ""}
   set escape on
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   ncodigo:= Space(7)
   ddtfim:= CToD("  /  /  ")
   dbclearrel:= CToD("  /  /  ")
   crecpag:= Space(1)
   impvid:= Space(1)
   ccor:= SetColor()
   ncont:= 0
   lcontrole:= .T.
   nlinha:= 10
   ncoluna:= 19
   ctela3227:= SaveScreen(0, 0, 24, 79)
   lcontrole:= .T.
   vet[1]:= "Sim"
   vet[2]:= "NÆo"
   do while (lcontrole)
      processand(.F.)
      janela(nlinha, ncoluna, nlinha + 6, ncoluna + 43, ;
         " Grafico do Centro de Custos ")
      @ nlinha + 3, ncoluna + 2 say "Centro de Custo"
      @ nlinha + 4, ncoluna + 2 get nCodigo picture "9999999" valid ;
         valcodcc(ncodigo, nlinha + 4, ncoluna + 13)
      read
      if (sai())
         loop
      endif
      processand(.T.)
      i:= 1
      vetormes[1][1]:= 0
      vetormes[2][1]:= 0
      vetormes[3][1]:= 0
      vetormes[4][1]:= 0
      vetormes[5][1]:= 0
      vetormes[6][1]:= 0
      vetormes[7][1]:= 0
      vetormes[8][1]:= 0
      vetormes[9][1]:= 0
      vetormes[10][1]:= 0
      vetormes[11][1]:= 0
      vetormes[12][1]:= 0
      vetormes[1][2]:= ""
      vetormes[2][2]:= ""
      vetormes[3][2]:= ""
      vetormes[4][2]:= ""
      vetormes[5][2]:= ""
      vetormes[6][2]:= ""
      vetormes[7][2]:= ""
      vetormes[8][2]:= ""
      vetormes[9][2]:= ""
      vetormes[10][2]:= ""
      vetormes[11][2]:= ""
      vetormes[12][2]:= ""
      select 1
      if (!abredbf("CONTASPG"))
         loop
      endif
      set index to Contpg3, Contpg2
      if (ddtfim = CToD("  /  /  "))
         ddtfim:= CToD("01/01/01")
      endif
      if (dbclearrel = CToD("  /  /  "))
         dbclearrel:= CToD("31/12//99")
      endif
      select 2
      if (!abredbf("FORNECED", "FORNECE1.NTX"))
         loop
      endif
      cdia:= "01"
      nano:= Year(Date()) - 1
      nmes:= Month(Date()) + 1
      if (nmes == 13)
         nmes:= 1
         nano:= nano + 1
      endif
      nmes:= Str(nmes, 2)
      nmes:= LTrim(nmes)
      nmes:= Replicate("0", 2 - Len(nmes)) + nmes
      nano:= Str(nano, 4)
      nano:= SubStr(nano, 3, 2)
      ddtfim:= cdia + "/" + nmes + "/" + nano
      ddtfim:= CToD(ddtfim)
      cdia:= "01"
      nmes:= Month(Date()) + 1
      nano:= Year(Date())
      if (nmes == 13)
         nmes:= 1
         nano:= Year(Date()) + 1
      endif
      nmes:= Str(nmes, 2)
      nmes:= LTrim(nmes)
      nmes:= Replicate("0", 2 - Len(nmes)) + nmes
      nano:= Str(nano, 4)
      nano:= SubStr(nano, 3, 2)
      dbclearrel:= cdia + "/" + nmes + "/" + nano
      dbclearrel:= CToD(dbclearrel)
      select 1
      set softseek on
      seek ddtfim
      set softseek off
      do while (!EOF() .AND. dt_pgto_pg >= ddtfim .AND. dt_pgto_pg < ;
            dbclearrel)
         select 1
         nmes:= Month(dt_pgto_pg)
         do while (Month(dt_pgto_pg) = nmes .AND. !EOF())
            nforn:= tip_doc_pg
            select 2
            seek nforn
            if (Found())
               if (Len(Trim(ncodigo)) = 2)
                  if (Trim(ncodigo) != SubStr(vcodi13a, 1, 2))
                     select 1
                     skip 
                     loop
                  endif
               elseif (Len(Trim(ncodigo)) = 4)
                  if (Trim(ncodigo) != SubStr(vcodi13a, 1, 4))
                     select 1
                     skip 
                     loop
                  endif
               elseif (Len(Trim(ncodigo)) = 7)
                  if (ncodigo != vcodi13a)
                     select 1
                     skip 
                     loop
                  endif
               endif
            else
               select 1
               skip 
               loop
            endif
            select 1
            vetormes[i][1]:= vetormes[i][1] + vl_pgto_pg
            vetormes[i][2]:= achadata(Month(dt_pgto_pg))
            skip 
         enddo
         i++
         select 1
      enddo
      grafv1(vetormes, Nil, "Centro de Custo :", cdesc, ;
         "Evolucao Anual do Centro de Custo")
   enddo
   set color to (ccor)
   nlinha:= 10
   ncoluna:= 19
   RestScreen(0, 0, 24, 79, ctela3227)
   qsr16i("cDesc")
   close databases
   select 1
   close format
   return

********************************
function GERTEMP231(Arg1)

   select 3
   if (!abredbf("PED_MAT", "PED_MAT"))
      return .F.
   endif
   select 4
   if (!abredbf("Produtos", "Produto1.NTX"))
      return .F.
   endif
   select 2
   use (carq2)
   zap
   select 3
   seek Arg1
   if (Found())
      do while (Arg1 = Str(loja, 2) + Str(numero_ped, 5) .AND. !EOF())
         ccodigo:= codigo_mat
         nquant:= quantidade
         cdebcred:= valor
         select 4
         seek ccodigo
         if (Found())
            cdesc:= descricao
         else
            cdesc:= "Referencia Nao Cadastrada "
         endif
         select 2
         if (!adiciona())
            loop
         endif
         replace codigo_mat with ccodigo
         replace quantidade with nquant
         replace valor with cdebcred
         replace descricao with cdesc
         select 3
         skip 
         nlinha++
      enddo
   endif
   select 3
   close
   select 4
   close
   return

********************************
function P411

   if (nlinha > nalturafor)
      ccabecalho++
      nlinha:= 5
      @  1,  1 say cnomemp
      @  2,  1 say "Relatorio de Clientes" + Replicate(" ", 101) + ;
         "Pagina :" + Str(ccabecalho, 3)
      @  3,  1 say "Vendedor " + cnomevend
      @  4,  1 say impcontasa
      if (csintetico = "S")
         @  5,  1 say "Codigo"
         @  5,  9 say "Nome"
         @  5, 51 say "Pessoa"
         @  5, 58 say "Telefone"
         @  5, 100 say "Cidade"
         @  6,  1 say impcontasa
         nlinha:= 7
      endif
   endif
   return nlinha

********************************
procedure QSR3231

   private ncodigo, ddtfim, dbclearrel, crecpag, nlinha, ncoluna, ;
      ccor, ctela, valpess
   private lcontrole, ncont, v1[6], v2[6], v3[6], ddtinicio[6], ;
      vet[2], ccor
   private carquivo[8, 4], temp2[4, 4]
   set key K_F10 to pesq3231
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   ncodigo:= 0
   ddtfim:= CToD("  /  /  ")
   dbclearrel:= CToD("  /  /  ")
   nlinha:= 3
   ncoluna:= 1
   ncont:= 0
   lcontrole:= .T.
   nlinha:= 10
   ncoluna:= 19
   ctela:= SaveScreen(0, 0, 24, 79)
   vet[1]:= "Sim"
   vet[2]:= "NÆo"
   nloja:= 1
   nvendo:= 0
   norcam:= 0
   ncont:= 1
   dbcreate:= "TEMP" + LTrim(Str(ncont)) + ".DBF"
   do while (file(dbcreate))
      ncont++
      dbcreate:= "TEMP" + LTrim(Str(ncont)) + ".DBF"
   enddo
   carquivo[1]:= {"Cliente", "N", 5, 0}
   carquivo[2]:= {"Nome_Cli", "C", 30, 0}
   carquivo[3]:= {"Numero", "N", 5, 0}
   carquivo[4]:= {"Data", "D", 8, 0}
   carquivo[5]:= {"Valor_Tot", "N", 12, 2}
   carquivo[6]:= {"Vendedor", "N", 5, 0}
   carquivo[7]:= {"Valor_Desc", "N", 12, 2}
   carquivo[8]:= {"Desconto", "N", 5, 2}
   cprod(dbcreate, carquivo)
   ncont:= 1
   carq2:= "TEMP" + LTrim(Str(ncont)) + ".DBF"
   do while (file(carq2))
      ncont++
      carq2:= "TEMP" + LTrim(Str(ncont)) + ".DBF"
   enddo
   temp2[1]:= {"Codigo_Mat", "C", 6, 0}
   temp2[2]:= {"Descricao", "C", 30, 0}
   temp2[3]:= {"Quantidade", "N", 12, 2}
   temp2[4]:= {"Valor", "N", 12, 2}
   cprod(carq2, temp2)
   do while (lcontrole)
      processand(.F.)
      janela(nlinha, ncoluna, nlinha + 6, ncoluna + 43, ;
         "Pesquisa de Pedidos de Venda")
      @ nlinha + 1, ncoluna + 2 say "Data Inicial"
      @ nlinha + 1, ncoluna + 20 say "Data Final  "
      @ nlinha + 3, ncoluna + 2 say "Cliente "
      @ nlinha + 3, ncoluna + 17 say "Vendedor"
      @ nlinha + 3, ncoluna + 30 say "Orcamento"
      @ nlinha + 2, ncoluna + 2 get dDtInicio
      @ nlinha + 2, ncoluna + 20 get dDtFim
      @ nlinha + 4, ncoluna + 2 get nCodigo picture "99999"
      @ nlinha + 4, ncoluna + 17 get nVendo picture "99999"
      @ nlinha + 4, ncoluna + 30 get nOrcam picture "99999"
      read
      if (sai())
         loop
      endif
      if (ddtfim = CToD(" /  /  "))
         ddtfim:= CToD("01/01/91")
      endif
      if (dbclearrel = CToD(" /  /  "))
         dbclearrel:= CToD("31/12/10")
      endif
      gertemp323(ddtfim, dbclearrel)
      select 1
      v1:= {"Cliente", "Nome_Cli", "Numero", "Data", "Valor_Tot", ;
         "Desconto", "Valor_Desc", "Vendedor"}
      v2:= {"99999", "@!", "", "", "9.999.999,99"}
      v3:= {"Codigo;Cliente", "Nome;Cliente", "Pedido", "Data", ;
         "Valor", "Desc", "Liquido", "Vend"}
      ddtinicio:= {1, 1, 1, 1, 1, 1, 1, 1}
      ccoluna:= " Consultas de Pedidos de Venda "
      consulta(Nil, 3, 1, 21, 78, v1, v2, v3, ddtinicio, "PesConPD", ;
         ccoluna)
      close databases
      select 1
      close format
      lcontrole:= .F.
   enddo
   close databases
   select 1
   close format
   impritrans(dbcreate)
   impritrans(carq2)
   set color to (ccor)
   RestScreen(0, 0, 24, 79, ctela)
   return

********************************
procedure GERTEMP325(Arg1, Arg2)

   local Local1
   Local1:= .F.
   ncont:= 0
   do while (.T.)
      select 2
      use Devoluca shared index Devoluc3
      if (ncont > 3)
         alert("Erro na abertura de arquivo! Operao ser  cancelada.")
         lcontrole:= .F.
      endif
      if (neterr())
         InKey(2)
         ncont++
         loop
      else
         exit
      endif
   enddo
   ncont:= 0
   do while (.T.)
      select 3
      use Clientes shared index Cliente1
      if (ncont > 3)
         alert("Erro na abertura de arquivo! Operao ser  cancelada.")
         lcontrole:= .F.
      endif
      if (neterr())
         InKey(2)
         ncont++
         loop
      else
         exit
      endif
   enddo
   select 1
   use (dbcreate)
   select 2
   set softseek on
   seek Arg1
   set softseek off
   if (!EOF())
      do while (data >= Arg1 .AND. data <= Arg2)
         if (ncodigo != 0)
            if (cliente != ncodigo)
               skip 
               loop
            endif
         endif
         ncliente:= cliente
         nnumero:= numero
         valfr:= data
         nvaltot:= valor_tot
         fonecomp:= vendedor
         select 3
         seek ncliente
         if (Found())
            cnomecli:= nome_cli
         endif
         select 1
         ncont:= 0
         do while (.T.)
            append blank
            if (ncont > 3)
               alert("ATENO!;Erro na inserco de registro.; Operao ser  cancelada.")
               lcontrole:= .F.
               exit
            endif
            if (neterr())
               InKey(2)
               ncont++
            else
               exit
            endif
         enddo
         replace cliente with ncliente
         replace nome_cli with cnomecli
         replace numero with nnumero
         replace data with valfr
         replace valor_tot with nvaltot
         replace vendedor with fonecomp
         select 2
         skip 
         nlinha++
      enddo
   endif
   select 2
   close
   select 3
   close
   return

********************************
procedure QSR3232

   private ncodigo, ddtfim, dbclearrel, crecpag, nlinha, ncoluna, ;
      ccor, ctela, valpess
   private lcontrole, ncont, v1[6], v2[6], v3[6], ddtinicio[6], ;
      vet[2], ccor
   private carquivo[7, 4], temp2[4, 4]
   cpesquisa:= {"CLIENTES", "CLIENTE2", "CODIGO_CLI", "nCodigo"}
   ccampos:= {"CODIGO_CLI", "NOME_CLI", "", "CODIGO", "NOME", ""}
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   ncodigo:= 0
   ddtfim:= CToD("  /  /  ")
   dbclearrel:= CToD("  /  /  ")
   nlinha:= 3
   ncoluna:= 1
   ncont:= 0
   lcontrole:= .T.
   nlinha:= 10
   ncoluna:= 19
   ctela:= SaveScreen(0, 0, 24, 79)
   vet[1]:= "Sim"
   vet[2]:= "NÆo"
   ncont:= 1
   dbcreate:= "TEMP" + LTrim(Str(ncont)) + ".DBF"
   do while (file(dbcreate))
      ncont++
      dbcreate:= "TEMP" + LTrim(Str(ncont)) + ".DBF"
   enddo
   carquivo[1]:= {"Cliente", "N", 5, 0}
   carquivo[2]:= {"Nome_Cli", "C", 30, 0}
   carquivo[3]:= {"Numero", "N", 5, 0}
   carquivo[4]:= {"Data", "D", 8, 0}
   carquivo[5]:= {"Valor_Tot", "N", 12, 2}
   carquivo[6]:= {"Vendedor", "N", 5, 0}
   carquivo[7]:= {"Loja", "N", 2, 0}
   cprod(dbcreate, carquivo)
   ncont:= 1
   carq2:= "TEMP" + LTrim(Str(ncont)) + ".DBF"
   do while (file(carq2))
      ncont++
      carq2:= "TEMP" + LTrim(Str(ncont)) + ".DBF"
   enddo
   temp2[1]:= {"Codigo_Mat", "C", 6, 0}
   temp2[2]:= {"Descricao", "C", 30, 0}
   temp2[3]:= {"Quantidade", "N", 12, 2}
   temp2[4]:= {"Valor", "N", 12, 2}
   cprod(carq2, temp2)
   do while (lcontrole)
      janela(nlinha, ncoluna, nlinha + 6, ncoluna + 43, ;
         " Pesquisa de Pedidos de Consignacao ")
      @ nlinha + 1, ncoluna + 2 say "Data Inicial"
      @ nlinha + 1, ncoluna + 20 say "Data Final  "
      @ nlinha + 3, ncoluna + 2 say "Cliente "
      @ nlinha + 2, ncoluna + 2 get dDtInicio
      @ nlinha + 2, ncoluna + 20 get dDtFim
      @ nlinha + 4, ncoluna + 2 get nCodigo picture "99999"
      read
      if (sai())
         loop
      endif
      if (ddtfim = CToD(" /  /  "))
         ddtfim:= CToD("01/01/91")
      endif
      if (dbclearrel = CToD(" /  /  "))
         dbclearrel:= CToD("31/12/10")
      endif
      gertemp324(ddtfim, dbclearrel)
      select 1
      v1:= {"Cliente", "Nome_Cli", "Numero", "Data", "Valor_Tot", ;
         "Vendedor"}
      v2:= {Nil, Nil, Nil, Nil, Nil, Nil}
      v3:= {"Cod;Cli", "Nome;Cliente", "Pedido", "Data", "Valor", ;
         "Vend"}
      ddtinicio:= {1, 1, 1, 1, 1, 1}
      ccoluna:= " Consultas de Pedidos de Consignacao "
      consulta(Nil, 3, 1, 21, 78, v1, v2, v3, ddtinicio, "PesConCS", ;
         ccoluna)
      close databases
      select 1
      close format
      lcontrole:= .F.
   enddo
   close databases
   select 1
   close format
   impritrans(dbcreate)
   impritrans(carq2)
   set color to (ccor)
   RestScreen(0, 0, 24, 79, ctela)
   return

********************************
procedure QSR3233

   private ncodigo, ddtfim, dbclearrel, crecpag, nlinha, ncoluna, ;
      ccor, ctela, valpess
   private lcontrole, ncont, v1[6], v2[6], v3[6], ddtinicio[6], ;
      vet[2], ccor
   private carquivo[7, 4], temp2[4, 4]
   cpesquisa:= {"CLIENTES", "CLIENTE2", "CODIGO_CLI", "nCodigo"}
   ccampos:= {"CODIGO_CLI", "NOME_CLI", "", "CODIGO", "NOME", ""}
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   ncodigo:= 0
   ddtfim:= CToD("  /  /  ")
   dbclearrel:= CToD("  /  /  ")
   nlinha:= 3
   ncoluna:= 1
   ncont:= 0
   lcontrole:= .T.
   nlinha:= 10
   ncoluna:= 19
   ctela:= SaveScreen(0, 0, 24, 79)
   vet[1]:= "Sim"
   vet[2]:= "NÆo"
   ncont:= 1
   dbcreate:= "TEMP" + LTrim(Str(ncont)) + ".DBF"
   do while (file(dbcreate))
      ncont++
      dbcreate:= "TEMP" + LTrim(Str(ncont)) + ".DBF"
   enddo
   carquivo[1]:= {"Cliente", "N", 5, 0}
   carquivo[2]:= {"Nome_Cli", "C", 30, 0}
   carquivo[3]:= {"Numero", "N", 5, 0}
   carquivo[4]:= {"Data", "D", 8, 0}
   carquivo[5]:= {"Valor_Tot", "N", 12, 2}
   carquivo[6]:= {"Vendedor", "N", 5, 0}
   carquivo[7]:= {"Loja", "N", 2, 0}
   cprod(dbcreate, carquivo)
   ncont:= 1
   carq2:= "TEMP" + LTrim(Str(ncont)) + ".DBF"
   do while (file(carq2))
      ncont++
      carq2:= "TEMP" + LTrim(Str(ncont)) + ".DBF"
   enddo
   temp2[1]:= {"Codigo_Mat", "C", 6, 0}
   temp2[2]:= {"Descricao", "C", 30, 0}
   temp2[3]:= {"Quantidade", "N", 12, 2}
   temp2[4]:= {"Valor", "N", 12, 2}
   cprod(carq2, temp2)
   do while (lcontrole)
      processand(.F.)
      janela(nlinha, ncoluna, nlinha + 6, ncoluna + 43, ;
         " Pesquisa de Pedidos de Devolucao ")
      @ nlinha + 1, ncoluna + 2 say "Data Inicial"
      @ nlinha + 1, ncoluna + 20 say "Data Final  "
      @ nlinha + 3, ncoluna + 2 say "Cliente "
      @ nlinha + 2, ncoluna + 2 get dDtInicio
      @ nlinha + 2, ncoluna + 20 get dDtFim
      @ nlinha + 4, ncoluna + 2 get nCodigo picture "99999"
      read
      if (sai())
         loop
      endif
      processand(.T.)
      if (ddtfim = CToD(" /  /  "))
         ddtfim:= CToD("01/01/91")
      endif
      if (dbclearrel = CToD(" /  /  "))
         dbclearrel:= CToD("31/12/10")
      endif
      gertemp325(ddtfim, dbclearrel)
      select 1
      v1[1]:= "Cliente"
      v1[2]:= "Nome_Cli"
      v1[3]:= "Numero"
      v1[4]:= "Data"
      v1[5]:= "Valor_Tot"
      v1[6]:= "Vendedor"
      v2[1]:= "99999"
      v2[2]:= "@!"
      v2[3]:= ""
      v2[4]:= ""
      v2[5]:= "@E 9.999.999,99"
      v2[6]:= ""
      v3[1]:= "Cod;Cli"
      v3[2]:= "Nome;Cliente"
      v3[3]:= "Pedido"
      v3[4]:= "Data"
      v3[5]:= "Valor"
      v3[6]:= "Vend"
      ddtinicio[1]:= 1
      ddtinicio[2]:= 1
      ddtinicio[3]:= 1
      ddtinicio[4]:= 1
      ddtinicio[5]:= 1
      ddtinicio[6]:= 1
      ccoluna:= " Consultas de pedidos de Devolucao "
      consulta(Nil, 3, 1, 21, 78, v1, v2, v3, ddtinicio, "PesConDV", ;
         ccoluna)
      close databases
      select 1
      close format
      lcontrole:= .F.
   enddo
   close databases
   select 1
   close format
   impritrans(dbcreate)
   impritrans(carq2)
   set color to (ccor)
   nlinha:= 10
   ncoluna:= 19
   RestScreen(0, 0, 24, 79, ctela)
   return

********************************
function GERTEMP233(Arg1)

   ncont:= 0
   do while (.T.)
      select 3
      use Dev_Mat shared index Dev_Mat
      if (ncont > 3)
         alert("ATENO!;Erro na abertura de arquivo ; Operao ser  cancelada.")
         lcontrole:= .F.
      endif
      if (neterr())
         InKey(2)
         ncont++
         loop
      else
         exit
      endif
   enddo
   if (!lcontrole)
   else
      ncont:= 0
      do while (.T.)
         select 4
         use Produtos shared index Produto1
         if (ncont > 3)
            alert("ATENO!;Erro na abertura de arquivo ; Operao ser  cancelada.")
            lcontrole:= .F.
         endif
         if (neterr())
            InKey(2)
            ncont++
            loop
         else
            exit
         endif
      enddo
      if (!lcontrole)
         return Nil
      endif
      select 2
      use (carq2)
      zap
      select 3
      seek Arg1
      if (Found())
         do while (Arg1 = numero_ped .AND. !EOF())
            ccodigo:= codigo_mat
            nquant:= quantidade
            cdebcred:= valor
            select 4
            seek ccodigo
            if (Found())
               cdesc:= descricao
            else
               cdesc:= "Referencia nao cadastrada "
            endif
            select 2
            ncont:= 0
            do while (.T.)
               append blank
               if (ncont > 3)
                  alert("ATENO!;Erro na inserco de registro.; Operao ser  cancelada.")
                  lcontrole:= .F.
                  exit
               endif
               if (neterr())
                  InKey(2)
                  ncont++
               else
                  exit
               endif
            enddo
            replace codigo_mat with ccodigo
            replace quantidade with nquant
            replace valor with cdebcred
            replace descricao with cdesc
            select 3
            skip 
            nlinha++
         enddo
      endif
      select 3
      close
      select 4
      close
      return
   endif

********************************
procedure QSR3234

   private ncodigo, ddtfim, dbclearrel, crecpag, nlinha, ncoluna, ;
      ccor, ctela, valpess
   private lcontrole, ncont, v1[6], v2[6], v3[6], ddtinicio[6], ;
      vet[2], ccor
   private carquivo[6, 4], temp2[4, 4]
   set key K_F10 to pesq3231
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   ncodigo:= 0
   ddtfim:= CToD("  /  /  ")
   dbclearrel:= CToD("  /  /  ")
   nlinha:= 3
   ncoluna:= 1
   ncont:= 0
   lcontrole:= .T.
   nlinha:= 10
   ncoluna:= 19
   ctela:= SaveScreen(0, 0, 24, 79)
   vet[1]:= "Sim"
   vet[2]:= "NÆo"
   nloja:= 1
   nvendo:= 0
   ncont:= 1
   dbcreate:= "TEMP" + LTrim(Str(ncont)) + ".DBF"
   do while (file(dbcreate))
      ncont++
      dbcreate:= "TEMP" + LTrim(Str(ncont)) + ".DBF"
   enddo
   carquivo[1]:= {"Cliente", "N", 5, 0}
   carquivo[2]:= {"Nome_Cli", "C", 30, 0}
   carquivo[3]:= {"Numero", "N", 5, 0}
   carquivo[4]:= {"Data", "D", 8, 0}
   carquivo[5]:= {"Valor_Tot", "N", 12, 2}
   carquivo[6]:= {"Vendedor", "N", 5, 0}
   cprod(dbcreate, carquivo)
   ncont:= 1
   carq2:= "TEMP" + LTrim(Str(ncont)) + ".DBF"
   do while (file(carq2))
      ncont++
      carq2:= "TEMP" + LTrim(Str(ncont)) + ".DBF"
   enddo
   temp2[1]:= {"Codigo_Mat", "C", 6, 0}
   temp2[2]:= {"Descricao", "C", 30, 0}
   temp2[3]:= {"Quantidade", "N", 12, 2}
   temp2[4]:= {"Valor", "N", 12, 2}
   cprod(carq2, temp2)
   do while (lcontrole)
      processand(.F.)
      janela(nlinha, ncoluna, nlinha + 6, ncoluna + 43, ;
         "Pesquisa de Orcamentos")
      @ nlinha + 1, ncoluna + 2 say "Data Inicial"
      @ nlinha + 1, ncoluna + 20 say "Data Final  "
      @ nlinha + 3, ncoluna + 2 say "Cliente "
      @ nlinha + 3, ncoluna + 17 say "Vendedor"
      @ nlinha + 2, ncoluna + 2 get dDtInicio
      @ nlinha + 2, ncoluna + 20 get dDtFim
      @ nlinha + 4, ncoluna + 2 get nCodigo picture "99999"
      @ nlinha + 4, ncoluna + 17 get nVendo picture "99999"
      read
      if (sai())
         loop
      endif
      if (ddtfim = CToD(" /  /  "))
         ddtfim:= CToD("01/01/91")
      endif
      if (dbclearrel = CToD(" /  /  "))
         dbclearrel:= CToD("31/12/10")
      endif
      ger3234(ddtfim, dbclearrel)
      select 1
      v1:= {"Cliente", "Nome_Cli", "Numero", "Data", "Valor_Tot", ;
         "Vendedor"}
      v2:= {"99999", "@!", "", "", "9.999.999,99"}
      v3:= {"Codigo;Cliente", "Nome;Cliente", "Pedido", "Data", ;
         "Valor", "Vend"}
      ddtinicio:= {1, 1, 1, 1, 1, 1}
      ccoluna:= " Consultas de Orcamentos "
      consulta(Nil, 3, 1, 21, 78, v1, v2, v3, ddtinicio, "PesConOR", ;
         ccoluna)
      close databases
      select 1
      close format
      lcontrole:= .F.
   enddo
   close databases
   select 1
   close format
   impritrans(dbcreate)
   impritrans(carq2)
   set color to (ccor)
   RestScreen(0, 0, 24, 79, ctela)
   return

********************************
function ABREARQ

   select 2
   if (!abredbf("PED_MAT", "PED_MAT.NTX"))
      return .F.
   endif
   select 3
   if (!abredbf("PRODUTOS", "PRODUTO1.NTX"))
      return .F.
   endif
   select 4
   if (!abredbf("GRUPO", "GRUPO"))
      return .F.
   endif
   return .T.

********************************
function QSR3242

   private nlinha, ncoluna, ctela, ccor, lcontrole, v1[6], v2[6], ;
      v3[6], ddtinicio[6]
   private vet[2]
   programa(0, 69, coropcoes)
   nlinha:= 11
   ncoluna:= 19
   ctela:= SaveScreen(0, 0, 24, 79)
   lcontrole:= .T.
   ncodigo:= 0
   ddtfim:= CToD("  /  /  ")
   dbclearrel:= CToD("  /  /  ")
   vet[1]:= "Sim"
   vet[2]:= "NÆo"
   janela(nlinha, ncoluna, nlinha + 6, ncoluna + 43, ;
      " Consulta de Movimento de Funcionario ")
   nlinha++
   @ nlinha, ncoluna + 2 say "Codigo"
   @ nlinha + 2, ncoluna + 2 say "Data Inicial"
   @ nlinha + 2, ncoluna + 19 say "Data Final  "
   do while (lcontrole)
      processand(.F.)
      @ nlinha + 1, ncoluna + 2 get nCodigo picture "99999" valid ;
         valcodi463(ncodigo)
      @ nlinha + 3, ncoluna + 2 get dDtInicio
      @ nlinha + 3, ncoluna + 19 get dDtFim
      read
      if (sai())
         loop
      endif
      if (ddtfim = CToD(" /  /  "))
         ddtfim:= CToD("01/01/01")
      endif
      if (dbclearrel = CToD(" /  /  "))
         dbclearrel:= CToD("31/12/99")
      endif
      if (!abredbf("MOV_FUN"))
         loop
      endif
      set index to MV_FUN2, MV_FUN3
      if (ncodigo == 0)
         set filter to Data <= dDtFim .AND. Data >= dDtInicio
      else
         set filter to Data <= dDtFim .AND. Data >= dDtInicio .AND. ;
            Codigo == nCodigo
      endif
      select 2
      if (!abredbf("FUNCIONA", "FUNCION1.NTX"))
         loop
      endif
      select 1
      if (.T.)
         dbSetRelation()
      endif
      confmovbc("Funciona", {|| codigo}, "Codigo")
      v1:= {"Data ", "Historico ", "Docto ", "DebCred ", "Valor ", ;
         "Confirmado "}
      v2:= {"99999", "@!", "", "", "9.999.999,99", ""}
      v3:= {"Data", "Historico", "Docto", "DebCred", "Valor", "Conf"}
      ddtinicio:= {1, 1, 1, 1, 1, 1}
      ccoluna:= " Consulta de Movimento de Funcionario "
      consulta("Mov_Fun", 4, 0, 21, 79, v1, v2, v3, ddtinicio, ;
         "PesConMF", ccoluna)
      close databases
      select 1
      close format
      ncodigo:= 0
      ddtfim:= CToD("  /  /  ")
      dbclearrel:= CToD("  /  /  ")
   enddo
   set color to (ccor)
   RestScreen(0, 0, 24, 79, ctela)
   return Nil

********************************
procedure PESCONMF

   private ncodigo, ddtvenc, valfr, cdebcred, cconfirma, chistorico, ;
      tela21
   private nlinha, ncoluna, vet[2], nresp, ccor, ncont, ctela, ;
      ctesta, nsalant
   private nsalconant, bancos
   nlinha:= 6
   ncoluna:= 17
   ccor:= SetColor()
   ncodigo:= 0
   ddtvenc:= Space(10)
   valfr:= Date()
   cdebcred:= 0
   cconfirma:= 0
   chistorico:= "C"
   ctesta:= ""
   tela21:= Space(30)
   vet[1]:= "Sim"
   vet[2]:= "No"
   lcontrole:= .T.
   ctel2:= SaveScreen(0, 0, 24, 79)
   nsalconant:= 0
   bancos:= 0
   janela(nlinha, ncoluna, nlinha + 11, ncoluna + 43, ;
      "ZOOM de Movimento de Funcionarios")
   ncodigo:= codigo
   valfr:= data
   ddtvenc:= historico
   tela21:= qsr22a
   cdebcred:= valor
   chistorico:= debcred
   ctesta:= confirmado
   cnomcli:= SubStr(qsr23i->nome, 1, 22)
   nsaldocon:= qsr23i->saldo
   qsr22i:= qsr23i->saldo_conf
   docto()
   clear gets
   do while (lcontrole)
      ntecla:= InKey(0)
      if (ntecla == 27)
         lcontrole:= .F.
      endif
   enddo
   RestScreen(0, 0, 24, 79, ctel2)
   return

********************************
function QSR3243

   private ncodigo, ddtfim, dbclearrel, crecpag, impvid, nlinha, ;
      ncoluna, ccor, ctela, valpess
   private lcontrole, ncont, v1[5], v2[5], v3[5], ddtinicio[5], vet[2]
   private ntot_diar, ntot_diap, npag, ntotp, ntotr, nsaldocon, ;
      nlin, ddata1
   cpesquisa:= {"FUNCIONA", "FUNCION2", "CODIGO_FUN", "nVend"}
   ccampos:= {"CODIGO_FUN", "NOME", "", "CODIGO", "NOME", ""}
   set escape on
   programa(0, 69, coropcoes)
   ncont:= 0
   lcontrole:= .T.
   nlinha:= 5
   ncoluna:= 1
   ctela:= SaveScreen(0, 0, 24, 79)
   lcontrole:= .T.
   vet[1]:= "Sim"
   vet[2]:= "NÆo"
   lcontrole:= .T.
   ddtfim:= CToD("  /  /  ")
   dbclearrel:= CToD("  /  /  ")
   nloja:= 0
   valfr:= CToD("  /  /  ")
   observacao:= 0
   cnomecli:= Space(30)
   cdebcred:= 0
   ntotval:= 0
   nvalprod:= 0
   nvalcomis:= 0
   ntotcomis:= 0
   fonecomp:= 0
   ccompleto:= "C"
   nlin2:= nlinha
   ccor:= SetColor()
   janela(nlinha, ncoluna, nlinha + 6, ncoluna + 43, ;
      " Consulta de Calculo de Comissao ")
   @ nlinha + 1, ncoluna + 2 say "Data Inicial"
   @ nlinha + 1, ncoluna + 20 say "Data Final  "
   @ nlinha + 1, ncoluna + 33 say "Vendedor "
   @ nlinha + 3, ncoluna + 2 say ;
      "Completo  Orcamento  Nota fiscal (C/O/N) "
   @ nlinha + 2, ncoluna + 2 get dDtInicio
   @ nlinha + 2, ncoluna + 20 get dDtFim
   @ nlinha + 2, ncoluna + 33 get nVend picture "99999" valid ;
      valcodi463(fonecomp)
   @ nlinha + 4, ncoluna + 2 get cCompleto picture "!" valid ;
      ccompleto $ " CON"
   read
   if (sai())
      close
      RestScreen(0, 0, 24, 79, ctela)
      return .F.
   endif
   if (ddtfim = CToD(" /  /  "))
      ddtfim:= CToD("01/01/91")
   endif
   if (dbclearrel = CToD(" /  /  "))
      dbclearrel:= CToD("31/12/10")
   endif
   processand(.T.)
   if (!abredbf("PEDIDOS", "PEDIDOS3.NTX"))
      close databases
      select 1
      close format
      RestScreen(0, 0, 24, 79, ctela)
   else
      select 2
      if (!abredbf("CONTASRE", "CONTRE3.NTX"))
         close databases
         select 1
         close format
         RestScreen(0, 0, 24, 79, ctela)
      else
         select PEDIDOS
         janela(nlinha, ncoluna, nlinha + 17, ncoluna + 78, ;
            " Consulta Listagem de Comissao ")
         set color to W+/BG
         @ nlinha + 1, ncoluna + 1 say ;
            "Data    No.Orc.  Cliente                                  Valor     Val.Comis"
         if (sai())
            close databases
            select 1
            close format
            RestScreen(0, 0, 24, 79, ctela)
         else
            if (ntipocomis != 3)
               select PEDIDOS
               set filter to Data <= dDtFim .AND. Data >= dDtInicio ;
                  .AND. Vendedor = nVend
               if (!abrearq())
                  lcontrole:= .F.
                  RestScreen(0, 0, 24, 79, ctela)
                  close databases
                  select 1
                  close format
                  return .F.
               endif
            elseif (ntipocomis == 3)
               select ContasRE
               set filter to DT_RECE_RE >= dDtInicio .AND. ;
                  DT_RECE_RE <= dDtFim
            endif
            nlinha:= 7
            if (ntipocomis != 3)
               select Pedidos
               goto top
               do while (!EOF())
                  if (!Empty(ccompleto))
                     if (ccompleto == "O")
                        if (imp_nf == "S")
                           skip 
                           loop
                        endif
                     elseif (ccompleto == "N")
                        if (imp_nf != "S")
                           skip 
                           loop
                        endif
                     endif
                  endif
                  observacao:= numero
                  valfr:= data
                  cnomecli:= Str(cliente, 5) + "-" + nome_cli
                  nloja:= loja
                  ncomissao:= comissao
                  cdebcred:= valor_tot
                  ntotval:= ntotval + cdebcred
                  ntotcomis:= ntotcomis + ncomissao
                  @ nlinha,  2 say valfr
                  @ nlinha, 11 say observacao
                  @ nlinha, 18 say cnomecli
                  @ nlinha, 53 say cdebcred picture "9,999,999.99"
                  @ nlinha, 67 say ncomissao picture "9,999,999.99"
                  nlinha++
                  if (nlinha >= nlin2 + 14)
                     @ nlin2 + 16, 32 say "Total Geral....:"
                     @ nlin2 + 16, 53 say ntotval picture ;
                        "9,999,999.99"
                     @ nlin2 + 16, 67 say ntotcomis picture ;
                        "9,999,999.99"
                     if (conflinha("Continua", 23, 2))
                        nlinha:= 5
                        janela(nlinha, ncoluna, nlinha + 17, ncoluna ;
                           + 78, " Consulta Listagem de Comissao ")
                        set color to W+/BG
                        @ nlinha + 1, ncoluna + 1 say ;
                           "Data    No.Orc.  Cliente                                  Valor     Val.Comis"
                        nlinha:= 7
                     else
                        exit
                     endif
                  endif
                  valfr:= CToD("  /  /  ")
                  observacao:= 0
                  cnomecli:= Space(30)
                  cdebcred:= 0
                  nloja:= 0
                  nvalcomis:= 0
                  skip 
               enddo
               @ nlin2 + 16, 32 say "Total Geral....:"
               @ nlin2 + 16, 53 say ntotval picture "9,999,999.99"
               @ nlin2 + 16, 67 say ntotcomis picture "9,999,999.99"
            elseif (ntipocomis == 3)
               select ContasRE
               goto top
               do while (!EOF())
                  observacao:= dt_emis_re
                  valfr:= dt_rece_re
                  nloja:= loja
                  cdebcred:= vl_rece_re
                  nvalcomis:= comissao
                  select Pedidos
                  seek Str(nloja, 2) + Str(observacao, 5)
                  if (Found())
                     if (vendedor != fonecomp)
                        select ContasRE
                        skip 
                        loop
                     endif
                     cnomecli:= Str(cliente, 5) + "-" + nome_cli
                  else
                     select ContasRE
                     skip 
                     loop
                  endif
                  ntotval:= ntotval + cdebcred
                  ntotcomis:= ntotcomis + nvalcomis
                  @ nlinha,  2 say valfr
                  @ nlinha, 11 say observacao
                  @ nlinha, 18 say cnomecli
                  @ nlinha, 53 say cdebcred picture "9,999,999.99"
                  @ nlinha, 67 say nvalcomis picture "9,999,999.99"
                  nlinha++
                  select CONTASRE
                  skip 
                  if (nlinha >= nlin2 + 14)
                     @ nlin2 + 16, 32 say "Total Geral....:"
                     @ nlin2 + 16, 53 say ntotval picture ;
                        "9,999,999.99"
                     @ nlin2 + 16, 67 say ntotcomis picture ;
                        "9,999,999.99"
                     if (conflinha("Continua", 23, 2))
                        nlinha:= 5
                        janela(nlinha, ncoluna, nlinha + 17, ncoluna ;
                           + 78, " Consulta Listagem de Comissao ")
                        set color to W+/BG
                        @ nlinha + 1, ncoluna + 1 say ;
                           "Data    No.Orc.  Cliente                                  Valor     Val.Comis"
                        nlinha:= 7
                     else
                        exit
                     endif
                  endif
                  valfr:= CToD("  /  /  ")
                  observacao:= 0
                  cnomecli:= Space(30)
                  cdebcred:= 0
                  nloja:= 0
                  nvalcomis:= 0
               enddo
               @ nlin2 + 16, 32 say "Total Geral....:"
               @ nlin2 + 16, 53 say ntotval picture "9,999,999.99"
               @ nlin2 + 16, 67 say ntotcomis picture "9,999,999.99"
            endif
            InKey(0)
            RestScreen(0, 0, 24, 79, ctela)
            close databases
            select 1
            close format
            return
         endif
      endif
   endif

********************************
procedure QSR3244

   private ncodigo, ddtfim, dbclearrel, crecpag, impvid, nlinha, ;
      ncoluna, ccor, ctela, valpess
   private lcontrole, ncont, v1[4], v2[4], v3[4], ddtinicio[4], vet[2]
   set escape on
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   cnome:= Space(20)
   csobre:= Space(20)
   cpessoa:= Space(1)
   ccor:= SetColor()
   ncont:= 0
   lcontrole:= .T.
   nlinha:= 10
   ncoluna:= 19
   ctela:= SaveScreen(0, 0, 24, 79)
   lcontrole:= .T.
   vet[1]:= "Sim"
   vet[2]:= "NÆo"
   ddtfim:= CToD("  /  /  ")
   dbclearrel:= CToD("  /  /  ")
   fonecomp:= 0
   nvalhora:= 0
   nextra:= 0
   nnotur:= 0
   do while (lcontrole)
      janela(nlinha, ncoluna, nlinha + 6, ncoluna + 43, ;
         " Consulta de Planilha de Horarios ")
      @ nlinha + 1, ncoluna + 2 say "Data Inicial"
      @ nlinha + 1, ncoluna + 15 say "Data Final  "
      @ nlinha + 1, ncoluna + 28 say "Vendedor "
      @ nlinha + 3, ncoluna + 2 say "Valor Hora"
      @ nlinha + 3, ncoluna + 14 say "Hora Extra(%)"
      @ nlinha + 3, ncoluna + 28 say "Adic.Noturno(%)"
      @ nlinha + 2, ncoluna + 2 get dDtInicio
      @ nlinha + 2, ncoluna + 15 get dDtFim
      @ nlinha + 2, ncoluna + 28 get nVend picture "99999" valid ;
         valcodi463(fonecomp) .AND. fonecomp != 0
      @ nlinha + 4, ncoluna + 2 get nValHora picture "999.99"
      @ nlinha + 4, ncoluna + 14 get nExtra picture "999.99"
      @ nlinha + 4, ncoluna + 28 get nNotur picture "999.99"
      read
      if (ddtfim = CToD(" /  /  "))
         ddtfim:= CToD("01/01/91")
      endif
      if (dbclearrel = CToD(" /  /  "))
         dbclearrel:= CToD("31/12/10")
      endif
      processand(.T.)
      if (!abredbf("HORARIO", "HORA2.NTX"))
         loop
      endif
      set filter to DATA >= dDtInicio .AND. DATA <= dDtFim .AND. ;
         FUNCIONA == nVend
      if (nvalhora > 0)
         if (nextra > 0)
            do while (!EOF())
               bloqueia()
               replace val_extra with horaminu(noturno) * nvalhora / ;
                  60 * nextra / 100
               skip 
            enddo
         endif
         if (nnotur > 0)
            goto top
            do while (!EOF())
               bloqueia()
               replace val_notur with horaminu(__geta) * nvalhora / ;
                  60 * nnotur / 100
               skip 
            enddo
         endif
      endif
      v1:= {"Data", "Dia", "P_INICIO", "P_FIM", "S_INICIO", "S_FIM", ;
         "T_INICIO", "T_FIM", "EXTRA", "VAL_EXTRA", "NOTURNO", ;
         "VAL_NOTUR"}
      v2:= {"", "", "", "", "", "", "", "", "", "", "", ""}
      v3:= {"Data", "Dia", "1§", "Fim", "2§", "Fim", "3§", "Fim", ;
         "Extra", "Valor", "Notur", "Valor"}
      ddtinicio:= {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1}
      ccoluna:= " Planilha de Horarios "
      goto top
      consulta("Horario", 3, 0, 21, 79, v1, v2, v3, ddtinicio, ;
         "NULO", ccoluna)
      if (nvalhora > 0)
         if (nextra > 0)
            goto top
            do while (!EOF())
               bloqueia()
               replace val_extra with 0
               skip 
            enddo
         endif
         if (nnotur > 0)
            goto top
            do while (!EOF())
               bloqueia()
               replace val_notur with 0
               skip 
            enddo
         endif
      endif
      lcontrole:= .F.
   enddo
   close
   set color to (ccor)
   RestScreen(0, 0, 24, 79, ctela)
   return

********************************
function QSR325

   private ncodigo, ddtfim, dbclearrel, crecpag, nlinha, ncoluna, ;
      ccor, ctela, valpess
   private lcontrole, ncont, v1[6], v2[6], v3[6], ddtinicio[6], ;
      vet[2], ccor, ccondicao
   cpesquisa:= {"CLIENTES", "CLIENTE1", "CODIGO_CLI", "nCodigo"}
   ccampos:= {"CODIGO_CLI", "NOME_CLI", "", "CODIGO", "NOME", ""}
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   ncodigo:= 0
   ddtfim:= CToD("  /  /  ")
   dbclearrel:= CToD("  /  /  ")
   crecpag:= Space(1)
   ccondicao:= Space(1)
   ncont:= 0
   lcontrole:= .T.
   nlinha:= 10
   ncoluna:= 19
   ctela:= SaveScreen(0, 0, 24, 79)
   vet[1]:= "Sim"
   vet[2]:= "NÆo"
   do while (lcontrole)
      processand(.F.)
      janela(nlinha, ncoluna, nlinha + 6, ncoluna + 43, ;
         " Pesquisa de Notas Fiscais ")
      @ nlinha + 1, ncoluna + 2 say "Data Inicial"
      @ nlinha + 1, ncoluna + 20 say "Data Final  "
      @ nlinha + 3, ncoluna + 2 say "Cliente"
      set color to (corfordado)
      @ nlinha + 2, ncoluna + 2 get dDtInicio
      @ nlinha + 2, ncoluna + 20 get dDtFim
      @ nlinha + 4, ncoluna + 2 get nCodigo picture "99999"
      read
      if (sai())
         loop
      endif
      processand(.T.)
      if (ddtfim = CToD(" /  /  "))
         ddtfim:= CToD("01/01/01")
      endif
      if (dbclearrel = CToD(" /  /  "))
         dbclearrel:= CToD("31/12/99")
      endif
      select 1
      if (!abredbf("NOTA_FIS", "NOTA2.NTX"))
         loop
      endif
      if (ncodigo != 0)
         set filter to Data >= dDtInicio .AND. Data <= dDtFim .AND. ;
            Codigo_Cli == nCodigo
      else
         set filter to Data >= dDtInicio .AND. Data <= dDtFim
      endif
      select 2
      if (!abredbf("CLIENTES", "CLIENTE1.NTX"))
         loop
      endif
      select 1
      if (.T.)
         dbSetRelation()
      endif
      confmovbc("CLIENTES", {|| codigo_cli}, "CODIGO_CLI")
      v1:= {"Codigo_Cli", "NOME_Cli", "Data", "Nota", "Valor_Nf", ;
         "ICMS"}
      v2:= {"", "", "", "", "", ""}
      v3:= {"Codigo;Cliente", "Nome;Cliente", "Data", "Nota", ;
         "Valor", "Valor ICMS"}
      ddtinicio:= {1, 2, 1, 1, 1, 1}
      ccoluna:= " Consulta de Notas Fiscais "
      consulta("Nota_Fis", 3, 1, 21, 78, v1, v2, v3, ddtinicio, ;
         "Pesq325", ccoluna)
      close databases
      select 1
      close format
      lcontrole:= .T.
   enddo
   set color to (ccor)
   RestScreen(0, 0, 24, 79, ctela)
   return .T.

********************************
function PESCONEN

   local Local1, Local2, Local3, Local4, Local5, Local6, Local7, ;
      Local8, Local9, Local10, Local11, Local12, Local13, Local14
   private vetor1[4], vetor2[4], vetor3[4], vetor4[4]
   Local9:= 7
   Local10:= 19
   Local13:= SetColor()
   Local11:= 0
   Local12:= .T.
   observacao:= num_doc
   gertemp236(observacao)
   close
   select 2
   use (carq2)
   vetor1:= {"Codigo_Mat", "Descricao", "Quantidade", "Valor"}
   vetor2:= {"", "", "", ""}
   vetor3:= {"Codigo", "Descricao", "Quantidade", "Valor"}
   vetor4:= {2, 2, 2, 2}
   ccoluna:= " Consultas de Produtos de Entradas de Estoque "
   consped(Nil, Local9, 1, Local9 + 11, Local10 + 59, vetor1, ;
      vetor2, vetor3, vetor4, ccoluna)
   select 1
   set color to (Local13)
   keyboard " "
   return Nil

********************************
function PESQ325

   private ncodcli, ddtvenc, nnumped, pesq23i, nvalortit, naliq, nicms
   private cnumdoc, nlinha, ncoluna, vet[2], nresp, ncont, ccor, ctela
   private tempestru
   ddtvenc:= 0
   nicms:= 0
   naliq:= 0
   ncodcli:= 0
   pesq23i:= 0
   nvalortit:= CToD("  /  /  ")
   tempestru:= 0
   cnumdoc:= 0
   vet[1]:= "Sim"
   vet[2]:= "No"
   nlinha:= 6
   ncoluna:= 20
   ctel2:= SaveScreen(0, 0, 24, 79)
   lcontrole:= .T.
   janela(nlinha, ncoluna, nlinha + 10, ncoluna + 43, ;
      " Consulta de Notas Fiscais ")
   nlinha++
   select 1
   ncodcli:= codigo_cli
   tempestru:= notamanife
   cnomecli:= clientes->nome_cli
   @ nlinha, ncoluna + 2 say "Cod. Cliente      Nome do Cliente"
   @ nlinha + 2, ncoluna + 2 say "N§ Nota Fisc"
   @ nlinha + 2, ncoluna + 20 say "N§ Pedido"
   @ nlinha + 4, ncoluna + 2 say "Valor Nota"
   @ nlinha + 4, ncoluna + 20 say "Aliquota"
   @ nlinha + 6, ncoluna + 2 say "Valor Icms"
   @ nlinha + 6, ncoluna + 20 say "Data"
   @ nlinha + 1, ncoluna + 2 get Codigo_Cli picture "99999"
   @ nlinha + 1, ncoluna + 20 get cNomeCli picture ;
      "XXXXXXXXXXXXXXXXXXXXXX"
   @ nlinha + 3, ncoluna + 2 get Nota picture "99999"
   @ nlinha + 3, ncoluna + 20 get Pedido picture "99999"
   @ nlinha + 5, ncoluna + 2 get Valor_NF picture "@E 999,999,999.99"
   @ nlinha + 5, ncoluna + 20 get Aliquota picture "99.99"
   @ nlinha + 7, ncoluna + 2 get Icms picture "@E 999,999,999.99"
   @ nlinha + 7, ncoluna + 20 get Data
   clear gets
   do while (lcontrole)
      ntecla:= InKey(0)
      if (ntecla == 27)
         lcontrole:= .F.
      endif
   enddo
   set color to (ccor)
   nlinha:= 4
   ncoluna:= 20
   RestScreen(0, 0, 24, 79, ctel2)
   return Nil

********************************
function GERTEMP361(Arg1, Arg2)

   local Local1
   Local1:= .F.
   select 2
   if (!abredbf("ENTRADAS", "ENTRADA3.NTX"))
      return .F.
   endif
   select 3
   if (!abredbf("FORNECED", "FORNECE1.NTX"))
      return .F.
   endif
   select 1
   use (dbcreate)
   select 2
   set softseek on
   seek Arg1
   set softseek off
   if (!EOF())
      do while (data >= Arg1 .AND. data <= Arg2)
         if (ncodigo != 0)
            if (fornecedor != ncodigo)
               skip 
               loop
            endif
         endif
         nforn:= fornecedor
         nnumero:= num_docto
         valfr:= data
         nvaltot:= valor_tot
         ddt_venc:= tipo_docto
         ndest:= destino
         select 3
         seek nforn
         if (Found())
            cnomefor:= nome
         else
            cnomefor:= " Fornecedor nao cadastrado "
         endif
         select 1
         if (!adiciona())
            loop
         endif
         replace codigo_for with nforn
         replace nome_for with cnomefor
         replace num_doc with nnumero
         replace data with valfr
         replace valor_tot with nvaltot
         replace destino with ndest
         replace tipo_doc with ddt_venc
         select 2
         skip 
         nlinha++
      enddo
   endif
   select 2
   close
   select 3
   close
   return

********************************
procedure QSR3261

   private ncodigo, ddtfim, dbclearrel, crecpag, nlinha, ncoluna, ;
      ccor, ctela, valpess
   private lcontrole, ncont, v1[7], v2[7], v3[7], ddtinicio[7], ;
      vet[2], ccor, carquivo[7], temp2[4]
   cpesquisa:= {"FORNECED", "FORNECE2", "CODIGO_FOR", "nCodigo"}
   ccampos:= {"CODIGO_FOR", "NOME", "", "CODIGO", "NOME", ""}
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   ncodigo:= 0
   ddtfim:= CToD("  /  /  ")
   dbclearrel:= CToD("  /  /  ")
   nlinha:= 3
   ncoluna:= 1
   ncont:= 0
   lcontrole:= .T.
   nlinha:= 10
   ncoluna:= 19
   ctela:= SaveScreen(0, 0, 24, 79)
   vet[1]:= "Sim"
   vet[2]:= "NÆo"
   carquivo[1]:= {"Codigo_For", "N", 5, 0}
   carquivo[2]:= {"Nome_For", "C", 30, 0}
   carquivo[3]:= {"Data", "D", 8, 0}
   carquivo[4]:= {"Tipo_Doc", "C", 2, 0}
   carquivo[5]:= {"Num_Doc", "C", 10, 0}
   carquivo[6]:= {"Destino", "N", 2, 0}
   carquivo[7]:= {"Valor_Tot", "N", 12, 2}
   ncont:= 1
   dbcreate:= "TEMP" + LTrim(Str(ncont)) + ".DBF"
   do while (file(dbcreate))
      ncont++
      dbcreate:= "TEMP" + LTrim(Str(ncont)) + ".DBF"
   enddo
   cprod(dbcreate, carquivo)
   ncont:= 1
   carq2:= "TEMP" + LTrim(Str(ncont)) + ".DBF"
   do while (file(carq2))
      ncont++
      carq2:= "TEMP" + LTrim(Str(ncont)) + ".DBF"
   enddo
   temp2[1]:= {"Codigo_Mat", "C", 6, 0}
   temp2[2]:= {"Descricao", "C", 30, 0}
   temp2[3]:= {"Quantidade", "N", 12, 2}
   temp2[4]:= {"Valor", "N", 12, 2}
   cprod(carq2, temp2)
   do while (lcontrole)
      processand(.F.)
      janela(nlinha, ncoluna, nlinha + 6, ncoluna + 43, ;
         " Pesquisa de Entradas no Estoque ")
      @ nlinha + 1, ncoluna + 2 say "Data Inicial"
      @ nlinha + 1, ncoluna + 20 say "Data Final  "
      @ nlinha + 3, ncoluna + 2 say "Fornecedor "
      @ nlinha + 2, ncoluna + 2 get dDtInicio
      @ nlinha + 2, ncoluna + 20 get dDtFim
      @ nlinha + 4, ncoluna + 2 get nCodigo picture "99999"
      read
      if (sai())
         loop
      endif
      if (ddtfim = CToD(" /  /  "))
         ddtfim:= CToD("01/01/91")
      endif
      if (dbclearrel = CToD(" /  /  "))
         dbclearrel:= CToD("31/12/10")
      endif
      gertemp361(ddtfim, dbclearrel)
      select 1
      v1:= {"Codigo_For", "Nome_For", "Data", "Tipo_Doc", "Num_Doc", ;
         "Destino", "Valor_Tot"}
      v2:= {"99999", "@!", "", "", "9.999.999,99", ""}
      v3:= {"Cod;For", "Nome;Fornecedor", "Data", "Tipo", ;
         "Documento", "Dest", "Valor_Tot"}
      ddtinicio:= {1, 1, 1, 1, 1, 1, 1}
      ccoluna:= " Consultas de Entradas no Estoque "
      consulta(Nil, 3, 1, 21, 78, v1, v2, v3, ddtinicio, "PesConEN", ;
         ccoluna)
      close databases
      select 1
      close format
      lcontrole:= .F.
   enddo
   close databases
   select 1
   close format
   impritrans(dbcreate)
   impritrans(carq2)
   set color to (ccor)
   nlinha:= 10
   ncoluna:= 19
   RestScreen(0, 0, 24, 79, ctela)
   return

********************************
function QSR411

   private ccabecalho, nlinha, ccoluna, clinha, cnomemp, vet[2], ;
      cporta
   private impcontasa, nagencia, nloja, valfr, chistor, cdocto, ;
      chistorico
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   ccabecalho:= 1
   nlinha:= 1
   cnomemp:= cempresa
   ccoluna:= "Relatorio de Clientes" + Replicate(" ", 101) + ;
      "Pagina :" + Str(ccabecalho, 3)
   clinha:= ;
      "Data     Historico                       Documento  Deb/Cred           Valor Conf             Saldo     Saldo Conf."
   impcontasa:= Replicate("-", 134)
   ddtfim:= CToD("")
   dbclearrel:= CToD("")
   lcontrole:= .T.
   fonecomp:= 0
   cimpcontas:= "N"
   nlinha:= 10
   ncoluna:= 16
   ctela:= SaveScreen(0, 0, 24, 79)
   vet[1]:= "Sim"
   vet[2]:= "NÆo"
   ncodigo:= 0
   cnomeinic:= Space(30)
   ccoluna2:= 0
   csintetico:= "S"
   ccidade:= Space(23)
   ncodigo:= 0
   ctelefone:= "  "
   cimptela:= "I "
   janela(nlinha, ncoluna, nlinha + 9, ncoluna + 46, ;
      " Relatorio de Clientes ")
   nlinha++
   @ nlinha + 0, ncoluna + 2 say "Data Inicial"
   @ nlinha + 0, ncoluna + 15 say "Data Final"
   @ nlinha + 2, ncoluna + 2 say "Vendedor"
   @ nlinha + 2, ncoluna + 12 say "Resumo"
   @ nlinha + 2, ncoluna + 20 say "Estado"
   @ nlinha + 4, ncoluna + 2 say "Cliente"
   @ nlinha + 4, ncoluna + 12 say "Cidade"
   do while (lcontrole)
      @ nlinha + 1, ncoluna + 2 get dDtinicio
      @ nlinha + 1, ncoluna + 15 get dDtfim
      @ nlinha + 3, ncoluna + 2 get nVend picture "99999"
      @ nlinha + 3, ncoluna + 12 get cSintetico picture "!" valid ;
         csintetico $ "SN"
      @ nlinha + 3, ncoluna + 20 get cEstado picture "!!"
      @ nlinha + 5, ncoluna + 2 get nCodigo picture "99999"
      @ nlinha + 5, ncoluna + 12 get cCidade picture "@!"
      @ nlinha + 7, ncoluna + 2 say "Imprimir P/ (Imp./Video)" get ;
         cImpTela picture "!!" valid cimptela $ "V I "
      read
      if (sai())
         loop
      endif
      if (!abredbf("FUNCIONA", "FUNCION1.NTX"))
         loop
      endif
      seek fonecomp
      if (Found())
         cnomevend:= nome
      else
         cnomevend:= "NÆo Cadastrado"
      endif
      if (fonecomp == 0)
         cnomevend:= "Geral"
      endif
      if (!abredbf("CLIENTES", "CLIENTE2.NTX"))
         loop
      endif
      if (!Empty(ctelefone))
         set index to CLIENTE6
      endif
      if (ncodigo == 0)
         private cfiltro[3, 2]
         cfiltro[1]:= {"ESTADO_CLI = cEstado", ctelefone}
         cfiltro[2]:= {"CIDADE_CLI = cCidade", ccidade}
         cfiltro[3]:= {"VENDEDOR = nVend", fonecomp}
         carg:= filtgeral(cfiltro)
         if (Empty(carg))
            set filter to
         else
            set filter to &carg
         endif
      else
         set filter to CODIGO_CLI = nCodigo
      endif
      set order to 1
      if (impressora() == 1)
         set device to printer
         @ PRow(), PCol() say ""
         @  1,  1 say cnomemp
         @  2,  1 say "Relatorio de Clientes" + Replicate(" ", 101) ;
            + "Pagina :" + Str(ccabecalho, 3)
         @  3,  1 say "Vendedor " + cnomevend + " UF.: " + ctelefone
         @  4,  1 say impcontasa
         nlinha:= 5
         if (csintetico = "S")
            @  5,  1 say "Codigo"
            @  5,  9 say "Nome"
            @  5, 51 say "Pessoa"
            @  5, 58 say "Telefone"
            @  5, 100 say "UF"
            @  5, 103 say "Cidade"
            @  6,  1 say impcontasa
            nlinha:= 7
         endif
         goto top
         do while (!EOF())
            if (!Empty(ddtfim))
               if (dt_1ac_cli < ddtfim)
                  skip 
                  loop
               endif
               if (dt_1ac_cli > dbclearrel)
                  skip 
                  loop
               endif
            endif
            if (csintetico = "S")
               @ nlinha,  1 say codigo_cli
               @ nlinha,  9 say nome_cli
               if (pessoa_cli == "F")
                  @ nlinha, 51 say "Fisica"
               else
                  @ nlinha, 51 say "Jurid."
               endif
               @ nlinha, 58 say fone_cli + " " + fone2_cli + " " + ;
                  fone3_cli
               @ nlinha, 100 say estado_cli
               @ nlinha, 103 say SubStr(cidade_cli, 1, 25)
               nlinha++
               nlinha:= p411(nlinha)
            else
               nlinha++
               @ nlinha,  1 say "Codigo"
               @ nlinha,  9 say "Nome"
               @ nlinha, 51 say "Pessoa"
               if (pessoa_cli = "F")
                  @ nlinha, 78 say "CPF"
                  @ nlinha, 104 say "Identidade"
                  @ nlinha, 114 say "Data Nasc"
               elseif (pessoa_cli = "J")
                  @ nlinha, 78 say "CGC"
                  @ nlinha, 94 say "Inscricao"
               endif
               nlinha++
               nlinha:= p411(nlinha)
               @ nlinha,  1 say codigo_cli
               @ nlinha,  9 say nome_cli
               if (pessoa_cli == "F")
                  @ nlinha, 51 say "Fisica"
               else
                  @ nlinha, 51 say "Jurid."
               endif
               @ nlinha, 78 say cpf_cli
               @ nlinha, 94 say identi_cli
               @ nlinha, 114 say dencom_cli
               @ nlinha, 78 say cgc_cli
               @ nlinha, 94 say insc_cli
               nlinha++
               nlinha:= p411(nlinha)
               ncodigo:= codigo_cli
               @ nlinha,  1 say "Endereco"
               @ nlinha, 45 say "Cidade"
               @ nlinha, 70 say "Bairro"
               @ nlinha, 87 say "UF"
               @ nlinha, 90 say "Fone"
               nlinha++
               nlinha:= p411(nlinha)
               @ nlinha,  1 say endere_cli
               @ nlinha, 45 say cidade_cli
               @ nlinha, 70 say bairro_cli
               @ nlinha, 87 say estado_cli
               @ nlinha, 90 say fone_cli
               nlinha++
               nlinha:= p411(nlinha)
               @ nlinha,  1 say "Comprador"
               @ nlinha, 34 say "Data Nasc"
               @ nlinha, 44 say "Bairro"
               @ nlinha, 61 say "Identidade"
               @ nlinha, 76 say "Endereco"
               nlinha++
               nlinha:= p411(nlinha)
               @ nlinha,  1 say compra_cli
               @ nlinha, 34 say cpf_com
               @ nlinha, 44 say dt_ulc_cli
               @ nlinha, 61 say endere_com
               @ nlinha, 76 say cep_com
               nlinha++
               nlinha:= p411(nlinha)
               @ nlinha,  1 say "Cidade"
               @ nlinha, 25 say "Bairro"
               @ nlinha, 42 say "Fone"
               nlinha++
               nlinha:= p411(nlinha)
               @ nlinha,  1 say bairro_com
               @ nlinha, 25 say dt_ulc_cli
               @ nlinha, 42 say fone_com
               nlinha++
               nlinha:= p411(nlinha)
               @ nlinha,  1 say "Observacao"
               nlinha++
               nlinha:= p411(nlinha)
               @ nlinha,  1 say obs1
               nlinha++
               nlinha:= p411(nlinha)
               @ nlinha,  1 say obs2
               nlinha++
               nlinha:= p411(nlinha)
               @ nlinha,  1 say impcontasa
               nlinha++
            endif
            skip 
         enddo
         set device to screen
      endif
      if (cimptela = "V ")
         edittexto(cporta)
      endif
      lcontrole:= .F.
   enddo
   set color to (ccor)
   close databases
   select 1
   close format
   RestScreen(0, 0, 24, 79, ctela)
   return Nil

********************************
function QSR414

   private ccabecalho, nlinha, ccoluna, clinha, cnomemp, vet[2]
   private impcontasa, nagencia, nloja, valfr, chistor, cdocto, ;
      chistorico
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   ccabecalho:= 1
   nlinha:= 1
   cnomemp:= cempresa
   ccoluna:= "Relatorio de Clientes" + Replicate(" ", 101) + ;
      "Pagina :" + Str(ccabecalho, 3)
   clinha:= ;
      "Codigo    Nome                              Dt Nas   Telefone       Cidade                    UF"
   impcontasa:= Replicate("-", 134)
   nmes:= 0
   lcontrole:= .T.
   fonecomp:= 0
   cimpcontas:= " "
   nlinha:= 10
   ncoluna:= 19
   ctela:= SaveScreen(0, 0, 24, 79)
   vet[1]:= "Sim"
   vet[2]:= "NÆo"
   ncodigo:= 0
   janela(nlinha, ncoluna, nlinha + 7, ncoluna + 43, ;
      " Relatorio de Clientes por Aniversario ")
   nlinha++
   do while (lcontrole)
      processand(.F.)
      @ nlinha + 0, ncoluna + 2 say "Mes"
      @ nlinha + 1, ncoluna + 2 get nMes picture "99" valid nmes <= 12
      read
      if (sai())
         loop
      endif
      processand(.T.)
      if (!abredbf("CLIENTES", "CLIENTE2.NTX"))
         loop
      endif
      set order to 1
      if (impressora() == 1)
         set device to printer
         @  0,  0 say "C" + Chr(nlinform)
         @  0,  0 say ""
         @  1,  1 say "" + cnomemp + ""
         @  1,  1 say ""
         @  2,  1 say "Relatorio de Clientes" + Replicate(" ", 101) ;
            + "Pagina :" + Str(ccabecalho, 3)
         @  3,  1 say clinha
         @  4,  1 say impcontasa
         nlinha:= 5
         do while (!EOF())
            if (Month(dencom_cli) != nmes)
               skip 
               loop
            endif
            @ nlinha + 1,  1 say codigo_cli
            @ nlinha + 1, 11 say nome_cli
            @ nlinha + 1, 45 say dencom_cli
            @ nlinha + 1, 54 say fone_cli
            @ nlinha + 1, 69 say cidade_cli
            @ nlinha + 1, 95 say estado_cli
            nlinha++
            if (nlinha > nalturafor)
               rodape(nalturafor, .F., 134)
               ccabecalho++
               nlinha:= 5
               eject
               @  0,  0 say ""
               @  1,  1 say "" + cnomemp + ""
               @  1,  1 say ""
               @  2,  1 say "Relatorio de Clientes" + Replicate(" ", ;
                  101) + "Pagina :" + Str(ccabecalho, 3)
               @  3,  1 say impcontasa
               @  4,  1 say clinha
            endif
            skip 
         enddo
         rodape(nalturafor, .T., 134)
         @ nlinha + 1,  0 say ""
         @ nlinha + 1,  0 say ""
         set device to screen
      endif
      lcontrole:= .F.
   enddo
   set color to (ccor)
   close databases
   select 1
   close format
   RestScreen(0, 0, 24, 79, ctela)
   return Nil

********************************
function QSR4514

   private ccabecalho, nlinha, ccoluna, clinha, cnomemp, vet[2]
   private ngrupo, cnomgrupo, ccodigo, cdescr, nporcvista, impcontasa
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   ccabecalho:= 1
   nlinha:= 1
   npedido:= 0
   nvias:= 0
   nviaimpr:= 0
   impcontasa:= Replicate("-", 79)
   nlinha:= 15
   ncoluna:= 19
   ctela:= SaveScreen(0, 0, 24, 79)
   vet[1]:= "Sim"
   vet[2]:= "NÆo"
   processand(.F.)
   janela(nlinha, ncoluna, nlinha + 4, ncoluna + 43, ;
      " Reimpressao de Pedido de Devolucao ")
   @ nlinha + 1, ncoluna + 2 say "Numero do Pedido"
   @ nlinha + 2, ncoluna + 2 get nPedido picture "99999" valid ;
      valpedimp(npedido)
   read
   if (sai())
      set color to (ccor)
      RestScreen(0, 0, 24, 79, ctela)
      return Nil
   endif
   processand(.T.)
   imprinf(npedido)
   close databases
   select 1
   close format
   RestScreen(0, 0, 24, 79, ctela)
   return

********************************
function QSR415

   private ccabecalho, nlinha, ccoluna, clinha, cnomemp, vet[2]
   private impcontasa, nagencia, nloja, valfr, chistor, cdocto, ;
      chistorico
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   ccabecalho:= 1
   nlinha:= 1
   cnomemp:= cempresa
   ccoluna:= "Relatorio de Clientes por Cidade/Setor" + ;
      Replicate(" ", 83) + "Pagina :" + Str(ccabecalho, 3)
   clinha:= ;
      "CODIGO        NOME DO CLIENTE                PES Credito Usado  1§ Compra / Ultima   Cidade               Bairro        Telefone"
   impcontasa:= Replicate("-", 134)
   tip_doc_ar:= ;
      "Tipo        N§ Documento  Data Venc.          Valor    SituaÆo"
   tip_doc_re:= ;
      "Tipo        N§ Documento  Data Venc.          Valor    Pagamento   Valor do Pagamento"
   ddtfim:= CToD("")
   dbclearrel:= CToD("")
   lcontrole:= .T.
   fonecomp:= 0
   cimpcontas:= " "
   nlinha:= 10
   ncoluna:= 16
   ctela:= SaveScreen(0, 0, 24, 79)
   vet[1]:= "Sim"
   vet[2]:= "NÆo"
   ncodigo:= 0
   ccidade:= Space(15)
   cestado:= Space(15)
   ccoluna2:= 0
   janela(nlinha, ncoluna, nlinha + 9, ncoluna + 46, ;
      " Relatorio de Clientes Bairro/Cidade ")
   nlinha++
   @ nlinha + 0, ncoluna + 2 say "Data Inicial"
   @ nlinha + 0, ncoluna + 15 say "Data Final"
   @ nlinha + 2, ncoluna + 2 say "Vendedor"
   @ nlinha + 2, ncoluna + 12 say "Cidade"
   @ nlinha + 2, ncoluna + 30 say "Bairro"
   @ nlinha + 4, ncoluna + 2 say ;
      "Nada/A receber/Recebidas/Extrato (NARE) ?"
   @ nlinha + 5, ncoluna + 2 say ;
      "Numero de Ultimos Titulos a Imprimir    ?"
   do while (lcontrole)
      @ nlinha + 1, ncoluna + 2 get DDTINICIO
      @ nlinha + 1, ncoluna + 15 get DDTFIM
      @ nlinha + 3, ncoluna + 2 get NVEND picture "99999"
      @ nlinha + 3, ncoluna + 12 get CCIDADE
      @ nlinha + 3, ncoluna + 30 get CBAIRRO
      @ nlinha + 4, ncoluna + 44 get CIMPCONTAS picture "!" valid ;
         cimpcontas $ "NARE"
      @ nlinha + 5, ncoluna + 44 get NNUMTITULOS picture "99"
      read
      if (sai())
         loop
      endif
      cnomevend:= procura("FUNCIONA", "FUNCION1", fonecomp, "NOME")
      if (fonecomp == 0)
         cnomevend:= "Geral"
      endif
      if (!abredbf("CLIENTES"))
         loop
      endif
      index on CIDADE_CLI+BAIRRO_CLI to TEMP
      if (Empty(fonecomp))
      elseif (!Empty(fonecomp))
         set filter to VENDEDOR = NVEND
      endif
      if (Empty(ccidade))
      elseif (!Empty(ccidade))
         set filter to CIDADE_CLI = CCIDADE
      endif
      if (Empty(cestado))
      elseif (!Empty(cestado))
         set filter to BAIRRO_CLI = CBAIRRO
      endif
      set order to 1
      seek ccidade + cestado
      if (EOF())
         alert("Cidade/Setor Inicial NÆo Existe! Operao ser  cancelada.")
         exit
      endif
      if (impressora() == 1)
         set device to printer
         @  0,  0 say "C" + Chr(nlinform)
         @  0,  0 say ""
         @  1,  1 say "" + cnomemp + ""
         @  1,  1 say ""
         @  2,  1 say ccoluna
         @  3,  1 say "Vendedor " + cnomevend
         @  4,  1 say clinha
         @  5,  1 say impcontasa
         nlinha:= 6
         do while (!EOF())
            if (!Empty(ddtfim))
               if (conjug_cli < ddtfim)
                  skip 
                  loop
               endif
            endif
            if (!Empty(dbclearrel))
               if (conjug_cli > dbclearrel)
                  skip 
                  loop
               endif
            endif
            set device to screen
            @ 17, 19 say nome_cli
            set device to printer
            nlinha++
            nlinha:= npagina(nlinha)
            @ nlinha,  0 say codigo_cli
            @ nlinha, 15 say nome_cli
            @ nlinha, 48 say pessoa_cli
            @ nlinha, 50 say conta_bco picture "9,999,999.99"
            @ nlinha, 64 say npc_ul_cli
            @ nlinha, 74 say dt_1ac_cli
            @ nlinha, 84 say SubStr(cidade_cli, 1, 20) + "/" + ;
               bairro_cli
            @ nlinha, 122 say fone_cli
            ncodigo:= codigo_cli
            if (cimpcontas == "A" .OR. cimpcontas == "E")
               nlinha++
               nlinha:= npagina(nlinha)
               cimpcab(ncodigo)
            endif
            if (cimpcontas == "R" .OR. cimpcontas == "E")
               nlinha++
               nlinha:= npagina(nlinha)
               ccoluna3(ncodigo)
               nlinha++
               @ nlinha,  1 say impcontasa
            endif
            nlinha++
            nlinha:= npagina(nlinha)
            skip 
         enddo
         @ nlinha,  1 say impcontasa
         rodape(nalturafor, .T., 134)
         @ nlinha + 1,  0 say ""
         @ nlinha + 1,  0 say ""
         set device to screen
      endif
      lcontrole:= .F.
   enddo
   set color to (ccor)
   close databases
   select 1
   close format
   impritrans("TEMP.NTX")
   RestScreen(0, 0, 24, 79, ctela)
   return Nil

********************************
function QSR421

   private ccabecalho, nlinha, ccoluna, clinha, cnomemp, vet[2]
   private ngrupo, cnomgrupo, ccodigo, cdescr, nporcvista, impcontasa
   private nporcprazo, nprecovist, nprecopraz, cunidade, nvias, ;
      nviaimpr
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   ccabecalho:= 1
   nlinha:= 1
   cnomemp:= cempresa
   ccoluna:= "Relatorio de Saldos Bancario" + Replicate(" ", 39) + ;
      "Pagina :" + Str(ccabecalho, 3)
   clinha:= ;
      "Conta    Nome do Banco                    Agencia          Saldo    Saldo Conf."
   nvias:= 0
   nviaimpr:= 0
   impcontasa:= Replicate("-", 79)
   lcontrole:= .T.
   nconta:= 0
   cnomebanc:= Space(30)
   nlinhafim:= 0
   nsaldocon:= 0
   nsaldoconf:= 0
   nlinha:= 10
   ncoluna:= 19
   ctela:= SaveScreen(0, 0, 24, 79)
   vet[1]:= "Sim"
   vet[2]:= "NÆo"
   janela(nlinha, ncoluna, nlinha + 6, ncoluna + 43, ;
      "Relatorio de Saldos Contas Correntes")
   nlinha++
   @ nlinha + 1, ncoluna + 2 say "Conta"
   do while (lcontrole)
      processand(.F.)
      @ nlinha + 2, ncoluna + 2 get nConta picture "99999999999999"
      read
      if (sai())
         loop
      endif
      processand(.T.)
      if (!abredbf("BANCOS", "BANCOS1.NTX"))
         loop
      endif
      set order to 2
      if (Empty(nconta))
      elseif (!Empty(nconta))
         set filter to Conta_Bc == nConta
      endif
      if (impressora() == 1)
         set device to printer
         @  0,  0 say "C" + Chr(nlinform)
         @  1,  1 say "" + cnomemp + ""
         @  2,  1 say "Relatorio de Saldos Bancario" + ;
            Replicate(" ", 39) + "Pagina :" + Str(ccabecalho, 3)
         @  3,  1 say impcontasa
         @  4,  1 say clinha
         @  5,  1 say impcontasa
         nlinha:= 6
         select Bancos
         goto top
         do while (!EOF())
            nconta:= qsr21c->ag_ban_bc
            cnomebanc:= qsr21c->nom_ban_bc
            nlinhafim:= qsr21c->valcontai
            nsaldocon:= qsr21c->saldo_bc
            nsaldoconf:= qsr21c->sa_conf_bc
            @ nlinha,  1 say LTrim(Str(nconta))
            @ nlinha, 10 say cnomebanc
            @ nlinha, 46 say nlinhafim
            @ nlinha, 51 say nsaldocon picture "999,999,999.99"
            @ nlinha, 66 say nsaldoconf picture "999,999,999.99"
            skip 
            nlinha++
            if (nlinha > nalturafor)
               rodape(nalturafor, .F., 79)
               ccabecalho++
               nlinha:= 6
               eject
               @  1,  1 say "" + cnomemp + ""
               @  2,  1 say "Relatorio de Saldos Bancario" + ;
                  Replicate(" ", 39) + "Pagina :" + Str(ccabecalho, 3)
               @  3,  1 say impcontasa
               @  4,  1 say clinha
               @  5,  1 say impcontasa
            endif
            nconta:= 0
            cnomebanc:= Space(30)
            nlinhafim:= 0
            nsaldocon:= 0
            nsaldoconf:= 0
         enddo
      endif
      lcontrole:= .F.
   enddo
   rodape(nalturafor, .T., 79)
   set device to screen
   set color to (ccor)
   close databases
   select 1
   close format
   RestScreen(0, 0, 24, 79, ctela)
   return Nil

********************************
procedure QSR56

   private corlinha, corlinmenu, corcorpo, cortitfor, corfor, ;
      corfordado, coropcoes
   private cores[17], vet[2], v1[1], v2[1], v3[1], ddtinicio[1]
   set escape on
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   lcontrole:= .T.
   nlinha:= 7
   ncoluna:= 19
   ctela:= SaveScreen(nlinha, ncoluna, nlinha + 22, ncoluna + 35)
   lcontrole:= .T.
   vet[1]:= "Sim"
   vet[2]:= "NÆo"
   do while (lcontrole)
      use Parametr
      editar("Parametr", 3, 1, 21, 78)
      close
      variaveis()
      if (LastKey() == K_ESC)
         lcontrole:= .F.
      endif
   enddo
   close
   set color to (ccor)
   RestScreen(nlinha, ncoluna, nlinha + 22, ncoluna + 35, ctela)
   return

********************************
function QSR422

   private ccabecalho, nlinha, ccoluna, clinha, cnomemp, vet[2]
   private impcontasa, nagencia, cbanco, valfr, chistor, cdocto, ;
      chistorico
   private nsaldocon, nsaldoconf, cdebcred, cconf
   cpesquisa:= {"BANCOS", "BANCOS1", "CONTA_BC", "nConta"}
   ccampos:= {"CONTA_BC", "NOM_BAN_BC", "", "CONTA", ;
      "NOME DA CONTA", ""}
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   ccabecalho:= 1
   nlinha:= 1
   cnomemp:= cempresa
   ccoluna:= "Relatorio de Extrato Bancario" + Replicate(" ", 93) + ;
      "Pagina :" + Str(ccabecalho, 3)
   clinha:= ;
      "Data     Historico                       Documento  Deb/Cred           Valor Conf             Saldo     Saldo Conf."
   impcontasa:= Replicate("-", 134)
   lcontrole:= .T.
   nconta:= 0
   nagencia:= Space(30)
   valfr:= CToD("  /  /  ")
   chistor:= Space(30)
   cdocto:= Space(8)
   chistorico:= " "
   nvaldeb:= 0
   nvalcre:= 0
   cdebcred:= 0
   cconf:= " "
   nsaldocon:= 0
   nsaldoconf:= 0
   nsaldoinic:= 0
   nlinha:= 10
   ncoluna:= 19
   ctela:= SaveScreen(0, 0, 24, 79)
   nconta:= 0
   ddtfim:= CToD("  /  /  ")
   dbclearrel:= CToD("  /  /  ")
   vet[1]:= "Sim"
   vet[2]:= "NÆo"
   janela(nlinha, ncoluna, nlinha + 6, ncoluna + 43, ;
      "Relatorio de Movimento Contas Correntes")
   nlinha++
   @ nlinha, ncoluna + 2 say "Conta"
   @ nlinha + 2, ncoluna + 2 say "Data Inicial"
   @ nlinha + 2, ncoluna + 19 say "Data Final  "
   do while (lcontrole)
      processand(.F.)
      @ nlinha + 1, ncoluna + 2 get nConta picture "99999999999999" ;
         valid nconta != 0
      @ nlinha + 3, ncoluna + 2 get dDtInicio
      @ nlinha + 3, ncoluna + 19 get dDtFim
      read
      if (ddtfim == CToD("  /  /  "))
         ddtfim:= CToD("01/01/91")
      endif
      if (dbclearrel == CToD("  /  /  "))
         dbclearrel:= CToD("31/12/10")
      endif
      ccoldata:= "Periodo  de  " + DToC(ddtfim) + "   a   " + ;
         DToC(dbclearrel)
      if (sai())
         loop
      endif
      processand(.T.)
      if (!abredbf("MOV_BCO"))
         loop
      endif
      set index to MV_BCO2, MV_BCO3
      do while (!EOF() .AND. pesconmb->data_mb < ddtfim)
         if (conta_mb = nconta)
            if (pesconmb->debcred_mb = "C")
               nsaldocon:= nsaldocon + valor_mb
               if (confir_mb = "S")
                  nsaldoconf:= nsaldoconf + valor_mb
               endif
            elseif (pesconmb->debcred_mb = "D")
               nsaldocon:= nsaldocon - valor_mb
               if (confir_mb = "S")
                  nsaldoconf:= nsaldoconf - valor_mb
               endif
            endif
         endif
         skip 
      enddo
      set filter to Data_MB <= dDtFim .AND. Data_MB >= dDtInicio ;
         .AND. Conta_MB == nConta
      select 2
      if (!abredbf("BANCOS", "BANCOS1.NTX"))
         loop
      endif
      seek nconta
      if (Found())
         nagencia:= "Conta : " + LTrim(Str(nconta, 14)) + "  " + ;
            qsr21c->nom_ban_bc
      endif
      close
      if (impressora() == 1)
         set device to printer
         @  0,  0 say "C" + Chr(nlinform)
         @  0,  0 say ""
         @  1,  1 say "" + cnomemp + ""
         @  1,  1 say ""
         @  2,  1 say "Relatorio de Extrato Bancario" + ;
            Replicate(" ", 93) + "Pagina :" + Str(ccabecalho, 3)
         @  3,  1 say ccoldata
         @  4,  1 say impcontasa
         @  5,  1 say nagencia
         @  6,  1 say clinha
         @  7,  1 say impcontasa
         nlinha:= 8
         @ nlinha,  1 say "Saldo Inicial "
         @ nlinha,  1 say "Saldo Inicial "
         @ nlinha, 86 say nsaldocon picture "999,999,999.99"
         @ nlinha, 102 say nsaldoconf picture "999,999,999.99"
         nlinha++
         select Mov_Bco
         goto top
         do while (!EOF())
            valfr:= pesconmb->data_mb
            chistor:= pesconmb->histor_mb
            cdocto:= pesconmb->docto_mb
            chistorico:= pesconmb->debcred_mb
            cdebcred:= pesconmb->valor_mb
            cconf:= pesconmb->confir_mb
            if (chistorico == "C")
               nsaldocon:= nsaldocon + cdebcred
               nvalcre:= nvalcre + valor_mb
               if (cconf == "S")
                  nsaldoconf:= nsaldoconf + cdebcred
               endif
            elseif (chistorico == "D")
               nsaldocon:= nsaldocon - cdebcred
               nvaldeb:= nvaldeb + valor_mb
               if (cconf == "S")
                  nsaldoconf:= nsaldoconf - cdebcred
               endif
            endif
            @ nlinha,  1 say valfr
            @ nlinha, 10 say chistor
            @ nlinha, 42 say cdocto
            @ nlinha, 53 say chistorico
            @ nlinha, 66 say cdebcred picture "999,999,999.99"
            @ nlinha, 81 say cconf
            @ nlinha, 86 say nsaldocon picture "999,999,999.99"
            @ nlinha, 102 say nsaldoconf picture "999,999,999.99"
            skip 
            nlinha++
            if (nlinha > nalturafor)
               rodape(nalturafor, .F., 134)
               ccabecalho++
               nlinha:= 7
               eject
               @  0,  0 say ""
               @  1,  1 say "" + cnomemp + ""
               @  1,  1 say ""
               @  2,  1 say "Relatorio de Extrato Bancario" + ;
                  Replicate(" ", 93) + "Pagina :" + Str(ccabecalho, 3)
               @  3,  1 say impcontasa
               @  4,  1 say nagencia
               @  5,  1 say clinha
               @  6,  1 say impcontasa
            endif
            valfr:= CToD("  /  /  ")
            chistor:= Space(30)
            cdocto:= Space(8)
            chistorico:= " "
            cdebcred:= 0
            cconf:= " "
         enddo
         @ nlinha,  1 say impcontasa
         @ nlinha + 1,  0 say "Acumulado de Debito:"
         @ nlinha + 1, 21 say nvaldeb picture "999,999,999.99"
         @ nlinha + 1, 38 say "Credito:"
         @ nlinha + 1, 47 say nvalcre picture "999,999,999.99"
         @ nlinha + 1, 63 say "Saldos do periodo :"
         @ nlinha + 1, 86 say nsaldocon picture "999,999,999.99"
         @ nlinha + 1, 102 say nsaldoconf picture "999,999,999.99"
         rodape(nalturafor, .T., 134)
         @ nlinha + 1,  0 say ""
         @ nlinha + 1,  0 say ""
         set device to screen
      endif
      lcontrole:= .F.
   enddo
   set color to (ccor)
   close databases
   select 1
   close format
   RestScreen(0, 0, 24, 79, ctela)
   return Nil

********************************
function QSR4513

   private ccabecalho, nlinha, ccoluna, clinha, cnomemp, vet[2]
   private ngrupo, cnomgrupo, ccodigo, cdescr, nporcvista, impcontasa
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   ccabecalho:= 1
   nlinha:= 1
   npedido:= 0
   nvias:= 0
   nviaimpr:= 0
   impcontasa:= Replicate("-", 79)
   nlinha:= 15
   ncoluna:= 19
   ctela:= SaveScreen(0, 0, 24, 79)
   vet[1]:= "Sim"
   vet[2]:= "NÆo"
   janela(nlinha, ncoluna, nlinha + 4, ncoluna + 43, ;
      " Reimpressao de Pedido de Consignacao ")
   @ nlinha + 1, ncoluna + 2 say "Numero do Pedido"
   @ nlinha + 2, ncoluna + 2 get nPedido picture "99999" valid ;
      valconimp(npedido)
   read
   if (sai())
      set color to (ccor)
      RestScreen(0, 0, 24, 79, ctela)
      set device to screen
      return Nil
   endif
   processand(.T.)
   vias(npedido)
   close databases
   select 1
   close format
   RestScreen(0, 0, 24, 79, ctela)
   return

********************************
function VALCONIMP(Arg1)

   if (!abredbf("CONSIGNA", "CONSIGN1.NTX"))
      return .F.
   endif
   seek Arg1
   if (!Found())
      alert("Pedido nao encontrado")
      close
      return .F.
   else
      close
      return .T.
   endif

********************************
function QSR431

   private ccabecalho, nlinha, ccoluna, clinha, cnomemp, vet[2], ;
      lcontrole
   private impcontasa, nvlricms, cnomfor, ddtvenc, ctipdoc, ;
      ddt_emis, ccol2
   private cdebcred, nval_tit, ddataultc, ddtpgto, nvalpgto, ntotpgto
   private nloja
   cpesquisa:= {"FORNECED", "FORNECE2", "CODIGO_FOR", "nCodigo"}
   ccampos:= {"CODIGO_FOR", "NOME", "", "CODIGO", "NOME", ""}
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   ccabecalho:= 1
   cnomemp:= cempresa
   ccoluna:= "Relatorio de contas a pagar" + Replicate(" ", 95) + ;
      "Pagina :" + Str(ccabecalho, 3)
   clinha:= ;
      "Codigo  Fornecedor                  Num.Doc.   Tip.Doc  Dt.Emis.          Valor    Dt.Venc. Observacao"
   nvias:= 0
   nviaimpr:= 0
   impcontasa:= Replicate("-", 134)
   lcontrole:= .T.
   nlinha:= 10
   ncoluna:= 19
   cavista:= "N"
   ntotpgto:= 0
   nvaltot:= 0
   ctela:= SaveScreen(0, 0, 24, 79)
   vet[1]:= "Sim"
   vet[2]:= "NÆo"
   ncodigo:= 0
   ddtfim:= CToD("  /  /  ")
   dbclearrel:= CToD("  /  /  ")
   crecpag:= "A"
   nloja:= 0
   ddt_venc:= Space(2)
   janela(nlinha, ncoluna, nlinha + 9, ncoluna + 50, ;
      "Relatorio de Contas a Pagar/Pagas")
   do while (lcontrole)
      processand(.F.)
      @ nlinha + 1, ncoluna + 2 say "Data Inicial"
      @ nlinha + 1, ncoluna + 20 say "Data Final  "
      @ nlinha + 3, ncoluna + 2 say "Em Aberto(A) ou Baixadas(B)"
      @ nlinha + 5, ncoluna + 2 say "Fornecedor  "
      @ nlinha + 5, ncoluna + 15 say "Somente os Pagos A Vista (S/N)"
      @ nlinha + 7, ncoluna + 2 say "Tipo"
      set color to (corfordado)
      @ nlinha + 2, ncoluna + 2 get dDtInicio
      @ nlinha + 2, ncoluna + 20 get dDtFim
      @ nlinha + 4, ncoluna + 2 get cRecPag picture "!" valid ;
         crecpag $ "AB"
      @ nlinha + 6, ncoluna + 2 get nCodigo picture "99999"
      @ nlinha + 6, ncoluna + 15 get cAVista picture "!" valid ;
         cavista $ "NS "
      @ nlinha + 8, ncoluna + 2 get cTipo picture "!!"
      read
      if (sai())
         loop
      endif
      processand(.T.)
      if (ddtfim == CToD("  /  /  "))
         ddtfim:= CToD("01/01/91")
      endif
      if (dbclearrel == CToD("  /  /  "))
         dbclearrel:= CToD("31/12/10")
      endif
      ccoldata:= "Periodo de " + DToC(ddtfim) + " a " + ;
         DToC(dbclearrel)
      select 2
      if (!abredbf("FORNECED", "FORNECE1.NTX"))
         loop
      endif
      if (crecpag == "A")
         select 1
         if (!abredbf("CONTASAP"))
            loop
         endif
         set index to CONTAP2, CONTAP3
         set order to 2
         goto top
         if (ncodigo == 0)
            set filter to DT_VENC_AP >= DDTINICIO .AND. DT_VENC_AP ;
               <= DDTFIM
         else
            set filter to DT_VENC_AP >= DDTINICIO .AND. DT_VENC_AP ;
               <= DDTFIM .AND. COD_FOR_AP == nCodigo
         endif
         if (impressora() == 1)
            set device to printer
            nlinha:= 2
            @ nlinha,  0 say ""
            @ nlinha,  1 say "" + cnomemp + ""
            @ nlinha++,  0 say ""
            @ nlinha++,  1 say "Relatorio de contas a pagar" + ;
               Replicate(" ", 95) + "Pagina :" + Str(ccabecalho, 3)
            @ nlinha++,  1 say ccoldata
            @ nlinha++,  1 say impcontasa
            @ nlinha++,  1 say clinha
            @ nlinha++,  1 say impcontasa
            select ContasAP
            goto top
            do while (!EOF())
               if (!Empty(ddt_venc))
                  if (num_ped_ap != ddt_venc)
                     skip 
                     loop
                  endif
               endif
               nvlricms:= tip_doc_ap
               select Forneced
               seek nvlricms
               if (!Found())
                  cnomfor:= "*** Fornecedor nao Cadastrado ***"
               else
                  cnomfor:= SubStr(ncodfor1->nome, 1, 25)
               endif
               select ContasAP
               @ nlinha,  2 say tip_doc_ap
               @ nlinha,  9 say cnomfor
               @ nlinha, 37 say cod_for_ap
               @ nlinha, 49 say num_ped_ap
               @ nlinha, 57 say val_icm_ap
               @ nlinha, 66 say val_tit_ap picture "999,999,999.99"
               @ nlinha, 84 say dt_venc_ap
               @ nlinha, 93 say qsr24a
               nvaltot:= nvaltot + val_tit_ap
               skip 
               nlinha++
               if (nlinha > nalturafor)
                  rodape(nalturafor, .F., 134)
                  ccabecalho++
                  eject
                  nlinha:= 2
                  @ nlinha,  0 say ""
                  @ nlinha,  1 say "" + cnomemp + ""
                  @ nlinha++,  0 say ""
                  @ nlinha++,  1 say "Relatorio de contas a pagar" + ;
                     Replicate(" ", 95) + "Pagina :" + ;
                     Str(ccabecalho, 3)
                  @ nlinha++,  1 say ccoldata
                  @ nlinha++,  1 say impcontasa
                  @ nlinha++,  1 say clinha
                  @ nlinha++,  1 say impcontasa
                  nlinha++
               endif
            enddo
            select ContasAP
            @ nlinha + 0,  1 say impcontasa
            @ nlinha + 1, 50 say "Valor Total :"
            @ nlinha + 1, 66 say nvaltot picture "999,999,999.99"
            rodape(nalturafor, .T., 134)
         endif
      elseif (crecpag == "B")
         clinha:= ;
            "Codigo  Fornecedor                  Num.Doc.   Tip.Doc  Dt.Emis.          Valor    Dt.Venc.           "
         ccol2:= ;
            "                                                                     Valor Pgto    Dt.Pgto. Observacao"
         select 1
         if (!abredbf("CONTASPG"))
            loop
         endif
         set index to CONTPG2, CONTPG3
         set order to 2
         if (ncodigo == 0)
            set filter to DT_PGTO_PG >= DDTINICIO .AND. DT_PGTO_PG ;
               <= DDTFIM
         else
            set filter to DT_PGTO_PG >= DDTINICIO .AND. DT_PGTO_PG ;
               <= DDTFIM .AND. COD_FOR_PG == nCodigo
         endif
         if (impressora() == 1)
            set device to printer
            @  0,  0 say "C" + Chr(nlinform)
            @  1,  0 say ""
            @  1,  1 say "" + cnomemp + ""
            @  1,  0 say ""
            @  2,  1 say "Relatorio de Contas Pagas" + ;
               Replicate(" ", 97) + "Pagina :" + Str(ccabecalho, 3)
            @  3,  1 say ccoldata
            @  4,  1 say impcontasa
            @  5,  1 say clinha
            @  6,  1 say ccol2
            @  7,  1 say impcontasa
            nlinha:= 8
            select ContasPG
            goto top
            do while (!EOF())
               if (nloja != 0)
                  if (contaspg->loja != nloja)
                     skip 
                     loop
                  endif
               endif
               nvlricms:= tip_doc_pg
               if (cavista = "S")
                  if (dt_emis_pg != "V")
                     skip 
                     loop
                  endif
               endif
               select Forneced
               seek nvlricms
               if (!Found())
                  cnomfor:= "Fornecedor nao Cadastrado"
               else
                  cnomfor:= SubStr(ncodfor1->nome, 1, 25)
               endif
               select ContasPG
               @ nlinha,  2 say tip_doc_pg
               @ nlinha,  9 say cnomfor
               @ nlinha, 37 say cod_for_pg
               @ nlinha, 49 say num_ped_pg
               @ nlinha, 57 say dt_venc_pg
               @ nlinha, 66 say val_icm_pg picture "999,999,999.99"
               @ nlinha, 84 say val_tit_pg
               @ nlinha + 1, 66 say vl_pgto_pg picture ;
                  "999,999,999.99"
               @ nlinha + 1, 84 say dt_pgto_pg
               @ nlinha + 1, 93 say conta_pg
               nvaltot:= nvaltot + val_icm_pg
               ntotpgto:= ntotpgto + vl_pgto_pg
               skip 
               nlinha++
               nlinha++
               if (nlinha > nalturafor)
                  rodape(nalturafor, .F., 134)
                  ccabecalho++
                  nlinha:= 8
                  eject
                  @  1,  0 say ""
                  @  1,  1 say "" + cnomemp + ""
                  @  1,  0 say ""
                  @  2,  1 say "Relatorio de contas a pagar" + ;
                     Replicate(" ", 95) + "Pagina :" + ;
                     Str(ccabecalho, 3)
                  @  3,  1 say ccoldata
                  @  4,  1 say impcontasa
                  @  5,  1 say clinha
                  @  6,  1 say ccol2
                  @  7,  1 say impcontasa
               endif
            enddo
            select ContasPG
            @ nlinha + 0,  1 say impcontasa
            @ nlinha + 1, 50 say "Valor Total :"
            @ nlinha + 1, 66 say nvaltot picture "999,999,999.99"
            @ nlinha + 2, 66 say ntotpgto picture "999,999,999.99"
            rodape(nalturafor, .T., 134)
         endif
      endif
      lcontrole:= .F.
   enddo
   close databases
   select 1
   close format
   set device to screen
   set color to (ccor)
   RestScreen(0, 0, 24, 79, ctela)
   return Nil

********************************
function QSR432

   private ccoluna, cnomemp, vet[2], lcontrole
   private ncodfcli, cnomcli, ddtvenc, ctipdoc, ddt_emis, ccol2
   private cdebcred, nval_tit, ddataultc, ddtpgto, nvalpgto, ;
      ntotpgto, ccondicao
   private ccoldata, nloja
   private ncodloc, nlinha, clinha, impcontasa, ccabecalho
   public cnomeloc
   set key K_F10 to pesq432
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   ccabecalho:= 1
   nlinha:= 1
   cnomemp:= cempresa
   ccoluna:= "Relatorio de Contas a Receber" + Replicate(" ", 93) + ;
      "Pagina :" + Str(ccabecalho, 3)
   clinha:= ;
      "Codigo  Cliente                     No Ped. Num.Doc.   Tip.Doc  Dt.Emis.          Valor    Dt.Venc. Local.  Observacao"
   nvias:= 0
   nviaimpr:= 0
   impcontasa:= Replicate("-", 134)
   lcontrole:= .T.
   ccondicao:= "T"
   ccabcond:= " "
   cimpender:= "N"
   nvaltot:= 0
   ntotpgto:= 0
   nlinha:= 10
   ncoluna:= 19
   ctela:= SaveScreen(0, 0, 24, 79)
   vet[1]:= "Sim"
   vet[2]:= "NÆo"
   ncodigo:= 0
   ddtfim:= CToD("  /  /  ")
   dbclearrel:= CToD("  /  /  ")
   crecpag:= "A"
   ncodloc:= 0
   nloja:= 0
   ddt_venc:= Space(2)
   ncodloc:= 0
   nvendo:= 0
   janela(nlinha, ncoluna, nlinha + 11, ncoluna + 55, ;
      "Relatorio de Contas a Receber")
   do while (lcontrole)
      processand(.F.)
      @ nlinha + 1, ncoluna + 2 say "Data Inicial"
      @ nlinha + 1, ncoluna + 20 say "Data Final  "
      @ nlinha + 3, ncoluna + 2 say "Cliente"
      @ nlinha + 3, ncoluna + 12 say "Tipo Doc"
      @ nlinha + 3, ncoluna + 22 say "Localizacao"
      @ nlinha + 3, ncoluna + 35 say "Vendedor"
      set color to (corfordado)
      @ nlinha + 2, ncoluna + 2 get dDtInicio
      @ nlinha + 2, ncoluna + 20 get dDtFim
      @ nlinha + 4, ncoluna + 2 get nCodigo picture "99999"
      @ nlinha + 4, ncoluna + 12 get cTipo picture "@!"
      @ nlinha + 4, ncoluna + 22 get nCodLoc picture "99999"
      @ nlinha + 4, ncoluna + 35 get nVendo picture "99999"
      @ nlinha + 6, ncoluna + 2 say ;
         "Em Aberto(A) ou Baixadas(B)..................:" get ;
         cRecPag picture "!" valid crecpag $ "AB"
      @ nlinha + 7, ncoluna + 2 say ;
         "Titulos (P)Protest./(N)Nao Protest./(T)Todos.:" get ;
         cCondicao picture "!" valid ccondicao $ " PNT"
      @ nlinha + 8, ncoluna + 2 say ;
         "Endereco do cliente (S/N)....................:" get ;
         cImpEnder picture "!" valid cimpender $ "SN"
      read
      if (sai())
         loop
      endif
      processand(.T.)
      if (ccondicao == "P")
         ccabcond:= "Titulos Protestados    "
      elseif (ccondicao == "N")
         ccabcond:= "Titulos Nao Protestados"
      elseif (ccondicao != "N" .AND. ccondicao != "P")
         ccabcond:= "Todos os Titulos       "
      endif
      if (ddtfim == CToD("  /  /  "))
         ddtfim:= CToD("01/01/01")
      endif
      if (dbclearrel == CToD("  /  /  "))
         dbclearrel:= CToD("31/12/99")
      endif
      cnomeloc:= procura("LOCALIZA", "LOCALIZ1.NTX", ncodloc, ;
         "DESCRICAO")
      if (nloja == 0)
         if (ncodloc == 0)
            ccoldata:= "Periodo de " + DToC(ddtfim) + " a " + ;
               DToC(dbclearrel) + "  Localizacao " + Str(ncodloc, 5) ;
               + "  " + "Geral"
         else
            ccoldata:= "Periodo de " + DToC(ddtfim) + " a " + ;
               DToC(dbclearrel) + "  Localizacao " + Str(ncodloc, 5) ;
               + "  " + cnomeloc
         endif
      elseif (ncodloc == 0)
         ccoldata:= "Periodo de " + DToC(ddtfim) + " a " + ;
            DToC(dbclearrel) + "  Localizacao " + Str(ncodloc, 5) + ;
            "  " + "Geral"
      else
         ccoldata:= "Periodo de " + DToC(ddtfim) + " a " + ;
            DToC(dbclearrel) + "  Localizacao " + Str(ncodloc, 5) + ;
            "  " + cnomeloc
      endif
      select 2
      if (!abredbf("CLIENTES", "CLIENTE1.NTX"))
         loop
      endif
      if (crecpag == "A")
         select 1
         if (!abredbf("CONTASAR"))
            loop
         endif
         set index to CONTAR3, CONTAR2
         do case
         case ncodigo = 0 .AND. ncodloc = 0
            set filter to DT_VENC_AR >= dDtInicio .AND. DT_VENC_AR ;
               <= dDtFim .AND. SITUACA_AR # "P"
         case ncodigo = 0 .AND. ncodloc != 0
            set filter to DT_VENC_AR >= dDtInicio .AND. DT_VENC_AR ;
               <= dDtFim .AND. LOCALIZA == nCodLoc .AND. SITUACA_AR ;
               # "P"
         case ncodigo != 0 .AND. ncodloc = 0
            set filter to DT_VENC_AR >= dDtInicio .AND. DT_VENC_AR ;
               <= dDtFim .AND. COD_Cli_AR == nCodigo .AND. ;
               SITUACA_AR # "P"
         case ncodigo != 0 .AND. ncodloc != 0
            set filter to DT_VENC_AR >= dDtInicio .AND. DT_VENC_AR ;
               <= dDtFim .AND. COD_Cli_AR == nCodigo .AND. LOCALIZA ;
               == nCodLoc .AND. SITUACA_AR # "P"
         endcase
         if (impressora() == 1)
            set device to printer
            defineimp()
            @  2,  1 say "Relatorio de Contas a Receber  " + ;
               ccabcond + Replicate(" ", 70) + "Pagina :" + ;
               Str(ccabecalho, 3)
            @  3,  1 say ccoldata
            @  4,  1 say impcontasa
            @  5,  1 say clinha
            @  6,  1 say impcontasa
            nlinha:= 7
            select ContasAR
            goto top
            do while (!EOF())
               if (!Empty(ddt_venc))
                  if (ctipo != ddt_venc)
                     skip 
                     loop
                  endif
               endif
               if (nvendo != 0)
                  if (!vend432(dt_emis_ar))
                     skip 
                     loop
                  endif
               endif
               if (ccondicao == "N")
                  if (impcontasr == "P")
                     skip 
                     loop
                  endif
               endif
               ncodcli:= cod_cli_ar
               select Clientes
               seek ncodcli
               if (!Found())
                  cnomcli:= "*** Cliente nao Cadastrado ***"
               else
                  cnomcli:= SubStr(clientes->nome_cli, 1, 25)
               endif
               select ContasAR
               @ nlinha,  2 say cod_cli_ar
               @ nlinha,  9 say cnomcli
               @ nlinha, 37 say dt_emis_ar
               @ nlinha, 45 say num_doc_ar
               @ nlinha, 57 say ctipo
               @ nlinha, 65 say obs_ar
               @ nlinha, 74 say val_tit_ar picture "999,999,999.99"
               @ nlinha, 92 say dt_venc_ar
               @ nlinha, 101 say local23i
               @ nlinha, 109 say SubStr(localiza, 1, Len(localiza) - ;
                  13)
               if (cimpender = "S")
                  impender(ncodcli)
               endif
               nvaltot:= nvaltot + val_tit_ar
               skip 
               nlinha++
               if (nlinha > nalturafor)
                  rodape(nalturafor, .F., 134)
                  ccabecalho++
                  nlinha:= 7
                  eject
                  @  1,  1 say "" + cnomemp + ""
                  @  1,  2 say ""
                  @  2,  1 say "Relatorio de contas a receber  " + ;
                     ccabcond + Replicate(" ", 70) + "Pagina :" + ;
                     Str(ccabecalho, 3)
                  @  3,  1 say impcontasa
                  @  4,  1 say clinha
                  @  5,  1 say impcontasa
               endif
            enddo
            select ContasAR
            @ nlinha + 0,  1 say impcontasa
            @ nlinha + 1, 50 say "Valor Total :"
            @ nlinha + 1, 66 say nvaltot picture "999,999,999.99"
            rodape(nalturafor, .T., 134)
         endif
      elseif (crecpag == "B")
         clinha:= ;
            "Codigo  Cliente                     No Ped. Num.Doc.   Tip.Doc  Dt.Emis.          Valor    Dt.Venc.           "
         ccol2:= ;
            "                                                                     Valor Pgto    Dt.Pgto. Local.  Observacao"
         select 1
         if (!abredbf("CONTASRE"))
            loop
         endif
         set index to CONTRE3, CONTRE2
         do case
         case ncodigo = 0 .AND. ncodloc = 0
            set filter to DT_RECE_RE >= dDtInicio .AND. DT_RECE_RE ;
               <= dDtFim
         case ncodigo = 0 .AND. ncodloc != 0
            set filter to DT_RECE_RE >= dDtInicio .AND. DT_RECE_RE ;
               <= dDtFim .AND. LOCALIZA == nCodLoc
         case ncodigo != 0 .AND. ncodloc = 0
            set filter to DT_RECE_RE >= dDtInicio .AND. DT_RECE_RE ;
               <= dDtFim .AND. COD_CLI_RE == nCodigo
         case ncodigo != 0 .AND. ncodloc != 0
            set filter to DT_RECE_RE >= dDtInicio .AND. DT_RECE_RE ;
               <= dDtFim .AND. COD_CLI_RE == nCodigo .AND. LOCALIZA ;
               == nCodLoc
         endcase
         if (impressora() == 1)
            set device to printer
            defineimp()
            @  2,  1 say "Relatorio de contas recebidas" + ;
               Replicate(" ", 93) + "Pagina :" + Str(ccabecalho, 3)
            @  3,  1 say ccoldata
            @  4,  1 say impcontasa
            @  5,  1 say clinha
            @  6,  1 say ccol2
            @  7,  1 say impcontasa
            nlinha:= 8
            select ContasRE
            goto top
            do while (!EOF())
               ncodcli:= cod_cli_re
               if (!Empty(ddt_venc))
                  if (dt_venc_re != ddt_venc)
                     skip 
                     loop
                  endif
               endif
               if (nvendo != 0)
                  if (!vend432(dt_emis_ar))
                     skip 
                     loop
                  endif
               endif
               select Clientes
               seek ncodcli
               if (!Found())
                  cnomcli:= "Cliente nao Cadastrado"
               else
                  cnomcli:= SubStr(clientes->nome_cli, 1, 25)
               endif
               select ContasRE
               @ nlinha,  2 say cod_cli_re
               @ nlinha,  9 say cnomcli
               @ nlinha, 37 say dt_emis_re
               @ nlinha, 45 say num_doc_re
               @ nlinha, 57 say dt_venc_re
               @ nlinha, 65 say obs_re
               @ nlinha, 74 say ddt_pgto picture "999,999,999.99"
               @ nlinha, 92 say val_tit_re
               @ nlinha + 1, 66 say vl_rece_re picture ;
                  "999,999,999.99"
               @ nlinha + 1, 84 say dt_rece_re
               @ nlinha + 1, 93 say local23i
               @ nlinha + 1, 101 say SubStr(dt_loc_re, 1, ;
                  Len(dt_loc_re) - 13)
               nvaltot:= nvaltot + ddt_pgto
               ntotpgto:= ntotpgto + vl_rece_re
               skip 
               nlinha:= nlinha + 2
               if (nlinha > nalturafor)
                  rodape(nalturafor, .F., 134)
                  ccabecalho++
                  nlinha:= 8
                  eject
                  @  1,  1 say "" + cnomemp + ""
                  @  1,  2 say ""
                  @  2,  1 say "Relatorio de contas recebidas" + ;
                     Replicate(" ", 93) + "Pagina :" + ;
                     Str(ccabecalho, 3)
                  @  3,  1 say ccoldata
                  @  4,  1 say impcontasa
                  @  5,  1 say clinha
                  @  6,  1 say ccol2
                  @  7,  1 say impcontasa
               endif
            enddo
            select ContasRE
            @ nlinha + 0,  1 say impcontasa
            @ nlinha + 1, 50 say "Valor Total :"
            @ nlinha + 1, 66 say nvaltot picture "999,999,999.99"
            @ nlinha + 2, 66 say ntotpgto picture "999,999,999.99"
            rodape(nalturafor, .T., 134)
         endif
      endif
      lcontrole:= .F.
   enddo
   qsr16i("cNomeLoc")
   close databases
   select 1
   close format
   set device to screen
   set color to (ccor)
   RestScreen(0, 0, 24, 79, ctela)
   return Nil

********************************
procedure IMPENDER(Arg1)

   nlinha++
   if (nlinha > nalturafor)
      rodape(nalturafor, .F., 134)
      ccabecalho++
      nlinha:= 7
      eject
      @  1,  1 say "" + cnomemp + ""
      @  1,  2 say ""
      @  2,  1 say "Relatorio de contas a receber  " + ccabcond + ;
         Replicate(" ", 70) + "Pagina :" + Str(ccabecalho, 3)
      @  3,  1 say impcontasa
      @  4,  1 say clinha
      @  5,  1 say impcontasa
   endif
   carea:= Select()
   select Clientes
   seek Arg1
   if (Found())
      @ nlinha,  1 say ;
         "Endereco                           Bairro         Cidade                      UF  Fone       CEP"
      nlinha++
      if (nlinha > nalturafor)
         rodape(nalturafor, .F., 134)
         ccabecalho++
         nlinha:= 7
         eject
         @  1,  1 say "" + cnomemp + ""
         @  1,  2 say ""
         @  2,  1 say "Relatorio de contas a receber  " + ccabcond + ;
            Replicate(" ", 70) + "Pagina :" + Str(ccabecalho, 3)
         @  3,  1 say impcontasa
         @  4,  1 say clinha
         @  5,  1 say impcontasa
      endif
      @ nlinha,  1 say endere_cli
      @ nlinha, 36 say bairro_cli
      @ nlinha, 51 say cidade_cli
      @ nlinha, 79 say estado_cli
      @ nlinha, 83 say fone_cli
      @ nlinha, 97 say cep_cli
      nlinha++
      if (nlinha > nalturafor)
         rodape(nalturafor, .F., 134)
         ccabecalho++
         nlinha:= 7
         eject
         @  1,  1 say "" + cnomemp + ""
         @  1,  2 say ""
         @  2,  1 say "Relatorio de contas a receber  " + ccabcond + ;
            Replicate(" ", 70) + "Pagina :" + Str(ccabecalho, 3)
         @  3,  1 say impcontasa
         @  4,  1 say clinha
         @  5,  1 say impcontasa
      endif
      @ nlinha,  1 say impcontasa
   endif
   select (carea)
   return

********************************
function GERTEMP436(Arg1)

   local Local1
   Local1:= .F.
   select 2
   if (!abredbf("CLIENTES", "CLIENTE1.NTX"))
   else
      seek Arg1
      if (Found())
         @  2,  2 say nome_cli
      else
         @  3,  2 say "**** Clientes nao cadastrado ***** "
      endif
      select 1
      use (dbcreate)
      select 2
      if (!abredbf("CONTASRE", "CONTRE2.NTX"))
         return .F.
      endif
      seek Arg1
      if (Found())
         do while (Arg1 = cod_cli_re .AND. !EOF())
            skip 
         enddo
         skip -1
         i:= 1
         do while (Arg1 = cod_cli_re .AND. i <= 10)
            skip -1
            i++
         enddo
         skip 
         i:= 1
         do while (Arg1 = cod_cli_re .AND. !EOF())
            ddt_venc:= dt_venc_re
            nval_tit:= val_tit_re
            situaca_ar:= ddt_pgto
            ddtvenc:= num_doc_re
            nval_rece:= vl_rece_re
            nvlrece:= dt_rece_re
            select 1
            if (!adiciona())
               return
            endif
            replace codigo_cli with Arg1
            replace tip_doc with ddt_venc
            replace num_doc with ddtvenc
            replace dt_venc with nval_tit
            replace val_tit with situaca_ar
            replace val_rece with nval_rece
            replace dt_rece with nvlrece
            select 2
            skip 
            nlinha++
         enddo
      endif
      select 2
      if (!abredbf("CONTASAR", "CONTAR2.NTX"))
      else
         seek Arg1
         if (Found())
            if (Local1)
               nlinha++
            endif
            do while (Arg1 = cod_cli_ar .AND. !EOF())
               ddt_venc:= ctipo
               nval_tit:= dt_venc_ar
               situaca_ar:= val_tit_ar
               ddtvenc:= num_doc_ar
               select 1
               if (!adiciona())
                  loop
               endif
               replace codigo_cli with Arg1
               replace tip_doc with ddt_venc
               replace num_doc with ddtvenc
               replace dt_venc with nval_tit
               replace val_tit with situaca_ar
               select 2
               skip 
               nlinha++
            enddo
         endif
         select 1
         return
      endif
   endif

********************************
function QSR433

   private ncodigo, ddtfim, dbclearrel, crecpag, impvid, nlinha, ;
      ncoluna, ccor, ctela, valpess
   private lcontrole, ncont, v1[5], v2[5], v3[5], ddtinicio[5], vet[2]
   private ntot_diar, ntot_diap, npag, ntotp, ntotr, nsaldocon, ;
      nlin, ddata1
   private vsaldos[3, 4], dbcreate, ntot_diar, ntot_diap, ntotp, ;
      ntotr, nsaldocon, nlin
   set escape on
   programa(0, 69, coropcoes)
   ntot_diar:= 0
   ntot_diap:= 0
   ntotp:= 0
   ntotr:= 0
   impcontasa:= Replicate("-", 79)
   nsaldocon:= 0
   nlin:= 6
   cconf:= Space(1)
   ccor:= SetColor()
   ntot_diar:= 0
   ntot_diap:= 0
   npag:= 0
   ntotp:= 0
   ntotr:= 0
   nsaldocon:= 0
   nlin:= 6
   ccabecalho:= 1
   nlinha:= 1
   cnomemp:= cempresa
   clinha:= ;
      "Data          Receber           Pagar          Saldo       "
   nvias:= 0
   ccor:= SetColor()
   ncont:= 0
   lcontrole:= .T.
   nlinha:= 3
   ncoluna:= 11
   ctela:= SaveScreen(0, 0, 24, 79)
   lcontrole:= .T.
   vet[1]:= "Sim"
   vet[2]:= "NÆo"
   janela(nlinha, ncoluna, nlinha + 4, ncoluna + 43, ;
      " Relatorio de Saldos ")
   processand(.F.)
   @ nlinha + 1, ncoluna + 2 say "Confirma a impressao dos Saldos"
   @ nlinha + 2, ncoluna + 2 get cConf picture "!" valid cconf $ "NS"
   read
   if (LastKey() == K_ESC)
      RestScreen(0, 0, 24, 79, ctela)
   endif
   processand(.T.)
   if (cconf != "S")
      lcontrole:= .F.
   endif
   ncont:= 1
   dbcreate:= "Saldo" + LTrim(Str(ncont)) + ".DBF"
   do while (file(dbcreate))
      ncont++
      dbcreate:= "Saldo" + LTrim(Str(ncont)) + ".DBF"
   enddo
   vsaldos[1]:= {"Dt_Venc", "D", 8, 0}
   vsaldos[2]:= {"Val_Tit", "N", 14, 2}
   vsaldos[3]:= {"Rec_Pag", "C", 1, 0}
   cprod(dbcreate, vsaldos)
   if (!abredbf(dbcreate))
      return .F.
   endif
   select 2
   if (!abredbf("CONTASAR"))
      close databases
      select 1
      close format
      return .F.
   endif
   goto top
   do while (!EOF() .AND. lcontrole)
      if (impcontasr == "P")
         skip 
         loop
      endif
      nval_tit:= dt_venc_ar
      situaca_ar:= val_tit_ar
      crec_pag:= "R"
      skip 
      select 1
      if (!adiciona())
         loop
      endif
      replace dt_venc with nval_tit
      replace val_tit with situaca_ar
      replace rec_pag with crec_pag
      select 2
   enddo
   select 2
   if (!abredbf("CONTASAP"))
      close databases
      select 1
      close format
      return .F.
   endif
   goto top
   if (impressora() == 1)
      set device to printer
      @  0,  0 say "C" + Chr(nlinform)
      @  1,  1 say "" + cnomemp + ""
      @  2,  1 say "Relatorio Saldos de Contas a Receber  " + ;
         Replicate(" ", 30) + "Pagina :" + Str(ccabecalho, 3)
      @  3,  1 say impcontasa
      @  4,  1 say clinha
      @  5,  1 say impcontasa
      nlinha:= 6
      do while (!EOF() .AND. lcontrole)
         nval_tit:= dt_venc_ap
         situaca_ar:= val_tit_ap
         crec_pag:= "P"
         skip 
         select 1
         if (!adiciona())
            close databases
            select 1
            close format
            return .F.
         endif
         replace dt_venc with nval_tit
         replace val_tit with situaca_ar
         replace rec_pag with crec_pag
         select 2
      enddo
   endif
   select 1
   cseimp:= SubStr(dbcreate, 1, 6)
   index on DT_VENC to (cseimp)
   goto top
   do while (!EOF())
      ddata1:= dt_venc
      do while (ddata1 = dt_venc)
         if (rec_pag = "P")
            ntot_diap:= ntot_diap + val_tit
         elseif (rec_pag = "R")
            ntot_diar:= ntot_diar + val_tit
         endif
         skip 
      enddo
      nsaldocon:= nsaldocon + ntot_diar - ntot_diap
      ntotp:= ntotp + ntot_diap
      ntotr:= ntotr + ntot_diar
      @ nlinha,  1 say ddata1
      @ nlinha, 10 say ntot_diar picture "9,999,999.99"
      @ nlinha, 26 say ntot_diap picture "9,999,999.99"
      @ nlinha, 41 say nsaldocon picture "9,999,999.99"
      nlinha++
      if (nlinha > nalturafor)
         rodape(nalturafor, .F., 79)
         ccabecalho++
         nlinha:= 6
         eject
         @  1,  1 say "" + cnomemp + ""
         @  1,  2 say ""
         @  2,  1 say "Relatorio Saldos de Contas a Receber  " + ;
            Replicate(" ", 10) + "Pagina :" + Str(ccabecalho, 3)
         @  3,  1 say impcontasa
         @  4,  1 say clinha
         @  5,  1 say impcontasa
      endif
      ntot_diar:= 0
      ntot_diap:= 0
   enddo
   @ nlinha + 1,  1 say impcontasa
   @ nlinha + 2,  2 say "Totais"
   @ nlinha + 2, 10 say ntotr picture "9,999,999.99"
   @ nlinha + 2, 26 say ntotp picture "9,999,999.99"
   @ nlinha + 2, 41 say nsaldocon picture "9,999,999.99"
   rodape(nalturafor, .F., 79)
   set device to screen
   RestScreen(0, 0, 24, 79, ctela)
   close databases
   select 1
   close format
   impritrans(dbcreate)
   impritrans(dbcreate + ".NTX")
   return

********************************
function QSR436

   private ccoluna, cnomemp, vet[2], lcontrole
   private ccol2, nlinha, clinha, impcontasa, ccabecalho
   private lcontrole, ncont, v1[7], v2[7], v3[7], ddtinicio[7], vet[2]
   private carquivo[7, 4]
   cpesquisa:= {"CLIENTES", "CLIENTE1", "CODIGO_CLI", "nCodigo"}
   ccampos:= {"CODIGO_CLI", "NOME_CLI", "", "CODIGO", "NOME", ""}
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   ccabecalho:= 1
   nlinha:= 1
   cnomemp:= cempresa
   ccoluna:= "Relatorio de Contas a Receber" + Replicate(" ", 93) + ;
      "Pagina :" + Str(ccabecalho, 3)
   clinha:= ;
      "Tipo Numero Doc. Dt.Venc.    Valor Titulo  Dt.Rece    Valor Recebido"
   nvias:= 0
   nviaimpr:= 0
   impcontasa:= Replicate("-", 134)
   lcontrole:= .T.
   ccondicao:= " "
   ccabcond:= " "
   cimpender:= " "
   ncodcli:= 0
   cnomcli:= Space(30)
   ddtvenc:= Space(10)
   ctipdoc:= Space(3)
   ddt_emis:= CToD("  /  /  ")
   cdebcred:= 0
   nval_tit:= CToD("  /  /  ")
   ddataultc:= Space(40)
   nvaltot:= 0
   ddtpgto:= CToD("  /  /  ")
   nvalpgto:= 0
   ntotpgto:= 0
   nlinha:= 10
   ncoluna:= 19
   ctela:= SaveScreen(0, 0, 24, 79)
   vet[1]:= "Sim"
   vet[2]:= "NÆo"
   ncodigo:= 0
   ddtfim:= CToD("  /  /  ")
   dbclearrel:= CToD("  /  /  ")
   crecpag:= Space(1)
   ncodloc:= 0
   nloja:= 0
   ddt_venc:= Space(2)
   ntotrec:= 0
   ntotarec:= 0
   ncont:= 1
   dbcreate:= "TEMP" + LTrim(Str(ncont)) + ".DBF"
   do while (file(dbcreate))
      ncont++
      dbcreate:= "TEMP" + LTrim(Str(ncont)) + ".DBF"
   enddo
   carquivo[1]:= {"Codigo_Cli", "N", 5, 0}
   carquivo[2]:= {"Tip_Doc", "C", 2, 0}
   carquivo[3]:= {"Num_Doc", "C", 10, 0}
   carquivo[4]:= {"Val_Tit", "N", 12, 2}
   carquivo[5]:= {"Val_Rece", "N", 12, 2}
   carquivo[6]:= {"Dt_Venc", "D", 8, 0}
   carquivo[7]:= {"Dt_Rece", "D", 8, 0}
   cprod(dbcreate, carquivo)
   do while (lcontrole)
      processand(.F.)
      janela(nlinha, ncoluna, nlinha + 4, ncoluna + 48, ;
         " Relatorio de Extrato de Cliente ")
      @ nlinha + 1, ncoluna + 2 say "Cliente"
      @ nlinha + 2, ncoluna + 2 get nCodigo picture "99999" valid ;
         cli436()
      read
      if (sai())
         loop
      endif
      processand(.T.)
      gertemp436(ncodigo)
      close
      select 1
      use (dbcreate)
      if (impressora() == 1)
         set device to printer
         @  0,  0 say "C" + Chr(nlinform)
         @  1,  0 say ""
         @  1,  1 say "" + cnomemp + ""
         @  1,  2 say ""
         @  2,  1 say "Relatorio de extrato de cliente  " + ccabcond ;
            + Replicate(" ", 70) + "Pagina :" + Str(ccabecalho, 3)
         @  3,  1 say impcontasa
         nlinha:= 4
         select 2
         if (!abredbf("CLIENTES", "CLIENTE1.NTX"))
            loop
         endif
         seek ncodigo
         if (!Found())
            cnomcli:= "*** Cliente nao Cadastrado ***"
         else
            cnomcli:= SubStr(clientes->nome_cli, 1, 30)
            @ nlinha,  1 say ;
               "Loja  Codigo  Nome do Cliente                 Pes  Denominacao Comercial"
            @ nlinha++,  1 say ;
               "Loja  Codigo  Nome do Cliente                 Pes  Denominacao Comercial"
            @ nlinha,  1 say Str(loja_cli, 2)
            @ nlinha,  7 say Str(codigo_cli, 5)
            @ nlinha, 15 say nome_cli
            @ nlinha, 47 say pessoa_cli
            @ nlinha++, 57 say inclus_cli
            @ nlinha,  1 say ;
               "CPF/CGC                                Nome do Conjuge                 Dt.Nasc."
            @ nlinha++,  1 say ;
               "CPF/CGC                                Nome do Conjuge                 Dt.Nasc."
            if (pessoa_cli = "F")
               @ nlinha,  1 say cpf_cli
            else
               @ nlinha,  1 say cgc_cli
            endif
            @ nlinha, 40 say dt_nas_com
            @ nlinha++, 72 say dencom_cli
            @ nlinha,  1 say ;
               "Endereco                            Bairro            Cidade"
            @ nlinha++,  1 say ;
               "Endereco                            Bairro            Cidade"
            @ nlinha,  1 say endere_cli
            @ nlinha, 37 say bairro_cli
            @ nlinha++, 55 say cidade_cli
            @ nlinha,  1 say ;
               "UF CEP          Telefone       Data InclusÆo  Vendedor"
            @ nlinha++,  1 say ;
               "UF CEP          Telefone       Data InclusÆo  Vendedor"
            @ nlinha,  1 say estado_cli
            @ nlinha,  4 say cep_cli
            @ nlinha, 17 say fone_cli
            @ nlinha, 32 say conjug_cli
            @ nlinha++, 47 say vendedor
            @ nlinha,  1 say "Filiacao"
            @ nlinha++,  1 say "Filiacao"
            @ nlinha,  1 say mae
            @ nlinha++, 35 say spc1
            @ nlinha,  1 say ;
               "Dt 1a Comp   Dt Ult Comp   Protestos   No Ult Comp   Limite Cred   Cred.Usado"
            @ nlinha++,  1 say ;
               "Dt 1a Comp   Dt Ult Comp   Protestos   No Ult Comp   Limite Cred   Cred.Usado"
            @ nlinha,  1 say npc_ul_cli
            @ nlinha, 13 say dt_1ac_cli
            @ nlinha, 28 say no_ch_cli picture "999"
            @ nlinha, 39 say limitc_cli picture "@E 9,999"
            @ nlinha, 50 say credus_cli picture "@E 9,999,999.99"
            @ nlinha++, 63 say conta_bco picture "@E 9,999,999.99"
         endif
         close
         @ nlinha++,  1 say impcontasa
         @ nlinha++,  1 say clinha
         @ nlinha++,  1 say impcontasa
         select 1
         goto top
         do while (!EOF())
            @ nlinha,  1 say tip_doc
            @ nlinha,  6 say num_doc
            @ nlinha, 19 say dt_venc
            @ nlinha, 31 say val_tit picture "9,999,999.99"
            @ nlinha, 45 say dt_rece
            @ nlinha, 56 say val_rece picture "9,999,999.99"
            if (!Empty(dt_rece))
               ntotrec:= ntotrec + val_rece
            endif
            if (Empty(dt_rece))
               ntotarec:= ntotarec + val_tit
            endif
            skip 
            nlinha++
            if (nlinha > nalturafor)
               rodape(nalturafor, .F., 79)
               ccabecalho++
               nlinha:= 6
               eject
               @  1,  1 say "" + cnomemp + ""
               @  1,  2 say ""
               @  2,  1 say "Relatorio de extrato de cliente" + ;
                  ccabcond + Replicate(" ", 70) + "Pagina :" + ;
                  Str(ccabecalho, 3)
               @  3,  1 say impcontasa
               @  4,  1 say clinha
               @  5,  1 say impcontasa
            endif
         enddo
         @ nlinha++,  0 say Replicate("-", 132)
         @ nlinha, 19 say "Totais"
         @ nlinha, 31 say ntotarec picture "9,999,999.99"
         @ nlinha, 56 say ntotrec picture "9,999,999.99"
      endif
      lcontrole:= .F.
   enddo
   nlinha:= 10
   ncoluna:= 19
   close databases
   select 1
   close format
   set device to screen
   set color to (ccor)
   RestScreen(0, 0, 24, 79, ctela)
   return Nil

********************************
function IMPPRODE(Arg1)

   ntotal:= 0
   ncont:= 0
   select 10
   if (!abredbf("PRODUTOS", "PRODUTO1.NTX"))
      return .F.
   endif
   select 11
   if (!abredbf("ENT_MAT", "ENT_MAT1.NTX"))
      return .F.
   endif
   seek Arg1
   if (Found())
      nlinha++
      do while (Arg1 = num_docto .AND. !EOF())
         ccodigo:= codigo_mat
         nvalormat:= quantidade
         cdebcred:= data_orc
         ntotal:= quantidade * data_orc
         select Produtos
         seek ccodigo
         if (Found())
            cdesc:= descricao
         else
            cdesc:= " **** Produto nao cadastrado **** "
         endif
         @ nlinha,  2 say ccodigo
         @ nlinha, 10 say cdesc
         @ nlinha, 45 say nvalormat picture "9,999,999.99"
         @ nlinha, 54 say cdebcred picture "9,999,999.99"
         @ nlinha, 67 say ntotal picture "9,999,999.99"
         select Ent_Mat
         skip 
         nlinha++
         if (nlinha > nalturafor)
            rodape(nalturafor, .F., 79)
            ccabecalho++
            nlinha:= 8
            eject
            @  1,  1 say "" + cnomemp + ""
            @  2,  1 say ccab + Replicate(" ", 79 - Len(ccab) - 12) ;
               + "Pagina :" + Str(ccabecalho, 3)
            @  3,  1 say ccoldata
            @  4,  1 say impcontasa
            @  5,  1 say clinha
            @  6,  1 say tip_doc_ar
            @  7,  1 say impcontasa
         endif
      enddo
   endif
   select Ent_Mat
   close
   select Produtos
   close
   select Entradas
   return

********************************
function QSR441

   private ccabecalho, nlinha, ccabeca[3], clinha[3], cnomemp, vet[2]
   private ngrup1, cnomgrupo, ccodigo, cdescr, nporcvista, ;
      impcontasa[3]
   private nporcprazo, nprecovist, nprecopraz, cunidade, nvias, ;
      nviaimpr, ccodfor
   cpesquisa:= {"GRUPO", "GRUPO1", "GRUPO", "nGrup1"}
   ccampos:= {"GRUPO", "DESCRICAO", "", "GRUPO", "DESCRICAO", ""}
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   ccabecalho:= 0
   cnomemp:= cempresa
   ccabeca[1]:= "Tabela de Precos"
   ccabeca[2]:= "Tabela de Precos"
   ccabeca[3]:= "Tabela de Precos"
   nvias:= 1
   nviaimpr:= 0
   impcontasa[1]:= Replicate("-", 80)
   impcontasa[2]:= Replicate("-", 134)
   impcontasa[3]:= Replicate("-", 134)
   napartirpg:= 1
   ngrup1:= 0
   cnomgrupo:= Space(30)
   cgrupoant:= Space(30)
   ccodigo:= Space(5)
   cdescr:= Space(35)
   ccodfor:= Space(20)
   nporcvista:= 0
   nporcpraz:= 0
   nprecovist:= 0
   nprecopraz:= 0
   cunidade:= 0
   ctiprel:= " "
   nlinha:= 10
   ncoluna:= 19
   ctela:= SaveScreen(0, 0, 24, 79)
   vet[1]:= "Sim"
   vet[2]:= "NÆo"
   processand(.F.)
   janela(nlinha, ncoluna, nlinha + 8, ncoluna + 55, ;
      "Tabela de Precos")
   @ nlinha + 1, ncoluna + 2 say "Acrescimo"
   @ nlinha + 3, ncoluna + 2 say "A Vista  "
   @ nlinha + 3, ncoluna + 15 say "A Prazo"
   @ nlinha + 3, ncoluna + 25 say "Grupo"
   @ nlinha + 3, ncoluna + 32 say "N§ de Copias"
   @ nlinha + 5, ncoluna + 2 say "Tipo de Relatorio"
   @ nlinha + 5, ncoluna + 30 say "A partir da Pagina"
   @ nlinha + 4, ncoluna + 2 get nPorcVista picture "999.99"
   @ nlinha + 4, ncoluna + 15 get nPorcPraz picture "999.99"
   @ nlinha + 4, ncoluna + 25 get nGrup1 picture "999"
   @ nlinha + 4, ncoluna + 32 get nVias picture "999"
   @ nlinha + 6, ncoluna + 2 get cTipRel picture "!" valid ctiprel $ ;
      "123"
   @ nlinha + 6, ncoluna + 30 get nApartirPG picture "99" valid ;
      napartirpg > 0
   read
   if (sai())
      set color to (ccor)
      RestScreen(0, 0, 24, 79, ctela)
      set device to screen
      return Nil
   endif
   nlinha:= 99
   if (impressora() == 1)
      if (napartirpg > 1)
         set printer to TEMP
      endif
      processand(.T.)
      set device to printer
      @  0,  0 say "C" + Chr(nlinform)
      if (!abredbf("PRODUTOS", "PRODUTO3.NTX"))
         return .F.
      endif
      select 2
      if (!abredbf("GRUPO", "GRUPO1.NTX"))
         return .F.
      endif
      do while (nviaimpr < nvias)
         select Grupo
         do while (!EOF())
            if (ngrup1 != 0 .AND. grupo->grupo != ngrup1)
               skip 
               loop
            endif
            ngrupo:= grupo->grupo
            cnomgrupo:= grupo->descricao
            select Produtos
            seek Str(ngrupo, 3)
            do while (ngrupo == produtos->grupo .AND. !EOF())
               ccodigo:= codigo
               cdescr:= descricao
               cunidade:= nct
               nprecovist:= valor + valor * nporcvista / 100
               cmarca:= marca
               ccodfor:= codigo_for
               nprecopraz:= nprecovist + nprecovist * nporcpraz / 100
               if (nlinha >= nalturafor)
                  if (ccabecalho != 0)
                     if (ctiprel = "1")
                        rodape(nalturafor, .F., 80)
                     else
                        rodape(nalturafor, .F., 134)
                     endif
                     eject
                  endif
                  ccabecalho:= ccabecalho + 1
                  if (napartirpg = ccabecalho)
                     set printer to (cportarel)
                  endif
                  if (ctiprel = "1")
                     @  1,  0 say "" + cnomemp + ""
                     @  2,  0 say ccabeca[1]
                     @  2, 68 say "Pagina :" + Str(ccabecalho, 3)
                     @  3,  0 say impcontasa[1]
                     @  4,  0 say "Codigo    Descricao"
                     @  4, 49 say "Unid.  Preco A vista      Prazo"
                     @  5,  0 say impcontasa[1]
                  elseif (ctiprel = "2")
                     @  1,  0 say "" + cnomemp + ""
                     @  2,  0 say ccabeca[2]
                     @  2, 104 say "Pagina :" + Str(ccabecalho, 3)
                     @  3,  0 say impcontasa[2]
                     @  4,  0 say "Codigo    Descricao"
                     @  4, 51 say "Marca"
                     @  4, 68 say "Unid.   Preco A vista     Prazo"
                     @  5,  0 say impcontasa[2]
                  elseif (ctiprel = "3")
                     @  1,  0 say "" + cnomemp + ""
                     @  1, 80 say "Pagina :" + Str(ccabecalho, 3)
                     @  2,  0 say ccabeca[3]
                     @  2, 104 say "Pagina :" + Str(ccabecalho, 3)
                     @  2, 30 say "Grupo: " + Str(ngrupo, 3) + ;
                        " - " + cnomgrupo
                     @  3,  0 say impcontasa[3]
                     @  4,  1 say "Codigo     Descricao"
                     @  4, 51 say "Marca"
                     @  4, 63 say "Codigo Fornecedor"
                     @  4, 86 say "Und.  Valor Unitario"
                     @  4,  0 say clinha[3]
                     @  5,  0 say impcontasa[3]
                  endif
                  nlinha:= 6
               endif
               if (cgrupoant != cnomgrupo)
                  @ nlinha,  1 say "" + cnomgrupo
                  cgrupoant:= cnomgrupo
                  nlinha++
               endif
               if (ctiprel = "1")
                  @ nlinha,  0 say ccodigo
                  @ nlinha,  8 say cdescr
                  @ nlinha, 49 say cunidade
                  @ nlinha, 54 say nprecovist picture "999,999.99"
                  @ nlinha, 67 say nprecopraz picture "999,999.99"
               elseif (ctiprel = "2")
                  if (cimppro0 = "N")
                     if (estoque <= 0 .OR. valor <= 0)
                        skip 
                        loop
                     endif
                  endif
                  @ nlinha,  0 say ccodigo
                  @ nlinha,  8 say cdescr
                  @ nlinha, 51 say cmarca
                  @ nlinha, 68 say cunidade
                  @ nlinha, 73 say nprecovist picture "999,999.99"
                  @ nlinha, 87 say nprecopraz picture "999,999.99"
               elseif (ctiprel = "3")
                  @ nlinha,  0 say ccodigo
                  @ nlinha,  8 say cdescr
                  @ nlinha, 51 say cmarca
                  @ nlinha, 63 say ccodfor
                  @ nlinha, 86 say cunidade
                  @ nlinha, 93 say nprecovist picture "999,999.99"
               endif
               skip 
               nlinha++
            enddo
            if (ccabecalho != 0 .AND. ctiprel = "3")
               nlinha:= 99
            endif
            select Grupo
            skip 
         enddo
         if (ctiprel = "1")
            rodape(nalturafor, .T., 80)
         else
            rodape(nalturafor, .T., 134)
         endif
         ccabecalho:= 0
         nviaimpr++
         select Grupo
         goto top
         eject
      enddo
   endif
   set device to screen
   set color to (ccor)
   close databases
   select 1
   close format
   RestScreen(0, 0, 24, 79, ctela)
   return Nil

********************************
function QSR442

   private ccabecalho, nlinha, ccoluna, clinha, cnomemp, vet[2]
   private impcontasa, ncont, lcontrole, nprim, ccoldata, ntotquanti
   private ddtfim, dbclearrel, cref, nvalormat, cdescr, nloja, nvar, ;
      cnomegrupo
   private carquivo[2, 4], vngrupos[2, 1], npedido
   programa(0, 69, coropcoes)
   lcontrole:= .T.
   ccor:= SetColor()
   ccabecalho:= 1
   nlinha:= 1
   cnomemp:= cempresa
   ccoluna:= "Romaneio" + Replicate(" ", 58) + "Pagina :" + ;
      Str(ccabecalho, 3)
   clinha:= "Referencia  Quant.  Discriminacao"
   nvias:= 1
   nviaimpr:= 0
   impcontasa:= Replicate("-", 79)
   ntotquanti:= 0
   npedido:= 0
   ddtfim:= CToD("  /  /  ")
   dbclearrel:= CToD("  /  /  ")
   nloja:= 0
   cref:= Space(5)
   nvalormat:= 0
   cdescr:= Space(35)
   nvar:= 0
   cnomegrupo:= Space(30)
   cseimp:= ""
   nlinha:= 10
   ncoluna:= 19
   ctela:= SaveScreen(0, 0, 24, 79)
   vet[1]:= "Sim"
   vet[2]:= "NÆo"
   ncont:= 0
   ncont:= 1
   dbcreate:= "TEMP" + LTrim(Str(ncont)) + ".DBF"
   do while (file(dbcreate))
      ncont++
      dbcreate:= "TEMP" + LTrim(Str(ncont)) + ".DBF"
   enddo
   carquivo[1]:= {"REFERENCIA", "C", 5, 0}
   carquivo[2]:= {"QUANTIDADE", "N", 12, 0}
   cprod(dbcreate, carquivo)
   do while (lcontrole)
      processand(.F.)
      janela(nlinha, ncoluna, nlinha + 4, ncoluna + 47, ;
         "Impressao de Romaneio")
      @ nlinha + 1, ncoluna + 2 say "Data Inicial"
      @ nlinha + 1, ncoluna + 20 say "Data Final "
      @ nlinha + 2, ncoluna + 2 get dDtInicio
      @ nlinha + 2, ncoluna + 20 get dDtFim
      read
      if (sai())
         loop
      endif
      processand(.T.)
      if (ddtfim == CToD("  /  /  "))
         ddtfim:= CToD("01/01/91")
      endif
      if (dbclearrel == CToD("  /  /  "))
         dbclearrel:= CToD("31/12/10")
      endif
      ccoldata:= "Periodo de " + DToC(ddtfim) + " a " + ;
         DToC(dbclearrel) + "    " + "Loja : " + Str(nloja, 2) + "-" ;
         + loja(nloja)
      if (impressora() == 1)
         select 5
         if (!abredbf("PEDIDOS"))
            loop
         endif
         set index to PEDIDOS3, PEDIDOS1
         select 1
         if (!abredbf("PED_MAT", "PED_MAT.NTX"))
            loop
         endif
         select 2
         if (!abredbf(dbcreate))
            loop
         endif
         cseimp:= SubStr(dbcreate, 1, 5)
         index on REFERENCIA to (cseimp)
         set index to (cseimp)
         nlinha:= 6
         select Pedidos
         set softseek on
         seek ddtfim
         set softseek off
         do while (!EOF() .AND. data <= dbclearrel)
            if (nloja != 0)
               if (loja != nloja)
                  skip 
                  loop
               endif
            endif
            npedido:= Str(loja, 2) + Str(numero, 5)
            select Ped_Mat
            seek npedido
            if (Found())
               do while (!EOF() .AND. Str(loja, 2) + Str(numero_ped, ;
                     5) = npedido)
                  cref:= codigo_mat
                  nvalormat:= quantidade
                  nlojaped:= loja
                  nnumeroped:= Str(loja, 2) + Str(numero_ped, 5)
                  select 2
                  seek cref
                  if (!Found())
                     if (!adiciona())
                        loop
                     endif
                     if (!bloqueia())
                        loop
                     endif
                     replace referencia with cref
                     replace quantidade with nvalormat
                  else
                     RLock()
                     replace quantidade with quantidade + nvalormat
                  endif
                  select Ped_Mat
                  skip 
               enddo
            endif
            select Pedidos
            skip 
         enddo
         if (!lcontrole)
            loop
         endif
         select Ped_Mat
         close
         select 2
         select 1
         if (!abredbf("PRODUTOS", "PRODUTO1.NTX"))
            loop
         endif
         set device to printer
         @  0,  0 say "C" + Chr(nlinform)
         @  1,  1 say "" + cnomemp + ""
         @  2,  1 say "Romaneio" + Replicate(" ", 58) + "Pagina :" + ;
            Str(ccabecalho, 3)
         @  3,  1 say ccoldata
         @  4,  1 say impcontasa
         @  5,  1 say clinha
         @  6,  1 say impcontasa
         nlinha:= 7
         select 2
         cseimp:= SubStr(dbcreate, 1, 5)
         index on QUANTIDADE to (cseimp)
         set index to (cseimp)
         goto top
         do while (!EOF())
            cref:= referencia
            nvalormat:= quantidade
            ntotquanti:= ntotquanti + nvalormat
            select Produtos
            seek cref
            if (Found())
               cdescr:= produtos->descricao
               ngrupo:= produtos->grupo
            else
               cdescr:= "Referencia nao cadastrada "
               ngrupo:= 0
            endif
            ncont:= 0
            ncont:= ascan(vngrupos[1], ngrupo)
            if (ncont < 1)
               asize(vngrupos[1], Len(vngrupos[1]) + 1)
               asize(vngrupos[2], Len(vngrupos[2]) + 1)
               vngrupos[1][Len(vngrupos[1])]:= ngrupo
               vngrupos[2][Len(vngrupos[2])]:= nvalormat
            else
               vngrupos[2][ncont]:= vngrupos[2][ncont] + nvalormat
            endif
            @ nlinha,  1 say cref
            @ nlinha,  7 say nvalormat picture "9,999,999.99"
            @ nlinha, 21 say cdescr
            cref:= Space(5)
            nvalormat:= 0
            cdescr:= Space(35)
            select 2
            skip 
            nlinha++
            if (nlinha > nalturafor)
               rodape(nalturafor, .F., 79)
               ccabecalho++
               nlinha:= 7
               eject
               @  1,  1 say "" + cnomemp + ""
               @  2,  1 say "Romaneio" + Replicate(" ", 58) + ;
                  "Pagina :" + Str(ccabecalho, 3)
               @  3,  1 say ccoldata
               @  4,  1 say impcontasa
               @  5,  1 say clinha
               @  6,  1 say impcontasa
            endif
         enddo
         select 2
         if (!abredbf("GRUPO", "GRUPO.NTX"))
            loop
         endif
         @ nlinha + 0,  1 say impcontasa
         nlinha--
         ncont:= 2
         do while (ncont <= Len(vngrupos[1]) .AND. ncont <= ;
               Len(vngrupos[2]))
            nvar:= vngrupos[1][ncont]
            seek nvar
            if (Found())
               cnomegrupo:= descricao
            else
               cnomegrupo:= "Grupo nao Cadastrado "
            endif
            @ nlinha + 2,  1 say "Total do Grupo "
            @ nlinha + 2, 17 say vngrupos[1][ncont]
            @ nlinha + 2, 20 say cnomegrupo
            @ nlinha + 2, 55 say vngrupos[2][ncont] picture ;
               "9,999,999.99"
            nlinha++
            ncont++
            if (nlinha > nalturafor)
               rodape(nalturafor, .F., 79)
               ccabecalho++
               nlinha:= 7
               eject
               @  1,  1 say "" + cnomemp + ""
               @  2,  1 say "Romaneio" + Replicate(" ", 58) + ;
                  "Pagina :" + Str(ccabecalho, 3)
               @  3,  1 say ccoldata
               @  4,  1 say impcontasa
               @  5,  1 say clinha
               @  6,  1 say impcontasa
            endif
         enddo
         @ nlinha + 2,  1 say impcontasa
         @ nlinha + 3,  1 say "Total de mercadorias :"
         @ nlinha + 3, 24 say ntotquanti picture "9,999,999.99"
         rodape(nalturafor, .T., 79)
      endif
      lcontrole:= .F.
   enddo
   set device to screen
   set color to (ccor)
   close databases
   select 1
   close format
   impritrans(dbcreate)
   dbcreate:= SubStr(cseimp, 1, 5) + ".NTX"
   impritrans(dbcreate)
   RestScreen(0, 0, 24, 79, ctela)
   return Nil

********************************
function PESQ4512

   if (Upper(readvar()) = "NPEDIDO")
      cpesquisa:= {"PEDIDOS", "PEDIDOS1", "NUMERO", "nPedido"}
      ccampos:= {"NUMERO", "DATA", "NOME_CLI", "NUMERO", "DATA", ;
         "NOME DO CLIENTE"}
   elseif (Upper(readvar()) = "NCODCLI")
      cpesquisa:= {"CLIENTES", "CLIENTE1", "CODIGO_CLI", "nCodCli"}
      ccampos:= {"CODIGO_CLI", "NOME_CLI", "", "CODIGO", "NOME", ""}
   endif
   pesquisa()
   return .T.

********************************
function QSR443

   local Local1, Local2, Local3, Local4, Local5, Local6[2], ;
      Local7[5], Local8[5], Local9[5], Local10, Local11, Local12, ;
      Local13, Local14, Local15, Local16, Local17
   ccor:= SetColor()
   Local1:= 1
   Local5:= cempresa
   Local3:= "Romaneio" + Replicate(" ", 58) + "Pagina :" + ;
      Str(Local1, 3)
   Local4:= "Referencia  Quant.  Descriminacao"
   nvias:= 1
   nviaimpr:= 0
   Local10:= Replicate("-", 79)
   Local12:= 0
   Local15:= Space(5)
   Local16:= 0
   nprecovist:= 0
   nprecopraz:= 0
   Local2:= 8
   ncoluna:= 19
   ctela:= SaveScreen(0, 0, 24, 79)
   Local6[1]:= "Sim"
   Local6[2]:= "NÆo"
   Local11:= 0
   cgi:= "G"
   ngru:= 0
   cesp:= Space(15)
   cesp1:= Space(20 - Len(LTrim(Str(nprecovist))))
   cesp2:= Space(20 - Len(LTrim(Str(nprecopraz))))
   processand(.F.)
   if (!abredbf("PRODUTOS", "PRODUTO1.NTX"))
      return .F.
   endif
   janela(Local2, ncoluna, Local2 + 8, ncoluna + 56, ;
      " Impressao de Etiquetas ")
   @  9, ncoluna + 2 say "Geral ou Individual " get cGI valid cgi $ ;
      "GI"
   read
   if (cgi = "I")
      @ 11, ncoluna + 2 say "Ref."
      @ 13, ncoluna + 2 say "A vista"
      @ 13, ncoluna + 18 say "A prazo"
      @ 13, ncoluna + 50 say "Quant."
      lcontrole:= .T.
      do while (lcontrole)
         processand(.F.)
         set device to screen
         @ 12, ncoluna + 2 get cRef
         read
         Local15:= Replicate("0", 5 - Len(Trim(Local15))) + Local15
         @ 12, ncoluna + 2 get cRef
         clear gets
         if (Local15 = Space(5))
            lcontrole:= .F.
            loop
         endif
         seek Local15
         if (Found())
            @ 12, ncoluna + 10 say descricao
            cdesc:= descricao
            nprecovist:= valor
            nprecopraz:= valor
            cesp1:= Space(20 - Len(LTrim(Str(nprecovist))))
            cesp2:= Space(20 - Len(LTrim(Str(nprecopraz))))
         endif
         @ 14, ncoluna + 2 get nPrecoVist picture "9,999.99"
         @ 14, ncoluna + 18 get nPrecoPraz picture "9,999.99"
         @ 14, ncoluna + 50 get nQuanti picture "999"
         read
         if (LastKey() == K_ESC)
            nresp:= alert("Abandona Impressao de Etiquetas ?", Local6)
            if (nresp == 1)
               set color to (ccor)
               RestScreen(0, 0, 24, 79, ctela)
               set device to screen
               return Nil
            endif
         endif
         if (impressora() == 1)
            processand(.T.)
            set device to printer
            @ PRow(),  0 say "C" + Chr(nlinform)
            @ PRow(),  0 say ""
            @ PRow(),  0 say ""
            @ PRow(),  0 say ""
            @ PRow(),  0 say ""
            Local16:= Local16 / 5
            Local12:= 1
            Local2:= 1
            do while (Local12 <= Local16)
               @ PRow() + 2,  2 say Trim(Local15) + cesp + ;
                  Trim(Local15) + cesp + Trim(Local15) + cesp + ;
                  Trim(Local15) + cesp + Trim(Local15)
               @ PRow() + 1,  2 say LTrim(Str(nprecovist)) + cesp1 + ;
                  LTrim(Str(nprecovist)) + cesp1 + ;
                  LTrim(Str(nprecovist)) + cesp1 + ;
                  LTrim(Str(nprecovist)) + cesp1 + ;
                  LTrim(Str(nprecovist))
               @ PRow() + 1,  2 say LTrim(Str(nprecopraz)) + cesp2 + ;
                  LTrim(Str(nprecopraz)) + cesp2 + ;
                  LTrim(Str(nprecopraz)) + cesp2 + ;
                  LTrim(Str(nprecopraz)) + cesp2 + ;
                  LTrim(Str(nprecopraz))
               Local12++
            enddo
         endif
      enddo
   else
      Local7:= {" ", " ", " ", " ", " "}
      Local8:= {0, 0, 0, 0, 0}
      Local9:= {0, 0, 0, 0, 0}
      ncontador:= 1
      @ 11, ncoluna + 2 say "Qual o grupo " get nGRU picture "999"
      @ 13, ncoluna + 2 say "Quantidade   " get nQuanti picture "999"
      read
      if (LastKey() == K_ESC)
         nresp:= alert("Abandona Impressao de Etiquetas ?", Local6)
         if (nresp == 1)
            set color to (ccor)
            RestScreen(0, 0, 24, 79, ctela)
            set device to screen
            return Nil
         endif
      endif
      select 1
      seq:= 1
      set device to printer
      goto top
      do while (!EOF())
         if (ngru != grupo .AND. ngru != 0)
            skip 
            loop
         endif
         do while (ncontador <= Local16)
            Local7[seq]:= codigo
            Local8[seq]:= valor
            Local9[seq]:= val_prazo
            seq:= seq + 1
            if (seq > 5)
               @ PRow() + 2,  2 say Local7[1] + cesp + Local7[2] + ;
                  cesp + Local7[3] + cesp + Local7[4] + cesp + ;
                  Local7[5]
               @ PRow() + 1,  0 say Local8[1] picture "9999.99"
               @ PRow(), 20 say Local8[2] picture "9999.99"
               @ PRow(), 40 say Local8[3] picture "9999.99"
               @ PRow(), 60 say Local8[4] picture "9999.99"
               @ PRow(), 80 say Local8[5] picture "9999.99"
               @ PRow() + 1,  0 say Local9[1] picture "9999.99"
               @ PRow(), 20 say Local9[2] picture "9999.99"
               @ PRow(), 40 say Local9[3] picture "9999.99"
               @ PRow(), 60 say Local9[4] picture "9999.99"
               @ PRow(), 80 say Local9[5] picture "9999.99"
               seq:= 1
            endif
            ncontador++
         enddo
         ncontador:= 1
         skip 
      enddo
      if (seq > 1)
         @ PRow() + 2,  2 say Local7[1] + cesp + Local7[2] + cesp + ;
            Local7[3] + cesp + Local7[4] + cesp + Local7[5]
         @ PRow() + 1,  0 say Local8[1] picture "9999.99"
         @ PRow(), 20 say Local8[2] picture "9999.99"
         @ PRow(), 40 say Local8[3] picture "9999.99"
         @ PRow(), 60 say Local8[4] picture "9999.99"
         @ PRow(), 80 say Local8[5] picture "9999.99"
         @ PRow() + 1,  0 say Local9[1] picture "9999.99"
         @ PRow(), 20 say Local9[2] picture "9999.99"
         @ PRow(), 40 say Local9[3] picture "9999.99"
         @ PRow(), 60 say Local9[4] picture "9999.99"
         @ PRow(), 80 say Local9[5] picture "9999.99"
      endif
   endif
   set device to screen
   set color to (ccor)
   close databases
   select 1
   close format
   RestScreen(0, 0, 24, 79, ctela)
   return Nil

********************************
function QSR4441

   private ccoluna, clinha, cnomemp, vet[2], tip_doc_ar
   private impcontasa, ddtfim, dbclearrel, valfr, observacao, ;
      cnomecli, cdebcred
   private ccond, ntotvist, ntotpraz, ntotval, cnomcond, nloja
   private ddt_venc, nval_tit, situaca_ar, ddtvenc, nlinha, ncodcli, ;
      nval_rece
   private nvlrece, nlojaped, cchave, cimpmat, ccabecalho
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   ccabecalho:= 1
   nlinha:= 1
   cnomemp:= cempresa
   ccoluna:= "Relatorio do Pedidos" + Replicate(" ", 47) + ;
      "Pagina :" + Str(ccabecalho, 3)
   clinha:= ;
      "Data     Fornecedor                           Tipo Documento  Dest. Valor Total"
   tip_doc_ar:= ;
      " Codigo  Descricao                          Quantidade       Valor        Total"
   ccab:= "Relatorio de Entradas no Estoque"
   nvias:= 0
   nviaimpr:= 0
   impcontasa:= Replicate("-", 79)
   val_rece:= 0
   dtrece:= CToD("  /  /  ")
   cimpform:= " "
   nlojaped:= 0
   cchave:= ""
   cimpmat:= " "
   lcontrole:= .T.
   ddtfim:= CToD("  /  /  ")
   dbclearrel:= CToD("  /  /  ")
   nloja:= 0
   valfr:= CToD("  /  /  ")
   observacao:= 0
   cnomecli:= Space(30)
   cdebcred:= 0
   fonecomp:= 0
   ccond:= Space(1)
   ntotvist:= 0
   ntotpraz:= 0
   ntotval:= 0
   cnomcond:= Space(7)
   nlinha:= 10
   ncoluna:= 19
   ctela:= SaveScreen(0, 0, 24, 79)
   vet[1]:= "Sim"
   vet[2]:= "NÆo"
   do while (lcontrole)
      processand(.F.)
      nlinha:= 10
      ncoluna:= 19
      janela(nlinha, ncoluna, nlinha + 6, ncoluna + 47, ;
         "Relatorio de Entradas no Estoque")
      @ nlinha + 1, ncoluna + 2 say "Data Inicial"
      @ nlinha + 1, ncoluna + 20 say "Data Final  "
      @ nlinha + 3, ncoluna + 2 say ;
         "Imprime mercadorias da Entrada (S/N) ?"
      @ nlinha + 2, ncoluna + 2 get dDtInicio
      @ nlinha + 2, ncoluna + 20 get dDtFim
      @ nlinha + 4, ncoluna + 2 get cImpMat picture "!" valid ;
         cimpmat $ "SN"
      read
      if (sai())
         loop
      endif
      processand(.T.)
      if (ddtfim == CToD("  /  /  "))
         ddtfim:= CToD("01/01/01")
      endif
      if (dbclearrel == CToD("  /  /  "))
         dbclearrel:= CToD("31/12/99")
      endif
      ccoldata:= "Periodo de " + DToC(ddtfim) + " a " + ;
         DToC(dbclearrel) + "     " + "Loja : " + Str(nloja, 2)
      if (!abredbf("ENTRADAS", "ENTRADA3.NTX"))
         loop
      endif
      select 2
      if (!abredbf("FORNECED", "FORNECE1.NTX"))
         loop
      endif
      select Entradas
      set filter to Data >= dDtInicio .AND. Data <= dDtFim
      goto top
      if (impressora() == 1)
         set device to printer
         @  0,  0 say "C" + Chr(nlinform)
         @  1,  1 say "" + cnomemp + ""
         @  2,  1 say ccab + Replicate(" ", 79 - Len(ccab) - 12) + ;
            "Pagina :" + Str(ccabecalho, 3)
         @  3,  1 say ccoldata
         @  4,  1 say impcontasa
         @  5,  1 say clinha
         @  6,  1 say tip_doc_ar
         @  7,  1 say impcontasa
         nlinha:= 8
         select Entradas
         goto top
         do while (!EOF())
            nnumdoc:= num_docto
            nnumped:= tipo_docto
            valfr:= data
            ncodigofor:= fornecedor
            cdebcred:= valor_tot
            ccodmat:= destino
            select Forneced
            seek ncodigofor
            if (Found())
               cnomefor:= nome
            else
               cnomefor:= "**** Cliente nao cadastrado ****"
            endif
            ntotval:= ntotval + cdebcred
            @ nlinha,  1 say valfr
            @ nlinha, 10 say Str(ncodigofor, 5) + " " + cnomefor
            @ nlinha, 47 say nnumped
            @ nlinha, 52 say nnumdoc
            @ nlinha, 63 say ccodmat
            @ nlinha, 66 say cdebcred picture "999,999,999.99"
            @ nlinha,  1 say valfr
            @ nlinha, 10 say Str(ncodigofor, 5) + " " + cnomefor
            @ nlinha, 47 say nnumped
            @ nlinha, 52 say nnumdoc
            @ nlinha, 63 say ccodmat
            @ nlinha, 66 say cdebcred picture "999,999,999.99"
            if (cimpmat = "S")
               impprode(nnumdoc)
            endif
            skip 
            nlinha++
            if (nlinha > nalturafor)
               rodape(nalturafor, .F., 79)
               ccabecalho++
               nlinha:= 8
               eject
               @  1,  1 say "" + cnomemp + ""
               @  2,  1 say ccab + Replicate(" ", 79 - Len(ccab) - ;
                  12) + "Pagina :" + Str(ccabecalho, 3)
               @  3,  1 say ccoldata
               @  4,  1 say impcontasa
               @  5,  1 say clinha
               @  6,  1 say tip_doc_ar
               @  7,  1 say impcontasa
            endif
            valfr:= CToD("  /  /  ")
            observacao:= 0
            cnomecli:= Space(30)
            cdebcred:= 0
            ccond:= Space(1)
         enddo
         @ nlinha + 0,  1 say impcontasa
         @ nlinha + 1, 32 say "Total Geral....:"
         @ nlinha + 1, 50 say ntotval picture "999,999,999.99"
         rodape(nalturafor, .T., 79)
      endif
      lcontrole:= .F.
   enddo
   set device to screen
   set color to (ccor)
   close databases
   select 1
   close format
   RestScreen(0, 0, 24, 79, ctela)
   return Nil

********************************
function QSR445

   private ccabecalho, nlinha, ccoluna, clinha, cnomemp, vet[2], ;
      impcontasa
   private nvias, nviaimpr, ngrupo, nloja1, nloja2, nloja3, nloja4, ;
      nvlrcomp
   private ccodigo, cdescr, nestmin, nvalcust, ntotal, nvaltotal
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   ccabecalho:= 1
   nlinha:= 1
   cnomemp:= cempresa
   clinha:= ;
      "Cod.Pro  Descricao                                     Marca               Estoque         Valor      Total"
   nvias:= 1
   nviaimpr:= 0
   impcontasa:= Replicate("-", 136)
   ddt_venc:= " "
   nloja:= 0
   ngrupo:= 0
   ccodigo:= Space(5)
   cdescr:= Space(35)
   nloja1:= 0
   nloja2:= 0
   nloja3:= 0
   nloja4:= 0
   nvlrcomp:= 0
   nestmin:= 0
   nvalcust:= 0
   ntotal:= 0
   nvaltotal:= 0
   nlinha:= 10
   ncoluna:= 19
   ctela:= SaveScreen(0, 0, 24, 79)
   vet[1]:= "Sim"
   vet[2]:= "NÆo"
   processand(.F.)
   janela(nlinha, ncoluna, nlinha + 7, ncoluna + 50, ;
      " Inventario de Estoque ")
   @ nlinha + 2, ncoluna + 12 say "Grupo"
   @ nlinha + 2, ncoluna + 22 say "N§ de Copias"
   @ nlinha + 5, ncoluna + 2 say ;
      "Valor : Ultima Compra (U),  Venda (V)"
   @ nlinha + 3, ncoluna + 13 get nGrupo picture "999"
   @ nlinha + 3, ncoluna + 27 get nVias picture "999"
   @ nlinha + 5, ncoluna + 40 get cTipo picture "!" valid ddt_venc $ ;
      "UV"
   read
   if (sai())
      RestScreen(0, 0, 24, 79, ctela)
      return .F.
   endif
   ccoluna:= "Inventario de Estoque da loja " + Str(nloja, 1) + ;
      Replicate(" ", 91) + "Pagina :" + Str(ccabecalho, 3)
   processand(.T.)
   if (impressora() == 1)
      set device to printer
      @  0,  0 say "C" + Chr(nlinform)
      select 1
      if (!abredbf("PRODUTOS"))
         return .F.
      endif
      set index to PRODUTO3, PRODUTO1
      if (cimppro0 = "N")
         if (ngrupo != 0)
            set filter to Produtos->Grupo = nGrupo .AND. ;
               Produtos->Estoque > 0 .AND. Produtos->Valor > 0
         else
            set filter to Estoque > 0 .AND. Valor > 0
         endif
      elseif (cimppro0 = "S")
         if (ngrupo != 0)
            set filter to Produtos->Grupo = nGrupo
         endif
      endif
      select 2
      if (!abredbf("GRUPO", "GRUPO.NTX"))
         return .F.
      endif
      do while (nviaimpr != nvias)
         @  0,  0 say "C" + Chr(nlinform)
         @  0,  0 say ""
         @  1,  1 say cnomemp
         @  2,  1 say ccoluna
         @  3,  1 say impcontasa
         @  4,  1 say clinha
         @  5,  1 say impcontasa
         nlinha:= 6
         select Produtos
         goto top
         do while (!EOF())
            ngrupo:= produtos->grupo
            select Grupo
            seek ngrupo
            if (Found())
               cnomgrupo:= descricao
            else
               cnomgrupo:= "DESCRICAO NAO ENCONTRADA"
            endif
            @ nlinha,  1 say "" + cnomgrupo + ""
            nlinha++
            select Produtos
            do while (ngrupo == produtos->grupo .AND. !EOF())
               ccodigo:= produtos->codigo
               cdescr:= produtos->descricao
               nestmin:= produtos->estoque
               cmarca:= produtos->marca
               if (ddt_venc = "U")
                  nvalcust:= produtos->valor_ultc
               elseif (ddt_venc = "V")
                  nvalcust:= produtos->valor
               endif
               ntotal:= nestmin * nvalcust
               nvaltotal:= nvaltotal + ntotal
               @ nlinha,  1 say ccodigo
               @ nlinha, 10 say cdescr
               @ nlinha, 56 say cmarca
               @ nlinha, 70 say nestmin picture "9,999,999.99"
               @ nlinha, 85 say nvalcust picture "9,999,999.99"
               @ nlinha, 95 say ntotal picture "9,999,999.99"
               if (ntotal <= 0)
                  @ nlinha,  1 say ccodigo
                  @ nlinha, 10 say SubStr(cdescr, 1, 30)
                  @ nlinha, 46 say cmarca
                  @ nlinha, 70 say nestmin picture "9,999,999.99"
                  @ nlinha, 85 say nvalcust picture "9,999,999.99"
                  @ nlinha, 95 say ntotal picture "9,999,999.99"
               endif
               ccodigo:= Space(5)
               cdescr:= Space(35)
               nestmin:= 0
               nvalcust:= 0
               ntotal:= 0
               nloja2:= 0
               skip 
               nlinha++
               if (nlinha > nalturafor)
                  rodape(nalturafor, .F., 134)
                  @  1,  1 say cnomemp
                  @  2,  1 say ccoluna:= "Inventario de Estoque" + ;
                     Replicate(" ", 101) + "Pagina :" + ;
                     Str(ccabecalho, 3)
                  @  3,  1 say impcontasa
                  @  4,  1 say clinha
                  @  5,  1 say impcontasa
                  ccabecalho++
                  nlinha:= 6
               endif
            enddo
            select Produtos
         enddo
         ccabecalho:= 1
         nviaimpr++
      enddo
      @ nlinha + 0,  0 say impcontasa
      @ nlinha + 1, 50 say "Valor Total"
      @ nlinha + 1, 75 say nvaltotal picture "9,999,999.99"
      rodape(nalturafor, .T., 136)
   endif
   set device to screen
   set color to (ccor)
   close databases
   select 1
   close format
   RestScreen(0, 0, 24, 79, ctela)
   return Nil

********************************
function QSR446

   private ccabecalho, nlinha, ccoluna, clinha, cnomemp, vet[2]
   private impcontasa, ncont, lcontrole, nprim, ccoldata
   private ddtfim, dbclearrel, ncodigo, cnome, valfr, cdebcred, ;
      nvalortot
   programa(0, 69, coropcoes)
   lcontrole:= .T.
   ccor:= SetColor()
   ccabecalho:= 1
   nlinha:= 1
   cnomemp:= cempresa
   ccoluna:= "Relacao de acertos do periodo" + Replicate(" ", 30) + ;
      "Pagina :" + Str(ccabecalho, 3)
   clinha:= ;
      "Data   Codigo  Nome do Cliente                        Valor Total "
   nvias:= 0
   nviaimpr:= 0
   impcontasa:= Replicate("-", 79)
   ncodigo:= 0
   cnome:= Space(30)
   valfr:= CToD("")
   cdebcred:= 0
   nvalortot:= 0
   ddtfim:= CToD("  /  /  ")
   dbclearrel:= CToD("  /  /  ")
   nlinha:= 10
   ncoluna:= 19
   ctela:= SaveScreen(0, 0, 24, 79)
   vet[1]:= "Sim"
   vet[2]:= "NÆo"
   ncont:= 0
   do while (lcontrole)
      processand(.F.)
      janela(nlinha, ncoluna, nlinha + 4, ncoluna + 47, ;
         " Relatorio de Acertos ")
      @ nlinha + 1, ncoluna + 2 say "Data Inicial"
      @ nlinha + 1, ncoluna + 20 say "Data Final "
      @ nlinha + 2, ncoluna + 2 get dDtInicio
      @ nlinha + 2, ncoluna + 20 get dDtFim
      read
      if (ddtfim == CToD("  /  /  "))
         ddtfim:= CToD("01/01/01")
      endif
      if (dbclearrel == CToD("  /  /  "))
         dbclearrel:= CToD("31/12/99")
      endif
      ccoldata:= "Periodo de " + DToC(ddtfim) + " a " + ;
         DToC(dbclearrel)
      if (sai())
         loop
      endif
      if (impressora() == 1)
         processand(.T.)
         select 1
         if (!abredbf("CLIENTES", "CLIENTE3.NTX"))
            loop
         endif
         set filter to Dt_Acerto >= dDtInicio .AND. Dt_Acerto <= ;
            dDtFim
         select 2
         if (!abredbf("MAT_CONS", "MAT_CON1.NTX"))
            loop
         endif
         goto top
         set device to printer
         @  0,  0 say "C" + Chr(nlinform)
         @  1,  1 say "" + cnomemp + ""
         @  2,  1 say "Relacao de acertos do periodo" + ;
            Replicate(" ", 30) + "Pagina :" + Str(ccabecalho, 3)
         @  3,  1 say ccoldata
         @  4,  1 say impcontasa
         @  5,  1 say clinha
         @  6,  1 say impcontasa
         nlinha:= 7
         select Clientes
         goto top
         do while (!EOF())
            if (Empty(dt_acerto))
               skip 
               loop
            endif
            ncodigo:= codigo_cli
            cnome:= nome_cli
            valfr:= dt_acerto
            select Mat_Cons
            seek ncodigo
            do while (cliente = ncodigo .AND. !EOF())
               cdebcred:= cdebcred + quantidade * valor
               skip 
            enddo
            if (cdebcred != 0)
               nvalortot:= nvalortot + cdebcred
               @ nlinha,  1 say valfr
               @ nlinha,  8 say ncodigo
               @ nlinha, 16 say cnome
               @ nlinha, 55 say cdebcred picture "9,999,999.99"
               nlinha++
            endif
            if (nlinha > nalturafor)
               rodape(nalturafor, .F., 79)
               ccabecalho++
               nlinha:= 7
               eject
               @  1,  1 say "" + cnomemp + ""
               @  2,  1 say "Relacao de acertos do periodo" + ;
                  Replicate(" ", 30) + "Pagina :" + Str(ccabecalho, 3)
               @  3,  1 say ccoldata
               @  4,  1 say impcontasa
               @  5,  1 say clinha
               @  6,  1 say impcontasa
            endif
            select Clientes
            skip 
            cdebcred:= 0
         enddo
         @ nlinha + 1,  1 say impcontasa
         @ nlinha + 2, 30 say "Valor Total......... :"
         @ nlinha + 2, 55 say nvalortot picture "9,999,999.99"
         rodape(nalturafor, .T., 79)
      endif
      lcontrole:= .F.
   enddo
   set device to screen
   set color to (ccor)
   close databases
   select 1
   close format
   RestScreen(0, 0, 24, 79, ctela)
   return Nil

********************************
procedure IMPPRODENT(Arg1)

   ntotal:= 0
   ncont:= 0
   ncont:= 0
   do while (.T.)
      use Produtos new shared index Produto1
      if (ncont > 3)
         alert("Erro na abertura de arquivo! Operao ser  cancelada.")
         lcontrole:= .F.
      endif
      if (neterr())
         InKey(2)
         ncont++
         loop
      else
         exit
      endif
   enddo
   ncont:= 0
   do while (.T.)
      use Ped_Mat new shared index Ped_Mat
      if (ncont > 3)
         alert("Erro na abertura de arquivo! Operao ser  cancelada.")
         lcontrole:= .F.
      endif
      if (neterr())
         InKey(2)
         ncont++
         loop
      else
         exit
      endif
   enddo
   seek Arg1
   if (Found())
      nlinha++
      do while (Arg1 = Str(loja, 2) + Str(numero_ped, 5) .AND. !EOF())
         ccodigo:= codigo_mat
         nvalormat:= quantidade
         cdebcred:= valor
         ntotal:= quantidade * valor
         select Produtos
         seek ccodigo
         if (Found())
            cdesc:= descricao
         else
            cdesc:= " **** Produto nao cadastrado **** "
         endif
         @ nlinha,  2 say ccodigo
         @ nlinha, 11 say cdesc
         @ nlinha, 47 say nvalormat picture "9,999,999.99"
         @ nlinha, 60 say cdebcred picture "9,999,999.99"
         @ nlinha, 73 say ntotal picture "9,999,999.99"
         select Ped_Mat
         skip 
         nlinha++
      enddo
   endif
   select Ped_Mat
   close
   select Produtos
   close
   select Pedidos
   return

********************************
function QSR447

   private nlinha, cnomemat, cdescmat, unidade, nvalortot, ;
      ntotalgera, impcontasa, ctitulocol
   private ccodmatant, nvalormat, nquantitot
   nlinha:= 10
   ncoluna:= 11
   ctela:= SaveScreen(0, 0, 24, 79)
   lcontrole:= .T.
   cconf:= " "
   impcontasa:= Replicate("-", 79)
   cnomemp:= cempresa
   ccabecalho:= 1
   processand(.F.)
   janela(nlinha, ncoluna, nlinha + 4, ncoluna + 43, ;
      "Relatorio de Mercadorias Consignadas")
   @ nlinha + 1, ncoluna + 2 say "Confirma a impressao do Relatorio"
   @ nlinha + 2, ncoluna + 2 get cConf picture "!" valid cconf $ "NS"
   read
   if (sai())
      RestScreen(0, 0, 24, 79, ctela)
   else
      processand(.T.)
      if (!abredbf("MAT_CONS", "MAT_CON3.NTX"))
         return .F.
      endif
      select 2
      if (!abredbf("PRODUTOS", "PRODUTO1.NTX"))
         return .F.
      endif
      nlinha:= 5
      impcontasa:= Replicate("-", 78)
      ctitulocol:= ;
         "Codigo  Descricao                      Unid.       Quant.             Total"
      nvalormat:= 0
      nvalortot:= 0
      ntotalgera:= 0
      nquantitot:= 0
      if (impressora() == 1)
         set device to printer
         @  1,  0 say cnomemp
         @  2,  0 say "Relacao de Mercadorias Consignadas" + ;
            Replicate(" ", 35) + Str(ccabecalho, 3)
         @  3,  1 say impcontasa
         @  4,  1 say ctitulocol
         select Mat_Cons
         do while (!EOF())
            ccodmatant:= codigo_mat
            cnomemat:= mat_cons->codigo_mat
            do while (ccodmatant == codigo_mat .AND. !EOF())
               nvalormat:= mat_cons->quantidade + nvalormat
               skip 
            enddo
            if (nvalormat > 0)
               select Produtos
               seek cnomemat
               if (Found())
                  cdescmat:= produtos->descricao
                  unidade:= produtos->nct
                  nvalortot:= produtos->valor * nvalormat
                  ntotalgera:= ntotalgera + nvalortot
                  nquantitot:= nquantitot + nvalormat
               else
                  cdescmat:= ""
                  unidade:= ""
                  nvalortot:= 0
               endif
               @ nlinha,  1 say cnomemat
               @ nlinha,  9 say cdescmat
               @ nlinha, 40 say unidade
               @ nlinha, 47 say nvalormat
               @ nlinha, 64 say nvalortot picture "9,999,999.99"
               nlinha++
               if (nlinha > nalturafor)
                  rodape(nalturafor, .F., 79)
                  ccabecalho++
                  nlinha:= 5
                  eject
                  @  1,  0 say cnomemp
                  @  2,  0 say "Relacao de Mercadorias Consignadas" ;
                     + Replicate(" ", 35) + Str(ccabecalho, 3)
                  @  3,  1 say impcontasa
                  @  4,  1 say ctitulocol
               endif
            endif
            select Mat_Cons
            nvalormat:= 0
            nvalortot:= 0
         enddo
         nlinha++
         @ nlinha,  0 say impcontasa
         @ nlinha + 1, 30 say "Total Geral.:"
         @ nlinha + 1, 47 say nquantitot
         @ nlinha + 1, 64 say ntotalgera picture "9,999,999.99"
         rodape(nalturafor, .T., 79)
         set device to screen
      endif
      RestScreen(0, 0, 24, 79, ctela)
      close databases
      select 1
      close format
      return Nil
   endif

********************************
function QSR448

   private ccabecalho, nlinha, ccoluna, clinha, cnomemp, vet[2]
   private impcontasa, ncont, lcontrole, nprim, ccoldata, ntotquanti
   private ddtfim, dbclearrel, cref, nvalormat, cdescr, nloja, nvar, ;
      cnomegrupo
   private carquivo[4, 4], vngrupos[2, 1], npedido
   programa(0, 69, coropcoes)
   lcontrole:= .T.
   ccor:= SetColor()
   ccabecalho:= 1
   nlinha:= 1
   cnomemp:= cempresa
   ccoluna:= "Relacao Lucro Bruto" + Replicate(" ", 100) + ;
      "Pagina :" + Str(ccabecalho, 3)
   clinha:= ;
      "Codigo Discriminacao                             Unid. Quantidade    Custo Unit.   Valor Custo    Venda Unit.    Valor Venda      Lucro"
   nvias:= 0
   nviaimpr:= 0
   impcontasa:= Replicate("-", 134)
   ntotquanti:= 0
   npedido:= 0
   ntotcusto:= 0
   ntotvenda:= 0
   ntotdesp:= 0
   ntotcatual:= 0
   ntotvatual:= 0
   ddt_venc:= "I"
   ddtfim:= CToD("  /  /  ")
   dbclearrel:= CToD("  /  /  ")
   nloja:= 0
   cref:= Space(5)
   nvalormat:= 0
   cdescr:= Space(35)
   nvar:= 0
   cnomegrupo:= Space(30)
   cseimp:= ""
   nlinha:= 10
   ncoluna:= 19
   ctela:= SaveScreen(0, 0, 24, 79)
   vet[1]:= "Sim"
   vet[2]:= "NÆo"
   ncont:= 0
   ncont:= 1
   dbcreate:= "TEMP" + LTrim(Str(ncont)) + ".DBF"
   do while (file(dbcreate))
      ncont++
      dbcreate:= "TEMP" + LTrim(Str(ncont)) + ".DBF"
   enddo
   carquivo[1]:= {"REFERENCIA", "C", 5, 0}
   carquivo[2]:= {"QUANTIDADE", "N", 12, 0}
   carquivo[3]:= {"CUSTO", "N", 12, 2}
   carquivo[4]:= {"VENDA", "N", 12, 2}
   cprod(dbcreate, carquivo)
   do while (lcontrole)
      processand(.F.)
      janela(nlinha, ncoluna, nlinha + 4, nlinha + 48, ;
         " Relatorio de Lucro Bruto")
      @ nlinha + 1, ncoluna + 2 say "Data Inicial"
      @ nlinha + 1, ncoluna + 20 say "Data Final "
      @ nlinha + 2, ncoluna + 2 get dDtInicio
      @ nlinha + 2, ncoluna + 20 get dDtFim
      read
      if (sai())
         loop
      endif
      processand(.T.)
      if (ddtfim == CToD("  /  /  "))
         ddtfim:= CToD("01/01/01")
      endif
      if (dbclearrel == CToD("  /  /  "))
         dbclearrel:= CToD("31/12/99")
      endif
      if (ddt_venc = "I")
         ctipoimp:= "Interno"
      elseif (ddt_venc = "E")
         ctipoimp:= "Externo"
      else
         ctipoimp:= "Todos os Tipos"
      endif
      ccoldata:= "Periodo de " + DToC(ddtfim) + " a " + ;
         DToC(dbclearrel) + "    " + "Loja : " + Str(nloja, 2) + "-" ;
         + loja(nloja) + " Tipo : " + ctipoimp
      if (impressora() == 1)
         select 10
         if (!abredbf("PEDIDOS"))
            loop
         endif
         set index to PEDIDOS3, PEDIDOS1
         select 1
         if (!abredbf("PED_MAT", "PED_MAT.NTX"))
            loop
         endif
         select 2
         if (!abredbf(dbcreate))
            loop
         endif
         cseimp:= SubStr(dbcreate, 1, 5)
         index on REFERENCIA to (cseimp)
         set index to (cseimp)
         nlinha:= 6
         select Pedidos
         set softseek on
         seek ddtfim
         set softseek off
         do while (!EOF() .AND. data <= dbclearrel)
            if (nloja != 0)
               if (loja != nloja)
                  skip 
                  loop
               endif
            endif
            if (ddt_venc != " ")
               if (ddt_venc = "I")
                  if (int_ext = "E")
                     skip 
                     loop
                  endif
               elseif (int_ext = "I")
                  skip 
                  loop
               endif
            endif
            npedido:= Str(loja, 2) + Str(numero, 5)
            select Ped_Mat
            seek npedido
            if (Found())
               do while (!EOF() .AND. Str(loja, 2) + Str(numero_ped, ;
                     5) = npedido)
                  cref:= codigo_mat
                  nvalormat:= quantidade
                  nlojaped:= loja
                  ncusto:= data_ultc * quantidade
                  nvenda:= valor * quantidade
                  nnumeroped:= Str(loja, 2) + Str(numero_ped, 5)
                  select 2
                  seek cref
                  if (!Found())
                     if (!adiciona())
                        loop
                     endif
                     RLock()
                     replace referencia with cref
                     replace quantidade with nvalormat
                     replace custo with ncusto
                     replace venda with nvenda
                  else
                     RLock()
                     replace quantidade with quantidade + nvalormat
                     replace custo with custo + ncusto
                     replace venda with venda + nvenda
                  endif
                  select Ped_Mat
                  skip 
               enddo
            endif
            select Pedidos
            skip 
         enddo
         if (!lcontrole)
            loop
         endif
         select Ped_Mat
         close
         select 2
         select 1
         if (!abredbf("PRODUTOS", "PRODUTO1.NTX"))
            loop
         endif
         set device to printer
         @  0,  0 say "C" + Chr(nlinform)
         @  1,  1 say ""
         @  1,  1 say cnomemp + ""
         @  2,  1 say "Relacao de Lucro Bruto" + Replicate(" ", 100) ;
            + "Pagina :" + Str(ccabecalho, 3)
         @  3,  1 say ccoldata
         @  4,  1 say impcontasa
         @  5,  1 say clinha
         @  6,  1 say impcontasa
         nlinha:= 7
         select 2
         cseimp:= SubStr(dbcreate, 1, 5)
         index on QUANTIDADE to (cseimp)
         set index to (cseimp)
         goto top
         do while (!EOF())
            cref:= referencia
            nvalormat:= quantidade
            ntotquanti:= ntotquanti + nvalormat
            ncusto:= custo
            nvenda:= venda
            ntotcusto:= ntotcusto + ncusto
            ntotvenda:= ntotvenda + nvenda
            nunitcust:= ncusto / nvalormat
            nunitvend:= nvenda / nvalormat
            select Produtos
            seek cref
            if (Found())
               cdescr:= produtos->descricao
               clocal:= produtos->nct
               ncustatual:= produtos->valor_ultc
               nvendatual:= produtos->valor
            else
               cdescr:= "Referencia nao cadastrada "
               clocal:= "***"
               ncustatual:= 0
               nvendatual:= 0
            endif
            @ nlinha,  1 say cref
            @ nlinha,  8 say cdescr
            @ nlinha, 50 say clocal
            @ nlinha, 53 say nvalormat
            @ nlinha, 69 say nunitcust picture "9,999,999.99"
            @ nlinha, 83 say ncusto
            @ nlinha, 98 say nunitvend picture "9,999,999.99"
            @ nlinha, 113 say nvenda
            @ nlinha, 124 say nvenda - ncusto
            nlinha++
            @ nlinha, 69 say ncustatual picture "9,999,999.99"
            @ nlinha, 83 say ncustatual * nvalormat picture ;
               "9,999,999.99"
            @ nlinha, 98 say nvendatual picture "9,999,999.99"
            @ nlinha, 113 say nvendatual * nvalormat picture ;
               "9,999,999.99"
            @ nlinha, 124 say nvendatual * nvalormat - ncustatual * ;
               nvalormat picture "9,999,999.99"
            ntotcatual:= ntotcatual + ncustatual * nvalormat
            ntotvatual:= ntotvatual + nvendatual * nvalormat
            cref:= Space(5)
            nvalormat:= 0
            cdescr:= Space(35)
            clocal:= ""
            select 2
            skip 
            nlinha++
            if (nlinha > nalturafor)
               rodape(nalturafor, .F., 134)
               ccabecalho++
               nlinha:= 7
               eject
               @  1,  1 say ""
               @  1,  1 say cnomemp + ""
               @  2,  1 say "Relacao de Lucro Bruto" + ;
                  Replicate(" ", 100) + "Pagina :" + Str(ccabecalho, ;
                  3)
               @  3,  1 say ccoldata
               @  4,  1 say impcontasa
               @  5,  1 say clinha
               @  6,  1 say impcontasa
            endif
         enddo
         select 2
         if (!abredbf("GRUPO", "GRUPO.NTX"))
            loop
         endif
         @ nlinha + 0,  1 say impcontasa
         @ nlinha + 1,  1 say "Total de Geral :"
         @ nlinha + 1, 55 say ntotquanti
         @ nlinha + 1, 83 say ntotcusto
         @ nlinha + 1, 113 say ntotvenda
         @ nlinha + 1, 124 say ntotvenda - ntotcusto
         nlinha++
         @ nlinha + 1, 83 say ntotcatual
         @ nlinha + 1, 113 say ntotvatual
         @ nlinha + 1, 124 say ntotvatual - ntotcatual
         @ nlinha + 2,  1 say impcontasa
         ntotlucro:= ntotvenda - ntotcusto
         nlucrobru:= ntotlucro
         rodape(nalturafor, .T., 134)
      endif
      lcontrole:= .F.
   enddo
   set device to screen
   set color to (ccor)
   close databases
   select 1
   close format
   impritrans(dbcreate)
   dbcreate:= SubStr(cseimp, 1, 5) + ".NTX"
   impritrans(dbcreate)
   RestScreen(0, 0, 24, 79, ctela)
   return Nil

********************************
function QSR4511

   private ccabecalho, nlinha, ccoluna, clinha, cnomemp, vet[2], nloja
   private ngrupo, cnomgrupo, ccodigo, cdescr, nporcvista, impcontasa
   cpesquisa:= {"PEDIDOS", "PEDIDOS1", "NUMERO", "nPedido"}
   ccampos:= {"NUMERO", "DATA", "NOME_CLI", "NUMERO", "DATA", ;
      "NOME DO CLIENTE"}
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   ccabecalho:= 1
   nlinha:= 1
   npedido:= 0
   ncodcli:= 0
   nvias:= 0
   nviaimpr:= 0
   impcontasa:= Replicate("-", 79)
   nlinha:= 15
   ncoluna:= 19
   ctela:= SaveScreen(0, 0, 24, 79)
   vet[1]:= "Sim"
   vet[2]:= "NÆo"
   nloja:= 1
   cpreco:= "N"
   processand(.F.)
   janela(nlinha, ncoluna, nlinha + 4, ncoluna + 43, ;
      " Reimpressao de Pedido de Venda ")
   @ nlinha + 1, ncoluna + 2 say "Numero do Pedido"
   @ nlinha + 1, ncoluna + 20 say "Preco (S/N)"
   @ nlinha + 2, ncoluna + 2 get nPedido picture "99999" valid ;
      valpedimp(Str(nloja, 2) + Str(npedido, 5))
   @ nlinha + 2, ncoluna + 20 get cPreco picture "!" valid cpreco $ ;
      "SN"
   read
   if (sai())
      set color to (ccor)
      RestScreen(0, 0, 24, 79, ctela)
      return Nil
   endif
   processand(.T.)
   codpedcli(ncodcli)
   impriped(Str(nloja, 2) + Str(npedido, 5), npedido, cpreco)
   close databases
   select 1
   close format
   RestScreen(0, 0, 24, 79, ctela)
   return

********************************
function QSR449

   private ccabecalho, nlinha, ccoluna, clinha, cnomemp, vet[2]
   private ngrupo, cnomgrupo, ccodigo, cdescr, nporcvista, impcontasa
   private valfr, cunidade, nvias, nviaimpr
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   ccabecalho:= 1
   nlinha:= 1
   cnomemp:= cempresa
   ccoluna:= "Tabela de Precos de Custo" + Replicate(" ", 41) + ;
      "Pagina :" + Str(ccabecalho, 3)
   clinha:= ;
      "Cod.Pro  Descricao                                Unid     Valor      Data "
   nvias:= 0
   nviaimpr:= 0
   impcontasa:= Replicate("-", 79)
   ngrupo:= 0
   cnomgrupo:= Space(30)
   ccodigo:= Space(5)
   cdescr:= Space(35)
   nporcvista:= 0
   cunidade:= 0
   valfr:= CToD("  /  /  ")
   nlinha:= 10
   ncoluna:= 19
   ctela:= SaveScreen(0, 0, 24, 79)
   vet[1]:= "Sim"
   vet[2]:= "NÆo"
   processand(.F.)
   janela(nlinha, ncoluna, nlinha + 4, ncoluna + 43, ;
      "Relacao de Custos")
   @ nlinha + 1, ncoluna + 1 say "Grupo"
   @ nlinha + 1, ncoluna + 10 say "N§ de Copias"
   @ nlinha + 2, ncoluna + 1 get nGrupo picture "999"
   @ nlinha + 2, ncoluna + 10 get nVias picture "999"
   read
   if (sai())
      RestScreen(0, 0, 24, 79, ctela)
      return .F.
   endif
   processand(.T.)
   if (impressora() == 1)
      set device to printer
      @  0,  0 say "C" + Chr(nlinform)
      if (!abredbf("PRODUTOS"))
         return .F.
      endif
      set index to PRODUTO3, PRODUTO1
      if (ngrupo != 0)
         set filter to Produtos->Grupo = nGrupo
      endif
      select 2
      if (!abredbf("GRUPO", "GRUPO.NTX"))
         return .F.
      endif
      do while (nviaimpr != nvias)
         @  1,  1 say "Tabela de Precos de Custo" + Replicate(" ", ;
            41) + "Pagina :" + Str(ccabecalho, 3)
         @  2,  1 say impcontasa
         @  3,  1 say clinha
         @  4,  1 say impcontasa
         nlinha:= 6
         select Produtos
         goto top
         do while (!EOF())
            ngrupo:= produtos->grupo
            select GRUPO
            seek ngrupo
            if (!Found())
               cnomgrupo:= "Grupo nao Cadastrado"
            else
               cnomgrupo:= descricao
            endif
            @ nlinha,  1 say "" + cnomgrupo + ""
            nlinha++
            select Produtos
            do while (ngrupo == produtos->grupo .AND. !EOF())
               @ nlinha,  1 say codigo
               @ nlinha, 10 say descricao
               @ nlinha, 51 say nct
               @ nlinha, 56 say valor picture "999999.99"
               @ nlinha, 69 say peso
               nprecovist:= 0
               nprecopraz:= 0
               skip 
               nlinha++
               if (nlinha > nalturafor)
                  rodape(nalturafor, .F., 79)
                  ccabecalho++
                  nlinha:= 10
                  eject
                  @  6,  1 say "Tabela de Precos de Custo" + ;
                     Replicate(" ", 41) + "Pagina :" + ;
                     Str(ccabecalho, 3)
                  @  7,  1 say impcontasa
                  @  8,  1 say clinha
                  @  9,  1 say impcontasa
               endif
            enddo
            select Produtos
         enddo
         ccabecalho:= 1
         nviaimpr++
      enddo
   endif
   rodape(nalturafor, .T., 79)
   set device to screen
   set color to (ccor)
   close databases
   select 1
   close format
   RestScreen(0, 0, 24, 79, ctela)
   return Nil

********************************
function QSR4490

   private ccabecalho, nlinha, ccoluna, clinha, cnomemp, vet[2]
   private impcontasa, ncont, lcontrole, nprim, ccoldata, ntotquanti
   private ddtfim, dbclearrel, cref, nvalormat, cdescr, nloja, nvar, ;
      cnomegrupo
   private carquivo[4, 4], vngrupos[2, 1], npedido
   programa(0, 69, coropcoes)
   lcontrole:= .T.
   ccor:= SetColor()
   ccabecalho:= 1
   nlinha:= 1
   cnomemp:= cempresa
   ccoluna:= "Relacao Lucro Bruto" + Replicate(" ", 100) + ;
      "Pagina :" + Str(ccabecalho, 3)
   clinha:= ;
      "Codigo Discriminacao                             Unid. Quantidade    Valor Custo   Valor Venda          Lucro"
   nvias:= 0
   nviaimpr:= 0
   impcontasa:= Replicate("-", 134)
   ntotquanti:= 0
   npedido:= 0
   ntotcusto:= 0
   ntotvenda:= 0
   ntotdesp:= 0
   ddt_venc:= "I"
   ddtfim:= CToD("  /  /  ")
   dbclearrel:= CToD("  /  /  ")
   nloja:= 0
   cref:= Space(5)
   nvalormat:= 0
   cdescr:= Space(35)
   nvar:= 0
   cnomegrupo:= Space(30)
   cseimp:= ""
   nlinha:= 10
   ncoluna:= 19
   ctela:= SaveScreen(0, 0, 24, 79)
   vet[1]:= "Sim"
   vet[2]:= "NÆo"
   ncont:= 0
   ncont:= 1
   dbcreate:= "TEMP" + LTrim(Str(ncont)) + ".DBF"
   do while (file(dbcreate))
      ncont++
      dbcreate:= "TEMP" + LTrim(Str(ncont)) + ".DBF"
   enddo
   carquivo[1]:= {"REFERENCIA", "C", 5, 0}
   carquivo[2]:= {"QUANTIDADE", "N", 12, 0}
   carquivo[3]:= {"CUSTO", "N", 12, 2}
   carquivo[4]:= {"VENDA", "N", 12, 2}
   cprod(dbcreate, carquivo)
   do while (lcontrole)
      processand(.F.)
      janela(nlinha, ncoluna, nlinha + 4, ncoluna + 47, ;
         "Relatorio de Despesas/Lucro Liquido")
      @ nlinha + 1, ncoluna + 2 say "Data Inicial"
      @ nlinha + 1, ncoluna + 20 say "Data Final "
      @ nlinha + 2, ncoluna + 2 get dDtInicio
      @ nlinha + 2, ncoluna + 20 get dDtFim
      read
      if (LastKey() == K_ESC)
         nresp:= alert("Abandona Impressao de Romaneio ?", vet)
         if (nresp == 2)
            loop
         else
            lcontrole:= .F.
            loop
         endif
      endif
      processand(.T.)
      if (ddtfim == CToD("  /  /  "))
         ddtfim:= CToD("01/01/01")
      endif
      if (dbclearrel == CToD("  /  /  "))
         dbclearrel:= CToD("31/12/99")
      endif
      if (ddt_venc = "I")
         ctipoimp:= "Interno"
      elseif (ddt_venc = "E")
         ctipoimp:= "Externo"
      else
         ctipoimp:= "Todos os Tipos"
      endif
      ccoldata:= "Periodo de " + DToC(ddtfim) + " a " + ;
         DToC(dbclearrel) + "    " + "Loja : " + Str(nloja, 2) + "-" ;
         + loja(nloja) + " Tipo : " + ctipoimp
      if (impressora() == 1)
         select 5
         if (!abredbf("Pedidos"))
            loop
         endif
         set index to Pedidos3, Pedidos1
         select 1
         if (!abredbf("PED_MAT", "PED_MAT.NTX"))
            loop
         endif
         select 2
         if (!abredbf(dbcreate))
            loop
         endif
         cseimp:= SubStr(dbcreate, 1, 5)
         index on REFERENCIA to (cseimp)
         set index to (cseimp)
         nlinha:= 6
         select Pedidos
         set softseek on
         seek ddtfim
         set softseek off
         do while (!EOF() .AND. data <= dbclearrel)
            if (nloja != 0)
               if (loja != nloja)
                  skip 
                  loop
               endif
            endif
            npedido:= Str(loja, 2) + Str(numero, 5)
            select Ped_Mat
            seek npedido
            if (Found())
               do while (!EOF() .AND. Str(loja, 2) + Str(numero_ped, ;
                     5) = npedido)
                  cref:= codigo_mat
                  nvalormat:= quantidade
                  nlojaped:= loja
                  ncusto:= data_ultc * quantidade
                  nvenda:= valor * quantidade
                  nnumeroped:= Str(loja, 2) + Str(numero_ped, 5)
                  select 2
                  seek cref
                  if (!Found())
                     if (!adiciona())
                        loop
                     endif
                     RLock()
                     replace referencia with cref
                     replace quantidade with nvalormat
                     replace custo with ncusto
                     replace venda with nvenda
                  else
                     RLock()
                     replace quantidade with quantidade + nvalormat
                     replace custo with custo + ncusto
                     replace venda with venda + nvenda
                  endif
                  select Ped_Mat
                  skip 
               enddo
            endif
            select Pedidos
            skip 
         enddo
         if (!lcontrole)
            loop
         endif
         select Ped_Mat
         close
         select 1
         if (!abredbf("Produtos", "PRODUTO1.NTX"))
            loop
         endif
         set device to printer
         @  0,  0 say "C" + Chr(nlinform)
         nlinha:= 7
         select 2
         cseimp:= SubStr(dbcreate, 1, 5)
         index on QUANTIDADE to (cseimp)
         set index to (cseimp)
         goto top
         do while (!EOF())
            cref:= referencia
            nvalormat:= quantidade
            ntotquanti:= ntotquanti + nvalormat
            ncusto:= custo
            nvenda:= venda
            ntotcusto:= ntotcusto + ncusto
            ntotvenda:= ntotvenda + nvenda
            select Produtos
            seek cref
            if (Found())
               cdescr:= produtos->descricao
               clocal:= produtos->nct
            else
               cdescr:= "Referencia nao cadastrada "
               clocal:= "***"
            endif
            select 2
            skip 
         enddo
         ncont:= 0
         do while (.T.)
            select 2
            use Grupo shared readonly index Grupo
            if (ncont > 3)
               alert("Erro na abertura de arquivo!; OperaÆo ser  cancelada!")
               lcontrole:= .F.
            endif
            if (neterr())
               InKey(2)
               ncont++
               loop
            else
               exit
            endif
         enddo
         if (!lcontrole)
            loop
         endif
         ntotlucro:= ntotvenda - ntotcusto
         nlucrobru:= ntotlucro
         clinha:= "Centro de Custo                        Valor Total"
         select 1
         if (!abredbf("CONTASPG"))
            loop
         endif
         set index to CONTPG3, CONTPG2
         set order to 2
         set filter to Dt_Pgto_Pg >= dDtInicio .AND. Dt_pgto_Pg <= ;
            dDtFim
         select 2
         if (!abredbf("FORNECED", "FORNECE1.NTX"))
            loop
         endif
         select 3
         if (!abredbf("CENT_CUS", "CENTRO2.NTX"))
            loop
         endif
         DBEval({|| field->total_acum:= 0}, {|| RLock()}, Nil, Nil, ;
            Nil, .F.)
         qsr12i()
         select ContasPG
         goto top
         do while (!EOF())
            if (nloja != 0)
               if (contaspg->loja != nloja)
                  skip 
                  loop
               endif
            endif
            nvlricms:= tip_doc_pg
            cdebcred:= vl_pgto_pg
            select Forneced
            seek nvlricms
            if (!Found())
               ncodcc:= 0
            else
               ncodcc:= vcodi13a
            endif
            select Cent_Cus
            seek ncodcc
            if (Found())
               if (Len(Trim(ncodcc)) == 7)
                  seek ncodcc
                  if (Found())
                     if (!bloqueia())
                        loop
                     endif
                     replace total_acum with total_acum + cdebcred
                  endif
                  seek SubStr(ncodcc, 1, 2)
                  if (Found())
                     if (!bloqueia())
                        loop
                     endif
                     replace total_acum with total_acum + cdebcred
                  endif
                  seek SubStr(ncodcc, 1, 4)
                  if (Found())
                     if (!bloqueia())
                        loop
                     endif
                     replace total_acum with total_acum + cdebcred
                  endif
               endif
            endif
            select ContasPg
            skip 
         enddo
         set device to printer
         @  0,  0 say "C" + Chr(nlinform)
         @  1,  0 say ""
         @  1,  1 say "" + cnomemp + ""
         @  1,  0 say ""
         @  2,  1 say "Relatorio de Lucro Liquido" + Replicate(" ", ;
            97) + "Pagina :" + Str(ccabecalho, 3)
         @  3,  1 say ccoldata
         @  4,  1 say impcontasa
         @  5,  1 say clinha
         @  6,  1 say impcontasa
         nlinha:= 7
         select Cent_Cus
         goto top
         do while (!EOF())
            @ nlinha,  1 say cod_hier
            @ nlinha,  9 say descricao
            @ nlinha, 41 say total_acum
            if (cod_hier == "0101001")
               nlinha++
               @ nlinha,  0 say impcontasa
            elseif (Len(Trim(cod_hier)) = 2 .AND. SubStr(cod_hier, ;
                  1, 2) != "01")
               ntotdesp:= ntotdesp + total_acum
            endif
            skip 
            nlinha++
            if (nlinha > nalturafor)
               rodape(nalturafor, .F., 134)
               ccabecalho++
               nlinha:= 7
               eject
               @  1,  0 say ""
               @  1,  1 say "" + cnomemp + ""
               @  1,  0 say ""
               @  2,  1 say "Relatorio de Lucro Liquido" + ;
                  Replicate(" ", 97) + "Pagina :" + Str(ccabecalho, 3)
               @  3,  1 say ccoldata
               @  4,  1 say impcontasa
               @  5,  1 say clinha
               @  6,  1 say impcontasa
            endif
         enddo
         ntotlucro:= nlucrobru - ntotdesp
         @ nlinha + 0,  0 say impcontasa
         @ nlinha + 1,  0 say "Total de Despesas "
         @ nlinha + 1, 40 say ntotdesp picture "9,999,999.99"
         @ nlinha + 1,  0 say "Total de Despesas "
         @ nlinha + 1, 40 say ntotdesp picture "9,999,999.99"
         @ nlinha + 2,  0 say "Lucro Bruto"
         @ nlinha + 2, 40 say nlucrobru picture "9,999,999.99"
         @ nlinha + 2,  0 say "Lucro Bruto"
         @ nlinha + 2, 40 say nlucrobru picture "9,999,999.99"
         @ nlinha + 3,  0 say impcontasa
         @ nlinha + 4,  0 say "Lucro Liquido"
         @ nlinha + 4, 40 say ntotlucro picture "9,999,999.99"
         @ nlinha + 4,  0 say "Lucro Liquido"
         @ nlinha + 4, 40 say ntotlucro picture "9,999,999.99"
         rodape(nalturafor, .T., 134)
      endif
      lcontrole:= .F.
   enddo
   set device to screen
   set color to (ccor)
   close databases
   select 1
   close format
   impritrans(dbcreate)
   dbcreate:= SubStr(cseimp, 1, 5) + ".NTX"
   impritrans(dbcreate)
   RestScreen(0, 0, 24, 79, ctela)
   return Nil

********************************
procedure QSR52

   private cores[17], vet[2], v1[1], v2[1], v3[1], ddtinicio[1]
   set escape on
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   lcontrole:= .T.
   nlinha:= 7
   ncoluna:= 19
   ctela:= SaveScreen(nlinha, ncoluna, nlinha + 22, ncoluna + 35)
   lcontrole:= .T.
   vet[1]:= "Sim"
   vet[2]:= "NÆo"
   do while (lcontrole)
      set color to (corfor)
      set color to /GB
      @ nlinha, ncoluna clear to nlinha + 15, ncoluna + 35
      @ nlinha, ncoluna to nlinha + 15, ncoluna + 35
      set color to (cortitfor)
      @ nlinha, ncoluna + 6 say " Configuracao de cores "
      ncont:= 0
      do while (.T.)
         use Cores alias Cores shared
         if (ncont > 3)
            alert("Erro na abertura de arquivo! Operao ser  cancelada.")
            lcontrole:= .F.
         endif
         if (neterr())
            InKey(2)
            ncont++
            loop
         else
            exit
         endif
      enddo
      v1[1]:= "Nome_Cor"
      v2[1]:= "Cor"
      v3[1]:= "Cor"
      ddtinicio[1]:= 1
      ccoluna:= "Escolha a cor e pressione [Enter]"
      goto cores->numero
      consulta("Cores", nlinha, ncoluna, nlinha + 15, ncoluna + 40, ;
         v1, v2, v3, ddtinicio, "CORES", ccoluna)
      rg:= RecNo()
      goto top
      do while (!RLock())
         if (ncont > 3)
            alert("ATENO!; Erro no bloqueio de registro.; Operao ser  cancelada.")
            lcontrole:= .F.
         endif
         ncont++
      enddo
      if (!lcontrole)
         loop
      endif
      replace numero with rg
      cores()
      close
      lcontrole:= .F.
   enddo
   set color to (ccor)
   RestScreen(nlinha, ncoluna, nlinha + 22, ncoluna + 35, ctela)
   return

********************************
function QSR4411

   local Local1, Local2, Local3, Local4, Local5, Local6[2], Local7, ;
      Local8, Local9, Local10, Local11, Local12, Local13, Local14, ;
      Local15
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   Local1:= 1
   Local2:= 1
   Local5:= cempresa
   Local3:= "Tabela de Precos" + Replicate(" ", 104) + "Pagina :" + ;
      Str(Local1, 3)
   Local14:= 0
   Local15:= 0
   Local11:= Replicate("-", 134)
   ccomgrupo:= "S"
   ntotalgera:= 0
   Local7:= 0
   Local8:= Space(30)
   Local9:= Space(5)
   Local10:= Space(35)
   Local12:= 0
   Local13:= 0
   cimpcom:= "S"
   Local2:= 10
   ncoluna:= 19
   ctela:= SaveScreen(0, 0, 24, 79)
   Local6[1]:= "Sim"
   Local6[2]:= "NÆo"
   processand(.F.)
   janela(Local2, ncoluna, Local2 + 8, ncoluna + 55, ;
      "Relatorio de Sugestao de Compra")
   @ Local2 + 3, ncoluna + 2 say "Grupo"
   @ Local2 + 3, ncoluna + 10 say "N§ de Copias"
   @ Local2 + 4, ncoluna + 2 get nGrup1 picture "99"
   @ Local2 + 4, ncoluna + 10 get nVias picture "999"
   read
   if (LastKey() == K_ESC)
      nresp:= alert("Abandona Listagem de Sugestao de compras ?", ;
         Local6)
      if (nresp != 2)
         set color to (ccor)
         RestScreen(0, 0, 24, 79, ctela)
         set device to screen
         return Nil
      endif
   endif
   processand(.T.)
   if (impressora() == 1)
      set device to printer
      @  0,  0 say "C" + Chr(nlinform)
      Local4:= ;
         "Cod.Pro  Descricao                                Marca            Unid   Est. Atual   Est. Minimo   Sugestao      Valor         Total"
      select 1
      if (!abredbf("PRODUTOS", "PRODUTO5.NTX"))
         return .F.
      endif
      if (ccomgrupo = "S")
         select 2
         if (!abredbf("GRUPO", "GRUPO1.NTX"))
            return .F.
         endif
         do while (Local15 != Local14)
            if (cimpcom = "S")
               @  0,  0 say ""
            endif
            @  5,  1 say Local5
            @  6,  1 say "Sugestao de Compras" + Replicate(" ", 101) ;
               + "Pagina :" + Str(Local1, 3)
            @  7,  1 say Local11
            @  8,  1 say Local4
            @  9,  1 say Local11
            Local2:= 10
            select Grupo
            do while (!EOF())
               ngrupo:= grupo
               Local8:= descricao
               @ Local2,  1 say "" + Local8 + ""
               Local2++
               select Produtos
               seek Str(ngrupo, 2)
               do while (ngrupo == produtos->grupo .AND. !EOF())
                  if (ngrupo != grupo)
                     skip 
                     loop
                  endif
                  nsugestao:= produtos->valor_cust - produtos->estoque
                  ntotal:= nsugestao * Local12
                  ntotalgera:= ntotalgera + ntotal
                  @ Local2,  0 say ""
                  @ Local2,  1 say codigo
                  @ Local2,  8 say descricao
                  @ Local2, 51 say marca
                  @ Local2, 68 say nct
                  @ Local2, 73 say estoque picture "9,999,999.99"
                  @ Local2, 87 say est_maximo picture "9,999,999.99"
                  @ Local2, 98 say nsugestao picture "9,999,999.99"
                  @ Local2, 109 say valor picture "9,999,999.99"
                  @ Local2, 123 say ntotal picture "9,999,999.99"
                  skip 
                  Local2++
                  if (Local2 > nalturafor)
                     rodape(nalturafor, .F., 134)
                     Local1++
                     eject
                     @ PRow(),  0 say ""
                     @  5,  1 say Local5
                     @  6,  1 say "Sugestao de Compras" + ;
                        Replicate(" ", 101) + "Pagina :" + ;
                        Str(Local1, 3)
                     @  7,  1 say Local11
                     @  8,  1 say Local4
                     @  9,  1 say Local11
                     Local2:= 10
                  endif
               enddo
               set order to 1
               select Grupo
               skip 
            enddo
            Local1:= 1
            Local15++
         enddo
         @ Local2 + 0,  0 say ""
         @ Local2 + 0,  0 say Local11
         @ Local2 + 1, 110 say "Total Geral "
         @ Local2 + 1, 122 say ntotalgera picture "9,999,999.99"
      endif
      rodape(nalturafor, .T., 134)
   endif
   set device to screen
   set color to (ccor)
   close databases
   select 1
   close format
   RestScreen(0, 0, 24, 79, ctela)
   return Nil

********************************
function NUMPEDCONT(Arg1, Arg2)

   local Local1
   Local1:= .F.
   select 2
   if (!abredbf("CONTASRE", "CONTRE4.NTX"))
      return .F.
   endif
   select 2
   seek Arg1
   if (Found())
      do while (Arg1 = Str(loja, 2) + Str(dt_emis_re, 5) .AND. !EOF())
         @ nlinha,  9 say dt_venc_re
         @ nlinha, 13 say num_doc_re
         @ nlinha, 28 say val_tit_re
         @ nlinha, 38 say ddt_pgto picture "9,999,999.99"
         @ nlinha, 56 say dt_rece_re
         @ nlinha, 68 say vl_rece_re picture "9,999,999.99"
         skip 
         nlinha++
         if (nlinha > nalturafor)
            cabec(1)
         endif
      enddo
   endif
   select 2
   if (!abredbf("CONTASAR", "CONTAR4.NTX"))
      return .F.
   endif
   select 2
   seek Arg1
   if (Found())
      if (Local1)
         nlinha++
      endif
      do while (Arg1 = Str(loja, 2) + Str(dt_emis_ar, 5) .AND. !EOF())
         @ nlinha,  9 say ctipo
         @ nlinha, 13 say num_doc_ar
         @ nlinha, 28 say dt_venc_ar
         @ nlinha, 38 say val_tit_ar
         skip 
         nlinha++
         if (nlinha > nalturafor)
            cabec(1)
         endif
      enddo
   endif
   select Pedidos
   return

********************************
function QSR4512

   private ccabecalho, nlinha, ccoluna, clinha, cnomemp, vet[2], nloja
   private ngrupo, cnomgrupo, ccodigo, cdescr, nporcvista, impcontasa
   public cnomcli, ccgc, cinsc, cender, ccidade, cuf, cfone, ccep, ;
      ncodcli, cnf, ccond
   set key K_F10 to pesq4512
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   ctipo_nota:= "NF"
   ccabecalho:= 1
   npedido:= 0
   nvias:= 0
   nviaimpr:= 0
   impcontasa:= Replicate("-", 79)
   ncodcli:= 0
   nloja:= 0
   cnf:= "N"
   cconrev:= " "
   cnomcli:= Space(30)
   ccgc:= Space(18)
   cinsc:= Space(17)
   cender:= Space(35)
   ccidade:= Space(20)
   cuf:= Space(2)
   cfone:= Space(13)
   ccep:= Space(10)
   cbair:= Space(23)
   ncodvend:= 0
   ddataultc:= Space(50)
   nlinha:= 8
   ncoluna:= 5
   ctela:= SaveScreen(0, 0, 24, 79)
   vet[1]:= "Sim"
   vet[2]:= "NÆo"
   janela(nlinha, ncoluna, nlinha + 12, ncoluna + 70, ;
      "Reimpressao de Nota Fiscal")
   @ nlinha + 1, ncoluna + 2 say "Numero do Pedido"
   @ nlinha + 3, ncoluna + 1 say "Cliente"
   @ nlinha + 2, ncoluna + 2 get nPedido picture "99999" valid ;
      valpednf(Str(1, 2) + Str(npedido, 5))
   @ nlinha + 3, ncoluna + 1 say ;
      "Consumidor/Revendedor/Atacado (C/R/A) " get cConRev picture ;
      "!" valid cconrev $ "CRA"
   nlinha++
   ddataped:= Date()
   @ nlinha + 4, ncoluna + 1 say "Data"
   @ nlinha + 4, ncoluna + 10 get dDataPed
   @ nlinha + 5, ncoluna + 1 say "Cliente"
   @ nlinha + 5, ncoluna + 10 get nCodCli picture "99999" valid ;
      codpedcli(ncodcli)
   @ nlinha + 6, ncoluna + 1 say "Cgc/Cpf"
   @ nlinha + 6, ncoluna + 32 say "Insc/Ident"
   @ nlinha + 7, ncoluna + 1 say "Endereco"
   @ nlinha + 7, ncoluna + 52 say "CEP"
   @ nlinha + 7, ncoluna + 40 say "Uf"
   @ nlinha + 7, ncoluna + 48 say "Fone"
   @ nlinha + 8, ncoluna + 1 say "Cidade"
   @ nlinha + 9, ncoluna + 1 say "Bairro"
   @ nlinha + 5, ncoluna + 17 get cNomCli picture "@!"
   if (cconrev == "R")
      @ nlinha + 6, ncoluna + 12 get cCGC picture "99.999.999/9999-99"
   else
      @ nlinha + 6, ncoluna + 12 get cCGC
   endif
   @ nlinha + 6, ncoluna + 43 get cInsc
   @ nlinha + 7, ncoluna + 12 get cEnder picture "@!"
   @ nlinha + 7, ncoluna + 57 get cCep picture "99.999-999"
   @ nlinha + 8, ncoluna + 12 get cCidade picture "@!"
   @ nlinha + 8, ncoluna + 43 get cUf picture "!!"
   @ nlinha + 8, ncoluna + 55 get cFone picture "(999)999-9999"
   @ nlinha + 9, ncoluna + 12 get cBair picture "@!"
   read
   if (sai())
      RestScreen(0, 0, 24, 79, ctela)
      close databases
      select 1
      close format
      return .F.
   endif
   lpagina(Str(1, 2) + Str(npedido, 5), npedido)
   close databases
   select 1
   close format
   qsr16i("cNomCli", "cCgc", "cInsc", "cEnder", "cCidade", "cUf", ;
      "cFone", "cCep")
   RestScreen(0, 0, 24, 79, ctela)
   return

********************************
function QSR452

   local Local1, Local2, Local3, Local4, Local5, Local6, Local7, ;
      Local8, Local9, Local10, Local11, Local12, Local13, Local14, ;
      Local15
   private impcontasa, clinha, ccoluna1, cnomemp, vet[2], ;
      tip_doc_ar, grp[999], com[999], qtd[999]
   private ddt_venc, nval_tit, situaca_ar, ddtvenc, nlinha, ncodcli, ;
      nval_rece
   private npag, nvlrece, nlojaped, cchave
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   nlinha:= 1
   cnomemp:= cempresa
   clinha:= ;
      "No.Orc. Data     Cliente                                   Valor  Condicao"
   ccoluna1:= ;
      "Codigo DescriÆo                   Und.   Quantidade   Valor Total"
   tip_doc_ar:= ;
      "Tipo Docto  N§.Docto   Dt Venc    Valor  Data Receb    Valor Receb"
   nvias:= 0
   nviaimpr:= 0
   impcontasa:= Replicate("-", 79)
   ccompleto:= "C"
   val_rece:= 0
   dtrece:= CToD("  /  /  ")
   cimpform:= "N"
   cimpmat:= "N"
   cresumo:= "N"
   nlojaped:= 0
   cchave:= ""
   Local7:= 0
   Local8:= 0
   lcontrole:= .T.
   Local1:= CToD("  /  /  ")
   Local2:= CToD("  /  /  ")
   Local15:= 0
   Local3:= CToD("  /  /  ")
   Local4:= 0
   Local5:= Space(30)
   Local6:= 0
   fonecomp:= 0
   Local10:= Space(1)
   Local11:= 0
   Local12:= 0
   Local13:= 0
   Local14:= Space(7)
   nlinha:= 10
   ncoluna:= 19
   ctela:= SaveScreen(0, 0, 24, 79)
   vet[1]:= "Sim"
   vet[2]:= "NÆo"
   i:= 1
   do while (i < 999)
      grp[i]:= 0
      com[i]:= 0
      qtd[i]:= 0
      i:= i + 1
   enddo
   do while (lcontrole)
      processand(.F.)
      nlinha:= 10
      ncoluna:= 19
      janela(nlinha, ncoluna, nlinha + 10, ncoluna + 47, ;
         " Impressao de Mapa de Caixa ")
      @ nlinha + 1, ncoluna + 2 say "Data Inicial"
      @ nlinha + 1, ncoluna + 20 say "Data Final  "
      @ nlinha + 3, ncoluna + 2 say "Vendedor"
      @ nlinha + 2, ncoluna + 2 get dDtInicio
      @ nlinha + 2, ncoluna + 20 get dDtFim
      @ nlinha + 4, ncoluna + 2 get nVend picture "99999"
      @ nlinha + 5, ncoluna + 2 say ;
         "Completo  Orcamento  Nota fiscal (C/O/N).:" get cCompleto ;
         picture "!" valid ccompleto $ "CON"
      @ nlinha + 6, ncoluna + 2 say ;
         "Imprime somente o RESUMO (S/N)...........:" get cResumo ;
         picture "!" valid cresumo $ "SN"
      @ nlinha + 7, ncoluna + 2 say ;
         "Imprime Formas de Pagamento (S/N)........:" get cImpForm ;
         picture "!" valid cimpform $ "SN" when cresumo = "N"
      @ nlinha + 8, ncoluna + 2 say ;
         "Imprime Materiais (S/N)..................:" get cImpMat ;
         picture "!" valid cimpmat $ "SN" when cresumo = "N"
      read
      if (sai())
         loop
      endif
      if (Local1 == CToD("  /  /  "))
         Local1:= CToD("01/01/01")
      endif
      if (Local2 == CToD("  /  /  "))
         Local2:= CToD("31/12/99")
      endif
      processand(.T.)
      if (fonecomp != 0)
         cnomevend:= procura("FUNCIONA", "FUNCION1", fonecomp, "NOME")
      else
         cnomevend:= "Geral"
      endif
      ccoldata:= "Periodo de " + DToC(Local1) + " a " + DToC(Local2) ;
         + "     " + "Loja : " + Str(Local15, 2) + "  Vendedor : " + ;
         Str(fonecomp, 5) + "  " + cnomevend
      select 1
      if (!abredbf("PEDIDOS", "PEDIDOS3.NTX"))
         loop
      endif
      select 3
      if (!abredbf("PED_MAT", "PED_MAT.NTX"))
         loop
      endif
      select 4
      if (!abredbf("PRODUTOS", "PRODUTO1.NTX"))
         loop
      endif
      select 1
      set filter to Data >= dDtInicio .AND. Data <= dDtFim
      goto top
      if (impressora() == 1)
         set device to printer
         @  0,  0 say "C" + Chr(nlinform)
         npag:= 0
         cabec(0)
         select 1
         goto top
         do while (!EOF())
            if (fonecomp != 0)
               if (pedidos->vendedor != fonecomp)
                  skip 
                  loop
               endif
            endif
            if (ccompleto == "O")
               if (imp_nf == "S")
                  skip 
                  loop
               endif
            elseif (ccompleto == "N")
               if (imp_nf != "S")
                  skip 
                  loop
               endif
            endif
            ncodcli:= cliente
            Local10:= form_pgto
            if (Local10 = "V")
               Local11:= Local11 + valor_tot
               Local14:= "A Vista"
            elseif (Local10 = "P")
               Local12:= Local12 + valor_tot
               Local14:= "A Prazo"
            endif
            Local13:= Local13 + valor_tot
            if (cresumo = "N")
               @ nlinha,  1 say numero
               @ nlinha,  9 say data
               @ nlinha, 18 say nome_cli
               @ nlinha, 50 say valor_tot picture "999,999,999.99"
               @ nlinha, 67 say Local14
            endif
            select 3
            loc:= Str(1, 2) + Str(Local4, 5)
            seek loc
            if (!Found())
               if (cresumo = "N")
                  @ nlinha,  1 say Local4
               endif
            else
               do while (Local4 = numero_ped)
                  Local9:= codigo_mat
                  nquant:= quantidade
                  Local7:= quantidade * valor + desconto + acrescimo
                  Local8:= comissao
                  select 4
                  seek Local9
                  if (!EOF())
                     if (cimpmat = "S")
                        nlinha++
                        @ nlinha,  9 say Local9
                        @ nlinha, 16 say descricao
                        @ nlinha, 47 say nct
                        @ nlinha, 54 say nquant picture "999,999.99"
                        @ nlinha, 66 say Local7 picture ;
                           "999,999,999.99"
                        qtd[grupo]:= qtd[grupo] + nquant
                        if (nlinha > nalturafor)
                           cabec(1)
                        endif
                     endif
                     grp[grupo]:= grp[grupo] + Local7
                     com[grupo]:= com[grupo] + Local8
                  endif
                  select 3
                  skip 
               enddo
            endif
            select 1
            if (cimpform = "S")
               nlinha++
               numpedcont(Str(nlojaped, 2) + Str(Local4, 5), Local4)
            endif
            skip 
            if (cresumo = "N")
               nlinha++
            endif
            if (nlinha > nalturafor)
               cabec(1)
            endif
            Local3:= CToD("  /  /  ")
            Local4:= 0
            Local5:= Space(30)
            Local6:= 0
            Local10:= Space(1)
         enddo
         @ nlinha + 0,  1 say impcontasa
         nlinha++
         i:= 1
         use GRUPO index GRUPO
         nvlrtc:= 0
         do while (i < 999)
            if (grp[i] != 0)
               seek i
               @ nlinha,  0 say i
               @ nlinha, 13 say descricao
               @ nlinha, 44 say qtd[i] picture "99999"
               @ nlinha, 50 say grp[i] picture "999,999,999.99"
               @ nlinha, 67 say com[i] picture "9,999.99"
               nvlrtc:= nvlrtc + com[i]
               nlinha++
            endif
            skip 
            i++
         enddo
         @ nlinha + 0,  1 say impcontasa
         @ nlinha + 1, 32 say "Total a Vista..:"
         @ nlinha + 1, 50 say Local11 picture "999,999,999.99"
         @ nlinha + 2, 32 say "Total a Prazo..:"
         @ nlinha + 2, 50 say Local12 picture "999,999,999.99"
         @ nlinha + 3, 32 say "Total Geral....:"
         @ nlinha + 3, 50 say Local13 picture "999,999,999.99"
         @ nlinha + 3, 67 say nvlrtc picture "9,999.99"
         rodape(nalturafor, .T., 79)
      endif
      lcontrole:= .F.
   enddo
   set device to screen
   set color to (ccor)
   close databases
   select 1
   close format
   nlinha:= 10
   ncoluna:= 19
   RestScreen(0, 0, 24, 79, ctela)
   return Nil

********************************
procedure QSR453

   private ccabecalho, nlinha, ccoluna, clinha, cnomemp, vet[2], ;
      nvalortot, ntoticms
   private ngrupo, cnomgrupo, ccodigo, cdescr, nporcvista, ;
      impcontasa, dinicio
   private nporcprazo, nprecovist, nprecopraz, cunidade, nvias, ;
      nviaimpr
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   ccabecalho:= 1
   nlinha:= 1
   cnomemp:= cempresa
   ccoluna:= "Relatorio de notas fiscais" + Replicate(" ", 39) + ;
      "Pagina :" + Str(ccabecalho, 3)
   clinha:= ;
      "Data      Nota          Valor      Aliquota   Valor do ICMS     Status"
   nvias:= 0
   nviaimpr:= 0
   impcontasa:= Replicate("-", 79)
   nvalortot:= 0
   ntoticms:= 0
   lcontrole:= .T.
   valfr:= CToD(" /  /  ")
   formulario:= 0
   nvalor_nf:= 0
   naliquota:= 0
   nicms:= 0
   dinicio:= Space(1)
   ddtfim:= CToD("  /  /  ")
   dbclearrel:= CToD("  /  /  ")
   ctelefone:= "  "
   ccondestad:= " "
   nlinha:= 10
   ncoluna:= 19
   ctela:= SaveScreen(0, 0, 24, 79)
   vet[1]:= "Sim"
   vet[2]:= "NÆo"
   janela(nlinha, ncoluna, nlinha + 4, ncoluna + 43, ;
      "Relatorio de Notas Fiscais")
   @ nlinha + 1, ncoluna + 2 say "Data inicial"
   @ nlinha + 1, ncoluna + 15 say "Data final"
   @ nlinha + 1, ncoluna + 28 say "Estadual (S/N)"
   do while (lcontrole)
      processand(.F.)
      nlinha:= 10
      ncoluna:= 19
      @ nlinha + 2, ncoluna + 2 get dDtinicio
      @ nlinha + 2, ncoluna + 15 get dDtfim
      @ nlinha + 2, ncoluna + 28 get cCondEstad picture "!" valid ;
         ccondestad $ "SN"
      read
      if (ddtfim == CToD("  /  /  "))
         ddtfim:= CToD("01/01/01")
      endif
      if (dbclearrel == CToD("  /  /   "))
         dbclearrel:= CToD("31/12/99")
      endif
      if (ccondestad = "S")
         ccoldata:= "Periodo de  " + DToC(ddtfim) + "  a  " + ;
            DToC(dbclearrel) + "  " + "Notas Fiscais Estaduais"
      else
         ccoldata:= "Periodo de  " + DToC(ddtfim) + "  a  " + ;
            DToC(dbclearrel) + "  " + "Notas Fiscais Interestaduais"
      endif
      if (sai())
         loop
      endif
      processand(.T.)
      if (!abredbf("NOTA_FIS", "NOTA2.NTX"))
         loop
      endif
      set filter to Data >= dDtInicio .AND. Data <= dDtFim
      if (impressora() == 1)
         set device to printer
         @  0,  0 say "C" + Chr(nlinform)
         @  1,  1 say "" + cnomemp + ""
         @  2,  1 say "Relatorio de Notas Fiscais" + Replicate(" ", ;
            39) + "Pagina :" + Str(ccabecalho, 3)
         @  3,  1 say ccoldata
         @  4,  1 say impcontasa
         @  5,  1 say clinha
         @  6,  1 say impcontasa
         nlinha:= 7
         select Nota_fis
         goto top
         do while (!EOF())
            if (ccondestad = "S")
               if (Upper(ferase) != "GO")
                  skip 
                  loop
               endif
            elseif (Upper(ferase) = "GO")
               skip 
               loop
            endif
            @ nlinha,  1 say data
            @ nlinha, 11 say pedido picture "99999"
            @ nlinha, 17 say icms picture "999,999,999.99"
            @ nlinha, 36 say nvalicm picture "99"
            @ nlinha, 46 say estado picture "999,999,999.99"
            @ nlinha, 65 say identidade
            if (dinicio = "C")
               @ nlinha, 65 say "CANCELADA"
            else
               nvalortot:= nvalortot + nvalor_nf
               ntoticms:= ntoticms + nicms
            endif
            nlinha++
            skip 
            if (nlinha > nalturafor)
               rodape(nalturafor, .F., 79)
               ccabecalho++
               nlinha:= 7
               eject
               @  1,  1 say "" + cnomemp + ""
               @  2,  1 say "Relatorio de Notas  fiscais" + ;
                  Replicate(" ", 39) + "Pagina :" + Str(ccabecalho, 3)
               @  3,  1 say ccoldata
               @  4,  1 say impcontasa
               @  5,  1 say clinha
               @  6,  1 say impcontasa
            endif
            valfr:= CToD(" /  /   ")
            cnota:= 0
            nvalor_nf:= 0
            naliquota:= 0
            nicms:= 0
            dinicio:= Space(1)
         enddo
         @ nlinha + 0,  1 say impcontasa
         @ nlinha + 1,  1 say "Totais "
         @ nlinha + 1, 17 say nvalortot picture "999,999,999.99"
         @ nlinha + 1, 46 say ntoticms picture "999,999,999.99"
         rodape(nalturafor, .T., 79)
      endif
      lcontrole:= .F.
   enddo
   lcontrole:= .F.
   set device to screen
   set color to (ccor)
   close databases
   select 1
   close format
   RestScreen(0, 0, 24, 79, ctela)
   return

********************************
function QSR455

   private nlinha, ncodcli, nval_rece, cchave, nloja, formulario
   private ccond, impcontasa, ccabecalho, cnomemp, clinha, tip_doc_ar
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   ccabecalho:= 1
   nlinha:= 1
   cnomemp:= cempresa
   Static15:= "Relatorio do Movimento de caixa" + Replicate(" ", 36) ;
      + "Pagina :" + Str(ccabecalho, 3)
   clinha:= ;
      "Data     Pedido  Cliente                                            Valor Total"
   tip_doc_ar:= ;
      " Codigo   Descricao                              Quantidade       Valor         Total"
   nvias:= 0
   nviaimpr:= 0
   impcontasa:= Replicate("-", 79)
   cchave:= ""
   ccond:= "A"
   ntoticms:= 0
   Static23:= 0
   cimpprod:= "S"
   cimpend:= "N"
   lcontrole:= .T.
   Static17:= CToD("  /  /  ")
   Static18:= CToD("  /  /  ")
   nloja:= 0
   Static19:= CToD("  /  /  ")
   Static20:= 0
   Static21:= Space(30)
   Static22:= 0
   ncodigo:= 0
   nlinha:= 10
   ncoluna:= 19
   ctela:= SaveScreen(0, 0, 24, 79)
   Static16[1]:= "Sim"
   Static16[2]:= "NÆo"
   do while (lcontrole)
      processand(.F.)
      nlinha:= 10
      ncoluna:= 19
      set color to (corfor)
      @ nlinha, ncoluna clear to nlinha + 9, ncoluna + 47
      @ nlinha, ncoluna to nlinha + 9, ncoluna + 47
      set color to (cortitfor)
      @ nlinha, ncoluna + 7 say " Impressao de Pedidos em Entrega "
      set color to (corfordado)
      @ nlinha + 1, ncoluna + 2 say "Data Inicial"
      @ nlinha + 1, ncoluna + 20 say "Data Final  "
      @ nlinha + 1, ncoluna + 33 say "Loja "
      @ nlinha + 3, ncoluna + 2 say "Entregador"
      @ nlinha + 3, ncoluna + 15 say "Entregue ou A entregar (E/A) ?"
      @ nlinha + 5, ncoluna + 2 say ;
         "Imprime as Mercadoriasdo Pedido (S/N) ?"
      @ nlinha + 7, ncoluna + 2 say ;
         "Imprime o Endereco do cliente (S/N) ?"
      @ nlinha + 2, ncoluna + 2 get dDtInicio
      @ nlinha + 2, ncoluna + 20 get dDtFim
      @ nlinha + 2, ncoluna + 33 get nLoja picture "99"
      @ nlinha + 4, ncoluna + 2 get nCodigo picture "99999"
      @ nlinha + 4, ncoluna + 15 get cCond picture "!" valid ccond $ ;
         "EA"
      @ nlinha + 6, ncoluna + 2 get cImpProd picture "!" valid ;
         cimpprod $ "SN"
      @ nlinha + 8, ncoluna + 2 get cImpEnd picture "!" valid ;
         cimpend $ "SN"
      read
      if (LastKey() == K_ESC)
         nresp:= ;
            alert("Abandona Relatorio de Pedidos entrgues e a entregar ?", ;
            Static16)
         if (nresp == 2)
            loop
         else
            lcontrole:= .F.
            loop
         endif
      endif
      processand(.T.)
      if (Static17 == CToD("  /  /  "))
         Static17:= CToD("01/01/01")
      endif
      if (Static18 == CToD("  /  /  "))
         Static18:= CToD("31/12/99")
      endif
      if (ccond == "E")
         ccoldata:= "Periodo de " + DToC(Static17) + " a " + ;
            DToC(Static18) + "     " + "Loja : " + Str(nloja, 2) + ;
            "  Situacao : Entregue"
      else
         ccoldata:= "Periodo de " + DToC(Static17) + " a " + ;
            DToC(Static18) + "     " + "Loja : " + Str(nloja, 2) + ;
            "  Situacao : A Entregar"
      endif
      ncont:= 0
      do while (.T.)
         select 1
         use Funciona shared index Funcion1
         if (ncont > 3)
            alert("Erro na abertura de arquivo! Operao ser  cancelada.")
            lcontrole:= .F.
         endif
         if (neterr())
            InKey(2)
            ncont++
            loop
         else
            exit
         endif
      enddo
      if (!lcontrole)
         loop
      endif
      if (ncodigo != 0)
         seek ncodigo
         if (Found())
            cnomefun:= nome
         else
            cnomefun:= "Funcionario nao cadastrado"
         endif
      else
         cnomefun:= "Entregadores em Geral"
      endif
      ncont:= 0
      do while (.T.)
         select 2
         use Clientes shared index Cliente1
         if (ncont > 3)
            alert("Erro na abertura de arquivo! Operao ser  cancelada.")
            lcontrole:= .F.
         endif
         if (neterr())
            InKey(2)
            ncont++
            loop
         else
            exit
         endif
      enddo
      if (!lcontrole)
         loop
      endif
      ncont:= 0
      do while (.T.)
         select 1
         use Pedidos shared index Pedidos3
         if (ncont > 3)
            alert("Erro na abertura de arquivo! Operao ser  cancelada.")
            lcontrole:= .F.
         endif
         if (neterr())
            InKey(2)
            ncont++
            loop
         else
            exit
         endif
      enddo
      if (!lcontrole)
         loop
      endif
      if (nloja != 0)
         set filter to Loja = nLoja
      endif
      goto top
      if (impressora() == 1)
         set device to printer
         @  0,  0 say "C" + Chr(nlinform)
         @  1,  1 say "" + cnomemp + ""
         @  1,  1 say ""
         @  2,  1 say "Relatorio de Pedidos em Situacao de Entrega" ;
            + Replicate(" ", 20) + "Pagina :" + Str(ccabecalho, 3)
         @  3,  1 say ccoldata
         @  4,  1 say "Entregador :" + cnomefun
         @  5,  1 say impcontasa
         @  6,  1 say clinha
         @  7,  1 say tip_doc_ar
         @  8,  1 say impcontasa
         nlinha:= 9
         select Pedidos
         goto top
         set softseek on
         seek Static17
         set softseek off
         do while (!EOF() .AND. data <= Static18 .AND. data >= ;
               Static17)
            ddtent:= dt_entrega
            if (ddtent = CToD("  /  /  "))
               if (ccond = "E")
                  skip 
                  loop
               endif
            endif
            if (dt_entrega != CToD("  /  /  "))
               if (ccond = "A")
                  skip 
                  loop
               endif
            endif
            if (ncodigo != 0)
               if (entregador != ncodigo)
                  skip 
                  loop
               endif
            endif
            Static20:= numero
            Static19:= data
            ncodcli:= cliente
            Static21:= nome_cli
            Static22:= valor_tot
            nlojaped:= loja
            Static23:= Static23 + valor_tot
            @ nlinha,  1 say Static19
            @ nlinha, 11 say Static20
            @ nlinha, 25 say Str(ncodcli, 5) + "-" + Static21
            @ nlinha, 64 say Static22 picture "999,999,999.99"
            @ nlinha,  1 say Static19
            @ nlinha, 11 say Static20
            @ nlinha, 25 say Str(ncodcli, 5) + "-" + Static21
            @ nlinha, 64 say Static22 picture "999,999,999.99"
            cchave:= Str(nlojaped, 2) + Str(Static20, 5)
            if (cimpprod == "S")
               impprodent(cchave)
            endif
            if (cimpend = "S")
               impend(ncodcli)
            endif
            select Pedidos
            skip 
            nlinha++
            if (nlinha > nalturafor)
               rodape(nalturafor, .F., 134)
               ccabecalho++
               nlinha:= 9
               eject
               @  1,  1 say "" + cnomemp + ""
               @  1,  1 say ""
               @  2,  1 say ;
                  "Relatorio de Pedidos em Situacao de Entrega" + ;
                  Replicate(" ", 20) + "Pagina :" + Str(ccabecalho, 3)
               @  3,  1 say ccoldata
               @  4,  1 say "Entregador :" + cnomefun
               @  5,  1 say impcontasa
               @  6,  1 say clinha
               @  7,  1 say tip_doc_ar
               @  8,  1 say impcontasa
            endif
            Static19:= CToD("  /  /  ")
            Static20:= 0
            Static21:= Space(30)
            Static22:= 0
         enddo
         @ nlinha + 0,  1 say impcontasa
         @ nlinha + 1, 32 say "Total Geral....:"
         @ nlinha + 1, 50 say Static23 picture "999,999,999.99"
         rodape(nalturafor, .T., 134)
      endif
      lcontrole:= .F.
   enddo
   set device to screen
   set color to (ccor)
   close databases
   select 1
   close format
   nlinha:= 10
   ncoluna:= 19
   RestScreen(0, 0, 24, 79, ctela)
   return Nil

********************************
procedure IMPEND(Arg1)

   nlinha++
   if (nlinha > nalturafor)
      rodape(nalturafor, .F., 134)
      ccabecalho++
      nlinha:= 9
      eject
      @  1,  1 say "" + cnomemp + ""
      @  1,  1 say ""
      @  2,  1 say "Relatorio de Pedidos em Situacao de Entrega" + ;
         Replicate(" ", 20) + "Pagina :" + Str(ccabecalho, 3)
      @  3,  1 say ccoldata
      @  4,  1 say "Entregador :" + cnomefun
      @  5,  1 say impcontasa
      @  6,  1 say clinha
      @  7,  1 say tip_doc_ar
      @  8,  1 say impcontasa
   endif
   carea:= Select()
   select Clientes
   seek Arg1
   if (Found())
      @ nlinha,  1 say ;
         "Endereco                           Bairro         Cidade                      UF  Fone          CEP"
      nlinha++
      if (nlinha > nalturafor)
         rodape(nalturafor, .F., 134)
         ccabecalho++
         nlinha:= 9
         eject
         @  1,  1 say "" + cnomemp + ""
         @  1,  1 say ""
         @  2,  1 say "Relatorio de Pedidos em Situacao de Entrega" ;
            + Replicate(" ", 20) + "Pagina :" + Str(ccabecalho, 3)
         @  3,  1 say ccoldata
         @  4,  1 say "Entregador :" + cnomefun
         @  5,  1 say impcontasa
         @  6,  1 say clinha
         @  7,  1 say tip_doc_ar
         @  8,  1 say impcontasa
      endif
      @ nlinha,  1 say endere_cli
      @ nlinha, 36 say bairro_cli
      @ nlinha, 51 say cidade_cli
      @ nlinha, 79 say estado_cli
      @ nlinha, 83 say fone_cli
      @ nlinha, 97 say cep_cli
      nlinha++
      if (nlinha > nalturafor)
         rodape(nalturafor, .F., 134)
         ccabecalho++
         nlinha:= 9
         eject
         @  1,  1 say "" + cnomemp + ""
         @  1,  1 say ""
         @  2,  1 say "Relatorio de Pedidos em Situacao de Entrega" ;
            + Replicate(" ", 20) + "Pagina :" + Str(ccabecalho, 3)
         @  3,  1 say ccoldata
         @  4,  1 say "Entregador :" + cnomefun
         @  5,  1 say impcontasa
         @  6,  1 say clinha
         @  7,  1 say tip_doc_ar
         @  8,  1 say impcontasa
      endif
      @ nlinha,  1 say impcontasa
   endif
   select (carea)
   return

********************************
function QSR60

   private ccabecalho, nlinha, ccoluna, clinha, cnomemp, vet[2]
   private impcontasa, nagencia, cbanco, valfr, chistor, cdocto, ;
      chistorico
   private nsaldocon, nsaldoconf, cdebcred, cconf
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   lcontrole:= .T.
   nlinha:= 10
   ncoluna:= 10
   ctela:= SaveScreen(0, 0, 24, 79)
   nconta:= 0
   vet[1]:= "Sim"
   vet[2]:= "NÆo"
   cnome:= Space(30)
   ccgc:= Space(14)
   ccaminho:= Space(40)
   janela(nlinha, ncoluna, nlinha + 8, ncoluna + 70, ;
      "INCLUSAO DE NOVA EMPRESA NO SISTEMA")
   nlinha++
   @ nlinha, ncoluna + 2 say "Nome"
   @ nlinha + 2, ncoluna + 2 say "CGC"
   @ nlinha + 4, ncoluna + 2 say "Caminho"
   do while (lcontrole)
      processand(.F.)
      @ nlinha + 1, ncoluna + 2 get cNome picture "@!"
      @ nlinha + 3, ncoluna + 2 get cCgc picture "99999999999999" ;
         valid valemp()
      read
      @ nlinha + 5, ncoluna + 2 get cCaminho picture "@!"
      read
      if (sai())
         loop
      endif
      lcontrole:= .F.
   enddo
   set color to (ccor)
   close databases
   select 1
   close format
   RestScreen(0, 0, 24, 79, ctela)
   return Nil

********************************
function QSR456

   private nlinha, ncodcli, nval_rece, cchave, nloja, formulario
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   Static24:= 1
   nlinha:= 1
   Static27:= cempresa
   Static25:= "Relatorio do Movimento de caixa" + Replicate(" ", 36) ;
      + "Pagina :" + Str(Static24, 3)
   Static26:= ;
      "Data     Pedido  Cliente                                            Valor Total"
   Static29:= ;
      " Codigo   Descricao                              Quantidade       Valor         Total"
   nvias:= 0
   nviaimpr:= 0
   Static30:= Replicate("-", 79)
   cchave:= ""
   ccond:= "A"
   ntoticms:= 0
   Static37:= 0
   cimpprod:= "S"
   lcontrole:= .T.
   Static31:= CToD("  /  /  ")
   Static32:= CToD("  /  /  ")
   nloja:= 0
   Static33:= CToD("  /  /  ")
   Static34:= 0
   Static35:= Space(30)
   Static36:= 0
   ncodigo:= 0
   nlinha:= 10
   ncoluna:= 19
   ctela:= SaveScreen(0, 0, 24, 79)
   Static28[1]:= "Sim"
   Static28[2]:= "NÆo"
   do while (lcontrole)
      processand(.F.)
      nlinha:= 10
      ncoluna:= 19
      set color to (corfor)
      @ nlinha, ncoluna clear to nlinha + 7, ncoluna + 47
      @ nlinha, ncoluna to nlinha + 7, ncoluna + 47
      set color to (cortitfor)
      @ nlinha, ncoluna + 6 say " Impressao de Pedidos em Cobranca "
      set color to (corfordado)
      @ nlinha + 1, ncoluna + 2 say "Data Inicial"
      @ nlinha + 1, ncoluna + 20 say "Data Final  "
      @ nlinha + 1, ncoluna + 33 say "Loja "
      @ nlinha + 3, ncoluna + 2 say "Cobrador"
      @ nlinha + 3, ncoluna + 15 say "Cobrado ou A Cobrar (C/A) ?"
      @ nlinha + 5, ncoluna + 2 say ;
         "Imprime mercadorias do Pedido (S/N) ?"
      @ nlinha + 2, ncoluna + 2 get dDtInicio
      @ nlinha + 2, ncoluna + 20 get dDtFim
      @ nlinha + 2, ncoluna + 33 get nLoja picture "99"
      @ nlinha + 4, ncoluna + 2 get nCodigo picture "99999"
      @ nlinha + 4, ncoluna + 15 get cCond picture "!" valid ccond $ ;
         "CA"
      @ nlinha + 6, ncoluna + 2 get cImpProd picture "!" valid ;
         cimpprod $ "SN"
      read
      if (LastKey() == K_ESC)
         nresp:= alert("Abandona Relatorio movimento do caixa ?", ;
            Static28)
         if (nresp == 2)
            loop
         else
            lcontrole:= .F.
            loop
         endif
      endif
      processand(.T.)
      if (Static31 == CToD("  /  /  "))
         Static31:= CToD("01/01/01")
      endif
      if (Static32 == CToD("  /  /  "))
         Static32:= CToD("31/12/99")
      endif
      if (ccond == "E")
         ccoldata:= "Periodo de " + DToC(Static31) + " a " + ;
            DToC(Static32) + "     " + "Loja : " + Str(nloja, 2) + ;
            "  Situacao : Cobrado"
      else
         ccoldata:= "Periodo de " + DToC(Static31) + " a " + ;
            DToC(Static32) + "     " + "Loja : " + Str(nloja, 2) + ;
            "  Situacao : A Cobrar"
      endif
      if (Static31 == CToD("01/01/01"))
         Static31:= CToD("  /  /  ")
      endif
      ncont:= 0
      do while (.T.)
         select 1
         use Funciona shared index Funcion1
         if (ncont > 3)
            alert("Erro na abertura de arquivo! Operao ser  cancelada.")
            lcontrole:= .F.
         endif
         if (neterr())
            InKey(2)
            ncont++
            loop
         else
            exit
         endif
      enddo
      if (!lcontrole)
         loop
      endif
      if (ncodigo != 0)
         seek ncodigo
         if (Found())
            cnomefun:= nome
         else
            cnomefun:= "Funcionario nao cadastrado"
         endif
      else
         cnomefun:= "Cobradores em Geral"
      endif
      ncont:= 0
      do while (.T.)
         select 1
         use Pedidos shared index Pedidos3
         if (ncont > 3)
            alert("Erro na abertura de arquivo! Operao ser  cancelada.")
            lcontrole:= .F.
         endif
         if (neterr())
            InKey(2)
            ncont++
            loop
         else
            exit
         endif
      enddo
      if (!lcontrole)
         loop
      endif
      goto top
      if (impressora() == 1)
         set device to printer
         @  0,  0 say "C" + Chr(nlinform)
         @  1,  1 say "" + Static27 + ""
         @  1,  1 say ""
         @  2,  1 say "Relatorio de Pedidos em Situacao de Cobranca" ;
            + Replicate(" ", 20) + "Pagina :" + Str(Static24, 3)
         @  3,  1 say ccoldata
         @  4,  1 say "Cobrador : " + cnomefun
         @  5,  1 say Static30
         @  6,  1 say Static26
         @  7,  1 say Static29
         @  8,  1 say Static30
         nlinha:= 9
         select Pedidos
         goto top
         set softseek on
         seek Static31
         set softseek off
         do while (!EOF() .AND. data <= Static32 .AND. data >= ;
               Static31)
            if (ncodigo != 0)
               if (pedidos->cobrador != ncodigo)
                  skip 
                  loop
               endif
            endif
            if (pedidos->dt_cobranc = CToD(" /  /  "))
               if (ccond == "C")
                  skip 
                  loop
               endif
            endif
            if (pedidos->dt_cobranc != CToD(" /  /  "))
               if (ccond == "A")
                  skip 
                  loop
               endif
            endif
            Static34:= numero
            Static33:= data
            ncodcli:= cliente
            Static35:= nome_cli
            Static36:= valor_tot
            nlojaped:= loja
            Static37:= Static37 + valor_tot
            @ nlinha,  1 say Static33
            @ nlinha, 11 say Static34
            @ nlinha, 25 say Str(ncodcli, 5) + "-" + Static35
            @ nlinha, 64 say Static36 picture "999,999,999.99"
            @ nlinha,  1 say Static33
            @ nlinha, 10 say Static34
            @ nlinha, 18 say Str(ncodcli, 5) + "-" + Static35
            @ nlinha, 67 say Static36 picture "999,999,999.99"
            cchave:= Str(nlojaped, 2) + Str(Static34, 5)
            if (cimpprod == "S")
               impprodent(cchave)
            endif
            select Pedidos
            skip 
            nlinha++
            if (nlinha > nalturafor)
               rodape(nalturafor, .F., 134)
               Static24++
               nlinha:= 9
               eject
               @  1,  1 say "" + Static27 + ""
               @  1,  1 say ""
               @  2,  1 say ;
                  "Relatorio de Pedidos em Situacao de Cobranca" + ;
                  Replicate(" ", 20) + "Pagina :" + Str(Static24, 3)
               @  3,  1 say ccoldata
               @  4,  1 say "Entregador :" + cnomefun
               @  5,  1 say Static30
               @  6,  1 say Static26
               @  7,  1 say Static29
               @  8,  1 say Static30
            endif
            Static33:= CToD("  /  /  ")
            Static34:= 0
            Static35:= Space(30)
            Static36:= 0
         enddo
         @ nlinha + 0,  1 say Static30
         @ nlinha + 1, 32 say "Total Geral....:"
         @ nlinha + 1, 50 say Static37 picture "999,999,999.99"
         rodape(nalturafor, .T., 134)
      endif
      lcontrole:= .F.
   enddo
   set device to screen
   set color to (ccor)
   close databases
   select 1
   close format
   nlinha:= 10
   ncoluna:= 19
   RestScreen(0, 0, 24, 79, ctela)
   return Nil

********************************
function QSR461

   private ccabecalho, nlinha, ccoluna, clinha, cnomemp, vet[2]
   private ncodigo, cdescr, nporcvista, impcontasa, cnomefun
   cpesquisa:= {"FUNCIONA", "FUNCION2", "CODIGO_FUN", "nCodigo"}
   ccampos:= {"CODIGO_FUN", "NOME", "", "CODIGO", "NOME", ""}
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   ccabecalho:= 1
   nlinha:= 1
   cnomemp:= cempresa
   ccoluna:= "Relatorio de Saldos Funcionarios" + Replicate(" ", 35) ;
      + "Pagina :" + Str(ccabecalho, 3)
   clinha:= ;
      "Codigo   Nome do Funcionario                               Saldo    Saldo Conf."
   nvias:= 0
   nviaimpr:= 0
   impcontasa:= Replicate("-", 79)
   lcontrole:= .T.
   ncodigo:= 0
   cnomefun:= Space(30)
   nsaldocon:= 0
   nsaldoconf:= 0
   nlinha:= 10
   ncoluna:= 19
   ctela:= SaveScreen(0, 0, 24, 79)
   vet[1]:= "Sim"
   vet[2]:= "NÆo"
   janela(nlinha, ncoluna, nlinha + 6, ncoluna + 43, ;
      " Relatorio de Saldos de Funcionarios ")
   @ nlinha + 1, ncoluna + 2 say "Codigo"
   do while (lcontrole)
      nlinha:= 10
      ncoluna:= 19
      processand(.F.)
      @ nlinha + 2, ncoluna + 2 get nCodigo picture "99999"
      read
      if (sai())
         loop
      endif
      processand(.T.)
      if (!abredbf("FUNCIONA", "FUNCION2.NTX"))
         loop
      endif
      if (Empty(ncodigo))
      elseif (!Empty(ncodigo))
         set filter to Codigo_Fun == nCodigo
      endif
      if (impressora() == 1)
         set device to printer
         @  0,  0 say "C" + Chr(nlinform)
         @  1,  1 say "" + cnomemp + ""
         @  2,  1 say "Relatorio de Saldos Funcionarios" + ;
            Replicate(" ", 35) + "Pagina :" + Str(ccabecalho, 3)
         @  3,  1 say impcontasa
         @  4,  1 say clinha
         @  5,  1 say impcontasa
         nlinha:= 6
         select Funciona
         goto top
         do while (!EOF())
            ncodigo:= qsr23i->est_civil
            cnomefun:= qsr23i->nome
            nsaldocon:= qsr23i->saldo
            nsaldoconf:= qsr23i->saldo_conf
            @ nlinha,  1 say LTrim(Str(ncodigo))
            @ nlinha, 10 say cnomefun
            @ nlinha, 51 say nsaldocon picture "999,999,999.99"
            @ nlinha, 66 say nsaldoconf picture "999,999,999.99"
            skip 
            nlinha++
            if (nlinha > nalturafor)
               rodape(nalturafor, .F., 79)
               ccabecalho++
               nlinha:= 6
               eject
               @  1,  1 say "" + cnomemp + ""
               @  2,  1 say "Relatorio de Saldos Funcionarios" + ;
                  Replicate(" ", 35) + "Pagina :" + Str(ccabecalho, 3)
               @  3,  1 say impcontasa
               @  4,  1 say clinha
               @  5,  1 say impcontasa
            endif
            ncodigo:= 0
            cnomefun:= Space(30)
            nsaldocon:= 0
            nsaldoconf:= 0
         enddo
      endif
      lcontrole:= .F.
   enddo
   rodape(nalturafor, .T., 79)
   set device to screen
   set color to (ccor)
   close databases
   select 1
   close format
   RestScreen(0, 0, 24, 79, ctela)
   return Nil

********************************
function QSR462

   private ccabecalho, nlinha, ccoluna, clinha, cnomemp, vet[2]
   private impcontasa, nagencia, cbanco, valfr, chistor, cdocto, ;
      chistorico
   private nsaldocon, nsaldoconf, cdebcred, cconf
   cpesquisa:= {"FUNCIONA", "FUNCION2", "CODIGO_FUN", "nCodigo"}
   ccampos:= {"CODIGO_FUN", "NOME", "", "CODIGO", "NOME", ""}
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   ccabecalho:= 1
   nlinha:= 1
   cnomemp:= cempresa
   ccoluna:= "Relatorio de Extrato Funcionarios" + Replicate(" ", ;
      89) + "Pagina :" + Str(ccabecalho, 3)
   clinha:= ;
      "Data     Historico                       Documento  Deb/Cred           Valor                  Saldo     Saldo Conf."
   impcontasa:= Replicate("-", 134)
   lcontrole:= .T.
   ncodigo:= 0
   nagencia:= Space(30)
   valfr:= CToD("  /  /  ")
   chistor:= Space(30)
   cdocto:= Space(8)
   chistorico:= " "
   cdebcred:= 0
   cconf:= " "
   nsaldocon:= 0
   nsaldoconf:= 0
   nsaldoinic:= 0
   nlinha:= 10
   ncoluna:= 19
   ctela:= SaveScreen(0, 0, 24, 79)
   vet[1]:= "Sim"
   vet[2]:= "NÆo"
   ncodigo:= 0
   ddtfim:= CToD("  /  /  ")
   dbclearrel:= CToD("  /  /  ")
   vet[1]:= "Sim"
   vet[2]:= "NÆo"
   janela(nlinha, ncoluna, nlinha + 6, ncoluna + 43, ;
      "Relatorio de Movimento Funcionarios ")
   nlinha++
   @ nlinha, ncoluna + 2 say "Codigo"
   @ nlinha + 2, ncoluna + 2 say "Data Inicial"
   @ nlinha + 2, ncoluna + 19 say "Data Final  "
   do while (lcontrole)
      processand(.F.)
      @ nlinha + 1, ncoluna + 2 get nCodigo picture "99999" valid ;
         valcodi463(ncodigo)
      @ nlinha + 3, ncoluna + 2 get dDtInicio
      @ nlinha + 3, ncoluna + 19 get dDtFim
      read
      if (ddtfim == CToD("  /  /  "))
         ddtfim:= CToD("01/01/01")
      endif
      if (dbclearrel == CToD("  /  /  "))
         dbclearrel:= CToD("31/12/99")
      endif
      ccoldata:= "Periodo  de  " + DToC(ddtfim) + "   a   " + ;
         DToC(dbclearrel)
      if (sai())
         loop
      endif
      processand(.T.)
      if (!abredbf("MOV_FUN"))
         loop
      endif
      set index to MV_FUN2, MV_FUN3
      do while (!EOF() .AND. mov_fun->data < ddtfim)
         if (codigo = ncodigo)
            if (mov_fun->debcred = "C")
               nsaldocon:= nsaldocon + valor
               if (confirmado = "S")
                  nsaldoconf:= nsaldoconf + valor
               endif
            elseif (mov_fun->debcred = "D")
               nsaldocon:= nsaldocon - valor
               if (confirmado = "S")
                  nsaldoconf:= nsaldoconf - valor
               endif
            endif
         endif
         skip 
      enddo
      set filter to Data >= dDtInicio .AND. Data <= dDtFim .AND. ;
         Codigo == nCodigo
      select 2
      if (!abredbf("FUNCIONA", "FUNCION1.NTX"))
         loop
      endif
      seek ncodigo
      if (Found())
         nagencia:= "Conta : " + LTrim(Str(ncodigo, 5)) + "  " + ;
            qsr23i->nome
      endif
      close
      if (impressora() == 1)
         set device to printer
         @  0,  0 say "C" + Chr(nlinform)
         @  0,  0 say ""
         @  1,  1 say "" + cnomemp + ""
         @  1,  1 say ""
         @  2,  1 say "Relatorio de Extrato Funcionarios" + ;
            Replicate(" ", 89) + "Pagina :" + Str(ccabecalho, 3)
         @  3,  1 say ccoldata
         @  4,  1 say impcontasa
         @  5,  1 say nagencia
         @  6,  1 say clinha
         @  7,  1 say impcontasa
         nlinha:= 8
         @ nlinha,  1 say "Saldo Inicial "
         @ nlinha,  1 say "Saldo Inicial "
         @ nlinha, 86 say nsaldocon picture "999,999,999.99"
         @ nlinha, 102 say nsaldoconf picture "999,999,999.99"
         nlinha++
         select Mov_Fun
         goto top
         do while (!EOF())
            if (debcred == "C")
               nsaldocon:= nsaldocon + valor
               if (cconf == "S")
                  nsaldoconf:= nsaldoconf + valor
               endif
            elseif (debcred == "D")
               nsaldocon:= nsaldocon - valor
               if (cconf == "S")
                  nsaldoconf:= nsaldoconf - valor
               endif
            endif
            @ nlinha,  1 say data
            @ nlinha, 10 say qsr22a
            @ nlinha, 42 say historico
            @ nlinha, 53 say debcred
            @ nlinha, 66 say valor picture "999,999,999.99"
            @ nlinha, 86 say nsaldocon picture "999,999,999.99"
            @ nlinha, 102 say nsaldoconf picture "999,999,999.99"
            skip 
            nlinha++
            if (nlinha > nalturafor)
               rodape(nalturafor, .F., 134)
               ccabecalho++
               nlinha:= 7
               eject
               @  0,  0 say ""
               @  1,  1 say "" + cnomemp + ""
               @  1,  1 say ""
               @  2,  1 say "Relatorio de Extrato Funcionarios" + ;
                  Replicate(" ", 89) + "Pagina :" + Str(ccabecalho, 3)
               @  3,  1 say impcontasa
               @  4,  1 say nagencia
               @  5,  1 say clinha
               @  6,  1 say impcontasa
            endif
            valfr:= CToD("  /  /  ")
            chistor:= Space(30)
            cdocto:= Space(8)
            chistorico:= " "
            cdebcred:= 0
            cconf:= " "
         enddo
         @ nlinha,  1 say impcontasa
         @ nlinha + 1, 63 say "Saldos do periodo :"
         @ nlinha + 1, 86 say nsaldocon picture "999,999,999.99"
         @ nlinha + 1, 102 say nsaldoconf picture "999,999,999.99"
         rodape(nalturafor, .T., 134)
         @ nlinha + 1,  0 say ""
         @ nlinha + 1,  0 say ""
         set device to screen
      endif
      lcontrole:= .F.
   enddo
   set color to (ccor)
   close databases
   select 1
   close format
   RestScreen(0, 0, 24, 79, ctela)
   return Nil

********************************
function QSR463

   private ccabecalho, ccoluna, clinha, cnomemp, vet[2], tip_doc_ar
   private impcontasa, ddtfim, dbclearrel, valfr, observacao, ;
      cnomecli, cdebcred, nvalcomis
   private ntotval, ccompleto, nlinha, nloja, cnomemat, ngrupo, ;
      nvalprod
   private ntotcomis, ncomissao
   cpesquisa:= {"FUNCIONA", "FUNCION2", "CODIGO_FUN", "nCodigo"}
   ccampos:= {"CODIGO_FUN", "NOME", "", "CODIGO", "NOME", ""}
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   ccabecalho:= 1
   nlinha:= 1
   cnomemp:= cempresa
   ccoluna:= "Relatorio do Listagem de Comissao" + Replicate(" ", ;
      34) + "Pagina :" + Str(ccabecalho, 3)
   tip_doc_ar:= ;
      "Data    No.Orc.  Cliente                              Valor    Aliq   Val.Comis"
   clinha:= ""
   nvias:= 0
   nviaimpr:= 0
   impcontasa:= Replicate("-", 79)
   ccompleto:= "C"
   lcontrole:= .T.
   ddtfim:= CToD("  /  /  ")
   dbclearrel:= CToD("  /  /  ")
   nloja:= 0
   valfr:= CToD("  /  /  ")
   observacao:= 0
   cnomecli:= Space(30)
   cdebcred:= 0
   ntotval:= 0
   nvalprod:= 0
   nvalcomis:= 0
   ntotcomis:= 0
   ncodigo:= 0
   nlinha:= 10
   ncoluna:= 19
   ctela:= SaveScreen(0, 0, 24, 79)
   vet[1]:= "Sim"
   vet[2]:= "NÆo"
   do while (lcontrole)
      processand(.F.)
      nlinha:= 10
      ncoluna:= 19
      janela(nlinha, ncoluna, nlinha + 6, ncoluna + 47, ;
         " Impressao de Listagem de Comissao ")
      @ nlinha + 1, ncoluna + 2 say "Data Inicial"
      @ nlinha + 1, ncoluna + 20 say "Data Final  "
      @ nlinha + 1, ncoluna + 33 say "Vendedor "
      @ nlinha + 3, ncoluna + 2 say ;
         "Completo  Orcamento  Nota fiscal (C/O/N) "
      @ nlinha + 2, ncoluna + 2 get dDtInicio
      @ nlinha + 2, ncoluna + 20 get dDtFim
      @ nlinha + 2, ncoluna + 33 get nCodigo picture "99999" valid ;
         valcodi463(ncodigo)
      @ nlinha + 4, ncoluna + 2 get cCompleto picture "!" valid ;
         ccompleto $ " CON"
      read
      if (sai())
         loop
      endif
      processand(.T.)
      if (ddtfim == CToD("  /  /  "))
         ddtfim:= CToD("01/01/91")
      endif
      if (dbclearrel == CToD("  /  /  "))
         dbclearrel:= CToD("31/12/10")
      endif
      if (!abredbf("FUNCIONA", "FUNCION1.NTX"))
         loop
      endif
      seek ncodigo
      if (ddtfim == CToD("  /  /  "))
         ddtfim:= CToD("01/01/91")
      endif
      if (dbclearrel == CToD("  /  /  "))
         dbclearrel:= CToD("31/12/10")
      endif
      if (Found())
         ccoldata:= "Periodo de " + DToC(ddtfim) + " a " + ;
            DToC(dbclearrel) + "     " + "Vendedor : " + ;
            Str(ncodigo, 5) + " " + qsr23i->nome
         ncomis3:= comissao
      else
         ccoldata:= "Periodo de " + DToC(ddtfim) + " a " + ;
            DToC(dbclearrel) + "     " + "Vendedor : " + ;
            Str(ncodigo, 5) + "**** NAO ENCONTRADO *****"
      endif
      close
      if (ntipocomis = 1 .OR. ntipocomis = 2)
         if (!abredbf("PEDIDOS", "PEDIDOS3.NTX"))
            loop
         endif
         set filter to Data >= dDtInicio .AND. Data <= dDtFim .AND. ;
            Vendedor == nCodigo
         if (!abrearq())
            lcontrole:= .F.
            loop
         endif
         goto top
         if (!abredbf("COMISSAO", "COMIS1.NTX"))
            loop
         endif
      elseif (ntipocomis == 3)
         select 1
         if (!abredbf("PEDIDOS", "PEDIDOS1.NTX"))
            loop
         endif
         select 2
         if (!abredbf("CONTASRE", "CONTRE3.NTX"))
            loop
         endif
         set filter to DT_RECE_RE >= dDtInicio .AND. DT_RECE_RE <= ;
            dDtFim
         goto top
      endif
      if (impressora() == 1)
         set device to printer
         @  0,  0 say "C" + Chr(nlinform)
         @  1,  1 say "" + cnomemp + ""
         @  2,  1 say "Relatorio do Listagem de Comissao" + ;
            Replicate(" ", 34) + "Pagina :" + Str(ccabecalho, 3)
         @  3,  1 say ccoldata
         @  4,  1 say impcontasa
         @  5,  1 say tip_doc_ar
         @  6,  1 say impcontasa
         nlinha:= 7
         if (ntipocomis = 1 .OR. ntipocomis = 2)
            select Pedidos
            goto top
            do while (!EOF())
               if (ccompleto == "O")
                  if (imp_nf == "S")
                     skip 
                     loop
                  endif
               elseif (ccompleto == "N")
                  if (imp_nf != "S")
                     skip 
                     loop
                  endif
               endif
               observacao:= numero
               valfr:= data
               cnomecli:= Str(cliente, 5) + "-" + nome_cli
               nloja:= loja
               naliq:= aliqcomis
               nvalcomis:= valor_tot * aliqcomis / 100
               cdebcred:= valor_tot
               ntotval:= ntotval + cdebcred
               ntotcomis:= ntotcomis + nvalcomis
               @ nlinha,  1 say valfr
               @ nlinha, 11 say observacao
               @ nlinha, 18 say SubStr(cnomecli, 1, 30)
               @ nlinha, 50 say cdebcred picture "999,999.99"
               @ nlinha, 63 say naliq picture "99.99"
               @ nlinha, 70 say nvalcomis picture "999,999.99"
               nlinha++
               select Pedidos
               skip 
               if (nlinha > nalturafor)
                  rodape(nalturafor, .F., 79)
                  ccabecalho++
                  nlinha:= 8
                  eject
                  @  1,  1 say "" + cnomemp + ""
                  @  2,  1 say "Relatorio do Listagem de Comissao" + ;
                     Replicate(" ", 34) + "Pagina :" + ;
                     Str(ccabecalho, 3)
                  @  3,  1 say ccoldata
                  @  4,  1 say impcontasa
                  @  6,  1 say tip_doc_ar
                  @  7,  1 say impcontasa
               endif
            enddo
         elseif (ntipocomis == 3)
            select ContasRE
            goto top
            do while (!EOF())
               observacao:= dt_emis_re
               valfr:= dt_rece_re
               nloja:= loja
               cdebcred:= vl_rece_re
               nvalcomis:= comissao
               select Pedidos
               seek Str(nloja, 2) + Str(observacao, 5)
               if (Found())
                  if (vendedor != ncodigo)
                     select ContasRE
                     skip 
                     loop
                  endif
                  cnomecli:= Str(cliente, 5) + "-" + nome_cli
               else
                  select ContasRE
                  skip 
                  loop
               endif
               ntotval:= ntotval + cdebcred
               ntotcomis:= ntotcomis + nvalcomis
               @ nlinha,  1 say valfr
               @ nlinha, 11 say observacao
               @ nlinha, 18 say cnomecli
               @ nlinha, 53 say cdebcred picture "9,999,999.99"
               @ nlinha, 69 say nvalcomis picture "9,999,999.99"
               nlinha++
               select CONTASRE
               skip 
               if (nlinha > nalturafor)
                  rodape(nalturafor, .F., 79)
                  ccabecalho++
                  nlinha:= 8
                  eject
                  @  1,  1 say "" + cnomemp + ""
                  @  2,  1 say "Relatorio do Listagem de Comissao" + ;
                     Replicate(" ", 34) + "Pagina :" + ;
                     Str(ccabecalho, 3)
                  @  3,  1 say ccoldata
                  @  4,  1 say impcontasa
                  @  6,  1 say tip_doc_ar
                  @  7,  1 say impcontasa
               endif
               valfr:= CToD("  /  /  ")
               observacao:= 0
               cnomecli:= Space(30)
               cdebcred:= 0
               nloja:= 0
               nvalcomis:= 0
            enddo
         endif
         @ nlinha + 0,  1 say impcontasa
         @ nlinha + 1, 32 say "Total Geral....:"
         @ nlinha + 1, 48 say ntotval picture "9,999,999.99"
         @ nlinha + 1, 68 say ntotcomis picture "9,999,999.99"
         rodape(nalturafor, .T., 79)
      endif
      lcontrole:= .F.
   enddo
   set device to screen
   set color to (ccor)
   close databases
   select 1
   close format
   nlinha:= 10
   ncoluna:= 19
   RestScreen(0, 0, 24, 79, ctela)
   return Nil

********************************
function QSR464

   private ccabecalho, nlinha, ccoluna, clinha, cnomemp, vet[2]
   private impcontasa, nagencia, cbanco, valfr, chistor, cdocto, ;
      chistorico
   private nsaldocon, nsaldoconf, cdebcred, cconf
   cpesquisa:= {"FUNCIONA", "FUNCION2", "CODIGO_FUN", "nCodigo"}
   ccampos:= {"CODIGO_FUN", "NOME", "", "CODIGO", "NOME", ""}
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   ccabecalho:= 1
   nlinha:= 1
   cnomemp:= cempresa
   ccoluna:= "Relatorio de Horas Extras e Adicionais Noturnos" + ;
      Replicate(" ", 24) + "Pagina :" + Str(ccabecalho, 3)
   clinha:= ;
      "Data     Dia 1o    Fim   2o   Fim    3o    Fim   Extra Vl.Extra  Notur Vl.Notur"
   impcontasa:= Replicate("-", 80)
   lcontrole:= .T.
   ncodigo:= 0
   nagencia:= Space(30)
   valfr:= CToD("  /  /  ")
   chistor:= Space(30)
   cdocto:= Space(8)
   chistorico:= " "
   cdebcred:= 0
   cconf:= " "
   nsaldocon:= 0
   nsaldoconf:= 0
   nsaldoinic:= 0
   nlinha:= 10
   ncoluna:= 19
   ctela:= SaveScreen(0, 0, 24, 79)
   vet[1]:= "Sim"
   vet[2]:= "NÆo"
   ncodigo:= 0
   ddtfim:= CToD("  /  /  ")
   dbclearrel:= CToD("  /  /  ")
   vet[1]:= "Sim"
   vet[2]:= "NÆo"
   ddtfim:= CToD("  /  /  ")
   dbclearrel:= CToD("  /  /  ")
   fonecomp:= 0
   nvalhora:= 0
   nextra:= 0
   nnotur:= 0
   ntotalext:= 0
   ntotalnot:= 0
   do while (lcontrole)
      janela(nlinha, ncoluna, nlinha + 6, ncoluna + 43, ;
         " Consulta de Planilha de Horarios ")
      @ nlinha + 1, ncoluna + 2 say "Data Inicial"
      @ nlinha + 1, ncoluna + 15 say "Data Final  "
      @ nlinha + 1, ncoluna + 28 say "Vendedor "
      @ nlinha + 3, ncoluna + 2 say "Valor Hora"
      @ nlinha + 3, ncoluna + 14 say "Hora Extra(%)"
      @ nlinha + 3, ncoluna + 28 say "Adic.Noturno(%)"
      @ nlinha + 2, ncoluna + 2 get dDtInicio
      @ nlinha + 2, ncoluna + 15 get dDtFim
      @ nlinha + 2, ncoluna + 28 get nVend picture "99999" valid ;
         valcodi463(fonecomp) .AND. fonecomp != 0
      @ nlinha + 4, ncoluna + 2 get nValHora picture "999.99"
      @ nlinha + 4, ncoluna + 14 get nExtra picture "999.99"
      @ nlinha + 4, ncoluna + 28 get nNotur picture "999.99"
      read
      if (ddtfim == CToD("  /  /  "))
         ddtfim:= CToD("01/01/91")
      endif
      if (dbclearrel == CToD("  /  /  "))
         dbclearrel:= CToD("31/12/10")
      endif
      ccoldata:= "Periodo  de  " + DToC(ddtfim) + "   a   " + ;
         DToC(dbclearrel)
      if (sai())
         loop
      endif
      processand(.T.)
      if (!abredbf("HORARIO", "HORA2.NTX"))
         loop
      endif
      set filter to DATA >= dDtInicio .AND. DATA <= dDtFim .AND. ;
         FUNCIONA == nVend
      select 2
      if (!abredbf("FUNCIONA", "FUNCION1.NTX"))
         loop
      endif
      seek fonecomp
      if (Found())
         nagencia:= "Motorista : " + LTrim(Str(fonecomp, 5)) + " - " ;
            + qsr23i->nome
      endif
      close
      if (impressora() == 1)
         set device to printer
         @  0,  0 say "C" + Chr(nlinform)
         @  0,  0 say ""
         @  1,  1 say "" + cnomemp + ""
         @  1,  1 say ""
         @  2,  1 say ccoluna
         @  3,  1 say ccoldata + "  " + nagencia
         @  4,  1 say impcontasa
         @  5,  1 say clinha
         @  6,  1 say impcontasa
         nlinha:= 7
         select Horario
         goto top
         do while (!EOF())
            @ nlinha,  1 say data
            @ nlinha, 10 say p_inicio
            @ nlinha, 14 say p_fim
            @ nlinha, 20 say s_inicio
            @ nlinha, 26 say s_fim
            @ nlinha, 32 say t_inicio
            @ nlinha, 38 say t_fim
            @ nlinha, 44 say extra
            @ nlinha, 50 say noturno
            @ nlinha, 56 say horaminu(noturno) * nvalhora / 60 * ;
               nextra / 100
            @ nlinha, 66 say __geta
            @ nlinha, 72 say horaminu(__geta) * nvalhora / 60 * ;
               nnotur / 100
            ntotalext:= ntotalext + horaminu(noturno) * nvalhora / ;
               60 * nextra / 100
            ntotalnot:= ntotalnot + horaminu(__geta) * nvalhora / 60 ;
               * nnotur / 100
            skip 
            nlinha++
            if (nlinha > nalturafor)
               rodape(nalturafor, .F., 134)
               ccabecalho++
               nlinha:= 7
               eject
               @  1,  1 say cnomemp
               @  2,  1 say ccoluna
               @  3,  1 say impcontasa
               @  4,  1 say clinha
               @  5,  1 say impcontasa
            endif
         enddo
         @ nlinha,  1 say impcontasa
         @ nlinha + 1, 46 say "Totais..:"
         @ nlinha + 1, 56 say ntotalext picture "99999.99"
         @ nlinha + 1, 72 say ntotalnot picture "99999.99"
         @ nlinha + 2, 46 say "Total Geral..:" + Str(ntotalext + ;
            ntotalnot, 10, 2)
         rodape(nalturafor, .T., 80)
         set device to screen
      endif
      lcontrole:= .F.
   enddo
   set color to (ccor)
   close databases
   select 1
   close format
   RestScreen(0, 0, 24, 79, ctela)
   return Nil

********************************
function QSR471

   private ncodigo, ddtfim, dbclearrel, crecpag, impvid, nlinha, ;
      ncoluna, ccor, ctela, valpess
   private lcontrole, ncont, v1[5], v2[5], v3[5], ddtinicio[5], vet[2]
   private ntot_diar, ntot_diap, npag, ntotp, ntotr, nsaldocon, ;
      nlin, ddata1
   private vsaldos[3, 4], dbcreate, ntot_diar, ntot_diap, ntotp, ;
      ntotr, nsaldocon, nlin
   set escape on
   programa(0, 69, coropcoes)
   ntot_diar:= 0
   ntot_diap:= 0
   ntotp:= 0
   ntotr:= 0
   impcontasa:= Replicate("-", 79)
   nsaldocon:= 0
   nlin:= 6
   cconf:= Space(1)
   ccor:= SetColor()
   ntot_diar:= 0
   ntot_diap:= 0
   npag:= 0
   ntotp:= 0
   ntotr:= 0
   nsaldocon:= 0
   nlin:= 6
   nloja:= 0
   ccabecalho:= 1
   nlinha:= 1
   cnomemp:= cempresa
   clinha:= ;
      "Data          Credito           Debito         Saldo       "
   nvias:= 0
   ccor:= SetColor()
   ncont:= 0
   lcontrole:= .T.
   nlinha:= 10
   ncoluna:= 11
   ctela:= SaveScreen(0, 0, 24, 79)
   lcontrole:= .T.
   vet[1]:= "Sim"
   vet[2]:= "NÆo"
   ncodigo:= 0
   ddtfim:= CToD("  /  /  ")
   dbclearrel:= CToD("  /  /  ")
   processand(.F.)
   janela(nlinha, ncoluna, nlinha + 5, ncoluna + 43, ;
      " Relatorio de Saldos de ICMS ")
   @ nlinha + 1, ncoluna + 2 say "Data Inicial"
   @ nlinha + 1, ncoluna + 20 say "Data Final  "
   @ nlinha + 3, ncoluna + 2 say "Loja"
   set color to (corfordado)
   @ nlinha + 2, ncoluna + 2 get dDtInicio
   @ nlinha + 2, ncoluna + 20 get dDtFim
   @ nlinha + 4, ncoluna + 2 get nLoja picture "99" valid nloja <= ;
      nnolojas
   read
   if (sai())
      RestScreen(0, 0, 24, 79, ctela)
      return .F.
   endif
   processand(.T.)
   if (ddtfim == CToD("  /  /  "))
      ddtfim:= CToD("01/01/01")
   endif
   if (dbclearrel == CToD("  /  /  "))
      dbclearrel:= CToD("31/12/99")
   endif
   ccoldata:= "Periodo de " + DToC(ddtfim) + " a " + ;
      DToC(dbclearrel) + "     " + "Loja : " + Str(nloja, 2)
   ncont:= 1
   dbcreate:= "Saldo" + LTrim(Str(ncont)) + ".DBF"
   do while (file(dbcreate))
      ncont++
      dbcreate:= "Saldo" + LTrim(Str(ncont)) + ".DBF"
   enddo
   vsaldos[1]:= {"Dt_Venc", "D", 8, 0}
   vsaldos[2]:= {"Val_Tit", "N", 14, 2}
   vsaldos[3]:= {"Rec_Pag", "C", 1, 0}
   cprod(dbcreate, vsaldos)
   if (!abredbf(dbcreate))
      return .F.
   endif
   select 2
   if (!abredbf("CONTASAP"))
      return .F.
   endif
   do while (!EOF() .AND. lcontrole)
      if (val_icm_ap < ddtfim)
         skip 
         loop
      endif
      if (val_icm_ap > dbclearrel)
         skip 
         loop
      endif
      if (nloja != 0)
         if (loja != nloja)
            skip 
            loop
         endif
      endif
      nval_tit:= val_icm_ap
      situaca_ar:= obs_ap
      crec_pag:= "C"
      skip 
      select 1
      if (!adiciona())
         return .F.
      endif
      replace dt_venc with nval_tit
      replace val_tit with situaca_ar
      replace rec_pag with crec_pag
      select 2
   enddo
   if (!abredbf("CONTASPG"))
      return .F.
   endif
   do while (!EOF() .AND. lcontrole)
      if (dt_venc_pg < ddtfim)
         skip 
         loop
      endif
      if (dt_venc_pg > dbclearrel)
         skip 
         loop
      endif
      if (nloja != 0)
         if (loja != nloja)
            skip 
            loop
         endif
      endif
      nval_tit:= val_tit_pg
      situaca_ar:= obs_pg
      crec_pag:= "C"
      skip 
      select 1
      if (!adiciona())
         return .F.
      endif
      replace dt_venc with nval_tit
      replace val_tit with situaca_ar
      replace rec_pag with crec_pag
      select 2
   enddo
   if (!abredbf("NOTA_FIS", "NOTA2.NTX"))
      return .F.
   endif
   goto top
   do while (!EOF() .AND. lcontrole)
      if (data < ddtfim)
         skip 
         loop
      endif
      if (data > dbclearrel)
         skip 
         loop
      endif
      if (nloja != 0)
         if (loja != nloja)
            skip 
            loop
         endif
      endif
      nval_tit:= data
      situaca_ar:= estado
      crec_pag:= "D"
      skip 
      select 1
      if (!adiciona())
         return .F.
      endif
      replace dt_venc with nval_tit
      replace val_tit with situaca_ar
      replace rec_pag with crec_pag
      select 2
   enddo
   select 1
   if (impressora() == 1)
      set device to printer
      @  0,  0 say "C" + Chr(nlinform)
      @  1,  1 say "" + cnomemp + ""
      @  2,  1 say "Relatorio Saldos de ICMS " + Replicate(" ", 41) ;
         + "Pagina :" + Str(ccabecalho, 3)
      @  3,  1 say ccoldata
      @  4,  1 say impcontasa
      @  5,  1 say clinha
      @  6,  1 say impcontasa
      nlinha:= 7
      cseimp:= SubStr(dbcreate, 1, 6)
      index on DT_VENC to (cseimp)
      goto top
      do while (!EOF())
         ddata1:= dt_venc
         do while (ddata1 = dt_venc)
            if (rec_pag = "D")
               ntot_diap:= ntot_diap + val_tit
            elseif (rec_pag = "C")
               ntot_diar:= ntot_diar + val_tit
            endif
            skip 
         enddo
         nsaldocon:= nsaldocon + ntot_diar - ntot_diap
         ntotp:= ntotp + ntot_diap
         ntotr:= ntotr + ntot_diar
         @ nlinha,  1 say ddata1
         @ nlinha, 10 say ntot_diar picture "9,999,999.99"
         @ nlinha, 26 say ntot_diap picture "9,999,999.99"
         @ nlinha, 41 say nsaldocon picture "9,999,999.99"
         nlinha++
         if (nlinha > nalturafor)
            rodape(nalturafor, .F., 79)
            ccabecalho++
            nlinha:= 7
            eject
            @  2,  1 say "Relatorio Saldos de ICMS " + ;
               Replicate(" ", 41) + "Pagina :" + Str(ccabecalho, 3)
            @  3,  1 say ccoldata
            @  4,  1 say impcontasa
            @  5,  1 say clinha
            @  6,  1 say impcontasa
         endif
         ntot_diar:= 0
         ntot_diap:= 0
      enddo
      @ nlinha + 1,  1 say impcontasa
      @ nlinha + 2,  2 say "Totais"
      @ nlinha + 2, 10 say ntotr picture "9,999,999.99"
      @ nlinha + 2, 26 say ntotp picture "9,999,999.99"
      @ nlinha + 2, 41 say nsaldocon picture "9,999,999.99"
      rodape(nalturafor, .T., 79)
   endif
   set device to screen
   RestScreen(0, 0, 24, 79, ctela)
   close databases
   select 1
   close format
   impritrans(dbcreate)
   impritrans(dbcreate + ".NTX")
   return

********************************
function QSR472

   local Local1, Local2, Local3, Local4, Local5[2], Local6, Local7, ;
      Local8, Local9, Local10, Local11, Local12, Local13, Local14
   private nlinha, ncodcli, nval_rece, cchave, nloja, formulario, ;
      ntoticms
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   Local1:= 1
   nlinha:= 1
   Local4:= cempresa
   Local2:= "Relatorio do Movimento de caixa" + Replicate(" ", 36) + ;
      "Pagina :" + Str(Local1, 3)
   Local3:= ;
      "Data     Pedido  Nota   Cliente                                     Valor Nota  Aliq.    Valor ICMS  UF  Status "
   Local6:= ;
      " Codigo   Descricao                              Quantidade       Valor         Total"
   nvias:= 0
   nviaimpr:= 0
   Local7:= Replicate("-", 134)
   cchave:= ""
   ntoticms:= 0
   Local14:= 0
   lcontrole:= .T.
   Local8:= CToD("  /  /  ")
   Local9:= CToD("  /  /  ")
   nloja:= 0
   Local10:= CToD("  /  /  ")
   Local11:= 0
   Local12:= Space(30)
   Local13:= 0
   ncodigo:= 0
   nlinha:= 10
   ncoluna:= 19
   ctela:= SaveScreen(0, 0, 24, 79)
   Local5[1]:= "Sim"
   Local5[2]:= "NÆo"
   do while (lcontrole)
      processand(.F.)
      nlinha:= 10
      ncoluna:= 19
      set color to (corfor)
      @ nlinha, ncoluna clear to nlinha + 5, ncoluna + 47
      @ nlinha, ncoluna to nlinha + 5, ncoluna + 47
      set color to (cortitfor)
      @ nlinha, ncoluna + 10 say " Impressao de Mapa de Caixa "
      set color to (corfordado)
      @ nlinha + 1, ncoluna + 2 say "Data Inicial"
      @ nlinha + 1, ncoluna + 20 say "Data Final  "
      @ nlinha + 1, ncoluna + 33 say "Loja "
      @ nlinha + 3, ncoluna + 2 say "Cliente"
      @ nlinha + 2, ncoluna + 2 get dDtInicio
      @ nlinha + 2, ncoluna + 20 get dDtFim
      @ nlinha + 2, ncoluna + 33 get nLoja picture "99"
      @ nlinha + 4, ncoluna + 2 get nCodigo picture "99999"
      read
      if (LastKey() == K_ESC)
         nresp:= alert("Abandona Relatorio movimento do caixa ?", ;
            Local5)
         if (nresp == 2)
            loop
         else
            lcontrole:= .F.
            loop
         endif
      endif
      processand(.T.)
      if (Local8 == CToD("  /  /  "))
         Local8:= CToD("01/01/01")
      endif
      if (Local9 == CToD("  /  /  "))
         Local9:= CToD("31/12/99")
      endif
      ccoldata:= "Periodo de " + DToC(Local8) + " a " + DToC(Local9) ;
         + "     " + "Loja : " + Str(nloja, 2)
      ncont:= 0
      do while (.T.)
         select 1
         use Nota_Fis shared index Nota2
         if (ncont > 3)
            alert("Erro na abertura de arquivo! Operao ser  cancelada.")
            lcontrole:= .F.
         endif
         if (neterr())
            InKey(2)
            ncont++
            loop
         else
            exit
         endif
      enddo
      if (!lcontrole)
         loop
      endif
      ncont:= 0
      do while (.T.)
         select 2
         use Clientes shared index Cliente1
         if (ncont > 3)
            alert("Erro na abertura de arquivo! Operao ser  cancelada.")
            lcontrole:= .F.
         endif
         if (neterr())
            InKey(2)
            ncont++
            loop
         else
            exit
         endif
      enddo
      if (!lcontrole)
         loop
      endif
      select Nota_Fis
      do case
      case Empty(Local8) .AND. Empty(Local9) .AND. nloja = 0
      case Empty(Local8) .AND. Empty(Local9) .AND. nloja != 0
         set filter to Loja == nLoja
      case Empty(Local8) .AND. !Empty(Local9) .AND. nloja = 0
         set filter to Data <= dDtFim
      case Empty(Local8) .AND. !Empty(Local9) .AND. nloja != 0
         set filter to Loja == nLoja .AND. Data <= DDTIFim
      case !Empty(Local8) .AND. Empty(Local9) .AND. nloja = 0
         set filter to Data >= dDtInicio
      case !Empty(Local8) .AND. Empty(Local9) .AND. nloja != 0
         set filter to Loja == nLoja .AND. Data >= dDtInicio
      case !Empty(Local8) .AND. !Empty(Local9) .AND. nloja = 0
         set filter to Data >= dDtInicio .AND. Data <= dDtFim
      case !Empty(Local8) .AND. !Empty(Local9) .AND. nloja != 0
         set filter to Data >= dDtInicio .AND. Data <= dDtFim .AND. ;
            Loja == nLoja
      endcase
      goto top
      if (impressora() == 1)
         set device to printer
         @  0,  0 say "C" + Chr(nlinform)
         @  1,  1 say "" + Local4 + ""
         @  1,  1 say ""
         @  2,  1 say "Relatorio do Emissao de Notas Fiscais" + ;
            Replicate(" ", 84) + "Pagina :" + Str(Local1, 3)
         @  3,  1 say ccoldata
         @  4,  1 say Local7
         @  5,  1 say Local3
         @  6,  1 say Local6
         @  7,  1 say Local7
         nlinha:= 8
         select Nota_Fis
         goto top
         do while (!EOF())
            if (ncodigo != 0)
               if (nota_fis->codigo_cli != ncodigo)
                  skip 
                  loop
               endif
            endif
            formulario:= pedido
            Local11:= nchavereg
            Local10:= data
            ncodcli:= codigo_cli
            Local13:= icms
            naliq:= nvalicm
            nicms:= estado
            ctelefone:= ferase
            dinicio:= identidade
            nlojnota:= loja
            Local14:= Local14 + Local13
            ntoticms:= ntoticms + nicms
            select Clientes
            seek ncodcli
            if (Found())
               Local12:= nome_cli
            else
               Local12:= " **** Cliente nao Cadastrado ****"
            endif
            @ nlinha,  1 say Local10
            @ nlinha, 11 say Local11
            @ nlinha, 19 say formulario
            @ nlinha, 25 say Str(ncodcli, 5) + "-" + Local12
            @ nlinha, 64 say Local13 picture "999,999,999.99"
            @ nlinha, 81 say naliq picture "99.99"
            @ nlinha, 95 say nicms picture "99.99"
            @ nlinha, 102 say ctelefone picture "!!"
            @ nlinha, 106 say dinicio
            @ nlinha,  1 say Local10
            @ nlinha, 11 say Local11
            @ nlinha, 19 say formulario
            @ nlinha, 25 say Str(ncodcli, 5) + "-" + Local12
            @ nlinha, 64 say Local13 picture "999,999,999.99"
            @ nlinha, 81 say naliq picture "99.99"
            @ nlinha, 95 say nicms picture "99.99"
            @ nlinha, 102 say ctelefone picture "!!"
            @ nlinha, 106 say dinicio
            cchave:= Str(nlojnota, 2) + Str(formulario, 5)
            impprod(cchave)
            select Nota_Fis
            skip 
            nlinha++
            if (nlinha > nalturafor)
               rodape(nalturafor, .F., 134)
               Local1++
               nlinha:= 8
               eject
               @  1,  1 say "" + Local4 + ""
               @  1,  1 say ""
               @  2,  1 say "Relatorio do Emissao de Notas Fiscais" ;
                  + Replicate(" ", 84) + "Pagina :" + Str(Local1, 3)
               @  3,  1 say ccoldata
               @  4,  1 say Local7
               @  5,  1 say Local3
               @  6,  1 say Local6
               @  7,  1 say Local7
            endif
            Local10:= CToD("  /  /  ")
            Local11:= 0
            Local12:= Space(30)
            Local13:= 0
            ccond:= Space(1)
         enddo
         @ nlinha + 0,  1 say Local7
         @ nlinha + 1, 32 say "Total Geral....:"
         @ nlinha + 1, 50 say Local14 picture "999,999,999.99"
         @ nlinha + 2, 32 say "Total ICMS.....:"
         @ nlinha + 2, 50 say ntoticms picture "999,999,999.99"
         rodape(nalturafor, .T., 134)
      endif
      lcontrole:= .F.
   enddo
   set device to screen
   set color to (ccor)
   close databases
   select 1
   close format
   nlinha:= 10
   ncoluna:= 19
   RestScreen(0, 0, 24, 79, ctela)
   return Nil

********************************
procedure IMPPROD(Arg1)

   ntotal:= 0
   ncont:= 0
   ncont:= 0
   do while (.T.)
      use Produtos new shared index Produto1
      if (ncont > 3)
         alert("Erro na abertura de arquivo! Operao ser  cancelada.")
         lcontrole:= .F.
      endif
      if (neterr())
         InKey(2)
         ncont++
         loop
      else
         exit
      endif
   enddo
   ncont:= 0
   do while (.T.)
      use Nota_Mat new shared index Nota_Ma1
      if (ncont > 3)
         alert("Erro na abertura de arquivo! Operao ser  cancelada.")
         lcontrole:= .F.
      endif
      if (neterr())
         InKey(2)
         ncont++
         loop
      else
         exit
      endif
   enddo
   seek Arg1
   if (Found())
      nlinha++
      do while (Arg1 = Str(loja, 2) + Str(pedido, 5) .AND. !EOF())
         ccodigo:= codigo_mat
         nvalormat:= quantidade
         cdebcred:= valor
         ntotal:= quantidade * valor
         select Produtos
         seek ccodigo
         if (Found())
            cdesc:= descricao
         else
            cdesc:= " **** Produto nao cadastrado **** "
         endif
         @ nlinha,  2 say ccodigo
         @ nlinha, 11 say cdesc
         @ nlinha, 47 say nvalormat picture "9,999,999.99"
         @ nlinha, 60 say cdebcred picture "9,999,999.99"
         @ nlinha, 73 say ntotal picture "9,999,999.99"
         select Nota_Mat
         skip 
         nlinha++
         if (nlinha > nalturafor)
            rodape(nalturafor, .F., 134)
            ccabecalho++
            nlinha:= 8
            eject
            @  1,  1 say "" + cnomemp + ""
            @  1,  1 say ""
            @  2,  1 say "Relatorio do Emissao de Notas Fiscais" + ;
               Replicate(" ", 84) + "Pagina :" + Str(ccabecalho, 3)
            @  3,  1 say ccoldata
            @  4,  1 say impcontasa
            @  5,  1 say clinha
            @  6,  1 say tip_doc_ar
            @  7,  1 say impcontasa
         endif
      enddo
   endif
   select Nota_Mat
   close
   select Produtos
   close
   select Nota_Fis
   return

********************************
function QSR481

   private ccabecalho, nlinha, ccoluna, clinha, cnomemp, vet[2]
   private impcontasa, ncont, ni
   private ddtfim, dbclearrel, cref, nvalormat, cdescr
   ccor:= SetColor()
   ccabecalho:= 1
   nlinha:= 1
   cnomemp:= cempresa
   ccoluna:= "Romaneio" + Replicate(" ", 58) + "Pagina :" + ;
      Str(ccabecalho, 3)
   clinha:= "Referencia  Quant.  Descriminacao"
   nvias:= 0
   nviaimpr:= 0
   impcontasa:= Replicate("-", 79)
   ni:= 0
   cref:= " "
   ncodigo:= 0
   nloja:= 0
   fonecomp:= 0
   nnumetiq:= 0
   nnumetiqfi:= 0
   ccliini:= Space(30)
   nlinha:= 10
   ncoluna:= 19
   ctela:= SaveScreen(0, 0, 24, 79)
   vet[1]:= "Sim"
   vet[2]:= "NÆo"
   ncont:= 0
   lcontrole:= .T.
   janela(nlinha, ncoluna, nlinha + 6, ncoluna + 56, ;
      " Impressao de Etiquetas ")
   do while (lcontrole)
      processand(.F.)
      nlinha:= 10
      ncoluna:= 19
      @ nlinha + 1, ncoluna + 2 say ;
         "Individual(I)/Loja(L)/Vendedor(V)"
      @ nlinha + 2, ncoluna + 2 say "Codigo"
      @ nlinha + 2, ncoluna + 12 say "Loja"
      @ nlinha + 2, ncoluna + 20 say "Vendedor"
      @ nlinha + 2, ncoluna + 29 say "Num.Etiquetas"
      @ nlinha + 5, ncoluna + 2 say "Cliente Inicial"
      @ nlinha + 1, ncoluna + 40 get cRef picture "!" valid cref $ ;
         "ILV"
      @ nlinha + 3, ncoluna + 2 get nCodigo picture "99999" when ;
         cref == "I"
      @ nlinha + 3, ncoluna + 12 get nLoja picture "99" valid nloja ;
         <= nnolojas when cref == "L"
      @ nlinha + 3, ncoluna + 20 get nVend picture "99999" when cref ;
         == "V"
      @ nlinha + 3, ncoluna + 29 get nNumEtiq picture "99999" valid ;
         nnumetiq > 0
      @ nlinha + 5, ncoluna + 18 get cCliIni
      read
      if (sai())
         loop
      endif
      processand(.T.)
      if (!abredbf("CLIENTE"))
         loop
      endif
      set index to CLIENTE2, CLIENTE1
      if (ccliini != "     ")
         seek ccliini
         if (EOF())
            alert("Cliente nÆo Localizado")
            exit
         endif
      endif
      if (impressora() == 1)
         set device to printer
         @ PRow(),  0 say "C" + Chr(nlinform)
         @ PRow(),  0 say ""
         @ PRow(),  0 say ""
         @ PRow(),  0 say ""
         ni:= 1
         nlinha:= 1
         do while (!EOF())
            if (cref == "I")
               set order to 2
               seek ncodigo
               if (!Found())
                  goto bottom
                  loop
               endif
               set order to 1
            elseif (cref == "L")
               if (nloja != 0)
                  if (loja_cli != nloja)
                     skip 
                     loop
                  endif
               endif
            elseif (cref == "V")
               if (fonecomp != 0)
                  if (vendedor != fonecomp)
                     skip 
                     loop
                  endif
               endif
            endif
            creg:= compra_cli
            cnome:= nome_cli
            cend:= endere_cli
            cestado:= bairro_cli
            ccidade:= cidade_cli
            cuf:= estado_cli
            ccep:= cep_cli
            @ PRow(),  2 say "Sr(a). " + creg
            @ PRow() + 1,  2 say "" + cnome
            @ PRow() + 1,  2 say "" + cend + "-" + cestado
            @ PRow() + 1,  2 say "" + ccidade + "        " + cuf + ;
               " " + ccep
            @ PRow() + 3,  0 say ""
            if (cref == "I")
               goto bottom
            endif
            ni++
            nnumetiqfi++
            if (nnumetiq <= nnumetiqfi)
               goto bottom
            endif
            skip 
         enddo
      endif
      set device to screen
      if (cref != "I")
         lcontrole:= .F.
      endif
   enddo
   set color to (ccor)
   close databases
   select 1
   close format
   RestScreen(0, 0, 24, 79, ctela)
   return Nil

********************************
function QSR484

   local Local1, Local2, Local3, Local4, Local5, Local6[2], Local7, ;
      Local8, Local9, Local10, Local11, Local12, Local13, Local14
   ccor:= SetColor()
   Local1:= 1
   Local2:= 1
   Local5:= cempresa
   Local3:= "Romaneio" + Replicate(" ", 58) + "Pagina :" + ;
      Str(Local1, 3)
   Local4:= "Referencia  Quant.  Descriminacao"
   nvias:= 0
   nviaimpr:= 0
   Local7:= Replicate("-", 79)
   Local9:= 0
   Local12:= " "
   ncodigo:= 0
   nloja:= 0
   fonecomp:= 0
   Local2:= 10
   ncoluna:= 19
   ctela:= SaveScreen(Local2, ncoluna, Local2 + 11, ncoluna + 56)
   Local6[1]:= "Sim"
   Local6[2]:= "NÆo"
   Local8:= 0
   lcontrole:= .T.
   set color to (corfor)
   @ Local2, ncoluna clear to Local2 + 6, ncoluna + 56
   @ Local2, ncoluna to Local2 + 6, ncoluna + 56
   set color to (cortitfor)
   @ Local2, ncoluna + 16 say " Impressao de Cartoes "
   set color to (corfordado)
   do while (lcontrole)
      Local2:= 10
      ncoluna:= 19
      @ Local2 + 1, ncoluna + 2 say ;
         "Individual(I)/Loja(L)/Vendedor(V)"
      @ Local2 + 3, ncoluna + 2 say "Codigo"
      @ Local2 + 3, ncoluna + 12 say "Loja"
      @ Local2 + 3, ncoluna + 20 say "Vendedor"
      @ Local2 + 1, ncoluna + 40 get cRef picture "!" valid Local12 ;
         $ "ILV"
      @ Local2 + 4, ncoluna + 2 get nCodigo picture "99999" when ;
         Local12 == "I"
      @ Local2 + 4, ncoluna + 12 get nLoja picture "99" valid nloja ;
         <= nnolojas when Local12 == "L"
      @ Local2 + 4, ncoluna + 20 get nVend picture "99999" when ;
         Local12 == "V"
      read
      if (LastKey() == K_ESC)
         nresp:= alert("Abandona Impressao de Etiquetas ?", Local6)
         if (nresp != 2)
            lcontrole:= .F.
            loop
         endif
      endif
      Local8:= 0
      do while (.T.)
         use Clientes shared index Cliente2, Cliente1
         if (Local8 > 3)
            alert("Erro na abertura de arquivo! Operao ser  cancelada.")
            lcontrole:= .F.
         endif
         if (neterr())
            InKey(2)
            Local8++
            loop
         else
            exit
         endif
      enddo
      if (!lcontrole)
         loop
      endif
      if (impressora() == 1)
         set device to printer
         @ PRow(),  0 say "C" + Chr(nlinform)
         @ PRow(),  0 say ""
         @ PRow(),  0 say ""
         @ PRow(),  0 say ""
         Local9:= 1
         Local2:= PRow()
         do while (!EOF())
            if (Local12 == "I")
               set order to 2
               seek ncodigo
               if (!Found())
                  goto bottom
                  loop
               endif
               set order to 1
            elseif (Local12 == "L")
               if (nloja != 0)
                  if (loja_cli != nloja)
                     skip 
                     loop
                  endif
               endif
            elseif (Local12 == "V")
               if (fonecomp != 0)
                  if (vendedor != fonecomp)
                     skip 
                     loop
                  endif
               endif
            endif
            ccompra:= compra_cli
            cnome:= nome_cli
            ncodigo:= codigo_cli
            if (pessoa_cli = "F")
               ccpfcgc:= cpf_cli
            elseif (pessoa_cli = "J")
               ccpfcgc:= cgc_cli
            endif
            if (pessoa_cli = "F")
               cident:= identi_cli
            elseif (pessoa_cli = "J")
               cident:= insc_cli
            endif
            nagencia:= agn_bco
            cfone:= fone_cli
            @ Local2 + 0,  0 say ""
            @ Local2 + 0, 74 say "" + ccpfcgc
            @ Local2 + 1, 74 say "" + cident
            @ Local2 + 2, 74 say "" + nagencia
            @ Local2 + 3, 74 say "" + cfone
            @ Local2 + 4, 80 say "" + ccompra
            @ Local2 + 4, 16 say "" + cnome
            @ Local2 + 6,  8 say "" + Str(ncodigo, 5)
            Local2:= Local2 + 12
            if (Local12 == "I")
               goto bottom
            endif
            Local9++
            skip 
         enddo
      endif
      set device to screen
      if (Local12 != "I")
         lcontrole:= .F.
      endif
   enddo
   set color to (ccor)
   close databases
   select 1
   close format
   Local2:= 10
   ncoluna:= 19
   RestScreen(Local2, ncoluna, Local2 + 11, ncoluna + 56, ctela)
   return Nil

********************************
function QSR4493

   local Local1, Local2, Local3, Local4, Local5, Local6[2], Local7, ;
      Local8, Local9, Local10, Local11, Local12, Local13, Local14, ;
      Local15, Local16
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   Local1:= 1
   Local2:= 1
   Local5:= cempresa
   Local3:= "RelaÆo de Sa¡da de Material" + Replicate(" ", 38) + ;
      "Pagina :" + Str(Local1, 3)
   Local4:= ;
      "Codigo Descricao                         Data      Quant.    Vl.Unit.  Vl.Total"
   Local15:= 0
   Local16:= 0
   Local12:= Replicate("-", 79)
   nvlunit:= 0
   Local9:= Space(5)
   Local8:= Space(30)
   Local9:= Space(5)
   Local10:= Space(35)
   Local11:= 0
   Local14:= 0
   ddatainic:= CToD("  /  /  ")
   ddatafim:= CToD("  /  /  ")
   nloja:= 0
   nquant:= 0
   nvaltot:= 0
   nquanttot:= 0
   Local2:= 10
   ncoluna:= 19
   ctela:= SaveScreen(0, 0, 24, 79)
   Local6[1]:= "Sim"
   Local6[2]:= "NÆo"
   set color to (corfor)
   @ Local2, ncoluna clear to Local2 + 8, ncoluna + 40
   @ Local2, ncoluna to Local2 + 8, ncoluna + 40
   set color to (cortitfor)
   @ Local2, ncoluna + 3 say " Tabela de Custo "
   set color to (corfordado)
   @ Local2 + 3, ncoluna + 1 say "C¢digo"
   @ Local2 + 4, ncoluna + 1 get cCodigo valid Local9 != " "
   @ Local2 + 3, ncoluna + 10 say "Data Inic."
   @ Local2 + 4, ncoluna + 10 get dDataInic
   @ Local2 + 3, ncoluna + 22 say "Data Final"
   @ Local2 + 4, ncoluna + 22 get dDataFim
   @ Local2 + 3, ncoluna + 34 say "Loja"
   @ Local2 + 4, ncoluna + 34 get nLoja picture "99" valid nloja != 0
   read
   Local9:= Replicate("0", 5 - Len(Trim(Local9))) + Trim(Local9)
   @ Local2 + 4, ncoluna + 1 get cCodigo
   clear gets
   if (LastKey() == K_ESC)
      nresp:= alert("Abandona Livro de precos de custo ?", Local6)
      if (nresp == 1)
         set color to (ccor)
         RestScreen(Local2, ncoluna, Local2 + 11, ncoluna + 23, ctela)
         set device to screen
         return Nil
      endif
   endif
   if (Empty(ddatainic))
      ddatainic:= CToD("01/01/01")
   endif
   if (Empty(ddatafim))
      ddatafim:= CToD("31/12/96")
   endif
   if (impressora() == 1)
      ncont:= 0
      do while (.T.)
         select 1
         use Produtos shared readonly index Produto1
         set order to 1
         if (ncont > 3)
            alert("Erro na abertura de arquivo!; OperaÆo ser  cancelada!")
            RestScreen(0, 0, 24, 79)
            set color to (ccor)
            set device to screen
            return .F.
         endif
         if (neterr())
            InKey(2)
            ncont++
            loop
         else
            exit
         endif
      enddo
      ncont:= 0
      do while (.T.)
         select 2
         use Pedidos shared readonly index Pedidos3
         set order to 1
         if (ncont > 3)
            alert("Erro na abertura de arquivo!; OperaÆo ser  cancelada!")
            RestScreen(0, 0, 24, 79)
            set color to (ccor)
            set device to screen
            return .F.
         endif
         if (neterr())
            InKey(2)
            ncont++
            loop
         else
            exit
         endif
      enddo
      ncont:= 0
      do while (.T.)
         select 3
         use Ped_Mat shared readonly index Ped_Mat
         set order to 1
         if (ncont > 3)
            alert("Erro na abertura de arquivo!; OperaÆo ser  cancelada!")
            RestScreen(0, 0, 24, 79)
            set color to (ccor)
            set device to screen
            return .F.
         endif
         if (neterr())
            InKey(2)
            ncont++
            loop
         else
            exit
         endif
      enddo
      select PEDIDOS
      set filter to DATA >= dDataInic .AND. DATA <= dDataFim
      set device to printer
      @  0,  0 say "C" + Chr(nlinform)
      @  1,  1 say "RelaÆo de Sa¡da de Material" + Replicate(" ", ;
         38) + "Pagina :" + Str(Local1, 3)
      @  2,  1 say "Periodo " + DToC(ddatainic) + " a " + ;
         DToC(ddatafim) + "      Loja " + Str(nloja, 2)
      @  3,  1 say Local12
      @  4,  1 say Local4
      @  5,  1 say Local12
      Local2:= 6
      select Produtos
      seek Local9
      if (Found())
         cdescricao:= descricao
      endif
      select PEDIDOS
      goto top
      do while (!EOF())
         Local13:= data
         do while (!EOF() .AND. Local13 = data)
            nnumero:= numero
            select PED_MAT
            seek Str(nloja, 2) + Str(nnumero, 5)
            if (Found())
               do while (!EOF() .AND. numero_ped = nnumero)
                  if (codigo_mat != Local9)
                     skip 
                     loop
                  endif
                  nquant:= nquant + quantidade
                  nvlunit:= valor
                  skip 
               enddo
            endif
            select PEDIDOS
            skip 
         enddo
         if (nquant != 0)
            @ Local2,  1 say Local9
            @ Local2,  8 say SubStr(cdescricao, 1, 30)
            @ Local2, 40 say Local13
            @ Local2, 50 say nquant picture "9999.99"
            @ Local2, 60 say nvlunit picture "99,999.99"
            @ Local2, 70 say nvlunit * nquant picture "99,999.99"
            Local2++
         endif
         nvaltot:= nvaltot + nvlunit * nquant
         nquanttot:= nquanttot + nquant
         nquant:= 0
         if (Local2 > nalturafor)
            rodape(nalturafor, .F., 79)
            Local1++
            Local2:= 6
            eject
            @  0,  0 say "C" + Chr(nlinform)
            @  1,  1 say "RelaÆo de Sa¡da de Material" + ;
               Replicate(" ", 38) + "Pagina :" + Str(Local1, 3)
            @  2,  1 say "Periodo " + DToC(ddatainic) + " a " + ;
               DToC(ddatafim) + "      Loja " + Str(nloja, 2)
            @  3,  1 say Local12
            @  4,  1 say Local4
            @  5,  1 say Local12
         endif
         select PEDIDOS
      enddo
      @ Local2 + 1,  1 say Local12
      @ Local2 + 2, 45 say "Total "
      @ Local2 + 2, 50 say nquanttot picture "9999.99"
      @ Local2 + 2, 65 say "Total "
      @ Local2 + 2, 70 say nvaltot picture "99,999.99"
   endif
   rodape(nalturafor, .T., 79)
   set device to screen
   set color to (ccor)
   close databases
   select 1
   close format
   RestScreen(0, 0, 24, 79, ctela)
   return Nil

********************************
function QSR437

   private ccoluna, cnomemp, vet[2], lcontrole
   private ncodfcli, cnomcli, ddtvenc, ctipdoc, ddt_emis, ccol2
   private cdebcred, nval_tit, ddataultc, ddtpgto, nvalpgto, ;
      ntotpgto, ccondicao
   private ccoldata, nloja
   private ncodloc, nlinha, clinha, impcontasa, ccabecalho
   public cnomeloc
   set key K_F10 to pesq432
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   ccabecalho:= 1
   nlinha:= 1
   cnomemp:= cempresa
   ccoluna:= "Relatorio de Contas a Receber" + Replicate(" ", 93) + ;
      "Pagina :" + Str(ccabecalho, 3)
   clinha:= ;
      "Codigo  Cliente                     No Ped. Num.Doc.   Tip.Doc  Dt.Emis.          Valor    Dt.Venc. Local.  Observacao"
   nvias:= 0
   nviaimpr:= 0
   impcontasa:= Replicate("-", 134)
   lcontrole:= .T.
   ccondicao:= "T"
   ccabcond:= " "
   cimpender:= "N"
   nvaltot:= 0
   ntotpgto:= 0
   nlin:= 10
   ncoluna:= 19
   ctela:= SaveScreen(0, 0, 24, 79)
   vet[1]:= "Sim"
   vet[2]:= "NÆo"
   ncodigo:= 0
   ddtfim:= CToD("  /  /  ")
   dbclearrel:= CToD("  /  /  ")
   crecpag:= "A"
   ncodloc:= 0
   nloja:= 0
   ddt_venc:= Space(2)
   ncodloc:= 0
   nvendo:= 0
   cdocto:= Space(10)
   nbanco:= 1
   nlinha:= PRow() + 1
   set printer on
   janela(nlin, ncoluna, nlin + 11, ncoluna + 55, ;
      "Impressao de Duplicatas")
   select 2
   if (!abredbf("CLIENTES", "CLIENTE1.NTX"))
      return .F.
   endif
   select 1
   if (!abredbf("CONTASAR"))
      return .F.
   endif
   set index to CONTAR3, CONTAR2, CONTAR1
   do while (lcontrole)
      @ nlin + 1, ncoluna + 2 say "Cliente"
      @ nlin + 1, ncoluna + 10 say "Documento"
      @ nlin + 1, ncoluna + 25 say "Banco"
      set color to (corfordado)
      @ nlin + 2, ncoluna + 2 get nCodigo picture "99999"
      @ nlin + 2, ncoluna + 10 get cDocto picture "@!" valid ;
         !Empty(cdocto)
      @ nlin + 2, ncoluna + 25 get nBanco picture "9999"
      read
      if (sai())
         loop
      endif
      do while (.T.)
         if (isprinter())
            exit
         elseif ;
               (alert("Impressora Fora de Linha; Deseja Cancelar ?", ;
               vet) == 1)
            return .F.
         endif
      enddo
      if (isprinter())
         set device to printer
         select ContasAR
         set filter to SUBSTR(NUM_DOC_AR,1,LEN(ALLTRIM(cDocto))) == ;
            ALLTRIM(cDocto) .AND. COD_CLI_AR == nCodigo
         goto top
         do while (!EOF() .AND. cod_cli_ar = ncodigo)
            if (impr_dp = "S")
               if ;
                     (alert("DUPLICATA JA IMPRESSA; IMPRIMIR NOVAMENTE ?", ;
                     vet) == 2)
                  skip 
                  loop
               endif
            endif
            ncodcli:= cod_cli_ar
            select Clientes
            seek ncodcli
            if (!Found())
               cnomcli:= "*** Cliente nao Cadastrado ***"
            else
               cnomcli:= SubStr(clientes->nome_cli, 1, 25)
               cendere:= endere_cli
               cestado:= bairro_cli
               ccep:= cep_cli
               ccidade:= cidade_cli
               ccgc:= cgc_cli
               ctelefone:= estado_cli
               crgcli:= identi_cli
               ccpf:= cpf_cli
               cfone:= fone_cli
            endif
            select ContasAR
            if (nbanco == 1)
               @ nlinha, 120 say "."
               @ nlinha, 90 say dt_venc_ar
               @ nlinha,  3 say ""
               nlinha++
               @ nlinha + 2, 24 say num_doc_ar
               @ nlinha + 2, 54 say ctipo
               @ nlinha + 2, 73 say Date()
               @ nlinha + 4, 95 say val_tit_ar picture "999,999.99"
               @ nlinha + 6,  2 say ;
                  "*** APOS O VENCIMENTO, PAGAVEL NAS AGENCIAS BANCO DO BRASIL"
               @ nlinha + 7,  2 say ;
                  "*** PROTESTAR APOS 3 DIAS DE VENCIDO"
               @ nlinha + 8,  2 say ;
                  "*** MORA AO DIA APOS O VENCIMENTO R$..: " + ;
                  Str(val_tit_ar * 5 / 100 / 30, 8, 2)
               @ nlinha + 9,  2 say ;
                  "*** MULTA APOS O 2§ DIA DE VENCTO R$..: " + ;
                  Str(val_tit_ar * 2 / 100, 8, 2)
               @ nlinha + 10,  2 say localiza
               @ nlinha + 13,  6 say Str(cod_cli_ar, 5) + " - " + ;
                  cnomcli + "  Fone..: " + cfone
               @ nlinha + 14,  6 say cendere + " " + cestado + " " + ;
                  ccidade + " " + ctelefone
               @ nlinha + 15,  9 say "CEP.:" + ccep + "  RG.: " + ;
                  crgcli + "   CPF.:" + ccpf
               bloqueia()
               replace impr_dp with "S"
               nlinha:= PRow() + 9
            endif
            skip 
         enddo
         @ nlinha,  0 say " "
         select ContasAR
         set device to screen
      endif
      lcontrole:= .F.
   enddo
   close databases
   select 1
   close format
   set printer off
   set color to (ccor)
   RestScreen(0, 0, 24, 79, ctela)
   return Nil

********************************
function QSR51

   private ncont, lcontrole, vet[2], nlinha, ncoluna, ctela, ccor
   private i, arq[16], resp[16]
   programa(0, 64, coropcoes)
   vet[1]:= "Sim"
   vet[2]:= "No"
   i:= 1
   nlinha:= 2
   ncoluna:= 19
   lcontrole:= .T.
   cmensprog:= "Abandona Reindexacao"
   ctela:= SaveScreen(0, 0, 24, 79)
   arq[1]:= "Clientes...................:"
   arq[2]:= "Fornecedores...............:"
   arq[3]:= "Funcionarios...............:"
   arq[4]:= "Bancos.....................:"
   arq[5]:= "Estoque....................:"
   arq[6]:= "Grupo......................:"
   arq[7]:= "Movimento Bancario.........:"
   arq[8]:= "Movimento de Funcionarios..:"
   arq[9]:= "Contas a Receber...........:"
   arq[10]:= "Contas Recebidas...........:"
   arq[11]:= "Contas a Pagar.............:"
   arq[12]:= "Contas Pagas...............:"
   arq[13]:= "Pedidos....................:"
   arq[14]:= "Notas Fiscais..............:"
   arq[15]:= "Localizacao................:"
   arq[16]:= "Centro de Custos...........:"
   do while (i <= Len(arq))
      resp[i]:= " "
      i++
   enddo
   janela(nlinha, ncoluna, nlinha + 20, ncoluna + 35, ;
      "Reindexacao de Arquivos")
   @ nlinha + 2, ncoluna + 2 say " Selecione os arquivos "
   nlinha:= nlinha + 3
   @ nlinha + 1, ncoluna + 2 say arq[1]
   @ nlinha + 2, ncoluna + 2 say arq[2]
   @ nlinha + 3, ncoluna + 2 say arq[3]
   @ nlinha + 4, ncoluna + 2 say arq[4]
   @ nlinha + 5, ncoluna + 2 say arq[5]
   @ nlinha + 6, ncoluna + 2 say arq[6]
   @ nlinha + 7, ncoluna + 2 say arq[7]
   @ nlinha + 8, ncoluna + 2 say arq[8]
   @ nlinha + 9, ncoluna + 2 say arq[9]
   @ nlinha + 10, ncoluna + 2 say arq[10]
   @ nlinha + 11, ncoluna + 2 say arq[11]
   @ nlinha + 12, ncoluna + 2 say arq[12]
   @ nlinha + 13, ncoluna + 2 say arq[13]
   @ nlinha + 14, ncoluna + 2 say arq[14]
   @ nlinha + 15, ncoluna + 2 say arq[15]
   @ nlinha + 16, ncoluna + 2 say arq[16]
   SetPos(nlinha + 1, ncoluna + 30)
   AAdd(getlist, qsr271({|| resp}, "RESP", "!", {|| resp[1] $ ;
      "SN "}, Nil, {1}):display())
   SetPos(nlinha + 2, ncoluna + 30)
   AAdd(getlist, qsr271({|| resp}, "RESP", "!", {|| resp[2] $ ;
      "SN "}, Nil, {2}):display())
   SetPos(nlinha + 3, ncoluna + 30)
   AAdd(getlist, qsr271({|| resp}, "RESP", "!", {|| resp[3] $ ;
      "SN "}, Nil, {3}):display())
   SetPos(nlinha + 4, ncoluna + 30)
   AAdd(getlist, qsr271({|| resp}, "RESP", "!", {|| resp[4] $ ;
      "SN "}, Nil, {4}):display())
   SetPos(nlinha + 5, ncoluna + 30)
   AAdd(getlist, qsr271({|| resp}, "RESP", "!", {|| resp[5] $ ;
      "SN "}, Nil, {5}):display())
   SetPos(nlinha + 6, ncoluna + 30)
   AAdd(getlist, qsr271({|| resp}, "RESP", "!", {|| resp[6] $ ;
      "SN "}, Nil, {6}):display())
   SetPos(nlinha + 7, ncoluna + 30)
   AAdd(getlist, qsr271({|| resp}, "RESP", "!", {|| resp[7] $ ;
      "SN "}, Nil, {7}):display())
   SetPos(nlinha + 8, ncoluna + 30)
   AAdd(getlist, qsr271({|| resp}, "RESP", "!", {|| resp[8] $ ;
      "SN "}, Nil, {8}):display())
   SetPos(nlinha + 9, ncoluna + 30)
   AAdd(getlist, qsr271({|| resp}, "RESP", "!", {|| resp[9] $ ;
      "SN "}, Nil, {9}):display())
   SetPos(nlinha + 10, ncoluna + 30)
   AAdd(getlist, qsr271({|| resp}, "RESP", "!", {|| resp[10] $ ;
      "SN "}, Nil, {10}):display())
   SetPos(nlinha + 11, ncoluna + 30)
   AAdd(getlist, qsr271({|| resp}, "RESP", "!", {|| resp[11] $ ;
      "SN "}, Nil, {11}):display())
   SetPos(nlinha + 12, ncoluna + 30)
   AAdd(getlist, qsr271({|| resp}, "RESP", "!", {|| resp[12] $ ;
      "SN "}, Nil, {12}):display())
   SetPos(nlinha + 13, ncoluna + 30)
   AAdd(getlist, qsr271({|| resp}, "RESP", "!", {|| resp[13] $ ;
      "SN "}, Nil, {13}):display())
   SetPos(nlinha + 14, ncoluna + 30)
   AAdd(getlist, qsr271({|| resp}, "RESP", "!", {|| resp[14] $ ;
      "SN "}, Nil, {14}):display())
   SetPos(nlinha + 15, ncoluna + 30)
   AAdd(getlist, qsr271({|| resp}, "RESP", "!", {|| resp[15] $ ;
      "SN "}, Nil, {15}):display())
   SetPos(nlinha + 16, ncoluna + 30)
   AAdd(getlist, qsr271({|| resp}, "RESP", "!", {|| resp[16] $ ;
      "SN "}, Nil, {16}):display())
   read
   do while (lcontrole)
      set color to (corfor)
      if (resp[1] == "S")
         @ 23,  1 clear to 23, 70
         mostrar("Clientes")
         abredbf("CLIENTES")
         if (sai(cmensprog))
            loop
         endif
         if (lcontrole)
            pack
            index on Codigo_Cli to Cliente1
            index on Nome_Cli to Cliente2
            index on Dt_Acerto to Cliente3
            index on Cgc_Cli to Cliente4
            index on Cpf_Cli to Cliente5
            index on Estado_Cli+Cidade_Cli+Nome_Cli to Cliente6
            @ nlinha + 1, ncoluna + 30 say "*" color "N/W"
         endif
      endif
      if (resp[2] == "S")
         @ 23,  1 clear to 23, 70
         mostrar("Fornecedores")
         abredbf("FORNECEDORES")
         if (sai(cmensprog))
            loop
         endif
         if (lcontrole)
            pack
            index on Codigo_For to Fornece1
            index on Nome to Fornece2
            @ nlinha + 2, ncoluna + 30 say "*" color "N/W"
         endif
      endif
      if (resp[3] == "S")
         @ 23,  1 clear to 23, 70
         mostrar("Funcionarios")
         abredbf("FUNCIONA")
         if (sai(cmensprog))
            loop
         endif
         if (lcontrole)
            pack
            index on Codigo_Fun to Funcion1
            index on Nome to Funcion2
            @ nlinha + 3, ncoluna + 30 say "*" color "N/W"
         endif
         abredbf("USUARIOS")
         lcontrole:= .T.
         if (lcontrole)
            pack
            index on Codigo_Usu to Usuario1
            @ nlinha + 3, ncoluna + 30 say "*" color "N/W"
         endif
         if (sai(cmensprog))
            loop
         endif
      endif
      if (resp[4] == "S")
         @ 23,  1 clear to 23, 70
         mostrar("Bancos")
         abredbf("BANCOS")
         if (sai(cmensprog))
            loop
         endif
         if (lcontrole)
            pack
            index on Conta_BC to Bancos1
            @ nlinha + 4, ncoluna + 30 say "*" color "N/W"
         endif
      endif
      if (resp[5] == "S")
         @ 23,  1 clear to 23, 70
         mostrar("Estoque")
         abredbf("PRODUTOS")
         select 10
         abredbf("EMPRESA")
         if (sai(cmensprog))
            loop
         endif
         select Produtos
         if (lcontrole)
            pack
            index on Codigo to Produto1
            index on Descricao to Produto2
            index on STR(Grupo,3)+Descricao to Produto3
            index on Grupo to Produto4
            index on STR(Grupo,3)+Marca+Descricao to Produto5
            abredbf("ENTRADAS")
            mostrar("Entradas")
            if (lcontrole)
               pack
               index on Num_Docto+STR(Fornecedor,5) to Entrada1
               index on Fornecedor to Entrada2
               index on Data to Entrada3
            endif
            abredbf("ENT_MAT")
            mostrar("Ent.Mat")
            if (lcontrole)
               pack
               index on Num_Docto to Ent_Mat1
            endif
            abredbf("LOTES")
            mostrar("Entradas de Materia-Prima")
            if (lcontrole)
               pack
               index on Num_Docto+STR(Fornecedor,5) to Lotes1
               index on Fornecedor to Lotes2
               index on Data to Lotes3
            endif
            abredbf("LOT_MAT")
            mostrar("Lot.Mat")
            if (lcontrole)
               pack
               index on Num_Docto to Lot_Mat1
            endif
            abredbf("TRANSF")
            mostrar("Transf")
            if (lcontrole)
               pack
               index on Data to Transf1
               index on Num_Docto to Transf2
            endif
            abredbf("TRANS_MAT")
            mostrar("Trans.Mat")
            if (lcontrole)
               pack
               index on Num_Docto to Tra_Mat1
            endif
            abredbf("MATERIA")
            mostrar("Materia")
            if (lcontrole)
               pack
               index on CODIGO to Materia1
               index on DESCRICAO to Materia2
               index on FORNECEDOR to Materia3
               index on GRUPO to Materia4
            endif
            abredbf("TRANS_MAT")
            mostrar("Trans.Mat")
            if (lcontrole)
               pack
               index on Num_Docto to Tra_Mat1
            endif
            abredbf("CUSTO")
            mostrar("Custo")
            if (lcontrole)
               pack
               index on CODIGO_MAT to CUSTO1
               index on CODIGO_MAT + CODIGO_CUS to CUSTO2
            endif
            abredbf("LOCEST")
            mostrar("LocEst")
            if (lcontrole)
               pack
               index on CODIGO to LOCEST1
            endif
            abredbf("PRODUCAO")
            mostrar("Producao")
            if (lcontrole)
               pack
               index on CODIGO_PRO + LOTE to PRODUCA1
               index on DATA to PRODUCA2
            endif
            abredbf("PROD_MAT")
            mostrar("Prod.Mat")
            if (lcontrole)
               pack
               index on CODIGO_PRO + LOTE to PRODMAT1
            endif
            abredbf("GRUP_MAT")
            mostrar("GRUP.Mat")
            if (lcontrole)
               pack
               index on CODIGO to GRUPMAT1
            endif
            abredbf("PRODUCA")
            mostrar("Producao")
            if (lcontrole)
               pack
               index on CODIGO_PRO + LOTE to PRODUCA1
               index on DATA to PRODUCA2
            endif
            abredbf("PROD_MAT")
            mostrar("Prod.Mat")
            if (lcontrole)
               pack
               index on CODIGO_PRO + LOTE to PRODMAT1
            endif
            abredbf("ESTOQUE")
            mostrar("ESTOQUE")
            if (lcontrole)
               pack
               index on LOCAL to ESTOQUE1
               index on STR(LOCAL,3)+PRODUTO+TAMANHO to ESTOQUE2
            endif
            @ nlinha + 5, ncoluna + 30 say "*" color "N/W"
         endif
      endif
      if (resp[6] == "S")
         @ 23,  1 clear to 23, 70
         mostrar("Grupo")
         abredbf("GRUPO")
         if (sai(cmensprog))
            loop
         endif
         if (lcontrole)
            pack
            index on Grupo to Grupo
            index on Descricao to Grupo1
            @ nlinha + 6, ncoluna + 30 say "*" color "N/W"
         endif
      endif
      if (resp[7] == "S")
         @ 23,  1 clear to 23, 70
         mostrar("Movimento Banc rio")
         abredbf("MOV_BCO")
         if (sai(cmensprog))
            loop
         endif
         if (lcontrole)
            pack
            index on STR(CONTA_MB)+DOCTO_MB to MV_BCO1
            index on DATA_MB to MV_BCO2
            index on CONTA_MB to MV_BCO3
            @ nlinha + 7, ncoluna + 30 say "*" color "N/W"
         endif
      endif
      if (resp[8] == "S")
         @ 23,  1 clear to 23, 70
         mostrar("Movimento de Funcion rios")
         abredbf("HORARIO")
         if (sai(cmensprog))
            loop
         endif
         if (lcontrole)
            pack
            index on FUNCIONA to HORA1
            index on DATA to HORA2
            index on STR(FUNCIONA,5) + DTOC(DATA) to HORA3
         endif
         abredbf("MOV_FUN")
         if (sai(cmensprog))
            loop
         endif
         if (lcontrole)
            pack
            index on STR(Codigo,5)+DOCTO to MV_FUN1
            index on DATA to MV_FUN2
            index on Codigo to MV_FUN3
         endif
         abredbf("FERIADO")
         if (sai(cmensprog))
            loop
         endif
         if (lcontrole)
            pack
            index on DATA to FERIADO1
            @ nlinha + 8, ncoluna + 30 say "*" color "N/W"
         endif
      endif
      if (resp[9] == "S")
         @ 23,  1 clear to 23, 70
         mostrar("Contas a Receber")
         abredbf("CONTASAR")
         if (sai(cmensprog))
            loop
         endif
         if (lcontrole)
            pack
            index on Num_Doc_AR+STR(Cod_Cli_AR,5) to ContAR1
            index on Cod_Cli_AR to ContAR2
            index on DT_VENC_AR to ContAR3
            index on STR(LOJA,2)+STR(Num_Ped_AR,5) to ContAR4
            @ nlinha + 9, ncoluna + 30 say "*" color "N/W"
         endif
      endif
      if (resp[10] == "S")
         @ 23,  1 clear to 23, 70
         mostrar("Contas Recebidas")
         abredbf("CONTASRE")
         if (sai(cmensprog))
            loop
         endif
         if (lcontrole)
            pack
            index on Num_Doc_RE+STR(Cod_Cli_RE,5) to ContRE1
            index on Cod_Cli_RE to ContRE2
            index on DT_RECE_RE to ContRE3
            index on STR(LOJA,2)+STR(Num_Ped_RE,5) to ContRE4
            @ nlinha + 10, ncoluna + 30 say "*" color "N/W"
         endif
      endif
      if (resp[11] == "S")
         @ 23,  1 clear to 23, 70
         mostrar("Contas a Pagar")
         abredbf("CONTASAP")
         if (sai(cmensprog))
            loop
         endif
         if (lcontrole)
            use CONTASAP exclusive
            pack
            index on Num_Doc_AP+STR(Cod_For_AP,5) to ContAP1
            index on Cod_For_AP to ContAP2
            index on DT_VENC_AP to ContAP3
            @ nlinha + 11, ncoluna + 30 say "*" color "N/W"
         endif
      endif
      if (resp[12] == "S")
         @ 23,  1 clear to 23, 70
         mostrar("Contas Pagas")
         abredbf("CONTASPG")
         if (sai(cmensprog))
            loop
         endif
         if (lcontrole)
            pack
            index on Num_Doc_PG+STR(Cod_For_PG,5) to ContPG1
            index on Cod_For_PG to ContPG2
            index on DT_PGTO_PG to ContPG3
            @ nlinha + 12, ncoluna + 30 say "*" color "N/W"
         endif
      endif
      if (resp[13] == "S")
         @ 23,  1 clear to 23, 70
         mostrar("Pedidos")
         abredbf("PEDIDOS")
         if (sai(cmensprog))
            loop
         endif
         if (lcontrole)
            pack
            index on STR(LOJA,2)+STR(NUMERO,5) to PEDIDOS1
            index on CLIENTE to PEDIDOS2
            index on DATA to PEDIDOS3
         endif
         @ 23,  1 clear to 23, 70
         mostrar("Ped_Mat")
         abredbf("PED_MAT")
         if (lcontrole)
            pack
            index on STR(LOJA,2)+STR(NUMERO_PED,5) to PED_MAT
         endif
         mostrar("Fat_Mat")
         abredbf("FAT_MAT")
         if (lcontrole)
            pack
            index on NUMERO_PED to FAT_MAT1
            index on CLIENTE to FAT_MAT2
            index on STR(NUMERO_PED,5)+CODIGO_MAT to FAT_MAT3
         endif
         abredbf("ORCAMENT")
         if (lcontrole)
            pack
            index on STR(LOJA,2)+STR(NUMERO,5) to ORCAMEN1
            index on CLIENTE to ORCAMEN2
            index on DATA to ORCAMEN3
         endif
         @ 23,  1 clear to 23, 70
         mostrar("ORC_Mat")
         abredbf("ORC_MAT")
         if (lcontrole)
            pack
            index on STR(LOJA,2)+STR(NUMERO_PED,5) to ORC_MAT
            index on NUMERO_PED to ORC_MAT1
         endif
         abredbf("CONSIGNA")
         if (lcontrole)
            pack
            index on NUMERO to CONSIGN1
            index on CLIENTE to CONSIGN2
            index on DATA to CONSIGN3
         endif
         @ 23,  1 clear to 23, 70
         mostrar("Con_Mat")
         abredbf("CONT_MAT")
         if (lcontrole)
            pack
            index on NUMERO_PED to CON_MAT
         endif
         abredbf("DEVOLUCA")
         if (lcontrole)
            pack
            index on NUMERO to DEVOLUC1
            index on CLIENTE to DEVOLUC2
            index on DATA to DEVOLUC3
         endif
         @ 23,  1 clear to 23, 70
         mostrar("Dev_Mat")
         abredbf("DEV_MAT")
         if (lcontrole)
            pack
            index on NUMERO_PED to DEV_MAT
         endif
         @ 23,  1 clear to 23, 70
         mostrar("Mat_Cons")
         abredbf("MAT_CONS")
         if (lcontrole)
            pack
            index on Cliente to Mat_Con1
            index on STR(Cliente,5)+Codigo_Mat to Mat_Con2
            index on Codigo_Mat to Mat_Con3
         endif
         if (sai(cmensprog))
            loop
         endif
         if (file("CONT_PED.DBF"))
            abredbf("CONT_PED")
            if (lcontrole)
               pack
               index on Numero_Ped to Cont_Ped
               index on STR(Numero_Ped,5)+Codigo_Mat to Con_Ped1
            endif
         endif
         @ 23,  1 clear to 23, 70
         mostrar("Manifestos")
         abredbf("MANIFEST")
         if (sai(cmensprog))
            loop
         endif
         if (lcontrole)
            pack
            index on STR(LOJA,2)+STR(NUMERO,5) to Manifes1
            index on CLIENTE to Manifes2
            index on DATA to Manifes3
         endif
         @ 23,  1 clear to 23, 70
         mostrar("Material dos manifestos")
         abredbf("MAN_MAT")
         if (lcontrole)
            pack
            index on STR(LOJA,2)+STR(NUMERO_PED,5) to Man_MAT
         endif
         @ nlinha + 13, ncoluna + 30 say "*" color "N/W"
      endif
      if (resp[14] == "S")
         @ 23,  1 clear to 23, 70
         mostrar("Notas Fiscais")
         abredbf("NOTA_FIS")
         if (sai(cmensprog))
            loop
         endif
         if (lcontrole)
            pack
            index on STR(Loja,2)+STR(Nota,5) to Nota1
            index on Data to Nota2
            index on STR(Loja,2)+STR(Pedido,5) to Nota3
         endif
         abredbf("NOTA_MAN")
         if (sai(cmensprog))
            loop
         endif
         if (lcontrole)
            pack
            index on STR(Loja,2)+STR(Nota,5) to Mani1
            index on Data to Mani2
            index on STR(Loja,2)+STR(Pedido,5) to Mani3
         endif
         abredbf("NOTA_MAT")
         abredbf("MAN_MAT")
         if (lcontrole)
            pack
            index on STR(Loja,2)+STR(Numero_Ped,5) to Nan_Ma1
            @ nlinha + 14, ncoluna + 30 say "*" color "N/W"
         endif
      endif
      if (resp[15] == "S")
         @ 23,  1 clear to 23, 70
         mostrar("Localizacao")
         abredbf("LOCALIZA")
         if (sai(cmensprog))
            loop
         endif
         if (lcontrole)
            pack
            index on Codigo_Loc to Localiz1
            @ nlinha + 15, ncoluna + 30 say "*" color "N/W"
         endif
      endif
      if (resp[16] == "S")
         @ 23,  1 clear to 23, 70
         mostrar("RETORNOS")
         abredbf("RETORNO")
         if (lcontrole)
            pack
            index on STR(LOJA,2)+STR(NUMERO,5) to Retorno1
            index on CLIENTE to Retorno2
            index on DATA to Retorno3
         endif
         @ 23,  1 clear to 23, 70
         mostrar("Material dos retornos")
         abredbf("RET_MAT")
         if (lcontrole)
            pack
            index on STR(LOJA,2)+STR(NUMERO_PED,5) to Ret_MAT
         endif
         abredbf("NOTA_RET")
         if (sai(cmensprog))
            loop
         endif
         if (lcontrole)
            pack
            index on STR(Loja,2)+STR(Nota,5) to Reto1
            index on Data to Reto2
            index on STR(Loja,2)+STR(Pedido,5) to Reto3
         endif
         abredbf("COMISSAO")
         if (sai(cmensprog))
            loop
         endif
         if (lcontrole)
            pack
            index on STR(Vendedor,5)+STR(Grupo,3) to Comis1
         endif
         @ 23,  1 clear to 23, 70
         mostrar("RETORNOSs")
         abredbf("RETORNO")
         if (sai(cmensprog))
            loop
         endif
         if (lcontrole)
            pack
            index on STR(LOJA,2)+STR(NUMERO,5) to Retorno1
            index on CLIENTE to Retorno2
            index on DATA to Retorno3
         endif
         @ 23,  1 clear to 23, 70
         mostrar("Material dos retornos")
         abredbf("RET_MAT")
         if (lcontrole)
            pack
            index on STR(LOJA,2)+STR(NUMERO_PED,5) to Ret_MAT
         endif
         abredbf("NOTA_RET")
         if (sai(cmensprog))
            loop
         endif
         if (lcontrole)
            pack
            index on STR(Loja,2)+STR(Nota,5) to Reto1
            index on Data to Reto2
            index on STR(Loja,2)+STR(Pedido,5) to Reto3
         endif
         abredbf("MENUS")
         if (sai(cmensprog))
            loop
         endif
         if (lcontrole)
            pack
            index on CODIGO to MENUS1
         endif
         abredbf("COMISSAO")
         if (sai(cmensprog))
            loop
         endif
         if (lcontrole)
            pack
            index on STR(Vendedor,5)+STR(Grupo,3) to Comis1
         endif
         abredbf("CENT_CUS")
         pack
         index on Codigo_cc to Centro1
         index on Cod_Hier to Centro2
         @ nlinha + 16, ncoluna + 30 say "*" color "N/W"
      endif
      lcontrole:= .F.
   enddo
   RestScreen(0, 0, 24, 79, ctela)
   set color to (ccor)
   close databases
   select 1
   close format
   return Nil

********************************
procedure QSR53

   private ccor, lcontrole, nlinha, ncoluna, ctela, nresp, nmenu
   ccor:= SetColor()
   ncont:= 0
   lcontrole:= .T.
   nmenu:= 0
   nlinha:= 10
   ncoluna:= 19
   ctela:= SaveScreen(nlinha, ncoluna, nlinha + 11, ncoluna + 43)
   lcontrole:= .T.
   do while (lcontrole)
      set color to (corfor)
      @ nlinha, ncoluna clear to nlinha + 8, ncoluna + 43
      @ nlinha, ncoluna to nlinha + 8, ncoluna + 43
      set color to (cortitfor)
      @ nlinha, ncoluna + 11 say " Tipos de ImpressÆo "
      set color to (corlinmenu)
      @ nlinha + 2, ncoluna + 2 prompt " 1-ImpressÆo Normal   " ;
         message "Volta a ImpressÆo ao normal"
      @ nlinha + 3, ncoluna + 2 prompt " 2-Expande ImpressÆo  " ;
         message "Expande a ImpressÆo"
      @ nlinha + 4, ncoluna + 2 prompt " 3-Comprime ImpressÆo " ;
         message "Comprime a ImpressÆo"
      @ nlinha + 5, ncoluna + 2 prompt " 4-Salta Pagina       " ;
         message "Salta uma pagina na impressora"
      menu to nmenu
      if (LastKey() != K_ESC)
         nresp:= impressora()
         if (nresp == 1)
            do case
            case nmenu == 1
               if (impressora() == 1)
                  set device to printer
                  @  0,  0 say ""
                  @  0,  0 say ""
                  set device to screen
               endif
            case nmenu == 2
               if (impressora() == 1)
                  set device to printer
                  @  0,  0 say ""
                  set device to screen
               endif
            case nmenu == 3
               if (impressora() == 1)
                  set device to printer
                  @  0,  0 say ""
                  set device to screen
               endif
            case nmenu == 4
               if (impressora() == 1)
                  set device to printer
                  eject
                  set device to screen
               endif
            endcase
         endif
      else
         lcontrole:= .F.
      endif
   enddo
   set color to (ccor)
   RestScreen(nlinha, ncoluna, nlinha + 11, ncoluna + 43, ctela)
   return

********************************
function QSR54

   cpesquisa:= {"FUNCIONA", "FUNCION2", "CODIGO_FUN", "nCodigo"}
   ccampos:= {"CODIGO_FUN", "NOME", "", "CODIGO", "NOME", ""}
   private op1[2]
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   ctela:= SaveScreen(0, 0, 24, 79)
   ncodigo:= 0
   csenha:= ""
   lcontrole:= .T.
   lcadastra:= .F.
   n:= 0
   nnivelusu:= 0
   cnome:= ""
   op1[1]:= "Sim"
   op1[2]:= "Nao"
   cmodulos:= Space(40)
   cmod:= " "
   vet:= {"SIM", "NAO"}
   janela(10, 24, 18, 60, "Cadastro de Senhas")
   do while (lcontrole)
      dbunlockal:= escolhelin({"Altera", "Exclui"}, 2, 18, 25)
      @ 11, 26 say "Usuario"
      @ 14, 26 say "Senha"
      @ 12, 26 get nCodigo picture "99999" valid valusu1(ncodigo)
      read
      if (sai())
         loop
      endif
      csenha:= lersenha(15, 26, .T.)
      if (sai())
         loop
      endif
      if (!conflinha("Confirma Manutencao ?", 18, 25))
         loop
      endif
      if (!abredbf("USUARIOS", "USUARIO1.NTX"))
         loop
      endif
      if (dbunlockal == 1)
         seek ncodigo
         if (!Found())
            if (!adiciona())
               loop
            endif
         endif
         if (!bloqueia())
            loop
         endif
         replace codigo_usu with ncodigo
         replace senha with csenha
         replace nome_usu with cnome
      else
         seek ncodigo
         if (Found())
            delete
         endif
         exit
      endif
      close
      if (!abredbf("MENUS", "MENUS1.NTX"))
         loop
      endif
      goto top
      do while (!EOF())
         RLock()
         replace usuarios with Trim(usuarios) + LTrim(Str(ncodigo, ;
            5)) + ","
         skip 
      enddo
      close
      lcontrole:= .F.
   enddo
   set color to (ccor)
   RestScreen(0, 0, 24, 79, ctela)
   close databases
   select 1
   close format
   return .T.

********************************
procedure QSR57

   private corlinha, corlinmenu, corcorpo, cortitfor, corfor, ;
      corfordado, coropcoes
   private cores[17], vet[2], v1[1], v2[1], v3[1], ddtinicio[1]
   set escape on
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   lcontrole:= .T.
   nlinha:= 7
   ncoluna:= 19
   ctela:= SaveScreen(nlinha, ncoluna, nlinha + 22, ncoluna + 35)
   lcontrole:= .T.
   vet[1]:= "Sim"
   vet[2]:= "NÆo"
   ctela:= SaveScreen(nlinha, ncoluna, nlinha + 15, ncoluna + 47)
   nlinha:= 5
   ncoluna:= 19
   set color to (corfor)
   @ nlinha, ncoluna clear to nlinha + 15, ncoluna + 47
   @ nlinha, ncoluna to nlinha + 15, ncoluna + 47
   op:= 1
   do while (lcontrole)
      @ nlinha + 1, ncoluna + 2 prompt "1-Cadastros    " message ;
         "Abre o arquivo de configuracao do menu de Cadatros"
      @ nlinha + 2, ncoluna + 2 prompt "2-Lancamentos  " message ;
         "Abre o arquivo de configuracao do menu de Lancamentos"
      @ nlinha + 3, ncoluna + 2 prompt "3-Consultas    " message ;
         "Abre o arquivo de configuracao do menu de Consultas"
      @ nlinha + 4, ncoluna + 2 prompt "4-Relatorios   " message ;
         "Abre o arquivo de configuracao do menu de Relatorios"
      @ nlinha + 5, ncoluna + 2 prompt "5-Utilitarios  " message ;
         "Abre o arquivo de configuracao do menu de Utilitarios"
      @ nlinha + 6, ncoluna + 2 prompt "6-Nivel Menu 3 " message ;
         "Abre o arquivo de configuracao do menu de nivel 3"
      @ nlinha + 7, ncoluna + 2 prompt "7-Nivel Menu 4 " message ;
         "Abre o arquivo de configuracao do menu de nivel 4"
      menu to op
      if (LastKey() == K_ESC)
         exit
      endif
      do case
      case op = 1
         dbcreate:= "SIA1"
         cindice:= "SIA1"
      case op = 2
         dbcreate:= "SIA2"
         cindice:= "SIA2"
      case op = 3
         dbcreate:= "SIA3"
         cindice:= "SIA3"
      case op = 4
         dbcreate:= "SIA4"
         cindice:= "SIA4"
      case op = 5
         dbcreate:= "SIA5"
         cindice:= "SIA5"
      case op = 6
         dbcreate:= "SIA_NM_3"
         cindice:= "SIA_NM_3"
      case op = 7
         dbcreate:= "SIA_NM_4"
         cindice:= "SIA_NM_4"
      endcase
      use (dbcreate) index (cindice)
      ccoluna:= ""
      close
   enddo
   close
   set color to (ccor)
   RestScreen(nlinha, ncoluna, nlinha + 15, ncoluna + 47, ctela)
   return

********************************
function QSR58

   private op1[2]
   programa(0, 69, coropcoes)
   ccor:= SetColor()
   ctela:= SaveScreen(0, 0, 24, 79)
   ncodigo:= 0
   csenha:= ""
   lcontrole:= .T.
   lcadastra:= .F.
   n:= 0
   nnivelusu:= 0
   cnome:= ""
   op1[1]:= "Sim"
   op1[2]:= "Nao"
   cmodulos:= Space(40)
   cmod:= " "
   vet:= {"Sim", "Nao"}
   janela(10, 24, 18, 60, "Direito de Usuarios")
   do while (lcontrole)
      @ 11, 26 say "Usuario"
      @ 12, 26 get nCodigo picture "99999" valid valusu1(ncodigo)
      read
      valpess:= SaveScreen(0, 0, 24, 79)
      if (sai())
         loop
      endif
      if (!abredbf("MENUS", "MENUS1.NTX"))
         loop
      endif
      reindex
      goto top
      do while (!EOF())
         RLock()
         if ("," + LTrim(Str(ncodigo)) + "," $ usuarios)
            replace permite with "X"
            replace confir_mb with "X"
         else
            replace permite with " "
            replace confir_mb with " "
         endif
         skip 
      enddo
      goto top
      v1:= {"MENU", "CONFIR_MB"}
      v2:= {"", ""}
      v3:= {"DESCRICAO", "PERMITE"}
      ddtinicio:= {1, 1}
      i:= 1
      ccoluna:= " "
      do while (!lcontrole .OR. i != 6)
         ccodigo:= Trim(codigo)
         if (LastKey() == K_ESC)
            if (i > 1)
               ccodigo:= SubStr(ccodigo, 1, Len(Trim(ccodigo)) - 4)
            else
               ccodigo:= SubStr(ccodigo, 1, Len(Trim(ccodigo)) - 2)
            endif
         endif
         if (Empty(executa))
            if (i > 1)
               set filter to LEN(RTRIM(CODIGO)) = I * 2 .AND. ;
                  SUBSTR(CODIGO,1,I*2) = cCodigo
            else
               set filter to LEN(RTRIM(CODIGO)) = I * 2
            endif
         endif
         consulta("MENUS", 4, 8, 21, 62, v1, v2, v3, ddtinicio, ;
            "NULO", ccoluna, Nil, "NULO")
         cmenu:= Trim(menu)
         ntamcab:= Len(Trim(ccoluna)) - Len(Trim(menu)) - 3
         if (LastKey() = K_ESC)
            ccoluna:= SubStr(ccoluna, 1, ntamcab)
            i--
            if (i < 1)
               exit
            endif
         elseif (LastKey() = K_ENTER)
            if (Empty(executa))
               if (i > 1)
                  ccoluna:= ccoluna + " - " + cmenu
               else
                  ccoluna:= cmenu
               endif
               i++
            endif
         elseif (LastKey() = -41)
            exit
         endif
      enddo
      RestScreen(0, 0, 24, 79, valpess)
      set filter to
      ntam:= Len(Trim(Str(ncodigo, 5))) + 2
      goto top
      do while (!EOF())
         if (permite = "X" .AND. confir_mb = " ")
            l:= 1
            do while (l != 500)
               if (SubStr(usuarios, l, ntam) = "," + ;
                     LTrim(Str(ncodigo, 5)) + ",")
                  RLock()
                  replace usuarios with SubStr(usuarios, 1, l) + ;
                     SubStr(usuarios, l + ntam)
               endif
               l++
            enddo
         endif
         if (permite = " " .AND. confir_mb = "X")
            RLock()
            replace usuarios with Trim(usuarios) + ;
               LTrim(Str(ncodigo, 5)) + ","
         endif
         skip 
      enddo
      close
      lcontrole:= .T.
      setcursor(1)
   enddo
   set color to (ccor)
   RestScreen(0, 0, 24, 79, ctela)
   close databases
   select 1
   close format
   return .T.

********************************
function QSR59

   private ncont, lcontrole, vet[2], nlinha, ncoluna, ctela, ccor
   private i, arq[16], resp[16]
   programa(0, 64, coropcoes)
   vet[1]:= "Sim"
   vet[2]:= "No"
   i:= 1
   nlinha:= 2
   ncoluna:= 19
   lcontrole:= .T.
   cmensprog:= "Abandona Reindexacao"
   ctela:= SaveScreen(0, 0, 24, 79)
   arq[1]:= "Clientes...................:"
   arq[2]:= "Fornecedores...............:"
   arq[3]:= "Funcionarios...............:"
   arq[4]:= "Bancos.....................:"
   arq[5]:= "Estoque....................:"
   arq[6]:= "Grupo......................:"
   arq[7]:= "Movimento Bancario.........:"
   arq[8]:= "Movimento de Funcionarios..:"
   arq[9]:= "Contas a Receber...........:"
   arq[10]:= "Contas Recebidas...........:"
   arq[11]:= "Contas a Pagar.............:"
   arq[12]:= "Contas Pagas...............:"
   arq[13]:= "Pedidos....................:"
   arq[14]:= "Notas Fiscais..............:"
   arq[15]:= "Localizacao................:"
   arq[16]:= "Centro de Custos...........:"
   do while (i <= Len(arq))
      resp[i]:= " "
      i++
   enddo
   set color to (corfor)
   @ nlinha, ncoluna clear to nlinha + 20, ncoluna + 35
   @ nlinha, ncoluna to nlinha + 20, ncoluna + 35
   set color to (cortitfor)
   @ nlinha, ncoluna + 6 say " ReindexaÆo de arquivos "
   set color to (corfordado)
   @ nlinha + 2, ncoluna + 2 say " Selecione os arquivos "
   nlinha:= nlinha + 3
   @ nlinha + 1, ncoluna + 2 say arq[1]
   @ nlinha + 2, ncoluna + 2 say arq[2]
   @ nlinha + 3, ncoluna + 2 say arq[3]
   @ nlinha + 4, ncoluna + 2 say arq[4]
   @ nlinha + 5, ncoluna + 2 say arq[5]
   @ nlinha + 6, ncoluna + 2 say arq[6]
   @ nlinha + 7, ncoluna + 2 say arq[7]
   @ nlinha + 8, ncoluna + 2 say arq[8]
   @ nlinha + 9, ncoluna + 2 say arq[9]
   @ nlinha + 10, ncoluna + 2 say arq[10]
   @ nlinha + 11, ncoluna + 2 say arq[11]
   @ nlinha + 12, ncoluna + 2 say arq[12]
   @ nlinha + 13, ncoluna + 2 say arq[13]
   @ nlinha + 14, ncoluna + 2 say arq[14]
   @ nlinha + 15, ncoluna + 2 say arq[15]
   @ nlinha + 16, ncoluna + 2 say arq[16]
   SetPos(nlinha + 1, ncoluna + 30)
   AAdd(getlist, qsr271({|| resp}, "RESP", "!", {|| resp[1] $ ;
      "SN "}, Nil, {1}):display())
   SetPos(nlinha + 2, ncoluna + 30)
   AAdd(getlist, qsr271({|| resp}, "RESP", "!", {|| resp[2] $ ;
      "SN "}, Nil, {2}):display())
   SetPos(nlinha + 3, ncoluna + 30)
   AAdd(getlist, qsr271({|| resp}, "RESP", "!", {|| resp[3] $ ;
      "SN "}, Nil, {3}):display())
   SetPos(nlinha + 4, ncoluna + 30)
   AAdd(getlist, qsr271({|| resp}, "RESP", "!", {|| resp[4] $ ;
      "SN "}, Nil, {4}):display())
   SetPos(nlinha + 5, ncoluna + 30)
   AAdd(getlist, qsr271({|| resp}, "RESP", "!", {|| resp[5] $ ;
      "SN "}, Nil, {5}):display())
   SetPos(nlinha + 6, ncoluna + 30)
   AAdd(getlist, qsr271({|| resp}, "RESP", "!", {|| resp[6] $ ;
      "SN "}, Nil, {6}):display())
   SetPos(nlinha + 7, ncoluna + 30)
   AAdd(getlist, qsr271({|| resp}, "RESP", "!", {|| resp[7] $ ;
      "SN "}, Nil, {7}):display())
   SetPos(nlinha + 8, ncoluna + 30)
   AAdd(getlist, qsr271({|| resp}, "RESP", "!", {|| resp[8] $ ;
      "SN "}, Nil, {8}):display())
   SetPos(nlinha + 9, ncoluna + 30)
   AAdd(getlist, qsr271({|| resp}, "RESP", "!", {|| resp[9] $ ;
      "SN "}, Nil, {9}):display())
   SetPos(nlinha + 10, ncoluna + 30)
   AAdd(getlist, qsr271({|| resp}, "RESP", "!", {|| resp[10] $ ;
      "SN "}, Nil, {10}):display())
   SetPos(nlinha + 11, ncoluna + 30)
   AAdd(getlist, qsr271({|| resp}, "RESP", "!", {|| resp[11] $ ;
      "SN "}, Nil, {11}):display())
   SetPos(nlinha + 12, ncoluna + 30)
   AAdd(getlist, qsr271({|| resp}, "RESP", "!", {|| resp[12] $ ;
      "SN "}, Nil, {12}):display())
   SetPos(nlinha + 13, ncoluna + 30)
   AAdd(getlist, qsr271({|| resp}, "RESP", "!", {|| resp[13] $ ;
      "SN "}, Nil, {13}):display())
   SetPos(nlinha + 14, ncoluna + 30)
   AAdd(getlist, qsr271({|| resp}, "RESP", "!", {|| resp[14] $ ;
      "SN "}, Nil, {14}):display())
   SetPos(nlinha + 15, ncoluna + 30)
   AAdd(getlist, qsr271({|| resp}, "RESP", "!", {|| resp[15] $ ;
      "SN "}, Nil, {15}):display())
   SetPos(nlinha + 16, ncoluna + 30)
   AAdd(getlist, qsr271({|| resp}, "RESP", "!", {|| resp[16] $ ;
      "SN "}, Nil, {16}):display())
   read
   do while (lcontrole)
      set color to (corfor)
      if (resp[1] == "S")
         @ 23,  1 clear to 23, 70
         mostrar("Clientes")
         abredbf("CLIENTES")
         if (sai(cmensprog))
            loop
         endif
         if (lcontrole)
            zap
            index on Codigo_Cli to Cliente1
            index on Nome_Cli to Cliente2
            index on Dt_Acerto to Cliente3
            index on Cgc_Cli to Cliente4
            index on Cpf_Cli to Cliente5
            @ nlinha + 1, ncoluna + 30 say "û"
         endif
      endif
      if (resp[2] == "S")
         @ 23,  1 clear to 23, 70
         mostrar("Fornecedores")
         abredbf("FORNECEDORES")
         if (sai(cmensprog))
            loop
         endif
         if (lcontrole)
            zap
            index on Codigo_For to Fornece1
            index on Nome to Fornece2
            @ nlinha + 2, ncoluna + 30 say "û"
         endif
      endif
      if (resp[3] == "S")
         @ 23,  1 clear to 23, 70
         mostrar("Funcionarios")
         abredbf("FUNCIONA")
         if (sai(cmensprog))
            loop
         endif
         if (lcontrole)
            zap
            index on Codigo_Fun to Funcion1
            index on Nome to Funcion2
            @ nlinha + 3, ncoluna + 30 say "û"
         endif
      endif
      if (resp[4] == "S")
         @ 23,  1 clear to 23, 70
         mostrar("Bancos")
         abredbf("BANCOS")
         if (sai(cmensprog))
            loop
         endif
         if (lcontrole)
            zap
            index on Conta_BC to Bancos1
            @ nlinha + 4, ncoluna + 30 say "û"
         endif
      endif
      if (resp[5] == "S")
         @ 23,  1 clear to 23, 70
         mostrar("Estoque")
         abredbf("PRODUTOS")
         select 10
         abredbf("EMPRESA")
         if (sai(cmensprog))
            loop
         endif
         select Produtos
         if (lcontrole)
            zap
            index on Codigo to Produto1
            index on Descricao to Produto2
            index on STR(Grupo,3)+Descricao to Produto3
            index on Grupo to Produto4
            index on STR(Grupo,3)+Marca+Descricao to Produto5
            abredbf("ENTRADAS")
            if (lcontrole)
               zap
               index on Num_Docto+STR(Fornecedor,5) to Entrada1
               index on Fornecedor to Entrada2
               index on Data to Entrada3
            endif
            abredbf("ENT_MAT")
            if (lcontrole)
               zap
               index on Num_Docto to Ent_Mat1
            endif
            abredbf("TRANSF")
            if (lcontrole)
               zap
               index on Data to Transf1
               index on Num_Docto to Transf2
            endif
            abredbf("TRANS_MAT")
            if (lcontrole)
               zap
               index on Num_Docto to Tra_Mat1
            endif
            abredbf("COTACAO")
            if (lcontrole)
               zap
               index on Numero to Cotacao1
            endif
            abredbf("COT_MAT")
            if (lcontrole)
               zap
               index on Numero to Cot_Mat1
               index on STR(Numero,5)+Codigo_Mat to Cot_Mat2
            endif
            @ nlinha + 5, ncoluna + 30 say "û"
         endif
      endif
      if (resp[6] == "S")
         @ 23,  1 clear to 23, 70
         mostrar("Grupo")
         abredbf("GRUPO")
         if (sai(cmensprog))
            loop
         endif
         if (lcontrole)
            zap
            index on Grupo to Grupo
            index on Descricao to Grupo1
            @ nlinha + 6, ncoluna + 30 say "û"
         endif
      endif
      if (resp[7] == "S")
         @ 23,  1 clear to 23, 70
         mostrar("Movimento Banc rio")
         abredbf("MOV_BCO")
         if (sai(cmensprog))
            loop
         endif
         if (lcontrole)
            zap
            index on STR(CONTA_MB)+DOCTO_MB to MV_BCO1
            index on DATA_MB to MV_BCO2
            index on CONTA_MB to MV_BCO3
            @ nlinha + 7, ncoluna + 30 say "û"
         endif
      endif
      if (resp[8] == "S")
         @ 23,  1 clear to 23, 70
         mostrar("Movimento de Funcion rios")
         abredbf("MOV_FUN")
         if (sai(cmensprog))
            loop
         endif
         if (lcontrole)
            zap
            index on STR(Codigo,5)+DOCTO to MV_FUN1
            index on DATA to MV_FUN2
            index on Codigo to MV_FUN3
            @ nlinha + 8, ncoluna + 30 say "û"
         endif
      endif
      if (resp[9] == "S")
         @ 23,  1 clear to 23, 70
         mostrar("Contas a Receber")
         abredbf("CONTASAR")
         if (sai(cmensprog))
            loop
         endif
         if (lcontrole)
            zap
            index on Num_Doc_AR+STR(Cod_Cli_AR,5) to ContAR1
            index on Cod_Cli_AR to ContAR2
            index on DT_VENC_AR to ContAR3
            index on STR(LOJA,2)+STR(Num_Ped_AR,5) to ContAR4
            @ nlinha + 9, ncoluna + 30 say "û"
         endif
      endif
      if (resp[10] == "S")
         @ 23,  1 clear to 23, 70
         mostrar("Contas Recebidas")
         abredbf("CONTASRE")
         if (sai(cmensprog))
            loop
         endif
         if (lcontrole)
            zap
            index on Num_Doc_RE+STR(Cod_Cli_RE,5) to ContRE1
            index on Cod_Cli_RE to ContRE2
            index on DT_RECE_RE to ContRE3
            index on STR(LOJA,2)+STR(Num_Ped_RE,5) to ContRE4
            @ nlinha + 10, ncoluna + 30 say "û"
         endif
      endif
      if (resp[11] == "S")
         @ 23,  1 clear to 23, 70
         mostrar("Contas a Pagar")
         abredbf("CONTASAP")
         if (sai(cmensprog))
            loop
         endif
         if (lcontrole)
            use CONTASAP exclusive
            zap
            index on Num_Doc_AP+STR(Cod_For_AP,5) to ContAP1
            index on Cod_For_AP to ContAP2
            index on DT_VENC_AP to ContAP3
            @ nlinha + 11, ncoluna + 30 say "û"
         endif
      endif
      if (resp[12] == "S")
         @ 23,  1 clear to 23, 70
         mostrar("Contas Pagas")
         abredbf("CONTASPG")
         if (sai(cmensprog))
            loop
         endif
         if (lcontrole)
            zap
            index on Num_Doc_PG+STR(Cod_For_PG,5) to ContPG1
            index on Cod_For_PG to ContPG2
            index on DT_PGTO_PG to ContPG3
            @ nlinha + 12, ncoluna + 30 say "û"
         endif
      endif
      if (resp[13] == "S")
         @ 23,  1 clear to 23, 70
         mostrar("Pedidos")
         abredbf("ORCAMENT")
         if (sai(cmensprog))
            loop
         endif
         if (lcontrole)
            zap
         endif
         abredbf("ORC_MAT")
         if (sai(cmensprog))
            loop
         endif
         if (lcontrole)
            zap
         endif
         @ 23,  1 clear to 23, 70
         mostrar("Pedidos")
         abredbf("PEDIDOS")
         if (sai(cmensprog))
            loop
         endif
         if (lcontrole)
            zap
            index on STR(LOJA,2)+STR(NUMERO,5) to PEDIDOS1
            index on CLIENTE to PEDIDOS2
            index on DATA to PEDIDOS3
         endif
         @ 23,  1 clear to 23, 70
         mostrar("Ped_Mat")
         abredbf("PED_MAT")
         if (lcontrole)
            zap
            index on STR(LOJA,2)+STR(NUMERO_PED,5) to PED_MAT
         endif
         abredbf("CONSIGNA")
         if (lcontrole)
            zap
            index on NUMERO to CONSIGN1
            index on CLIENTE to CONSIGN2
            index on DATA to CONSIGN3
         endif
         @ 23,  1 clear to 23, 70
         mostrar("Con_Mat")
         abredbf("CONT_MAT")
         if (lcontrole)
            zap
            index on NUMERO_PED to CON_MAT
         endif
         abredbf("DEVOLUCA")
         if (lcontrole)
            zap
            index on NUMERO to DEVOLUC1
            index on CLIENTE to DEVOLUC2
            index on DATA to DEVOLUC3
         endif
         @ 23,  1 clear to 23, 70
         mostrar("Dev_Mat")
         abredbf("DEV_MAT")
         if (lcontrole)
            zap
            index on NUMERO_PED to DEV_MAT
         endif
         @ 23,  1 clear to 23, 70
         mostrar("Mat_Cons")
         abredbf("MAT_CONS")
         if (lcontrole)
            zap
            index on Cliente to Mat_Con1
            index on STR(Cliente,5)+Codigo_Mat to Mat_Con2
            index on Codigo_Mat to Mat_Con3
         endif
         if (sai(cmensprog))
            loop
         endif
         if (file("CONT_PED.DBF"))
            abredbf("CONT_PED")
            if (lcontrole)
               zap
               index on Numero_Ped to Cont_Ped
               index on STR(Numero_Ped,5)+Codigo_Mat to Con_Ped1
            endif
         endif
         @ 23,  1 clear to 23, 70
         mostrar("Manifestos")
         abredbf("MANIFEST")
         if (sai(cmensprog))
            loop
         endif
         if (lcontrole)
            zap
            index on STR(LOJA,2)+STR(NUMERO,5) to Manifes1
            index on CLIENTE to Manifes2
            index on DATA to Manifes3
         endif
         @ 23,  1 clear to 23, 70
         mostrar("Material dos manifestos")
         abredbf("MAN_MAT")
         if (lcontrole)
            zap
            index on STR(LOJA,2)+STR(NUMERO_PED,5) to Man_MAT
         endif
         @ nlinha + 13, ncoluna + 30 say "û"
      endif
      if (resp[14] == "S")
         @ 23,  1 clear to 23, 70
         mostrar("Notas Fiscais")
         abredbf("NOTA_FIS")
         if (sai(cmensprog))
            loop
         endif
         if (lcontrole)
            zap
            index on STR(Loja,2)+STR(Nota,5) to Nota1
            index on Data to Nota2
            index on STR(Loja,2)+STR(Pedido,5) to Nota3
         endif
         abredbf("NOTA_MAN")
         if (sai(cmensprog))
            loop
         endif
         if (lcontrole)
            zap
            index on STR(Loja,2)+STR(Nota,5) to Mani1
            index on Data to Mani2
            index on STR(Loja,2)+STR(Pedido,5) to Mani3
         endif
         abredbf("NOTA_MAT")
         abredbf("MAN_MAT")
         if (lcontrole)
            zap
            index on STR(Loja,2)+STR(Numero_Ped,5) to Nan_Ma1
            @ nlinha + 14, ncoluna + 30 say "û"
         endif
      endif
      if (resp[15] == "S")
         @ 23,  1 clear to 23, 70
         mostrar("Localizacao")
         abredbf("LOCALIZA")
         if (sai(cmensprog))
            loop
         endif
         if (lcontrole)
            zap
            index on Codigo_Loc to Localiz1
         endif
      endif
      if (resp[16] == "S")
         @ 23,  1 clear to 23, 70
         mostrar("RETORNOS")
         abredbf("RETORNO")
         if (lcontrole)
            zap
            index on STR(LOJA,2)+STR(NUMERO,5) to Retorno1
            index on CLIENTE to Retorno2
            index on DATA to Retorno3
         endif
         @ 23,  1 clear to 23, 70
         mostrar("Material dos retornos")
         abredbf("RET_MAT")
         if (lcontrole)
            zap
            index on STR(LOJA,2)+STR(NUMERO_PED,5) to Ret_MAT
         endif
         abredbf("NOTA_RET")
         if (sai(cmensprog))
            loop
         endif
         if (lcontrole)
            zap
            index on STR(Loja,2)+STR(Nota,5) to Reto1
            index on Data to Reto2
            index on STR(Loja,2)+STR(Pedido,5) to Reto3
         endif
         abredbf("COMISSAO")
         if (sai(cmensprog))
            loop
         endif
         if (lcontrole)
            zap
            index on STR(Vendedor,5)+STR(Grupo,3) to Comis1
         endif
         @ 23,  1 clear to 23, 70
         mostrar("RETORNOSs")
         abredbf("RETORNO")
         if (sai(cmensprog))
            loop
         endif
         if (lcontrole)
            zap
            index on STR(LOJA,2)+STR(NUMERO,5) to Retorno1
            index on CLIENTE to Retorno2
            index on DATA to Retorno3
         endif
         @ 23,  1 clear to 23, 70
         mostrar("Material dos retornos")
         abredbf("RET_MAT")
         if (lcontrole)
            zap
            index on STR(LOJA,2)+STR(NUMERO_PED,5) to Ret_MAT
         endif
         abredbf("NOTA_RET")
         if (sai(cmensprog))
            loop
         endif
         if (lcontrole)
            zap
            index on STR(Loja,2)+STR(Nota,5) to Reto1
            index on Data to Reto2
            index on STR(Loja,2)+STR(Pedido,5) to Reto3
         endif
         abredbf("COMISSAO")
         if (sai(cmensprog))
            loop
         endif
         if (lcontrole)
            zap
            index on STR(Vendedor,5)+STR(Grupo,3) to Comis1
         endif
         abredbf("CENT_CUS")
         zap
         index on Codigo_cc to Centro1
         index on Cod_Hier to Centro2
         @ nlinha + 15, ncoluna + 30 say "û"
         abredbf("ESTOQUE")
         zap
         abredbf("PRODUCA")
         zap
         abredbf("PROD_MAT")
         zap
         abredbf("MATERIA")
         zap
         abredbf("FAT_MAT")
         zap
      endif
      lcontrole:= .F.
   enddo
   RestScreen(0, 0, 24, 79, ctela)
   set color to (ccor)
   close databases
   select 1
   close format
   return Nil

* EOF
