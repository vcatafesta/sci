#line 12 "c:\sci\include\rddName.ch"
    EXTERNAL leto
    EXTERNAL DBFNTX
   EXTERNAL DBFCDX


    EXTERNAL DBFFPT
    EXTERNAL SIXCDX
    EXTERNAL DBFNSX
    EXTERNAL HB_MEMIO
#line 31 "sci.prg"
EXTERNAL HB_CODEPAGE_PT850
EXTERNAL HB_CODEPAGE_PTISO
EXTERNAL HB_CODEPAGE_PT860
EXTERNAL HB_CODEPAGE_UTF8
EXTERNAL HB_LANG_EN
EXTERNAL HB_LANG_PT
static s_hMutex

function Main(...)

    LOCAL lOk          := .T.
    LOCAL Opc          := 1
    LOCAL cTela
    LOCAL ph1
    PUBLI aLpt1          := {}
    PUBLI aLpt2          := {}
    PUBLI aLpt3          := {}
    PUBLI aMensagem  := {}
    PUBLI aItemNff      := {}
    PUBLI aPermissao := {}
    PUBLI aInscMun      := {}
    PUBLI aIss          := {}
    PUBLI XCFGPIRACY := MsEncrypt( "VILMAR CATAFESTA" )

    hb_langSelect( "pt" )


    PUBLI oAmbiente := TAmbiente():New()
    PUBLI oMenu     := oAmbiente
    PUBLI oIni         := TIniNew("SCI.INI")
    PUBLI oIndice     := TIndiceNew()
    PUBLI oProtege     := TProtegeNew()
    PUBLI oReindexa
    PUBLI oSci
    PUBLI cCaixa





    SetMode(oAmbiente:AlturaFonteDefaultWindows, oAmbiente:LarguraFonteDefaultWindows)
    SetColor("")
    SetaIni()

    Acesso()

    SetKey( -7,           {|| AcionaSpooler()})

    SetKey( -9,          {|| Calc()})
    SetKey( -41,          {|| ConfigurarEtiqueta()})
    SetKey( 302, {|| Altc() })
    SetKey( 23, {|| GravaDisco() })
    SetKey( -19,   {|| AutorizaVenda() })











    oAmbiente:Clock           := Time()
    oAmbiente:HoraCerta       := Array(100)
    oAmbiente:TarefaConcluida := Array(100)
    Afill( oAmbiente:HoraCerta, Time())
    Afill( oAmbiente:TarefaConcluida, .F. )




    Empresa()
    FechaTudo()
    if !VerIndice()
        Alert("ERRO Tente mais tarde.")
        FT_ChDir( oAmbiente:xBase )
        SalvaMem()
        SetMode(oAmbiente:AlturaFonteDefaultWindows, oAmbiente:LarguraFonteDefaultWindows)
        Scroll() ; SetPos( 0, 0 )
        __Quit()
    endif
    if AbreUsuario()
        Usuario()
    else
        SalvaMem()
        ResTela()
        SetMode(oAmbiente:AlturaFonteDefaultWindows, oAmbiente:LarguraFonteDefaultWindows)
        __Quit()
    endif
    SetaIni()
    oMenu:Limpa()
    SetaClasse()
    RefreshClasse()
    WHILE lOk
        BEGIN Sequence
            SetKey( -4, {|| PrecosConsulta()})
            oMenu:Limpa()
            Opc := oMenu:Show()
            Do Case
            Case opc = 0.0 .OR. opc = 1.01
                ErrorBeep()

                IF conf("Pergunta: Deseja finalizar esta sessao ?" )
                    lOk := .F.
                    Break
                EndIF
            Case opc = 1.03
                Empresa()
                IF !VerIndice()
                    Alert("ERRO: Arquivos nao disponivel para indexacao. Tente mais tarde.")
                    SalvaMem()
                    ResTela()
                    SetMode(oAmbiente:AlturaFonteDefaultWindows, oAmbiente:LarguraFonteDefaultWindows)
                    __Quit()
                EndIF
                oMenu:Limpa()
                IF AbreUsuario()
                    Usuario()
                Else
                    SalvaMem()
                    SetMode(oAmbiente:AlturaFonteDefaultWindows, oAmbiente:LarguraFonteDefaultWindows)
                    __Quit()
                EndIF
                SetaClasse()
                RefreshClasse()
            Case opc = 1.04
                IF AbreUsuario()
                    SetKey( -4, NIL )
                    Usuario()
                    SetaClasse()
                    FechaTudo()
                EndIF
                RefreshClasse()
                SetKey( -4, {|| PrecosConsulta()})
            Case opc = 1.06
                MacroBackup()
            Case opc = 1.07
                MacroRestore()
            Case opc = 2.01


                    ListaLan()
                    RefreshClasse()




            Case opc = 2.02

                    if aPermissao[2]

                        Recelan()
                        RefreshClasse()
                    else
                        Alerta("INFORME ao usuario " + oAmbiente:xUsuario + ";;Voce nao tem permissao para usar esse modulo.;Consulte o gerente de suporte para maiores informacoes.")
                    endif



            Case opc = 2.03


                    PagaLan()
                    RefreshClasse()



            Case opc = 2.04


                    Chelan()
                    RefreshClasse()



            Case Opc = 2.05

                    if aPermissao[8]

                        ScpLan()
                        RefreshClasse()
                    else
                        Alerta("INFORME ao usuario " + oAmbiente:xUsuario + ";;Voce nao tem permissao para usar esse modulo.;Consulte o gerente de suporte para maiores informacoes.")
                    endif



            Case Opc = 2.06


                    PontoLan()
                    RefreshClasse()



            Case Opc = 2.07
                Carta()
            Case Opc = 2.08


                    Venlan()
                    RefreshClasse()



            Case opc = 3.01


                    Orcamento( .F. )



            Case opc = 3.02
                IF !UsaArquivo("LISTA") ; Break ; EndiF
                IF !UsaArquivo("GRUPO") ; Break ; EndiF
                IF !UsaArquivo("SUBGRUPO") ; Break ; EndiF
                IF !UsaArquivo("PAGAR") ; Break ; EndiF
                IF !UsaArquivo("REPRES") ; Break ; EndiF
                TermPrecos()
            Case opc = 3.03
                cTela := Mensagem("Aguarde, Abrindo Arquivos.")
                IF !UsaArquivo("SAIDAS")  ; Break ; EndiF
                IF !UsaArquivo("RECEBER") ; Break ; EndiF
                IF !UsaArquivo("FORMA")   ; Break ; EndiF
                IF !UsaArquivo("LISTA")   ; Break ; EndiF
                IF !UsaArquivo("CEP")     ; Break ; EndiF
                IF !UsaArquivo("REGIAO")  ; Break ; EndiF
                ResTela( cTela )
                VendasTipo()
                FechaTudo()
            Case opc = 3.04
                cTela := Mensagem("Aguarde, Abrindo Arquivos.")
                IF !UsaArquivo("SAIDAS")  ; Break ; EndiF
                IF !UsaArquivo("RECEBER") ; Break ; EndiF
                IF !UsaArquivo("FORMA")   ; Break ; EndiF
                IF !UsaArquivo("REGIAO")  ; Break ; EndiF
                IF !UsaArquivo("RECEMOV") ; Break ; EndiF
                IF !UsaArquivo("CEP")     ; Break ; EndiF
                ResTela( cTela )
                WHILE .T.
                    oMenu:Limpa()
                    M_Title("TIPO DE RELATORIO")
                    nChoice := FazMenu( 03, 20, {"Por Vencimento", "Por Emissao *"})
                    Do Case
                    Case nChoice = 0
                        Exit
                    Case nChoice = 1
                        PrnAlfabetica(1)
                    Case nChoice = 2
                        PrnAlfabetica(2)
                    EndCase
                EndDo
                FechaTudo()
            Case opc = 3.05
                cTela := Mensagem("Aguarde, Abrindo Arquivos.")
                IF !UsaArquivo("SAIDAS")  ; Break ; EndiF
                IF !UsaArquivo("RECEBER") ; Break ; EndiF
                IF !UsaArquivo("RECEBIDO"); Break ; EndiF
                IF !UsaArquivo("VENDEDOR"); Break ; EndiF
                IF !UsaArquivo("FORMA")   ; Break ; EndiF
                IF !UsaArquivo("REGIAO")  ; Break ; EndiF
                ResTela( cTela )
                RelRecebido()
                FechaTudo()
            Case opc = 3.06
                IF UsaArquivo("VENDEDOR" )
                    CadastraSenha()
                    FechaTudo()
                EndIF
            Case opc = 3.08
                IF !UsaArquivo("RECEBIDO") ; Break ; EndiF
                IF !UsaArquivo("VENDEDOR") ; Break ; EndiF
                IF !UsaArquivo("CHEMOV")   ; Break ; EndiF
                IF !UsaArquivo("RECEMOV")  ; Break ; EndiF
                IF !UsaArquivo("RECEBER")  ; Break ; EndiF
                IF !UsaArquivo("SAIDAS")   ; Break ; EndiF
                DetalheCaixa(, .F. )
                FechaTudo()
            Case opc = 3.09
                IF !UsaArquivo("RECEBIDO") ; Break ; EndiF
                IF !UsaArquivo("VENDEDOR") ; Break ; EndiF
                IF !UsaArquivo("CHEMOV")   ; Break ; EndiF
                IF !UsaArquivo("RECEMOV")  ; Break ; EndiF
                IF !UsaArquivo("RECEBER")  ; Break ; EndiF
                IF !UsaArquivo("SAIDAS")  ; Break ; EndiF
                DetalheCaixa(, .T. )
                FechaTudo()
            Case opc = 3.10
                IF !UsaArquivo("RECEBIDO") ; Break ; EndiF
                IF !UsaArquivo("VENDEDOR") ; Break ; EndiF
                IF !UsaArquivo("CHEMOV")   ; Break ; EndiF
                IF !UsaArquivo("RECEMOV")  ; Break ; EndiF
                IF !UsaArquivo("RECEBER")  ; Break ; EndiF
                IF !UsaArquivo("CHEQUE")   ; Break ; EndiF
                IF !UsaArquivo("SAIDAS")   ; Break ; EndiF
                DetalheCaixa(, .T., Opc )
                FechaTudo()
            Case opc = 3.11
                IF !UsaArquivo("VENDEDOR") ; Break ; EndiF
                IF !UsaArquivo("RECIBO")   ; Break ; EndiF
                DetalheRecibo(,1)
                FechaTudo()
            Case opc = 3.12
                IF !UsaArquivo("VENDEDOR") ; Break ; EndiF
                IF !UsaArquivo("RECIBO")   ; Break ; EndiF
                DetalheRecibo(,2)
                FechaTudo()
            Case opc = 3.13
                IF !UsaArquivo("VENDEDOR") ; Break ; EndiF
                IF !UsaArquivo("RECIBO")   ; Break ; EndiF
                DetalheRecibo(,3)
                FechaTudo()
            Case opc = 3.15
                IF UsaArquivo("SAIDAS")
                    IF UsaArquivo("LISTA")
                        IF UsaArquivo("RECEBER")
                            ImprimeDebito()
                            FechaTudo()
                        EndIF
                    EndIF
                EndIF
            Case opc = 3.16
                IF UsaArquivo("SAIDAS")
                    IF UsaArquivo("LISTA")
                        IF UsaArquivo("RECEBER")
                            IF UsaArquivo("CHEQUE")
                                IF UsaArquivo("CHEMOV")
                                    MostraDebito()
                                    FechaTudo()
                                EndIF
                            EndIF
                        EndIF
                    EndIF
                EndIF
            Case opc = 3.17
                IF UsaArquivo("SAIDAS")
                    IF UsaArquivo("LISTA")
                        IF UsaArquivo("RECEBER")
                            DebitoC_C()
                            FechaTudo()
                        EndIF
                    EndIF
                EndIF
            Case opc = 3.18
                IF !UsaArquivo("LISTA")    ; Break ; EndiF
                IF !UsaArquivo("RECEBER")  ; Break ; EndiF
                IF !UsaArquivo("SAIDAS")   ; Break ; EndiF
                IF !UsaArquivo("CHEMOV")   ; Break ; EndiF
                IF !UsaArquivo("CHEQUE")   ; Break ; EndiF
                IF !UsaArquivo("VENDEDOR") ; Break ; EndiF
                BaixaDebitoc_c()
                FechaTudo()
            Case opc = 3.20
                EcfComandos()
            Case opc = 4.01
                MacroBackup()
            Case opc = 4.02
                MacroRestore()
                oMenu:Limpa()
                ErrorBeep()
                IF Conf("Pergunta: Reindexar os Arquivos Agora ?")
                    IF MenuIndice()
                        CriaIndice()
                    EndIF
                EndIF
            Case Opc = 4.03
                GeraBatch()
            Case Opc = 4.05
                 if MenuIndice()
                     CriaIndice()
                 endif
            Case Opc = 4.06
                 IF MenuIndice()
                     FechaTudo()
                     IF AbreArquivo()
                         Duplicados()
                         CriaIndice()
                     EndIF
                 EndIF
            Case Opc = 4.07
                 IF MenuIndice()
                     Reindexar()
                     oIndice:Compactar     := .F.
                     oIndice:ProgressoNtx := .F.
                 EndIF
            Case Opc = 4.08
                ExcluirTemporarios()
            Case Opc = 5.01
                Edicao()
            Case Opc = 5.02
                Impressao()
            Case Opc = 5.03
                FechaTudo()

                aThreads := {}
                s_hMutex := hb_mutexCreate()
                lEnd     := .F.
                dbUseArea( .T.,, "PRINTER",, iif( .T. .OR. .F., ! .F., NIL ), .F. ) ; HB_DBDETACH( "PRINTER" ); AAdd( aThreads, hb_threadStart(3,@CriaIndice(), "PRINTER", @lEnd ))
                dbUseArea( .T.,, "RECEBER",, iif( .T. .OR. .F., ! .F., NIL ), .F. ) ; HB_DBDETACH( "RECEBER" ); AAdd( aThreads, hb_threadStart(3,@CriaIndice(), "RECEBER", @lEnd ))
                dbUseArea( .T.,, "RECEMOV",, iif( .T. .OR. .F., ! .F., NIL ), .F. ) ; HB_DBDETACH( "RECEMOV" ); AAdd( aThreads, hb_threadStart(3,@CriaIndice(), "RECEMOV", @lEnd ))
                dbUseArea( .T.,, "NOTA",, iif( .T. .OR. .F., ! .F., NIL ), .F. ) ; HB_DBDETACH( "NOTA" );    AAdd( aThreads, hb_threadStart(3,@CriaIndice(), "NOTA",    @lEnd ))
                Inkey( 5 )
                lEnd := .T.
                AEval( aThreads, {| x | hb_threadJoin( x ) } )

            Case oPc = 6.01
                Spooler()
            Case oPc = 6.02
                oMenu:SetaFonte()
                SalvaMem()
            Case oPc = 6.04
                oMenu:SetaCor( 3 )
                SalvaMem()
            Case oPc = 6.05
                oMenu:SetaCor( 1 )
                SalvaMem()
            Case oPc = 6.06
                oMenu:SetaCor( 2 )
                SalvaMem()
            Case oPc = 6.07
                oMenu:SetaCorAlerta(8)
                oAmbiente:CorAlerta := oMenu:CorAlerta
                SalvaMem()
            Case oPc = 6.08
                oMenu:SetaCorBorda(10)
                SalvaMem()
            Case oPc = 6.09
                oMenu:SetaCor( 4 )
                SalvaMem()
            Case oPc = 6.10
                oMenu:SetaCorMsg(9)
                oAmbiente:CorMsg := oMenu:CorMsg
                SalvaMem()
            Case oPc = 6.11
                oMenu:SetaCor( 5 )
                SalvaMem()
            Case oPc = 6.12
                oMenu:SetaCor( 6 )
                SalvaMem()
            Case oPc = 6.13
                oMenu:SetaCor( 7 )
                SalvaMem()
            Case oPc = 6.15
                oMenu:SetaPano()
                SalvaMem()
            Case oPc = 6.16
                oMenu:SetaFrame()
                SalvaMem()
            Case oPc = 6.17
                oMenu:Sombra      := !(oIni:ReadBool( oAmbiente:xUsuario, "sombra", .F. ))
                oAmbiente:Sombra := oMenu:Sombra
                oMenu:SetaSombra()
                oMenu:Menu := oSciMenuSci()
                SalvaMem()
            Case oPc = 6.18
                oAmbiente:Get_Ativo := !(oIni:ReadBool( oAmbiente:xUsuario, "get_ativo", .F. ))
                oMenu:Menu := oSciMenuSci()
                SalvaMem()
            Case oPc = 6.19
                IF !UsaArquivo("USUARIO") ; Break ; EndIF
                IF !UsaArquivo("PRINTER") ; Break ; EndIF
                AltSenha()
                FechaTudo()
            Case Opc = 7.01
                oMenu:Limpa()
                Diretorio( 03, 05, MaxRow() - 2, "W+/B,N/W,,,W+/N")
            Case Opc = 7.02
                TbDemo()
            Case Opc = 7.04
                 IF MenuIndice()
                     CriaIndice()
                 EndIF
            Case Opc = 7.05
                 IF MenuIndice()
                     FechaTudo()
                     IF AbreArquivo()
                         Duplicados()
                         CriaIndice()
                     EndIF
                 EndIF
            Case Opc = 7.07
                 ExcluirTemporarios()
            Case opc = 7.08
                IF !UsaArquivo("USUARIO") ; Break ; EndIF
                IF !UsaArquivo("PRINTER") ; Break ; EndIF
                CadastraUsuario()
                RefreshClasse()
                FechaTudo()
            Case opc = 7.09
                ConfBaseDados()
                FechaTudo()
            Case opc = 7.10

                    IF !UsaArquivo("RETORNO") ; Break ; EndIF
                    IF !UsaArquivo("RECEBER") ; Break ; EndIF
                    IF !UsaArquivo("RECEMOV") ; Break ; EndIF
                    IF !UsaArquivo("CEP")     ; Break ; EndIF
                    IF !UsaArquivo("REGIAO")  ; Break ; EndIF
                    Retorno()
                    FechaTudo()

            Case opc = 7.11
                Alerta("Informa: Em implantacao.")





            Case opc = 7.12
                AutoCaixa()
                FechaTudo()
            Case opc = 7.13
                ZeraCaixa()
                FechaTudo()
            Case oPc = 7.14
                CadastroImpressoras()
                FechaTudo()
            Case oPc =7.15
                PrinterDbedit()
                FechaTudo()
            Case oPc = 7.16
                CenturyOn()
                Hard( 3 )
                oMenu:Limpa()
                oMenu:CorCabec := Roloc( oMenu:CorCabec )
                oMenu:StatSup("SOBRE O " + SISTEM_NA1 + " " + SISTEM_VERSAO )
                Info(2)
                CenturyOff()
            Case opc = 8.01
                IntBaseDados()
            Case opc = 8.02
                CriaNewNota()
            Case oPc = 8.03
                 ErrorBeep()
                 IF Conf("Pergunta: Continuar com a opera‡ao ?")
                     CriaNewPrinter()
                     FechaTudo()
                     IF AbreArquivo("PRINTER")
                         oIndice:ProgressoNtx := .T.
                         CriaIndice("PRINTER")
                         oIndice:ProgressoNtx := .F.
                         FechaTudo()
                     EndIF
                 EndIF
            Case oPc = 8.04
                 ErrorBeep()
                 IF Conf("Pergunta: Continuar com a opera‡ao ?")
                     CriaNewEnt()
                     FechaTudo()
                     IF AbreArquivo("ENTNOTA")
                         oIndice:ProgressoNtx := .T.
                         CriaIndice("ENTNOTA")
                         oIndice:ProgressoNtx := .F.
                         FechaTudo()
                     EndIF
                 EndIF
            Case oPc = 8.05
                 ErrorBeep()
                 IF Conf("Pergunta: Continuar com a opera‡ao ?")
                     Fechatudo()
                     IF AbreArquivo("PREVENDA")
                         oIndice:ProgressoNtx := .T.
                         oIndice:Compactar     := .T.
                         CriaIndice("PREVENDA")
                         oIndice:ProgressoNtx := .F.
                         oIndice:Compactar     := .F.
                         FechaTudo()
                     EndIF
                 EndIF
            Case Opc = 9.01
                Dos()
            Case Opc = 9.02
                Comandos()
            Case opc = 10.01
                oMenu:Limpa()
                oMenu:CorCabec := Roloc( oMenu:CorCabec )
                oMenu:StatSup("SOBRE O " + SISTEM_NA1 + " " + SISTEM_VERSAO )
                Info(2)
            Case oPc = 10.02
                Novidades()
            Case oPc = 10.03
                Help()
            EndCase
        Recover

            FechaTudo()
        endsequence
    EndDo
    Encerra()


function SetaClasse()

    LOCAL cSn1 := SISTEM_NA1
    LOCAL cSn2 := SISTEM_NA2
    LOCAL cSn3 := SISTEM_NA3
    LOCAL cSn4 := SISTEM_NA4
    LOCAL cSn5 := SISTEM_NA5
    LOCAL cSn6 := SISTEM_NA6
    LOCAL cSn7 := SISTEM_NA7
    LOCAL cSn8 := SISTEM_NA8

    LOCAL cSv  := SISTEM_VERSAO
    LOCAL cSp  := Space(1)
    LOCAL cSt1 := "F1-HELP³F5-PRECOS³F10-CALC³"
    LOCAL cSt2 := "F1-HELP³F5-LISTA³F8-SPOOL³ESC-RETORNA³"
    LOCAL cSt3 := "F1-HELP³F5-LISTA³F8-SPOOL³ESC-RETORNA³"
    LOCAL cSt4 := "F1-HELP³F5-LISTA³F8-SPOOL³ESC-RETORNA³"
    LOCAL cSt5 := "F1-HELP³F5-LISTA³F8-SPOOL³ESC-RETORNA³"
    LOCAL cSt6 := "F1-HELP³F5-LISTA³F8-SPOOL³ESC-RETORNA³"
    LOCAL cSt7 := "F1-HELP³F5-LISTA³F8-SPOOL³ESC-RETORNA³"
    LOCAL cSt8 := "F1-HELP³F5-LISTA³F8-SPOOL³ESC-RETORNA³"

    oMenu:StSupArray               := { cSn1+cSp+cSv, cSn2+cSp+cSv,cSn3+cSp+cSv,cSn4+cSp+cSv,cSn5+cSp+cSv,cSn6+cSp+cSv, cSn7+cSp+cSv, cSn8+cSp+cSv }
    oMenu:StInfArray               := { cSt1, cSt2, cSt3, cSt4, cSt5, cSt6, cSt7, cSt8,  }
    oMenu:MenuArray                := { oSciMenuSci(), oMenuTesteLan(),   oMenuRecelan(),   oMenuPagaLan(),   oMenuChelan(),   oMenuVenLan(), oMenuScpLan(), oMenuPontoLan() }
    oMenu:DispArray                := { aDispSci(),    aDispTesteLan(),   aDispRecelan(),   aDispPagaLan(),   aDispChelan(),   aDispVenLan(), aDispScpLan(), aDispPontoLan() }


    Return


function RefreshClasse()
    oMenu:StatusSup                  := oMenu:StSupArray[1]
    oMenu:StatusInf                    := oMenu:StInfArray[1]
    oMenu:Menu                             := oMenu:MenuArray[1]
    oMenu:Disp                          := oMenu:DispArray[1]


    return nil


function SalvaMem()
    oIni:WriteString(  oAmbiente:xUsuario,    "frame",         oMenu:Frame )
    oIni:WriteString(  oAmbiente:xUsuario,    "panofundo",     oMenu:PanoFundo )
    oIni:WriteInteger( oAmbiente:xUsuario, "selecionado",   oMenu:Selecionado )
    oIni:WriteInteger( oAmbiente:xUsuario, "cormenu",       oMenu:CorMenu )
    oIni:WriteInteger( oAmbiente:xUsuario, "CorLightBar",   oMenu:CorLightBar )
    oIni:WriteInteger( oAmbiente:xUsuario, "CorHotKey",     oMenu:CorHotKey )
    oIni:WriteInteger( oAmbiente:xUsuario, "CorHKLightBar", oMenu:CorHKLightBar)
    oIni:WriteInteger( oAmbiente:xUsuario, "corfundo",      oMenu:Corfundo )
    oIni:WriteInteger( oAmbiente:xUsuario, "corcabec",      oMenu:CorCabec )
    oIni:WriteInteger( oAmbiente:xUsuario, "cordesativada", oMenu:CorDesativada )
    oIni:WriteInteger( oAmbiente:xUsuario, "corbox",        oMenu:CorBox )
    oIni:WriteInteger( oAmbiente:xUsuario, "corcima",       oMenu:CorCima )
    oIni:WriteInteger( oAmbiente:xUsuario, "corantiga",     oMenu:CorAntiga )
    oIni:WriteInteger( oAmbiente:xUsuario, "corborda",      oMenu:CorBorda )
    oIni:WriteInteger( oAmbiente:xUsuario, "fonte",         oMenu:Fonte )
    oIni:WriteInteger( oAmbiente:xUsuario, "fonte",         oMenu:Fonte )
    oIni:WriteInteger( oAmbiente:xUsuario, "FonteManualAltura", oMenu:FonteManualAltura )
    oIni:WriteInteger( oAmbiente:xUsuario, "FonteManualLargura", oMenu:FonteManualLargura )
    oIni:WriteInteger( oAmbiente:xUsuario, "coralerta",     oAmbiente:CorAlerta )
    oIni:WriteInteger( oAmbiente:xUsuario, "cormsg",        oAmbiente:CorMsg )
    oIni:WriteBool(    oAmbiente:xUsuario, "sombra",        oMenu:Sombra )
    oIni:WriteBool(    oAmbiente:xUsuario, "get_ativo",     oAmbiente:Get_Ativo )

    SetaIni()
    return NIL


function SetaIni()
    oMenu:Frame                  := oIni:ReadString( oAmbiente:xUsuario,  "frame",         oAmbiente:Frame )
    oMenu:PanoFundo             := oIni:ReadString( oAmbiente:xUsuario,  "panofundo",     oAmbiente:PanoFundo )
    oMenu:CorMenu                 := oIni:ReadInteger( oAmbiente:xUsuario, "cormenu",       oAmbiente:CorMenu )
    oMenu:CorMsg                 := oIni:ReadInteger( oAmbiente:xUsuario, "cormsg",        oAmbiente:CorMsg )
    oMenu:CorFundo              := oIni:ReadInteger( oAmbiente:xUsuario, "corfundo",      oAmbiente:Corfundo )
    oMenu:CorCabec              := oIni:ReadInteger( oAmbiente:xUsuario, "corcabec",      oAmbiente:CorCabec )
    oMenu:CorDesativada         := oIni:ReadInteger( oAmbiente:xUsuario, "cordesativada", oAmbiente:CorDesativada )
    oMenu:CorBox                 := oIni:ReadInteger( oAmbiente:xUsuario, "corbox",        oAmbiente:CorBox )
    oMenu:CorCima                 := oIni:ReadInteger( oAmbiente:xUsuario, "corcima",       oAmbiente:CorCima )
    oMenu:Selecionado          := oIni:ReadInteger( oAmbiente:xUsuario, "selecionado",   oAmbiente:Selecionado )
    oMenu:CorAntiga             := oIni:ReadInteger( oAmbiente:xUsuario, "corantiga",     oAmbiente:CorAntiga )
    oMenu:CorBorda              := oIni:ReadInteger( oAmbiente:xUsuario, "corborda",      oAmbiente:CorBorda )
    oMenu:CorAlerta             := oIni:ReadInteger( oAmbiente:xUsuario, "coralerta",     oAmbiente:CorAlerta )
    oMenu:Fonte                  := oIni:ReadInteger( oAmbiente:xUsuario, "fonte",         oAmbiente:Fonte )
    oMenu:FonteManualAltura  := oIni:ReadInteger( oAmbiente:xUsuario, "FonteManualAltura", oAmbiente:FonteManualAltura )
    oMenu:FonteManualLargura := oIni:ReadInteger( oAmbiente:xUsuario, "FonteManualLargura", oAmbiente:FonteManualLargura )
    oMenu:Sombra                  := oIni:ReadBool( oAmbiente:xUsuario,      "sombra",        oAmbiente:Sombra )
    oMenu:CorLightBar        := oIni:ReadInteger( oAmbiente:xUsuario, "CorLightBar",   oAmbiente:CorLightBar )
    oMenu:CorHotKey          := oIni:ReadInteger( oAmbiente:xUsuario, "CorHotKey",     oAmbiente:CorHotKey )
    oMenu:CorHKLightBar      := oIni:ReadInteger( oAmbiente:xUsuario, "CorHKLightBar", oAmbiente:CorHKLightBar)
    oMenu:SetaSombra()

    oAmbiente:Get_Ativo           := oIni:ReadBool( oAmbiente:xUsuario,    "get_ativo",     oAmbiente:Get_Ativo )
    oAmbiente:Mostrar_Desativados := oIni:ReadBool( "sistema","Mostrar_Desativados", oAmbiente:Mostrar_Desativados )
    oAmbiente:Mostrar_Recibo      := oIni:ReadBool( "sistema","Mostrar_Recibo", oAmbiente:Mostrar_Recibo )
    oAmbiente:Frame               := oMenu:Frame
    oAmbiente:PanoFundo             := oMenu:PanoFundo
    oAmbiente:CorMenu               := oMenu:CorMenu
    oAmbiente:CorLightBar         := oMenu:CorLightBar
    oAmbiente:CorHotKey           := oMenu:CorHotKey
    oAmbiente:CorHKLightBar       := oMenu:CorHKLightBar
    oAmbiente:CorMsg                  := oMenu:CorMsg
    oAmbiente:CorFundo              := oMenu:CorFundo
    oAmbiente:CorCabec              := oMenu:CorCabec
    oAmbiente:CorDesativada       := oMenu:CorDesativada
    oAmbiente:CorBox                  := oMenu:CorBox
    oAmbiente:CorCima               := oMenu:CorCima
    oAmbiente:Selecionado          := oMenu:Selecionado
    oAmbiente:CorAntiga              := oMenu:CorAntiga
    oAmbiente:CorBorda              := oMenu:CorBorda
    oAmbiente:CorAlerta              := oMenu:CorAlerta
    oAmbiente:Fonte                  := oMenu:Fonte
    oAmbiente:FonteManualAltura   := oMenu:FonteManualAltura
    oAmbiente:FonteManualLargura  := oMenu:FonteManualLargura
    oAmbiente:Sombra                  := oMenu:Sombra
    IF oAmbiente:Fonte > 1
        Eval( oAmbiente:TabelaFonte[ oAmbiente:Fonte] )
    EndIF
    return( NIL)



Proc GeraBatch()

LOCAL Handle
LOCAL xBatch := oAmbiente:xBase + "\SALVA.BAT"

oMenu:Limpa()
Alerta("Este procedimento ira gerar um arquivo para copia;de seguranca externa se porventura tiver algum ;problema ao fazer copia de seguranca interna.")
Ferase( xBatch )
handle := FCreate( xBatch )
IF ( Ferror() <> 0 )
    Alert("Erro de Criacao de " + xBatch )
    Return
EndIF
FWriteLine( Handle, "@ECHO OFF")
FWriteLine( Handle, "CLS")
FWriteLine( Handle, Left( oAmbiente:xBase, 2 ))
FWriteLine( Handle, "CD " + oAmbiente:xBase )
FWriteLine( Handle, "ECHO ÕÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¸")
FWriteLine( Handle, "ECHO ³ ÝÝÝÝ  ÝÝÝÝMacrosoft           ³Av Castelo Branco, 693 - Pioneiros           ³")
FWriteLine( Handle, "ECHO ³ ÝÝ ÝÝÝÝ ÝÝ   Informatica      ³Fone (69)3451-3085                           ³")
FWriteLine( Handle, "ECHO ³ ÝÝ  ÝÝ  ÝÝ      Ltda          ³76976-000/Pimenta Bueno - Rondonia           ³")
FWriteLine( Handle, "ECHO ÔÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¾")
FWriteLine( Handle, "ECHO ")
FWriteLine( Handle, "ECHO ÕÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¸")
FWriteLine( Handle, "ECHO ³ Insira o disco de backup no drive A: e tecle ENTER para iniciar             ³")
FWriteLine( Handle, "ECHO ³                                                                             ³")
FWriteLine( Handle, "ECHO ³ CUIDADO!! Os dados do drive A: serao todos apagados.                        ³")
FWriteLine( Handle, "ECHO ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ")
FWriteLine( Handle, "PAUSE >NUL")
FWriteLine( Handle, "COMPRIME -EX -RP -SMSIL -&F A:\SCI *.DBF + *.CFG + *.DOC + *.TXT + *.BAT + *.ETI + *.NFF + *.COB + *.DUP")
FClose( Handle )
Alerta("Arquivo criado: " + xBatch + ";Finalize a execucao do sistema e digite SALVA [enter].")
Return

Proc Impressao()

LOCAL GetList := {}
LOCAL cScreen := SaveScreen()
LOCAL Files   := "*.DOC"
LOCAL lCancel := .F.
LOCAL nTam      := MaxCol()
LOCAL Arquivo
LOCAL nCopias
LOCAL x
LOCAL Campo
LOCAL Linha
LOCAL Linhas
LOCAL Imprime

Arquivo := Space( 24 )
MaBox( 16, 10, 18, 61 )
SetCursor(1) ; DevPos( 17, 11 ) ; DevOut( "Arquivo a Imprimir..:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( Arquivo, "Arquivo", "@!",,))
ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
IF LastKey() = 27
    ResTela( cScreen )
    Return
EndIF
FT_ChDir( oAmbiente:xBaseDoc )
LETO_SET( 7, ( oAmbiente:xBaseDoc ) )
IF Empty( Arquivo )
    M_Title( "Setas CIMA/BAIXO Move")
    Arquivo := Mx_PopFile( 03, 10, 15, 61, Files, Cor())
    IF Empty( Arquivo )
        FT_ChDir( oAmbiente:xBaseDados )
        LETO_SET( 7, ( oAmbiente:xBaseDados ) )
        ErrorBeep()
        ResTela( cScreen )
        Return
  EndIF
Else
    IF !File( Arquivo )
        FT_ChDir( oAmbiente:xBaseDados )
        LETO_SET( 7, ( oAmbiente:xBaseDados ) )
        ErrorBeep()
        ResTela( cScreen )
        Alert( Rtrim( Arquivo ) + " Nao Encontrado... " )
        ResTela( cScreen )
        Return
    EndIF
EndIF
nCopias := 1
MaBox( 19, 10, 21, 31 )
SetCursor(1) ; DevPos( 20, 11 ) ; DevOut( "Qtde Copias...:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nCopias, "nCopias", "999", {|| nCopias > 0},))
ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
IF LastKey() = 27 .OR. !Instru80()
    FT_ChDir( oAmbiente:xBaseDados )
    LETO_SET( 7, ( oAmbiente:xBaseDados ) )
    ResTela( cScreen )
    Return
EndIF
Mensagem("Aguarde, Imprimindo")
PrintOn()
SetPrc( 0, 0 )
For X := 1 To nCopias
     Campo      := MemoRead( Arquivo )
     Linhas      := MlCount( Campo, 80 )
     For Linha := 1 To Linhas
         Imprime := MemoLine( Campo, 80, linha )
         Write( 0 + Linha -1, 0, Imprime )
     Next
     __Eject()
Next
PrintOff()
FT_ChDir( oAmbiente:xBaseDados )
LETO_SET( 7, ( oAmbiente:xBaseDados ) )
ResTela( cScreen )
Return



function Seta( Mode, Line, Col )
    Do Case
    Case Mode = 0
        Return(0)
    Case LastKey() = -1
        Return( 23 )
    OtherWise
        Return(0)
    EndCase



function empresa( cTela )
    LOCAL cScreen := SaveScreen()
    LOCAL GetList := {}
    LOCAL cCodi   := Space(4)
    LOCAL cBase   := oAmbiente:xBase
    LOCAL cBaseDados
    LOCAL cScr
    LOCAL cCmd
    LOCAL cSpooler
    LOCAL cHtm
    LOCAL cDoc
    LOCAL cTxt
    LOCAL nTela

    if right(ltrim(rtrim(oAmbiente:xBase)),1) == "/"
        oAmbiente:xBase := left(oAmbiente:xBase, len(oAmbiente:xBase)-1)
    endif
    cBase := oAmbiente:xBase
    oMenu:Limpa()
    Info(2)
    FechaTudo()
    FT_ChDir(cBase)
    LETO_SET( 7, (cBase) )
    CriaBcoDadosEmpresa()

    while(.T.)
        nTela := MaBox( 02, 10, 06, MaxCol()-15, "SELECIONE EMPRESA" )
        DevPos( 03, 11 ) ; DevOut( "Site Dados.: " + cBase )
        SetCursor(1) ; DevPos( 04, 11 ) ; DevOut( "Codigo.....:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodi, "cCodi", "9999", {|| EmpErrada( @cCodi,,Row()+1, 24 )},))
        DevPos( 05, 11 ) ; DevOut( "Empresa....:" )
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        IF LastKey() = 27
            IF Conf("Pergunta: Encerrar a Execucao do Sistema ?")
                Encerra()
            EndIF
            Loop
        EndIF

        if Conf("Pergunta: Selecao de Empresa Correta ?")
            oIni:Close()
            cScr          := Mensagem("Informa: Aguarde...")

            if (oAmbiente:Letoativo)
                __SEP              := ""
                cBase              := ""
                oAmbiente:xBase    := cBase
                oAmbiente:LetoPath := cBase
            else
               __SEP := "\"
                cBase := oAmbiente:xBase
            endif

            oIni           := TIniNew("SCI" + oAmbiente:_EMPRESA + ".INI")
            cCmd          := cBase + __SEP + "CMD"
            cDoc          := cBase + __SEP + "DOC"
            cSpooler   := cBase + __SEP + "SPOOLER"
            cTmp       := cBase + __SEP + "TMP"
            cTxt       := cBase + __SEP + "TXT"
            cHtm       := cBase + __SEP + "HTM"
            cBaseDados := cBase + __SEP + "EMP" + cCodi

            oMenu:CodiFirma            := cCodi
            oMenu:NomeFirma               := ltrim(rtrim(Empresa->Nome))
            oAmbiente:RelatorioCabec   := oIni:ReadString("sistema","relatoriocabec", "TURBONET INFORMATICA"   + Space(40-Len("TURBONET INFORMATICA")))
            oAmbiente:xFanta           := oIni:ReadString("sistema","fantasia",       "TURBONET INFORMATICA"   + Space(40-Len("TURBONET INFORMATICA")))
            oAmbiente:xEmpresa         := oIni:ReadString("sistema","nomeempresa",    XNOMEFIR + Space(40-Len(XNOMEFIR)))
            oAmbiente:xNomefir         := oIni:ReadString("sistema","nomeempresa",    XNOMEFIR + Space(40-Len(XNOMEFIR)))
            oAmbiente:xJuroMesSimples  := oIni:ReadInteger("financeiro","JuroMesSimples", 0)
            oAmbiente:xJuroMesComposto := oIni:ReadInteger("financeiro","JuroMesComposto", 0)
            oAmbiente:aSciArray[1,1]  := Empresa->Juro
            oAmbiente:aSciArray[1,2]        := Empresa->DiasApos
            oAmbiente:aSciArray[1,3]        := Empresa->DescApos
            oAmbiente:aSciArray[1,4]           := Empresa->Multa
            oAmbiente:aSciArray[1,5]        := Empresa->DiaMulta
            oAmbiente:aSciArray[1,6]        := Empresa->Carencia
            oAmbiente:aSciArray[1,7]        := Empresa->Desconto
            oAmbiente:aSciArray[1,8] := oAmbiente:xJuroMesComposto
            aMensagem  := { Empresa->Mens1, Empresa->Mens2, Empresa->Mens3, Empresa->Mens4 }
            aItemNff   := { Empresa->ItemNff }
            aInscMun   := { Empresa->InscMun  }
            aIss          := { Empresa->Iss    }
            FechaTudo()
            ms_makeDir(cBaseDados, cCmd, cDoc, cSpooler, cTxt, cHtm, cTmp)

            if (oAmbiente:Letoativo)
                cBaseDados         += "/"
                cDoc                   += "/"
                cTxt                   += "/"
                cTmp                   += "/"
            endif
            oAmbiente:LetoPath   := cBaseDados
            oAmbiente:xBase      := cBaseDados
            oAmbiente:xBaseDoc   := cDoc
            oAmbiente:xBaseTxt   := cTxt
            oAmbiente:xBaseTmp   := cTmp
            oAmbiente:xBaseDados := cBaseDados
            LETO_SET( 7, (cBaseDados) )
            FT_ChDir( cBaseDados )
            resTela( cScr )
            CriaArquivo()
            return nil
        EndIF
    Enddo


function ms_makeDir(cBaseDados, cCmd, cDoc, cSpooler, cTxt, cHtm, cTmp)
    if (oAmbiente:LetoAtivo)
        Leto_MakeDir( cBaseDados )
        Leto_MakeDir( cCmd )
        Leto_MakeDir( cDoc )
        Leto_MakeDir( cSpooler )
        Leto_MakeDir( cTxt )
        Leto_MakeDir( cHtm )
        Leto_MakeDir( cTmp )
    else
        FT_MkDir( cBaseDados )
        FT_MkDir( cCmd )
        FT_MkDir( cDoc )
        FT_MkDir( cSpooler )
        FT_MkDir( cTxt )
        FT_MkDir( cHtm )
        FT_MkDir( cTmp )
    endif
    return nil


function EmpErrada( cCodi, cNome, nRow, nCol )

    LOCAL aRotina := {{|| CadastraEmpresa() }}
    LOCAL Arq_Ant := Alias()
    LOCAL Ind_Ant := IndexOrd()
    LOCAL Var1
    LOCAL Var2

    dbSelectArea( "Empresa" )
    IF !DbSeek( cCodi )
        Escolhe( 00, 00, MaxRow(), "Codi + ' ' + Nome", "CODI NOME DA EMPRESA", aRotina )
    EndIF
    cCodi := Empresa->Codi
    cNome := Empresa->Nome
    IF nRow <> Nil
        Write( nRow  , nCol, Empresa->Nome )
    EndiF
    oAmbiente:_Empresa := cCodi
    oAmbiente:xEmpresa := Empresa->Nome
    oAmbiente:xNomefir := Empresa->Nome
    AreaAnt( Arq_Ant, Ind_Ant )
    return( .T. )


Function CadastraEmpresa()

LOCAL cScreen := SaveScreen()
LOCAL GetList := {}
LOCAL cCodi   := Space(4)
LOCAL cNome   := Space(40)
LOCAL Var1
LOCAL Var2

dbSelectArea( "Empresa" )
WHILE .T.
    oMenu:Limpa()
    MaBox( 10, 10, 13, 60 )
    Empresa->(DbGoBoTTom())
    cCodi   := StrZero( Val( Codi ) + 1, 4 )
    cNome   := Space(40)
    SetCursor(1) ; DevPos( 11, 11 ) ; DevOut( "Codigo :" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodi, "cCodi", "9999", {|| EmpCerto( cCodi )},))
    SetCursor(1) ; DevPos( 12, 11 ) ; DevOut( "Empresa:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cNome, "cNome", "@!",,))
    ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
    IF LastKey() = 27
        ResTela( cScreen )
        Exit
    EndIF
    IF Conf("Pergunta: Confirma Inclusao da Empresa ?")
        dbSelectArea( "Empresa" )
        DbAppend()
        Empresa->Codi         := cCodi
        Empresa->Nome         := cNome
        Empresa->ItemNff     := 99
    EndIF
EndDo

Function EmpCerto( cCodi )

LOCAL Arq_Ant := Alias()
LOCAL Ind_Ant := IndexOrd()
LOCAL RetVal  := .T.
IF Empty( cCodi )
    ErrorBeep()
   Alerta("ERRO: Codigo Invalido.")
    Return( .F. )
EndIF
dbSelectArea( "Empresa" )
IF DbSeek( cCodi )
    ErrorBeep()
   Alerta("ERRO: Codigo Ja Registrado." )
    RetVal := .F.
EndIF
AreaAnt( Arq_Ant, Ind_Ant )
Return(RetVal)

function CriaBcoDadosEmpresa()

    LOCAL cDbf    := "EMPRESA.DBF"
    LOCAL cNtx    := "EMPRESA." + "CDX"
    LOCAL cScreen := SaveScreen()















    LOCAL aDbf      := {{ "CODI",     "C", 04, 0 },    { "NOME",     "C", 40, 0 },    { "DESCONTO", "N", 06, 2 },    { "DESCAPOS", "N", 06, 2 },    { "MENS1",    "C", 40, 0 },    { "MENS2",    "C", 40, 0 },    { "MENS3",    "C", 40, 0 },    { "MENS4",    "C", 40, 0 },    { "JURO",     "N", 03, 0 },    { "MULTA",    "N", 03, 0 },    { "DIAMULTA", "N", 03, 0 },    { "ITEMNFF",  "N", 03, 0 },    { "INSCMUN",  "C", 15, 0 },    { "ISS",      "N", 05, 2 },    { "CARENCIA", "N", 03, 0 },    { "DIASAPOS", "N", 03, 0 }}


    if !ms_swap_File(cDbf)
        oMenu:Limpa()
        Mensagem("Aguarde... Gerando o Arquivo EMPRESA")
        ms_swap_DbCreate(cDbf, aDbf )
    else
        if NetUse(cDbf, .T. )
            Integridade(cDbf, aDbf)
        else
            SetMode(oAmbiente:AlturaFonteDefaultWindows, oAmbiente:LarguraFonteDefaultWindows)
            Scroll() ; SetPos( 0, 0 )
            __Quit()
        endif
    endif


    if !ms_swap_File(cNtx)
        oMenu:Limpa()
        Mensagem(" Aguarde... Verificando Arquivos.")
        FechaTudo()





        MaBox( 10, 10, 13, 42, "EMPRESA" )
        Write( 12, 11, "CODIGO ÄÄÄÄÄÄÄÛ" )
        oIndice:DbfNtx("EMPRESA")
        oIndice:AddNtx("Codi","EMPRESA", "EMPRESA" )
        oIndice:CriaNtx()
    endif

    oMenu:Limpa()
    ErrorBeep()
    Mensagem("Aguarde... Verificando os Arquivos.")
    FechaTudo()
    Mensagem("Aguarde... Abrindo o Arquivo EMPRESA.")
    if NetUse(cDbf, .T. )
        DbSetIndex(cNtx)
    else
        SetMode(oAmbiente:AlturaFonteDefaultWindows, oAmbiente:LarguraFonteDefaultWindows)
        Scroll() ; SetPos( 0, 0 )
        __Quit()
    endif
    return(resTela( cScreen ))
































function PrecosAltera()
    IF !UsaArquivo("PAGAR") ; Break ; EndIF
    IF !UsaArquivo("LISTA") ; Break ; EndIF
    ConLista()
    FechaTudo()
    Return nil


function PrecosConsulta()
    LOCAL cScreen := SaveScreen()

    IF !UsaArquivo("LISTA")    ; Break ; EndIF
    IF !UsaArquivo("ENTRADAS") ; Break ; EndIF
    IF !UsaArquivo("SAIDAS")   ; Break ; EndIF
    IF !UsaArquivo("PAGAR")    ; Break ; EndIF
    SetKey( -4, NIL )
    TabPreco()
    FechaTudo()
    SetKey( -4, {|| PrecosConsulta()})
    ResTela( cScreen )
    Return




function Usuario()
    LOCAL cScreen   := SaveScreen()
    LOCAL cLogin    := Space(10)
    LOCAL cPassword := Space(10)

    dbSelectArea( "Usuario" )
    Usuario->(Order( 1 ))
    oAmbiente:lGreenCard := .F.
    oMenu:Limpa()
    WHILE .T.
        cPassword := Space(10)
        MaBox( 10, 20, 13, 48 )
        SetCursor(1) ; DevPos( 11, 21 ) ; DevOut( "Usuario.:  " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cLogin, "cLogin", "@!", {|| UsuarioErrado( @cLogin )},))
        SetCursor(1) ; DevPos( 12, 21 ) ; DevOut( "Senha...:  " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cPassWord, "cPassWord", "@S", {|| SenhaErrada(cLogin, cPassWord)},))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        IF LastKey() = 27
            IF Conf("Pergunta: Encerrar a Execucao do Sistema ?")
                Encerra()
            EndIF
            Loop
        EndIF
        return(ResTela( cScreen ))
    EndDo




function SenhaErrada(cLogin, cPassWord)
    LOCAL cSenha  := Usuario->( ltrim(rtrim(Senha)))
    LOCAL cSenha1 := MSEncrypt(StrTran(Dtoc(Date()),"/"))
    LOCAL Passe   := MSEncrypt(ltrim(rtrim(Upper(cPassword))))
    LOCAL xAdmin  := ltrim(rtrim(Passe))
    LOCAL cLpt1
    LOCAL cLpt2
    LOCAL cLpt3

    IF ltrim(rtrim(cLogin)) == "ADMIN" .AND. !Empty( Passe ) .AND. cSenha1 == xAdmin
        oAmbiente:lGreenCard := .T.
        Passe                := cSenha
    EndIF
    IF !Empty( Passe) .AND. cSenha == Passe
        aPermissao := {}
        Aadd( aPermissao, IF( Usuario->(MSDecrypt( Nivel1)) = "S", .T., .F. ))
        Aadd( aPermissao, IF( Usuario->(MSDecrypt( Nivel2)) = "S", .T., .F. ))
        Aadd( aPermissao, IF( Usuario->(MSDecrypt( Nivel3)) = "S", .T., .F. ))
        Aadd( aPermissao, IF( Usuario->(MSDecrypt( Nivel4)) = "S", .T., .F. ))
        Aadd( aPermissao, IF( Usuario->(MSDecrypt( Nivel5)) = "S", .T., .F. ))
        Aadd( aPermissao, IF( Usuario->(MSDecrypt( Nivel6)) = "S", .T., .F. ))
        Aadd( aPermissao, IF( Usuario->(MSDecrypt( Nivel7)) = "S", .T., .F. ))
        Aadd( aPermissao, IF( Usuario->(MSDecrypt( Nivel8)) = "S", .T., .F. ))
        Aadd( aPermissao, IF( Usuario->(MSDecrypt( Nivel9)) = "S", .T., .F. ))
        Aadd( aPermissao, IF( Usuario->(MSDecrypt( Nivel0)) = "S", .T., .F. ))
        Aadd( aPermissao, IF( Usuario->(MSDecrypt( NivelA)) = "S", .T., .F. ))
        Aadd( aPermissao, IF( Usuario->(MSDecrypt( NivelB)) = "S", .T., .F. ))
        Aadd( aPermissao, IF( Usuario->(MSDecrypt( NivelC)) = "S", .T., .F. ))
        Aadd( aPermissao, IF( Usuario->(MSDecrypt( NivelD)) = "S", .T., .F. ))
        Aadd( aPermissao, IF( Usuario->(MSDecrypt( NivelE)) = "S", .T., .F. ))
        Aadd( aPermissao, IF( Usuario->(MSDecrypt( NivelF)) = "S", .T., .F. ))
        Aadd( aPermissao, IF( Usuario->(MSDecrypt( NivelG)) = "S", .T., .F. ))
        Aadd( aPermissao, IF( Usuario->(MSDecrypt( NivelH)) = "S", .T., .F. ))
        Aadd( aPermissao, IF( Usuario->(MSDecrypt( NivelI)) = "S", .T., .F. ))
        Aadd( aPermissao, IF( Usuario->(MSDecrypt( NivelJ)) = "S", .T., .F. ))
        Aadd( aPermissao, IF( Usuario->(MSDecrypt( NivelK)) = "S", .T., .F. ))
        Aadd( aPermissao, IF( Usuario->(MSDecrypt( NivelL)) = "S", .T., .F. ))
        Aadd( aPermissao, IF( Usuario->(MSDecrypt( NivelM)) = "S", .T., .F. ))
        Aadd( aPermissao, IF( Usuario->(MSDecrypt( NivelN)) = "S", .T., .F. ))
        Aadd( aPermissao, IF( Usuario->(MSDecrypt( NivelO)) = "S", .T., .F. ))
        Aadd( aPermissao, IF( Usuario->(MSDecrypt( NivelP)) = "S", .T., .F. ))
        Aadd( aPermissao, IF( Usuario->(MSDecrypt( NivelQ)) = "S", .T., .F. ))
        Aadd( aPermissao, IF( Usuario->(MSDecrypt( NivelR)) = "S", .T., .F. ))
        Aadd( aPermissao, IF( Usuario->(MSDecrypt( NivelS)) = "S", .T., .F. ))

        cLpt1 := Usuario->Lpt1
        cLpt2 := Usuario->Lpt2
        cLpt3 := Usuario->Lpt3

        if empty( cLpt1 )
            if Usuario->(TravaReg())
                Usuario->Lpt1 := "06"
                Usuario->Lpt2 := "06"
                Usuario->Lpt3 := "06"
                Usuario->(Libera())
            endif
            cLpt1 := "06"
            cLpt2 := "06"
            cLpt3 := "06"
        endif

        oAmbiente:xUsuario := ltrim(rtrim(cLogin))
        EscolheImpressoraUsuario(cLpt1, cLpt2, cLpt3)

        SetaIni()
        return .T.
    EndIF
    cPassword := Space(10)
    ErrorBeep()
    Alert("ERRO: Senha nao confere.")
    return .F.




function EscolheImpressoraUsuario(cLpt1 , cLpt2 , cLpt3)
    hb_default(@cLpt1, "06")
    hb_default(@cLpt2, "06")
    hb_default(@cLpt3, "06")

    oAmbiente:aLpt1 := {}
    oAmbiente:aLpt2 := {}
    oAmbiente:aLpt3 := {}

    aLpt1 := {}
    aLpt2 := {}
    aLpt3 := {}

    if UsaArquivo("PRINTER")
        Printer->(Order(1))
        Printer->(DbGoTop())
        if Printer->(Eof())
            ArrPrinter()
        endif
        if Printer->(DbSeek( cLpt1 ))


            Aadd( aLpt1, { Printer->Codi, Printer->Nome, Printer->_Cpi10, Printer->_Cpi12, Printer->Gd, Printer->Pq, Printer->Ng, Printer->Nr,     Printer->Ca, Printer->c18, Printer->LigSub, Printer->DesSub, Printer->_SaltoOff, Printer->_Spaco1_8,     Printer->_Spaco1_6, Printer->Reseta })
        else
            Aadd( aLpt1, { NIL, NIL, NIL, NIL, NIL, NIL,NIL,NIL,NIL,NIL,NIL,NIL,NIL,NIL,NIL })
        endif
        if Printer->(DbSeek( cLpt2 ))


            Aadd( aLpt2, { Printer->Codi, Printer->Nome, Printer->_Cpi10, Printer->_Cpi12, Printer->Gd, Printer->Pq, Printer->Ng, Printer->Nr,     Printer->Ca, Printer->c18, Printer->LigSub, Printer->DesSub, Printer->_SaltoOff, Printer->_Spaco1_8,     Printer->_Spaco1_6, Printer->Reseta })
        else
            Aadd( aLpt2, { NIL, NIL, NIL, NIL, NIL, NIL,NIL,NIL,NIL,NIL,NIL,NIL,NIL,NIL,NIL })
        endif
        if Printer->(DbSeek( cLpt3 ))


            Aadd( aLpt3, { Printer->Codi, Printer->Nome, Printer->_Cpi10, Printer->_Cpi12, Printer->Gd, Printer->Pq, Printer->Ng, Printer->Nr,     Printer->Ca, Printer->c18, Printer->LigSub, Printer->DesSub, Printer->_SaltoOff, Printer->_Spaco1_8,     Printer->_Spaco1_6, Printer->Reseta })
        else
            Aadd( aLpt3, { NIL, NIL, NIL, NIL, NIL, NIL,NIL,NIL,NIL,NIL,NIL,NIL,NIL,NIL,NIL })
        endif
        oAmbiente:aLpt1 := aLpt1
        oAmbiente:aLpt2 := aLpt2
        oAmbiente:aLpt3 := aLpt3
        Printer->(DbCloseArea())
        return .T.
    endif
    return .F.




function UsuarioErrado( cNome )
    LOCAL aRotinaInclusao  := NIL
    LOCAL aRotinaAlteracao := {{||AltSenha() }}
    LOCAL cScreen            := SaveScreen()
    LOCAL Arq_Ant          := Alias()
    LOCAL Ind_Ant          := IndexOrd()

    dbSelectArea( "Usuario" )
    ( Usuario->(Order( 1 )), Usuario->(DbGoTop()))
    IF Usuario->(Eof()) .OR. Usuario->(!DbSeek("ADMIN"))
        GravaSenhaAdmin(.T.)
    Else
        IF Empty(Usuario->Senha)
            GravaSenhaAdmin(.F.)
        EndIF
    EndIF

    IF Usuario->(!DbSeek( cNome ))
        Usuario->(Escolhe( 00, 00, MaxRow(), "Nome", "USUARIO", aRotinaInclusao, NIL, aRotinaAlteracao, NIL, NIL, NIL ))
        cNome := Usuario->Nome
    EndIF

    AreaAnt( Arq_Ant, Ind_Ant )
    return( .T. )


function GravaSenhaAdmin(lIncluirOuAlterar)
    LOCAL Arq_Ant := Alias()
    LOCAL Ind_Ant := IndexOrd()
    LOCAL lDone   := .F.
    LOCAL cPasse
    LOCAL cSim

    dbSelectArea( "Usuario" )
    (Usuario->(Order( 1 )), Usuario->(DbGoTop()))

    if lIncluirOuAlterar
        lDone := Usuario->(Incluiu())
    else
        lDone := Usuario->(TravaReg())
    endif

    while lDone
        cPasse             := MSEncrypt("280966")
        cSim                 := MSEncrypt("S")
        Usuario->Nome     := "ADMIN"
        Usuario->Senha  := cPasse
        Usuario->Nivel1 := cSim
        Usuario->Nivel2 := cSim
        Usuario->Nivel3 := cSim
        Usuario->Nivel4 := cSim
        Usuario->Nivel5 := cSim
        Usuario->Nivel6 := cSim
        Usuario->Nivel7 := cSim
        Usuario->Nivel8 := cSim
        Usuario->Nivel9 := cSim
        Usuario->Nivel0 := cSim
        Usuario->NivelA := cSim
        Usuario->NivelB := cSim
        Usuario->NivelC := cSim
        Usuario->NivelD := cSim
        Usuario->NivelE := cSim
        Usuario->NivelF := cSim
        Usuario->NivelG := cSim
        Usuario->NivelH := cSim
        Usuario->NivelI := cSim
        Usuario->NivelJ := cSim
        Usuario->NivelK := cSim
        Usuario->NivelL := cSim
        Usuario->NivelM := cSim
        Usuario->NivelN := cSim
        Usuario->NivelO := cSim
        Usuario->NivelP := cSim
        Usuario->NivelQ := cSim
        Usuario->NivelR := cSim
        Usuario->NivelS := cSim
        lDone := .F.
    EndDo
    Usuario->(Libera())
    AreaAnt( Arq_Ant, Ind_Ant )
    return lDone


function UsuarioCerto( cNome )
    LOCAL Arq_Ant := Alias()
    LOCAL Ind_Ant := IndexOrd()

    dbSelectArea( "Usuario" )
    Usuario->(Order( 1 ))
    Usuario->(DbGoTop())
    IF Usuario->(Eof())
        GravaSenhaAdmin(.T.)
    EndIF
    Return( .T. )


function AbreUsuario()
    Return( UsaArquivo("USUARIO") )


function Terminate()
    FechaTudo()
    ScrollDir()
    FT_ChDir( oAmbiente:xBase )

    if oAmbiente:LetoAtivo
       leto_DisConnect()
    endif
    oIni:Close()


    F_Fim( SISTEM_NA1 + " " + SISTEM_VERSAO )
    SetMode(oAmbiente:AlturaFonteDefaultWindows, oAmbiente:LarguraFonteDefaultWindows)
    Scroll() ; SetPos( 0, 0 )
    DevPos( 24, 0 )
    return( __Quit())


function Encerra()
    FechaTudo()
    ScrollDir()
    FT_ChDir( oAmbiente:xBase )
    SalvaMem()

    if oAmbiente:LetoAtivo
       leto_DisConnect()
    endif
    oIni:Close()


    F_Fim( SISTEM_NA1 + " " + SISTEM_VERSAO )
    SetMode(oAmbiente:AlturaFonteDefaultWindows, oAmbiente:LarguraFonteDefaultWindows)
    Scroll() ; SetPos( 0, 0 )
    DevPos( 24, 0 )
    return( __Quit())


function VerificarUsuario( cNome )
    LOCAL Arq_Ant := Alias()
    LOCAL Ind_Ant := IndexOrd()

    dbSelectArea( "Usuario" )
    Usuario->(Order( 1 ))
    IF Usuario->(DbSeek( cNome ))
        ErrorBeep()
        Alerta("Erro: Usuario Ja Registrado.")
        Return( .F. )
    EndIF
    Return( .T. )


Proc IncluirUsuario( cNome, cSenha1, lOk )

LOCAL cScreen := SaveScreen()
LOCAL GetList := {}
LOCAL cSenha2

oMenu:Limpa()
dbSelectArea( "Usuario" )
Usuario->(Order( 1 ))
MaBox( 00, 10, 04, 50 )
SetCursor(1) ; DevPos( 01, 11 ) ; DevOut( "Nome Usuario........: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cNome, "cNome", "@!", {|| VerificarUsuario( cNome ) .AND. !Empty( cNome )},))
ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
IF LastKey() = 27
    lOk := .F.
    ResTela( cScreen )
    Return
EndIF
WHILE .T.
    Write( 02, 11, "Nova Senha...........: " )
    Write( 03, 11, "Confirme a Senha.....: " )
    cSenha1 := Senha( 02, 34, 11 )
    cSenha2 := Senha( 03, 34, 11 )
    IF LastKey() = 27
        ResTela( cScreen )
        Return
    EndIF
    IF Empty( cSenha1 )
        Loop
    EndIF
    IF cSenha1 == cSenha2
        lOk := .T.
        ResTela( cScreen )
        Return
    EndIF
    ErrorBeep()
    IF Conf("Erro: Senha nao Confere. Novamente ?")
        Loop
    EndIF
    cNome   := Space(10)
    cSenha1 := ""
    lOk      := .F.
    ResTela( cScreen )
    Return
EndDo
ResTela( cScreen )
Return

Proc AltSenha()

LOCAL cNome   := Space(10)
LOCAL lOk     := .F.
LOCAL Passe   := ""
LOCAL oVenlan := TIniNew(oAmbiente:xUsuario + ".INI")
LOCAL lAdmin  := oVenlan:ReadBool("permissao","usuarioadmin", .F. )
LOCAL lDireto := .F.

lDireto := lAdmin
AlterarUsuario( @cNome, @Passe, @lOk, lAdmin, lDireto )
IF !lOK
    Return
Else
  ErrorBeep()
  IF Conf( "Pergunta: Alterar Senha ?")
      Passe := MSEncrypt( ltrim(rtrim(Passe)))
      IF Usuario->(TravaReg())
          Usuario->Nome  := cNome
          Usuario->Senha := Passe
          Usuario->(Libera())
          Alerta("Informa: Senha Alterada com sucesso.")
      EndIF
  EndIF
  Return
EndIF

Proc AlterarUsuario( cNome, cSenha1, lOk, lAdmin, lDireto )

LOCAL GetList := {}
LOCAL cScreen := SaveScreen()
LOCAL cSenha
LOCAL cSenha2

oMenu:Limpa()
dbSelectArea( "Usuario" )
if( lAdmin = NIL, lAdmin := .F., lAdmin )
if( lDireto = NIL, lDireto := .F., lDireto )
Usuario->(Order( 1 ))
MaBox( 00, 10, 04, 50 )
SetCursor(1) ; DevPos( 01, 11 ) ; DevOut( "Nome Usuario........: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cNome, "cNome", "@!", {|| UsuarioErrado( @cNome )},))
ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
IF LastKey() = 27
    lOk := .F.
    ResTela( cScreen )
    Return
EndIF
cNome := ltrim(rtrim(cNome))
IF !lDireto
   cSenha := Usuario->( ltrim(rtrim(Senha)))
   IF lAdmin
      cSenha1 := MSDecrypt( ltrim(rtrim(cSenha)))
      lOk     := .T.
      ResTela( cScreen )
      Return
   EndIF
EndIF
WHILE .T.
   IF !lDireto
      Write( 02, 11, "Verificacao de Senha.: " )
      cSenha1 := Senha( 02, 34, 11 )
      IF LastKey() = 27
         ResTela( cScreen )
         Return
      EndIF
   EndIF
   IF cSenha == MSEncrypt( ltrim(rtrim(cSenha1))) .OR. lDireto
        WHILE .T.
            Write( 02, 11, "Nova Senha...........: " )
            Write( 03, 11, "Confirme a Senha.....: " )
            cSenha1 := Senha( 02, 34, 11 )
            cSenha2 := Senha( 03, 34, 11 )
            IF LastKey() = 27
                ResTela( cScreen )
                Return
            EndIF
            IF Empty( cSenha1 )
                Loop
            EndIF
            IF cSenha1 == cSenha2
                lOk := .T.
                ResTela( cScreen )
                Return
            EndIF
            ErrorBeep()
            IF Conf("Erro: Senha nao Confere. Novamente ?")
                Loop
            EndIF
            cNome   := Space(10)
            cSenha1 := ""
            lOk      := .F.
            ResTela( cScreen )
            Return
        EndDo
    EndIF
    ErrorBeep()
    IF Conf("Erro: Senha nao Confere. Novamente ?")
        Loop
    EndIF
    cNome   := Space(10)
    cSenha1 := ""
    lOk      := .F.
    ResTela( cScreen )
    Return
EndDo
Return
ResTela( cScreen )

Proc CadastraUsuario( cCodi )

LOCAL GetList      := {}
LOCAL oVenlan      := TIniNew(oAmbiente:xUsuario + ".INI")
LOCAL lAdmin      := oVenlan:ReadBool("permissao","usuarioadmin", .F. )
LOCAL cScreen      := SaveScreen()













LOCAL aMenu       := {" Incluir Usuario",    " Alterar Usuario",    " Excluir Usuario",    " Alterar Senha",    " Impressoras Fiscais",    " Opcoes de Faturamento",    " Controle de Vendedores ",    " Controle de Ponto",    " Contas a Receber",    " Contas a Pagar",    " Contas Correntes",    " Controle de Producao",    " Controle de Estoque",    " Menu Principal"}
LOCAL cSenha
LOCAL Arq_Ant      := Alias()
LOCAL Ind_Ant      := IndexOrd()
LOCAL lParametro := .F.
LOCAL lRegistro  := .F.
LOCAL cEs          := "S"
LOCAL cRe          := "S"
LOCA    cPa          := "S"
LOCAL cCo          := "S"
LOCAL cVe          := "S"
LOCAL cVn          := "S"
LOCAL cUs          := "S"
LOCAL cPr          := "S"
LOCAL cInc          := "S"
LOCAL cDel          := "S"
LOCAL cDev          := "S"
LOCAL cEnt          := "S"
LOCAL cPag          := "S"
LOCAL cRec          := "S"
LOCAL cAlt          := "S"
LOCAL cEmp          := "S"
LOCAL cTro          := "S"
LOCAL cFaz          := "S"
LOCAL cRes          := "S"
LOCAL cCom          := "S"
LOCAL cZero       := "S"
LOCAL cVista      := "N"
LOCAL cCadas      := "S"
LOCAL cLimite      := "S"
LOCAL cEstorado  := "S"
LOCAL cDescMax   := "S"
LOCAL cFat          := "S"
LOCAL cDtRec      := "S"
LOCAL cAtra       := "S"
LOCAL nChoice      := 1
LOCAL cLpt1       := "06"
LOCAL cLpt2       := "06"
LOCAL cLpt3       := "06"

LOCAL cNome       := Space(10)
LOCAL Passe
LOCAL lOk

WHILE .T.
    lOk := .F.
    oMenu:Limpa()
    M_Title("INCLUSAO/ALTERACAO DE USUARIO")
    nChoice := FazMenu( 02, 10, aMenu, Cor())
    Do Case
    Case nChoice = 0
        Return

    Case nChoice = 1
        IncluirUsuario( @cNome, @Passe, @lOk )
        IF !lOK
            Return
        EndIF

    Case nChoice = 2
        AlterarUsuario( @cNome, @Passe, @lOk, lAdmin )
        IF !lOK
            Return
        EndIF
        cEs         := MSDecrypt( Nivel1 )
        cRe         := MSDecrypt( Nivel2 )
        cPa         := MSDecrypt( Nivel3 )
        cCo         := MSDecrypt( Nivel4 )
        cVe         := MSDecrypt( Nivel5 )
        cVn         := MSDecrypt( Nivel6 )
        cUs         := MSDecrypt( Nivel7 )
        cPr         := MSDecrypt( Nivel8 )
        cInc         := MSDecrypt( Nivel9 )
        cAlt         := MSDecrypt( Nivel0 )
        cDel         := MSDecrypt( NivelA )
        cDev         := MSDecrypt( NivelB )
        cPag         := MSDecrypt( NivelC )
        cRec         := MSDecrypt( NivelD )
        cEmp         := MSDecrypt( NivelE )
        cTro         := MSDecrypt( NivelF )
        cFaz         := MSDecrypt( NivelG )
        cRes         := MSDecrypt( NivelH )
        cCom         := MSDecrypt( NivelI )
        cZero      := MSDecrypt( NivelJ )
        cEstorado := MSDecrypt( NivelK )
        cVista     := MSDecrypt( NivelL )
        cCadas     := MSDecrypt( NivelM )
        cLimite     := MSDecrypt( NivelN )
        cDescMax  := MSDecrypt( NivelO )
        cEnt         := MSDecrypt( NivelP )
        cFat         := MSDecrypt( NivelQ )
        cDtRec     := MSDecrypt( NivelR )
        cAtra      := MSDecrypt( NivelS )
        cLpt1      := Usuario->Lpt1
        cLpt2      := Usuario->Lpt2
        cLpt3      := Usuario->Lpt2

    Case nChoice = 3
        dbSelectArea( "USUARIO" )
      Escolhe( 00, 00, MaxRow(), "Nome", "USUARIO", {{|| IncluirUsuario( @cNome, @Passe, @lOk)}}, {{|| AlterarUsuario( @cNome, @Passe, @lOk)}})
        Return

    Case nChoice = 4
        AltSenha()
        Loop

    Case nChoice = 5
      AlterarUsuario( @cNome, @Passe, @lOk, lAdmin )
        IF lOK
            ConfFiscal( cNome )
        EndIF
        Loop

    Case nChoice = 6
      AlterarUsuario( @cNome, @Passe, @lOk, lAdmin )
        IF lOK
            ConfOpcoesFaturamento( cNome )
        EndIF
        Loop

    Case nChoice = 7
      AlterarUsuario( @cNome, @Passe, @lOk, lAdmin )
        IF lOK
            ConfIniVendedores( cNome )
        EndIF
        Loop

    Case nChoice = 8
      AlterarUsuario( @cNome, @Passe, @lOk, lAdmin )
        IF lOK
            ConfIniPonto( cNome )
        EndIF
        Loop

    Case nChoice = 9
      AlterarUsuario( @cNome, @Passe, @lOk, lAdmin )
        IF lOK
            ConfIniReceber( cNome )
        EndIF
        Loop
    Case nChoice = 10
      AlterarUsuario( @cNome, @Passe, @lOk, lAdmin )
        IF lOK
            ConfIniPagar( cNome )
        EndIF
        Loop
    Case nChoice = 11
      AlterarUsuario( @cNome, @Passe, @lOk, lAdmin )
        IF lOK
            ConfIniCorrentes( cNome )
        EndIF
        Loop
    Case nChoice = 12
      AlterarUsuario( @cNome, @Passe, @lOk, lAdmin )
        IF lOK
            ConfIniProducao( cNome )
        EndIF
        Loop
    Case nChoice = 13
      AlterarUsuario( @cNome, @Passe, @lOk, lAdmin )
        IF lOK
            ConfIniEstoque( cNome )
        EndIF
        Loop
    Case nChoice = 14
      AlterarUsuario( @cNome, @Passe, @lOk, lAdmin )
        IF lOK
            ConfIniSci( cNome )
        EndIF
        Loop
    EndCase
    oMenu:Limpa()
    dbSelectArea( "Usuario" )
    Usuario->(Order( 1 ))
    IF CadPermissao( cNome, @cEs, @cRe, @cPa, @cCo, @cVe, @cVn, @cUs, @cPr, @cInc, @cDel, @cDev, @cPag, @cRec, @cAlt, @cEmp, @cTro, @cFaz, @cRes, @cCom, @cZero, @cVista, @cCadas, @cLimite, @cEstorado, @cLpt1, @cLpt2, @cLpt3, @cDescMax, @cEnt, @cFat, @cDtRec, @cAtra )
        ErrorBeep()
        IF Conf( "Pergunta: Incluir/Alterar Usuario ?")
            Passe := MSEncrypt( ltrim(rtrim(Passe)))
            IF nChoice = 1
                IF Usuario->(Incluiu())
                    Usuario->Nome    := cNome
                    Usuario->Senha := Passe
                EndIF
            Else
                IF Usuario->(TravaReg())
                    Usuario->Nome    := cNome
                    Usuario->Senha := Passe
                EndIF
            EndIF
            Usuario->Nivel1 := MSEncrypt( cEs )
            Usuario->Nivel2 := MSEncrypt( cRe )
            Usuario->Nivel3 := MSEncrypt( cPa )
            Usuario->Nivel4 := MSEncrypt( cCo )
            Usuario->Nivel5 := MSEncrypt( cVe )
            Usuario->Nivel6 := MSEncrypt( cVn )
            Usuario->Nivel7 := MSEncrypt( cUs )
            Usuario->Nivel8 := MSEncrypt( cPr )
            Usuario->Nivel9 := MSEncrypt( cInc )
            Usuario->Nivel0 := MSEncrypt( cAlt )
            Usuario->NivelA := MSEncrypt( cDel )
            Usuario->NivelB := MSEncrypt( cDev )
            Usuario->NivelC := MSEncrypt( cPag )
            Usuario->NivelD := MSEncrypt( cRec )
            Usuario->NivelE := MSEncrypt( cEmp )
            Usuario->NivelF := MSEncrypt( cTro )
            Usuario->NivelG := MSEncrypt( cFaz )
            Usuario->NivelH := MSEncrypt( cRes )
            Usuario->NivelI := MSEncrypt( cCom )
            Usuario->NivelJ := MSEncrypt( cZero )
            Usuario->NivelK := MSEncrypt( cEstorado )
            Usuario->NivelL := MSEncrypt( cVista )
            Usuario->NivelM := MSEncrypt( cCadas )
            Usuario->NivelN := MSEncrypt( cLimite )
            Usuario->NivelO := MSEncrypt( cDescMax )
            Usuario->NivelP := MSEncrypt( cEnt      )
            Usuario->NivelQ := MSEncrypt( cFat      )
            Usuario->NivelR := MSEncrypt( cDtRec     )
            Usuario->NivelS := MSEncrypt( cAtra     )
            Usuario->Lpt1     := cLpt1
            Usuario->Lpt2     := cLpt2
            Usuario->Lpt3     := cLpt3
            Usuario->(Libera())

            aPermissao := {}
            Aadd( aPermissao, IF( cEs         = "S", .T., .F. ))
            Aadd( aPermissao, IF( cRe         = "S", .T., .F. ))
            Aadd( aPermissao, IF( cPa         = "S", .T., .F. ))
            Aadd( aPermissao, IF( cCo         = "S", .T., .F. ))
            Aadd( aPermissao, IF( cVe       = "S", .T., .F. ))
            Aadd( aPermissao, IF( cVn         = "S", .T., .F. ))
            Aadd( aPermissao, IF( cUs         = "S", .T., .F. ))
            Aadd( aPermissao, IF( cPr         = "S", .T., .F. ))
            Aadd( aPermissao, IF( cInc      = "S", .T., .F. ))
            Aadd( aPermissao, IF( cAlt      = "S", .T., .F. ))
            Aadd( aPermissao, IF( cDel      = "S", .T., .F. ))
            Aadd( aPermissao, IF( cDev      = "S", .T., .F. ))
            Aadd( aPermissao, IF( cPag      = "S", .T., .F. ))
            Aadd( aPermissao, IF( cRec      = "S", .T., .F. ))
            Aadd( aPermissao, IF( cEmp      = "S", .T., .F. ))
            Aadd( aPermissao, IF( cTro      = "S", .T., .F. ))
            Aadd( aPermissao, IF( cFaz      = "S", .T., .F. ))
            Aadd( aPermissao, IF( cRes      = "S", .T., .F. ))
            Aadd( aPermissao, IF( cCom      = "S", .T., .F. ))
            Aadd( aPermissao, IF( cZero     = "S", .T., .F. ))
            Aadd( aPermissao, IF( cEstorado = "S", .T., .F. ))
            Aadd( aPermissao, IF( cVista    = "S", .T., .F. ))
            Aadd( aPermissao, IF( cCadas    = "S", .T., .F. ))
            Aadd( aPermissao, IF( cLimite   = "S", .T., .F. ))
            Aadd( aPermissao, IF( cDescMax  = "S", .T., .F. ))
            Aadd( aPermissao, IF( cEnt       = "S", .T., .F. ))
            Aadd( aPermissao, IF( cFat       = "S", .T., .F. ))
            Aadd( aPermissao, IF( cDtRec      = "S", .T., .F. ))
            Aadd( aPermissao, IF( cAtra      = "S", .T., .F. ))
        EndIF
    EndIF
    ResTela( cScreen )
    AreaAnt( Arq_Ant, Ind_Ant )
    Exit
EndDo

Function CadPermissao( cNome, cEs, cRe, cPa, cCo, cVe, cVn, cUs, cPr, cInc, cDel, cDev, cPag, cRec, cAlt, cEmp, cTro, cFaz, cRes, cCom, cZero, cVista, cCadas, cLimite, cEstorado, cLpt1, cLpt2, cLpt3, cDescMax, cEnt, cFat, cDtRec, cAtra )

LOCAL nChoice       := 1
LOCAL cScreen       := SaveScreen ()
LOCAL GetList       := {}
LOCAL oVenlan       := TIniNew( cNome + ".INI")
LOCAL cCtrlP        := IF( oVenlan:ReadBool("permissao","usarteclactrlp", .T. ), "S", "N")
LOCAL cCaix         := IF( oVenlan:ReadBool("permissao","visualizardetalhecaixa", .T. ), "S", "N")
LOCAL cAdmin        := IF( oVenlan:ReadBool("permissao","usuarioadmin", .F. ), "S", "N")
LOCAL cDebAtr       := IF( oVenlan:ReadBool("permissao","vendercomdebito", .F. ), "S", "N")
LOCAL cRolCob       := IF( oVenlan:ReadBool("permissao","imprimirrolcobranca", .F. ), "S", "N")
LOCAL cAutoVenda    := IF( oVenlan:ReadBool("permissao","autovenda", .F.), "S", "N")
LOCAL cReciboZerado := IF( oVenlan:ReadBool("permissao","recibozerado", .F.), "S", "N")

LOCAL nCol1
LOCAL nCol2
LOCAL nOpcao

WHILE .T.
    nCol1 := 02
    nCol2 := 40
    MaBox( 02, 01, 11, 38, "ESCOLHA O ACESSO DE " + ltrim(rtrim(cNome)))
    SetCursor(1) ; DevPos( 03, nCol1 ) ; DevOut( "CONTROLE DE ESTOQUE...:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cEs, "cEs", "@!", {|| PickSimNao( @cEs )},))
    SetCursor(1) ; DevPos( Row()+1, nCol1 ) ; DevOut( "CONTAS A RECEBER......:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cRe, "cRe", "@!", {|| PickSimNao( @cRe )},))
    SetCursor(1) ; DevPos( Row()+1, nCol1 ) ; DevOut( "CONTAS A PAGAR........:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cPa, "cPa", "@!", {|| PickSimNao( @cPa )},))
    SetCursor(1) ; DevPos( Row()+1, nCol1 ) ; DevOut( "CONTAS CORRENTES......:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCo, "cCo", "@!", {|| PickSimNao( @cCo )},))
    SetCursor(1) ; DevPos( Row()+1, nCol1 ) ; DevOut( "CONTROLE DE PRODUCAO..:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cPr, "cPr", "@!", {|| PickSimNao( @cPr )},))
    SetCursor(1) ; DevPos( Row()+1, nCol1 ) ; DevOut( "VENDEDORES............:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cVe, "cVe", "@!", {|| PickSimNao( @cVe )},))
    SetCursor(1) ; DevPos( Row()+1, nCol1 ) ; DevOut( "VENDAS NO VAREJO......:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cVn, "cVn", "@!", {|| PickSimNao( @cVn )},))
    SetCursor(1) ; DevPos( Row()+1, nCol1 ) ; DevOut( "MANUTENCAO DE USUARIO.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cUs, "cUs", "@!", {|| PickSimNao( @cUs )},))


    MaBox( 12, 01, 23, 38, "CONFIGURACAO GERAL DO SISTEMA" )
   SetCursor(1) ; DevPos( 13, nCol1 ) ; DevOut( "BAIXAR TITULO QDO VENDA A VISTA.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cVista, "cVista", "@!", {|| PickSimNao( @cVista )},))
   SetCursor(1) ; DevPos( Row()+1, nCol1 ) ; DevOut( "VERIFICAR LIMITE DE CREDITO.....:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cLimite, "cLimite", "@!", {|| PickSimNao( @cLimite )},))
   SetCursor(1) ; DevPos( Row()+1, nCol1 ) ; DevOut( "VERIFICAR DEBITO EM ATRASO......:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cAtra, "cAtra", "@!", {|| PickSimNao( @cAtra )},))
   SetCursor(1) ; DevPos( Row()+1, nCol1 ) ; DevOut( "VENDER COM DEBITO EM ATRASO.....:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cDebAtr, "cDebAtr", "@!", {|| PickSimNao( @cDebAtr )},))
   SetCursor(1) ; DevPos( Row()+1, nCol1 ) ; DevOut( "VENDER COM LIMITE ESTOURADO.....:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cEstorado, "cEstorado", "@!", {|| PickSimNao( @cEstorado )},))
   SetCursor(1) ; DevPos( Row()+1, nCol1 ) ; DevOut( "IMPRESSORA EM LPT1..............:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cLpt1, "cLpt1", "99", {|| PrinterErrada( @cLpt1 )},))
   SetCursor(1) ; DevPos( Row()+1, nCol1 ) ; DevOut( "IMPRESSORA EM LPT2..............:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cLpt2, "cLpt2", "99", {|| PrinterErrada( @cLpt2 )},))
   SetCursor(1) ; DevPos( Row()+1, nCol1 ) ; DevOut( "IMPRESSORA EM LPT3..............:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cLpt3, "cLpt3", "99", {|| PrinterErrada( @cLpt3 )},))
   SetCursor(1) ; DevPos( Row()+1, nCol1 ) ; DevOut( "AUTOMATIZAR VENDA...............:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cAutoVenda, "cAutoVenda", "!", {|| PickSimNao( @cAutoVenda )},))

   MaBox( 02, 39, 24, MaxCol()-1, "ESCOLHA A PERMISSAO DE " + ltrim(rtrim(cNome)))
    SetCursor(1) ; DevPos( 03, nCol2 ) ; DevOut( "PODE INCLUIR REGISTROS........:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cInc, "cInc", "@!", {|| PickSimNao( @cInc )},))
    SetCursor(1) ; DevPos( Row()+1, nCol2 ) ; DevOut( "PODE ALTERAR REGISTROS........:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cAlt, "cAlt", "@!", {|| PickSimNao( @cAlt )},))
    SetCursor(1) ; DevPos( Row()+1, nCol2 ) ; DevOut( "PODE EXCLUIR REGISTROS........:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cDel, "cDel", "@!", {|| PickSimNao( @cDel )},))
    SetCursor(1) ; DevPos( Row()+1, nCol2 ) ; DevOut( "PODE DEVOLVER FATURA SAIDAS...:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cDev, "cDev", "@!", {|| PickSimNao( @cDev )},))
    SetCursor(1) ; DevPos( Row()+1, nCol2 ) ; DevOut( "PODE DEVOLVER FATURA ENTRADAS.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cEnt, "cEnt", "@!", {|| PickSimNao( @cEnt )},))
    SetCursor(1) ; DevPos( Row()+1, nCol2 ) ; DevOut( "PODE FAZER PAGAMENTOS.........:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cPag, "cPag", "@!", {|| PickSimNao( @cPag )},))
    SetCursor(1) ; DevPos( Row()+1, nCol2 ) ; DevOut( "PODE FAZER RECEBIMENTOS.......:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cRec, "cRec", "@!", {|| PickSimNao( @cRec )},))
    SetCursor(1) ; DevPos( Row()+1, nCol2 ) ; DevOut( "PODE INCLUIR EMPRESAS.........:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cEmp, "cEmp", "@!", {|| PickSimNao( @cEmp )},))
    SetCursor(1) ; DevPos( Row()+1, nCol2 ) ; DevOut( "PODE TROCAR DE EMPRESA........:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cTro, "cTro", "@!", {|| PickSimNao( @cTro )},))
    SetCursor(1) ; DevPos( Row()+1, nCol2 ) ; DevOut( "PODE FAZER COPIA SEGURANCA....:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cFaz, "cFaz", "@!", {|| PickSimNao( @cFaz )},))
    SetCursor(1) ; DevPos( Row()+1, nCol2 ) ; DevOut( "PODE RESTAURAR COPIA SEGURANCA:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cRes, "cRes", "@!", {|| PickSimNao( @cRes )},))
    SetCursor(1) ; DevPos( Row()+1, nCol2 ) ; DevOut( "PODE ALTERAR COMISSAO VENDA...:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCom, "cCom", "@!", {|| PickSimNao( @cCom )},))
    SetCursor(1) ; DevPos( Row()+1, nCol2 ) ; DevOut( "FATURAR COM ESTOQUE NEGATIVO..:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cZero, "cZero", "@!", {|| PickSimNao( @cZero )},))
    SetCursor(1) ; DevPos( Row()+1, nCol2 ) ; DevOut( "PODE EXCEDER DESC MAXIMO......:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cDescMax, "cDescMax", "@!", {|| PickSimNao( @cDescMax )},))
    SetCursor(1) ; DevPos( Row()+1, nCol2 ) ; DevOut( "PODE ALTERAR EMISSAO DA FATURA:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cFat, "cFat", "@!", {|| PickSimNao( @cFat )},))
    SetCursor(1) ; DevPos( Row()+1, nCol2 ) ; DevOut( "PODE ALTERAR DATA RECEBIMENTO.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cDtRec, "cDtRec", "@!", {|| PickSimNao( @cDtRec )},))
    SetCursor(1) ; DevPos( Row()+1, nCol2 ) ; DevOut( "PODE USAR TECLA CLTR+P........:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCtrlP, "cCtrlP", "@!", {|| PickSimNao( @cCtrlP )},))
    SetCursor(1) ; DevPos( Row()+1, nCol2 ) ; DevOut( "PODE VISUALIZAR CAIXA.........:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCaix, "cCaix", "@!", {|| PickSimNao( @cCaix  )},))
    SetCursor(1) ; DevPos( Row()+1, nCol2 ) ; DevOut( "PODE IMPRIMIR ROL COBRANCA....:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cRolCob, "cRolCob", "@!", {|| PickSimNao( @cRolCob )},))
   SetCursor(1) ; DevPos( Row()+1, nCol2 ) ; DevOut( "PODE IMPRIMIR RECIBO ZERADO...:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cReciboZerado, "cReciboZerado", "@!", {|| PickSimNao( @cReciboZerado )},))
    SetCursor(1) ; DevPos( Row()+1, nCol2 ) ; DevOut( "USUARIO ADMINISTRADOR.........:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cAdmin, "cAdmin", "@!", {|| PickSimNao( @cAdmin )},))
    ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
    IF LastKey() = 27
        ResTela( cScreen )
        Return( .F. )
    EndIF
    ErrorBeep()
    nOpcao := Alerta(" Pergunta: Voce Deseja ? ", {" Continuar ", " Alterar ", " Sair " })
    IF nOpcao = 1
        oVenlan:WriteBool("permissao", "usarteclactrlp",         IF( cCtrlP  = "S", .T., .F. ))
        oVenlan:WriteBool("permissao", "visualizardetalhecaixa", IF( cCaix   = "S", .T., .F. ))
        oVenlan:WriteBool("permissao", "usuarioadmin",           IF( cAdmin  = "S", .T., .F. ))
        oVenlan:WriteBool("permissao", "vendercomdebito",        IF( cDebAtr = "S", .T., .F. ))
        oVenlan:WriteBool("permissao", "imprimirrolcobranca",    IF( cRolCob = "S", .T., .F. ))
      oVenlan:WriteBool("permissao", "autovenda",              IF( cAutoVenda = "S", .T., .F. ))
      oVenlan:WriteBool("permissao", "recibozerado",           IF( cReciboZerado = "S", .T., .F. ))
      oVenlan:WriteBool("permissao", "PodeExcluirRegistros",   IF( cDel          = "S", .T., .F. ))
        Return( .T. )
    ElseIF nOpcao = 2
        Loop
    ElseIf nOpcao = 3
        Return( .F. )
    EndIF
END

Function Permissao( cVariavel )

LOCAL cScreen := SaveScreen()
LOCAL aMenu   := { " Com Permissao de Acesso ", " Sem Permissao de Acesso " }
LOCAL aSimNao := { "SIM", "NAO" }
LOCAL nChoice := 1

MaBox( 10, 49, 13, 79 )
nChoice     := Achoice( 11, 50, 16, 78, aMenu )
IF nChoice = 0
    nChoice = 2
EndIF
cVariavel := aSimNao[ nChoice ]
__Keyboard( Chr( 13 ) )
ResTela( cScreen )
Return .T.

Proc MostraPermissao()

LOCAL lNenhum := .T.
LOCAL cSTring := ""







LOCAL aMostra := { "Modulo de {Estoque}      ", ";Modulo de {Receber}      ", ";Modulo de {Pagar}        ", ";Modulo de {C. Correntes} ", ";Modulo de {Vendedores}   " , ";Modulo de {Vendas}       ", ";Modulo de {Usuario}      ", ";Modulo de {Producao}     " }
For nX := 1 To 8
    IF aPermissao[nX]
        cString += aMostra[nX]
        lNenhum := .F.
    EndIF
Next
ErrorBeep()
IF lNenhum
    cString := "Nenhum Modulo {...}"
EndIF
Alert("Erro: Usuario Com Acesso Restrito ao:;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ;" + cString )
Return( NIL )

Proc Carta( lFecharTudo )

LOCAL GetList        := {}
LOCAL cScreen        := SaveScreen()
LOCAL Files       := "*.DOC"
LOCAL lNovoCodigo := .T.
LOCAL cUltCodigo    := ""
LOCAL aMenu         := {"Individual", "Por Cidade", "Por Estado", "Por Regiao", "Por Aniversario", "Parcial", "Geral" }
LOCAL aTipo         := {"Normal", "Ultima Compra"}
LOCAL oBloco
LOCAL Campo
LOCAL Linha
LOCAL Linhas
LOCAL Imprime
LOCAL cDebitos     := "N"
LOCAL nTipo         := 0
LOCAL nDias         := 0
LOCAL nChoice        := 0
LOCAL nFormulario := 66

lFechartudo := IF( lFecharTudo = NIL, .T., .F. )
WHILE .T.
    M_Title("IMPRESSAO DE MALA DIRETA")
    nChoice := FazMenu( 03, 02, aMenu, Cor())
    IF nChoice = 0
        ResTela( cScreen )
        Return
    EndIF
    M_Title("TIPO DE MALA DIRETA")
    nTipo := FazMenu( 04, 03, aTipo, Cor())
    IF nTipo = 0
        ResTela( cScreen )
        Return
    EndIF
    Arq := "CARTA.DOC" + Space(03)
    MaBox( 03 , 39 , 06 , 79 )
    SetCursor(1) ; DevPos( 04, 40 ) ; DevOut( "Tamanho Formulario..:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nFormulario, "nFormulario", "99", {|| PickTam({"33 Colunas", "66 Colunas"}, {33,66}, @nFormulario )},))
    SetCursor(1) ; DevPos( 05, 40 ) ; DevOut( "Arquivo a imprimir..:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( Arq, "Arq", "@!",,))
    ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
    IF LastKey( ) = 27
        IF lFecharTudo
            FechaTudo()
        EndIf
        ResTela( cScreen )
        Loop
    EndIF
    FT_ChDir( oAmbiente:xBaseDoc )
    LETO_SET( 7, ( oAmbiente:xBaseDoc ) )
    IF !File( Arq ) .OR. Empty( Arq )
        M_Title( "Setas CIMA/BAIXO Move")
        Arq := Mx_PopFile( 07, 39, 22, 79, Files, Cor())
        IF Empty( Arq )
            FT_ChDir( oAmbiente:xBaseDados )
            LETO_SET( 7, ( oAmbiente:xBaseDados ) )
            ErrorBeep()
            ResTela( cScreen )
            Return
        EndIF
    EndIF
    FT_ChDir( oAmbiente:xBaseDados )
    LETO_SET( 7, ( oAmbiente:xBaseDados ) )
    IF !Selecao( nChoice, @oBloco )
        IF lFecharTudo
            FechaTudo()
        EndIF
        ResTela( cScreen )
        Loop
    EndiF
    IF nTipo = 2
        oMenu:Limpa()
        MaBox( 10, 10, 13, 45 )
        SetCursor(1) ; DevPos( 11, 11 ) ; DevOut( "Dias da Ultima Compra........:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nDias, "nDias", "999",,))
        SetCursor(1) ; DevPos( 12, 11 ) ; DevOut( "Imprimir Carta se tem debitos:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cDebitos, "cDebitos", "!", {|| cDebitos $ "SN"},))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        IF LastKey() = 27
            ResTela( cScreen )
            Loop
        EndIF
    EndIF
    IF !InsTru80() .OR. !LptOk()
        IF lFecharTudo
            FechaTudo()
        EndIF
        ResTela( cScreen )
        Loop
    EndIF
    oMenu:Limpa()
    cTela         := Mensagem("Informa: Aguarde... Imprimindo Mala Direta.")
    cUltCodigo    := Codi
    lNovoCodigo := .T.
    PrintOn()
    Fprint( Chr(27) + "C" + Chr( nFormulario ))
    SetPrc( 0 , 0 )
    Recemov->(Order( 2 ))
    WHILE Eval( oBloco ) .AND. REL_OK( )
        IF nTipo = 2
            IF ( Date() - UltCompra ) >= nDias
                IF cDebitos = "N"
                    IF Recemov->(DbSeek( cUltCodigo ))
                        cUltCodi := Codi
                        DbSkip(1)
                        Loop
                    EndIF
                EndIF
            Else
                cUltCodi := Codi
                DbSkip(1)
                Loop
            EndIF
        EndIF
        IF lNovoCodigo
            lNovoCodigo := .F.
            Write( 02 , 0, DataExt( Date()))
            Write( 06 , 0, "A" )
            Write( 07 , 0, NG + Codi + " " + Nome + NR )
            Write( 08 , 0, Ende )
            Write( 09 , 0, LIGSUB + Cep + "/" + Rtrim( Cida )  + "/" + Esta + DESSUB )
            FT_ChDir( oAmbiente:xBaseDoc )
            LETO_SET( 7, ( oAmbiente:xBaseDoc ) )
            Campo  := MemoRead( Arq )
            Linhas := MlCount( Campo , 80 )
            FOR Linha  :=    1 TO Linhas
                Imprime :=    MemoLine( Campo , 80 , Linha )
                Write( 14 + Linha -1 , 0, Imprime )
            Next
            FT_ChDir( oAmbiente:xBaseDados )
            LETO_SET( 7, ( oAmbiente:xBaseDados ) )
        EndIF
        cUltCodi := Codi
        DbSkip(1)
        IF cUltCodi <> Codi .OR. Eof()
            lNovoCodigo := .T.
            __Eject()
        EndIF
    EndDo
    DbClearFilter()
    DbGoTop()
    IF lFecharTudo
        FechaTudo()
    EndIF
    Fprint( Chr(27) + "C" + Chr( 66 ))
    PrintOff()
    ResTela( cScreen )
EndDo

Function Selecao( nChoice, oBloco )

LOCAL cScreen    := SaveScreen()
LOCAL cCodi     := Space(05)
LOCAL cCodi1    := Space(05)
LOCAL cCida     := Space(25)
LOCAL cEsta     := Space(02)
LOCAL dIni        := Space(05)
LOCAL xArquivo := FTempName(".TMP")
LOCAL dFim        := Space(05)
LOCAL cRegiao    := Space(02)

IF !UsaArquivo("RECEBER") ; FechaTudo() ; Break ; EndIF
IF !UsaArquivo("REGIAO")  ; FechaTudo() ; Break ; EndIF
IF !UsaArquivo("RECEMOV") ; FechaTudo() ; Break ; EndIF
dbSelectArea( "Receber" )
Receber->( Order( 2 ))
Do Case
    Case nChoice = 1
        MaBox( 15, 02, 17, 63 )
        SetCursor(1) ; DevPos( 16, 03 ) ; DevOut( "Cliente...:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodi, "cCodi", "99999", {|| RecErrado( @cCodi,, Row(), Col()+1 )},))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        IF LastKey() = 27
            ResTela( cScreen )
            Return( .F. )
        EndIF
        Receber->( Order( 2 ))
        Receber->(DbSeek( cCodi ))
        oBloco := {|| Receber->Codi = cCodi }
        Return( .T. )

    Case nChoice = 2
        MaBox( 15, 02, 17, 63 )
        SetCursor(1) ; DevPos( 16, 03 ) ; DevOut( "Cidade....:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCida, "cCida", "@!", {|| !Empty( cCida )},))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        IF LastKey() = 27
            ResTela( cScreen )
            Return( .F. )
        EndIF
        Receber->( Order( 3 ))
        IF Receber->(!DbSeek( cCida ))
            Nada()
            Return( .F. )
        EndIF
        oBloco := {|| Receber->Cida = cCida }
        Return( .T. )

    Case nChoice = 3
        MaBox( 15, 02, 17, 63 )
        SetCursor(1) ; DevPos( 16, 03 ) ; DevOut( "Estado....:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cEsta, "cEsta", "@!", {|| !Empty( cEsta )},))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        IF LastKey() = 27
            ResTela( cScreen )
            Return( .F. )
        EndIF
        Receber->( Order( 5 ))
        IF Receber->(!DbSeek( cEsta ))
            Nada()
            Return( .F. )
        EndIF
        oBloco := {|| Receber->Esta = cEsta }
        Return( .T. )

    Case nChoice = 4
        MaBox( 15, 02, 17, 63 )
        SetCursor(1) ; DevPos( 16, 03 ) ; DevOut( "Regiao....:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cRegiao, "cRegiao", "@!", {|| Regiao->(RegiaoErrada( @cRegiao ))},))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        IF LastKey() = 27
            ResTela( cScreen )
            Return( .F. )
        EndIF
        Receber->( Order( 4 ))
        IF Receber->(!DbSeek( cRegiao ))
            Nada()
            Return( .F. )
        EndIF
        oBloco := {|| Receber->Regiao = cRegiao }
        Return( .T. )

    Case nChoice = 5
        MaBox( 15, 02, 18, 63 )
        SetCursor(1) ; DevPos( 16, 03 ) ; DevOut( "Dia/Mes do Aniversario Inicial.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dIni, "dIni", "##/##",,))
        SetCursor(1) ; DevPos( 17, 03 ) ; DevOut( "Dia/Mes do Aniversario Final...:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dFim, "dFim", "##/##", {|| dFim >= dIni},))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        IF LastKey() = 27
            ResTela( cScreen )
            Return( .F. )
        EndIF
        IF Conf("Informa: Procura podera demorar. Continua ?")
            oMenu:Limpa()
            cTela := Mensagem("Informa: Aguarde, Localizando Registros.")
            __dbCopyStruct( ( xArquivo ), { } )
            dbUseArea( .T.,, ( xArquivo), "xAlias", iif( .F. .OR. .T., ! .T., NIL ), .F. )
            nConta := 0
            cIni1  := Left(StrTran( dIni, "/"),2)
            cIni2  := Right(StrTran( dIni, "/"),2)
            cFim1  := Left(StrTran( dFim, "/"),2)
            cFim2  := Right(StrTran( dFim, "/"),2)
            Receber->( Order( 2 ))
            Receber->(DbGoTop())
            WHILE Receber->(!Eof())
                cData  := Receber->(Left(DToc( Nasc ), 5 ))
                cData1 := Left( StrTran( cData, "/"), 2 )
                cData2 := Right( StrTran( cData, "/"), 2 )
                IF cData1 >= cIni1 .AND. cData1 <= cFim1
                    IF cData2 >= cIni2 .AND. cData2 <= cFim2
                        nConta++
                        xAlias->(DbAppend())
                        For nField := 1 To FCount()
                            xAlias->(FieldPut( nField, Receber->(FieldGet( nField ))))
                        Next
                    EndIF
                EndIF
                Receber->(DbSkip(1))
            EnDdo
            IF nConta = 0
                xAlias->(DbCloseArea())
                Ferase( xArquivo )
                oMenu:Limpa()
                Alerta("Informa: Nenhum Registro atende a Condicao.")
            Else
                dbSelectArea( "xAlias" )
                xAlias->(DbGoTop())
                oBloco := {|| !Eof() }
                ResTela( cTela )
                Return( .T. )
            EndIF
        EndIF
        Return( .F. )

    Case nChoice = 6
        MaBox( 15, 02, 18, 63 )
        SetCursor(1) ; DevPos( 16, 03 ) ; DevOut( "Codigo Ini:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodi, "cCodi", "99999", {|| RecErrado( @cCodi,, Row(), Col()+1 )},))
        SetCursor(1) ; DevPos( 17, 03 ) ; DevOut( "Codigo Fim:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodi1, "cCodi1", "99999", {|| RecErrado( @cCodi1,, Row(), Col()+1 )},))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        IF LastKey() = 27
            ResTela( cScreen )
            Return( .F. )
        EndIF
        Receber->( Order( 2 ))
        oBloco := {|| Receber->Codi >= cCodi .AND. Receber->Codi <= cCodi1 }
        Receber->(DbSeek( cCodi ))
        Return( .T. )

    Case nChoice = 7
        Receber->( Order( 2 ))
        Receber->(DbGoTop())
        oBloco := {|| !Eof() }
        Return( .T. )
EndCase

Proc Novidades()

    LOCAL cFile := oAmbiente:xBase + "\SCI.NEW"
    oMenu:Limpa()
    IF File( cFile )
        M_Title("ULTIMAS ALTERACOES NO SISTEMA")
        M_View( 00, 00, MaxRow(), MaxCol(), cFile,  Cor())
    Else
        ErrorBeep()
        Alerta("Erro: Arquivo " + cFile + " nao localizado.")
    EndIF

Proc ImprimeDebito()

LOCAL GetList        := {}
LOCAL cScreen        := SaveScreen()
LOCAL cCodi         := Space(05)
LOCAL nSubTotal    := 0
LOCAL nTotal        := 0
LOCAL Col            := 0
LOCAL Pagina        := 0
LOCAL nSobra        := 0
LOCAL nJuro         := 0
LOCAL nSubJuros    := 0
LOCAL nCarencia    := 30
LOCAL nTotalJuros := 0
LOCAL Tam            := 132
LOCAL nTamForm     := 33
LOCAL dIni            := Date()-30
LOCAL dFim            := Date()
LOCAL cMensagem    := "AGRADECEMOS A SUA PREFERENCIA."
LOCAL cNome
LOCAL cEnde
LOCAL cFone
LOCAL oBloco

cMensagem += Space(40 - Len( cMensagem ))
WHILE .T.
    oMenu:Limpa()
    MaBox( 10, 05, 18, 78 )
    SetCursor(1) ; DevPos( 11, 06 ) ; DevOut( "Codigo Cliente..... : " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodi, "cCodi", "99999", {|| RecErrado( @cCodi,, Row(), Col()+1 )},))
    SetCursor(1) ; DevPos( 12, 06 ) ; DevOut( "Data Inicial....... : " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dIni, "dIni", "##/##/##",,))
    SetCursor(1) ; DevPos( 13, 06 ) ; DevOut( "Data Final......... : " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dFim, "dFim", "##/##/##",,))
    SetCursor(1) ; DevPos( 14, 06 ) ; DevOut( "Taxa Juros Mes..... : " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nJuro, "nJuro", "99.99",,))
    SetCursor(1) ; DevPos( 15, 06 ) ; DevOut( "Dias Carencia...... : " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nCarencia, "nCarencia", "99",,))
    SetCursor(1) ; DevPos( 16, 06 ) ; DevOut( "Mensagem............: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cMensagem, "cMensagem", "@1",,))
    SetCursor(1) ; DevPos( 17, 06 ) ; DevOut( "Comp do Formulario..: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nTamForm, "nTamForm", "99", {|| nTamForm >= 20 .AND. nTamForm <= 66},))
    ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
    IF LastKey() = 27
        ResTela( cScreen )
        Exit
    EndIF
    IF !Instru80() .OR. !LptOk()
        Loop
    EndIF
    cEnde := Receber->Ende
    cFone := Receber->Fone
    cNome := Receber->(ltrim(rtrim(Nome)))
    Lista->(Order( 2 ))
    dbSelectArea( "Saidas" )
    if ( ! .F. ) ; dbClearRelation() ; end ; dbSetRelation( "Lista", {|| Saidas->Codigo}, "Saidas->Codigo", .F. )
    Saidas->(Order( 5 ))
    IF Saidas->(!DbSeek( cCodi ))
        Saidas->(DbClearRel())
        Saidas->(DbGoTop())
        ErrorBeep()
        Alerta(" Nenhum Debito aberto em C/C !")
        Loop
    EndIF
    oBloco        := {|| Saidas->Codi = cCodi }
    oBloco2        := {|| Saidas->Data >= dIni .AND. Saidas->Data <= dFim }
    nSubTotal    := 0
    nSubJuros    := 0
    nTotalJuros := 0
    nTotal        := 0
    Mensagem(" Aguarde... Verificando e Imprimindo Movimento.")
    Col            := 58
    Pagina        := 0
    nSobra        := 0
    Tam            := 132
    PrintOn()
    FPrint( PQ )
    FPrInt( Chr(27) + "C" + Chr( nTamForm ))
    SetPrc( 0, 0 )
    WHILE Eval( oBloco ) .AND. !Eof()
        IF Col >= nTamForm
            Write( 00, 00, Linha1( Tam, @Pagina))
            Write( 01, 00, Linha2())
         Write( 02, 00, Padc( oAmbiente:xFanta, Tam ) )
            Write( 03, 00, Linha4(Tam, SISTEM_NA2 ))
            Write( 04, 00, Padc( "RELATORIO DE DEBITO C/C", Tam ) )
            Write( 05, 00, Linha5( Tam ))
            Write( 06, 00, "Data : " + Dtoc( Date()))
            Write( 07, 00, "Nome : " + cCodi + "  " + cNome )
            Write( 08, 00, "End  : " + cEnde )
            Write( 09, 00, "Tel  : " + cFone )
            Write( 10, 00, Linha5( Tam ))
            Write( 11, 00, "DATA           ATRASO   FATURA   CODIGO    QUANT  DESCRICAO DO PRODUTO                         UNITARIO         TOTAL   VLR A PAGAR")
            Write( 12, 00, Linha5(Tam))
            Col := 13
        EndIF
        IF !Saidas->c_c
            Saidas->(DbSkip(1))
            Loop
        EndIF
        IF Saidas->Saida = Saidas->SaidaPaga
            Saidas->(DbSkip(1))
            Loop
        EndIF
        IF !Eval( oBloco2 )
            Saidas->(DbSkip(1))
            Loop
        EndIF
        nSobra    := ( Saidas->Saida - Saidas->SaidaPaga )
        nConta    := Pvendido * nSobra
        nJurodia := 0
        nJdia     := 0
        nAtraso    := ( Date() - Data ) - nCarencia
        nConta  := Lista->Varejo * nSobra
        IF nAtraso > 1
            nJdia       := JuroDia( nConta, nJuro )
            nJuroDia   := nJdia * nAtraso
        EndIF



        Qout( Data, nAtraso, Fatura, Codigo, Str( nSobra, 9, 2), Lista->(Ponto(Descricao,40)),    Lista->(Tran( Varejo, "@E 9,999,999.99")),    Tran( nConta, "@E 99,999,999.99"),    Tran( nConta + nJurodia, "@E 99,999,999.99"))
        nSubTotal    += nConta
        nTotal        += nConta
        nSubJuros    += nConta + nJurodia
        nTotalJuros += nConta + nJurodia
        Saidas->(DbSkip(1))
        ++Col
        IF Col >= nTamForm
            nRow1 := 104
            nRow2 := 118
            Write(    Col,    00,     Linha5(Tam))
            Write( ++Col,    00,     "** SubTotal ** " )
            Write(    Col,    nRow1, Tran( nSubTotal, "@E 99,999,999.99"))
            Write(    Col,    nRow2, Tran( nSubJuros, "@E 99,999,999.99"))
            nSubTotal := 0
            nSubJuros := 0
            ++Col
            __Eject()
        EndIF
    EndDo
    nRow1 := 104
    nRow2 := 118
    Write(    Col,    00,    Linha5(Tam))
    Write( ++Col,    00,    "** SubTotal ** " )
    Write(    Col, nRow1, Tran( nSubTotal,     "@E 99,999,999.99"))
    Write(    Col, nRow2, Tran( nSubJuros,     "@E 99,999,999.99"))
    Write( ++Col,    00,    "**    Total ** " )
    Write(    Col, nRow1, Tran( nTotal,         "@E 99,999,999.99"))
    Write(    Col, nRow2, Tran( nTotalJuros, "@E 99,999,999.99"))
    Qout()
    Qout( NG + GD + cMensagem + CA + NR )
    __Eject()
    PrintOff()
    Saidas->(DbClearRel())
    Saidas->(DbGoTop())
EndDo

Function Linha1( Tam, Pagina )

LOCAL nDiv := Tam / 2
Return( Padr( "Pagina N§ " + StrZero(++Pagina,5), nDiv ) + Padl(Time(), nDiv ))

Function Linha2()

Return(Date())

Function Linha3( Tam )

Return( Padc( XNOMEFIR, Tam ))

Function Linha4( Tam, cSistema )

Return(Padc( cSistema, Tam ))

Function Linha5( Tam )

Tam := IF( Tam = Nil, 80, Tam)
Return(Repl( "-", Tam ))

Proc DebitoC_C()


LOCAL cScreen        := SaveScreen()
LOCAL cCodi         := Space(05)
LOCAL nTotal        := 0
LOCAL nSubTotal    := 0
LOCAL nJuro         := 0
LOCAL nSubJuros    := 0
LOCAL nTotalJuros := 0
LOCAL nSobra        := 0
LOCAL aArray        := {}
LOCAL nCarencia    := 30
LOCAL dIni            := Date()-30
LOCAL dFim            := Date()
LOCAL cNome
LOCAL oBloco
LOCAL oBloco1

WHILE .T.
    oMenu:Limpa()
    aArray := {}
    MaBox( 00, 00, 08, 79 )
    SetCursor(1) ; DevPos( 01, 01 ) ; DevOut( "Cliente..:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodi, "cCodi", "99999", {|| RecErrado( @cCodi,, Row(), Col()+1 )},))
    SetCursor(1) ; DevPos( 02, 01 ) ; DevOut( "Data Ini.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dIni, "dIni", "##/##/##",,))
    SetCursor(1) ; DevPos( 03, 01 ) ; DevOut( "Data Fim.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dFim, "dFim", "##/##/##",,))
    SetCursor(1) ; DevPos( 04, 01 ) ; DevOut( "Juros Mes:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nJuro, "nJuro", "99.99",,))
    SetCursor(1) ; DevPos( 05, 01 ) ; DevOut( "Carencia.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nCarencia, "nCarencia", "999",,))
    DevPos( 06, 01 ) ; DevOut( "Endereco.:" )
    DevPos( 07, 01 ) ; DevOut( "Telefone.:" )
    ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
    IF LastKey() = 27
        Saidas->(DbClearRel())
        Exit
    EndIF
    cNome := Receber->(ltrim(rtrim(Nome)))
    Write( 06, 12, Receber->Ende )
    Write( 07, 12, Receber->Fone )
    Lista->(Order( 2 ))
    dbSelectArea( "Saidas" )
    if ( ! .F. ) ; dbClearRelation() ; end ; dbSetRelation( "Lista", {|| Codigo}, "Codigo", .F. )
    Saidas->(Order( 5 ))
    IF !DbSeek( cCodi )
        ErrorBeep()
        Alerta(" Nenhum Debito aberto em C/C !")
        Loop
    EndIF
    oBloco        := {|| Saidas->Codi = cCodi }
    oBloco1        := {|| Saidas->Data >= dIni .AND. Saidas->Data <= dFim }
    nTotal        := 0
    nTotalJuros := 0
    nSobra        := 0
    cTela := Mensagem(" Aguarde... Verificando Movimento.", Roloc(Cor()))
    WHILE Eval( oBloco ) .AND. !Eof()
        IF !Eval( oBloco1 )
            Saidas->(DbSkip(1))
            Loop
        EndIF
        IF !Saidas->c_c
            Saidas->(DbSkip(1))
            Loop
        EndIF
        IF Saidas->Saida = Saidas->SaidaPaga
            Saidas->(DbSkip(1))
            Loop
        EndIF
        nSobra    := ( Saidas->Saida - Saidas->SaidaPaga )
        nConta    := ( nSobra * Lista->Varejo)
        nJurodia := 0
        nJdia     := 0
        nAtraso    := ( Date() - Data ) - nCarencia
        IF nAtraso > 1
            nJdia       := JuroDia( nConta, nJuro )
            nJuroDia   := nJdia * nAtraso
        EndIF
        nTotal        += nConta
        nTotalJuros += nConta + nJurodia


        Aadd( aArray, Dtoc( Data) + Space(1) + Fatura + Codigo + Space(1) +     Lista->(Ponto(Left(Descricao,32),31)) + Space(1) + Str( nSobra, 9,2) + Space(1) +     Lista->(Tran( Varejo, "@E 999,999.99")))
        Saidas->(DbSkip(1))
    EndDo
    ResTela( cTela )
    IF Len( aArray ) <> 0
        MaBox( 09, 00, 24, 79 )
        Aadd( aArray, Repl("Ä",80))
        Aadd( aArray, Rjust("VALOR TOTAL " + Tran( nTotal, "@E 999,999,999.99"), 78))
        Aadd( aArray, Rjust("  COM JUROS " + Tran( nTotalJuros, "@E 999,999,999.99"), 78))
        Print( 09, 01, "DATA     FATURA   CODIGO DESCRICAO DO PRODUTO                 QUANT   UNITARIO", Roloc( Cor()))
        M_Title("[ESC] RETORNA")
        aChoice( 10, 01, 23, 78, aArray, .T. )
    Else
        Alerta("Erro: Nenhum Debito em Aberto.")
    EndIF
    Saidas->(DbClearRel())
    Saidas->(DbGoTop())
EndDo
ResTela( cScreen )
Return

Proc MostraDebito()

LOCAL cScreen        := SaveScreen()
LOCAL aTodos        := {}
LOCAL aFatura        := {}
LOCAL aValor        := {}
LOCAL aVlrFatura    := {}
LOCAL aMenuArray    := Array(3)
LOCAL aMenu         := Array(3)
LOCAL cCodi         := Space(05)
LOCAL nPos            := 0
LOCAL nTam            := 0
LOCAL nVlrFatura    := 0
LOCAL nVlrAnt        := 0
LOCAL nVlrAtu        := 0
LOCAL nAnt            := 0
LOCAL nPrecoAtual := 0
LOCAL nBase         := 0
LOCAL nChoice        := 0
LOCAL nCarencia    := 0
LOCAL nJuro         := 0
LOCAL cTipoVenda
LOCAL cTela
LOCAL oBloco
LOCAL cFatura

aMenuArray[1] := " Conforme Preco Varejo  "
aMenuArray[2] := " Conforme Preco Atacado "
aMenuArray[3] := " Conforme Taxa de Juros "
      aMenu[1] := " Preco Varejo  Atual "
      aMenu[2] := " Preco Atacado Atual "
      aMenu[3] := " Preco Vendido       "
WHILE .T.
    oMenu:Limpa()
    MaBox( 05, 05, 07, 78 )
    SetCursor(1) ; DevPos( 06, 06 ) ; DevOut( "Codigo Cliente : " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodi, "cCodi", "99999", {|| RecErrado( @cCodi,, Row(), Col()+1 )},))
    ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
    IF LastKey() = 27
        Saidas->(DbClearRel())
        ResTela( cScreen )
        Exit
    EndIF
    IF !Saidas->(TravaArq()) ; DbUnLockAll() ; Restela( cScreen ) ; Loop ; EndIf
    IF !Chemov->(TravaArq()) ; DbUnLockAll() ; Restela( cScreen ) ; Loop ; EndIf
    IF !Cheque->(TravaArq()) ; DbUnLockAll() ; Restela( cScreen ) ; Loop ; EndIf
    Lista->(Order( 2 ))
    dbSelectArea( "Saidas" )
    if ( ! .F. ) ; dbClearRelation() ; end ; dbSetRelation( "Lista", {|| Codigo}, "Codigo", .F. )
    Saidas->(Order( 5 ))
    IF Saidas->(!DbSeek( cCodi ))
        ResTela( cScreen )
        ErrorBeep()
        Alerta(" Nenhum Debito aberto em C/C !")
        ResTela( cScreen )
        Loop
    EndIF
    M_Title("ESCOLHA O TIPO DE REAJUSTE")
    nChoice := FazMenu( 08, 05, aMenuArray, Cor())
    IF nChoice = 0
        Saidas->(DbClearRel())
        ResTela( cScreen )
        Loop
    EndIF
    nCarencia := 0
    nJuro      := 0
    IF nChoice = 3
        MaBox( 15, 05, 18, 33 )
        SetCursor(1) ; DevPos( 16, 06 ) ; DevOut( "Dias de Carencia :" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nCarencia, "nCarencia", "999",,))
        SetCursor(1) ; DevPos( 17, 06 ) ; DevOut( "Juro Mes.........:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nJuro, "nJuro", "999.99",,))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        IF LastKey() = 27
            ResTela( cScreen )
            Loop
        EndIF
        M_Title("TOMAR POR BASE O")
        nBase := FazMenu( 15, 34, aMenu, Cor())
        IF nBase = 0
            Saidas->(DbClearRel())
            ResTela( cScreen )
            Loop
        EndIF
    EndIF
    IF Conf("Pergunta: Confirma Atualizacao do Movimento ?")
        oBloco      := {|| Saidas->Codi = cCodi }
        cTipoVenda := .T.
        aTodos      := {}
        aFatura      := {}
        aValor      := {}
        aVlrFatura := {}
        nTam          := 0
        nAnt          := 0
        nVlrAnt      := 0
        nVlrAtu      := 0
        nVlrFatura := 0
        nPrecoAtual := 0
        Mensagem(" Aguarde... Verificando e atualizando Movimento.")
        WHILE Eval( oBloco ) .AND. !Eof()
            nVlrFatura += ( Saidas->Saida * Saidas->Pvendido )
            cFatura      := Saidas->Fatura
            nPos          := Ascan( aFatura, cFatura )
            IF Saidas->c_c
                nSobra      := ( Saidas->Saida - Saidas->SaidaPaga )
                nVlrAnt      := ( nSobra * Saidas->Pvendido )
                IF nChoice        = 1
                    nVlrAtu      := ( nSobra * Lista->Varejo )
                    Saidas->Pvendido := Lista->Varejo
                ElseIF nChoice = 2
                    nVlrAtu      := ( nSobra * Lista->Atacado )
                    Saidas->Pvendido := Lista->Atacado
                ElseIF nChoice = 3
                    IF nBase = 1
                        nAtraso              := (( Date() - Data ) - nCarencia )
                        nAtraso              := IF( nAtraso >= 0, nAtraso, 0 )
                        nJdia               := JuroDia( Lista->Varejo, nJuro )
                        nJTotal              := nJdia * nAtraso
                        nVlrAtu              := ( nSobra * ( Lista->Varejo + nJTotal ))
                        Saidas->Pvendido := nVlrAtu
                    ElseIF nBase = 2
                        nAtraso              := (( Date() - Data ) - nCarencia )
                        nAtraso              := IF( nAtraso >= 0, nAtraso, 0 )
                        nJdia               := JuroDia( Lista->Atacado, nJuro )
                        nJTotal              := nJdia * nAtraso
                        nVlrAtu              := ( nSobra * ( Lista->Atacado + nJTotal ))
                        Saidas->Pvendido := nVlrAtu
                    ElseIF nBase = 3
                        nAtraso              := (( Date() - Data ) - nCarencia )
                        nAtraso              := IF( nAtraso >= 0, nAtraso, 0 )
                        nJdia               := JuroDia( Saidas->Pvendido, nJuro )
                        nJTotal              := nJdia * nAtraso
                        nVlrAtu              := ( nSobra * ( Saidas->Pvendido + nJTotal ))
                        Saidas->Pvendido := nVlrAtu
                    EndIF
                EndIF
                nPrecoAtual := Saidas->Pvendido

                Aadd( aTodos, Codigo + " " + Lista->Descricao + " " + Str( nSobra,6 ) + " " + Lista->(Tran( nPrecoAtual, "@E 99,999,999,999.99")))
            EndIF
            IF nPos = 0
                Aadd( aFatura,     cFatura )
                Aadd( aValor,        ( nVlrAtu - nVlrAnt) )
                Aadd( aVlrFatura, nVlrFatura )
            Else
                aValor[nPos]      += ( nVlrAtu - nVlrAnt )
                aVlrFatura[nPos] +=    nVlrFatura
            EndIF
            nVlrAnt      := 0
            nVlrAtu      := 0
            nVlrFatura := 0
            nSobra      := 0
            Saidas->(Dbskip(1))
        EndDo
        Saidas->(Libera())
        nTam := Len( aFatura )
        IF nTam <> 0
            ResTela( cScreen )
            Chemov->(Order( 4 ))
            For nX := 1 To nTam
                IF Chemov->(DbSeek( aFatura[nX]))
                    nAnt              := Chemov->Saldo
                    Chemov->Deb   := aVlrFatura[ nX ]
                    Chemov->Deb   += aValor[ nX ]
                    Chemov->Saldo -= aValor[ nX ]
                EndIf
            Next
            Chemov->(Libera())
            IndexarData( cCodi )
        Else
            Chemov->(Libera())
            ResTela( cScreen )
            ErrorBeep()
            Alerta("Nenhum Debito aberto em C/C !")
        EndIF
    EndIF
    ResTela( cScreen )
EndDo

function ExcluirTemporarios()

    LOCAL cTela := Mensagem("Aguarde, Excluindo Arquivos Temporarios.")

    Aeval( Directory( "*.$*"),  { | aFile | Ferase( aFile[ 1 ] )})
    Aeval( Directory( "*.$$$"), { | aFile | Ferase( aFile[ 1 ] )})
    Aeval( Directory( "*.TMP"), { | aFile | Ferase( aFile[ 1 ] )})
    Aeval( Directory( "*.BAK"), { | aFile | Ferase( aFile[ 1 ] )})
    Aeval( Directory( "*.MEM"), { | aFile | Ferase( aFile[ 1 ] )})
    Aeval( Directory( "T0*.*"), { | aFile | Ferase( aFile[ 1 ] )})
    Aeval( Directory( "T1*.*"), { | aFile | Ferase( aFile[ 1 ] )})
    Aeval( Directory( "T2*.*"), { | aFile | Ferase( aFile[ 1 ] )})
    Aeval( Directory( "T3*.*"), { | aFile | Ferase( aFile[ 1 ] )})
    Aeval( Directory( "T4*.*"), { | aFile | Ferase( aFile[ 1 ] )})
    Aeval( Directory( "T5*.*"), { | aFile | Ferase( aFile[ 1 ] )})
    Aeval( Directory( "T6*.*"), { | aFile | Ferase( aFile[ 1 ] )})
    Aeval( Directory( "T7*.*"), { | aFile | Ferase( aFile[ 1 ] )})
    Aeval( Directory( "T8*.*"), { | aFile | Ferase( aFile[ 1 ] )})
    Aeval( Directory( "T9*.*"), { | aFile | Ferase( aFile[ 1 ] )})
    Aeval( Directory( "*."),    { | aFile | Ferase( aFile[ 1 ] )})
    return(ResTela(cTela))


Proc Duplicados()

LOCAL cFile
LOCAL xDbf
LOCAL xNtx
LOCAL nx

Mensagem("Informa: Aguarde, Excluindo Arquivos Temporarios.")
oMenu:Limpa()
Aeval( Directory( "*.CDX"), { | aFile | Ferase( aFile[ 1 ] )})
Aeval( Directory( "*.NTX"), { | aFile | Ferase( aFile[ 1 ] )})
Aeval( Directory( "*.NSX"), { | aFile | Ferase( aFile[ 1 ] )})
Aeval( Directory( "*.LIX"), { | aFile | Ferase( aFile[ 1 ] )})
ExcluirTemporarios()

cFile := "SAIDAS"
xNtx    := FTempName("T*.TMP")
cTela := Mensagem("Verificando: " + cFile )
xDbf := ""

dbSelectArea( "Saidas" )
ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "Codigo + Docnr + CodiVen + Codi + Fatura + Pedido + Dtos( Data )", {|| Codigo + Docnr + CodiVen + Codi + Fatura + Pedido + Dtos( Data )}, .T. )
nX := 0
WHILE File(( xDbf := cFile + "." + StrZero( ++nX, 3 )))
EndDo
__dbCopy( ( xDbf ), { },,,,, .F.,,, )
RenDup( cFile, xDbf, xNtx )

cFile := "RECEMOV"
xNtx    := FTempName("T*.TMP")
cTela := Mensagem("Verificando: " + cFile )
xDbf := ""

dbSelectArea( "Recemov" )
ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "Docnr + Fatura + Codi + CodiVen + Caixa + Str( Vlr, 13,2 ) + dTos( Vcto )", {|| Docnr + Fatura + Codi + CodiVen + Caixa + Str( Vlr, 13,2 ) + dTos( Vcto )}, .T. )
nX := 0
WHILE File(( xDbf := cFile + "." + StrZero( ++nX, 3 )))
EndDo
__dbCopy( ( xDbf ), { },,,,, .F.,,, )
RenDup( cFile, xDbf, xNtx )

cFile := "VENDEMOV"
xNtx    := FTempName("T*.TMP")
cTela := Mensagem("Verificando: " + cFile )
xDbf := ""

dbSelectArea( "Vendemov" )
ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx),, "Fatura + CodiVen + Codi + Str( Vlr, 13,2 ) + dTos( Data )", {|| Fatura + CodiVen + Codi + Str( Vlr, 13,2 ) + dTos( Data )}, .T. )
nX := 0
WHILE File(( xDbf := cFile + "." + StrZero( ++nX, 3 )))
EndDo
__dbCopy( ( xDbf ), { },,,,, .F.,,, )
RenDup( cFile, xDbf, xNtx )

cFile := "NOTA"
xNtx    := FTempName("T*.TMP")
cTela := Mensagem("Verificando: " + cFile )
xDbf := ""

dbSelectArea( "Nota" )
ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "Numero", {|| Numero}, .T. )
nX := 0
WHILE File(( xDbf := cFile + "." + StrZero( ++nX, 3 )))
EndDo
__dbCopy( ( xDbf ), { },,,,, .F.,,, )
RenDup( cFile, xDbf, xNtx )

cFile := "PAGO"
xNtx    := FTempName("T*.TMP")
cTela := Mensagem("Verificando: " + cFile )
xDbf := ""

dbSelectArea( "Pago" )
ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "Codi + Str( Vlr, 13, 2 ) + dTos( Vcto ) + Docnr + dTos( DataPag) + Str( VlrPag, 13, 2 )", {|| Codi + Str( Vlr, 13, 2 ) + dTos( Vcto ) + Docnr + dTos( DataPag) + Str( VlrPag, 13, 2 )}, .T. )
nX := 0
WHILE File(( xDbf := cFile + "." + StrZero( ++nX, 3 )))
EndDo
__dbCopy( ( xDbf ), { },,,,, .F.,,, )
RenDup( cFile, xDbf, xNtx )

cFile := "CHEQUE"
xNtx    := FTempName("T*.TMP")
cTela := Mensagem("Verificando: " + cFile )
xDbf := ""

dbSelectArea( "Cheque" )
ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "Codi", {|| Codi}, .T. )
nX := 0
WHILE File(( xDbf := cFile + "." + StrZero( ++nX, 3 )))
EndDo
__dbCopy( ( xDbf ), { },,,,, .F.,,, )
RenDup( cFile, xDbf, xNtx )

cFile := "LISTA"
xNtx    := FTempName("T*.TMP")
cTela := Mensagem("Verificando: " + cFile )
xDbf := ""

dbSelectArea( "Lista" )
ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "Codigo + Descricao + Codi + CodGrupo + CodSgrupo", {|| Codigo + Descricao + Codi + CodGrupo + CodSgrupo}, .T. )
nX := 0
WHILE File(( xDbf := cFile + "." + StrZero( ++nX, 3 )))
EndDo
__dbCopy( ( xDbf ), { },,,,, .F.,,, )
RenDup( cFile, xDbf, xNtx )

cFile := "REGIAO"
xNtx    := FTempName("T*.TMP")
cTela := Mensagem("Verificando: " + cFile )
xDbf := ""

dbSelectArea( "Regiao" )
ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "Regiao + Nome", {|| Regiao + Nome}, .T. )
nX := 0
WHILE File(( xDbf := cFile + "." + StrZero( ++nX, 3 )))
EndDo
__dbCopy( ( xDbf ), { },,,,, .F.,,, )
RenDup( cFile, xDbf, xNtx )

cFile := "CURSOS"
xNtx    := FTempName("T*.TMP")
cTela := Mensagem("Verificando: " + cFile )
xDbf := ""

dbSelectArea( "Cursos" )
ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "Curso + Obs", {|| Curso + Obs}, .T. )
nX := 0
WHILE File(( xDbf := cFile + "." + StrZero( ++nX, 3 )))
EndDo
__dbCopy( ( xDbf ), { },,,,, .F.,,, )
RenDup( cFile, xDbf, xNtx )

cFile := "FORMA"
xNtx    := FTempName("T*.TMP")
cTela := Mensagem("Verificando: " + cFile )
xDbf := ""

dbSelectArea( "Forma" )
ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "Forma + Condicoes", {|| Forma + Condicoes}, .T. )
nX := 0
WHILE File(( xDbf := cFile + "." + StrZero( ++nX, 3 )))
EndDo
__dbCopy( ( xDbf ), { },,,,, .F.,,, )
RenDup( cFile, xDbf, xNtx )

cFile := "RECEBER"
xNtx    := FTempName("T*.TMP")
cTela := Mensagem("Verificando: " + cFile )
xDbf := ""

dbSelectArea( "Receber" )
ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "Codi", {|| Codi}, .T. )
nX := 0
WHILE File(( xDbf := cFile + "." + StrZero( ++nX, 3 )))
EndDo
__dbCopy( ( xDbf ), { },,,,, .F.,,, )
RenDup( cFile, xDbf, xNtx )

cFile := "PAGAR"
xNtx    := FTempName("T*.TMP")
cTela := Mensagem("Verificando: " + cFile )
xDbf := ""

dbSelectArea( "Pagar" )
ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "Codi", {|| Codi}, .T. )
nX := 0
WHILE File(( xDbf := cFile + "." + StrZero( ++nX, 3 )))
EndDo
__dbCopy( ( xDbf ), { },,,,, .F.,,, )
RenDup( cFile, xDbf, xNtx )

cFile := "USUARIO"
xNtx    := FTempName("T*.TMP")
cTela := Mensagem("Verificando: " + cFile )
xDbf := ""

dbSelectArea( "Usuario" )
ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "Nome", {|| Nome}, .T. )
nX := 0
WHILE File(( xDbf := cFile + "." + StrZero( ++nX, 3 )))
EndDo
__dbCopy( ( xDbf ), { },,,,, .F.,,, )
RenDup( cFile, xDbf, xNtx )

cFile := "GRUPO"
xNtx    := FTempName("T*.TMP")
cTela := Mensagem("Verificando: " + cFile )
xDbf := ""

dbSelectArea( "Grupo" )
ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "CodGrupo + DesGrupo", {|| CodGrupo + DesGrupo}, .T. )
nX := 0
WHILE File(( xDbf := cFile + "." + StrZero( ++nX, 3 )))
EndDo
__dbCopy( ( xDbf ), { },,,,, .F.,,, )
RenDup( cFile, xDbf, xNtx )

cFile := "SUBGRUPO"
xNtx    := FTempName("T*.TMP")
cTela := Mensagem("Verificando: " + cFile )
xDbf := ""

dbSelectArea( "SubGrupo" )
ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "CodsGrupo + DesSgrupo", {|| CodsGrupo + DesSgrupo}, .T. )
nX := 0
WHILE File(( xDbf := cFile + "." + StrZero( ++nX, 3 )))
EndDo
__dbCopy( ( xDbf ), { },,,,, .F.,,, )
RenDup( cFile, xDbf, xNtx )

cFile := "VENDEDOR"
xNtx    := FTempName("T*.TMP")
cTela := Mensagem("Verificando: " + cFile )
xDbf := ""

dbSelectArea( "Vendedor" )
ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "CodiVen + Nome", {|| CodiVen + Nome}, .T. )
nX := 0
WHILE File(( xDbf := cFile + "." + StrZero( ++nX, 3 )))
EndDo
__dbCopy( ( xDbf ), { },,,,, .F.,,, )
RenDup( cFile, xDbf, xNtx )

cFile := "CHEMOV"
xNtx    := FTempName("T*.TMP")
cTela := Mensagem("Verificando: " + cFile )
xDbf := ""

dbSelectArea( "Chemov" )
ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "Codi + dTos( Data ) + dTos( Emis ) + Hist + Docnr + Fatura + Caixa + Str( Cre, 13,2) + Str(Deb, 13,2) + Tipo", {|| Codi + dTos( Data ) + dTos( Emis ) + Hist + Docnr + Fatura + Caixa + Str( Cre, 13,2) + Str(Deb, 13,2) + Tipo}, .T. )
nX := 0
WHILE File(( xDbf := cFile + "." + StrZero( ++nX, 3 )))
EndDo
__dbCopy( ( xDbf ), { },,,,, .F.,,, )
RenDup( cFile, xDbf, xNtx )

cFile := "RECEBIDO"
xNtx    := FTempName("T*.TMP")
cTela := Mensagem("Verificando: " + cFile )
xDbf := ""

dbSelectArea( "Recebido" )
ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "Codi + Str(Vlr,13,2) + dTos(Emis) + dTos(Vcto) + Docnr + Fatura + dTos( DataPag ) + Str(VlrPag, 13,2 )", {|| Codi + Str(Vlr,13,2) + dTos(Emis) + dTos(Vcto) + Docnr + Fatura + dTos( DataPag ) + Str(VlrPag, 13,2 )}, .T. )
nX := 0
WHILE File(( xDbf := cFile + "." + StrZero( ++nX, 3 )))
EndDo
__dbCopy( ( xDbf ), { },,,,, .F.,,, )
RenDup( cFile, xDbf, xNtx )

cFile := "ENTRADAS"
xNtx    := FTempName("T*.TMP")
cTela := Mensagem("Verificando: " + cFile )
xDbf := ""

dbSelectArea( "Entradas" )
ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "Codi + dTos( Data ) + Codigo + Fatura + Str(VlrFatura,13,2)", {|| Codi + dTos( Data ) + Codigo + Fatura + Str(VlrFatura,13,2)}, .T. )
nX := 0
WHILE File(( xDbf := cFile + "." + StrZero( ++nX, 3 )))
EndDo
__dbCopy( ( xDbf ), { },,,,, .F.,,, )
RenDup( cFile, xDbf, xNtx )

cFile := "CHEPRE"
xNtx    := FTempName("T*.TMP")
cTela := Mensagem("Verificando: " + cFile )
xDbf := ""

dbSelectArea( "Chepre" )
ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "Codi + Docnr + dTos( Data ) + dTos( Vcto ) + Hist + DebCre + Str( Valor, 13 ,2 )", {|| Codi + Docnr + dTos( Data ) + dTos( Vcto ) + Hist + DebCre + Str( Valor, 13 ,2 )}, .T. )
nX := 0
WHILE File(( xDbf := cFile + "." + StrZero( ++nX, 3 )))
EndDo
__dbCopy( ( xDbf ), { },,,,, .F.,,, )
RenDup( cFile, xDbf, xNtx )

FechaTudo()
ResTela( cTela )
Return

Proc RenDup( cFile, xDbf, xNtx )

DbCloseArea()
IF !FRename( cFile + ".DBF", cFile + ".LIX")
    Ferase( cFile + ".LIX")
    FRename( cFile + ".DBF", cFile + ".LIX")
EndIF
IF !FRename( xDbf, cFile + ".DBF")
    oMenu:Limpa()
    ErrorBeep()
    Alerta("Erro # " + ltrim(rtrim(Str( Ferror()))) + " : Erro ao renomear arquivo " + cFile + ".DBF.")
    FechaTudo()
    Return
EndIF
Ferase( xNtx )

Proc DupSaidas()

LOCAL cFile
LOCAL xDbf
LOCAL xNtx
LOCAL nx

Mensagem("Informa: Aguarde, Excluindo Arquivos Temporarios.")
oMenu:Limpa()
ExcluirTemporarios()

IF !UsaArquivo("SAIDAS") ; Break ; EndiF
cFile := "SAIDAS"
xNtx    := FTempName("T*.TMP")
cTela := Mensagem("Verificando: " + cFile )
xDbf := ""

dbSelectArea( "Saidas" )
ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "Codigo + Docnr + CodiVen + Codi + Fatura + Pedido + dTos( Data )", {|| Codigo + Docnr + CodiVen + Codi + Fatura + Pedido + dTos( Data )}, .T. )
nX := 0
WHILE File(( xDbf := cFile + "." + StrZero( ++nX, 3 )))
EndDo
__dbCopy( ( xDbf ), { },,,,, .F.,,, )
RenDup( cFile, xDbf, xNtx )
ResTela( cTela )
Return

Proc DupRecemov()

LOCAL cFile
LOCAL xDbf
LOCAL xNtx
LOCAL nx

Mensagem("Informa: Aguarde, Excluindo Arquivos Temporarios.")
oMenu:Limpa()
ExcluirTemporarios()

IF !UsaArquivo("RECEMOV") ; Break ; EndiF
cFile := "RECEMOV"
xNtx    := FTempName("T*.TMP")
cTela := Mensagem("Verificando: " + cFile )
xDbf := ""

dbSelectArea( "Recemov" )
ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "Docnr + Fatura + Codi + CodiVen + Caixa + Str( Vlr, 13,2 ) + dTos( Vcto)", {|| Docnr + Fatura + Codi + CodiVen + Caixa + Str( Vlr, 13,2 ) + dTos( Vcto)}, .T. )
nX := 0
WHILE File(( xDbf := cFile + "." + StrZero( ++nX, 3 )))
EndDo
__dbCopy( ( xDbf ), { },,,,, .F.,,, )
RenDup( cFile, xDbf, xNtx )
ResTela( cTela )
Return

Proc DupRecebido()

LOCAL cFile
LOCAL xDbf
LOCAL xNtx
LOCAL nx

Mensagem("Informa: Aguarde, Excluindo Arquivos Temporarios.")
oMenu:Limpa()
ExcluirTemporarios()

IF !UsaArquivo("RECEBIDO") ; Break ; EndiF
cFile := "RECEBIDO"
xNtx    := FTempName("T*.TMP")
cTela := Mensagem("Verificando: " + cFile )
xDbf := ""

dbSelectArea( "Recebido" )
ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "Codi + dTos( DataPag ) + dTos( Emis ) + Docnr + Fatura + Str( VlrPag, 13, 2 ) + Tipo", {|| Codi + dTos( DataPag ) + dTos( Emis ) + Docnr + Fatura + Str( VlrPag, 13, 2 ) + Tipo}, .T. )
nX := 0
WHILE File(( xDbf := cFile + "." + StrZero( ++nX, 3 )))
EndDo
__dbCopy( ( xDbf ), { },,,,, .F.,,, )
RenDup( cFile, xDbf, xNtx )
ResTela( cTela )
Return

Proc DupChemov()

LOCAL cFile
LOCAL xDbf
LOCAL xNtx
LOCAL nx

Mensagem("Informa: Aguarde, Excluindo Arquivos Temporarios.")
oMenu:Limpa()
ExcluirTemporarios()

IF !UsaArquivo("CHEMOV") ; Break ; EndiF
cFile := "CHEMOV"
xNtx    := FTempName("T*.TMP")
cTela := Mensagem("Verificando: " + cFile )
xDbf := ""

dbSelectArea( "Chemov" )
ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "Codi + dTos( Data ) + dTos( Emis ) + Hist + Docnr + Fatura + Caixa + Str( Cre, 13,2) + Str(Deb, 13,2) + Tipo", {|| Codi + dTos( Data ) + dTos( Emis ) + Hist + Docnr + Fatura + Caixa + Str( Cre, 13,2) + Str(Deb, 13,2) + Tipo}, .T. )
nX := 0
WHILE File(( xDbf := cFile + "." + StrZero( ++nX, 3 )))
EndDo
__dbCopy( ( xDbf ), { },,,,, .F.,,, )
RenDup( cFile, xDbf, xNtx )
ResTela( cTela )
Return

Proc DupLista()

LOCAL cFile
LOCAL xDbf
LOCAL xNtx
LOCAL nx

Mensagem("Informa: Aguarde, Excluindo Arquivos Temporarios.")
oMenu:Limpa()
ExcluirTemporarios()

IF !UsaArquivo("LISTA") ; Break ; EndiF
cFile := "LISTA"
xNtx    := FTempName("T*.TMP")
cTela := Mensagem("Verificando: " + cFile )
xDbf := ""

dbSelectArea( "Lista" )
ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "Codigo + Descricao + Codi + CodGrupo + CodSgrupo", {|| Codigo + Descricao + Codi + CodGrupo + CodSgrupo}, .T. )
nX := 0
WHILE File(( xDbf := cFile + "." + StrZero( ++nX, 3 )))
EndDo
__dbCopy( ( xDbf ), { },,,,, .F.,,, )
RenDup( cFile, xDbf, xNtx )
ResTela( cTela )
Return

Proc DupReceber()

LOCAL cFile
LOCAL xDbf
LOCAL xNtx
LOCAL nx

Mensagem("Informa: Aguarde, Excluindo Arquivos Temporarios.")
oMenu:Limpa()
ExcluirTemporarios()

IF !UsaArquivo("RECEBER") ; Break ; EndiF
cFile := "RECEBER"
xNtx    := FTempName("T*.TMP")
cTela := Mensagem("Verificando: " + cFile )
xDbf := ""

dbSelectArea( "Receber" )
ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "Codi", {|| Codi}, .T. )
nX := 0
WHILE File(( xDbf := cFile + "." + StrZero( ++nX, 3 )))
EndDo
__dbCopy( ( xDbf ), { },,,,, .F.,,, )
RenDup( cFile, xDbf, xNtx )
ResTela( cTela )
Return

function DupEntradas()

    LOCAL cFile := "ENTRADAS"
    LOCAL nx
    PRIVA xNtx   := FTempMemory()
    PRIVA xDbf   := FTempMemory()

    Mensagem("Informa: Aguarde, Excluindo Arquivos Temporarios.")
    oMenu:Limpa()
    ExcluirTemporarios()
    IF !UsaArquivo("ENTRADAS") ; Break ; EndiF
    cTela := Mensagem("Verificando: " + cFile )

    dbSelectArea( "ENTRADAS" )
    ordCondSet(,,,,,, RecNo(),,,,,,,,,,, .T.,, ) ; ordCreate( "MEM:&xNtx",, "Codi + dTos( Data ) + Codigo + Fatura + Str(VlrFatura,13,2)", {|| Codi + dTos( Data ) + Codigo + Fatura + Str(VlrFatura,13,2)}, .T. )
    __dbCopy( "MEM:&xDbf", { },,,,, .F.,,, )
    RenDup( cFile, MEM:&xDbf, xNtx )
    ResTela( cTela )
    Return


function DupPagamov()

    LOCAL cFile := "PAGAMOV"
    LOCAL nx
    PRIVA xNtx   := FTempMemory()
    PRIVA xDbf   := FTempMemory()

    Mensagem("Informa: Aguarde, Excluindo Arquivos Temporarios.")
    oMenu:Limpa()
    ExcluirTemporarios()
    IF !UsaArquivo("PAGAMOV") ; Break ; EndiF
    cTela := Mensagem("Verificando: " + cFile )

    dbSelectArea( "PAGAMOV" )
    ordCondSet(,,,,,, RecNo(),,,,,,,,,,, .T.,, ) ; ordCreate( "MEM:&xNtx",, "Docnr + Fatura + Codi + Str( Vlr, 13,2 ) + dTos( Vcto) + dTos( Emis )", {|| Docnr + Fatura + Codi + Str( Vlr, 13,2 ) + dTos( Vcto) + dTos( Emis )}, .T. )
    hb_vfCopyFile( "mem:test.dbf", "test1.dbf" )
    __dbCopy( "MEM:&xDbf", { },,,,, .F.,,, )
    RenDup( cFile, MEM:&xDbf, xNtx )
    ResTela( cTela )
    return nil




function CriaNewNota( lSimNao )

    LOCAL GetList  := {}
    LOCAL cScreen  := SaveScreen()
    LOCAL cFatura  := ""
    LOCAL cTela
    PRIVA xNtx     := FTempMemory()
    PRIVA xNewNota := FTempMemory()

    if lSimNao = NIL
        ErrorBeep()
        if !Conf("Pergunta: Verificacao podera demorar. Continuar ?")
            return(ResTela( cScreen))
        endif
    endif

    cTela := Mensagem(" Aguarde... Verificando e abrindo arquivos.")
    FechaTudo()
    IF !NetUse("Saidas",  .F. )   ; ResTela( cTela ); Return(.F.) ; EndIF
    IF !NetUse("Nota",    .F. )   ; ResTela( cTela ); Return(.F.) ; EndIF
    IF !NetUse("Recemov", .F. )   ; ResTela( cTela ); Return(.F.) ; EndIF
    ResTela( cTela )

    cTela := Mensagem("Verificando: SAIDAS.DBF")
    dbSelectArea( "Recemov" )
    dbSelectArea( "Saidas" )
    dbSelectArea( "Nota" )
    Nota->(__DbZap())
    ordCondSet(,,,,,, RecNo(),,,,,,,,,,, .T.,, ) ; ordCreate( "mem:&xNtx",, "Numero", {|| Numero}, )
    Saidas->(Order( 3 ))
    Saidas->(DbGoTop())

    WHILE Saidas->(!Eof()) .AND. lCancelou() .AND. oMenu:ContaReg()
        cFatura := Saidas->Fatura
        IF Nota->(!DbSeek( cFatura ))
            Nota->(DbAppend())
            Nota->Codi          := Saidas->Codi
            Nota->Numero      := Saidas->Fatura
            Nota->Atualizado := Date()
            Nota->Data          := Saidas->Data
            Nota->Situacao   := Saidas->Situacao
            Nota->Caixa      := Saidas->Caixa
        EndIF
        Saidas->(DbSkip(1))
    EndDo

    cTela := Mensagem("Verificando: RECEMOV.DBF")
    Recemov->(Order(4))
    Recemov->(DbGotop())

    while Recemov->(!Eof()) .AND. lCancelou() .AND. oMenu:ContaReg()
        cFatura := Recemov->Fatura
        IF Nota->(!DbSeek( cFatura ))
            Nota->(DbAppend())
            Nota->Codi          := Recemov->Codi
            Nota->Numero      := Recemov->Fatura
            Nota->Atualizado := Date()
            Nota->Data          := Recemov->Emis
            Nota->Situacao   := "RECEBER"
            Nota->Caixa      := Recemov->Caixa
        EndIF
        Recemov->(DbSkip(1))
    enddo

    Nota->(Order( 0 ))
    ms_swap_ferase("NEWNOTA.DBF")
    sx_SortOption(.F.); __dbSort( "mem:&xNewNota", { "Numero" },,,,, .F.,,, )
    Nota->(__DbZap())
    Nota->(__DbPack())
    __dbApp( "mem:&xNewNota", { },,,,, .F.,,, )
    FechaTudo()
    ms_swap_ferase("NOTA." + "CDX")



    return( ResTela( cTela ))


function CriaNewEnt()

    LOCAL cFatura := ""
    LOCAL cTela   := Mensagem("Aguarde... Verificando Arquivos.")
    PRIVA xNtx    := FTempMemory()

    FechaTudo()
    IF !NetUse("Entradas", .F. ) ; ResTela( cTela ); Return(.F.) ; EndIF
    IF !NetUse("EntNota",  .F. ) ; ResTela( cTela ); Return(.F.) ; EndIF
    ResTela( cTela )

    cTela := Mensagem("Verificando: ENTRADAS.DBF")
    dbSelectArea( "Entradas" )
    dbSelectArea( "EntNota" )
    EntNota->(__DbZap())
    ordCondSet(,,,,,, RecNo(),,,,,,,,,,, .T.,, ) ; ordCreate( "mem:&xNtx",, "Numero", {|| Numero}, )
    Entradas->(DbGoTop())

    while Entradas->(!Eof())
        cFatura := Entradas->Fatura
        IF EntNota->(!DbSeek( cFatura ))
            EntNota->(DbAppend())
            EntNota->Codi          := Entradas->Codi
            EntNota->Numero      := Entradas->Fatura
            EntNota->VlrFatura  := Entradas->VlrFatura
            EntNota->VlrNff      := Entradas->VlrNFF
            EntNota->Icms          := Entradas->Icms
            EntNota->Entrada      := Entradas->DEntrada
            EntNota->Data          := Entradas->Data
            EntNota->Condicoes  := Entradas->Condicoes
            EntNota->Atualizado := Date()
        EndIF
        Entradas->(DbSkip(1))
    EndDo
    FechaTudo()
    ms_swap_ferase("ENTNOTA." + "CDX")



    return(ResTela( cTela ))


function lCancelou()

    if LastKey() = 27
        if alerta("INFO: Tarefa n„o concluida. Banco de Dados poder  ficar inconsitente.;; Deseja cancelar mesmo assim?", {" Sim ", " Nao "}) == 1
            FechaTudo()
            return .F.
        endif
    endif
    return .T.


function CriaNewPrinter()

    LOCAL cTela   := Mensagem("Aguarde, Verificando Arquivos.", 47, 18 )

    FechaTudo()
    IF !NetUse("PRINTER", .F. ) ; ResTela( cTela ); Return(.F.) ; EndIF
    ResTela( cTela )

    cTela := Mensagem("Verificando: PRINTER.DBF")
    dbSelectArea( "Printer" )
    Printer->(__DbZap())
    ArrPrinter()
    FechaTudo()
    ResTela( cTela )
    Return


function _SaidaVideo()

    LOCAL cScreen := SaveScreen()
    LOCAL aCep      := {}
    LOCAL cTela

    dbSelectArea( "Cep" )
    Cep->(Order( 1 ))
    Cep->(DbGoTop())
    cTela := Mensagem("Aguarde ... ")

    while !Eof() .AND. Rep_Ok()
        Aadd( aCep,  Cep->Cep + " " + Cep->Cida + " " + Cep->Esta + " " + Cep->Bair )
        Cep->(DbSkip(1))
    enddo

    if Len( aCep ) <> 0
        ResTela( cTela )
        cString := " CEP       CIDADE                    UF BAIRRO"
        Print( 00, 00, cString + Space( 80 - Len(  cString )), Roloc(Cor()))
        M_Title( "ESC Retorna ")
        FazMenu( 01, 00, aCep, Cor())
    EndIF
    return(ResTela( cScreen ))


Proc DetalheRecibo( cCaixa, cTipoDetalhe )

LOCAL GetList         := {}
LOCAL cScreen             := SaveScreen()
LOCAL Arq_Ant             := Alias()
LOCAL Ind_Ant             := IndexOrd()
LOCAL aMenu            := {"Normal", "Somente Creditos", "Somente Debitos" }
LOCAL nRolCaixa         := oIni:ReadInteger("relatorios","rolcaixa", 1 )
LOCAL nTipoCaixa         := oIni:ReadInteger("relatorios","tipocaixa", 2 )
LOCAL nPartida          := oIni:ReadInteger("relatorios","rolcontrapartida", 2 )
LOCAL lVisualizarDetalheCaixa := oSci:ReadBool("permissao","visualizardetalhecaixa", .T. )
LOCAL Pagina             := 0
LOCAL nTamArray         := 0
LOCAL Tam                 := 132
LOCAL dIni                 := Date()
LOCAL dFim                 := Date()
LOCAL nDif                 := 0
LOCAL lDetalhe        := .T.
LOCAL nOpcao          := NIL
LOCAL nSoma           := 0
LOCAL nSomaRec        := 0
LOCAL nPagDia         := 0
LOCAL nPagDiv         := 0
LOCAL nQtDocumento    := 0
LOCAL nQtRec          := 0
LOCAL nQtPagDiv       := 0
LOCAL nQtPagDia       := 0
LOCAL aTodos          := {}
LOCAL lVideo          := .T.
LOCAL cTitular
LOCAL oRelato
FIELD Caixa
FIELD Tipo
FIELD Cre
FIELD Deb
FIELD Data
FIELD Hist
FIELD Docnr
FIELD Codi
FIELD Vlr
FIELD Vcto

oMenu:Limpa()
IF nOpcao = NIL
    IF cCaixa = Nil
        cCaixa := Space(4)
        IF !VerSenha( @cCaixa )
            AreaAnt( Arq_Ant, Ind_Ant )
            ResTela( cScreen )
            Return
        EndIF
    EndIF
EndIF
IF !lVisualizarDetalheCaixa
    IF !PedePermissao( 300 )
        Restela( cScreen )
        Return
    EndIF
EndIF

WHILE .T.
    oMenu:Limpa()
    M_Title("ESCOLHA UMA OPCAO")
    nChoice := FazMenu( 03, 10, aMenu )

    if nChoice = 0
        Return NIL
    endif

   MaBox( 10, 10, 13, 37 )
   SetCursor(1) ; DevPos( 11, 11 ) ; DevOut( "Data Inicial : " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dIni, "dIni", "##/##/##",,))
   SetCursor(1) ; DevPos( 12, 11 ) ; DevOut( "Data Final   : " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dFim, "dFim", "##/##/##", {|| dFim >= dIni},))
   ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
   IF LasTkey() = 27
      Loop
   EndIF
    lVideo := Alerta("Imprimir em qual saida?", {"Saida em Video", "Saida em Impressora"}) == 1
   IF nOpcao = NIL
      Vendedor->(Order( 1 ))
      Vendedor->(DbSeek( cCaixa ))
      cTitular := Vendedor->Nome
   EndIF
   cIni    := Dtoc( dIni )
   cFim    := Dtoc( dFim )
   IF cTipoDetalhe = 1
      cTitulo := "RELATORIO EMISSAO DE RECIBO EM CARTEIRA REF &cIni. A &cFim. EMITIDO POR: " + cCaixa + " - " + ltrim(rtrim(cTitular))
   ElseIF cTipoDetalhe = 2
      cTitulo := "RELATORIO EMISSAO DE RECIBO EM BANCO REF &cIni. A &cFim. EMITIDO POR: " + cCaixa + " - " + ltrim(rtrim(cTitular))
   ElseIF cTipoDetalhe = 3
      cTitulo := "RELATORIO EMISSAO DE RECIBO DE OUTROS REF &cIni. A &cFim. EMITIDO POR: " + cCaixa + " - " + ltrim(rtrim(cTitular))
   EndIF
   Mensagem("Aguarde... Verificando Movimento.")
   dbSelectArea( "Recibo" )
   Recibo->(Order( 5 ))
   OrdScope( 0 )
   OrdScope( 1 )
   Recibo->(DbGoTop())
   OrdScope( 0, dIni)
   OrdScope( 1, dFim )
   Recibo->(DbGoTop())

   nSoma        := 0
    nSomaRec     := 0
    nPagDia      := 0
    nPagDiv      := 0
    nQtRec       := 0
   nQtDocumento := 0
    nQtPagDiv    := 0
    nQtPagDia    := 0
    aTodos       := {}

    oMenu:Limpa()
   oRelato                := TRelatoNew()
    oRelato:Tamanho    := 132
    oRelato:NomeFirma := ltrim(rtrim(oAmbiente:xFanta))
    oRelato:Sistema    := SISTEM_NA3
    oRelato:Titulo     := cTitulo
    oRelato:Cabecalho := "TIPO    CODI NOME CLIENTE                     DOCTO N§     VCTO    PAGTO     HORA  RECEBIDO CAIXA HISTORICO"

    if !lVideo
        IF !Instru80()
            OrdScope( 0 )
            OrdScope( 1 )
            AreaAnt( Arq_Ant, Ind_Ant )
            ResTela( cScreen )
            Return
        EndIF
        cTela := Mensagem("Aguarde, Imprimindo Relatorio de Recibos.")
        oRelato:PrintOn(Chr(27) + "C" + Chr(33) + PQ )

        oRelato:Inicio()
    else
        cTela := Mensagem("Aguarde, Imprimindo Relatorio de Recibos.")
        aadd( aTodos, Padc(oRelato:Titulo, oRelato:Tamanho))
        aadd( aTodos, Repl( oRelato:Separador, oRelato:Tamanho ))
        aadd( aTodos, "TIPO    CODI NOME CLIENTE                     DOCTO N§     VCTO    PAGTO     HORA  RECEBIDO CAIXA HISTORICO")
        aadd( aTodos, Repl( oRelato:Separador, oRelato:Tamanho ))
    endif
    WHILE Recibo->(!Eof())
        if !lVideo
            IF oRelato:RowPrn = 0
                oRelato:Cabec()
            endif
      endIF

      IF Recibo->Tipo == "BAIXAS"
         Recibo->(DbSkip(1))
         Loop
      EndIF

      IF cTipoDetalhe == 1
         IF Recibo->Tipo == "RECBCO" .OR. Recibo->Tipo == "RECOUT"
            Recibo->(DbSkip(1))
            Loop
         EndIF
      EndIF

      IF cTipoDetalhe == 2
         IF Recibo->Tipo <> "RECBCO"
            Recibo->(DbSkip(1))
            Loop
         EndIF
      EndIF

      IF cTipoDetalhe == 3
         IF Recibo->Tipo <> "RECOUT"
            Recibo->(DbSkip(1))
            Loop
         EndIF
      EndIF

        nVlr := Recibo->Vlr

        if nChoice = 2
           if nVlr < 0
                Recibo->(DbSkip(1))
                Loop
            endif
        endif
        if nChoice = 3
           if nVlr >= 0
                Recibo->(DbSkip(1))
                Loop
            endif
        endif

      nQtDocumento++
      nSoma += nVlr

        if     Recibo->Tipo = "PAGDIA"
           nQtPagDia++
           nPagDia += nVlr
        elseif Recibo->Tipo = "PAGDIV"
           nQtPagDiv++
           nPagDiv += nVlr
        else
           nQtRec++
           nSomaRec += nVlr
        endif
        cLine := Recibo->( Tipo + " " + Codi + " " + Left(Nome,31) + " " + Docnr + " " + Dtoc(Vcto) + " " + Dtoc(Data) + " " + Hora + " " + Tran( nVlr, "@E 99,999.99") + " " + Left(Usuario,5) + " " + Left(Hist,34))
        if !lVideo
            Recibo->( Qout( Tipo, Codi, Left(Nome,31), Docnr, Vcto, Data, Hora, Tran( nVlr, "@E 99,999.99"), Left(Usuario,5), Left(Hist,34)))
        else
            aadd( aTodos, cLine )
        endif
        Recibo->(DbSkip(1))
        if !lVideo
            IF ++oRelato:RowPrn >= 25
                oRelato:Eject()
            endif
        endif
   EndDo
    if !lVideo
        Qout()
        Qout("TOTAL RECEBIMENTOS......:", StrZero( nQtRec,       4) + Space(48) + NG + Tran( nSomaRec, "@E 9,999,999.99") + NR)
        Qout("TOTAL DIARIAS PAGAS.....:", StrZero( nQtPagDia,    4) + Space(48) + NG + Tran( nPagDia,  "@E 9,999,999.99") + NR)
        Qout("TOTAL DESPESAS DIVERSAS.:", StrZero( nQtPagDiv,    4) + Space(48) + NG + Tran( nPagDiv,  "@E 9,999,999.99") + NR)
        Qout("TOTAL REGISTROS.........:", StrZero( nQtDocumento, 4) + Space(48) + NG + Tran( nSoma,    "@E 9,999,999.99") + NR)
        Qout()
        Qout()
        Qout(Repl("_",40))
        Qqout(Space(06) + Repl("_",40))
        Qqout(Space(06) + Repl("_",40))
        Qout(Space(16) + "CAIXA")
        Qqout(Space(42) + "CONFERENTE")
        Qqout(Space(34) + "TESOUREIRO")
        oRelato:Eject()
        ORelato:PrintOff(Chr(27) + "C" + Chr(66))
        ResTela( cTela )
    else
        aadd( aTodos, " ")
        aadd( aTodos, "TOTAL RECEBIMENTOS......:" + "  " + StrZero( nQtRec,       4) + Space(48) + Tran( nSomaRec, "@E 9,999,999.99"))
        aadd( aTodos, "TOTAL DIARIAS PAGAS.....:" + "  " + StrZero( nQtPagDia,    4) + Space(48) + Tran( nPagDia,  "@E 9,999,999.99"))
        aadd( aTodos, "TOTAL DESPESAS DIVERSAS.:" + "  " + StrZero( nQtPagDiv,    4) + Space(48) + Tran( nPagDiv,  "@E 9,999,999.99"))
        aadd( aTodos, "TOTAL REGISTROS.........:" + "  " + StrZero( nQtDocumento, 4) + Space(48) + Tran( nSoma,    "@E 9,999,999.99"))
        aadd( aTodos, " ")
        aadd( aTodos, " ")
        aadd( aTodos, Repl("_",40) + " " + Space(06) + Repl("_",40) + " " + Space(06) + Repl("_",40))
        aadd( aTodos, Space(16) + "CAIXA" + " " + Space(42) + "CONFERENTE" + " " + Space(34) + "TESOUREIRO")
        ResTela( cTela )
        M_Title( "ESC Retorna ")
        FazMenu( 00, 00, aTodos)
    endif
   OrdScope( 0 )
   OrdScope( 1 )
EndDO
AreaAnt( Arq_Ant, Ind_Ant )
ResTela( cScreen )
Return


Proc Retorno()

LOCAL cCodigo
LOCAL Data_Limite
LOCAL cExecucoes
LOCAL nNumero
LOCAL nTemp
LOCAL cSenha
LOCAL nCrc
LOCAL cEmpresa
LOCAL lTemDebito := .F.
LOCAL cCodi      := Space(05)
LOCAL nVersao    := 2
LOCAL cDia       := "01"
LOCAL cMesRet    := StrZero( Month( Date())+1,2)
LOCAL cAno       := StrZero( Year( Date()), 4 )
LOCAL aDias      := {"28","29","30","31"}

WHILE .T.
   oMenu:Limpa()
   SetKey( -4, NIL )
   MaBox( 10, 01, 14, MaxCol()-1 )
   lTemDebito  := .F.
   cCodi       := Space(05)
   cDia        := "01"
   cMesRet     := StrZero( Month( Date())+1,2)
   cAno        := StrZero( Year( Date()), 4 )
   cEmpresa    := Space(40)
   cCodigo     := Space(10)
   cDia        := StrZero(Day(Date()),2)
   cMesRet     := Month( Date())+1
   cAno        := Year( Date())
   IF Ascan( aDias, cDia ) > 0
      cMesRet ++
      IF cMesRet > 12
         cMesRet = 1
         cAno  ++
      EndIF
   EndIF
   cDia        := "01"
   cMesRet     := StrZero( cMesRet, 2 )
   cAno        := StrZero( cAno, 4)
   cData       := cDia + "/" + cMesRet +  "/" + cAno
    Data_Limite := Ctod( cData )
    cExecucoes    := Right( StrTran( Time(), ":"),2)
    cExecucoes    += Right( StrTran( Time(), ":"),2)




    SetCursor(1) ; DevPos( 11, 02 ) ; DevOut( "Cliente..................:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodi, "cCodi", "99999", {|| RecErrado( @cCodi,, Row(), Col()+1 ) .AND.     ClienteSci( cCodi ) .AND.     PosicaoDebito( cCodi, @lTemDebito, @Data_Limite ) .AND.     UltRetorno( cCodi )},))
    SetCursor(1) ; DevPos( 12, 02 ) ; DevOut( "Codigo Interno Fornecido.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodigo, "cCodigo", "@R 999.999.9999", {|| VerRetorno( cCodigo )},))
    SetCursor(1) ; DevPos( 13, 02 ) ; DevOut( "Data Limite de Execucoes.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( Data_Limite, "Data_Limite", "##/##/##", {|| RetLimite( @Data_Limite, lTemDebito  )},))
    ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
    IF LastKey() = 27
        SetKey( -4, {|| PrecosConsulta()})
        Return
    EndIF



    cData_Limite := StrTran( Dtoc( Data_Limite ), "/" )
    cSenha         := cData_Limite + cExecucoes



    nCrc := 0
    nX   := 0







    For nX := 1 To 10


        nCrc += Val( SubStr( cSenha,    nX, 1 )) *  Val( SubStr( cSenha,    nX, 1 )) +  Val( SubStr( cCodigo, nX, 1 ))
    Next
    cCrc := Right( StrZero( nCrc, 10),3)
    cSenha += cCrc
    Alert( "Codigo de Retorno " + Transform( cSenha, "@R 999.999.999.999.9"))
    Retorno->(DbGoBottom())
    nId := Retorno->Id
    nId++
    Receber->(Order( 2 ))
    Receber->(DbSeek( cCodi ))
    IF Retorno->(Incluiu())
        Retorno->Id       := nId
        Retorno->Codi      := cCodi
        Retorno->Empresa := Receber->Nome
        Retorno->Interno := cCodigo
        Retorno->Codigo  := cSenha
        Retorno->Limite  := Data_Limite
        Retorno->Data      := Date()
        Retorno->Versao  := nVersao
        Retorno->Hora      := Time()
        Retorno->Nome      := oAmbiente:xUsuario
        Retorno->Atualizado := Date()
        Retorno->(Libera())
    EndIF
EndDo

Function RetLimite( Data_Limite, lTemDebito )

IF LastKey() = 5
    Return( .T. )
ElseIF lTemDebito
    Data_Limite := Date() + 1
    Return( .T. )
ElseIF Data_Limite < Date()
    ErrorBeep()
    Alerta("Erro: Data Limite nao pode ser antes de Hoje.")
    Return( .F. )
EndIF
Return( .T. )

Function UltRetorno( xCliente )

LOCAL cScreen            := SaveScreen()
LOCAL Arq_Ant            := Alias()
LOCAL Ind_Ant            := IndexOrd()
LOCAL nSoma             := 0
LOCAL nChoice            := 0
LOCAL lAtraso            := .F.

Retorno->(Order( 1 ))
IF Retorno->(DbSeek( xCliente ))
    While Retorno->Codi = xCliente
        IF Retorno->Limite > Date()
            ErrorBeep()
            MaBox( 00, 00, 09, MaxCol())
            Write( 01, 01, "Ja foi fornecido Codigo para " + Dtoc( Retorno->Limite ) + ". Verifique com o cliente as opcoes.")
            Write( 03, 01, "1 - O SCI esta sendo instalado pela 1¦ vez ?")
            Write( 04, 01, "2 - Esta atualizando a versao do SCI ?")
            Write( 05, 01, "3 - Esta instalando um novo terminal ?")
            Write( 06, 01, "4 - A data do Sistema Operacional esta correta ?")
            Write( 07, 01, "5 - O arquivo SCI.EXE esta com data diferente do DOS ?")
            Write( 08, 01, "6 - Antecipacao de Codigo de Acceso.")
            Return( .T. )
        EndIF
        Retorno->(DbSkip(1))
    EndDo
EndIF
Return( .T. )

Function ClienteSci( xCliente )

LOCAL cScreen            := SaveScreen()
LOCAL Arq_Ant            := Alias()
LOCAL Ind_Ant            := IndexOrd()
LOCAL lRetVal            := .F.

Receber->(Order( 2 ))
IF Receber->(DbSeek( xCliente ))
    IF Receber->Sci = .T.
        lRetVal := .T.
    Else
        ErrorBeep()
        Alerta("Erro: Nao nao tem Sistema Registrado.")
    EndIF
EndIF
Return( lRetVal )

Function PosicaoDebito( xCliente, lTemDebito, Data_Limite )

LOCAL cScreen            := SaveScreen()
LOCAL Arq_Ant            := Alias()
LOCAL Ind_Ant            := IndexOrd()
LOCAL nSoma             := 0
LOCAL nChoice            := 0
LOCAL lAtraso            := .F.
LOCAL aMenu             := {"Cancelar", "Continuar", "Consultar"}

Recemov->(Order( 2 ))
IF Recemov->(DbSeek( xCliente ))
    While Recemov->Codi = xCliente
        IF Recemov->Vcto < Date()
            lAtraso := .T.
            Exit
        EndIF
        Recemov->(DbSkip(1))
    EndDo
EndIF
IF lAtraso
    Data_Limite := Date() + 1
    lTemDebito    := .T.
    MaBox( 00, 00, 04, MaxCol())
    Write( 01, 01, "1-Informe ao cliente que ele se encontra em atraso")
    Write( 02, 01, "  e que o sistema so permite liberar codigo de acesso")
    Write( 03, 01, "  somente para 1 dia, ate regularizacao do debito.")
    ErrorBeep()
    WHILE .T.
        M_Title("INFORMA: CLIENTE EM ATRASO. ESCOLHA UMA OPCAO")
        nChoice := FazMenu( 15, 10, aMenu)
        Do Case
        Case nChoice = 0 .OR. nChoice = 1
          ResTela( cScreen )
          Return( .F. )
        Case nChoice = 2
            ResTela( cScreen )
            Return( .T. )
        Case nChoice = 3
            PosiReceber( 1, xCliente )
        EndCase
    EndDo
EndIF
Return( .T. )

Function VerRetorno( cCodigo )

LOCAL nLen := Len( ltrim(rtrim(StrTran( cCodigo, "."))))

IF LastKey() = 5
    Return( .T. )
ElseIF Empty( cCodigo )
    ErrorBeep()
    Alerta("Erro: Campo nao Pode ser Vazio")
    Return( .F. )
ElseIF nLen < 10
    ErrorBeep()
    Alerta("Erro: Codigo Interno Invalido.")
    Return( .F. )
EndIF
Return( .T. )

Function Velho()

LOCAL cCodigo
LOCAL Data_Limite
LOCAL cExecucoes
LOCAL nNumero
LOCAL nTemp
LOCAL cSenha
LOCAL nCrc
LOCAL cEmpresa
LOCAL nVersao := 2

dbSelectArea( "Retorno" )
SetColor("W+/R")
Scroll( 10, 01, 14, MaxCol()-1 ) ; SetPos( 10, 01 )
DispBox( 10, 01, 14, MaxCol() -1 )
WHILE .T.
    cEmpresa  := Space(40)
    Ntemp      := Val(Strtran(Time(), ":"))

    Ccodigo     := ""
    For Nx := 1 To 5
        Nnumero := Random()
        Nnumero := ltrim(rtrim(Str(Nnumero)))
        Ccodigo := Ccodigo + Left(Nnumero, 2)
    Next
    cCodigo        := Space(10)
    cData         := "30/" + StrZero( Month( Date()),2 ) +  "/" + StrZero( Year( Date()), 4 )
    cData         := "30/09/98"
    Data_Limite := Ctod( cData )
    cExecucoes    := Right( StrTran( Time(), ":"),2)
    cExecucoes    += Right( StrTran( Time(), ":"),2)
    SetCursor(1) ; DevPos( 11, 02 ) ; DevOut( "Empresa........................:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cEmpresa, "cEmpresa", "@!",,))
    SetCursor(1) ; DevPos( 12, 02 ) ; DevOut( "Codigo Interno Fornecido.......:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodigo, "cCodigo", "@R 999.999.9999",,))
    SetCursor(1) ; DevPos( 13, 02 ) ; DevOut( "Data Limite de Execucoes.......:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( Data_Limite, "Data_Limite", "##/##/##",,))
    ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
    IF LastKey() = 27
        Return
    EndIF



    cData_Limite := StrTran( Dtoc( Data_Limite ), "/" )
    cSenha         := cData_Limite + cExecucoes



    nCrc := 0
    For Contador := 1 To 10


        nCrc += Val( SubStr( cCodigo, Contador, 1 )) *  Val( SubStr( cSenha, Contador, 1 )) +  Val( SubStr( cSenha, Contador, 1 ))
    Next
    cCrc     := Right( StrZero( nCrc, 10),3)
    cSenha += cCrc
    Alert( "Codigo de Retorno " + Transform( cSenha, "@R 999.999.999.999.9"))
    Retorno->(DbGoBottom())
    nId := Retorno->Id
    nId++
    IF Retorno->(Incluiu())
        Retorno->Id       := nId
        Retorno->Codi      := cCodi
        Retorno->Empresa := cEmpresa
        Retorno->Interno := cCodigo
        Retorno->Codigo  := cSenha
        Retorno->Limite  := Data_Limite
        Retorno->Data      := Date()
        Retorno->Versao  := nVersao
        Retorno->Hora      := Time()
        Retorno->Nome      := oAmbiente:xUsuario
        Retorno->(Libera())
        Return( .T. )
    EndIF
EndDo
Return( .F. )

Function AbreEmpresa()

LETO_SET( 7, ( oAmbiente:xBase ) )
IF !UsaArquivo("EMPRESA")
    LETO_SET( 7, ( oAmbiente:xBaseDados ) )
    Return( .F. )
EndIF
LETO_SET( 7, ( oAmbiente:xBaseDados ) )
Return( .T. )

Proc MoviAnual()

LOCAL GetList := {}
LOCAL cScreen := SaveScreen()
LOCAL nAnoIni := 1990
LOCAL nAnoFim := Year( Date()-1)

WHILE .T.
    MaBox( 10, 10, 12, 40 )
    SetCursor(1) ; DevPos( 11, 11 ) ; DevOut( "Ano..........." ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nAnoIni, "nAnoIni", "9999", {|| nAnoIni >= 1},))
    ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
    IF LastKey() = 27
        ResTela( cScreen )
        Return
  EndIF
  IF !AbreEmpresa()
      ResTela( cScreen )
      Return
  EndIF
  Empresa->(DbGoBottom())
  cCodi := StrZero( Val( Empresa->Codi)+1,4)
  IF Empresa->(!Incluiu())
      Loop
  EndIF
  Empresa->Codi := cCodi
  Empresa->Nome := "MOVIMENTO DO ANO " + StrZero( nAnoIni,4 )
  Empresa->(Libera())
  CriaEmpresa( cCodi )
  dbSelectArea( "Chemov" )
EndDo

Proc CriaEmpresa( cCodi )

Var1          := oAmbiente:xBase
Var2          := Var1 + "\EMP" + cCodi
oAmbiente:xBaseDados := Var2
LETO_SET( 7, ( Var2 ) )
FT_MkDir( Var2 )
LETO_SET( 7, ( oAmbiente:xBaseDados ) )
Return


Proc AutoCaixa()

LOCAL GetList    := {}
LOCAL cScreen    := SaveScreen()
LOCAL cDeb_Deb := ""
LOCAL cDeb_Cre := ""
LOCAL cCre_Deb := ""
LOCAL cCre_Cre := ""
LOCAL xDbf        := FTempName("T*.TMP")
LOCAL cCaixa    := Space(04)
LOCAL cCodiIni := Space(04)
LOCAL cCodiFim := Space(04)

IF !UsaArquivo("CHEQUE") ; Break ; EndIF
IF !UsaArquivo("CHEMOV") ; Break ; EndIF

MaBox( 10, 10, 14, 40 )
SetCursor(1) ; DevPos( 11, 11 ) ; DevOut( "Conta Caixa...." ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCaixa, "cCaixa", "####", {|| Cheerrado( @cCaixa )},))
SetCursor(1) ; DevPos( 12, 11 ) ; DevOut( "Conta Inicial.." ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodiIni, "cCodiIni", "####", {|| Cheerrado( @cCodiIni )},))
SetCursor(1) ; DevPos( 13, 11 ) ; DevOut( "Conta Final...." ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodiFim, "cCodiFim", "####", {|| Cheerrado( @cCodiFim )},))
ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
IF LastKey() = 27
    ResTela( cScreen )
    Return
EndIF
ErrorBeep()
IF !Conf("Pergunta: Deseja continuar a operacao ?")
    ResTela( cScreen )
    Return
EndIF
dbSelectArea( "CHEMOV" )
__dbCopyStruct( ( xDbf ), { } )
dbUseArea( .T.,, ( xDbf ), "xAlias", iif( .F. .OR. .T., ! .T., NIL ), .F. )
Chemov->(Order( 3 ))
dbSelectArea( "Cheque" )
Cheque->(Order( 1 ))
Cheque->(DbSeek( cCodiIni ))
Mensagem("Informa: Processando Movimento")
WHILE Cheque->Codi >= cCodiIni .AND. Cheque->Codi <= cCodiFim .AND. Rel_Ok()
    cCodi := Cheque->Codi
    IF cCodi == cCaixa
        Cheque->(DbSkip(1))
        Loop
    EndIF
    cDeb_Deb := Cheque->Deb_Deb
    cDeb_Cre := Cheque->Deb_Cre
    cCre_Deb := Cheque->Cre_Deb
    cCre_Cre := Cheque->Cre_Cre
    IF Empty( cDeb_Deb )
        IF Empty( cDeb_Cre )
            IF Empty( cCre_Deb )
                IF Empty( cCre_Cre )
                    Cheque->(DbSkip(1))
                    Loop
                EndIF
            EndIF
        EndIF
    EndIF
    IF Chemov->(DbSeek( cCodi ))
        WHILE Chemov->Codi = cCodi
            nReg := Chemov->(Recno())
            IF Chemov->Deb <> 0
                nVlr := Chemov->Deb
                IF !Empty( cDeb_Cre )
                    Deb_Cre( cCaixa, nVlr )
                EndIF
                IF !Empty( cDeb_Deb )
                    Deb_Deb( cCaixa, nVlr )
                EndIF
            ElseIF Chemov->Cre <> 0
                nVlr := Chemov->Cre
                IF !Empty( cCre_Cre )
                    Cre_Cre( cCaixa, nVlr )
                EndIF
                IF !Empty( cCre_Deb )
                    Cre_Deb( cCaixa,    nVlr )
                EndIF
            EndIF
            Chemov->(DbgoTo( nReg ))
            Chemov->(DbSkip(1))
        EndDo
    EndIF
    Cheque->(DbSkip(1))
EndDo

Proc Deb_Cre( cCaixa, nVlr )

xAlias->(DbAppend())
For nField := 1 To Chemov->(FCount())
    xAlias->(FieldPut( nField, Chemov->(FieldGet( nField ))))
Next
xAlias->Codi := cCaixa
xAlias->Deb  := 0
xAlias->Cre  := nVlr
Chemov->(DbAppend())
For nField := 1 To xAlias->(FCount())
    Chemov->(FieldPut( nField, xAlias->(FieldGet( nField ))))
Next
xAlias->(__DbZap())
Return

Proc Deb_Deb( cCaixa, nVlr )

xAlias->(DbAppend())
For nField := 1 To Chemov->(FCount())
    xAlias->(FieldPut( nField, Chemov->(FieldGet( nField ))))
Next
xAlias->Codi := cCaixa
xAlias->Cre  := 0
xAlias->Deb  := nVlr
Chemov->(DbAppend())
For nField := 1 To xAlias->(FCount())
    Chemov->(FieldPut( nField, xAlias->(FieldGet( nField ))))
Next
xAlias->(__DbZap())
Return

Proc Cre_Cre( cCaixa, nVlr )

xAlias->(DbAppend())
For nField := 1 To Chemov->(FCount())
    xAlias->(FieldPut( nField, Chemov->(FieldGet( nField ))))
Next
xAlias->Codi := cCaixa
xAlias->Cre  := nVlr
xAlias->Deb  := 0
Chemov->(DbAppend())
For nField := 1 To xAlias->(FCount())
    Chemov->(FieldPut( nField, xAlias->(FieldGet( nField ))))
Next
xAlias->(__DbZap())
Return

Proc Cre_Deb( cCaixa, nVlr )

xAlias->(DbAppend())
For nField := 1 To Chemov->(FCount())
    xAlias->(FieldPut( nField, Chemov->(FieldGet( nField ))))
Next
xAlias->Codi := cCaixa
xAlias->Cre  := 0
xAlias->Deb  := nVlr
Chemov->(DbAppend())
For nField := 1 To xAlias->(FCount())
    Chemov->(FieldPut( nField, xAlias->(FieldGet( nField ))))
Next
xAlias->(__DbZap())
Return

Proc ZeraCaixa()

LOCAL GetList    := {}
LOCAL cScreen    := SaveScreen()
LOCAL cCaixa    := Space(04)

IF !UsaArquivo("CHEQUE") ; Break ; EndIF
IF !UsaArquivo("CHEMOV") ; Break ; EndIF
MaBox( 10, 10, 12, 40 )
SetCursor(1) ; DevPos( 11, 11 ) ; DevOut( "Codigo Conta..." ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCaixa, "cCaixa", "####", {|| Cheerrado( @cCaixa ) .AND. VerZeraTem( @cCaixa )},))
ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
IF LastKey() = 27
    ResTela( cScreen )
    Return
EndIF
ErrorBeep()
IF !Conf("Pergunta: Deseja continuar a operacao ?")
    ResTela( cScreen )
    Return
EndIF
ErrorBeep()
IF !Conf("Pergunta: Tem Certeza ?")
    ResTela( cScreen )
    Return
EndIF
dbSelectArea( "CHEMOV" )
Chemov->(Order( 3 ))
IF Chemov->(DbSeek( cCaixa ))
    oMenu:Limpa()
    IF Chemov->(TravaArq())
        Mensagem("Aguarde, Zerando conta : " + cCaixa )
        WHILE Chemov->Codi == cCaixa
            Chemov->(DbDelete())
            Chemov->(DbSkip(1))
        EndDo
        Chemov->(Libera())
        Alerta("Informa: Zeramento Completado.")
    EndIF
Else
    oMenu:Limpa()
    Alerta("Informa: Nenhum movimento a zerar.")
EndIF
ResTela( cScreen )
Return

Function VerZeraTem( cCaixa )

LOCAL cScreen := SaveScreen()

Chemov->(Order( 3 ))
IF Chemov->(!DbSeek( cCaixa ))
    cCaixa := Space( 04 )
    oMenu:Limpa()
    ErrorBeep()
    Alerta("Informa: Nenhum movimento a zerar.")
    ResTela( cScreen )
    Return( .F. )
EndIF
Return( .T. )

Proc ProtegerDbf( lProteger, lSemPergunta )

LOCAL cScreen      := SaveScreen()
LOCAL aBase       := {}
LOCAL aBaseDados := {}
LOCAL OldDir      := FCurdir()
LOCAL nX
LOCAL nLen

oMenu:Limpa()
IF lSemPergunta = NIL
    MaBox( 10, 20, 12, 48 )
    DevPos( 11, 21 ) ; DevOut( "Senha...: " )
    Passe := Senha( 11, 33, 11 )
    IF Empty( Passe) .OR. Passe <> "63771588"
        ErrorBeep()
        Alerta("Erro: Senha invalida. Verifique com o supervisor.")
        Restela( cScreen )
        Return
    EndIF
    ErrorBeep()
    IF !Conf("Pergunta: Tem Certeza ?")
        ResTela( cScreen )
        Return
    EndIF
EndIF
Mensagem("Aguarde, Alterando dados.")
Aadd( aBaseDados, "LISTA.DBF")
Aadd( aBaseDados, "SAIDAS.DBF")
Aadd( aBaseDados, "RECEBER.DBF")
Aadd( aBaseDados, "REPRES.DBF")
Aadd( aBaseDados, "GRUPO.DBF")
Aadd( aBaseDados, "SUBGRUPO.DBF")
Aadd( aBaseDados, "VENDEDOR.DBF")
Aadd( aBaseDados, "VENDEMOV.DBF")
Aadd( aBaseDados, "RECEMOV.DBF")
Aadd( aBaseDados, "NOTA.DBF")
Aadd( aBaseDados, "ENTRADAS.DBF")
Aadd( aBaseDados, "PAGAR.DBF")
Aadd( aBaseDados, "PAGAMOV.DBF")
Aadd( aBaseDados, "TAXAS.DBF")
Aadd( aBaseDados, "PAGO.DBF")
Aadd( aBaseDados, "RECEBIDO.DBF")
Aadd( aBaseDados, "CHEQUE.DBF")
Aadd( aBaseDados, "CHEMOV.DBF")
Aadd( aBaseDados, "CHEPRE.DBF")
Aadd( aBaseDados, "FORMA.DBF")
Aadd( aBaseDados, "CURSOS.DBF")
Aadd( aBaseDados, "CURSADO.DBF")
Aadd( aBaseDados, "REGIAO.DBF")
Aadd( aBaseDados, "CEP.DBF")
Aadd( aBaseDados, "PONTO.DBF")
Aadd( aBaseDados, "SERVIDOR.DBF")
Aadd( aBaseDados, "PRINTER.DBF")
Aadd( aBaseDados, "ENTNOTA.DBF")
Aadd( aBaseDados, "CONTA.DBF")
Aadd( aBaseDados, "SUBCONTA.DBF")
Aadd( aBaseDados, "RETORNO.DBF")
Aadd( aBaseDados, "FUNCIMOV.DBF")
Aadd( aBaseDados, "GRPSER.DBF")
Aadd( aBaseDados, "SERVICO.DBF")
Aadd( aBaseDados, "CORTES.DBF")
Aadd( aBaseDados, "MOVI.DBF")
Aadd( aBaseDados, "RECIBO.DBF")
Aadd( aBaseDados, "AGENDA.DBF")
Aadd( aBaseDados, "CM.DBF")



FechaTudo()
FT_ChDir( oAmbiente:xBaseDados )
nLen := Len( aBaseDados )
For nX := 1 To nLen

  IF lProteger
      oProtege:Encryptar( aBaseDados[nX])
  Else
      oProtege:Decryptar( aBaseDados[nX])
  EndIF
Next
FT_ChDir( oAmbiente:xBase )
nLen := Len( aBase )
For nX := 1 To nLen

  IF lProteger
      oProtege:Encryptar( aBase[nX])
  Else
      oProtege:Decryptar( aBase[nX])
  EndIF
Next
FT_ChDir( OldDir )
FechaTudo()
ResTela( cScreen )
Return




Function PickTipoVenda( cPick )
    LOCAL aList      := { "Normal", "Conta Corrente"}
    LOCAL aSituacao := { "N", "S" }
    LOCAL cScreen     := SaveScreen()
    LOCAL nChoice

    IF Ascan( aSituacao, cPick ) <> 0
        Return( .T. )
    EndIF
    MaBox( 11, 01, 14, 44, NIL, NIL, Roloc( Cor()) )
    IF (nChoice := AChoice( 12, 02, 13, 43, aList )) <> 0
        cPick := aSituacao[ nChoice ]
    EndIf
    ResTela( cScreen )
    Return( .T. )


Function lPickSimNao( lPick )

LOCAL aList      := { "Sim", "Nao"}
LOCAL aSituacao := { .T., .F. }
LOCAL cScreen     := SaveScreen()
LOCAL nPos         := 0
LOCAL nChoice

nPos := Ascan( aSituacao, lPick )





MaBox( 11, 01, 14, 44, NIL, NIL, Roloc( Cor()) )
IF (nChoice := AChoice( 12, 02, 13, 43, aList, NIL, NIL, NIL, 2 )) <> 0
    lPick := aSituacao[ nChoice ]
EndIf
ResTela( cScreen )
Return( .T. )

Function PickSimNao( cPick )

LOCAL aList      := { "Sim", "Nao"}
LOCAL aSituacao := { "S", "N" }
LOCAL cScreen     := SaveScreen()
LOCAL nChoice

IF Ascan( aSituacao, cPick ) <> 0
    Return( .T. )
EndIF
MaBox( 11, 01, 14, 44, NIL, NIL, Roloc( Cor()) )
IF (nChoice := AChoice( 12, 02, 13, 43, aList )) <> 0
    cPick := aSituacao[ nChoice ]
EndIf
ResTela( cScreen )
Return( .T. )

Function ConfBaseDados()

LOCAL cScreen        := SaveScreen()
LOCAL GetList        := {}
LOCAL nChoice        := 0









LOCAL aMenu         := {"Saidas",  "Entradas", "financeiro", "Nota Fiscal", "ECF Cupom Fiscal", "Relatorios", "Arquivos de Impressao", "Prevenda", "Servidor banco de Dados", "Geral"}

WHILE .T.
    oMenu:Limpa()
    M_Title("Configuracao da Base de Dados")
    nChoice := FazMenu( 05, 10, aMenu )
    Do Case
    Case nChoice = 0
        ResTela( cScreen )
        Return
    Case nChoice = 1
        ConfFaturamento()
    Case nChoice = 2
        ConfEntradas()
    Case nChoice = 3
        ConfReceber()
    Case nChoice = 4
        ConfNota()
    Case nChoice = 5
        ConfEcf()
    Case nChoice = 6
        ConfRelatorios()
    Case nChoice = 7
        ConfImpressao()
    Case nChoice = 8
        ConfPrevenda()
    Case nChoice = 9
        ConfServidorBcoDados()
    Case nChoice = 10
        ConfGeral()
    EndCase
EndDo

Proc ConfFaturamento()

LOCAL cScreen        := SaveScreen()
LOCAL GetList        := {}
LOCAL cMens1        := Space(40)
LOCAL cMens2        := Space(40)
LOCAL cMens3        := Space(40)
LOCAL cMens4        := Space(40)
LOCAL cCodi         := Right( oAmbiente:xBaseDados, 4 )
LOCAL xIndiceNtx    := "EMPRESA1." + "CDX"
LOCAL xIndiceNsx    := "EMPRESA." + "CDX"
LOCAL nSegundos    := 2
LOCAL lFechado     := .T.
LOCAL cPath         := FCurdir()
LOCAL nItens        := 20
LOCAL cInscMun     := Space(15)
LOCAL nIss            := 0
LOCAL cAutoFatura
LOCAL cAutoDocumento
LOCAL cAltDescricao
LOCAL cTipoVenda
LOCAL cPrecoTicket
LOCAL cPrecoPrevenda
LOCAL cSerieProduto
LOCAL cDuplicidade
LOCAL nOrderTicket
LOCAL cZerarDesconto
LOCAL cRamo
LOCAL cPvRamo
LOCAL cPvCabec
LOCAL cCabecIni
LOCAL cMinimoMens
LOCAL cAutoEmissao
LOCAL cAutoDesconto
LOCAL cAutoLiquido
LOCAL cAutoFecha
LOCAL cEditarQuant
LOCAL cFantaCodebar
LOCAL cEndeFir  := "AV CASTELO BRANCO, 693 - PIONEIROS" + " - " + "(69)3451-3085" + " - " + "PIMENTA BUENO" + "/" + "RO"

LETO_SET( 7, ( oAmbiente:xBase ) )
IF !NetUse("EMPRESA", .T., nSegundos, lFechado )
    LETO_SET( 7, ( cPath ) )
    ResTela( cScreen )
    Return
EndIF

    DbSetIndex( xIndiceNsx )



WHILE .T.
    dbSelectArea( "Empresa" )
    Empresa->(Order( 1 ))
    Empresa->(DbSeek( cCodi ))
    oMenu:Limpa()
    cMens1            := Empresa->Mens1
    cMens2            := Empresa->Mens2
    cMens3            := Empresa->Mens3
    cMens4            := Empresa->Mens4
    nItemNff         := Empresa->ItemNff
    cInscMun         := Empresa->InscMun
    nIss                := Empresa->Iss
   cEditarQuant   := IF( oIni:ReadBool("sistema","editarquant", .F.), "S", "N")
    cAutoFecha        := IF( oIni:ReadBool("sistema","autofecha", .F.), "S", "N")
    cAutoLiquido    := IF( oIni:ReadBool("sistema","autoliquido", .F. ), "S", "N")
    cAutoDesconto    := IF( oIni:ReadBool("sistema","autodesconto", .F. ), "S", "N")
    cAutoEmissao    := IF( oIni:ReadBool("sistema","autoemissao", .F. ), "S", "N")
    cAutoFatura     := IF( oIni:ReadBool("sistema","autofatura", .T. ), "S", "N")
    cAutoDocumento := IF( oIni:ReadBool("sistema","autodocumento", .T. ), "S", "N")
    cAltDescricao    := IF( oIni:ReadBool("sistema","alterardescricao", .F. ), "S", "N")
    cTipoVenda        := oIni:ReadString("sistema",  "tipovenda", "N")
    cPrecoTicket    := IF( oIni:ReadBool("sistema","precoticket", .T. ), "S", "N")
    cPrecoPrevenda := IF( oIni:ReadBool("sistema","precoprevenda", .T. ), "S", "N")
    cSerieProduto    := IF( oIni:ReadBool("sistema","serieproduto", .F. ), "S", "N")
    cDuplicidade    := IF( oIni:ReadBool("sistema","duplicidade", .F. ), "S", "N")
    nOrderTicket    := oIni:ReadInteger("sistema","orderticket", 1 )
    cZerarDesconto := IF( oIni:ReadBool("sistema","zerardesconto", .F. ), "S", "N")
    cMinimoMens     := IF( oIni:ReadBool("sistema","minimomens", .F. ), "S", "N")
   cPvCabec       := ltrim(rtrim(oIni:ReadString("sistema", "prilinpv", Left( oAmbiente:xFanta,40))))
   cPvCabec       += Space( 40 - Len( ltrim(rtrim(cPvCabec))))
   cPvRamo        := ltrim(rtrim(oIni:ReadString("sistema", "seglinpv", Left( cEndefir,40))))
   cPvRamo        += Space( 40 - Len( ltrim(rtrim(cPvRamo))))
   cRamo          := ltrim(rtrim(oIni:ReadString("sistema", "ramo", Left( cEndefir,40))))
   cRamo          += Space( 40 - Len( ltrim(rtrim(cRamo))))
   cCabecIni      := ltrim(rtrim(oIni:ReadString("sistema", "cabec", Left( oAmbiente:xFanta,40))))
   cCabecIni      += Space( 40 - Len( ltrim(rtrim(cCabecIni))))
   cFantaCodeBar  := oIni:ReadString("sistema", "fantacodebar", "TURBONET" + Space(10-Len("TURBONET")))
   oMenu:MaBox( 01, 01, 21, 78, "CONFIGURACAO - SAIDAS")
    SetCursor(1) ; DevPos( 02, 02 ) ; DevOut( "N§ Fatura Automatica.: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cAutoFatura, "cAutoFatura", "!", {|| PickSimNao( @cAutoFatura )},))
    SetCursor(1) ; DevPos( Row(), 41 ) ; DevOut( "N§ Docto Automatico..: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cAutoDocumento, "cAutoDocumento", "!", {|| PickSimNao( @cAutoDocumento )},))
    SetCursor(1) ; DevPos( Row()+1, 02 ) ; DevOut( "Data Emis Automatica.: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cAutoEmissao, "cAutoEmissao", "!", {|| PickSimNao( @cAutoEmissao )},))
    SetCursor(1) ; DevPos( Row(), 41 ) ; DevOut( "Desconto Automatico..: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cAutoDesconto, "cAutoDesconto", "!", {|| PickSimNao( @cAutoDesconto )},))
    SetCursor(1) ; DevPos( Row()+1, 02 ) ; DevOut( "Liquido Automatico...: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cAutoLiquido, "cAutoLiquido", "!", {|| PickSimNao( @cAutoLiquido )},))
    SetCursor(1) ; DevPos( Row(), 41 ) ; DevOut( "Fechamento Automatico: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cAutoFecha, "cAutoFecha", "!", {|| PickSimNao( @cAutoFecha )},))
    SetCursor(1) ; DevPos( Row()+1, 02 ) ; DevOut( "Alterar Descricao....: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cAltDescricao, "cAltDescricao", "!", {|| PickSimNao( @cAltDescricao  )},))
    SetCursor(1) ; DevPos( Row(), 41 ) ; DevOut( "Qtde Items Nff.......: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nItemNff, "nItemNff", "999", {|| nItemNff > 0},))
    SetCursor(1) ; DevPos( Row()+1, 02 ) ; DevOut( "Tipo Venda Preferen..: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cTipoVenda, "cTipoVenda", "!", {|| PickTipoVenda( @cTipoVenda )},))
    SetCursor(1) ; DevPos( Row(), 41 ) ; DevOut( "Preco Ticket Venda...: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cPrecoTicket, "cPrecoTicket", "!", {|| PickSimNao( @cPrecoTicket )},))
    SetCursor(1) ; DevPos( Row()+1, 02 ) ; DevOut( "N§ Serie Produto.....: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cSerieProduto, "cSerieProduto", "!", {|| PickSimNao( @cSerieProduto )},))
    SetCursor(1) ; DevPos( Row(), 41 ) ; DevOut( "Permitir Duplicidade.: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cDuplicidade, "cDuplicidade", "!", {|| PickSimNao( @cDuplicidade )},))
    SetCursor(1) ; DevPos( Row()+1, 02 ) ; DevOut( "Percentual ISS.......: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nIss, "nIss", "99.99",,))
    SetCursor(1) ; DevPos( Row(), 41 ) ; DevOut( "Inscricao Municipal..: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cInscMun, "cInscMun", "@!",,))
    SetCursor(1) ; DevPos( Row()+1, 02 ) ; DevOut( "Ordem Ticket Venda...: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nOrderTicket, "nOrderTicket", "9", {|| PickTam({"Ordem Cadastro", "Ordem Codigo"}, {1,2}, @nOrderTicket )},))
    SetCursor(1) ; DevPos( Row(), 41 ) ; DevOut( "Zerar Desconto.......: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cZerarDesconto, "cZerarDesconto", "!", {|| PickSimNao( @cZerarDesconto )},))
    SetCursor(1) ; DevPos( Row()+1, 02 ) ; DevOut( "Avisar Estoque Min...: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cMinimoMens, "cMinimoMens", "!", {|| PickSimNao( @cMinimoMens )},))
    SetCursor(1) ; DevPos( Row(), 41 ) ; DevOut( "Preco Ticket Prevenda: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cPrecoPrevenda, "cPrecoPrevenda", "!", {|| PickSimNao( @cPrecoPrevenda )},))
    SetCursor(1) ; DevPos( Row()+1, 02 ) ; DevOut( "Editar Quant Saida...: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cEditarQuant, "cEditarQuant", "!", {|| PickSimNao( @cEditarQuant )},))
    SetCursor(1) ; DevPos( Row()+1, 02 ) ; DevOut( "Mens 1 Posicao Fat...: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cMens1, "cMens1", "@!",,))
    SetCursor(1) ; DevPos( Row()+1, 02 ) ; DevOut( "Mens 2 Posicao Fat...: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cMens2, "cMens2", "@!",,))
    SetCursor(1) ; DevPos( Row()+1, 02 ) ; DevOut( "Mens 3 Posicao Fat...: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cMens3, "cMens3", "@!",,))
    SetCursor(1) ; DevPos( Row()+1, 02 ) ; DevOut( "Mens 4 Posicao Fat...: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cMens4, "cMens4", "@!",,))
   SetCursor(1) ; DevPos( Row()+1, 02 ) ; DevOut( "Mens 1§ Lin Ticket...: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCabecIni, "cCabecIni", "@!",,))
   SetCursor(1) ; DevPos( Row()+1, 02 ) ; DevOut( "Mens 2§ Lin Ticket...: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cRamo, "cRamo", "@!",,))
   SetCursor(1) ; DevPos( Row()+1, 02 ) ; DevOut( "Mens 1§ Lin Ticket PV: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cPvCabec, "cPvCabec", "@!",,))
   SetCursor(1) ; DevPos( Row()+1, 02 ) ; DevOut( "Mens 2§ Lin Ticket PV: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cPvRamo, "cPvRamo", "@!",,))
    SetCursor(1) ; DevPos( Row()+1, 02 ) ; DevOut( "Fantasia Codigo Barra: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cFantaCodeBar, "cFantaCodeBar", "@!",,))
    ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
    IF LastKey() = 27
        Fechatudo()
        ResTela( cScreen )
        Exit
    EndIF
    ErrorBeep()
    IF Conf("Pergunta: Confirma  ?")
        IF Empresa->(TravaReg())
            Empresa->Mens1      := cMens1
            Empresa->Mens2      := cMens2
            Empresa->Mens3      := cMens3
            Empresa->Mens4      := cMens4
            Empresa->ItemNff     := nItemNff
            Empresa->InscMun     := cInscMun
            Empresa->Iss         := nIss
            aMensagem             := { cMens1, cMens2, cMens3, cMens4 }
            aItemNff              := { nItemNff }
            aInscMun              := { cInscMun }
            aIss                     := { nIss }
            oAmbiente:RelatorioCabec := cCabecIni

         oIni:WriteBool( "sistema",   "editarquant",    IF( cEditarQuant   = "S", .T., .F. ))
            oIni:WriteBool( "sistema",   "autofecha",      IF( cAutoFecha     = "S", .T., .F. ))
            oIni:WriteBool( "sistema",   "autoliquido",    IF( cAutoLiquido   = "S", .T., .F. ))
            oIni:WriteBool( "sistema",   "autodesconto",   IF( cAutoDesconto  = "S", .T., .F. ))
            oIni:WriteBool( "sistema",   "autoemissao",    IF( cAutoEmissao   = "S", .T., .F. ))
            oIni:WriteBool( "sistema",   "autofatura",     IF( cAutoFatura     = "S", .T., .F. ))
            oIni:WriteBool( "sistema",   "autodocumento",  IF( cAutoDocumento  = "S", .T., .F. ))
            oIni:WriteBool( "sistema",   "alterardescricao", IF( cAltDescricao = "S", .T., .F. ))
            oIni:WriteBool( "sistema",   "precoticket",   IF( cPrecoTicket  = "S", .T., .F. ))
            oIni:WriteBool( "sistema",   "precoprevenda", IF( cPrecoprevenda  = "S", .T., .F. ))
            oIni:WriteBool( "sistema",   "serieproduto",  IF( cSerieProduto = "S", .T., .F. ))
            oIni:WriteBool( "sistema",   "duplicidade",   IF( cDuplicidade  = "S", .T., .F. ))
            oIni:WriteBool( "sistema",   "zerardesconto", IF( cZerarDesconto = "S", .T., .F. ))
            oIni:WriteBool( "sistema",   "minimomens",    IF( cMinimoMens = "S", .T., .F. ))
            oIni:WriteInteger( "sistema","orderticket",    nOrderTicket )
            oIni:WriteString("sistema",  "tipovenda",      cTipoVenda )
         oIni:WriteString("sistema",  "cabec",          cCabecIni )
            oIni:WriteString("sistema",  "relatoriocabec", cCabecIni )
         oIni:WriteString("sistema",  "ramo",           cRamo )
         oIni:WriteString("sistema",  "prilinpv",       cPvCabec )
         oIni:WriteString("sistema",  "seglinpv",       cPvRamo )
            oIni:WriteString("sistema",  "fantacodebar",   cFantaCodebar )


            Empresa->(Libera())
        EndIF
    EndIF
EndDo
LETO_SET( 7, ( cPath ) )

Proc ConfReceber()

LOCAL cScreen          := SaveScreen()
LOCAL GetList          := {}
LOCAL nCarencia        := 0
LOCAL nDesconto        := 0
LOCAL nDescApos        := 0
LOCAL nDiasApos        := 0
LOCAL nJuroMesSimples  := 0
LOCAL nJuroMesComposto := 0
LOCAL cMens1           := Space(40)
LOCAL cMens2           := Space(40)
LOCAL cMens3           := Space(40)
LOCAL cMens4           := Space(40)
LOCAL cCodi            := Right( oAmbiente:xBaseDados, 4 )
LOCAL xIndiceNtx       := "EMPRESA1." + "CDX"
LOCAL xIndiceNsx       := "EMPRESA." + "CDX"
LOCAL nSegundos        := 2
LOCAL lFechado         := .T.
LOCAL cPath            := FCurdir()


LOCAL aLista           := {"Dinheiro","Nota Promissoria","Duplicata", "Cheque a Vista", "Requisicao","Bonus","Cheque Predatado","Diferenca Rec/Pag", "Direta Livre", "Cartao"}
LOCAL aTipo            := {"DH    ", "NP    ","DM    ","CH    ","RQ    ", "BN    ", "CP    ", "DF    ", "DL    ", "CT    " }
LOCAL cAutoTipo
LOCAL nBloqueio
LOCAL cInativo

LETO_SET( 7, ( oAmbiente:xBase ) )
IF !NetUse("EMPRESA", .T., nSegundos, lFechado )
    LETO_SET( 7, ( cPath ) )
    ResTela( cScreen )
    Return
EndIF

    DbSetIndex( xIndiceNsx )



WHILE .T.
    dbSelectArea( "Empresa" )
    Empresa->(Order( 1 ))
    Empresa->(DbSeek( cCodi ))
    oMenu:Limpa()
   nCarencia        := Empresa->Carencia
   nJuroMesSimples  := Empresa->Juro
   nJuroMesComposto := 0
   nDesconto        := Empresa->Desconto
   nDescApos        := Empresa->DescApos
   nDiasApos        := Empresa->DiasApos
   nMulta           := Empresa->Multa
   nDiaMulta        := Empresa->DiaMulta
   cInativo         := IF( oIni:ReadBool("sistema","MostrarClientesInativos"), "S", "N" )
   cAutoTipo        := oIni:ReadString("sistema","autotipo", "NP    ")
   nBloqueio        := oIni:ReadInteger("sistema","bloqueio", 0 )
   nJuroMesComposto := oIni:ReadInteger("financeiro", "JuroMesComposto", 0 )
   nComissao1       := oIni:ReadInteger("comissaoperiodo1","comissao", 2.5 )
   nDiaIni1         := oIni:ReadInteger("comissaoperiodo1","diaini",   0   )
   nDiaFim1         := oIni:ReadInteger("comissaoperiodo1","diafim",   15  )
   nComissao2       := oIni:ReadInteger("comissaoperiodo2","comissao", 4.0 )
   nDiaIni2         := oIni:ReadInteger("comissaoperiodo2","diaini",   16  )
   nDiaFim2         := oIni:ReadInteger("comissaoperiodo2","diafim",   30  )
   nComissao3       := oIni:ReadInteger("comissaoperiodo3","comissao", 4.0 )
   nDiaIni3         := oIni:ReadInteger("comissaoperiodo3","diaini",   31  )
   nDiaFim3         := oIni:ReadInteger("comissaoperiodo3","diafim",   999 )

   oMenu:MaBox( 01, 01, 11, 78, "CONFIGURACAO - FINANCEIRO")
   SetCursor(1) ; DevPos( 02, 02 ) ; DevOut( "Carencia em dias......:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nCarencia, "nCarencia", "999",,))
   SetCursor(1) ; DevPos( Row(), 33 ) ; DevOut( "Perc Juros Composto.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nJuroMesComposto, "nJuroMesComposto", "99.99",,))
   SetCursor(1) ; DevPos( Row()+1, 02 ) ; DevOut( "Perc Juros ao Mes.....:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nJuroMesSimples, "nJuroMesSimples", "99.99",,))
   SetCursor(1) ; DevPos( Row(), 33 ) ; DevOut( "Perc Desc ate Vcto..:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nDesconto, "nDesconto", "99.99",,))
   SetCursor(1) ; DevPos( Row()+1, 02 ) ; DevOut( "Perc Desc apos Vcto...:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nDescApos, "nDescApos", "99.99",,))
   SetCursor(1) ; DevPos( Row(), 33 ) ; DevOut( "Dias apos Vencido...:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nDiasApos, "nDiasApos", "999",,))
   SetCursor(1) ; DevPos( Row()+1, 02 ) ; DevOut( "Perc Multa............:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nMulta, "nMulta", "99.99",,))
   SetCursor(1) ; DevPos( Row(), 33 ) ; DevOut( "Dias de Vencido.....:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nDiaMulta, "nDiaMulta", "999",,))
   SetCursor(1) ; DevPos( Row()+1, 02 ) ; DevOut( "Tipo Docto Automatico.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cAutoTipo, "cAutoTipo", "@!", {|| PickTam( aLista, aTipo, @cAutoTipo )},))
   SetCursor(1) ; DevPos( Row(), 33 ) ; DevOut( "Bloqueio em Dias....:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nBloqueio, "nBloqueio", "99",,))
   SetCursor(1) ; DevPos( Row()+1, 02 ) ; DevOut( "Comissao Cobrador.....:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nComissao1, "nComissao1", "99.99",,))
   SetCursor(1) ; DevPos( Row(), 33 ) ; DevOut( "Dia(s) de Vencido...:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nDiaIni1, "nDiaIni1", "999",,))
   SetCursor(1) ; DevPos( Row(), 60 ) ; DevOut( "Ate dia(s).:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nDiaFim1, "nDiaFim1", "999",,))
   SetCursor(1) ; DevPos( Row()+1, 02 ) ; DevOut( "Comissao Cobrador.....:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nComissao2, "nComissao2", "99.99",,))
   SetCursor(1) ; DevPos( Row(), 33 ) ; DevOut( "Dia(s) de Vencido...:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nDiaIni2, "nDiaIni2", "999",,))
   SetCursor(1) ; DevPos( Row(), 60 ) ; DevOut( "Ate dia(s).:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nDiaFim2, "nDiaFim2", "999",,))
   SetCursor(1) ; DevPos( Row()+1, 02 ) ; DevOut( "Comissao Cobrador.....:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nComissao3, "nComissao3", "99.99",,))
   SetCursor(1) ; DevPos( Row(), 33 ) ; DevOut( "Dia(s) de Vencido...:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nDiaIni3, "nDiaIni3", "999",,))
   SetCursor(1) ; DevPos( Row(), 60 ) ; DevOut( "Ate dia(s).:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nDiaFim3, "nDiaFim3", "999",,))
   SetCursor(1) ; DevPos( Row()+1, 02 ) ; DevOut( "Ver Clientes Inativos.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cInativo, "cInativo", "@!", {|| PickSimNao(@cInativo)},))
    ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
    IF LastKey() = 27
        FechaTudo()
        ResTela( cScreen )
        Exit
    EndIF
    ErrorBeep()
    IF Conf("Pergunta: Confirma  ?")
        IF Empresa->(TravaReg())
            Empresa->Carencia  := nCarencia
            Empresa->Desconto  := nDesconto
            Empresa->DescApos  := nDescApos
            Empresa->DiasApos  := nDiasApos
         Empresa->Juro      := nJuroMesSimples
            Empresa->Multa      := nMulta
            Empresa->DiaMulta  := nDiaMulta
            Empresa->(Libera())
         oAmbiente:aSciArray[1,1]  := nJuroMesSimples
         oAmbiente:aSciArray[1,2]        := nDiasApos
         oAmbiente:aSciArray[1,3]        := nDescApos
         oAmbiente:aSciArray[1,4]           := nMulta
         oAmbiente:aSciArray[1,5]        := nDiaMulta
         oAmbiente:aSciArray[1,6]        := nCarencia
         oAmbiente:aSciArray[1,7]        := nDesconto
         oAmbiente:aSciArray[1,8] := nJuroMesComposto

         oIni:WriteInteger( "financeiro", "juromes", nJuroMesSimples )
         oIni:WriteInteger( "financeiro", "JuroMesSimples", nJuroMesSimples )
         oIni:WriteInteger( "financeiro", "JuroMesComposto", nJuroMesComposto )
         oIni:WriteString( "sistema", "autotipo", cAutoTipo )
            oIni:WriteInteger("sistema", "bloqueio", nBloqueio )
         oIni:WriteBool("sistema", "MostrarClientesInativos", IF( cInativo = "S", .T., .F. ))
         oIni:WriteInteger("comissaoperiodo1","comissao", nComissao1 )
            oIni:WriteInteger("comissaoperiodo1","diaini",   nDiaIni1 )
            oIni:WriteInteger("comissaoperiodo1","diafim",   nDiaFim1 )
            oIni:WriteInteger("comissaoperiodo2","comissao", nComissao2 )
            oIni:WriteInteger("comissaoperiodo2","diaini",   nDiaIni2 )
            oIni:WriteInteger("comissaoperiodo2","diafim",   nDiaFim2 )
            oIni:WriteInteger("comissaoperiodo3","comissao", nComissao3 )
            oIni:WriteInteger("comissaoperiodo3","diaini",   nDiaIni3 )
            oIni:WriteInteger("comissaoperiodo3","diafim",   nDiaFim3 )
        EndIF
    EndIF
EndDo
LETO_SET( 7, ( cPath ) )

Proc ConfEntradas()

LOCAL cScreen        := SaveScreen()
LOCAL GetList        := {}
LOCAL cPath         := FCurdir()
LOCAL cAutoPreco
LOCAL cMedia
LOCAL cIndexador
LOCAL cIpi
LOCAL cAutoProducao

LETO_SET( 7, ( oAmbiente:xBase ) )
WHILE .T.
    oMenu:Limpa()
    cAutoPreco        := IF( oIni:ReadBool("sistema","autopreco",      .T.    ), "S", "N")
    cMedia            := IF( oIni:ReadBool("sistema","mediaponderada", .F. ), "S", "N")
    cIndexador        := IF( oIni:ReadBool("sistema","indexador",      .F. ), "S", "N")
    cIpi                := IF( oIni:ReadBool("sistema","ipi",            .F. ), "S", "N")
    cAutoProducao    := IF( oIni:ReadBool("sistema","autoproducao",   .F. ), "S", "N")

    oMenu:MaBox( 01, 01, 05, 78, "CONFIGURACAO - ENTRADAS")
    SetCursor(1) ; DevPos( 02, 02 ) ; DevOut( "Calcular Pvenda.....: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cAutoPreco, "cAutoPreco", "!", {|| PickSimNao( @cAutoPreco )},))
    SetCursor(1) ; DevPos( Row(), 41 ) ; DevOut( "Pcusto Ponderado....: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cMedia, "cMedia", "!", {|| PickSimNao( @cMedia )},))
    SetCursor(1) ; DevPos( Row()+1, 02 ) ; DevOut( "Usar Indexadores....: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cIndexador, "cIndexador", "!", {|| PickSimNao( @cIndexador )},))
    SetCursor(1) ; DevPos( Row(), 41 ) ; DevOut( "Entrar com IPI/II...: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cIpi, "cIpi", "!", {|| PickSimNao( @cIpi )},))
    SetCursor(1) ; DevPos( Row()+1, 02 ) ; DevOut( "Producao Automatica.: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cAutoProducao, "cAutoProducao", "!", {|| PickSimNao( @cAutoProducao )},))
    ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
    IF LastKey() = 27
        LETO_SET( 7, ( cPath ) )
        ResTela( cScreen )
        Exit
    EndIF
    ErrorBeep()
    IF Conf("Pergunta: Confirma  ?")
        oIni:WriteBool( "sistema",   "autopreco",      IF( cAutoPreco    = "S", .T., .F. ))
        oIni:WriteBool( "sistema",   "mediaponderada", IF( cMedia        = "S", .T., .F. ))
        oIni:WriteBool( "sistema",   "indexador",      IF( cIndexador    = "S", .T., .F. ))
        oIni:WriteBool( "sistema",   "ipi",            IF( cIpi          = "S", .T., .F. ))
        oIni:WriteBool( "sistema",   "autoproducao",   IF( cAutoProducao = "S", .T., .F. ))
    EndIF
EndDo

Proc ConfNota()

LOCAL cScreen          := SaveScreen()
LOCAL GetList          := {}
LOCAL cPath           := FCurdir()
LOCAL cObs1           := Space(50)
LOCAL cObs2           := Space(50)
LOCAL cObs3           := Space(50)
LOCAL cIsento          := Space(1)
LOCAL cMinimoIndice := Space(1)

LETO_SET( 7, ( oAmbiente:xBase ) )
cObs1           := oIni:ReadString("notafiscal","obs1", "ESTE DOCUMENTO NAO GERA DIREITO A CREDITO FISCAL  ")
cObs2           := oIni:ReadString("notafiscal","obs2", "CONTRIBUINTE ENQUADRADO NO SIMPLES. LEI FEDERAL N§")
cObs3           := oIni:ReadString("notafiscal","obs3", "9317/96 E DECRETO ESTADUAL N§ 8570/98.            ")
cIsento          := IF( oIni:ReadBool("notafiscal","isento", .F. ), "S", "N")
cMinimoIndice := IF( oIni:ReadBool("notafiscal","minimoindice", .F. ), "S", "N")
WHILE .T.
    oMenu:Limpa()
    oMenu:MaBox( 01, 01, 07, 78, "CONFIGURACAO - NOTA FISCAL")
    SetCursor(1) ; DevPos( 02, 02 ) ; DevOut( "Observacao Linha 1..: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cObs1, "cObs1", "@!",,))
    SetCursor(1) ; DevPos( Row()+1, 02 ) ; DevOut( "Observacao Linha 2..: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cObs2, "cObs2", "@!",,))
    SetCursor(1) ; DevPos( Row()+1, 02 ) ; DevOut( "Observacao Linha 3..: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cObs3, "cObs3", "@!",,))
    SetCursor(1) ; DevPos( Row()+1, 02 ) ; DevOut( "Emitir Nota Isenta..: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cIsento, "cIsento", "!", {|| PickSimNao( @cIsento )},))
    SetCursor(1) ; DevPos( Row()+1, 02 ) ; DevOut( "Respeitar Indice....: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cMinimoIndice, "cMinimoIndice", "!", {|| PickSimNao( @cMinimoIndice )},))
    ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
    IF LastKey() = 27
        LETO_SET( 7, ( cPath ) )
        ResTela( cScreen )
        Exit
    EndIF
    ErrorBeep()
    IF Conf("Pergunta: Confirma  ?")
        oIni:WriteString("notafiscal", "obs1", cObs1 )
        oIni:WriteString("notafiscal", "obs2", cObs2 )
        oIni:WriteString("notafiscal", "obs3", cObs3 )
        oIni:WriteBool( "notafiscal",  "isento", IF( cIsento = "S", .T., .F. ))
        oIni:WriteBool( "notafiscal",  "minimoindice", IF( cMinimoIndice = "S", .T., .F. ))
    EndIF
EndDo

Proc ConfGeral()

LOCAL cScreen        := SaveScreen()
LOCAL GetList        := {}
LOCAL cPath         := FCurdir()
LOCAL cEmail
LOCAL cSmtp
LOCAL nScreenSaver
LOCAL nRecibo
LOCAL nAutenticar
LOCAL nNenhum
LOCAL cCampoDesconto
LOCAL nTipoBusca
LOCAL cNrMarcaTicket
LOCAL cPvMarcaTicket
LOCAL cTrocarVendedor
LOCAL cNomeEmpresa
LOCAL cFantasia
LOCAL cCgcEmpresa
LOCAL cNomeSocio
LOCAL cCpfSocio

LETO_SET( 7, ( oAmbiente:xBase ) )
WHILE .T.
    oMenu:Limpa()
   nScreenSaver    := oIni:ReadInteger("sistema", "screensaver", 60 )
   cEmail          := oIni:ReadString("sistema", "email", Space(40) )
   cSmtp           := oIni:ReadString("sistema", "smtp", "SMTP.MICROBRAS.COM.BR" + Space(19))
   cNomeEmpresa    := oIni:ReadString("sistema", "nomeempresa", XNOMEFIR + Space(40-Len(XNOMEFIR)))
   cFantasia       := oIni:ReadString("sistema", "fantasia",    "TURBONET INFORMATICA"   + Space(40-Len("TURBONET INFORMATICA")))
   cCgcEmpresa     := oIni:ReadString("sistema", "cgcempresa", "620.269.179-49" )
   cNomeSocio      := oIni:ReadString("sistema", "nomesocio", "VILMAR CATAFESTA" + Space(40-Len("VILMAR CATAFESTA")))
   cCpfSocio       := oIni:ReadString("sistema", "cpfsocio", "620.269.179-49" )
   nRecibo         := oIni:ReadInteger("baixasrece", "recibo", 1 )
   nAutenticar     := oIni:ReadInteger("baixasrece", "autenticar", 2 )
   nNenhum         := oIni:ReadInteger("baixasrece", "nenhum", 3 )
   nTipoBusca      := oIni:ReadInteger("sistema", "tipobusca", 1 )
    cNrMarcaTicket  := IF( oIni:ReadBool("sistema","nrmarcaticket", .F. ), "S", "N")
   cPvMarcaTicket  := IF( oIni:ReadBool("sistema","pvmarcaticket", .F. ), "S", "N")
   cCampoDesconto  := IF( oIni:ReadBool("baixasrece","campodesconto", .T. ), "S", "N")
   cTrocarVendedor := IF( oIni:ReadBool("sistema","trocarvendedor", .T. ), "S", "N")

   MaBox( 01, 01, 18, 79, "CONFIGURACAO - GERAL")
    SetCursor(1) ; DevPos( 02, 02 ) ; DevOut( "Tempo Protetor Tela.: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nScreenSaver, "nScreenSaver", "9999",,))
    SetCursor(1) ; DevPos( 03, 02 ) ; DevOut( "Email...............: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cEmail, "cEmail", "@!",,))
    SetCursor(1) ; DevPos( 04, 02 ) ; DevOut( "Servidor SMTP.......: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cSmtp, "cSmtp", "@!",,))
   SetCursor(1) ; DevPos( 05, 02 ) ; DevOut( "Nome Empresa........: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cNomeEmpresa, "cNomeEmpresa", "@!",,))
   SetCursor(1) ; DevPos( 06, 02 ) ; DevOut( "Nome Fantasia.......: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cFantasia, "cFantasia", "@!",,))
   SetCursor(1) ; DevPos( 07, 02 ) ; DevOut( "Cnpj/CPF Empresa....: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCgcEmpresa, "cCgcEmpresa", "@!",,))
   SetCursor(1) ; DevPos( 08, 02 ) ; DevOut( "Nome Socio..........: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cNomeSocio, "cNomeSocio", "@!",,))
   SetCursor(1) ; DevPos( 09, 02 ) ; DevOut( "CPF Socio...........: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCpfSocio, "cCpfSocio", "999.999.999-99",,))
   SetCursor(1) ; DevPos( 10, 02 ) ; DevOut( "Posicao Menu [Recibo] apos Recebimento.....:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nRecibo, "nRecibo", "9", {|| PickTam({"Primeiro","Segundo","Terceiro"}, {1,2,3}, @nRecibo)},))
   SetCursor(1) ; DevPos( 11, 02 ) ; DevOut( "Posicao Menu [Autenticar] apos Recebimento.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nAutenticar, "nAutenticar", "9", {|| PickTam({"Primeiro","Segundo","Terceiro"}, {1,2,3}, @nAutenticar)},))
   SetCursor(1) ; DevPos( 12, 02 ) ; DevOut( "Posicao Menu [Nenhum] apos Recebimento.....:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nNenhum, "nNenhum", "9", {|| PickTam({"Primeiro","Segundo","Terceiro"}, {1,2,3}, @nNenhum)},))
   SetCursor(1) ; DevPos( 13, 02 ) ; DevOut( "Mostrar Campo Desconto ao receber titulo...:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCampoDesconto, "cCampoDesconto", "!", {|| PickSimNao( @cCampoDesconto )},))
   SetCursor(1) ; DevPos( 14, 02 ) ; DevOut( "Tipo Menu de Procura Produto...............:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nTipoBusca, "nTipoBusca", "9", {|| PickTam({"Ordem Codigo","Ordem Fabricante"}, {1,2}, @nTipoBusca)},))
   SetCursor(1) ; DevPos( 15, 02 ) ; DevOut( "Imprimir Marca Produto Ticket Venda........:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cNrMarcaTicket, "cNrMarcaTicket", "!", {|| PickSimNao( @cNrMarcaTicket )},))
   SetCursor(1) ; DevPos( 16, 02 ) ; DevOut( "Imprimir Marca Produto Ticket PreVenda.....:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cPvMarcaTicket, "cPvMarcaTicket", "!", {|| PickSimNao( @cPvMarcaTicket )},))
   SetCursor(1) ; DevPos( 17, 02 ) ; DevOut( "Permitir faturar comissao outro vendedor...:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cTrocarVendedor, "cTrocarVendedor", "!", {|| PickSimNao( @cTrocarVendedor )},))
   ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
    IF LastKey() = 27
        LETO_SET( 7, ( cPath ) )
        ResTela( cScreen )
        Exit
    EndIF
    ErrorBeep()
    IF Conf("Pergunta: Confirma  ?")
        oIni:WriteInteger("sistema", "screensaver", nScreenSaver )
        oIni:WriteString("sistema", "email", cEmail )
        oIni:WriteString("sistema", "smtp", cSmtp )
      oIni:WriteString("sistema", "nomeempresa", cNomeEmpresa )
      oIni:WriteString("sistema", "fantasia", cFantasia )
      oIni:WriteString("sistema", "cgcempresa", cCgcEmpresa )
      oIni:WriteString("sistema", "tipobusca", nTipoBusca )
      oIni:WriteString("sistema", "nomesocio", cNomeSocio )
      oIni:WriteString("sistema", "cpfsocio",  cCpfSocio )
      oIni:WriteBool("sistema","nrmarcaticket", IF( cNrMarcaTicket = "S", .T., .F. ))
      oIni:WriteBool("sistema","pvmarcaticket", IF( cPvMarcaTicket = "S", .T., .F. ))
      oIni:WriteInteger("baixasrece", "recibo", nRecibo )
        oIni:WriteInteger("baixasrece", "autenticar", nAutenticar )
        oIni:WriteInteger("baixasrece", "nenhum", nNenhum )
        oIni:WriteBool("baixasrece","campodesconto", IF( cCampoDesconto = "S", .T., .F. ))
      oIni:WriteBool("sistema","trocarvendedor", IF( cTrocarVendedor = "S", .T., .F. ))
      oAmbiente:xFanta   := cFantasia
      oAmbiente:xNomefir := cNomeEmpresa
    EndIF
EndDo

Proc ConfRelatorios()

LOCAL cScreen                := SaveScreen()
LOCAL GetList                := {}
LOCAL cPath                 := FCurdir()
LOCAL nRolVendas            := 1
LOCAL nRolRecemov         := 1
LOCAL nRolCaixa            := 1
LOCAL nRolRecebido        := 1
LOCAL nRolContraPartida := 2
LOCAL nTipoCaixa            := 2
LOCAL nTamPromissoria    := 33

LETO_SET( 7, ( oAmbiente:xBase ) )
WHILE .T.
    oMenu:Limpa()
    nRolVendas            := oIni:ReadInteger("relatorios","rolvendas", 1)
    nRolRecemov         := oIni:ReadInteger("relatorios","rolrecemov", 1 )
    nRolCaixa            := oIni:ReadInteger("relatorios","rolcaixa", 1 )
    nRolRecebido        := oIni:ReadInteger("relatorios","rolrecebido", 1 )
    nRolContraPartida := oIni:ReadInteger("relatorios","rolcontrapartida", 2 )
    nTipoCaixa            := oIni:ReadInteger("relatorios","tipocaixa", 2 )
    nTamPromissoria    := oIni:ReadInteger("relatorios","tampromissoria", 33 )
    oMenu:MaBox( 01, 01, 09, 78, "CONFIGURACAO - RELATORIOS")
    SetCursor(1) ; DevPos( 02, 02 ) ; DevOut( "Tipo Relatorio Vendas...: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nRolVendas, "nRolVendas", "9", {|| PickTam({"Normal", "Ecf"}, {1,2}, @nRolVendas )},))
    SetCursor(1) ; DevPos( 03, 02 ) ; DevOut( "Tipo Relatorio Receber..: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nRolRecemov, "nRolRecemov", "9", {|| PickTam({"Normal", "Ecf"}, {1,2}, @nRolRecemov )},))
    SetCursor(1) ; DevPos( 04, 02 ) ; DevOut( "Tipo Relatorio Caixa....: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nRolCaixa, "nRolCaixa", "9", {|| PickTam({"Normal", "Ecf"}, {1,2}, @nRolCaixa )},))
    SetCursor(1) ; DevPos( 05, 02 ) ; DevOut( "Tipo Relatorio Recebido.: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nRolRecebido, "nRolRecebido", "9", {|| PickTam({"Normal", "Ecf"}, {1,2}, @nRolRecebido )},))
    SetCursor(1) ; DevPos( 06, 02 ) ; DevOut( "Tipo Rol Contra Partida.: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nRolContraPartida, "nRolContraPartida", "9", {|| PickTam({"Sem Contra Partida", "Com Contra Partida"}, {1,2}, @nRolContraPartida )},))
    SetCursor(1) ; DevPos( 07, 02 ) ; DevOut( "Ordem Relatorio Caixa...: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nTipoCaixa, "nTipoCaixa", "9", {|| PickTam({"Data Lancamento", "Data Baixa"}, {1,2}, @nTipoCaixa )},))
    SetCursor(1) ; DevPos( 08, 02 ) ; DevOut( "Tamanho Form Promissoria: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nTamPromissoria, "nTamPromissoria", "99", {|| PickTam({"22 Linhas","33 Linhas","66 Linhas"}, {22,33,66}, @nTamPromissoria )},))
    ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
    IF LastKey() = 27
        LETO_SET( 7, ( cPath ) )
        ResTela( cScreen )
        Exit
    EndIF
    ErrorBeep()
    IF Conf("Pergunta: Confirma  ?")
        oIni:WriteInteger("relatorios", "rolvendas",        nRolVendas )
        oIni:WriteInteger("relatorios", "rolrecemov",       nRolRecemov )
        oIni:WriteInteger("relatorios", "rolcaixa",         nRolCaixa )
        oIni:WriteInteger("relatorios", "rolrecebido",      nRolRecebido )
        oIni:WriteInteger("relatorios", "rolcontrapartida", nRolContraPartida )
        oIni:WriteInteger("relatorios", "tipocaixa",        nTipoCaixa )
        oIni:WriteInteger("relatorios", "tampromissoria",   nTamPromissoria )
    EndIF
EndDo

Proc ConfPrevenda()

LOCAL cScreen                := SaveScreen()
LOCAL GetList                := {}
LOCAL cPath                 := FCurdir()
LOCAL cAparelhoMarca
LOCAL cModeloSerie
LOCAL cAnoCor
LOCAL cPlacaEstado
LOCAL cObs2
LOCAL cObs3

LETO_SET( 7, ( oAmbiente:xBase ) )
WHILE .T.
    oMenu:Limpa()
    cAparelhoMarca := IF( oIni:ReadBool("prevenda","aparelhomarca", .F. ), "S", "N")
    cModeloSerie    := IF( oIni:ReadBool("prevenda","modeloserie", .F. ), "S", "N")
    cAnoCor            := IF( oIni:ReadBool("prevenda","anocor", .F. ), "S", "N")
    cPlacaEstado    := IF( oIni:ReadBool("prevenda","placaestado", .F. ), "S", "N")
    cObs2             := IF( oIni:ReadBool("prevenda","obs2", .F. ), "S", "N")
    cObs3             := IF( oIni:ReadBool("prevenda","obs3", .F. ), "S", "N")
    oMenu:MaBox( 01, 01, 08, 78, "CONFIGURACAO - PREVENDA")
    SetCursor(1) ; DevPos( 02, 02 ) ; DevOut( "Imprimir Linha Aparelho e Marca..: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cAparelhoMarca, "cAparelhoMarca", "!", {|| PickSimNao( @cAparelhoMarca )},))
    SetCursor(1) ; DevPos( Row()+1, 02 ) ; DevOut( "Imprimir Linha Modelo e Serie....: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cModeloSerie, "cModeloSerie", "!", {|| PickSimNao( @cModeloSerie )},))
    SetCursor(1) ; DevPos( Row()+1, 02 ) ; DevOut( "Imprimir Linha Ano e Cor.........: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cAnoCor, "cAnoCor", "!", {|| PickSimNao( @cAnoCor )},))
    SetCursor(1) ; DevPos( Row()+1, 02 ) ; DevOut( "Imprimir Placa e Estado..........: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cPlacaEstado, "cPlacaEstado", "!", {|| PickSimNao( @cPlacaEstado )},))
    SetCursor(1) ; DevPos( Row()+1, 02 ) ; DevOut( "Imprimir Linha 2 de Observacoes..: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cObs2, "cObs2", "!", {|| PickSimNao( @cObs2 )},))
    SetCursor(1) ; DevPos( Row()+1, 02 ) ; DevOut( "Imprimir Linha 3 de Observacoes..: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cObs3, "cObs3", "!", {|| PickSimNao( @cObs3 )},))
    ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
    IF LastKey() = 27
        LETO_SET( 7, ( cPath ) )
        ResTela( cScreen )
        Exit
    EndIF
    ErrorBeep()
    IF Conf("Pergunta: Confirma  ?")
        oIni:WriteBool( "prevenda",  "aparelhomarca", IF( cAparelhoMarca = "S", .T., .F. ))
        oIni:WriteBool( "prevenda",  "modeloserie",   IF( cModeloSerie   = "S", .T., .F. ))
        oIni:WriteBool( "prevenda",  "anocor",        IF( cAnoCor        = "S", .T., .F. ))
        oIni:WriteBool( "prevenda",  "placaestado",   IF( cPlacaEstado   = "S", .T., .F. ))
        oIni:WriteBool( "prevenda",  "obs2",          IF( cObs2          = "S", .T., .F. ))
        oIni:WriteBool( "prevenda",  "obs3",          IF( cObs3          = "S", .T., .F. ))
    EndIF
EndDo

Proc ConfEcf()

LOCAL cScreen     := SaveScreen()
LOCAL GetList     := {}
LOCAL cPath      := FCurdir()
LOCAL nModelo     := 1
LOCAL nPorta     := 2
LOCAL nIndice     := 1
LOCAL nUfIcms     := 17
LOCAL nIss      := 5
LOCAL cPos1Icms := Space(02)
LOCAL cPos2Icms := Space(02)
LOCAL cPos3Icms := Space(02)
LOCAL cPos4Icms := Space(02)
LOCAL cPos5Icms := Space(02)
LOCAL cPos6Icms := Space(02)
LOCAL cPos7Icms := Space(02)
LOCAL cPos8Icms := Space(02)
LOCAL cPos9Icms := Space(02)
LOCAL cIcmsIss1 := Space(01)
LOCAL cIcmsIss2 := Space(01)
LOCAL cIcmsIss3 := Space(01)
LOCAL cIcmsIss4 := Space(01)
LOCAL cIcmsIss5 := Space(01)
LOCAL cIcmsIss6 := Space(01)
LOCAL cIcmsIss7 := Space(01)
LOCAL cIcmsIss8 := Space(01)
LOCAL cIcmsIss9 := Space(01)
LOCAL nSigLinha := 1
LOCAL cVista     := "S"
LOCAL cNomeEcf  := "N"
LOCAL cAutoEcf  := "N"
LOCAL cEcfRede  := "N"
LOCAL nAtiva     := 2
LOCAL cPathrede := Space(30)
LOCAL cDrive     := oAmbiente:xBase
LOCAL cPathStr  := cDrive + "\CMD"
LOCAL aEcf      := {"Zanthus IZ-11", "Bematech MP-20 FI II", "Zanthus IZ-20", "Sigtron FS345", "Sweda FS 7000I", "Daruma FS 2000"}

LETO_SET( 7, ( oAmbiente:xBase ) )
WHILE .T.
    oMenu:Limpa()
    cPathrede  := oIni:ReadString("ecf", "pathrede", cPathStr )
    cPathRede  += Space(30-Len(cPathRede))
    nModelo      := oIni:ReadInteger("ecf", "modelo", 1 )
    nPorta      := oIni:ReadInteger("ecf", "porta", 2 )
    nIndice      := oIni:ReadInteger("ecf", "indice", 1.25 )
    nUfIcms      := oIni:ReadInteger("ecf", "uficms", 17 )
   nIss       := oIni:ReadInteger("ecf", "iss", 5 )
    nAtiva      := oIni:ReadString("ecf",  "ativa", 2 )
    nSigLinha  := oIni:ReadInteger("ecf",  "siglinha", 1 )

    cPos1Icms := oIni:ReadString("ecf", "pos1icms", "07.00", 1 ) ; cPos1Icms += IF( Len( cPos1Icms ) = 2, ".00","")
    cPos2Icms := oIni:ReadString("ecf", "pos2icms", "12.00", 1 ) ; cPos2Icms += IF( Len( cPos2Icms ) = 2, ".00","")
    cPos3Icms := oIni:ReadString("ecf", "pos3icms", "17.00", 1 ) ; cPos3Icms += IF( Len( cPos3Icms ) = 2, ".00","")
    cPos4Icms := oIni:ReadString("ecf", "pos4icms", "25.00", 1 ) ; cPos4Icms += IF( Len( cPos4Icms ) = 2, ".00","")
    cPos5Icms := oIni:ReadString("ecf", "pos5icms", "05.00", 1 ) ; cPos5Icms += IF( Len( cPos5Icms ) = 2, ".00","")
    cPos6Icms := oIni:ReadString("ecf", "pos6icms", "00.00", 1 ) ; cPos6Icms += IF( Len( cPos6Icms ) = 2, ".00","")
    cPos7Icms := oIni:ReadString("ecf", "pos7icms", "00.00", 1 ) ; cPos7Icms += IF( Len( cPos7Icms ) = 2, ".00","")
    cPos8Icms := oIni:ReadString("ecf", "pos8icms", "00.00", 1 ) ; cPos8Icms += IF( Len( cPos8Icms ) = 2, ".00","")
    cPos9Icms := oIni:ReadString("ecf", "pos9icms", "00.00", 1 ) ; cPos9Icms += IF( Len( cPos9Icms ) = 2, ".00","")

    cIcmsIss1 := oIni:ReadString("ecf", "pos1icms", "1", 2 )
    cIcmsIss2 := oIni:ReadString("ecf", "pos2icms", "1", 2 )
    cIcmsIss3 := oIni:ReadString("ecf", "pos3icms", "1", 2 )
    cIcmsIss4 := oIni:ReadString("ecf", "pos4icms", "1", 2 )
    cIcmsIss5 := oIni:ReadString("ecf", "pos5icms", "1", 2 )
    cIcmsIss6 := oIni:ReadString("ecf", "pos6icms", "1", 2 )
    cIcmsIss7 := oIni:ReadString("ecf", "pos7icms", "1", 2 )
    cIcmsIss8 := oIni:ReadString("ecf", "pos8icms", "1", 2 )
    cIcmsIss9 := oIni:ReadString("ecf", "pos9icms", "1", 2 )

    cVista      := IF( oIni:ReadBool("ecf","vista", .T. ), "S", "N")
    cNomeEcf   := IF( oIni:ReadBool("ecf","nomeecf", .T. ), "S", "N")
    cAutoEcf   := IF( oIni:ReadBool("ecf","autoecf", .F. ), "S", "N")
    cEcfRede   := IF( oIni:ReadBool("ecf","ecfrede", .F. ), "S", "N")

   oMenu:MaBox( 00, 01, 18, 78, "ECF CUPOM FISCAL - CONFIGURACAO")
   SetCursor(1) ; DevPos( 01, 02 ) ; DevOut( "Impressora Ativa....... " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nAtiva, "nAtiva", "9", {|| PickSimNao( @nAtiva )},))
   SetCursor(1) ; DevPos( 01, 40 ) ; DevOut( "Modelo Impressora ECF.: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nModelo, "nModelo", "9", {|| PickTam( aEcf, {1,2,3,4,5,6}, @nModelo )},))
   SetCursor(1) ; DevPos( 02, 02 ) ; DevOut( "Porta de comunicacao..: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nPorta, "nPorta", "9", {|| PickTam({"Com1","Com2","Com3","Com4","Com5","Com6","Com7","Com8","Com9"}, {1,2,3,4,5,6,7,8,9}, @nPorta )},))
   SetCursor(1) ; DevPos( 02, 40 ) ; DevOut( "ECF Monitorada/Rede...: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cEcfRede, "cEcfRede", "!", {|| PickSimNao( @cEcfRede )}, {|| nModelo = 2 .OR. nModelo = 6}))
    SetCursor(1) ; DevPos( 03, 02 ) ; DevOut( "Diretorio Driver Rede.: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cPathRede, "cPathRede", "@!",,))
    SetCursor(1) ; DevPos( 04, 02 ) ; DevOut( "Indice................: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nIndice, "nIndice", "9.99",,))
    SetCursor(1) ; DevPos( 04, 40 ) ; DevOut( "Icms Estadual.........: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nUfIcms, "nUfIcms", "99.99",,))
   SetCursor(1) ; DevPos( 05, 02 ) ; DevOut( "Iss Municipal.........: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nIss, "nIss", "99.99",,))
    SetCursor(1) ; DevPos( 05, 40 ) ; DevOut( "Emitir Cupom a Vista..: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cVista, "cVista", "!", {|| PickSimNao( @cVista )},))
    SetCursor(1) ; DevPos( 06, 02 ) ; DevOut( "Emitir Nome Cliente...: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cNomeEcf, "cNomeEcf", "!", {|| PickSimNao( @cNomeEcf )},))
    SetCursor(1) ; DevPos( 06, 40 ) ; DevOut( "Auto Emitir Cupom.....: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cAutoEcf, "cAutoEcf", "!", {|| PickSimNao( @cAutoEcf )},))
    SetCursor(1) ; DevPos( 07, 02 ) ; DevOut( "Imprimir CF em Linhas.: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nSigLinha, "nSigLinha", "9", {|| PickTam({"1 Linha", "2 Linhas"}, {1,2}, @nSigLinha )},))

   oMenu:MaBox( 08, 01, 18, 78, "CONFIGURACAO ADICIONAL PARA: " + aEcf[2])
   SetCursor(1) ; DevPos( 09, 02 ) ; DevOut( "Aliquota Posicao 01...: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cPos1Icms, "cPos1Icms", "99.99",, {|| nModelo == 2}))
   SetCursor(1) ; DevPos( 09, 40 ) ; DevOut( "Icms/Iss..............: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cIcmsIss1, "cIcmsIss1", "9", {|| PickTam({"Icms", "Iss"}, {"1","2"}, @cIcmsIss1 )}, {|| nModelo = 2}))
   SetCursor(1) ; DevPos( 10, 02 ) ; DevOut( "Aliquota Posicao 02...: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cPos2Icms, "cPos2Icms", "99.99",, {|| nModelo == 2}))
   SetCursor(1) ; DevPos( 10, 40 ) ; DevOut( "Icms/Iss..............: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cIcmsIss2, "cIcmsIss2", "9", {|| PickTam({"Icms", "Iss"}, {"1","2"}, @cIcmsIss2 )}, {|| nModelo == 2}))
   SetCursor(1) ; DevPos( 11, 02 ) ; DevOut( "Aliquota Posicao 03...: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cPos3Icms, "cPos3Icms", "99.99",, {|| nModelo = 2}))
   SetCursor(1) ; DevPos( 11, 40 ) ; DevOut( "Icms/Iss..............: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cIcmsIss3, "cIcmsIss3", "9", {|| PickTam({"Icms", "Iss"}, {"1","2"}, @cIcmsIss3 )}, {|| nModelo = 2}))
   SetCursor(1) ; DevPos( 12, 02 ) ; DevOut( "Aliquota Posicao 04...: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cPos4Icms, "cPos4Icms", "99.99",, {|| nModelo = 2}))
   SetCursor(1) ; DevPos( 12, 40 ) ; DevOut( "Icms/Iss..............: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cIcmsIss4, "cIcmsIss4", "9", {|| PickTam({"Icms", "Iss"}, {"1","2"}, @cIcmsIss4 )}, {|| nModelo = 2}))
   SetCursor(1) ; DevPos( 13, 02 ) ; DevOut( "Aliquota Posicao 05...: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cPos5Icms, "cPos5Icms", "99.99",, {|| nModelo = 2}))
   SetCursor(1) ; DevPos( 13, 40 ) ; DevOut( "Icms/Iss..............: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cIcmsIss5, "cIcmsIss5", "9", {|| PickTam({"Icms", "Iss"}, {"1","2"}, @cIcmsIss5 )}, {|| nModelo = 2}))
   SetCursor(1) ; DevPos( 14, 02 ) ; DevOut( "Aliquota Posicao 06...: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cPos6Icms, "cPos6Icms", "99.99",, {|| nModelo = 2}))
   SetCursor(1) ; DevPos( 14, 40 ) ; DevOut( "Icms/Iss..............: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cIcmsIss6, "cIcmsIss6", "9", {|| PickTam({"Icms", "Iss"}, {"1","2"}, @cIcmsIss6 )}, {|| nModelo = 2}))
   SetCursor(1) ; DevPos( 15, 02 ) ; DevOut( "Aliquota Posicao 07...: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cPos7Icms, "cPos7Icms", "99.99",, {|| nModelo = 2}))
   SetCursor(1) ; DevPos( 15, 40 ) ; DevOut( "Icms/Iss..............: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cIcmsIss7, "cIcmsIss7", "9", {|| PickTam({"Icms", "Iss"}, {"1","2"}, @cIcmsIss7 )}, {|| nModelo = 2}))
   SetCursor(1) ; DevPos( 16, 02 ) ; DevOut( "Aliquota Posicao 08...: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cPos8Icms, "cPos8Icms", "99.99",, {|| nModelo = 2}))
   SetCursor(1) ; DevPos( 16, 40 ) ; DevOut( "Icms/Iss..............: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cIcmsIss8, "cIcmsIss8", "9", {|| PickTam({"Icms", "Iss"}, {"1","2"}, @cIcmsIss8 )}, {|| nModelo = 2}))
   SetCursor(1) ; DevPos( 17, 02 ) ; DevOut( "Aliquota Posicao 09...: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cPos9Icms, "cPos9Icms", "99.99",, {|| nModelo = 2}))
   SetCursor(1) ; DevPos( 17, 40 ) ; DevOut( "Icms/Iss..............: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cIcmsIss9, "cIcmsIss9", "9", {|| PickTam({"Icms", "Iss"}, {"1","2"}, @cIcmsIss9 )}, {|| nModelo = 2}))
    ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
    IF LastKey() = 27
        LETO_SET( 7, ( cPath ) )
        ResTela( cScreen )
        Exit
    EndIF
    ErrorBeep()
    IF Conf("Pergunta: Confirma  ?")
        oIni:WriteInteger("ecf", "modelo", nModelo )
        oIni:WriteInteger("ecf", "porta", nPorta )
        oIni:WriteInteger("ecf", "indice", nIndice )
        oIni:WriteInteger("ecf", "uficms", nUfIcms )
        oIni:WriteInteger("ecf", "ativa", nAtiva )
      oIni:WriteInteger("ecf", "iss", nIss )
        oIni:WriteString("ecf",  "pos1icms", cPos1Icms + ";" + cIcmsIss1 )
        oIni:WriteString("ecf",  "pos2icms", cPos2Icms + ";" + cIcmsIss2 )
        oIni:WriteString("ecf",  "pos3icms", cPos3Icms + ";" + cIcmsIss3 )
        oIni:WriteString("ecf",  "pos4icms", cPos4Icms + ";" + cIcmsIss4 )
        oIni:WriteString("ecf",  "pos5icms", cPos5Icms + ";" + cIcmsIss5 )
        oIni:WriteString("ecf",  "pos6icms", cPos6Icms + ";" + cIcmsIss6 )
        oIni:WriteString("ecf",  "pos7icms", cPos7Icms + ";" + cIcmsIss7 )
        oIni:WriteString("ecf",  "pos8icms", cPos8Icms + ";" + cIcmsIss8 )
        oIni:WriteString("ecf",  "pos9icms", cPos9Icms + ";" + cIcmsIss9 )
        oIni:WriteBool(  "ecf",  "vista",   IF( cVista   = "S", .T., .F. ))
        oIni:WriteBool(  "ecf",  "nomeecf", IF( cNomeEcf = "S", .T., .F. ))
        oIni:WriteBool(  "ecf",  "autoecf", IF( cAutoEcf = "S", .T., .F. ))
        oIni:WriteBool(  "ecf",  "ecfrede", IF( cEcfRede = "S", .T., .F. ))
        oIni:WriteString("ecf",  "pathrede", cPathRede )
        oIni:WriteInteger("ecf", "siglinha", nSigLinha )
    EndIF
EndDo

function ConfServidorBcoDados()

    LOCAL oLeto           := TIniNew( oAmbiente:xRoot + "\SCI.INI")
    LOCAL cScreen        := SaveScreen()
    LOCAL GetList        := {}
    LOCAL cPath        := FCurdir()

    LETO_SET( 7, ( oAmbiente:xBase ) )
    WHILE .T.
        oMenu:Limpa()
        cLetoIP    := oLeto:ReadString("LETO", "ip",    oAmbiente:LetoIP )
        cLetoPort  := oLeto:ReadString("LETO", "port",  oAmbiente:LetoPort )
        cLetoPath  := oLeto:ReadString("LETO", "path",  oAmbiente:LetoPath )

        MaBox( 01, 01, 05, 79, "CONFIGURACAO SERVIDOR LETO")
        SetCursor(1) ; DevPos( 02, 02 ) ; DevOut( "Ip Servidor.........: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cLetoIp, "cLetoIp", "@!",,))
        SetCursor(1) ; DevPos( 03, 02 ) ; DevOut( "Porta Servidor......: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cLetoPort, "cLetoPort", "9999",,))
        SetCursor(1) ; DevPos( 04, 02 ) ; DevOut( "Path Servidor.......: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cLetoPath, "cLetoPath", "@!",,))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        IF LastKey() = 27
            LETO_SET( 7, (cPath ) )
            ResTela( cScreen )
            Exit
        EndIF
        ErrorBeep()
        IF Conf("Pergunta: Confirma  ?")
            oLeto:WriteString("LETO","ip",   cLetoIP)
            oLeto:WriteString("LETO","port", cLetoPort)
            oLeto:WriteString("LETO","path", cLetoPath)
        EndIF
    EndDo


Proc TermPrecos()

LOCAL GetList    := {}
LOCAL cScreen    := SaveScreen()
LOCAL xCodigo    := 0
LOCAL nCol        := MaxRow()
LOCAL nTam        := MaxCol()
LOCAL nPos        := 0
LOCAL cString1 := "³ENTER=CONSULTA³ESC=SAIR"

SetKey( -4, NIL )
oMenu:Limpa()
WHILE .T.
    xCodigo := 0
    aPrint( 00, 00,  Padc("TERMINAL DE CONSULTA DE PRECOS",MaxCol()), oMenu:CorCabec, MaxCol() )
    MaBox( 02, 01, 10, 78 )
    MaBox( 12, 01, 22, 78 )
    nPos := ( nTam - Len( cString1 ))
    aPrint( nCol, 00, "³CLIQUE COM O SCANNER OU DIGITE O CODIGO DO PRODUTO", oMenu:CorCabec, MaxCol() )
    aPrint( nCol, nPos, cString1, oMenu:CorCabec )
    LETO_SET( 27, "On" )
    SetCursor(1) ; DevPos( 04, 10 ) ; DevOut( "Codigo...: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( xCodigo, "xCodigo", "9999999999999", {|| TermProduto( @xCodigo )},))
    DevPos( 06, 10 ) ; DevOut( "Produto..: " )
    ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
    LETO_SET( 27, "Off" )
    IF LastKey() = 27
        SetKey( -4, {|| PrecosConsulta()})
        Return
    EndIF
    Inkey(5)
EndDo

Function TermProduto( xCodigo)

LOCAL aRotina              := {{|| InclusaoProdutos() }}
LOCAL aRotinaAlteracao := {{|| InclusaoProdutos(.T.) }}
LOCAL GetList              := {}
LOCAL Arq_Ant              := Alias()
LOCAL Ind_Ant              := IndexOrd()
LOCAL nTam                  := 6
LOCAL cTemp
LOCAL cScreen

cTemp   := IF( ValType(xCodigo) = "N", Str(xCodigo, 13), xCodigo)
nTam      := Len( ltrim(rtrim(cTemp)))
IF nTam <= 6
    nTam      := 6
    xCodigo :=IF( ValType(xCodigo) = "N", StrZero(xCodigo, nTam), xCodigo)
ElseIF nTam = 8
    nTam      := 8
    xCodigo := IF( ValType(xCodigo) = "N", StrZero(xCodigo, nTam), xCodigo)
 Else
    nTam      := 13
    xCodigo := IF( ValType(xCodigo) = "N", StrZero(xCodigo, nTam), xCodigo)
EndIF
dbSelectArea( "Lista" )
IF nTam = 6
    Lista->(Order( 2 ))
ElseIF nTam = 13 .OR. nTam = 8
    Lista->(Order( 11 ))
EndIF
IF Lista->( !DbSeek( xCodigo ))
    Lista->(Order( 3 ))
    Escolhe( 12, 01, 22, "Codigo + 'Ý' + Sigla + 'Ý' + Descricao + 'Ý' + Tran( Varejo, '@E 9999,999,999.99')","CODI  MARCA      DESCRICAO DO PRODUTO                      PRECO", aRotina, NIL, aRotinaAlteracao, NIl, .F.)
EndIF
xCodigo := Lista->CodeBar
Write( 06, 22,  Lista->Descricao )
MaBox( 12, 01, 22, 78 )
Num( 14, Lista->Varejo)
AreaAnt( Arq_Ant, Ind_Ant )
Return( .T. )

Function Num( nRow, nValor )




























































LOCAL aNum := {{" ÛÛÛ " , "Û  ÛÛ" , "Û Û Û" , "ÛÛ  Û" , " ÛÛÛ "},    {"  ÛÛ" , " Û Û" , "Û  Û" , "   Û" , "ÛÛÛÛ"},    {"ÛÛÛÛÛ" , "    Û" , "ÛÛÛÛÛ" , "Û    " , "ÛÛÛÛÛ"},    {"ÛÛÛÛÛ" , "    Û" , " ÛÛÛÛ" , "    Û" , "ÛÛÛÛÛ"},    {"Û   Û" , "Û   Û" , "ÛÛÛÛÛ" , "    Û" , "    Û"},    {"ÛÛÛÛÛ" , "Û    " , "ÛÛÛÛÛ" , "    Û" , "ÛÛÛÛÛ"},    {"ÛÛÛÛÛ" , "Û    " , "ÛÛÛÛÛ" , "Û   Û" , "ÛÛÛÛÛ"},    {"ÛÛÛÛÛ" , "   ÛÛ" , "  ÛÛ " , " ÛÛ  " , "ÛÛ   "},    {"ÛÛÛÛÛ" , "Û   Û" , "ÛÛÛÛÛ" , "Û   Û" , "ÛÛÛÛÛ"},    {"ÛÛÛÛÛ" , "Û   Û" , "ÛÛÛÛÛ" , "    Û" , "ÛÛÛÛÛ"},    {"   " , "   " , "   " , "   " , "  "},    {"   " , "   " , "   " , "   " , "  "}}

LOCAL aDig      := {"0","1","2","3","4","5","6","7","8","9",".",","}
LOCAL cNumero := ltrim(rtrim(Tran(nValor, "99,9999.99")))
LOCAL nTam      := Len( cNumero )
LOCAL nX       := 0
LOCAL nY       := 0
LOCAL cDig      := ""
LOCAL nPos      := 0
LOCAL nConta  := 0

For nX := 1 To nTam
    cDig     := SubStr( cNumero, nX, 1 )
    nPos     := Ascan( aDig, cDig )
    nConta ++
    For nY := 1 To 5
        Write( nRow+nY, 5*nConta+nConta, aNum[nPos,nY])
    Next
Next

Proc ConfOpcoesFaturamento( cNome )

LOCAL cScreen := SaveScreen()
LOCAL GetList := {}
LOCAL oVenlan    := TIniNew( cNome + ".INI")
LOCAL c2_01
LOCAL c2_02
LOCAL c2_03
LOCAL c2_04
LOCAL c2_05
LOCAL c2_06

WHILE .T.
    oMenu:Limpa()
    c2_01 := IF( oVenlan:ReadBool("opcoesfaturamento","#2.01", .T. ), "S", "N")
    c2_02 := IF( oVenlan:ReadBool("opcoesfaturamento","#2.02", .T. ), "S", "N")
    c2_03 := IF( oVenlan:ReadBool("opcoesfaturamento","#2.03", .T. ), "S", "N")
    c2_04 := IF( oVenlan:ReadBool("opcoesfaturamento","#2.04", .T. ), "S", "N")
    c2_05 := IF( oVenlan:ReadBool("opcoesfaturamento","#2.05", .T. ), "S", "N")
    c2_06 := IF( oVenlan:ReadBool("opcoesfaturamento","#2.06", .T. ), "S", "N")

    oMenu:MaBox( 00, 01, 07, 78, "CONFIGURACAO - OPCOES DE FATURAMENTO")
    SetCursor(1) ; DevPos( 01, 02 ) ; DevOut( "Manualmente - Varejo..........: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( c2_01, "c2_01", "!", {|| PickSimNao( @c2_01 )},))
    SetCursor(1) ; DevPos( Row()+01, 02 ) ; DevOut( "Manualmente - Atacado.........: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( c2_02, "c2_02", "!", {|| PickSimNao( @c2_02 )},))
    SetCursor(1) ; DevPos( Row()+01, 02 ) ; DevOut( "Manualmente - Custo...........: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( c2_03, "c2_03", "!", {|| PickSimNao( @c2_03 )},))
    SetCursor(1) ; DevPos( Row()+01, 02 ) ; DevOut( "Codigo Barra - Varejo.........: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( c2_04, "c2_04", "!", {|| PickSimNao( @c2_04 )},))
    SetCursor(1) ; DevPos( Row()+01, 02 ) ; DevOut( "Codigo Barra - Atacado........: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( c2_05, "c2_05", "!", {|| PickSimNao( @c2_05 )},))
    SetCursor(1) ; DevPos( Row()+01, 02 ) ; DevOut( "Codigo Barra - Custo..........: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( c2_06, "c2_06", "!", {|| PickSimNao( @c2_06 )},))
    ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
    IF LastKey() = 27
        ResTela( cScreen )
        Exit
    EndIF
    ErrorBeep()
    IF Conf("Pergunta: Confirma  ?")
        oVenlan:WriteBool( "opcoesfaturamento", "#2.01", IF( c2_01 = "S", .T., .F. ))
        oVenlan:WriteBool( "opcoesfaturamento", "#2.02", IF( c2_02 = "S", .T., .F. ))
        oVenlan:WriteBool( "opcoesfaturamento", "#2.03", IF( c2_03 = "S", .T., .F. ))
        oVenlan:WriteBool( "opcoesfaturamento", "#2.04", IF( c2_04 = "S", .T., .F. ))
        oVenlan:WriteBool( "opcoesfaturamento", "#2.05", IF( c2_05 = "S", .T., .F. ))
        oVenlan:WriteBool( "opcoesfaturamento", "#2.06", IF( c2_06 = "S", .T., .F. ))
    EndIF
EndDo

Proc ConfFiscal( cNome )

LOCAL cScreen := SaveScreen()
LOCAL GetList := {}
LOCAL oVenlan    := TIniNew( cNome + ".INI")
LOCAL c2_01
LOCAL c2_02
LOCAL c2_03
LOCAL c2_04
LOCAL c2_05
LOCAL c2_06
LOCAL c2_07
LOCAL c2_08
LOCAL c2_09

WHILE .T.
    oMenu:Limpa()
    c2_01 := IF( oVenlan:ReadBool("impressorasfiscais","#2.01", .T. ), "S", "N")
    c2_02 := IF( oVenlan:ReadBool("impressorasfiscais","#2.02", .T. ), "S", "N")
    c2_03 := IF( oVenlan:ReadBool("impressorasfiscais","#2.03", .T. ), "S", "N")
    c2_04 := IF( oVenlan:ReadBool("impressorasfiscais","#2.04", .T. ), "S", "N")
    c2_05 := IF( oVenlan:ReadBool("impressorasfiscais","#2.05", .T. ), "S", "N")
    c2_06 := IF( oVenlan:ReadBool("impressorasfiscais","#2.06", .T. ), "S", "N")
    c2_07 := IF( oVenlan:ReadBool("impressorasfiscais","#2.07", .T. ), "S", "N")
    c2_08 := IF( oVenlan:ReadBool("impressorasfiscais","#2.08", .T. ), "S", "N")
    c2_09 := IF( oVenlan:ReadBool("impressorasfiscais","#2.09", .T. ), "S", "N")

    oMenu:MaBox( 00, 01, 10, 78, "CONFIGURACAO - IMPRESSORAS FISCAIS")
    SetCursor(1) ; DevPos( 01, 02 ) ; DevOut( "Cadastrar Forma de Pagamento..: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( c2_01, "c2_01", "!", {|| PickSimNao( @c2_01 )},))
    SetCursor(1) ; DevPos( Row()+01, 02 ) ; DevOut( "Emissao da Reducao Z - Fim Dia: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( c2_02, "c2_02", "!", {|| PickSimNao( @c2_02 )},))
   SetCursor(1) ; DevPos( Row()+01, 02 ) ; DevOut( "Emissao da Leitura X..........: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( c2_03, "c2_03", "!", {|| PickSimNao( @c2_03 )},))
    SetCursor(1) ; DevPos( Row()+01, 02 ) ; DevOut( "Leitura Memoria Fiscal - Data.: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( c2_04, "c2_04", "!", {|| PickSimNao( @c2_04 )},))
    SetCursor(1) ; DevPos( Row()+01, 02 ) ; DevOut( "Leitura Memoria Fiscal - Redu.: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( c2_05, "c2_05", "!", {|| PickSimNao( @c2_05 )},))
    SetCursor(1) ; DevPos( Row()+01, 02 ) ; DevOut( "Relatorio Gerencial...........: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( c2_06, "c2_06", "!", {|| PickSimNao( @c2_06 )},))
    SetCursor(1) ; DevPos( Row()+01, 02 ) ; DevOut( "Inicio Dia Fiscal.............: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( c2_07, "c2_07", "!", {|| PickSimNao( @c2_07 )},))
    SetCursor(1) ; DevPos( Row()+01, 02 ) ; DevOut( "Verificacao do Modulo Fiscal..: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( c2_08, "c2_08", "!", {|| PickSimNao( @c2_08 )},))
    SetCursor(1) ; DevPos( Row()+01, 02 ) ; DevOut( "Verificacao Dia Livre.........: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( c2_09, "c2_09", "!", {|| PickSimNao( @c2_09 )},))
    ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
    IF LastKey() = 27
        ResTela( cScreen )
        Exit
    EndIF
    ErrorBeep()
    IF Conf("Pergunta: Confirma  ?")
        oVenlan:WriteBool( "impressorasfiscais", "#2.01", IF( c2_01 = "S", .T., .F. ))
        oVenlan:WriteBool( "impressorasfiscais", "#2.02", IF( c2_02 = "S", .T., .F. ))
        oVenlan:WriteBool( "impressorasfiscais", "#2.03", IF( c2_03 = "S", .T., .F. ))
        oVenlan:WriteBool( "impressorasfiscais", "#2.04", IF( c2_04 = "S", .T., .F. ))
        oVenlan:WriteBool( "impressorasfiscais", "#2.05", IF( c2_05 = "S", .T., .F. ))
        oVenlan:WriteBool( "impressorasfiscais", "#2.06", IF( c2_06 = "S", .T., .F. ))
        oVenlan:WriteBool( "impressorasfiscais", "#2.07", IF( c2_07 = "S", .T., .F. ))
        oVenlan:WriteBool( "impressorasfiscais", "#2.08", IF( c2_08 = "S", .T., .F. ))
        oVenlan:WriteBool( "impressorasfiscais", "#2.09", IF( c2_09 = "S", .T., .F. ))
    EndIF
EndDo

Proc EcfComandos()

LOCAL cScreen := SaveScreen()
LOCAL nChoice := 0
LOCAL aEcf    := {"Zanthus IZ-11", "Bematech MP-20 FI II", "Zanthus IZ-20", "Sigtron FS345", "Sweda FS 7000I", "Daruma FS 2000"}
LOCAL nIniEcf := oIni:ReadInteger("ecf","modelo", 1 )

WHILE .T.
    oMenu:Limpa()
    M_Title("COMANDOS DE IMPRESSORA FISCAL")
   nChoice := FazMenu( 05, 10, aEcf )
    Do Case
    Case nChoice = 0
      Exit
   Otherwise
      IF nIniEcf <> nChoice
         ErrorBeep()
         Alerta("Erro: ECF configurada na base de dados ‚: " + aEcf[nIniEcf])
         Loop
      EndIF
      Ecf(nChoice, aEcf)
   EndCase
EndDO

Proc Ecf( nTipo, aEcf )

LOCAL cScreen        := SaveScreen()
LOCAL nChoice        := 0
LOCAL aEcfPermite := {}









LOCAL aMenu       := {"Cadastrar Forma de Pagto", "Cadastrar Aliquotas", "Emissao Reducao Z", "Emissao Leitura X", "Leitura Memoria Fiscal por Data", "Leitura Memoria Fiscal por Reducao", "Relatorio Gerencial", "Inicio Dia Fiscal", "Verificacao Modulo Fiscal", "Verificacao Dia Livre"}
oAmbiente:aFiscalIni := FiscalRegedit()


aEcfPermite          := { SnFiscal(2.01),SnFiscal(2.02),SnFiscal(2.03), SnFiscal(2.04),SnFiscal(2.05),SnFiscal(2.06), SnFiscal(2.07),SnFiscal(2.08),SnFiscal(2.09) }




WHILE .T.
    M_Title("COMANDOS DE IMPRESSORA FISCAL")
   nChoice := FazMenu( 07, 12, aMenu, Cor(), aEcfPermite )
    Do Case
    Case nChoice = 0
        Return
    Case nChoice = 1
      IF nTipo = 2
         EcfForma_Bema()
      Else
            ErrorBeep()
         Alerta("Erro: Nao disponivel para: " + aEcf[nTipo])
      EndIF
   Case nChoice = 2
      IF nTipo = 2
            Aliquota_Bema()
      ElseIF nTipo = 5
            Aliquota_Sigtron()
      Else
            ErrorBeep()
         Alerta("Erro: Nao disponivel para: " + aEcf[nTipo])
      EndIF
    Case nChoice = 3
      ErrorBeep()
      IF Conf("Warning! Reducao Z encerra o dia. Abortar?")
         Loop
      EndIF
        IF nTipo = 1
            LeituraZ_Zanthus()
        ElseIF nTipo = 2
            LeituraZ_Bema()
      ElseIF nTipo = 3
            LeituraZ_Zanthus()
      ElseIF nTipo = 4
            LeituraZ_Sigtron()
      ElseIF nTipo = 5
         Z_Sweda()
      ElseIF nTipo = 6
         Z_Daruma()
        EndIF
    Case nChoice = 4
      ErrorBeep()
      IF Conf("Pergunta: Impressao de Leitura X. Abortar?")
         Loop
      EndIF
        IF nTipo = 1
            LeituraX_Zanthus()
        ElseIF nTipo = 2
            LeituraX_Bema()
      ElseIF nTipo = 3
            LeituraX_Zanthus()
      ElseIF nTipo = 4
            LeituraX_SigTron()
      ElseIF nTipo = 5
         X_Sweda()
      ElseIF nTipo = 6
         X_Daruma()
        EndIF
    Case nChoice = 5
        IF nTipo = 1
            MeFisDat_Zanthus()
        ElseIF nTipo = 2
            MeFisDat_Bema()
      ElseIF nTipo = 3
            MeFisDat_Zanthus()
      ElseIF nTipo = 4
            MeFisDat_Sigtron()
      Else
            ErrorBeep()
         Alerta("Erro: Nao disponivel para: " + aEcf[nTipo])
      EndIF
    Case nChoice = 6
        IF nTipo = 1
            MeFisInt_Zanthus()
        ElseIF nTipo = 2
            MeFisInt_Bema()
      ElseIF nTipo = 3
            MeFisInt_Zanthus()
      ElseIF nTipo = 4
            MeFisInt_SigTron()
      Else
            ErrorBeep()
         Alerta("Erro: Nao disponivel para: " + aEcf[nTipo])
      EndIF
    Case nChoice = 7
      IF nTipo = 2
            ReGerenc_Bema()
      ElseIF nTipo = 4
            ReGerenc_Sigtron()
      Else
            ErrorBeep()
         Alerta("Erro: Nao disponivel para: " + aEcf[nTipo])
        EndIF
    Case nChoice = 8
      IF nTipo = 1 .OR. nTipo = 3
         DiaInicio_Zanthus()
      Else
            ErrorBeep()
         Alerta("Erro: Nao disponivel para: " + aEcf[nTipo])
      EndIF
    Case nChoice = 9
      IF nTipo = 1 .OR. nTipo = 3
         VerModulo_Zanthus()
      Else
            ErrorBeep()
         Alerta("Erro: Nao disponivel para: " + aEcf[nTipo])
      EndIF
   Case nChoice = 10
      IF nTipo = 1 .OR. nTipo = 3
         DiaLivre_Zanthus()
      Else
            ErrorBeep()
         Alerta("Erro: Nao disponivel para: " + aEcf[nTipo])
      EndIF
   EndCase
EndDo

Proc EcfForma_Bema()

LOCAL cScreen := SaveScreen()
LOCAL Arq_Ant      := Alias()
LOCAL Ind_Ant      := IndexOrd()
LOCAL nPorta      := 0
LOCAL cIni          := chr(27) + chr(251)
LOCAL cFim          := "|"+ chr(27)
LOCAL cBuffer      := ""
LOCAL Retorno      := 0
LOCAL lEcfRede   := oIni:ReadBool("ecf","ecfrede", .F. )


IF !UsaArquivo("FORMA")
    Return
EndIF
Forma->(Order( 1 ))
Forma->(DbGoTop())
nPorta := BemaIniciaDriver()
Mensagem("Aguarde, Registrando formas de Pgto")
WHILE Forma->(!Eof())
     cForma        := Forma->Forma
     cDescForma := Left( Forma->Condicoes, 16 )
     IF cForma = "01"
         Forma->(DbSkip(1))
    EndIF
   IF lEcfRede
      cBuffer    := "148|" + cDescForma + "|1|"
   Else
      cBuffer    := cIni + "71|" + cDescForma + cFim
   EndIF
    Comunica_Com_Impressora( nPorta, cBuffer, Retorno )
    Forma->(DbSkip(1))
EndDo
FClose( nPorta )
ResTela( cScreen )
Return

Proc ReGerenc_Bema()

LOCAL cScreen := SaveScreen()
LOCAL Arq_Ant      := Alias()
LOCAL Ind_Ant      := IndexOrd()
LOCAL nPorta      := 0
LOCAL cIni          := chr(27) + chr(251)
LOCAL cFim          := "|"+ chr(27)
LOCAL cBuffer      := ""
LOCAL Retorno      := 0

nPorta := BemaIniciaDriver()
Mensagem("Aguarde, Emitindo Relatorio Gerencial")
cBuffer    := cIni + "20|" + "ANTES DA IMPRESSAO DESTE RELATORIO, SERA IMPRESSO A LEITURA 'X'" + cFim
Comunica_Com_Impressora( nPorta, cBuffer, Retorno )
cBuffer    := cIni + "21|" + cFim
Comunica_Com_Impressora( nPorta, cBuffer, Retorno )
FClose( nPorta )
ResTela( cScreen )
Return

Function SwedaOn()

LETO_SET( 17, "Off" )
LETO_SET( 20, "PRINTER" )
Set( 24, "IfSweda", .F. )
LETO_SET( 23, "On" )
SetPrc(0,0)
Return Nil

Function SwedaOff()

LETO_SET( 20, "SCREEN" )
LETO_SET( 23, "Off" )
LETO_SET( 17, "On" )
LETO_SET( 24, "" )
CloseSpooler()
Return Nil

Proc X_Sweda()

SwedaOn()
Write( Prow(), Pcol(), Chr(27) + ".13N}" )
SwedaOff()
Return

Proc Z_Sweda()

SwedaOn()
Write( Prow(), Pcol(), Chr(27) + ".14N}" )
SwedaOff()
Return

Proc LeituraX_Bema()

LOCAL cScreen    := SaveScreen()
LOCAL nPorta    := 0
LOCAL cIni        := chr(27) + chr(251)
LOCAL cFim        := "|"+ chr(27)
LOCAL cBuffer    := ""
LOCAL Retorno    := 0
LOCAL lEcfRede := oIni:ReadBool("ecf","ecfrede", .F. )

nPorta := BemaIniciaDriver()
Mensagem("Aguarde, Emitindo Leitura X")
IF lEcfRede
   cBuffer := "045|"
Else
   cBuffer := cIni + "06" + cFim
EndIF
Comunica_Com_Impressora( nPorta, cBuffer, Retorno )
FClose( nPorta )
ResTela( cScreen )
Return

Proc LeituraZ_Bema()

LOCAL cScreen    := SaveScreen()
LOCAL nPorta    := 0
LOCAL cIni        := chr(27) + chr(251)
LOCAL cFim        := "|"+ chr(27)
LOCAL cBuffer    := ""
LOCAL Retorno    := 0
LOCAL lEcfRede := oIni:ReadBool("ecf","ecfrede", .F. )

oMenu:Limpa()
nPorta := BemaIniciaDriver()
Mensagem("Aguarde, Emitindo Reducao Z")
IF lEcfRede
   cBuffer := "071|"
Else
   cBuffer := cIni + "05" + cFim
EndIF
Comunica_Com_Impressora( nPorta, cBuffer, Retorno )
FClose( nPorta )
ResTela( cScreen )
Return

Proc MeFisDat_Bema()

LOCAL cScreen    := SaveScreen()
LOCAL nPorta    := 0
LOCAL cIni        := chr(27) + chr(251)
LOCAL cFim        := "|"+ chr(27)
LOCAL cPipe     := "|"
LOCAL cBuffer    := ""
LOCAL Retorno    := 0
LOCAL dIni        := Date()
LOCAL dFim        := Date()
LOCAL cSaida    := "I"
LOCAL cDataIni := ""
LOCAL cDataFim := ""

MaBox( 10, 10, 13, 40 )
SetCursor(1) ; DevPos( 11, 11 ) ; DevOut( "Data Inicial..:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dIni, "dIni", "##/##/##",,))
SetCursor(1) ; DevPos( 12, 11 ) ; DevOut( "Data Final....:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dFim, "dFim", "##/##/##",,))
ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
IF LastKey() = 27
    ResTela( cScreen )
    Return
EndIF
cDataIni := StrTran( Dtoc( dIni ), "/")
cDataFim := StrTran( Dtoc( dFim ), "/")
cDiaIni    := Left( cDataIni, 2)
cMesIni    := SubStr( cDataIni, 3, 2 )
cAnoIni    := Right( cDataIni, 2 )
cDiaFim    := Left( cDataFim, 2)
cMesFim    := SubStr( cDataFim, 3, 2 )
cAnoFim    := Right( cDataFim, 2 )

nPorta := BemaIniciaDriver()
Mensagem("Aguarde, Emitindo Leitura Memoria Fiscal")
cBuffer := cIni + "08" + cPipe
cBuffer += cDiaIni + cPipe
cBuffer += cMesIni + cPipe
cBuffer += cAnoIni + cPipe
cBuffer += cDiaFim + cPipe
cBuffer += cMesFim + cPipe
cBuffer += cAnoFim + cPipe
cBuffer += cSaida + cPipe + cFim
Comunica_Com_Impressora( nPorta, cBuffer, Retorno )
FClose( nPorta )
Return

Proc MeFisInt_Bema()

LOCAL cScreen    := SaveScreen()
LOCAL nPorta    := 0
LOCAL cIni        := chr(27) + chr(251)
LOCAL cFim        := "|"+ chr(27)
LOCAL cBuffer    := ""
LOCAL Retorno    := 0
LOCAL nIni        := 0
LOCAL nFim        := 0
LOCAL cSaida    := "I"
LOCAL cPipe     := "|"

MaBox( 10, 10, 13, 40 )
SetCursor(1) ; DevPos( 11, 11 ) ; DevOut( "Reducao Inicial.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nIni, "nIni", "9999",,))
SetCursor(1) ; DevPos( 12, 11 ) ; DevOut( "Reducao Final...:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nFim, "nFim", "9999",,))
ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
IF LastKey() = 27
    ResTela( cScreen )
    Return
EndIF
nPorta := BemaIniciaDriver()
Mensagem("Aguarde, Emitindo Leitura Memoria Fiscal")


cBuffer := cIni + "08" + cPipe + "00" + cPipe +  StrZero( nIni, 4, 0 ) + cPipe + "00" + cPipe +  StrZero( nFim, 4, 0 ) + cPipe + cSaida + cPipe + cfim
Comunica_Com_Impressora( nPorta, cBuffer, Retorno )
FClose( nPorta )
Return

Proc LeituraZ_Zanthus()

LOCAL cScreen    := SaveScreen()
LOCAL nPorta    := 0
LOCAL cBuffer    := Space(134)

nPorta := Fopen("ECF$ZANT", 2 )
if ferror () <> 0
    Alert("Zanthus : Problemas de comunicacao.")
    Return
EndIF

Mensagem("Aguarde, Emitindo Leitura Z")
FWrite( nPorta, "~1/4/",5 )
FRead( nPorta, @cBuffer, 134 )
Response_Zanthus( nPorta, cBuffer )

cBuffer := "~2/U/$08$"
FWrite( nPorta, @cBuffer, Len( cBuffer ))
FClose( nPorta )
ResTela( cScreen )
Return

Proc Z_Daruma()

LOCAL cScreen    := SaveScreen()
LOCAL nPorta    := 0

LOCAL cBuffer  := "1100"
nPorta := DarumaIniciaDriver(cBuffer)
Mensagem("Aguarde, Emitindo Leitura X")
FWrite( nPorta, cBuffer, Len(cBuffer))
FClose( nPorta )
ResTela( cScreen )
Return

Proc X_Daruma()

LOCAL cScreen    := SaveScreen()
LOCAL nPorta    := 0

LOCAL cBuffer  := "1101"
nPorta := DarumaIniciaDriver(cBuffer)
Mensagem("Aguarde, Emitindo Leitura Z")
FWrite( nPorta, cBuffer, Len(cBuffer))
FClose( nPorta )
ResTela( cScreen )
Return

Proc LeituraZ_Sigtron()

LOCAL cScreen    := SaveScreen()
LOCAL nPorta    := 0
LOCAL cBuffer    := Chr(27) + Chr(208)

nPorta := Fopen("SIGFIS", 2 )
if ferror () <> 0
    Alert("Sigtron : Problemas de comunicacao.")
    Return
EndIF

Mensagem("Aguarde, Emitindo Leitura Z")
FWrite( nPorta, cBuffer, 2 )
FClose( nPorta )
ResTela( cScreen )
Return

Proc ReGerenc_Sigtron()

LOCAL cScreen    := SaveScreen()
LOCAL nPorta    := 0
LOCAL cBuffer    := Chr(27) + Chr(211)

nPorta := Fopen("SIGFIS", 2 )
if ferror () <> 0
    Alert("Sigtron : Problemas de comunicacao.")
    Return
EndIF

Mensagem("Aguarde, Emitindo Relatorio Gerencial.")
FWrite( nPorta, @cBuffer, Len( cBuffer ))
FClose( nPorta )
ResTela( cScreen )
Return

Proc LeituraX_Sigtron()

LOCAL cScreen    := SaveScreen()
LOCAL nPorta    := 0
LOCAL cBuffer    := Space(134)
LOCAL Esc207    := Chr(27) + Chr(207)

nPorta := Fopen("SIGFIS", 2 )
if ferror () <> 0
    Alert("SigTron : Problemas de comunicacao.")
    Return
EndIF

Mensagem("Aguarde, Emitindo Leitura X")
FWrite( nPorta, Esc207, 2 )
FClose( nPorta )
ResTela( cScreen )
Return

Proc LeituraX_Zanthus()

LOCAL cScreen    := SaveScreen()
LOCAL nPorta    := 0
LOCAL cBuffer    := Space(134)

nPorta := Fopen("ECF$ZANT", 2 )
if ferror () <> 0
    Alert("Zanthus : Problemas de comunicacao.")
    Return
EndIF

Mensagem("Aguarde, Emitindo Leitura X")
FWrite( nPorta, "~1/3/",5 )
FRead( nPorta, @cBuffer, 134 )
Response_Zanthus( nPorta, cBuffer )

cBuffer := "~2/U/$08$"
FWrite( nPorta, @cBuffer, Len( cBuffer ))
FClose( nPorta )
ResTela( cScreen )
Return

Proc DiaInicio_Zanthus()

LOCAL cScreen    := SaveScreen()
LOCAL nPorta    := 0
LOCAL cBuffer    := Space(134)

nPorta := Fopen("ECF$ZANT", 2 )
if ferror () <> 0
    Alert("Zanthus : Problemas de comunicacao.")
    Return
EndIF
Mensagem("Aguarde, Iniciando Dia Fiscal")
FWrite( nPorta, "~1/1/")
FRead( nPorta, @cBuffer, 134 )

cBuffer := "~2/U/$08$"
FWrite( nPorta, @cBuffer, Len( cBuffer ))
IF Response_Zanthus( nPorta, cBuffer )
    Alerta("OK")
EndIF
FClose( nPorta )
ResTela( cScreen )
Return

Proc DiaLivre_Zanthus()

LOCAL cScreen    := SaveScreen()
LOCAL nPorta    := 0
LOCAL cBuffer    := Space(134)

nPorta := Fopen("ECF$ZANT", 2 )
if ferror () <> 0
    Alert("Zanthus : Problemas de comunicacao.")
    Return
EndIF

Mensagem("Aguarde, Verificando Dia Livre")
FWrite( nPorta, "~1/K/")
FRead( nPorta, @cBuffer, 134 )
IF Response_Zanthus( nPorta, cBuffer )
    Alerta("OK")
EndIF
FClose( nPorta )
ResTela( cScreen )
Return

Proc VerModulo_Zanthus()

LOCAL cScreen    := SaveScreen()
LOCAL nPorta    := 0
LOCAL cBuffer    := Space(134)

nPorta := Fopen("ECF$ZANT", 2 )
if ferror () <> 0
    Alert("Zanthus : Problemas de comunicacao.")
    Return
EndIF

Mensagem("Aguarde, Verificando Modulo Fiscal")
FWrite( nPorta, "~1/5/")
FRead( nPorta, @cBuffer, 134 )
IF Response_Zanthus( nPorta, cBuffer )
    Alerta("OK")
EndIF
FClose( nPorta )
ResTela( cScreen )
Return

Proc MeFisDat_Zanthus()

LOCAL cScreen    := SaveScreen()
LOCAL nPorta    := 0
LOCAL cBuffer    := Space(134)
LOCAL dIni        := Date()
LOCAL dFim        := Date()
LOCAL cSaida    := "I"
LOCAL cDataIni := ""
LOCAL cDataFim := ""
LOCAL cString    := ""

oMenu:Limpa()
MaBox( 10, 10, 13, 40 )
SetCursor(1) ; DevPos( 11, 11 ) ; DevOut( "Data Inicial..:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dIni, "dIni", "##/##/##",,))
SetCursor(1) ; DevPos( 12, 11 ) ; DevOut( "Data Final....:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dFim, "dFim", "##/##/##",,))
ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
IF LastKey() = 27
    ResTela( cScreen )
    Return
EndIF
cDataIni := StrTran( Dtoc( dIni ), "/")
cDataFim := StrTran( Dtoc( dFim ), "/")

nPorta := Fopen("ECF$ZANT", 2 )
if ferror () <> 0
    Alert("Zanthus : Problemas de comunicacao.")
    Return
EndIF
Mensagem("Aguarde, Emitindo Relatorio Fiscal")
cString := "~2/G/$" + cDataIni + cDataFim + "$"
FWrite( nPorta, cString)
FRead( nPorta, @cBuffer, 134 )
Response_Zanthus( nPorta, cBuffer )
FClose( nPorta )
ResTela( cScreen )
Return

Proc MeFisDat_SigTron()

LOCAL cScreen    := SaveScreen()
LOCAL nPorta    := 0
LOCAL cBuffer    := Space(134)
LOCAL dIni        := Date()
LOCAL dFim        := Date()
LOCAL cSaida    := "I"
LOCAL cDataIni := ""
LOCAL cDataFim := ""
LOCAL cString    := ""

oMenu:Limpa()
MaBox( 10, 10, 13, 40 )
SetCursor(1) ; DevPos( 11, 11 ) ; DevOut( "Data Inicial..:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dIni, "dIni", "##/##/##",,))
SetCursor(1) ; DevPos( 12, 11 ) ; DevOut( "Data Final....:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dFim, "dFim", "##/##/##",,))
ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
IF LastKey() = 27
    ResTela( cScreen )
    Return
EndIF
cDataIni := StrTran( Dtoc( dIni ), "/")
cDataFim := StrTran( Dtoc( dFim ), "/")

nPorta := Fopen("SIGFIS", 2 )
if ferror () <> 0
    Alert("SigTron : Problemas de comunicacao.")
    Return
EndIF
Mensagem("Aguarde, Emitindo Relatorio Fiscal")
cString := Chr(27) + Chr(209) + "x" + cDataIni + cDataFim
FWrite( nPorta, @cString, Len( cString ))
FClose( nPorta )
ResTela( cScreen )
Return

Proc MeFisInt_Zanthus()

LOCAL cScreen    := SaveScreen()
LOCAL nPorta    := 0
LOCAL nIni        := 0
LOCAL nFim        := 0
LOCAL cBuffer    := Space(134)
LOCAL cString    := ""

oMenu:Limpa()
MaBox( 10, 10, 13, 40 )
SetCursor(1) ; DevPos( 11, 11 ) ; DevOut( "Reducao Inicial.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nIni, "nIni", "9999",,))
SetCursor(1) ; DevPos( 12, 11 ) ; DevOut( "Reducao Final...:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nFim, "nFim", "9999",,))
ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
IF LastKey() = 27
    ResTela( cScreen )
    Return
EndIF
cIni := StrZero( nIni, 4 )
cFim := StrZero( nFim, 4 )

nPorta := Fopen("ECF$ZANT", 2 )
if ferror () <> 0
    Alert("Zanthus : Problemas de comunicacao.")
    Return
EndIF
Mensagem("Aguarde, Emitindo Relatorio Fiscal")
cString := "~2/G/$" + cIni + cFim + "$"

FWrite( nPorta, cString)
FRead( nPorta, @cBuffer, 134 )
Response_Zanthus( nPorta, cBuffer )
FClose( nPorta )
ResTela( cScreen )
Return

Proc MeFisInt_SigTron()

LOCAL cScreen    := SaveScreen()
LOCAL nPorta    := 0
LOCAL nIni        := 0
LOCAL nFim        := 0
LOCAL cBuffer    := Space(134)
LOCAL cString    := ""

oMenu:Limpa()
MaBox( 10, 10, 13, 40 )
SetCursor(1) ; DevPos( 11, 11 ) ; DevOut( "Reducao Inicial.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nIni, "nIni", "999999",,))
SetCursor(1) ; DevPos( 12, 11 ) ; DevOut( "Reducao Final...:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nFim, "nFim", "999999",,))
ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
IF LastKey() = 27
    ResTela( cScreen )
    Return
EndIF
cIni := StrZero( nIni, 6 )
cFim := StrZero( nFim, 6 )

nPorta := Fopen("SIGFIS", 2 )
if ferror () <> 0
    Alert("SigTron : Problemas de comunicacao.")
    Return
EndIF
Mensagem("Aguarde, Emitindo Relatorio Fiscal")
cString := Chr(27) + Chr(29) + "x" + cIni + cFim
FWrite( nPorta, @cString, Len(cString ))
FClose( nPorta )
ResTela( cScreen )
Return

Function TiraString( cBuffer )

Return( SubStr( cBuffer, 4, 1))

Function Response_Zanthus( nPorta, cBuffer )

FWrite( nPorta, "~6/", 3)
FRead( nPorta, @cBuffer, 134 )
Return( Erro_Zanthus( TiraString( cBuffer )))

Function Erro_Zanthus( nRetorno )

nIniEcf    := oIni:ReadInteger("ecf","modelo", 1 )
IF nIniEcf = 1
    Erro_Iz11( nRetorno )
ElseIF nIniEcf = 2
    Erro_Iz20( nRetorno )
EndIF
Return

Function Erro_Iz20( nRetorno )

LOCAL aResposta := {}
LOCAL nPos         := 0

Aadd( aResposta, { "0", "Sucesso" })
Aadd( aResposta, { "1", "Comando nao pode ser executado no presente estado do Modulo Fiscal" })
Aadd( aResposta, { "2", "Argumento de Entrada sao inconsistente"})
Aadd( aResposta, { "3", "Comando nao executado porque o valor passado e muito elevado"})
Aadd( aResposta, { "4", "Configuracao do Modulo Fiscal nao permite a execucao do comando"})
Aadd( aResposta, { "5", "Memoria Fiscal Esgotada"})
Aadd( aResposta, { "6", "Memoria Fiscal ja inicializada"})
Aadd( aResposta, { "7", "Falha ao inicializar memoria fiscal"})
Aadd( aResposta, { "8", "Memoria Fiscal ja tem numero de serie"})
Aadd( aResposta, { "9", "Memoria Fiscal nao esta inicializada"})
Aadd( aResposta, { ":", "Falha ao gravar na Memoria Fiscal"})
Aadd( aResposta, { ";", "Papel no fim"})
Aadd( aResposta, { "<", "Falha na impressora Fiscal"})
Aadd( aResposta, { "=", "Memoria do Modulo Fiscal Violada"})
Aadd( aResposta, { ">", "Falta Memoria Fiscal"})
Aadd( aResposta, { "?", "Comando Inexistente"})
Aadd( aResposta, { "@", "Deve fazer Reducao"})
Aadd( aResposta, { "A", "Memoria do Modulo Fiscal desprotegida (lacre rompido)"})
Aadd( aResposta, { "B", "Data nao permite operacao"})
Aadd( aResposta, { "C", "Fim de Tabela (de CGC/IE ou de dias)"})
Aadd( aResposta, { "D", "Dados Fixos do Modulo Fiscal estao inconsistentes"})
Aadd( aResposta, { "E", "Falha ao configurar dimensoes de cheque para impressao"})
Aadd( aResposta, { "F", "Falha ao imprimir cheque"})
Aadd( aResposta, { "O", "Indica que a mensagem foi recebida com byte de verificacao incorreto"})
Aadd( aResposta, { "P", "Indica erro nos argumentos passados"})
Aadd( aResposta, { "Q", "Indica erro no numero de controle de passagem"})
Aadd( aResposta, { "R", "Indica que a resposta recebida nao e valida"})
Aadd( aResposta, { "S", "Indica que ultrapassou o maximo de tentativas de comunicacao com a impressora"})
Aadd( aResposta, { "T", "Indica falha na transmissao de dados para a impressora"})
Aadd( aResposta, { "U", "Indica que ultrapassou tempo maximo de espera de uma resposta da impressora"})
Aadd( aResposta, { "V", "Indica que o comando enviado nao foi reconhecido pela impressora"})
Aadd( aResposta, { "W", "Indica que a impressora deve estar desligada"})
Aadd( aResposta, { "X", "Indica que a serial detectou algum erro na recepcao (overrun, framing,etc)"})
Aadd( aResposta, { "Y", "Indica que a resposta recebida esta fora do protocolo"})
Aadd( aResposta, { "Z", "Indica que o comando foi enviado, mas a resposta foi perdida"})
Aadd( aResposta, { "[", "Indica que o comando foi enviado, mas os dados de retorno foram perdidos"})
Aadd( aResposta, { "m", "Indica que o a operacao solicitada nao e permitida no dispositivo ECF controlado"})
Aadd( aResposta, { "v", "Indica que os parametros enviados ao Device Drive estao incompletos"})
Aadd( aResposta, { "w", "Indica que os parametros passados ultrapassaram o tamanho maximo permitido"})
Aadd( aResposta, { "x", "Indica que os dados solicitados ultrapassaram o tamanho maximo permitido"})
Aadd( aResposta, { "y", "Indica que o banco passado como parametro nao esta na faixa de 1 a 999"})
Aadd( aResposta, { "z", "Indica que o banco cujos dados foram solicitados nao esta cadastrado"})

nPos := Ascan2( aResposta, nRetorno, 1 )
IF nPos = 0 .OR. nPos = 1
    Return( .T. )
EndIF
Alerta( aResposta[nPos, 2])
Return( .F. )

Function Erro_Iz11( nRetorno )

LOCAL aResposta := {}
LOCAL nPos         := 0

Aadd( aResposta, { "0", "Sucesso" })
Aadd( aResposta, { "1", "Comando nao pode ser executado no presente estado do Modulo Fiscal" })
Aadd( aResposta, { "2", "Argumento de Entrada sao inconsistente"})
Aadd( aResposta, { "3", "Comando nao executado porque o valor passado e muito elevado"})
Aadd( aResposta, { "4", "Configuracao do Modulo Fiscal nao permite a execucao do comando"})
Aadd( aResposta, { "5", "Memoria Fiscal Esgotada"})
Aadd( aResposta, { "6", "Memoria Fiscal ja inicializada"})
Aadd( aResposta, { "7", "Falha ao inicializar memoria fiscal"})
Aadd( aResposta, { "8", "Memoria Fiscal ja tem numero de fabricacao"})
Aadd( aResposta, { "9", "Memoria Fiscal nao esta inicializada"})
Aadd( aResposta, { "10", "Falha ao gravar na Memoria Fiscal"})
Aadd( aResposta, { "11", "Papel no fim"})
Aadd( aResposta, { "12", "Falha na impressora Fiscal"})
Aadd( aResposta, { "13", "Memoria do Modulo Fiscal Violada"})
Aadd( aResposta, { "14", "Falta Memoria Fiscal"})
Aadd( aResposta, { "15", "Comando Inexistente"})
Aadd( aResposta, { "16", "Deve fazer Reducao"})
Aadd( aResposta, { "17", "Memoria do Modulo Fiscal desprotegida (lacre rompido)"})
Aadd( aResposta, { "18", "Data nao permite operacao"})
Aadd( aResposta, { "19", "Fim de Tabela (de CGC/IE ou de dias)"})
Aadd( aResposta, { "20", "Dados Fixos do Modulo Fiscal estao inconsistentes"})
Aadd( aResposta, { "21", "Falha ao configurar dimensoes de cheque para impressao"})
Aadd( aResposta, { "22", "Falha ao imprimir cheque"})
Aadd( aResposta, { "23", "Falha ao alterar relogio"})
Aadd( aResposta, { "24", "Linha nao pode ser impressa"})
Aadd( aResposta, { "25", "Item ja foi cancelado"})
Aadd( aResposta, { "26", "Item nao tem descritivo armazenado"})
Aadd( aResposta, { "27", "Tempo Excedido"})
Aadd( aResposta, { "28", "Modulo Fiscal sem Forma de Pgto Cadastrado"})
Aadd( aResposta, { "29", "Versao do Modulo Fiscal difere da gaveta"})

Pos := Ascan2( aResposta, nRetorno, 1 )
IF nPos = 0 .OR. nPos = 1
    Return( .T. )
EndIF
Alerta( aResposta[nPos, 2])
Return( .F. )

Proc FiscalRegedit()

LOCAL cScreen    := SaveScreen()
LOCAL aFiscal    := {}
LOCAL oFiscal    := AbreIniFiscal()

Mensagem("Aguarde, Verificando Direitos do Usuario.")
Aadd( aFiscal, { 2.01, oFiscal:ReadBool( "impressorasfiscais", "#2.01", .T. )})
Aadd( aFiscal, { 2.02, oFiscal:ReadBool( "impressorasfiscais", "#2.02", .T. )})
Aadd( aFiscal, { 2.03, oFiscal:ReadBool( "impressorasfiscais", "#2.03", .T. )})
Aadd( aFiscal, { 2.04, oFiscal:ReadBool( "impressorasfiscais", "#2.04", .T. )})
Aadd( aFiscal, { 2.05, oFiscal:ReadBool( "impressorasfiscais", "#2.05", .T. )})
Aadd( aFiscal, { 2.06, oFiscal:ReadBool( "impressorasfiscais", "#2.06", .T. )})
Aadd( aFiscal, { 2.07, oFiscal:ReadBool( "impressorasfiscais", "#2.07", .T. )})
Aadd( aFiscal, { 2.08, oFiscal:ReadBool( "impressorasfiscais", "#2.08", .T. )})
Aadd( aFiscal, { 2.09, oFiscal:ReadBool( "impressorasfiscais", "#2.09", .T. )})
Aadd( aFiscal, { 2.10, oFiscal:ReadBool( "impressorasfiscais", "#2.10", .T. )})
Aadd( aFiscal, { 2.11, oFiscal:ReadBool( "impressorasfiscais", "#2.11", .T. )})
ResTela( cScreen )
Return( aFiscal )

Function AbreIniFiscal()

    Return( oFiscal := TIniNew(oAmbiente:xUsuario + ".INI"))

Function SnFiscal( nChoice )

LOCAL nPos := 0

nPos := Ascan2( oAmbiente:aFiscalIni, nChoice, 1 )
IF nPos = 0
    Return( .F. )
EndIF
Return( oAmbiente:aFiscalIni[nPos, 2])

Proc Reindexar()

LOCAL cScreen := SaveScreen()
LOCAL GetList := {}
LOCAL aMenu   := {"Limpar Marcacao de Arquivos", "Marcar Arquivos para reindexar"}
LOCAL nChoice := 0

WHILE .T.
    oMenu:Limpa()
    M_Title("ESCOLHA SUA OPCAO")
    nChoice := FazMenu( 05, 10, aMenu )
    Do Case
    Case nChoice = 0
        ResTela( cScreen )
        Return
    Case nChoice = 1
        LimparMarcacao()
    Case nChoice = 2
        ReindParcial()
    EndCase
EndDo

Proc LimparMarcacao()

LOCAL cScreen        := SaveScreen()
LOCAL aArquivos    := ArrayArquivos()
LOCAL nTam            := Len( aArquivos )
LOCAL nNx            := 0

Mensagem("Aguarde, Limpando marcacao de Arquivos")
For nX := 1 To nTAm
    oIni:WriteString("indices", aArquivos[nX,1], "1" )
Next
Alerta("Informa: Limpeza efetudada com sucesso.")
ResTela( cScreen )
Return

Proc ReindParcial()

LOCAL cScreen        := SaveScreen()
LOCAL aMenu         := {}
LOCAL aTemp         := {}
LOCAL aDisponivel := {}
LOCAL aEscolhido    := {}
LOCAL aArquivos    := ArrayArquivos()
LOCAL nTam            := 0
LOCAL nNx            := 0
LOCAL nPosicao     := 1
LOCAL nQuant        := 0
LOCAL cBuffer        := ""
LOCAL cUser         := ""
LOCAL cData         := ""
LOCAL cFim            := ""

WHILE .T.
    aEscolhido := {}
    nQuant      := 0
    aTemp       := {}
    nTam          := Len( aArquivos )
    WHILE .T.
        aMenu         := {}
        aDisponivel := {}
        For nX := 1 To nTAm
            lOk    := oIni:ReadString("indices", aArquivos[nX,1], "1", 1 )
            cUser := oIni:ReadString("indices", aArquivos[nX,1], space(10), 2 )
            cData := oIni:ReadString("indices", aArquivos[nX,1], Space(08), 3 )
            cTime := oIni:ReadString("indices", aArquivos[nX,1], Space(08), 4 )
            cFim    := oIni:ReadString("indices", aArquivos[nX,1], Space(08), 5 )
            Aadd( aDisponivel, IF( lOk == "1", .T., .F. ))
            Aadd( aMenu, aArquivos[nX,1] + Space(14-Len(ltrim(rtrim(aArquivos[nX,1])))) + "³" + ltrim(rtrim(cUser)) + Space(10-Len(ltrim(rtrim(cUser)))) + "³" + cData + "³" + cTime  + "³" + cFim )
            Aadd( aTemp, aArquivos[nX,1])
        Next
        oMenu:Limpa()
        MaBox( 02, 09, 21, 66, "ARQUIVO        USUARIO    DATA     INICIO   FIM     " )
        nChoice := Achoice( 03, 10, 20, 65, aMenu, aDisponivel, nPosicao )
        IF nChoice = 0
            Exit
        EndIF
        lOk    := oIni:ReadString("indices", aArquivos[nChoice,1], "1", 1 )
        cUser := oIni:ReadString("indices", aArquivos[nChoice,1], space(10), 2 )
        IF lOk = "0"
            Alerta("Erro: Marcado Por :" + cUser )
            Loop
        EndIF
        cBuffer := "0"
        cBuffer += ";"
        cBuffer += oAmbiente:xUsuario
        cBuffer += ";"
        cBuffer += Dtoc( Date())
        cBuffer += ";"
        cBuffer += "MARCADO "
        oIni:WriteString("indices", aArquivos[nChoice,1], cBuffer )
        Aadd( aEscolhido, ltrim(rtrim(StrTran( aTemp[nChoice],".DBF"))))
        nQuant++
        aMenu[nChoice]          += " û "
        aDisponivel[nChoice]  := .F.
        nPosicao                  := nChoice + 1
    EndDo
    oMenu:Limpa()
    IF nQuant > 0
        nTam := Len( aEscolhido )
        IF Conf("Pergunta: Reindexar arquivos marcados ?")
            FechaTudo()
            For nX := 1 To nTam
                IF !NetUse( aEscolhido[nX], .F. ) ; ResTela( cScreen ); Return(.F.) ; EndIF
                cTime := Time()
                oIni:WriteString("indices", aEscolhido[nX] + ".DBF", cBuffer )
                CriaIndice( aEscolhido[nX] )
                cBuffer    := "0"
                cBuffer += ";"
                cBuffer += oAmbiente:xUsuario
                cBuffer += ";"
                cBuffer += Dtoc( Date())
                cBuffer += ";"
                cBuffer += cTime
                cBuffer += ";"
                cBuffer += Time()
                oIni:WriteString("indices", aEscolhido[nX] + ".DBF", cBuffer )
            Next
        Else
            For nX := 1 To nTam
                oIni:WriteString("indices", aEscolhido[nX] + ".DBF", "1" )
            Next
        EndIF
    Else
        Exit
    EndiF
EndDo
ResTela( cScreen )
Return

Proc Aliquota_Sigtron()

LOCAL cScreen     := SaveScreen()
LOCAL GetList     := {}
LOCAL cAliquota := Space(04)
LOCAL nTipo      := 0
LOCAL nPorta     := 0
LOCAL cBuffer     := ""
LOCAL cRetorno  := ""

oMenu:Limpa()
cAliquota := Space(04)
MaBox( 10, 10, 13, 40 )
SetCursor(1) ; DevPos( 11, 11 ) ; DevOut( "Aliquota..." ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cAliquota, "cAliquota", "9999", {|| IF( Empty( cAliquota ), ( ErrorBeep(), Alerta("Erro: Entrada Invalida"), .F. ), .T. )},))
SetCursor(1) ; DevPos( 12, 11 ) ; DevOut( "Tipo......." ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nTipo, "nTipo", "9", {|| PickTam({"Icms", "Iss"}, {1,2}, @nTipo )},))
ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
IF LastKey() = 27
    ResTela( cScreen )
    Return
EndIF
ErrorBeep()
IF Conf("Pergunta: Registrar Aliquota ?")
    nPorta  := SigtronIniciaDriver(cBuffer)
    cBuffer := Chr(27) + Chr(220)
    IF nTipo = 2
      cBuffer += "S"
    EndIF
    cBuffer += cAliquota
    FWrite( nPorta, @cBuffer, Len( cBuffer ))
    FClose( nPorta )
EndIF
Restela( cScreen )
Return

Proc Aliquota_Bema()

LOCAL cScreen     := SaveScreen()
LOCAL GetList     := {}
LOCAL cAliquota := Space(04)
LOCAL nTipo      := 0
LOCAL nPorta     := 0
LOCAL cBuffer     := ""
LOCAL cIcms      := "0"
LOCAL cIss         := "1"
LOCAL lEcfRede  := oIni:ReadBool("ecf","ecfrede", .F. )
LOCAL Retorno

oMenu:Limpa()
cAliquota := Space(04)
MaBox( 10, 10, 13, 40 )
SetCursor(1) ; DevPos( 11, 11 ) ; DevOut( "Aliquota..." ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cAliquota, "cAliquota", "9999", {|| !Empty( cAliquota )},))
SetCursor(1) ; DevPos( 12, 11 ) ; DevOut( "Tipo......." ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nTipo, "nTipo", "9", {|| PickTam({"Icms", "Iss"}, {1,2}, @nTipo )},))
ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
IF LastKey() = 27
    ResTela( cScreen )
    Return
EndIF
ErrorBeep()
IF Conf("Pergunta: Registrar Aliquota ?")
    nPorta := BemaIniciaDriver()
    IF Ferror () <> 0
        Alerta("Bematech : Problemas de comunicacao.")
        Restela( cScreen )
        Return
    EndIF
   IF lEcfRede
      cBuffer    := "063|" + cAliquota + "|" + IF( nTipo = 1, "0", "1" ) + "|"
   Else
      cBuffer    := Chr(27) + Chr(251) + "07|" + cAliquota + IF( nTipo = 1, cIcms, cIss ) + "|" + Chr(27)
   EndIF
    Fwrite( nPorta, @cBuffer, Len( cBuffer ))
   Comunica_Com_Impressora( nPorta, cBuffer, Retorno )
    FClose( nPorta )
EndIF
Restela( cScreen )
Return

Function Bema_VerAliquota( cAliquota )

    LOCAL aAliquota := {}
    LOCAL cBuffer     := Chr(27) + Chr(251) + "26" + "|" + Chr(27)
    LOCAL cRetorno  := ""
    LOCAL cString     := ""
    LOCAL nX          := 0
    LOCAL nPos         := 0
    LOCAL nPorta     := 0

    nPorta := BemaIniciaDriver()
    IF Ferror () <> 0
        Alerta("BEMATECH: Problemas de comunicacao.")
        ResTela( cScreen )
        Return( .F. )
    EndIF

    cRetorno := Comunica_Com_Impressora( nPorta, cBuffer, 66 )
    FClose( nPorta )
    For nX := 1 To 16
         cString := SubStr( cRetorno,((nX*4)-3)+2,4)
         Aadd( aAliquota, cString )
    Next
    nPos := Ascan( aAliquota, cAliquota )
    IF nPos <> 0
        ErrorBeep()
        IF Conf("Erro : Aliquota ja registrada. Posicao # " + StrZero(nPos, 2) + ". Continuar ?")
            Return( .T. )
        Else
            Return( .F. )
        EndIF
    EndIF
Return( .T. )

Function LigaDisp()

    LOCAL aDisp := {}
    Aadd( aDisp,{ .T.,  .T.,  .T.,  .T.,  .T. ,    .T.,    .T.,    .T.,    .T.,    .T., .T.,  .T.,  .T.,  .T.,  .T.,  .T.,  .T.,  .T., .T., .T.,    .T.,    .T. })
    Aadd( aDisp,{ .T.,  .T.,  .T.,  .T.,  .T. ,    .T.,    .T.,    .T.,    .T.,    .T., .T.,  .T.,  .T.,  .T.,  .T.,  .T.,  .T.,  .T., .T., .T.,    .T.,    .T. })
    Aadd( aDisp,{ .T.,  .T.,  .T.,  .T.,  .T. ,    .T.,    .T.,    .T.,    .T.,    .T., .T.,  .T.,  .T.,  .T.,  .T.,  .T.,  .T.,  .T., .T., .T.,    .T.,    .T. })
    Aadd( aDisp,{ .T.,  .T.,  .T.,  .T.,  .T. ,    .T.,    .T.,    .T.,    .T.,    .T., .T.,  .T.,  .T.,  .T.,  .T.,  .T.,  .T.,  .T., .T., .T.,    .T.,    .T. })
    Aadd( aDisp,{ .T.,  .T.,  .T.,  .T.,  .T. ,    .T.,    .T.,    .T.,    .T.,    .T., .T.,  .T.,  .T.,  .T.,  .T.,  .T.,  .T.,  .T., .T., .T.,    .T.,    .T. })
    Aadd( aDisp,{ .T.,  .T.,  .T.,  .T.,  .T. ,    .T.,    .T.,    .T.,    .T.,    .T., .T.,  .T.,  .T.,  .T.,  .T.,  .T.,  .T.,  .T., .T., .T.,    .T.,    .T. })
    Aadd( aDisp,{ .T.,  .T.,  .T.,  .T.,  .T. ,    .T.,    .T.,    .T.,    .T.,    .T., .T.,  .T.,  .T.,  .T.,  .T.,  .T.,  .T.,  .T., .T., .T.,    .T.,    .T. })
    Aadd( aDisp,{ .T.,  .T.,  .T.,  .T.,  .T. ,    .T.,    .T.,    .T.,    .T.,    .T., .T.,  .T.,  .T.,  .T.,  .T.,  .T.,  .T.,  .T., .T., .T.,    .T.,    .T. })
    Aadd( aDisp,{ .T.,  .T.,  .T.,  .T.,  .T. ,    .T.,    .T.,    .T.,    .T.,    .T., .T.,  .T.,  .T.,  .T.,  .T.,  .T.,  .T.,  .T., .T., .T.,    .T.,    .T. })
    Aadd( aDisp,{ .T.,  .T.,  .T.,  .T.,  .T. ,    .T.,    .T.,    .T.,    .T.,    .T., .T.,  .T.,  .T.,  .T.,  .T.,  .T.,  .T.,  .T., .T., .T.,    .T.,    .T. })
    Aadd( aDisp,{ .T.,  .T.,  .T.,  .T.,  .T. ,    .T.,    .T.,    .T.,    .T.,    .T., .T.,  .T.,  .T.,  .T.,  .T.,  .T.,  .T.,  .T., .T., .T.,    .T.,    .T. })
    Aadd( aDisp,{ .T.,  .T.,  .T.,  .T.,  .T. ,    .T.,    .T.,    .T.,    .T.,    .T., .T.,  .T.,  .T.,  .T.,  .T.,  .T.,  .T.,  .T., .T., .T.,    .T.,    .T. })
    Aadd( aDisp,{ .T.,  .T.,  .T.,  .T.,  .T. ,    .T.,    .T.,    .T.,    .T.,    .T., .T.,  .T.,  .T.,  .T.,  .T.,  .T.,  .T.,  .T., .T., .T.,    .T.,    .T. })
    Aadd( aDisp,{ .T.,  .T.,  .T.,  .T.,  .T. ,    .T.,    .T.,    .T.,    .T.,    .T., .T.,  .T.,  .T.,  .T.,  .T.,  .T.,  .T.,  .T., .T., .T.,    .T.,    .T. })
Return( aDisp )

Proc ConfIniReceber( cNome )

LOCAL cScreen    := SaveScreen()
LOCAL GetList    := {}
LOCAL oRecelan := TIniNew( cNome + ".INI")
LOCAL oConf     := TAmbienteNew()
LOCAL aDisp     := aDispRecelan()
LOCAL nMaior    := 1
LOCAL nMenor    := 1
LOCAL cMaior    := ""
LOCAL cMenor    := ""
LOCAL cRegra    := ""
LOCAL op         := 1

oConf:Disp         := aDisp
oConf:Ativo      := 1
oConf:Menu         := oMenuRecelan()
oConf:NomeFirma := oMenu:NomeFirma
oConf:CodiFirma := oMenu:CodiFirma
oConf:StatusSup := SISTEM_NA3 + " " + SISTEM_VERSAO
oConf:StatusInf := "USE A BARRA DE ESPACO PARA DESABILITAR OPCAO"
oConf:Alterando := .T.
WHILE .T.
    Op := oConf:Show()
    Do Case
    Case Op = 0.0 .OR. Op = 1.01
        ErrorBeep()
        IF Conf("Pergunta: Gravar Alteracoes ?")
            For i := 1 To 7
                For x := 1 To 22
               cMaior  := Strzero(i, 2)
               cMenor  := Strzero(x, 2)
                    cRegra  := "#" + cMaior + "." + cMenor
                    oRecelan:WriteBool("recelan", cRegra, aDisp[i, x])
                Next
            Next
        EndIF
        Return
    OtherWise
        nMenor := Val(Right(Tran( Op, "99.99"),2))
        nMaior := Int( Op )
        aDisp[nMaior,nMenor] := If( aDisp[nMaior][nMenor] = .T., .F., .T. )
    EndCase
EndDo

Proc ConfIniPagar( cNome )

LOCAL cScreen    := SaveScreen()
LOCAL GetList    := {}
LOCAL oPagalan := TIniNew( cNome + ".INI")
LOCAL oConf     := TAmbienteNew()
LOCAL aDisp     := aDispPagaLan()
LOCAL nMaior    := 1
LOCAL nMenor    := 1
LOCAL cMaior    := ""
LOCAL cMenor    := ""
LOCAL cRegra    := ""
LOCAL op         := 1

oConf:Disp         := aDisp
oConf:Ativo      := 1
oConf:Menu         := oMenuPagalan()
oConf:NomeFirma := oMenu:NomeFirma
oConf:CodiFirma := oMenu:CodiFirma
oConf:StatusSup := SISTEM_NA4 + " " + SISTEM_VERSAO
oConf:StatusInf := "USE A BARRA DE ESPACO PARA DESABILITAR OPCAO"
oConf:Alterando := .T.
WHILE .T.
    Op := oConf:Show()
    Do Case
    Case Op = 0.0 .OR. Op = 1.01
        ErrorBeep()
        IF Conf("Pergunta: Gravar Alteracoes ?")
            For i := 1 To 7
                For x := 1 To 22
               cMaior  := StrZero(i,2)
               cMenor  := Strzero(x,2)
                    cRegra  := "#" + cMaior + "." + cMenor
                    oPagalan:WriteBool("pagalan", cRegra, aDisp[i, x])
                Next
            Next
        EndIF
        Return
    OtherWise
        nMenor := Val(Right(Tran( Op, "99.99"),2))
        nMaior := Int( Op )
        aDisp[nMaior,nMenor] := If( aDisp[nMaior][nMenor] = .T., .F., .T. )
    EndCase
EndDo

Proc ConfIniCorrentes( cNome )

LOCAL cScreen    := SaveScreen()
LOCAL GetList    := {}
LOCAL oPagalan := TIniNew( cNome + ".INI")
LOCAL oConf     := TAmbienteNew()
LOCAL aDisp     := aDispChelan()
LOCAL nMaior    := 1
LOCAL nMenor    := 1
LOCAL cMaior    := ""
LOCAL cMenor    := ""
LOCAL cRegra    := ""
LOCAL op         := 1

oConf:Disp         := aDisp
oConf:Ativo      := 1
oConf:Menu         := oMenuChelan()
oConf:NomeFirma := oMenu:NomeFirma
oConf:CodiFirma := oMenu:CodiFirma
oConf:StatusSup := SISTEM_NA5 + " " + SISTEM_VERSAO
oConf:StatusInf := "USE A BARRA DE ESPACO PARA DESABILITAR OPCAO"
oConf:Alterando := .T.
WHILE .T.
    Op := oConf:Show()
    Do Case
    Case Op = 0.0 .OR. Op = 1.01
        ErrorBeep()
        IF Conf("Pergunta: Gravar Alteracoes ?")
            For i := 1 To 8
                For x := 1 To 22
               cMaior  := Strzero(i,2)
               cMenor  := Strzero(x,2)
                    cRegra  := "#" + cMaior + "." + cMenor
                    oPagalan:WriteBool("chelan", cRegra, aDisp[i, x])
                Next
            Next
        EndIF
        Return
    OtherWise
        nMenor := Val(Right(Tran( Op, "99.99"),2))
        nMaior := Int( Op )
        aDisp[nMaior,nMenor] := If( aDisp[nMaior][nMenor] = .T., .F., .T. )
    EndCase
EndDo

Proc ConfIniProducao( cNome )

LOCAL cScreen    := SaveScreen()
LOCAL GetList    := {}
LOCAL oScpLan    := TIniNew( cNome + ".INI")
LOCAL oConf     := TAmbienteNew()
LOCAL aDisp     := aDispScpLan()
LOCAL nMaior    := 1
LOCAL nMenor    := 1
LOCAL cMaior    := ""
LOCAL cMenor    := ""
LOCAL cRegra    := ""
LOCAL op         := 1

oConf:Disp         := aDisp
oConf:Ativo      := 1
oConf:Menu         := oMenuScpLan()
oConf:NomeFirma := oMenu:NomeFirma
oConf:CodiFirma := oMenu:CodiFirma
oConf:StatusSup := SISTEM_NA7 + " " + SISTEM_VERSAO
oConf:StatusInf := "USE A BARRA DE ESPACO PARA DESABILITAR OPCAO"
oConf:Alterando := .T.
WHILE .T.
    Op := oConf:Show()
    Do Case
    Case Op = 0.0 .OR. Op = 1.01
        ErrorBeep()
        IF Conf("Pergunta: Gravar Alteracoes ?")
            For i := 1 To 9
                For x := 1 To 22
               cMaior  := Strzero(i,2)
               cMenor  := Strzero(x,2)
                    cRegra  := "#" + cMaior + "." + cMenor
                    oScpLan:WriteBool("scplan", cRegra, aDisp[i, x])
                Next
            Next
        EndIF
        Return
    OtherWise
        nMenor := Val(Right(Tran( Op, "99.99"),2))
        nMaior := Int( Op )
        aDisp[nMaior,nMenor] := If( aDisp[nMaior][nMenor] = .T., .F., .T. )
    EndCase
EndDo

Proc ConfIniEstoque( cNome )

LOCAL cScreen     := SaveScreen()
LOCAL GetList     := {}
LOCAL oTestelan := TIniNew( cNome + ".INI")
LOCAL oConf      := TAmbienteNew()
LOCAL aDisp      := aDispTestelan()
LOCAL nMaior     := 1
LOCAL nMenor     := 1
LOCAL cMaior     := ""
LOCAL cMenor     := ""
LOCAL cRegra     := ""
LOCAL op          := 1

oConf:Disp         := aDisp
oConf:Ativo      := 1
oConf:Menu         := oMenuTestelan()
oConf:NomeFirma := oMenu:NomeFirma
oConf:CodiFirma := oMenu:CodiFirma
oConf:StatusSup := SISTEM_NA2 + " " + SISTEM_VERSAO
oConf:StatusInf := "USE A BARRA DE ESPACO PARA DESABILITAR OPCAO"
oConf:Alterando := .T.
WHILE .T.
    Op := oConf:Show()
    Do Case
    Case Op = 0.0 .OR. Op = 1.01
        ErrorBeep()
        IF Conf("Pergunta: Gravar Alteracoes ?")
            For i := 1 To 8
                For x := 1 To 22
               cMaior  := StrZero(i,2)
               cMenor  := Strzero(x,2)
                    cRegra  := "#" + cMaior + "." + cMenor
                    oTestelan:WriteBool( "testelan", cRegra, aDisp[i, x])
                Next
            Next
        EndIF
        Return
    OtherWise
        nMenor := Val(Right(Tran( Op, "99.99"),2))
        nMaior := Int( Op )
        aDisp[nMaior,nMenor] := If( aDisp[nMaior][nMenor] = .T., .F., .T. )
    EndCase
EndDo

Proc ConfIniSci( cNome )

LOCAL cScreen     := SaveScreen()
LOCAL GetList     := {}
LOCAL oConf      := TAmbienteNew()
LOCAL aDisp      := aDispSci()
LOCAL nMaior     := 1
LOCAL nMenor     := 1
LOCAL cMaior     := ""
LOCAL cMenor     := ""
LOCAL cRegra     := ""
LOCAL op          := 1

oSci                 := TIniNew( cNome + ".INI")
oConf:Disp         := aDisp
oConf:Ativo      := 1
oConf:Menu         := oSciMenuSci()
oConf:NomeFirma := oMenu:NomeFirma
oConf:CodiFirma := oMenu:CodiFirma
oConf:StatusSup := SISTEM_NA1 + " " + SISTEM_VERSAO
oConf:StatusInf := "USE A BARRA DE ESPACO PARA DESABILITAR OPCAO"
oConf:Alterando := .T.
WHILE .T.
    Op := oConf:Show()
    Do Case
    Case Op = 0.0 .OR. Op = 1.01
        ErrorBeep()
        IF Conf("Pergunta: Gravar Alteracoes ?")
            For i := 1 To 10
                For x := 1 To 22
               cMaior  := Strzero(i,2)
               cMenor  := Strzero(x,2)
                    cRegra  := "#" + cMaior + "." + cMenor
                    oSci:WriteBool( "sci", cRegra, aDisp[i, x])
                Next
            Next
        EndIF
        Return
    OtherWise
        nMenor := Val(Right(Tran( Op, "99.99"),2))
        nMaior := Int( Op )
        aDisp[nMaior,nMenor] := If( aDisp[nMaior][nMenor] = .T., .F., .T. )
    EndCase
EndDo

Function oSciMenuSci()

LOCAL AtPrompt := {}
LOCAL cStr_Get
LOCAL cStr_Sombra

IF oAmbiente:Get_Ativo
    cStr_Get := "Desativar Get Tela Cheia"
Else
    cStr_Get := "Ativar Get Tela Cheia"
EndIF
IF oMenu:Sombra
    cStr_Sombra := "DesLigar Sombra"
Else
    cStr_Sombra := "Ligar Sombra"
EndIF
AADD( AtPrompt, {"E^ncerrar",    {"E^ncerrar Execucao do SCI","","T^rocar de Empresa","Trocar de U^suario","","C^opia de Seguranca","R^estaurar Copia de Seguranca"}})
AADD( AtPrompt, {"M^odulos",     {"Controle de E^stoque","Contas a R^eceber","Contas a P^agar","Contas C^orrentes","Controle de P^roducao","Controle de P^onto","Mala D^ireta","V^endedores"}})
AADD( AtPrompt, {"V^endas",      {"Terminal PDV","Terminal Consulta de Precos","Relatorio Vendas *","Relatorio Receber *","Relatorio Recebido *","Cadastra Senha Caixa","","Resumo Caixa Individual", "Detalhe Caixa Individual","Detalhe Diario Caixa Geral *","Detalhe Emissao Recibos em Carteira","Detalhe Emissao Recibos Banco", "Detalhe Emissao Recibos Outros","","Rol Debito C/C Cliente","Reajuste Debito C/C Cliente","Consulta Debito C/C","Baixar Debito C/C","","Comandos de Impressora Fiscal"}})
AADD( AtPrompt, {"B^ackup",      {"Copia de Seguranca","Restaurar Copia de Seguranca","Gerar Arquivo Batch de Copia Seguranca","", "Reindexar Normal", "Reindexar Verificando Duplicidade","Reindexar Parcialmente", "Eliminar Arquivos Temporarios"}})
AADD( AtPrompt, {"E^ditor",      {"Editar Arquivo","Imprimir Arquivo", "Teste Reindexar Thread"}})
AADD( AtPrompt, {"A^mbiente",    {"Spooler de Impressao","Layout Janela","", "Cor Pano de Fundo","Cor de Menu","Cor Cabecalho","Cor Alerta","Cor Borda","Cor Item Desativado","Cor Box Mensagem", "Cor Light Bar", "Cor HotKey", "Cor LightBar HotKey","", "Pano de Fundo","Frame", cStr_Sombra, cStr_Get, "Alterar Senha"}})

AADD( AtPrompt, {"ArQ^uivos",    {"Manutencao Diretorios","Arquivos da Base de Dados","","Reindexar Normal","Reindexar Verificando Duplicidade","","Eliminar Arquivos Temporarios","Cadastra e Altera Usuario","Configuracao de Base Dados","Retorno Acesso","Separar Movimento Anual","Caixa Automatico","Zerar Movimento de Conta","Cadastrar Impressora","Alterar Impressora", "Renovar Codigo de Acesso"}})
AADD( AtPrompt, {"R^econstruir ", {"Base de Dados", "Arquivo Nota", "Arquivo Printer", "Arquivo EntNota","Arquivo Prevenda"}})
AADD( AtPrompt, {"S^hell",       {"Shell         ALT D","Comandos DOS  ALT X"}})
AADD( AtPrompt, {"H^elp",        {"Sobre o Sistema","Ultimas Alteracoes","Help"}})
Return( AtPrompt )


Proc ConfIniVendedores( cNome )

LOCAL cScreen    := SaveScreen()
LOCAL GetList    := {}
LOCAL oVenlan    := TIniNew( cNome + ".INI")
LOCAL oConf     := TAmbienteNew()
LOCAL aDisp     := aDispVenLan()
LOCAL nMaior    := 1
LOCAL nMenor    := 1
LOCAL cMaior    := ""
LOCAL cMenor    := ""
LOCAL cRegra    := ""
LOCAL op         := 1

oConf:Disp         := aDisp
oConf:Ativo      := 1
oConf:Menu         := oMenuVenlan()
oConf:NomeFirma := oMenu:NomeFirma
oConf:CodiFirma := oMenu:CodiFirma
oConf:StatusSup := SISTEM_NA6 + " " + SISTEM_VERSAO
oConf:StatusInf := "USE A BARRA DE ESPACO PARA DESABILITAR OPCAO"
WHILE .T.
    Op := oConf:Show()
    Do Case
    Case Op = 0.0 .OR. Op = 1.01
        ErrorBeep()
        IF Conf("Pergunta: Gravar Alteracoes ?")
            For i := 1 To 7
                For x := 1 To 22
               cMaior  := Strzero(i,2)
               cMenor  := Strzero(x,2)
                    cRegra  := "#" + cMaior + "." + cMenor
                    oVenlan:WriteBool( "venlan", cRegra, aDisp[i, x])
                Next
            Next
        EndIF
        Return
    OtherWise
        nMenor := Val(Right(Tran( Op, "99.99"),2))
        nMaior := Int( Op )
        aDisp[nMaior,nMenor] := If( aDisp[nMaior][nMenor] = .T., .F., .T. )
    EndCase
EndDo

Proc ConfImpressao()

LOCAL cScreen        := SaveScreen()
LOCAL GetList        := {}
LOCAL cPath         := FCurdir()
LOCAL cPro
LOCAL cDup
LOCAL cCob
LOCAL cDiv
LOCAL cNff

LETO_SET( 7, ( oAmbiente:xBase ) )
WHILE .T.
    oMenu:Limpa()
    cPro := oIni:ReadString("impressao","pro", "NOTA.PRO")    ; cPro += Space(38 - Len(cPro))
    cDup := oIni:ReadString("impressao","dup", "DUP.DUP")     ; cDup += Space(38 - Len(cDup))
    cCob := oIni:ReadString("impressao","cob", "BOLETO.COB")  ; cCob += Space(38 - Len(cCob))
    cDiv := oIni:ReadString("impressao","div", "DIVERSO.DIV") ; cDiv += Space(38 - Len(cDiv))
    cNff := oIni:ReadString("impressao","nff", "NOTA.NFF")    ; cNff += Space(38 - Len(cNff))

    oMenu:MaBox( 01, 01, 07, 78, "CONFIGURACAO - ARQUIVOS DE IMPRESSAO")
    SetCursor(1) ; DevPos( 02, 02 ) ; DevOut( "Arquivo Padrao Nota Promissoria....: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cPro, "cPro", "@!", {|| PickArquivo( @cPro, "*.PRO" )},))
    SetCursor(1) ; DevPos( Row()+1, 02 ) ; DevOut( "Arquivo Padrao Duplicata Mercantil.: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cDup, "cDup", "@!", {|| PickArquivo( @cDup, "*.DUP" )},))
    SetCursor(1) ; DevPos( Row()+1, 02 ) ; DevOut( "Arquivo Padrao Boleto Bancario.....: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCob, "cCob", "@!", {|| PickArquivo( @cCob, "*.COB" )},))
    SetCursor(1) ; DevPos( Row()+1, 02 ) ; DevOut( "Arquivo Padrao Documentos Diversos.: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cDiv, "cDiv", "@!", {|| PickArquivo( @cDiv, "*.DIV" )},))
    SetCursor(1) ; DevPos( Row()+1, 02 ) ; DevOut( "Arquivo Padrao Nota Fiscal.........: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cNff, "cNff", "@!", {|| PickArquivo( @cNff, "*.NFF" )},))
    ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
    IF LastKey() = 27
        LETO_SET( 7, ( cPath ) )
        ResTela( cScreen )
        Exit
    EndIF
    ErrorBeep()
    IF Conf("Pergunta: Confirma ?")
        oIni:WriteString("impressao", "pro", ltrim(rtrim(cPro)))
        oIni:WriteString("impressao", "dup", ltrim(rtrim(cDup)))
        oIni:WriteString("impressao", "cob", ltrim(rtrim(cCob)))
        oIni:WriteString("impressao", "div", ltrim(rtrim(cDiv)))
        oIni:WriteString("impressao", "nff", ltrim(rtrim(cNff)))
    EndIF
EndDo

Function PickArquivo( cFile, cCuringa, lNovo )

    LOCAL cScreen := SaveScreen()
    LOCAL aProc   := {}
    LOCAL nPos      := 0

    Aadd( aProc, {"*.PRO",  {||GravaPromissoria()}})
    Aadd( aProc, {"*.DUP",  {||GravaDuplicata()}})
    Aadd( aProc, {"*.COB",  {||GravaBoleto()}})
    Aadd( aProc, {"*.DIV",  {||GravaDiversos()}})
    Aadd( aProc, {"*.NFF",  {||GravaNota()}})

    FT_ChDir( oAmbiente:xBaseDoc )
    LETO_SET( 7, ( oAmbiente:xBaseDoc ) )
    IF !File( cCuringa )
        nPos := Ascan( aProc, {| oBloco | oBloco[1] = cCuringa })
        IF nPos <> 0
            Eval( aProc[ nPos, 2 ] )
        EndIF
    EndIF
    IF !File( ltrim(rtrim(cFile)))
        IF lNovo <> NIL
            ErrorBeep()
            IF Conf("Pergunta: Arquivo digitado inexistente. Criar ?")
                FT_ChDir( oAmbiente:xBaseDados )
                LETO_SET( 7, ( oAmbiente:xBaseDados ) )
                Return( .T. )
            EndIF
        EndIF
        M_Title("ESCOLHA O ARQUIVO DE CONFIGURACAO")
        cFile := Mx_PopFile( 08, 01, 20, 78, cCuringa, Cor() )
    EndIF
    FT_ChDir( oAmbiente:xBaseDados )
    LETO_SET( 7, ( oAmbiente:xBaseDados ) )
    ResTela( cScreen )
Return( .T. )

Proc ConfIniPonto( cNome )

    LOCAL cScreen     := SaveScreen()
    LOCAL GetList     := {}
    LOCAL oPontoLan := TIniNew( cNome + ".INI")
    LOCAL oConf      := TAmbienteNew()
    LOCAL aDisp      := aDispPontoLan()
    LOCAL nMaior     := 1
    LOCAL nMenor     := 1
    LOCAL cMaior     := ""
    LOCAL cMenor     := ""
    LOCAL cRegra     := ""
    LOCAL op          := 1
    LOCAL nMenuH     := 7
    LOCAL aMenuV     := {01,03,03,02,02,02,01}

    oConf:Ativo      := 1
    oConf:Menu         := oMenuPontoLan()
    oConf:Disp         := aDisp
    oConf:NomeFirma := oMenu:NomeFirma
    oConf:CodiFirma := oMenu:CodiFirma
    oConf:StatusSup := SISTEM_NA8 + " " + SISTEM_VERSAO
    oConf:StatusInf := "USE A BARRA DE ESPACO PARA DESABILITAR OPCAO"
    oConf:Alterando := .T.
    WHILE .T.
        Op := oConf:Show()
        Do Case
        Case Op = 0.0 .OR. Op = 1.01
            ErrorBeep()
            IF Conf("Pergunta: Gravar Alteracoes ?")
                For i := 1 To nMenuH
                    For x := 1 To aMenuV[i]
                        cMaior  := Strzero(i,2)
                        cMenor  := Strzero(x,2)
                        cRegra  := "#" + cMaior + "." + cMenor
                        oPontoLan:WriteBool("pontolan", cRegra, aDisp[i, x])
                    Next
                Next
            EndIF
            Return
        OtherWise
            nMenor := Val(Right(Tran( Op, "99.99"),2))
            nMaior := Int( Op )
            aDisp[nMaior,nMenor] := If( aDisp[nMaior][nMenor] = .T., .F., .T. )
        EndCase
    EndDo

Function aDispSci()

    LOCAL AtPrompt := oSciMenuSci()
    LOCAL nMenuH   := Len(AtPrompt)
    LOCAL aDisp    := Array(nMenuH, 22 )
    LOCAL aMenuV   := {}
            oSci     := TIniNew(oAmbiente:xUsuario + ".INI")

    Mensagem("Aguarde, Verificando Diretivas do Sistema DO MENU PRINCIPAL.")
    aDisp := ReadIni("sci", nMenuH, aMenuV, AtPrompt, aDisp, oSci)

    IF !aPermissao[1]
        aDisp[02,01] := .F.
    EndIF

    IF !aPermissao[2]
        aDisp[02,02] := .F.
    EndIF
    IF !aPermissao[3]
        aDisp[02,03] := .F.
    EndIF
    IF !aPermissao[4]
        aDisp[02,04] := .F.
    EndIF
    IF !aPermissao[8]
        aDisp[02,05] := .F.
    EndIF
    IF !aPermissao[5]
        aDisp[02,08] := .F.
    EndIF
    IF !aPermissao[6]
        aDisp[03,01] := .F.
    EndIF
    IF !aPermissao[7]
        aDisp[07,08] := .F.
    EndIF
    IF !oAmbiente:lGreenCard
        aDisp[02,05] := .F.
        aDisp[01,07] := .F.
        aDisp[04,02] := .F.
        aDisp[04,06] := .F.
        aDisp[07,01] := .F.
        aDisp[07,02] := .F.
        aDisp[07,05] := .F.
        aDisp[08,01] := .F.
        aDisp[09,01] := .F.
    EndIF
Return( aDisp )

Function ReadIni( cSistema, nMenuH, aMenuV, AtPrompt, aDisp, xIni)

    LOCAL cMaior
    LOCAL cMenor
    LOCAL cRegra
    LOCAL i
    LOCAL x

    For y := 1 To nMenuH
        Aadd(aMenuV, Len(AtPrompt[y][2]))
    Next

    For i := 1 To nMenuH
        For x := 1 To aMenuV[i]
            cMaior     := Strzero(i,2)
            cMenor     := Strzero(x,2)
            cRegra      := "#" + cMaior + "." + cMenor
            aDisp[i,x] := xIni:ReadBool(cSistema, cRegra, .T.)
        Next
    Next
Return( aDisp )

function RealClock( nRow, nCol, nCor)

    LOCAL pRow      := Row()
    LOCAL    pCol      := Col()
    LOCAL Color_Ant := SetColor()
    IF nRow == NIL ; nRow := 00 ; END
    IF nCol == NIL ; nCol := MaxCol()-16 ; END
    IF nCor == NIL ; nCor := oMenu:CorCabec ; END

   while .T.
        pRow := Row()
        pCol := Col()
        print( nRow, nCol, Dtoc(Date()) + " " + (oAmbiente:Clock := Time()), nCor)
        DevPos( pRow, pCol)
      hb_idleSleep( 1 )
   end
    SetColor( Color_Ant)
    DevPos( pRow, pCol)
    return Dtoc(Date()) + " " + (oAmbiente:Clock := Time())

function LogoTipo( aEnde_String )

LOCAL nMaxRow      := MaxRow()
LOCAL aNormal         := Array(11)
LOCAL aEncrypt     := Array(11)
LOCAL aEndeNormal  := Array(4)
LOCAL aEndeEncrypt := Array(4)
LOCAL nHandle
LOCAL nX

nHandle := Fopen("SCI.CFG")
if Ferror() <> 0
    FClose( nHandle )
    SetColor("")
    Scroll() ; SetPos( 0, 0 )
    Alert( "Erro #3: Erro de Abertura do Arquivo SCI.CFG.")
    __Quit()
EndIF

nErro := FLocate( nHandle, "[ENDERECO_STRING]")
IF nErro < 0
    SetColor("")
    Scroll() ; SetPos( 0, 0 )
    Alert( "Erro #4: Configuracao de SCI.CFG nao localizada. [ENDERECO_STRING]")
    __Quit()
EndIF
FAdvance( nHandle )
For nX := 1 To 4
    aEndeNormal[nX] := FReadLine( nHandle )
    FAdvance( nHandle )
Next
nErro       := FLocate( nHandle, "[ENDERECO_CODIGO]")
IF nErro < 0
    SetColor("")
    Scroll() ; SetPos( 0, 0 )
    Alert( "Erro #4: Configuracao de SCI.CFG nao localizada. [ENDERECO_CODIGO]")
    __Quit()
EndIF
FAdvance( nHandle )
For nX := 1 To 4
    aEndeEncrypt[nX] := MsDecrypt( FReadLine( nHandle ))
    IF aEndeNormal[nX] <> aEndeEncrypt[nX]
        SetColor("")
        Scroll() ; SetPos( 0, 0 )
        Alert( "Erro #5: Configuracao de SCI.CFG alterada. [ENDERECO_CODIGO]")
        __Quit()
    EndIF
    FAdvance( nHandle )
Next
nErro := FLocate( nHandle, "[SCI_STRING]")
IF nErro < 0
    SetColor("")
    Scroll() ; SetPos( 0, 0 )
    Alert( "Erro #4: Configuracao de SCI.CFG nao localizada. [SCI_STRING]")
    __Quit()
EndIF
FAdvance( nHandle )
For nX := 1 To 11
    aNormal[nX] := FReadLine( nHandle )
    FAdvance( nHandle )
Next
nErro       := FLocate( nHandle, "[SCI_CODIGO]")
IF nErro < 0
    SetColor("")
    Scroll() ; SetPos( 0, 0 )
    Alert( "Erro #4: Configuracao de SCI.CFG nao localizada. [SCI_CODIGO]")
    __Quit()
EndIF
FAdvance( nHandle )
For nX := 1 To 11
    aEncrypt[nX] := MsDecrypt( FReadLine( nHandle ))
    IF aNormal[nX] <> aEncrypt[nX]
        SetColor("")
        Scroll() ; SetPos( 0, 0 )
        Alert( "Erro #5: Configuracao de SCI.CFG alterada. [SCI_CODIGO]")
        __Quit()
    EndIF
    FAdvance( nHandle )
Next
FClose( nHandle )
IF !oAmbiente:Visual
    SetColor("")
    Scroll() ; SetPos( 0, 0 )
    MsBox( 00, 00, 05, MaxCol()-2, 9, .T. )
    For nX := 1 To 4
        WriteBox( nX, 10, aEndeNormal[nX] )
    Next
    SetColor("")













    For nX := 1 To 11
        Write( (nMaxRow/2)-7+nX, 00, aEncrypt[nX] )
    Next

    SetColor("")
    For nY := 6 To nMaxRow-9
        SetColor( AttrToa( nY ))
        Write( nY, 25, XNOMEFIR, nY )

    Next
    SetColor("")

    MsBox( nMaxRow-8, 00, nMaxRow-3, MaxCol()-2, 9, .F. )
    WriteBox( nMaxRow-7, 10, "Esta ‚ uma licen‡a de uso individual e  intransfer¡vel" )
    WriteBox( nMaxRow-6, 10, "para o usuario acima. C¢pia ilegais e n„o  autorizadas" )
    WriteBox( nMaxRow-5, 10, "‚ crime de PIRATARIA o qual ser„o processadas a m xima" )
    WriteBox( nMaxRow-4, 10, "extˆns„o da LEI.")
    SetColor("R")
    Write( nMaxRow-2,00, "TECLE ALGO PARA INICIARÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ")
    Inkey(2)
    ScrollEsq()
ELSE
    SetColor("")
    Scroll() ; SetPos( 0, 0 )
    SetColor("N/W")
    Scroll( 01, 02, 23, MaxCol()-2 ) ; SetPos( 01, 02 )
    DeskBox( 00, 01, 24, MaxCol()-2, 2 )
    DeskBox( 01, 06, 23, MaxCol()-6, 1 )
    Frame( 02, 10, 06, MaxCol()-10, Nil, Nil, 2 )
    Frame( 07, 10, 19, MaxCol()-10, Nil, Nil, 2 )
    SetColor("R/W")
    Write( 03, 12, Padc( aEnde_String[1], MaxCol()-22 ))
    Write( 04, 12, Padc( aEnde_String[2], MaxCol()-22 ))
    Write( 05, 12, Padc( aEnde_String[3], MaxCol()-22 ))

    SetColor("B/W")
    For nX := 1 To 11
        Write( 07+nX, 12, aNormal[nX] )
    Next
    cString := Left( XNOMEFIR, 30 )
    SetColor("G/W")
    Write( 08, 38, cString )
    SetColor("R/W")
    Write( 09, 38, cString )
    SetColor("N/W")
    Write( 10, 38, cString )
    SetColor("B/W")
    Write( 11, 38, cString )
    SetColor("BG/W")
    Write( 12, 38, cString )
    SetColor("RB/W")
    Write( 13, 38, cString )
    SetColor("GR+/W")
    Write( 14, 38, cString )
    SetColor("G+/W")
    Write( 15, 38, cString )
    SetColor("R+/W")
    Write( 16, 38, cString )
    SetColor("N+/W")
    Write( 17, 38, cString )
    SetColor("GR/W")
    Write( 18, 38, cString )
    LinButton1( .T., 01, 21, "&Iniciar", NIL )
EndIF
Return

function Info(nRow, lInkey)

    LOCAL cScreen      := SaveScreen( )
    LOCAL Drive       := Curdrive()
    LOCAL cDiretorio := FCurdir()
    LOCAL nMaxRow      := MaxRow()
    LOCAL nMaxCol      := MaxCol()-3
    LOCAL cSistema   := StrTran( SISTEM_NA1 + SISTEM_VERSAO, "MENU PRINCIPAL-","")
    LOCAL nRamLivre  := Memory(0)
    LOCAL nColor
    LOCAL Handle
    LOCAL xMicrobras
    LOCAL xEndereco
    LOCAL xTelefone
    LOCAL xCidade

    if( nRow = NIL, nRow := 2, nRow )
    FT_ChDir( oAmbiente:xBase )
    Handle := Fopen("SCI.CFG")
    IF ( Ferror() <> 0 )
        FClose( Handle )
        SetColor("")
        Scroll() ; SetPos( 0, 0 )
        Alert( "Erro #3: Erro de Abertura do Arquivo SCI.CFG.")
        ResTela( cScreen )
        Return
    EndIF
    nErro := FLocate( Handle, "[ENDERECO_STRING]")
    IF nErro < 0
        FClose( Handle )
        SetColor("")
        Scroll() ; SetPos( 0, 0 )
        Alert( "Erro #4: Configuracao de SCI.CFG alterada. [ENDERECO_STRING]")
        ResTela( cScreen )
        Return
    EndIF
    FAdvance( Handle )
    xMicrobras := ltrim(rtrim(FReadLine( Handle )))
    FAdvance( Handle )
    xEndereco  := ltrim(rtrim(FReadLine( Handle )))
    FAdvance( Handle )
    xTelefone  := ltrim(rtrim(FReadLine( Handle )))
    FAdvance( Handle )
    xCidade      := ltrim(rtrim(FReadLine( Handle )))
    FClose( Handle )
    CenturyOn()

    oAmbiente:xProgramador := xMicrobras
    nRow                   := (nMaxRow-20)/2
    nSetColor( oMenu:CorMenu )

    IF oAmbiente:Visual
        SetColor("N/W")
        Scroll() ; SetPos( 0, 0 )
        DeskBox( nRow-01, 01, nRow+24, MaxCol()-1, 2 )
        DeskBox( nRow,     02, nRow+23, MaxCol()-2, 1 )
        SetColor("B/W")
        Print( nRow+01, 03, Padc( cSistema, MaxCol()-7 ))
        SetColor("G/W")
        Print( nRow+02, 03, Padc( xMicrobras, MaxCol()-7 ) )
        SetColor("GR+/W")
        Print( nRow+03, 03, Padc( xEndereco + " - " + xTelefone, MaxCol()-7 ))
        SetColor("R/W")
        Print( nRow+04, 03, Padc( xCidade, MaxCol()-7 ))
    Else
        MaBox( nRow,     02, nRow+24, (nMaxCol+1))
        Print( nRow+01, 03, "") ; printf(Padc(cSistema,   nMaxCol-2), AscanCor(11))
        Print( nRow+02, 03, "") ; printf(Padc(xMicrobras, nMaxCol-2), AscanCor(13))
        Print( nRow+03, 03, "") ; printf(Padc(xEndereco,  nMaxCol-2), AscanCor(10))
        Print( nRow+04, 03, "") ; printf(Padc(xTelefone,  nMaxCol-2), AscanCor(12))
    EndIF

    aHost := GetIp()
    Print( nRow+06, 03, "S. Operacional : ") ; printf(Os(), AscanCor(15))
    Print( nRow+07, 03, "  Data Sistema : ") ; printf(Date(), AscanCor(11))
    Print( nRow+08, 03, "Drive Corrente : ") ; printf(ltrim(rtrim(Drive)), AscanCor(11))
    Print( nRow+09, 03, "  Espa‡o Total : ") ; printf(ltrim(rtrim(Tran( FT_DskSize(Drive)/1024/1024/1024, "999,999"))), AscanCor(12)) ; printf( " GB", AscanCor(11))
    Print( nRow+10, 03, "   Mem¢ria RAM : ") ; printf(hb_ntos(Memory(1 )/1024/1024), AscanCor(12)) ; printf( " GB", AscanCor(11))
    Print( nRow+11, 03, "   Mem Virtual : ") ; printf(hb_ntos(Memory(3)/1024/1024),     AscanCor(12)) ; printf( " MB", AscanCor(11))
    Print( nRow+12, 03, "  Max Used Mem : ") ; printf(hb_ntos(Memory(1002)/1024),     AscanCor(12)) ; printf( " KB", AscanCor(11))
    Print( nRow+13, 03, "  Arqs Abertos : ")
    Print( nRow+14, 03, "      Ano 2000 : ") ; printf(IF( oAmbiente:Ano2000, "Habilitado", "Desabilitado"), AscanCor(IF( oAmbiente:Ano2000,   11,13)))
    Print( nRow+15, 03, "    Base Dados : ") ; printf(IF( oProtege:Protegido,"Protegida",  "DesProtegida"), AscanCor(IF( oProtege:Protegido, 11,13)))

    Print( nRow+17, 03, "Versao Harbour : ") ; printf(hb_Version(0 ), AscanCor(12))
    Print( nRow+18, 03, "  Compiler C++ : ") ; printf(hb_Version(1), AscanCor(12))
    Print( nRow+19, 03, "   Versao Leto : ") ; printf(LETO_GETSERVERVERSION(), AscanCor(12))
    Print( nRow+20, 03, "       Leto IP : ") ; printf(LETO_GETCURRENTCONNECTION(), AscanCor(12))
    Print( nRow+21, 03, "      IP Local : ") ; printf(StrGetIp(), AscanCor(12))

    Print( nRow+06, ((nMaxCol/2)-2), "   Nome Esta‡„o : ") ; printf(ltrim(rtrim(Left(NetName(),20))), AscanCor(15))
    Print( nRow+07, ((nMaxCol/2)-2), "  Horas Sistema : " + Time())
    Print( nRow+08, ((nMaxCol/2)-2), "      Diret¢rio : " + ltrim(rtrim(FCurdir())))
    Print( nRow+09, ((nMaxCol/2)-2), "  Espa‡o Livre  : ") ; printf(ltrim(rtrim(Tran(DiskSpace(Drive)/1024/1024/1024, "999,999"))), AscanCor(12)) ; printf( " GB", AscanCor(11))
    Print( nRow+10, ((nMaxCol/2)-2), "  Mem RAM Livre : " + ltrim(rtrim(Str(nRamLivre/1024/1024) + " GB")))
    IF nRamLivre < 100
    Print( nRow+10, ((nMaxCol/2)-2), "  Mem RAM Livre : " + ltrim(rtrim(Str(nRamLivre/1024/1024) + " GB")), Roloc(Cor()))
    EndIF
    Print( nRow+11, ((nMaxCol/2)-2), "  Memoria usada : " + hb_ntos(Memory(1001)/1024) + " KB")
    Print( nRow+12, ((nMaxCol/2)-2), "  Path Corrente : " + ltrim(rtrim(oAmbiente:xBase)))
    Print( nRow+13, ((nMaxCol/2)-2), "  Limite Acesso : ") ; printf( oAmbiente:xDataCodigo, AscanCor(13))
    Print( nRow+14, ((nMaxCol/2)-2), "   MultiUsuario : ") ; printf(IF( .T., "Habilitado", "Desabilitado"), AscanCor(IF( .T., 11,13)))



    IF oAmbiente:Visual
      Print( nRow+22, 03, Padc( "Software Li‡enciado para", nMaxCol-7), AscanCor(11))
      Print( nRow+23, 03, Padc( XNOMEFIR, nMaxCol-7 ), AscanCor(13))
    Else
      Print( nRow+22, 03, Padc( "Software Li‡enciado para" , nMaxCol-2), AscanCor(11))
      Print( nRow+23, 03, Padc( XNOMEFIR, nMaxCol-2 ), AscanCor(13))
    EndIF

    Print( ++nRow, (nMaxCol-30), "< Memoria >", AscanCor(12))
    Print( ++nRow, (nMaxCol-30), "  MEM_CHAR       : " + hb_ntos(Memory(0       )/1024) + " KB")
    Print( ++nRow, (nMaxCol-30), "  MEM_BLOCK      : " + hb_ntos(Memory(1      )/1024) + " KB")
    Print( ++nRow, (nMaxCol-30), "  MEM_RUN        : " + hb_ntos(Memory(2        )/1024) + " KB")
    ++nRow
    Print( ++nRow, (nMaxCol-30), "  MEM_VM         : " + hb_ntos(Memory(3         )/1024/1024) + " MB")
    Print( ++nRow, (nMaxCol-30), "  MEM_EMS        : " + hb_ntos(Memory(4        )/1024) + " KB")
    Print( ++nRow, (nMaxCol-30), "  MEM_FM         : " + hb_ntos(Memory(101         )/1024) + " KB")
    Print( ++nRow, (nMaxCol-30), "  MEM_FMSEGS     : " + hb_ntos(Memory(102     )/1024) + " KB")
    Print( ++nRow, (nMaxCol-30), "  MEM_SWAP       : " + hb_ntos(Memory(103       )/1024) + " KB")
    Print( ++nRow, (nMaxCol-30), "  MEM_CONV       : " + hb_ntos(Memory(104       )/1024) + " KB")
    Print( ++nRow, (nMaxCol-30), "  MEM_EMSUSED    : " + hb_ntos(Memory(105    )/1024) + " KB")
    ++nRow
    Print( ++nRow, (nMaxCol-30), "  MEM_USED       : " + hb_ntos(Memory(1001       )/1024) + " KB")
    Print( ++nRow, (nMaxCol-30), "  MEM_USEDMAX    : " + hb_ntos(Memory(1002    )/1024) + " KB")
    Print( ++nRow, (nMaxCol-30), "  MEM_STACKITEMS : " + hb_ntos(Memory(1003 )/1024) + " KB")
    Print( ++nRow, (nMaxCol-30), "  MEM_STACK      : " + hb_ntos(Memory(1004      )/1024) + " KB")
    Print( ++nRow, (nMaxCol-30), "  MEM_STACK_TOP  : " + hb_ntos(Memory(1005  )/1024) + " KB")
    Print( ++nRow, (nMaxCol-30), "  MEM_BLOCKS     : " + hb_ntos(Memory(1007     )/1024) + " KB")
    Print( ++nRow, (nMaxCol-30), "  MEM_STATISTICS : " + hb_ntos(Memory(1008 )/1024) + " KB")
    Print( ++nRow, (nMaxCol-30), "  MEM_CANLIMIT   : " + hb_ntos(Memory(1009   )/1024) + " KB")
    CenturyOff()
    IF lInkey = NIL
        SetCursor(0)
        Inkey(0)
        ResTela( cScreen )
    EndIF
    FT_ChDir( cDiretorio )
    Return


function StrGetIp()

    LOCAL cString     := ""
    LOCAL aHost     := GetIp()
    LOCAL nLen     := Len(aHost)
    LOCAL c

    for each c IN aHost
        cString += c
        if nLen >= 2
            cString += ", "
        endif
    next
    return cString



Proc ErrorSys()

    Private ErrorSys := 9876543210
    ErrorBlock( {|Erro| MacroErro(Erro)} )
    return

Function MacroErro(e)

    LOCAL cScreen     := SaveScreen()
    LOCAL cPrograma := StrTran( Upper(HB_ProgName()), ".EXE", ".ERR")
    LOCAL cmens
    LOCAL i
    LOCAL cmessage
    LOCAL aoptions
    LOCAL nchoice
    LOCAL errodos
    LOCAL ab
    LOCAL abdes
    LOCAL abexp
    LOCAL abacao
    LOCAL abacao1
    LOCAL adbf
    LOCAL adbfdes
    LOCAL adbfexp
    LOCAL adbfacao
    LOCAL adbfacao1

    cmens      := ""
    errodos     := {}
    ab          := {}
    abdes      := {}
    abexp      := {}
    abacao     := {}
    abacao1     := {}
    adbf         := {}
    adbfdes     := {}
    adbfexp     := {}
    adbfacao  := {}
    adbfacao1 := {}

    if (e:gencode() == 5)
        return 0
    endif
    if (e:gencode() == 21 .AND. e:oscode() == 32 .AND. e:candefault())
        neterr( .T. )
        return .F.
    EndIf
    if (e:gencode() == 40 .AND. e:candefault())
        neterr( .T. )
        return .F.
    endif

    AAdd(ab, 1002)
    AAdd(abdes, "ALIAS NAO EXISTE.")
    AAdd(abexp, "O ALIAS ESPECIFICADO NAO ASSOCIADO COM A AREA DE TRABALHO ATUAL.")
    AAdd(abacao, "ENTRE EM CONTATO COM O SUPORTE TECNICO.")
    AAdd(abacao1, "")
    AAdd(ab, 1003)
    AAdd(abdes, "VARIAVEL NAO EXISTE.")
    AAdd(abexp, "A VARIAVEL ESPECIFICADA NAO EXISTE OU NAO E VISIVEL.")
    AAdd(abacao, "ENTRE EM CONTATO COM O SUPORTE TECNICO.")
    AAdd(abacao1, "")
    AAdd(ab, 1004)
    AAdd(abdes, "VARIAVEL NAO EXISTE.")
    AAdd(abexp, "A VARIAVEL ESPECIFICADA NAO EXISTE OU NAO E VISIVEL.")
    AAdd(abacao, "ENTRE EM CONTATO COM O SUPORTE TECNICO.")
    AAdd(abacao1, "")
    AAdd(ab, 2006)
    AAdd(abdes,   "ERRO DE GRAVACAO/CRIACAO DE ARQUIVO.")
    AAdd(abexp,   "O ARQUIVO ESPECIFICADO NAO PODE SER GRAVADO/CRIADO.")
    AAdd(abacao,  "VERIFIQUE SEUS DIREITOS EM AMBIENTE DE REDE. ESPACO")
    AAdd(abacao1, "EM DISCO, OU SE O ARQUIVO ESTA ATRIBUIDO PARA SOMENTE LEITURA.")
    AAdd(ab, 5300)
    AAdd(abdes, "MEMORIA BAIXA.")
    AAdd(abexp, "MEMORIA DISPONIVEL INSUFICIENTE PARA RODAR O APLICATIVO.")
    AAdd(abacao, "LIBERE MAIS MEMORIA CONVENCIONAL VERIFICANDO OS ARQUIVOS")
    AAdd(abacao1, "CONFIG.SYS E AUTOEXEC.BAT.")

    AAdd(adbf, 1001)
    AAdd(adbfdes, "ERRO DE ABERTURA DO ARQUIVO ESPECIFICADO.")
    AAdd(adbfexp, "O ARQUIVO ESPECIFICADO NAO PODE SER ABERTO.")
    AAdd(adbfacao, "VERIFIQUE SEUS DIREITOS EM AMBIENTE DE REDE. ESPACO")
    AAdd(adbfacao1, "EM DISCO, OU SE O ARQUIVO ESTA ATRIBUIDO PARA SOMENTE LEITURA.")
    AAdd(adbf, 1003)
    AAdd(adbfdes, "ERRO DE ABERTURA DO ARQUIVO ESPECIFICADO.")
    AAdd(adbfexp, "O ARQUIVO ESPECIFICADO NAO PODE SER ABERTO.")
    AAdd(adbfacao, "VERIFIQUE SEUS DIREITOS EM AMBIENTE DE REDE. ESPACO")
    AAdd(adbfacao1, "EM DISCO, OU SE O ARQUIVO ESTA ATRIBUIDO PARA SOMENTE LEITURA.")
    AAdd(adbf, 1004)
    AAdd(adbfdes, "ERRO DE CRIACAO DE ARQUIVO.")
    AAdd(adbfexp, "O ARQUIVO ESPECIFICADO NAO PODE SER CRIADO.")
    AAdd(adbfacao, "VERIFIQUE SEUS DIREITOS EM AMBIENTE DE REDE. ESPACO")
    AAdd(adbfacao1, "EM DISCO, OU SE O ARQUIVO ESTA ATRIBUIDO PARA SOMENTE LEITURA.")
    AAdd(adbf, 1006)
    AAdd(adbfdes, "ERRO DE CRIACAO DE ARQUIVO.")
    AAdd(adbfexp, "O ARQUIVO ESPECIFICADO NAO PODE SER CRIADO.")
    AAdd(adbfacao, "VERIFIQUE SEUS DIREITOS EM AMBIENTE DE REDE. ESPACO")
    AAdd(adbfacao1,"EM DISCO, OU SE O ARQUIVO ESTA ATRIBUIDO PARA SOMENTE LEITURA.")
    AAdd(adbf, 1010)
    AAdd(adbfdes, "ERRO DE LEITURA DE ARQUIVO.")
    AAdd(adbfexp, "UM ERRO DE LEITURA OCORREU NO ARQUIVO ESPECIFICADO.")
    AAdd(adbfacao, "VERIFIQUE SEUS DIREITOS EM AMBIENTE DE REDE, OU SE")
    AAdd(adbfacao1, "O ARQUIVO NAO ESTA TRUNCADO.")
    AAdd(adbf, 1011)
    AAdd(adbfdes, "ERRO DE GRAVACAO DE ARQUIVO.")
    AAdd(adbfexp, "UM ERRO DE GRAVACAO OCORREU NO ARQUIVO ESPECIFICADO.")
    AAdd(adbfacao, "VERIFIQUE SEUS DIREITOS EM AMBIENTE DE REDE. ESPACO")
    AAdd(adbfacao1, "EM DISCO, OU SE O ARQUIVO ESTA ATRIBUIDO PARA SOMENTE LEITURA.")
    AAdd(adbf, 1012)
    AAdd(adbfdes, "CORRUPCAO DE ARQUIVOS DETECTADA.")
    AAdd(adbfexp, "OS ARQUIVOS DE DADOS .DBF E/OU INDICES .NTX ESTAO CORROMPIDOS.")
    AAdd(adbfacao, "APAGUE OS ARQUIVOS COM EXTENSAO .NTX E TENTE NOVAMENTE.")
    AAdd(adbfacao1, "")
    AAdd(adbf, 1020)
    AAdd(adbfdes, "ERRO DE TIPO DE DADO.")
    AAdd(adbfexp, "OS TIPOS DE DADOS SAO IMCOMPATIVEIS.")
    AAdd(adbfacao, "ENTRE EM CONTATO COM O SUPORTE TECNICO.")
    AAdd(adbfacao1, "")
    AAdd(adbf, 1021)
    AAdd(adbfdes, "ERRO DE TAMANHO DE DADO.")
    AAdd(adbfexp, "O TAMANHO DE DADO EH MAIOR QUE O CAMPO.")
    AAdd(adbfacao, "VERIFIQUE DATAS DE VCTO, EMISSAO E OU CALCULOS MUITO ")
    AAdd(adbfacao1, "GRANDES.")
    AAdd(adbf, 1022)
    AAdd(adbfdes, "TRAVAMENTO DE ARQUIVO REQUERIDO.")
    AAdd(adbfexp, "TENTATIVA DE ALTERAR UM REGISTRO SEM PRIMEIRO OBTER TRAVAMENTO.")
    AAdd(adbfacao, "ENTRE EM CONTATO COM O SUPORTE TECNICO.")
    AAdd(adbfacao1, "")
    AAdd(adbf, 1023)
    AAdd(adbfdes, "O ARQUIVO REQUER ABERTURA EXCLUSIVA")
    AAdd(adbfexp, "O INICIO DA OPERACAO REQUER ABERTURA DE ARQUIVO EXCLUSIVA.")
    AAdd(adbfacao, "ENTRE EM CONTATO COM O SUPORTE TECNICO.")
    AAdd(adbfacao1, "")
    AAdd(adbf, 1027)
    AAdd(adbfdes, "LIMITE EXCEDIDO.")
    AAdd(adbfexp, "MUITOS ARQUIVOS DE INDICES ESTAO ABERTOS NA AREA CORRENTE.")
    AAdd(adbfacao, "ENTRE EM CONTATO COM O SUPORTE TECNICO.")
    AAdd(adbfacao1, "")

    nsubcode    := e:subcode()
    csystem       := e:subsystem()
    cexplanacao := ""
    cacao        := ""
    cacao1       := ""
    nPos           := 0

    If (csystem = "BASE")
        npos:= ascan(ab, nsubcode)
        If (npos <> 0)
            e:description := abdes[npos]
            cExplanacao   := abexp[npos]
            cAcao           := abacao[npos]
            cAcao1          := abacao1[npos]
        EndIf
    ElseIf (csystem = "DBFNTX")
        npos:= ascan(adbf, nsubcode)
        If (npos <> 0)
            e:description := adbfdes[npos]
            cExplanacao   := adbfexp[npos]
            cAcao           := adbfacao[npos]
            cAcao1          := adbfacao1[npos]
        EndIf
    ElseIf (csystem = "SIXNSX")
        npos:= ascan(adbf, nsubcode)
        If (npos <> 0)
            e:description := adbfdes[npos]
            cExplanacao   := adbfexp[npos]
            cAcao           := adbfacao[npos]
            cAcao1          := adbfacao1[npos]
        EndIf
    ElseIf ( csystem = "TERM")
        if e:oscode() <> 3
            IF LptOk()
                Return( .T. )
            EndIF
            LETO_SET( 20, "SCREEN" )
            LETO_SET( 23, "Off" )
            LETO_SET( 17, "On" )
            LETO_SET( 24, "" )
            Break
        endif
    EndIf

    If (e:oscode() = 4)
        e:description := "IMPOSSIVEL ABRIR MAIS ARQUIVOS."
        cExplanacao   := "O LIMITE DE ABERTURA DE ARQUIVOS FOI EXCEDIDO."
        cAcao           := "INCREMENTE FILES NO CONFIG.SYS OU FILE HANDLES"
        cAcao1          := "NO ARQUIVO SHELL.CFG SE EM AMBIENTE DE REDE."
    EndIf
    IF nPos = 0
        cExplanacao := "ERRO NAO DOCUMENTADO."
        cAcao        := "IMPRIMA ESTA TELA. E ENTRE EM CONTATO COM O"
        cAcao1       := "SUPORTE TECNICO ATRAVES DO TEL (69)3451.3085 ou SUPORTE@MACROSOFT.COM.BR"
    EndIF

    IF nSubCode = 1003
        FT_ChDir( oAmbiente:xBase )
        LETO_SET( 4, iif( __SetCentury(), "dd/mm/yyyy", "dd/mm/yy" ) )
        LETO_SET( 17, "Off" )
        FClose( cPrograma )
        IF !File( cPrograma )
            cHandle := Fcreate( cPrograma, 0 )
            FClose( cHandle )
        EndIF
        cHandle := FOpen( cPrograma, 2 + 64 )
        IF ( Ferror() <> 0 )
            FClose( cHandle )
            SetColor("")
            Scroll() ; SetPos( 0, 0 )
            Alert( "Erro #3: Erro de Abertura " + cPrograma + ". Erro DOS " + Str( Ferror(),3))
            Break(e)

            __Quit()
        EndIF
        FBot( cHandle )
        FWriteLine( cHandle, Replicate("=", 80))
        FWriteLine( cHandle, "Usuario   : " + oAmbiente:xUsuario )
        FWriteLine( cHandle, "Data      : " + DToC(Date()))
        FWriteLine( cHandle, "Horas     : " + Time())
        FWriteLine( cHandle, "SubSystem : " + csystem )
        FWriteLine( cHandle, "SubCode   : " + Str(nsubcode, 4))
        FWriteLine( cHandle, "Variavel  : " + e:operation )
        FWriteLine( cHandle, "Arquivo   : " + e:filename )
        FWriteLine( cHandle, "Area      : " + Alias())
        FWriteLine( cHandle, "Indice    : " + IndexKey( IndexOrd()))
        FWriteLine( cHandle, "Descricao : " + e:description )
        FWriteLine( cHandle, "Explanacao: " + cexplanacao )
        FWriteLine( cHandle, "Acao      : " + cAcao )
        FWriteLine( cHandle, "Acao      : " + cAcao1 )
        FWriteLine( cHandle, Replicate("-", 80))
        FWriteLine( cHandle, "PILHA DE CARGA" )
        nCol := 0
        i      := 2
        nX   := 0
        while (!Empty(ProcName(i)))
            nCol++
            nX++
            FWriteLine( cHandle, Space(16) + "Linha : " + strzero(procline(i), 6) + "    Proc : " + ProcName(i))
            i++
        EndDo
        FWriteLine( cHandle, Replicate("=", 80))
        Fclose( cHandle )
        LETO_SET( 17, "On" )
        FT_ChDir( oAmbiente:xBase )

    EndIF

    SetColor("")
    Scroll() ; SetPos( 0, 0 )
    IF nSubCode = 1012
        IF !Empty( e:FileName() )
            ErrorBeep()
            IF Conf("O arquivo " + ltrim(rtrim(e:FileName())) + " corrompeu. Criar um novo ?")
                cTemp := StrTran( e:FileName(), ".DBF") + ".OLD"
                Ferase( cTemp )
                IF FRename( e:FileName(), cTemp )
                    IF CriaArquivo( e:FileName() )
                        Aeval( Directory( "*.NTX"), { | aFile | Ferase( aFile[ 1 ] )})
                        Scroll() ; SetPos( 0, 0 )
                        ErrorBeep()
                        Alerta("Informa: Arquivo " + e:FileName() + " criado. Carregue novamente o Sistema.")
                        FT_ChDir( oAmbiente:xBase )
                        Break( e )
                        __Quit()
                    EndIF
                Else
                    Alerta("Erro: Impossivel consertar o arquivo.")
                EndIF
            EndIF
        EndIF
    EndIF

    LETO_SET( 20, "SCREEN" )
    LETO_SET( 23, "Off" )
    LETO_SET( 17, "On" )
    LETO_SET( 24, "" )
    SetColor( "Gr+/b" )
    Scroll( 0, 0, 9, MaxCol() ) ; SetPos( 0, 0 )
    DispBox( 0, 0, 8, MaxCol(), 1, "Gr+/b" )
    DevPos( 1, 1 ) ; DevOut( "SubSystem : " )
    DevPos( 1, 35 ) ; DevOut( "SubCode : " )
    DevPos( 2, 1 ) ; DevOut( "OsCode    : " )
    DevPos( 2, 35 ) ; DevOut( "GenCode : " )
    DevPos( 3, 1 ) ; DevOut( "Variavel  : " )
    DevPos( 3, 35 ) ; DevOut( "Arquivo : " )
    DevPos( 4, 1 ) ; DevOut( "Area      : " )
    DevPos( 4, 35 ) ; DevOut( "Indice  : " )

    DevPos( 5, 1 ) ; DevOut( "Descri‡ao : " )
    DevPos( 6, 1 ) ; DevOut( "Explana‡ao: " )
    DevPos( 7, 1 ) ; DevOut( "A‡ao      : " )

    DevPos( 1, 14 ) ; DevOut( csystem, "W+/B" )
    DevPos( 1, 45 ) ; DevOut( Str(nsubcode, 4), "W+/B" )

    DevPos( 2, 14 ) ; DevOut( ltrim(rtrim(Str(e:oscode(), 4))), "W+/B" )
    DevPos( 2, 45 ) ; DevOut( ltrim(rtrim(Str(e:gencode(), 4))), "W+/B" )

    DevPos( 3, 14 ) ; DevOut( e:operation(), "W+/B" )
    DevPos( 3, 45 ) ; DevOut( Upper(e:filename()), "W+/B" )

    DevPos( 4, 14 ) ; DevOut( Alias(), "W+/B" )
    DevPos( 4, 45 ) ; DevOut( Upper(IndexKey(IndexOrd())), "W+/B" )

    DevPos( 5, 14 ) ; DevOut( e:description, "W+/B" )
    DevPos( 6, 14 ) ; DevOut( cexplanacao, "W+/B" )
    DevPos( 7, 14 ) ; DevOut( cacao, "R/B" )
    DevPos( 8, 14 ) ; DevOut( cacao1, "R/B" )

    ncol := 16
    SetColor( "Gr+/b" )
    Scroll( ncol, 0, 23, MaxCol() ) ; SetPos( ncol, 0 )
    DispBox( ncol, 0, 23, MaxCol(), 1, "Gr+/b" )
    DevPos( ncol, 12 ) ; DevOut( "PILHA DE CARGA", "W+/B" )

    i    := 2
    nx := 0
    ncol ++
    nRow := 00
    while (!Empty( ProcName(i)))
        nx++
        DevPos( ncol, nRow+01 ) ; DevOut( "[" + StrZero( i, 2 )   + "]:", "W+/B" )
        DevPos( ncol, nRow+06 ) ; DevOut( "[" + strzero(procline(i), 6) + "]:", "GR+/B" )
        DevPos( ncol, nRow+16 ) ; DevOut( ProcName(i), "W+/B" )
        i++
        nCol++
        IF nCol >= 23
            nCol := 17
            nRow += 40
        EndIF
    EndDo

    cmessage := "Escolha uma opcao abaixo."
    aoptions := {"Encerrar"}
    If (e:canretry())
        AAdd(aoptions, "Tentar")
    EndIf
    If (e:candefault())
        AAdd(aoptions, "Default")
    EndIf

    nchoice:= 0
    while (nchoice == 0)
        nchoice:= alert(cmessage, aoptions)
        If (!Empty(nchoice))
            If (aoptions[nchoice] == "Encerrar")
                nopcao:= alert("Pergunta: Imprimir resultado para ?", {"Nenhum", "Impressora"})
                If (nopcao == 2)
                    If (instru80() .AND. lptok())
                        printon()
                        setprc(0, 0)
                        Qout(Replicate("=", 80))
                        DevPos( 02, 01 ) ; DevOut( "SubSystem : " + csystem )
                        DevPos( 03, 01 ) ; DevOut( "SubCode   : " + Str(nsubcode, 4) )
                        DevPos( 04, 01 ) ; DevOut( "Variavel  : " + e:operation() )
                        DevPos( 05, 01 ) ; DevOut( "Arquivo   : " + e:filename() )
                        DevPos( 06, 01 ) ; DevOut( "Area      : " + Alias() )
                        DevPos( 07, 01 ) ; DevOut( "Descricao : " + e:description )
                        DevPos( 08, 01 ) ; DevOut( "Explanacao: " + cexplanacao )
                        DevPos( 09, 01 ) ; DevOut( "Acao      : " + cacao )
                        DevPos( 10, 13 ) ; DevOut( cacao1 )
                        Qout( Replicate("-", 80))
                        ncol := 12
                        DevPos( ncol, 6 ) ; DevOut( "[Pilha de Carga]" )
                        i := 2
                        nx := 0
                        while (!Empty(ProcName(i)))
                            nCol++
                            nX++
                            DevPos( nCol, 01 ) ; DevOut( StrZero(nX, 2) +")Proc:" )
                            DevPos( nCol, 09 ) ; DevOut( ProcName(i), "W+/B" )
                            DevPos( nCol, 20 ) ; DevOut( "Linha:" )
                            DevPos( nCol, 26 ) ; DevOut( strzero(procline(i), 6), "W+/B" )
                            i++
                        EndDo
                        Qout(Replicate("=", 80))
                        __Eject()
                        PrintOff()
                    EndIf
                EndIF
                FT_ChDir( oAmbiente:xBase )
                LETO_SET( 4, iif( __SetCentury(), "dd/mm/yyyy", "dd/mm/yy" ) )
                LETO_SET( 17, "Off" )
                FClose( cPrograma )
                IF !File( cPrograma )
                    cHandle := Fcreate( cPrograma, 0 )
                    FClose( cHandle )
                EndIF
                cHandle := FOpen( cPrograma, 2 + 64 )
                IF ( Ferror() <> 0 )
                    FClose( cHandle )
                    SetColor("")
                    Scroll() ; SetPos( 0, 0 )
                    Alert( "Erro #3: Erro de Abertura " + cPrograma + ". Erro DOS " + Str( Ferror(),3))
                    Break(e)

                    __Quit()
                EndIF
                FBot( cHandle )
                FWriteLine( cHandle, Replicate("=", 80))
                FWriteLine( cHandle, "Usuario   : " + oAmbiente:xUsuario )
                FWriteLine( cHandle, "Data      : " + DToC(Date()))
                FWriteLine( cHandle, "Horas     : " + Time())
                FWriteLine( cHandle, "SubSystem : " + csystem )
                FWriteLine( cHandle, "SubCode   : " + Str(nsubcode, 4))
                FWriteLine( cHandle, "Variavel  : " + e:operation )
                FWriteLine( cHandle, "Arquivo   : " + e:filename )
                FWriteLine( cHandle, "Area      : " + Alias())
                FWriteLine( cHandle, "Indice    : " + IndexKey( IndexOrd()))
                FWriteLine( cHandle, "Descricao : " + e:description )
                FWriteLine( cHandle, "Explanacao: " + cexplanacao )
                FWriteLine( cHandle, "Acao      : " + cAcao )
                FWriteLine( cHandle, "Acao      : " + cAcao1 )
                FWriteLine( cHandle, Replicate("-", 80))
                FWriteLine( cHandle, "PILHA DE CARGA" )
                i    := 2
                nX := 0
                while (!Empty(ProcName(i)))
                    nCol++
                    nX++
                    FWriteLine( cHandle, Space(16) + "Linha : " + strzero(procline(i), 6) + "    Proc : " + ProcName(i))
                    i++
                EndDo
                FWriteLine( cHandle, Replicate("=", 80))
                Fclose( cHandle )
                LETO_SET( 17, "On" )
                SetColor("")
                Scroll() ; SetPos( 0, 0 )
                FT_ChDir( oAmbiente:xBase )
                Break(e)

                __Quit()
            ElseIf (aoptions[nchoice] == "Tentar")
                ResTela( cScreen )
                Return .T.
            ElseIf (aoptions[nchoice] == "Default")
                ResTela( cScreen )
                Return .F.
            EndIf
        EndIf
    EndDo
    LETO_SET( 20, "SCREEN" )
    LETO_SET( 23, "Off" )
    Break
    Return .T.


function ArrayArquivos()
    LOCAL aArquivos := {}


















































    Aadd( aArquivos, {"LISTA.DBF",{{ "ID",         "+", 04, 0 },  { "CODIGO",     "C", 06, 0 },  { "CODGRUPO",   "C", 03, 0 },  { "CODSGRUPO",  "C", 06, 0 },  { "DESCRICAO",  "C", 40, 0 },  { "UN",         "C", 02, 0 },  { "EMB",        "N", 03, 0 },  { "QUANT",      "N", 09, 2 },  { "VENDIDA",    "N", 09, 2 },  { "PEDIDO",     "N", 09, 2 },  { "ATACADO",    "N", 11, 2 },  { "PCOMPRA",    "N", 11, 2 },  { "CUSTODOLAR", "N", 11, 2 },  { "PCUSTO",     "N", 11, 2 },  { "DATA",       "D", 08, 0 },  { "N_ORIGINAL", "C", 15, 0 },  { "CODEBAR",    "C", 15, 0 },  { "SIGLA",      "C", 10, 0 },  { "QMAX",       "N", 09, 2 },  { "QMIN",       "N", 09, 2 },  { "CODI",       "C", 04, 0 },  { "CODI1",      "C", 04, 0 },  { "CODI2",      "C", 04, 0 },  { "CODI3",      "C", 04, 0 },  { "REPRES",     "C", 04, 0 },  { "MARCUS",     "N", 06, 2 },  { "MARVAR",     "N", 06, 2 },  { "MARATA",     "N", 06, 2 },  { "IMPOSTO",    "N", 06, 2 },  { "FRETE",      "N", 06, 2 },  { "VAREJO",     "N", 11, 2 },  { "BX_CON",     "L", 01, 0 },  { "UFIR",       "N", 07, 2 },  { "IPI",        "N", 05, 2 },  { "II",         "N", 05, 2 },  { "SITUACAO",   "C", 01, 0 },  { "CLASSE",     "C", 02, 0 },  { "TX_ICMS",    "N", 03, 0 },  { "REDUCAO",    "N", 03, 0 },  { "LOCAL",      "C", 10, 0 },  { "TAM",        "C", 06, 0 },  { "DESCONTO",   "N", 06, 2 },  { "ATUALIZADO", "D", 08, 0 },  { "SERVICO",    "L", 01, 0 },  { "RO",         "N", 06, 2 },  { "AC",         "N", 06, 2 },  { "MT",         "N", 06, 2 },  { "AM",         "N", 06, 2 },  { "RR",         "N", 06, 2 },  { "USA",        "L", 01, 0 },  { "PORC",       "N", 05, 2 }}})
































Aadd( aArquivos, { "SAIDAS.DBF", {{ "CODIGO",     "C", 06, 0 },  { "DOCNR",      "C", 09, 0 },  { "CODIVEN",    "C", 04, 0 },  { "TECNICO",    "C", 04, 0 },  { "CAIXA",      "C", 04, 0 },  { "FORMA",      "C", 02, 0 },  { "CODI",       "C", 05, 0 },  { "FATURA",     "C", 09, 0 },  { "PEDIDO",     "C", 07, 0 },  { "REGIAO",     "C", 02, 0 },  { "PLACA",      "C", 08, 0 },  { "TIPO",       "C", 06, 0 },  { "EMIS",       "D", 08, 0 },  { "DATA",       "D", 08, 0 },  { "DESCONTO",   "N", 05, 2 },  { "DIFERENCA",  "N", 11, 2 },  { "PORC",       "N", 05, 2 },  { "PVENDIDO",   "N", 11, 2 },  { "SAIDA",      "N", 09, 2 },  { "SAIDAPAGA",  "N", 09, 2 },  { "QTD_D_FATU", "N", 02, 0 },  { "ATACADO",    "N", 11, 2 },  { "VAREJO",     "N", 11, 2 },  { "PCUSTO",     "N", 11, 2 },  { "PCOMPRA",    "N", 11, 2 },  { "VLRFATURA",  "N", 13, 2 }, { "ATUALIZADO", "D", 08, 0 }, { "IMPRESSO",   "L", 01, 0 }, { "SERIE",      "C", 10, 0 }, { "EXPORTADO",  "L", 01, 0 }, { "SITUACAO",   "C", 08, 0 }, { "C_C",        "L", 01, 0 }}})
















Aadd( aArquivos, { "ENTRADAS.DBF",  {{ "CODIGO",     "C", 06, 0 },  { "PCUSTO",     "N", 11, 2 },  { "CUSTOFINAL", "N", 11, 2 },  { "DATA",       "D", 08, 0 },  { "DENTRADA",   "D", 08, 0 },  { "ENTRADA",    "N", 09, 2 },  { "IMPOSTO",    "N", 06, 2 },  { "FRETE",      "N", 06, 2 },  { "CONDICOES",  "C", 23, 0 },  { "CODI",       "C", 04, 0 },  { "FATURA",     "C", 09, 0 },  { "VLRFATURA",  "N", 13, 2 },  { "ICMS",       "N", 02, 0 },  { "ATUALIZADO", "D", 08, 0 }, { "CFOP",       "C", 05, 0 }, { "VLRNFF",     "N", 13, 2 }}})






















































































Aadd( aArquivos, { "RECEBER.DBF", {{ "CODI",      "C", 05, 0 },  { "NOME",      "C", 40, 0 },  { "ENDE",      "C", 30, 0 },  { "CIDA",      "C", 25, 0 },  { "ESTA",      "C", 02, 0 },  { "CEP",       "C", 09, 0 },  { "PRACA",     "C", 09, 0 },  { "CPF",       "C", 14, 0 },  { "CGC",       "C", 18, 0 },  { "INSC",      "C", 15, 0 },  { "RG",        "C", 18, 0 },  { "BAIR",      "C", 20, 0 },  { "DATA",      "D", 08, 0 },  { "FONE",      "C", 14, 0 },  { "OBS",       "C", 60, 0 },  { "OBS1",      "C", 60, 0 },  { "OBS2",      "C", 60, 0 },  { "OBS3",      "C", 60, 0 },  { "OBS4",      "C", 60, 0 },  { "OBS5",      "C", 60, 0 },  { "OBS6",      "C", 60, 0 },  { "OBS7",      "C", 60, 0 },  { "OBS8",      "C", 60, 0 },  { "OBS9",      "C", 60, 0 },  { "OBS10",     "C", 60, 0 },  { "OBS11",     "C", 60, 0 },  { "OBS12",     "C", 60, 0 },  { "OBS13",     "C", 60, 0 },  { "FANTA",     "C", 40, 0 },  { "FAX",       "C", 14, 0 },  { "MEDIA",     "N", 11, 2 },  { "REFBCO",    "C", 40, 0 },  { "REFCOM",    "C", 40, 0 },  { "IMOVEL",    "C", 40, 0 },  { "REGIAO",    "C", 02, 0 },  { "MATRASO",   "N", 03, 0 },  { "VLRCOMPRA", "N", 13, 2 },  { "EMIS",      "D", 08, 0 },  { "CIVIL",     "C", 15, 0 },  { "NATURAL",   "C", 30, 0 },  { "NASC",      "D", 08, 0 },  { "ESPOSA",    "C", 40, 0 },  { "DEPE",      "N", 02, 0 },  { "PAI",       "C", 40, 0 },  { "MAE",       "C", 40, 0 },  { "ENDE1",     "C", 30, 0 },  { "FONE1",     "C", 14, 0 },  { "FONE2",     "C", 14, 0 },  { "PROFISSAO", "C", 30, 0 },  { "CARGO",     "C", 20, 0 },  { "TRABALHO",  "C", 30, 0 },  { "TEMPO",     "C", 20, 0 },  { "VEICULO",   "C", 40, 0 },  { "CONHECIDA", "C", 40, 0 },  { "ENDE3",     "C", 30, 0 },  { "CIDAAVAL",  "C", 25, 0 },  { "ESTAAVAL",  "C", 02, 0 },  { "BAIRAVAL",  "C", 20, 0 },  { "FONEAVAL",  "C", 14, 0 },  { "FAXAVAL",   "C", 14, 0 },  { "CPFAVAL",   "C", 14, 0 },  { "RGAVAL",    "C", 18, 0 },  { "SPC",       "L", 01, 0 },  { "DATASPC",   "D", 08, 0 },  { "BANCO",     "C", 30, 0 },  { "LIMITE",    "N", 13, 2 },  { "CANCELADA",  "L", 01, 0 },  { "ATUALIZADO", "D", 08, 0 }, { "FABRICANTE", "C", 40, 0 }, { "PRODUTO",    "C", 40, 0 }, { "MODELO",     "C", 30, 0 }, { "VALOR",      "N", 13, 2 }, { "LOCAL",      "C", 30, 0 }, { "PRAZO",      "N", 03, 0 }, { "DATAVCTO",   "N", 02, 0 }, { "PRAZOEXT",   "N", 03, 0 }, { "SCI",        "L", 01, 0 }, { "SUPORTE",    "L", 01, 0 }, { "AUTORIZACA", "L", 01, 0 }, { "ASSAUTORIZ", "L", 01, 0 }, { "PROXCOB",    "D", 08, 0 }, { "EXPORTADO",  "L", 01, 0 }, { "ROL",        "L", 01, 0 }, { "CFOP",       "C", 05, 0 }, { "TX_ICMS",    "N", 05, 2 }, { "ULTCOMPRA",  "D",  8, 0 }}})
















Aadd( aArquivos, { "REPRES.DBF",    {{ "REPRES", "C",  4, 0 },  { "NOME",   "C", 40, 0 },  { "ENDE",   "C", 30, 0 },  { "CIDA",   "C", 25, 0 },  { "ESTA",   "C",  2, 0 },  { "CEP",    "C",  9, 0 },  { "CGC",    "C", 18, 0 },  { "INSC",   "C", 15, 0 },  { "BAIR",   "C", 20, 0 },  { "FONE",   "C", 14, 0 },  { "CON",    "C", 20, 0 },  { "OBS",    "C", 60, 0 },  { "FAX",    "C", 14, 0 },  { "ATUALIZADO", "D", 08, 0 }, { "CAIXA",  "C",  3, 0 }}})

































Aadd( aArquivos, { "RECEMOV.DBF", {{ "CODI",       "C", 05, 0 },  { "CODIVEN",    "C", 04, 0 },  { "CAIXA",      "C", 04, 0 },  { "DOCNR",      "C", 09, 0 },  { "FATURA",     "C", 09, 0 },  { "PORT",       "C", 10, 0 },  { "TIPO",       "C", 06, 0 },  { "NOSSONR",    "C", 13, 0 },  { "BORDERO",    "C", 09, 0 },  { "FORMA",      "C", 02, 0 },  { "COBRADOR",   "C", 04, 0 },  { "REGIAO",     "C", 02, 0 },  { "VLR",        "N", 13, 2 },  { "VLRORIGINA", "N", 13, 2 },  { "VLRPAG",     "N", 13, 2 },  { "VLRDOLAR",   "N", 13, 2 },  { "JURODIA",    "N", 16, 5 },  { "JUROTOTAL",  "N", 16, 5 },  { "JURO",       "N", 09, 5 },  { "QTD_D_FATU", "N", 02, 0 },  { "VLRFATU",    "N", 13, 2 },  { "PORC",       "N", 05, 2 },  { "EMIS",       "D", 08, 0 },  { "VCTO",       "D", 08, 0 },  { "DATAPAG",    "D", 08, 0 },  { "TITULO",     "L", 01, 0 },  { "ATUALIZADO", "D", 08, 0 },  { "STPAG",      "L", 01, 0 },  { "CODGRUPO",   "C", 03, 0 },  { "EXPORTADO",  "L", 01, 0 },  { "RELCOB",     "L", 01, 0 },  { "OBS",        "C", 80, 0 },  { "COMISSAO",   "L", 01, 0 }}})




Aadd( aArquivos, { "GRUPO.DBF",   {{ "CODGRUPO",   "C", 03, 0 }, { "ATUALIZADO", "D", 08, 0 }, { "SERVICO",    "L", 01, 0 }, { "DESGRUPO",   "C", 40, 0 }}})



Aadd( aArquivos, { "SUBGRUPO.DBF", {{ "CODSGRUPO",  "C", 06, 0 },    { "ATUALIZADO", "D", 08, 0 },    { "DESSGRUPO",  "C", 40, 0 }}})























Aadd( aArquivos, { "VENDEDOR.DBF", {{ "CODIVEN",  "C",  4, 0 },  { "NOME",     "C", 40, 0 },  { "ENDE",     "C", 25, 0 },  { "SENHA",    "C", 10, 0 },  { "CIDA",     "C", 25, 0 },  { "ESTA",     "C",  2, 0 },  { "CEP",      "C",  9, 0 },  { "CPF",      "C", 14, 0 },  { "RG",       "C", 18, 0 },  { "CT",       "C", 10, 0 },  { "BAIR",     "C", 20, 0 },  { "DATA",     "D",  8, 0 },  { "FONE",     "C", 14, 0 },  { "CON",      "C", 20, 0 },  { "OBS",      "C", 30, 0 },  { "PORCCOB",  "N", 05, 2 },  { "COMDISP",  "N", 13, 2 },  { "COMBLOQ",  "N", 13, 2 },  { "ATUALIZADO", "D", 08, 0 }, { "ROL",        "L", 01, 0 }, { "COMISSAOS", "N", 13, 3 }, { "COMISSAO", "N", 13, 2 }}})



















Aadd( aArquivos, { "VENDEMOV.DBF", {{ "CODIVEN",    "C", 04, 0 },  { "CODI",       "C", 05, 0 },  { "VLR",        "N", 13, 2 },  { "DC",         "C", 01, 0 },  { "DOCNR",      "C", 09, 0 },  { "DATA",       "D", 08, 0 },  { "VCTO",       "D", 08, 0 },  { "PORC",       "N", 05, 2 },  { "COMDISP",    "N", 13, 2 },  { "COMBLOQ",    "N", 13, 2 },  { "COMISSAO",   "N", 13, 2 },  { "PEDIDO",     "C", 07, 0 },  { "DATAPED",    "D", 08, 0 },  { "FATURA",     "C", 09, 0 },  { "FORMA",      "C", 02, 0 },  { "DESCRICAO",  "C", 40, 0 }, { "ATUALIZADO", "D", 08, 0 }, { "REGIAO",     "C", 02, 0 }}})










Aadd( aArquivos, { "ENTNOTA.DBF",    {{ "NUMERO",     "C", 07, 0 }, { "CODI",       "C", 04, 0 }, { "VLRFATURA",  "N", 13, 2 }, { "VLRNFF",     "N", 13, 2 }, { "ICMS",       "N", 02, 0 }, { "ENTRADA",    "D", 08, 0 }, { "ATUALIZADO", "D", 08, 0 }, { "CONDICOES",  "C", 23, 0 }, { "DATA",       "D", 08, 0 }}})







Aadd( aArquivos, { "NOTA.DBF",    {{ "NUMERO",     "C", 07, 0 }, { "ATUALIZADO", "D", 08, 0 }, { "DATA",       "D", 08, 0 }, { "SITUACAO",   "C", 08, 0 }, { "CAIXA",      "C", 04, 0 }, { "CODI",       "C", 05, 0 }}})

















Aadd( aArquivos, { "PAGAMOV.DBF", {{ "CODI",       "C", 04, 0 },  { "DESC",       "C", 04, 0 },  { "VLR",        "N", 13, 2 },  { "JURODIA",    "N", 13, 2 },  { "DESCONTO",   "N", 06, 2 },  { "JURO",       "N", 06, 2 },  { "EMIS",       "D", 08, 0 },  { "VCTO",       "D", 08, 0 },  { "DOCNR",      "C", 09, 0 },  { "PORT",       "C", 10, 0 },  { "TIPO",       "C", 06, 0 },  { "FATURA",     "C", 09, 0 },  { "VLRFATU",    "N", 13, 2 },  { "OBS1",       "C", 60, 0 },  { "OBS2",       "C", 60, 0 },  { "ATUALIZADO", "D", 08, 0 }}})























Aadd( aArquivos, { "PAGAR.DBF",    {{ "CODI",   "C",  4, 0 },  { "REPRES", "C",  4, 0 },  { "NOME",   "C", 40, 0 },  { "SIGLA",  "C", 10, 0 },  { "ENDE",   "C", 30, 0 },  { "CIDA",   "C", 25, 0 },  { "ESTA",   "C",  2, 0 },  { "CEP",    "C",  9, 0 },  { "CPF",    "C", 14, 0 },  { "CGC",    "C", 18, 0 },  { "INSC",   "C", 15, 0 },  { "RG",     "C", 18, 0 },  { "BAIR",   "C", 20, 0 },  { "DATA",   "D",  8, 0 },  { "FONE",   "C", 14, 0 },  { "CON",    "C", 20, 0 },  { "OBS",    "C", 30, 0 },  { "TIPO",   "C",  6, 0 },  { "FANTA",  "C", 40, 0 },  { "FAX",    "C", 14, 0 },  { "ATUALIZADO", "D", 08, 0 }, { "CAIXA",  "C",  3, 0 }}})









Aadd( aArquivos, { "TAXAS.DBF", {{ "DINI",    "D", 08, 0 },  { "DFIM",    "D", 08, 0 },  { "TXATU",   "N", 06, 2 },  { "JURATA",  "N", 06, 2 },  { "UFIR",    "N", 07, 2 },  { "JURVAR",  "N", 06, 2 },  { "ATUALIZADO", "D", 08, 0 }, { "COTACAO", "N", 11, 2 }}})
















Aadd( aArquivos, { "PAGO.DBF", {{ "CODI",       "C", 04, 0 }, { "VLR",        "N", 13, 2 }, { "EMIS",       "D", 08, 0 }, { "VCTO",       "D", 08, 0 }, { "DOCNR",      "C", 09, 0 }, { "FATURA",     "C", 09, 0 },  { "DATAPAG",    "D", 08, 0 }, { "VLRPAG",     "N", 13, 2 }, { "PORT",       "C", 10, 0 }, { "TIPO",       "C", 06, 0 }, { "JURO",       "N", 06, 2 }, { "OBS1",       "C", 60, 0 },  { "OBS2",       "C", 60, 0 },  { "ATUALIZADO", "D", 08, 0 }, { "NDEB",       "C", 03, 0 }}})























Aadd( aArquivos, { "RECEBIDO.DBF", {{ "CODI" ,    "C",  05 , 0 }, { "REGIAO",   "C",  02 , 0 }, { "CAIXA",    "C",  04 , 0 },  { "CODIVEN",  "C" , 04 , 0 }, { "DOCNR" ,   "C" , 09 , 0 }, { "FATURA",   "C" , 09 , 0 }, { "PORT" ,    "C" , 10 , 0 }, { "TIPO" ,    "C" , 06 , 0 }, { "NOSSONR" , "C" , 13 , 0 }, { "BORDERO" , "C" , 09 , 0 }, { "FORMA",    "C",  02 , 0 }, { "OBS",      "C",  40 , 0 }, { "DATAPAG" , "D" , 08 , 0 }, { "BAIXA",    "D",  08 , 0 }, { "EMIS" ,    "D" , 08 , 0 }, { "VCTO" ,    "D" , 08 , 0 }, { "VLR" ,     "N" , 13 , 2 }, { "VLRPAG" ,  "N" , 13 , 2 }, { "ATUALIZADO", "D", 08, 0 }, { "EXPORTADO","L", 01, 0 }, { "PARCIAL",  "C",  01, 0 }, { "JURO" ,    "N",  06, 2 }}})









































Aadd( aArquivos, { "CHEQUE.DBF", {{ "CODI",     "C", 04, 0 }, { "BANCO",    "C", 10, 0 }, { "TITULAR",  "C", 40, 0 }, { "AG",       "C", 25, 0 }, { "CGC",      "C", 18, 0 }, { "CONTA",    "C",  8, 0 }, { "DATA",     "D",  8, 0 }, { "SALDO",    "N", 17, 2 }, { "DEBITOS",  "N", 18, 2 }, { "CREDITOS", "N", 18, 2 }, { "FONE",     "C", 14, 0 }, { "MENS",     "L", 01, 0 }, { "OBS",      "C", 40, 0 }, { "CPF",      "C", 15, 0 }, { "CPF1",     "C", 15, 0 }, { "RG",       "C", 18, 0 }, { "RG1",      "C", 18, 0 }, { "NASCI",    "D", 08, 0 }, { "ENDE",     "C", 35, 0 }, { "ENDE1",    "C", 35, 0 }, { "CIDA",     "C", 25, 0 }, { "ESTA",     "C", 02, 0 }, { "PROFISSAO","C", 15, 0 }, { "TRABALHO", "C", 40, 0 }, { "FONE1",    "C", 14, 0 }, { "FONE2",    "C", 14, 0 }, { "RESP",     "C", 40, 0 }, { "HORARIO",  "C", 11, 0 }, { "DIAS",     "C", 15, 0 }, { "C_C",      "L", 01, 0 }, { "EXTERNA",  "L", 01, 0 }, { "ATIVO",    "L", 01, 0 }, { "CURSO",    "C", 04, 0 }, { "RENOVADO", "L", 01, 0 }, { "POUPANCA", "L", 01, 0 }, { "ATUALIZADO", "D", 08, 0 }, { "DEB_DEB",    "C", 01, 0 }, { "DEB_CRE",    "C", 01, 0 }, { "CRE_DEB",    "C", 01, 0 }, { "CRE_CRE",    "C", 01, 0 }, { "DURACAO",    "N", 02, 0 }}})















Aadd( aArquivos, { "CHEMOV.DBF",    {{ "CODI",   "C", 04, 0 } ,  { "DATA",   "D", 08, 0 } ,  { "EMIS",   "D", 08, 0 } ,  { "BAIXA",  "D", 08, 0 } ,  { "SALDO",  "N", 15, 2 } ,  { "HIST",   "C", 40, 0 } ,  { "DOCNR",  "C", 09, 0 } ,  { "FATURA", "C", 09, 0 } ,  { "CAIXA",  "C", 04, 0 } ,  { "CRE",    "N", 15, 2 } ,  { "DEB",    "N", 15, 2 } ,  { "ATUALIZADO", "D", 08, 0 }, { "CPARTIDA", "L", 01, 0 }, { "TIPO",     "C", 06, 0 }}})
















Aadd( aArquivos, { "CHEPRE.DBF", {{ "CODI",       "C", 04, 0 } ,  { "BANCO",      "C", 10, 0 } ,  { "CONTA",      "C", 08, 0 } ,  { "DATA",       "D", 08, 0 } ,  { "VCTO",       "D", 08, 0 } ,  { "SALDO",      "N", 15, 2 } ,  { "HIST",       "C", 40, 0 } ,  { "DOCNR",      "C", 09, 0 } ,  { "VALOR",      "N", 15, 2 } ,  { "PRACA",      "C", 20, 0 } ,  { "AGENCIA",    "C", 10, 0 } ,  { "CPFCGC",     "C", 14, 0 } ,  { "DEBCRE",     "C", 01, 0 } ,  { "ATUALIZADO", "D", 08, 0 }, { "OBS",        "C", 40, 0 }}})




Aadd( aArquivos, { "REGIAO.DBF", {{ "REGIAO",  "C", 02, 0 }, { "ATUALIZADO", "D", 08, 0 }, { "NOME",    "C", 40, 0 }}})









































Aadd( aArquivos, { "USUARIO.DBF", {{ "NOME",    "C", 10, 0 }, { "SENHA",   "C", 10, 0 }, { "NIVEL1",  "C", 01, 0 }, { "NIVEL2",  "C", 01, 0 }, { "NIVEL3",  "C", 01, 0 }, { "NIVEL4",  "C", 01, 0 }, { "NIVEL5",  "C", 01, 0 }, { "NIVEL6",  "C", 01, 0 }, { "NIVEL7",  "C", 01, 0 }, { "NIVEL8",  "C", 01, 0 }, { "NIVEL9",  "C", 01, 0 }, { "NIVEL0",  "C", 01, 0 }, { "NIVELA",  "C", 01, 0 }, { "NIVELB",  "C", 01, 0 }, { "NIVELC",  "C", 01, 0 }, { "NIVELD",  "C", 01, 0 }, { "NIVELE",  "C", 01, 0 }, { "NIVELF",  "C", 01, 0 }, { "NIVELG",  "C", 01, 0 }, { "NIVELH",  "C", 01, 0 }, { "NIVELI",  "C", 01, 0 }, { "NIVELJ",  "C", 01, 0 }, { "NIVELK",  "C", 01, 0 }, { "NIVELL",  "C", 01, 0 }, { "NIVELM",  "C", 01, 0 }, { "NIVELN",  "C", 01, 0 }, { "NIVELO",  "C", 01, 0 }, { "NIVELP",  "C", 01, 0 }, { "NIVELQ",  "C", 01, 0 }, { "NIVELR",  "C", 01, 0 }, { "NIVELS",  "C", 01, 0 }, { "LPT1",    "C", 02, 0 }, { "LPT2",    "C", 02, 0 }, { "LPT3",    "C", 02, 0 }, { "LPT4",    "C", 02, 0 }, { "COM1",    "C", 02, 0 }, { "COM2",    "C", 02, 0 }, { "COM3",    "C", 02, 0 }, { "ATUALIZADO", "D", 08, 0 }, { "COM4",    "C", 02, 0 }}})








Aadd( aArquivos, { "CURSOS.DBF", {{ "CURSO",   "C", 04, 0 } ,  { "OBS",     "C", 40, 0 } ,  { "MENSAL",  "N", 13, 2 } ,  { "RENOVA",  "N", 13, 2 } ,  { "TAXA",    "N", 13, 2 } ,  { "ATUALIZADO", "D", 08, 0 }, { "DURACAO", "N", 03, 0 }}})








Aadd( aArquivos, { "CURSADO.DBF", {{ "CURSO",       "C", 04, 0 } ,  { "CODI",        "C", 05, 0 } ,  { "FATURA",      "C", 09, 0 } ,  { "MENSALIDAD",  "N", 13, 2 } ,  { "MATRICULA",   "N", 13, 2 } ,  { "INICIO",      "D", 08, 0 } ,  { "ATUALIZADO", "D", 08, 0 }, { "TERMINO",     "D", 08, 0 }}})











Aadd( aArquivos, { "FORMA.DBF", {{ "FORMA",      "C", 02, 0 }, { "CONDICOES",  "C", 40, 0 }, { "DESCRICAO",  "C", 40, 0 }, { "COMISSAO",   "N", 05, 2 }, { "IOF",        "N", 08, 4 }, { "DESDOBRAR",  "L", 01, 0 }, { "VISTA",      "L", 01, 0 }, { "PARCELAS",   "N", 02, 0 }, { "DIAS",       "N", 03, 0 }, { "ATUALIZADO", "D", 08, 0 }}})






Aadd( aArquivos, { "CEP.DBF", {{ "CEP",        "C", 09, 0 },  { "CIDA",       "C", 25, 0 },  { "ESTA",       "C", 02, 0 },  { "ATUALIZADO", "D", 08, 0 },  { "BAIR",       "C", 20, 0 }}})








Aadd( aArquivos, { "SERVIDOR.DBF", {{ "CODI",    "C", 04, 0 },  { "NOME",    "C", 40, 0 },  { "SENHA",   "C", 10, 0 }, { "CARGO",   "C", 30, 0 },  { "QUANT",   "N", 09, 2 },  { "ATUALIZADO", "D", 08, 0 }, { "CARGA",   "N", 09, 2 }}})









Aadd( aArquivos, { "PONTO.DBF", {{ "CODI",    "C", 04, 0 },  { "DATA",    "D", 08, 0 },  { "QUANT",   "N", 09, 2 },  { "MANHA1",  "C", 05, 0 },  { "MANHA2",  "C", 05, 0 },  { "TARDE1",  "C", 05, 0 },  { "ATUALIZADO", "D", 08, 0 }, { "TARDE2",  "C", 05, 0 }}})




















Aadd( aArquivos, { "PRINTER.DBF", {{ "CODI",      "C", 02, 0 }, { "NOME",      "C", 40, 0 }, { "_CPI10",    "C", 40, 0 }, { "_CPI12",    "C", 40, 0 }, { "GD",        "C", 40, 0 }, { "PQ",        "C", 40, 0 }, { "NG",        "C", 40, 0 }, { "NR",        "C", 40, 0 }, { "CA",        "C", 40, 0 }, { "C18",       "C", 40, 0 }, { "LIGSUB",    "C", 40, 0 }, { "DESSUB",    "C", 40, 0 }, { "_SALTOOFF", "C", 40, 0 }, { "_SPACO1_8", "C", 40, 0 }, { "_SPACO1_6", "C", 40, 0 }, { "RESETA",    "C", 40, 0 }, { "LIGITALIC", "C", 40, 0 }, { "DESITALIC", "C", 40, 0 }, { "ATUALIZADO", "D", 08, 0 }}})



Aadd( aArquivos, { "CONTA.DBF", {{ "CODI",       "C", 02, 0 }, { "HIST",       "C", 40, 0 }, { "ATUALIZADO", "D", 08, 0 }}})




Aadd( aArquivos, { "SUBCONTA.DBF", {{ "CODI",       "C", 02, 0 }, { "SUBCODI",    "C", 04, 0 }, { "DEBCRE",     "C", 01, 0 }, { "ATUALIZADO", "D", 08, 0 }}})












Aadd( aArquivos, { "RETORNO.DBF", {{"ID",         "N", 07, 0 },    {"CODI",       "C", 05, 0 },    {"EMPRESA",    "C", 40, 0 },    {"INTERNO",    "C", 12, 0 },    {"CODIGO",     "C", 13, 0 },    {"HORA",       "C", 08, 0 },    {"VERSAO",     "N", 01, 0 },    {"LIMITE",     "D", 08, 0 },    {"DATA",       "D", 08, 0 },    {"NOME",       "C", 10, 0 },    {"ATUALIZADO", "D", 08, 0 }}})







































Aadd( aArquivos, { "PREVENDA.DBF",{{ "CODIGO",     "C", 06, 0 },  { "CODIVEN",    "C", 04, 0 },  { "CODI",       "C", 05, 0 },  { "NOME",       "C", 40, 0 },  { "FATURA",     "C", 07, 0 },  { "EMIS",       "D", 08, 0 },  { "PVENDIDO",   "N", 11, 2 },  { "UNITARIO",   "N", 11, 2 },  { "DESCONTO",   "N", 05, 2 },  { "DESCMAX",    "N", 06, 2 },  { "SAIDA",      "N", 09, 2 },  { "QUANT",      "N", 09, 2 },  { "ATACADO",    "N", 11, 2 },  { "VAREJO",     "N", 11, 2 },  { "PCUSTO",     "N", 11, 2 },  { "VLRFATURA",  "N", 13, 2 }, { "DESCRICAO",  "C", 40, 0 }, { "UN",         "C", 02, 0 }, { "TAM",        "C", 06, 0 }, { "SIGLA",      "C", 10, 0 }, { "PORC",       "N", 05, 2 }, { "TOTAL",      "N", 13, 2 }, { "SERIE",      "C", 10, 0 }, { "FORMA",      "C", 02, 0 }, { "APARELHO",   "C", 20, 0 }, { "MARCA",      "C", 20, 0 }, { "MODELO",     "C", 20, 0 }, { "NRSERIE",    "C", 20, 0 }, { "OBS",        "C", 40, 0 }, { "OBS1",       "C", 40, 0 }, { "OBS2",       "C", 40, 0 }, { "ENDE",       "C", 25, 0 }, { "FONE",       "C", 14, 0 }, { "REGIAO",     "C", 02, 0 }, { "ANO",        "C", 04, 0 }, { "COR",        "C", 20, 0 }, { "PLACA",      "C", 08, 0 }, { "ESTADO",     "C", 20, 0 }, { "ATUALIZADO", "D", 08, 0 }}})




Aadd( aArquivos, { "GRPSER.DBF", {{ "GRUPO",      "C", 03, 0 },     { "DESGRUPO",   "C", 40, 0 },     { "ATUALIZADO", "D", 08, 0 }}})






Aadd( aArquivos, { "SERVICO.DBF", {{ "CODISER",    "C", 03, 0 },     { "NOME",       "C", 40, 0 },     { "GRUPO",      "C", 03, 0 },     { "ATUALIZADO", "D", 08, 0 },    { "VALOR",      "N", 13, 4 }}})








Aadd( aArquivos, { "CORTES.DBF", {{ "TABELA",     "C", 08, 0 },     { "QTD",        "N", 05, 0 },     { "SOBRA",      "N", 05, 0 },     { "CODISER",    "C", 03, 0 },     { "CODIGO",     "C", 06, 0 },     { "ATUALIZADO", "D", 08, 0 },    { "DATA",       "D", 08, 0 }}})









Aadd( aArquivos, { "MOVI.DBF", {{ "TABELA",     "C", 08, 0 },    { "QTD",        "N", 05, 0 },    { "CODIVEN",    "C", 04, 0 },    { "CODISER",    "C", 03, 0 },    { "CODIGO",     "C", 06, 0 },    { "BAIXADO",    "L", 01, 0 },    { "ATUALIZADO", "D", 08, 0 },    { "DATA",       "D", 08, 0 }}})











Aadd( aArquivos, { "FUNCIMOV.DBF", {{ "CODIVEN",   "C", 04, 0 },     { "CODI",      "C", 04, 0 },     { "CRE",       "N", 11, 4 },     { "DEB",       "N", 11, 4 },     { "VLR",       "N", 11, 4 },     { "DOCNR",     "C", 09, 0 },     { "DATA",      "D", 08, 0 },     { "DESCRICAO", "C", 40, 0 },     { "ATUALIZADO","D", 08, 0 },    { "COMISSAO",  "N", 13, 4 }}})
















Aadd( aArquivos, { "RECIBO.DBF", {{ "ID",         "+", 04, 0 },  { "TIPO",       "C", 06, 0 },  { "CODI",       "C", 05, 0 },  { "NOME",       "C", 40, 0 },  { "VLR",        "N", 13, 2 },  { "FATURA",     "C", 09, 0 },  { "DOCNR",      "C", 09, 0 },  { "DOCNRANT",   "C", 09, 0 },  { "VCTO",       "D", 08, 0 },  { "DATA",       "D", 08, 0 },  { "HORA",       "C", 08, 0 },  { "USUARIO",    "C", 10, 0 },  { "CAIXA",      "C", 04, 0 },  { "ATUALIZADO", "D", 08, 0 },  { "HIST",       "C", 120, 0 }}})










Aadd( aArquivos, { "AGENDA.DBF", {{ "ID",         "+", 04, 0 },     { "CODI",       "C", 05, 0 },  { "HIST",       "C", 132, 0 },  { "DATA",       "D", 08, 0 },  { "HORA",       "C", 08, 0 },  { "USUARIO",    "C", 10, 0 },  { "CAIXA",      "C", 04, 0 },  { "ULTIMO",     "L", 01, 0 },  { "ATUALIZADO", "D", 08, 0 }}})








Aadd( aArquivos, { "CM.DBF", {{ "CODI",       "C", 05, 0 },  { "INICIO",     "D", 08, 0 },  { "FIM",        "D", 08, 0 }, { "INDICE",     "N", 09, 4 },  { "OBS",        "C", 40, 0 },  { "ULTIMO",     "L", 01, 0 },  { "ATUALIZADO", "D", 08, 0 }}})

Return( aArquivos )



function Configuracao( lMicrobras, lNaoMostrarConfig)

    LOCAL nX         := 1
    LOCAL nChoice    := 1
    LOCAL cString    := ""
    LOCAL cUnidade := ""
    LOCAL cCurDir  := FCurdir()
    LOCAL cPath    := FCurdir()
    LOCAL cTemp     := StrTran( Time(),":")
    LOCAL cDbf     := "SCI.DBF"
    LOCAL cCfg
    LOCAL cBase
    LOCAL cDia
    LOCAL cMes
    LOCAL cAno
    LOCAL lPiracy
    LOCAL i
    LOCAL dDate
    LOCAL nHandle
    LOCAL nErro
    LOCAL Handle
    LOCAL xMicrobras
    LOCAL xEndereco
    LOCAL xTelefone
    LOCAL xCidade
    LOCAL aEnde_String := {}
    LOCAL aEnde_Codigo := {}
    LOCAL aMensagem     := Array(2,5)
            aMensagem[1,1] := "[Limite de Codigo de Acesso Vencido]"
            aMensagem[1,2] := "1 - A data do Sistema Operacional esta correta ?"
            aMensagem[1,3] := "2 - O arquivo SCI.EXE esta com data diferente do DOS ?"
            aMensagem[1,4] := "3 - Caso Negativo, solicite novo Codigo de Acesso."
            aMensagem[1,5] := ""

            aMensagem[2,1] := "[Verificacao de Copia Original]"
            aMensagem[2,2] := "1 - O SCI esta sendo instalado pela 1?vez ?"
            aMensagem[2,3] := "2 - Esta atualizando a versao do SCI ?"
            aMensagem[2,4] := "3 - Esta instalando um novo terminal ?"
            aMensagem[2,5] := "4 - Caso Afirmativo, solicite Codigo de Acesso."


    if( lMicrobras = NIL, lMicrobras := .F., lMicrobras )
    if( lNaoMostrarConfig = NIL, lNaoMostrarConfig := .F., lNaoMostrarConfig )
    PUBLIC XNOMEFIR
    PUBLIC SISTEM_NA1
    PUBLIC SISTEM_NA2
    PUBLIC SISTEM_NA3
    PUBLIC SISTEM_NA4
    PUBLIC SISTEM_NA5
    PUBLIC SISTEM_NA6
    PUBLIC SISTEM_NA7
    PUBLIC SISTEM_NA8
    PUBLIC SISTEM_VERSAO
    PUBLIC XNOME_EXE

    cBase := oAmbiente:xroot
    CenturyOn()
    FT_ChDir(cbase)
    LETO_SET( 7, (cBase) )

    if !lNaoMostrarConfig
        Qout("þ Localizando Arquivo SCI.DBF.")
    endif

    if !file(cDbf)
        SetColor("")
        Scroll() ; SetPos( 0, 0 )





        AlertaPy("ERRO #0:" + ltrim(rtrim(ProcLine(0))) + " Verifique os parametros abaixo: ;-;;" +     "     Tipo de Erro : " + "SCI.DBF nao foi localizado                               " + ";" +     " Endereco IP:port : " + cBase + ";-;;" +     "             Acao : " + "Verifique se o servidor LETO esta ativo ou modo LOCKED,ou" + ";" +     "                  : " + "parametros passados estao corretos                       " + ";" +     "         Parametro: " + ltrim(rtrim(oAmbiente:HB_Argv(1))), 31, .F., .T., {" Encerrar "})
        __Quit()
    endif

    QQout("þ OK")
    LETO_SET( 7, (cBase) )
    Qout("þ Abrindo Arquivo SCI.DBF em " + cPath)

    if !NetUse(cDbf, .T. )
        __Quit()
    endif

    QQout("þ OK")
    Qout("þ Lendo Arquivo SCI.DBF em " + cBase)
    For x := 1 To Sci->(FCount())
        IF Sci->(FieldName( x )) <> "TIME"
            IF Sci->(Empty( FieldGet( x )))
                EncerraDbf( FieldName( x ), Procname(), ProcLine())
            End
        End
    Next

    IF ( XNOMEFIR                 := Sci->( ltrim(rtrim(Nome)))) <> Sci->( MsDecrypt( ltrim(rtrim(Empresa)))) .OR. Empty( XNOMEFIR   )     ; EncerraDbf(, ProcName(1), ProcLine(1)) ; EndIF
    IF ( SISTEM_NA1             := Sci->( ltrim(rtrim(Nome_Sci)))) <> Sci->( MsDecrypt( ltrim(rtrim(Codi_Sci)))) .OR. Empty( SISTEM_NA1 )     ; EncerraDbf(, ProcName(1), ProcLine(1)) ; EndIF
    IF ( SISTEM_NA2             := Sci->( ltrim(rtrim(Nome_Est)))) <> Sci->( MsDecrypt( ltrim(rtrim(Codi_Est)))) .OR. Empty( SISTEM_NA2 )     ; EncerraDbf(, ProcName(1), ProcLine(1)) ; EndIF
    IF ( SISTEM_NA3             := Sci->( ltrim(rtrim(Nome_Rec)))) <> Sci->( MsDecrypt( ltrim(rtrim(Codi_Rec)))) .OR. Empty( SISTEM_NA3 )     ; EncerraDbf(, ProcName(1), ProcLine(1)) ; EndIF
    IF ( SISTEM_NA4             := Sci->( ltrim(rtrim(Nome_Pag)))) <> Sci->( MsDecrypt( ltrim(rtrim(Codi_Pag)))) .OR. Empty( SISTEM_NA4 )     ; EncerraDbf(, ProcName(1), ProcLine(1)) ; EndIF
    IF ( SISTEM_NA5             := Sci->( ltrim(rtrim(Nome_Che)))) <> Sci->( MsDecrypt( ltrim(rtrim(Codi_Che)))) .OR. Empty( SISTEM_NA5 )     ; EncerraDbf(, ProcName(1), ProcLine(1)) ; EndIF
    IF ( SISTEM_NA6             := Sci->( ltrim(rtrim(Nome_Ven)))) <> Sci->( MsDecrypt( ltrim(rtrim(Codi_Ven)))) .OR. Empty( SISTEM_NA6 )     ; EncerraDbf(, ProcName(1), ProcLine(1)) ; EndIF
    IF ( SISTEM_NA7             := Sci->( ltrim(rtrim(Nome_Pro)))) <> Sci->( MsDecrypt( ltrim(rtrim(Codi_Pro)))) .OR. Empty( SISTEM_NA7 )     ; EncerraDbf(, ProcName(1), ProcLine(1)) ; EndIF
    IF ( SISTEM_NA8             := Sci->( ltrim(rtrim(Nome_Pon)))) <> Sci->( MsDecrypt( ltrim(rtrim(Codi_Pon)))) .OR. Empty( SISTEM_NA8 )     ; EncerraDbf(, ProcName(1), ProcLine(1)) ; EndIF
    IF ( SISTEM_VERSAO         := Sci->( ltrim(rtrim(Nome_Ver)))) <> Sci->( MsDecrypt( ltrim(rtrim(Codi_Ver)))) .OR. Empty( SISTEM_VERSAO ) ; EncerraDbf(, ProcName(1), ProcLine(1)) ; EndIF
    IF Empty(( XNOME_EXE      := Sci->(MsDecrypt( ltrim(rtrim(NomeExe)))))) ; EncerraDbf(, ProcName(), ProcLine()) ; EndIF
        oAmbiente:XLIMITE     := Sci->Limite
    lPiracy := ltrim(rtrim(XCFGPIRACY)) <> Sci->( ltrim(rtrim(Empresa)))
    Sci->(DbCloseArea())
    IF lPiracy
        SetColor("")
        Scroll() ; SetPos( 0, 0 )
        ErrorBeep()
        Alert( "Erro #0: Favor instalar arquivo SCI.DBF original.")
        __Quit()
    EndIF
    QQout("þ OK")


    IF !lNaoMostrarConfig
        Qout("þ Localizando Arquivo SCI.CFG.")
    EndIF

    cPath := cCurDir
    cCfg  := cPath + "\SCI.CFG"
    FT_ChDir( cPath )
    LETO_SET( 7, (cPath) )
    IF !File(cCfg)
        cPath := oAmbiente:xBase
        cCfg  := cPath + "\SCI.CFG"
        IF !File( cCfg )
            SetColor("")
            Scroll() ; SetPos( 0, 0 )


            Alert( "Erro #1: Arquivo SCI.CFG" +  ";Nao localizado em: " + cCurdir + Space(Len(cCurdir+cPath)-Len(cCurdir)) +  ";Nao localizado em: " + cPath   + Space(Len(cCurdir+cPath)-Len(cPath)))
            __Quit()
        EndIF
        cPath := oAmbiente:xBase
    EndIF
    QQout("þ OK")
    Qout("þ Abrindo Arquivo SCI.CFG em " + cPath)
    Handle := FOpen(cCfg)
    IF ( Ferror() <> 0 )
        FClose( Handle )
        SetColor("")
        Scroll() ; SetPos( 0, 0 )
        Alert( "Erro #3: Erro de Abertura do Arquivo SCI.CFG.")
        __Quit()
    EndIF
    Qout("þ Lendo Arquivo SCI.CFG em " + cPath)
    QQout("þ OK")

    nErro := FLocate( Handle, "[ENDERECO_STRING]")
    IF nErro < 0
        SetColor("")
        Scroll() ; SetPos( 0, 0 )
        Alert( "Erro #4: Configuracao de SCI.CFG alterada. [ENDERECO_STRING]")
        __Quit()
    EndIF
    FAdvance( Handle )
    For nX := 1 To 4
        Aadd( aEnde_String, ltrim(rtrim(FReadLine( Handle ))))
    Next

    nErro := FLocate( Handle, "[ENDERECO_CODIGO]")
    IF nErro < 0
        SetColor("")
        Scroll() ; SetPos( 0, 0 )
        Alert( "Erro #5: Configuracao de SCI.CFG alterada. [ENDERECO_CODIGO]")
        __Quit()
    EndIF
    FAdvance( Handle )
    For nX := 1 To 4
        Aadd( aEnde_Codigo, MsDecrypt( ltrim(rtrim(FReadLine( Handle )))))
    Next
    For nX := 1 To 4
        IF aEnde_Codigo[nX] <> aEnde_String[nX]
            SetColor("")
            Scroll() ; SetPos( 0, 0 )
            Alert("Erro #6: Configuracao de SCI.CFG alterada. [ENDERECO_CODIGO]")
            __Quit()
        EndiF
    Next
    FClose( Handle )
    VerExe()
    IF !lNaoMostrarConfig
        Qout("Verificando Aplicativo.")
    EndIF

    oAmbiente:xDataCodigo := MsDecrypt( oAmbiente:XLIMITE )
    cDia                         := SubStr( oAmbiente:xDataCodigo, 4, 2 )
    cMes                         := Left(  oAmbiente:xDataCodigo, 2 )
    cAno                         := Right( oAmbiente:xDataCodigo, 4 )
    oAmbiente:xDataCodigo := cDia + "/" + cMes + "/" + cAno
    IF !lMicrobras

        LETO_SET( 4, iif( __SetCentury(), "mm-dd-yyyy", "mm-dd-yy" ) )
        cLimite     := MsDecrypt( oAmbiente:XLIMITE )
        cDataDos     := Dtoc( Date())
        cTela         := SaveScreen()
        IF Ctod( cDataDos ) > Ctod( cLimite )
            Hard( 1, ProcName(), ProcLine() )
        EndIF
        LETO_SET( 4, iif( __SetCentury(), "dd/mm/yyyy", "dd/mm/yy" ) )
        ResTela( cTela )
        IF !lNaoMostrarConfig
            Qout("Verificando Sistema Instalado.")
        EndIf
        cUnidade := Left( Getenv("COMSPEC"), 2 )
        IF !CopyOk()
            Hard( 2, ProcName(), ProcLine() )
            CopyCria()
        EndIF
    EndIF



    CenturyOff()
    FT_ChDir( oAmbiente:xBaseDados )
    LETO_SET( 7, ( oAmbiente:xBaseDados ) )
    return





function ms_swap_use(cBcoDados, lModo, cAlias)
    LOCAL cExt       := GetFileExtension(cBcoDados)
    LOCAL cBcoSemExt := StrTran( cBcoDados, cExt)

    hb_default(@lModo, .F.)
    hb_default(@cAlias, cBcoDados)
    cBcoDados := Upper(cBcoDados)
    cAlias    := Iif( cAlias = NIL, cBcoSemExt, cAlias )

    if (oAmbiente:Letoativo)
        cBcoDados := oAmbiente:LetoPath + cBcoDados
    endif

    if lModo
        dbUseArea( .T.,, (cBcoDados), (cAlias), iif( .T. .OR. .F., ! .F., NIL ), .F. )
    else
        dbUseArea( .T.,, (cBcoDados), (cAlias), iif( .F. .OR. .T., ! .T., NIL ), .F. )
    endif





function GetFileExtension(cFile)

    return( UPPER( SUBSTR( cFile, AT( ".", cFile ) + 1, 3 )))





function ms_swap_dbcreate(cFile, aStru)
    LOCAL cLocalFile := ms_swap_sep(cFile)
    return DbCreate(cLocalFile, aStru)




function ms_swap_ferase(cFile)
    LOCAL cLocalFile := ms_swap_sep(cFile)

    if (oAmbiente:Letoativo)
        return leto_ferase(cLocalFile)
    else
        return Ferase(cLocalFile)
    endif





function ms_swap_rename(cFile, cNewFile)
    LOCAL cLocalFile := ms_swap_sep(cFile)
    LOCAL cLocalNew  := ms_swap_sep(cNewFile)

    if (oAmbiente:Letoativo)
        return (leto_frename(cLocalFile, cLocalNew) == 0)
    else
        return FRename(cLocalFile, cLocalNew)
    endif





function ms_swap_sep(cFile)
    LOCAL cOldFile := cFile


    if right(ltrim(rtrim(oAmbiente:xBase)),1) == "/" .OR.  right(ltrim(rtrim(oAmbiente:xBase)),1) == "\"
        cBase := left(oAmbiente:xBase, len(oAmbiente:xBase)-1)
    else
        cBase := oAmbiente:xBase
    endif
    if (oAmbiente:Letoativo)
        _SEP_ := "/"
    else
        _SEP_ := "\"
    endif
    cFile := cBase + _SEP_ + cFile
















    return(cFile)




function ms_swap_dir(cFile)
    LOCAL cBase := ltrim(rtrim(oAmbiente:xRoot))

    if right(cBase, 1) == "/" .OR. right(cBase, 1) == "\"
        cBase := left(cBase, len(cBase)-1)
    endif
    cBase += "\"
    return(cBase)


function ms_swap_tmp()
    LOCAL cBase := ltrim(rtrim(oAmbiente:xRoot))

    if right(cBase, 1) == "/" .OR. right(cBase, 1) == "\"
        cBase := left(cBase, len(cBase)-1)
    endif
    cBase += "\"
    cBase += "TMP"
    cBase += "\"
    return(cBase)




function ms_swap_file(cFile)
    LOCAL cLocalFile := ms_swap_sep(cFile)



    if (oAmbiente:LetoAtivo)
        return Leto_File(cLocalFile)
    endif
    return File(cLocalFile)




function ms_swap_fopen(cFile, modo)
    LOCAL cLocalFile := ms_swap_sep(cFile)
    LOCAL Handle

    if (oAmbiente:Letoativo)
        handle := leto_fopen(cLocalFile, Modo)













        return handle
    else
        return Fopen(cFile, Modo)
    endif




function ms_swap_fcreate(cFile, modo)
    LOCAL cLocalFile := ms_swap_sep(cFile)
    LOCAL handle

    if (oAmbiente:Letoativo)
        handle := leto_fcreate(cLocalFile, modo)














        return handle
    else
        return Fcreate(cLocalFile, modo)
    endif




function ms_swap_ferror()
   LOCAL nError

    if (oAmbiente:Letoativo)
        return leto_ferror()
    else
        return Ferror()
    endif




function ms_swap_fclose(handle)

    if (oAmbiente:Letoativo)
        return leto_fclose(handle)
    else
        return Fclose(handle)
    endif




function ms_swap_fseek(handle, n, modo)

    if (oAmbiente:Letoativo)
        return leto_fseek(handle, n, modo)
    else
        return fseek(handle, n, modo)
    endif




function ms_swap_fwrite(handle, cbuffer)

    if (oAmbiente:Letoativo)
        return(leto_fwrite(handle, cbuffer))
    else
        return(fwrite(handle, cbuffer))
    endif




function ms_swap_fread(Handle, cBuffer, nFileLen)

    if (oAmbiente:Letoativo)
        return leto_fread(Handle, @cBuffer, nFileLen)
    else
        return fread(Handle, @cBuffer, nFileLen)
    endif




function ms_swap_extensao(cFile, cNewExt)
    LOCAL cOldExt  := GetFileExtension(cFile)
    LOCAL cNewFile

    cNewFile := Left(cFile, len(cFile)-4)
    cNewFile += cNewExt

    return cNewFile




function GetRoot(cstring)
    LOCAL nLen    := len(cstring)
    LOCAL sep     := "\"
    LOCAL npos    := 0

    if (npos := rat( sep, cString)) > 0

      return(left(cstring, --npos))
    endif
    return ""



function ms_mem_dbCreate(cFile, aStru, cAlias, _rddname)






































    EXTERNAL HB_MEMIO
    hb_default(@cFile, FTempMemory())
    hb_default(@cAlias, cFile)
    hb_default(@_rddname, nil)
    dbCreate( "mem:" + (cFile), aStru, _rddname, .T., cAlias)
    return Alias()




function ms_mem_dbclosearea(cFile)
    (cFile)->(DbCloseArea())
   dbDrop( "mem:" + (cFile))
    return nil




function truefalse(xvar)
    if xvar
        return "true"
    else
        return "false"
    endif




function formatavar(xvar)
    switch valtype(xvar)
        case "C"
            return(ltrim(rtrim(xvar)))
        case "N"
            return(ltrim(rtrim(xvar)))
        case "L"
            return(truefalse(xvar))
        case "D"
            return(dtoc(xvar))
    endswitch




function Acesso( lNaoMostrarConfig )

    RddSetDefault("DBFCDX")
    if( lNaoMostrarConfig = NIL, lNaoMostrarConfig := .F., lNaoMostrarConfig )

        oAmbiente:Ano2000On()



    oAmbiente:lComCodigoAcesso := .F.

        Configuracao( .T., lNaoMostrarConfig )
        AcessoLeto()
        LogoTipo()
        Return nil






    oAmbiente:lComCodigoAcesso := .T.
    Configuracao(NIL, lNaoMostrarConfig )
    AcessoLeto()
    LogoTipo()
    return nil




function acessoLeto()

        SetaIniLeto()
        if (oAmbiente:LetoAtivo)
            LoginLeto()
        endif







function CriarDiretorios()
    FT_MkDir( ms_swap_dir() + "SPOOLER")
    FT_MkDir( ms_swap_dir() + "TMP" )
    return nil




function SetaIniLeto()

    LOCAL cPathLocal := FCurdir()
    LOCAL cPath      := oAmbiente:xBase
    LOCAL nPort      := 2812
    LOCAL nHost      := "127.0.0.1"
    LOCAL cString    := ""
    LOCAL cTela
    LOCAL nChoice



    LOCAL aPrompt    := {" 1. Continuar a conexao local",    " 2. Conectar ao servidor LETO configurado",     " 3. Encerrar Execucao do Sistema"    }

    CriarDiretorios()
    Qout("þ Iniciando Conexao com Servidor LETO.")
    cTela := SaveScreen()
    if oAmbiente:HB_Argc    == 0
        cLetoIP             := oIni:ReadString("LETO", "ip")
        cLetoPort           := oIni:ReadString("LETO", "port")

        oAmbiente:LetoIp    := cLetoIP
        oAmbiente:LetoPort  := cLetoPort
        cPath               := oAmbiente:GetLetoPath()
        oAmbiente:LetoPath  := cPath
        oAmbiente:LetoAtivo := .F.



            oAmbiente:LetoAtivo := .T.
            cString             := oAmbiente:ShowVarLeto(nil, nil, .F.)
            ErrorBeep()




            nChoice := AlertaPy(    "!AVISO! SERVIDOR TCP/IP LETO CONFIGURADO EM " + cPathLocal + "\SCI.INI FOI DETECTADO." +     + ";-;" + cString +     ";-;" + space(27) + "Escolha uma opcao abaixo:", 31, .F., .T., aPrompt    )
            if     nchoice == 0 .OR. nChoice == 3
                Terminate()
            elseif nChoice == 1
                leto_DisConnect()
                oAmbiente:LetoAtivo := .F.
                RddSetDefault("DBFCDX")
                return .F.
            elseif nChoice == 2
                RddSetDefault("LETO")

                LETO_TOGGLEZIP( 1 )
                oAmbiente:xBase    := cPath
                oAmbiente:LetoPath := cPath
                return .T.
            endif

        RddSetDefault("DBFCDX")
        return .F.

   else
        cPath := HB_Argv(1)
        if !":\" $ cPath
            if !"//" $ cPath
                cPath := "//" + cPath
            endif
            if !":" $ cPath
                cPath := cPath + iiF( ":" $ cPath, "", ":" + ltrim(rtrim(nPort)))
            endif
            cPath += iif( right(cPath,1) == "/", "", "/" )
            oAmbiente:ShowVarLeto(.F., ";-;Aguarde... Tentando conexao com servidor Leto em:;-;;" + cPath)
            RddSetDefault("LETO")
        else
            if !hb_vfDirExists(cPath )




                AlertaPy("ERRO #2:" + ltrim(rtrim(ProcLine(0))) + " Verifique os parametros abaixo: ;-;;" +     "     Tipo de Erro : " + "Diretorio de trabalho inexistente passado como parametro" + ";" +     "        Parametro : " + ltrim(rtrim(HB_Argv(1))) + ";-;;" +     "             Acao : " + "Crie o diretorio de trabalho ou altere o parametro passado" + ";" +     "           Teclas : " + "ESC encerrar, ENTER continuar", 31, .F., .T., {" Iniciar modo local "})

                if lastkey() == 27
                    Terminate()
                endif
                oAmbiente:xBase := oAmbiente:xRoot
            endif
            oAmbiente:xBase := cPath
            RddSetDefault("DBFCDX")
            return .F.
        endif
    endif

    oAmbiente:LetoAtivo := .T.
    oAmbiente:xBase     := cPath
    if leto_Connect(cPath,,,20000) == ( -1 )
       restela(cTela)





        AlertaPy("ERRO #1:" + ltrim(rtrim(ProcLine(0))) + " Verifique os parametros abaixo: ;-;;" +     "     Tipo de Erro : " + "Servidor Leto nao localizado                             " + ";" +     " Endereco IP:port : " + cPath + ";-;;" +     "             Acao : " + "Verifique se o servidor LETO esta ativo ou modo LOCKED,ou" + ";" +     "                  : " + "parametros passados estao corretos                       " + ";" +     "         Parametro: " + ltrim(rtrim(HB_Argv(1))), 31, .F., .T., {" Iniciar modo local "})

        if lastkey() == 27
           Terminate()
        endif

        oAmbiente:LetoAtivo := .F.
        oAmbiente:xBase     := cPath := FCurdir()
        RddSetDefault("DBFCDX")
        return .F.
    endif

    if leto_Connect(cPath) == ( -1 )
        MSG("Falha de login (LETO_ERR_LOGIN)", "Macrosoft SCI")
        return nil
    endif
    Leto_disconnect()





function GetIp()

    LOCAL aHosts
    LOCAL cEstacao := NETNAME(.F.)

    HB_InetInit()
    aHosts := HB_InetGetHosts( cEstacao )
    IF aHosts == NIL
        aHosts := HB_InetGetAlias( cEstacao )
    END
    IF EMPTY(aHosts)
        aHosts := HB_InetGetAlias( cEstacao )
    END
    HB_InetCleanup()
    return aHosts





function LoginLeto()
    if leto_Connect( oAmbiente:xBase) == ( -1 )
        if leto_Connect( oAmbiente:LetoPath ) == ( -1 )
            nRes := leto_Connect_Err()
            IF nRes == 2
                MSG("Falha de login (LETO_ERR_LOGIN)", "Macrosoft SCI")
            ELSEIF nRes == 4
                MSG("Erro de Recepcao (LETO_ERR_RECV)", "Macrosoft SCI")
            ELSEIF nRes == 5
                MSG("Erro de Transmissao (LETO_ERR_SEND)", "Macrosoft SCI")
            ELSE
                MSG("Sem conexao", "Macrosoft SCI")
            ENDIF
            return .F.
        ENDIF

        oAmbiente:xBase := oAmbiente:LetoPath
        return .T.
    endif

    oAmbiente:LetoPath := oAmbiente:xBase
    return .T.

