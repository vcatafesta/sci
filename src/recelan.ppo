#line 12 "c:\sci\include\rddName.ch"
    EXTERNAL leto
    EXTERNAL DBFNTX
   EXTERNAL DBFCDX


    EXTERNAL DBFFPT
    EXTERNAL SIXCDX
    EXTERNAL DBFNSX
    EXTERNAL HB_MEMIO
#line 19 "recelan.prg"
function Recelan()

LOCAL Op          := 1
LOCAL lOk            := .T.
PUBLI cVendedor   := Space(40)
PUBLI cCaixa        := Space(04)


AbreArea()
oMenu:Limpa()
if !VerSenha( @cCaixa, @cVendedor )
    Mensagem("Aguarde, Fechando Arquivos." )
    DbCloseAll()
    SetKey( -1, NIL )
    SetKey( -2, NIL )
    return
endif

SetKey( -4,           {|| ClientesDbEdit() })
SetKey( -7,           {|| AcionaSpooler()})
SetKey( 23,           {|| GravaDisco()})

SetKey( 302, {|| Altc()})
oMenu:Limpa()

Op := 1
RefreshClasse()
WHILE lOk
    BEGIN Sequence
        Op := oMenu:Show()
        oAmbiente:cTipoRecibo := "RECCAR"
        Do Case
        Case Op = 0.0 .OR. Op = 1.01
            ErrorBeep()
            if Conf("Pergunta: Encerrar este modulo ?")
            oMenu:nPos := 1
                GravaDisco()
                lOk := .F.
                Break
            endif
        Case op = 2.01 ; CliInclusao()
        Case op = 2.02 ; CliAltera()
        Case op = 2.03 ; CliAltera()
        Case op = 2.04 ; CliAltera()
        Case op = 2.05 ; ClientesFiltro()
        Case op = 2.06 ; ClientesDbedit()
        Case op = 2.07 ; MarDesmarcaCliente()
        Case op = 2.08 ; AnexarAgendaAntiga()
        Case op = 2.09 ; AnexarLogRecibo()
      Case op = 2.10 ; BidoToRecibo()
      Case op = 2.11 ; FoneTroca()
        Case op = 3.01 ; AlteraReceber()
        Case op = 3.02 ; AlteraRecebido()
      Case op = 3.03 ; MenuTxJuros(op)
      Case op = 3.04 ; MenuTxJuros(op)
        Case op = 3.05 ; AltRegTitRec()
        Case op = 3.06 ; AltRegTitPag()
        Case op = 3.07 ; ReajTitulos()
        Case op = 3.08 ; RemoveCobranca()
        Case op = 3.09 ; RemoveAgenda()
        Case op = 3.10 ; AltRegCfop()
        Case op = 3.11 ; TrocaCliente(cCaixa)
        Case op = 3.12 ; TrocaCobAgenda()
        Case op = 3.13 ; AgendaDbedit()
        Case op = 4.01 ; Lancamentos(cCaixa)
        Case op = 4.02 ; iif(PodeReceber(), BaixasRece( cCaixa, cVendedor ), NIL)
        Case op = 4.03 ; Exclusao()
        Case op = 4.04 ; FechtoMes()
        Case op = 4.05 ; AgeCobranca()
        Case op = 4.06 ; ImpExpGetDados()
        Case op = 4.07 ; CancelaContrato()
        Case op = 4.08 ; LancaDespesasDiversas(cCaixa, cVendedor, "RECIBO")
        Case op = 4.09 ; ReciboDiv( cCaixa, cVendedor )
        Case op = 5.01 ; RelCli()
        Case op = 5.02 ; RelReceber()
        Case op = 5.03 ; RelRecebido()
        Case op = 5.04 ; EtiquetasClientes()
        Case op = 5.05 ; CobTitulo()
        Case op = 5.06 ; Extrato()
      Case op = 5.07 ; MenuDuplicata()
      Case op = 5.08 ; DiretaLivre()
      Case op = 5.09 ; MenuPromissoria()
      Case op = 5.10    ; ReciboRegiao()
      Case op = 5.11 ; ReciboIndividual(cCaixa, cVendedor)
      Case op = 5.12 ; ReciboDiv( cCaixa, cVendedor )
      Case op = 5.13 ; Carta( .F. )
      Case op = 5.14 ; CarnePag()
      Case op = 5.15 ; CarneCaixa()
      Case op = 5.16 ; CarneRec()
      Case op = 5.17 ; CartaSpc()
      Case op = 5.18 ; PrnDiversos(NIL,NIL,NIL, cVendedor)
      Case op = 5.19 ; FichaAtendimento( cCaixa, cVendedor )
      Case Op = 6.01 ; NewPosiReceber(1 , NIL , cCaixa )
        Case Op = 6.02 ; NewPosiReceber(2 , NIL , cCaixa )
        Case Op = 6.03 ; NewPosiReceber(3 , NIL , cCaixa )
      Case Op = 6.04 ; NewPosiReceber(4 , NIL , cCaixa )
      Case Op = 6.05 ; NewPosiReceber(5 , NIL , cCaixa )
      Case Op = 6.06 ; NewPosiReceber(6 , NIL , cCaixa )
        Case Op = 6.07 ; NewPosiReceber(1 , NIL , cCaixa, .T. )
        Case Op = 6.08
           oAmbiente:cTipoRecibo := "RECBCO"
            NewPosiReceber( 1, NIL, cCaixa )
            oAmbiente:cTipoRecibo := "RECCAR"
        Case Op = 6.09
           oAmbiente:cTipoRecibo := "RECOUT"
            NewPosiReceber( 1, NIL, cCaixa )
            oAmbiente:cTipoRecibo := "RECCAR"
        Case Op = 6.11 ; NewPosiReceber(3 , NIL , cCaixa, NIL , NIL , (oAmbiente:cTipoRecibo := "RECCAR"))
      Case Op = 6.12 ; NewPosiReceber(3 , NIL , cCaixa, NIL , NIL , (oAmbiente:cTipoRecibo := "RECBCO"))
      Case Op = 6.13 ; NewPosiReceber(3 , NIL , cCaixa, NIL , NIL , (oAmbiente:cTipoRecibo := "RECOUT"))
        Case Op = 6.14 ; NewPosiReceber(3 , NIL , cCaixa, NIL , NIL , (oAmbiente:cTipoRecibo := "RECALL"))
      Case Op = 6.16 ; ReceGrafico()
      Case Op = 6.18 ; NewPosiAgeInd()
      Case Op = 6.19 ; NewPosiAgeReg()
      Case Op = 6.20 ; NewPosiAgeAll()
        Case Op = 6.21
      Case Op = 6.22 ; SuporteIni()
      Case Op = 6.23 ; SuporteRecibo()
        Case Op = 6.24
        Case Op = 6.25 ; NewGraficoReceberDevedores(08)
        Case Op = 6.26 ; NewGraficoReceberDevedores(09)
        Case Op = 6.27 ; NewGraficoReceberDevedores(10)

        Case Op = 7.01 ; NewPosiReceber(1 , NIL , cCaixa, NIL , NIL , NIL , NIL , (oAmbiente:lRecepago := .T. ))
      Case Op = 7.02 ; NewPosiReceber(2 , NIL , cCaixa, NIL , NIL , NIL , NIL , (oAmbiente:lRecepago := .T. ))
      Case Op = 7.03 ; NewPosiReceber(3 , NIL , cCaixa, NIL , NIL , NIL , NIL , (oAmbiente:lRecepago := .T. ))
      Case Op = 7.04 ; NewPosiReceber(4 , NIL , cCaixa, NIL , NIL , NIL , NIL , (oAmbiente:lRecepago := .T. ))
      Case Op = 7.05 ; NewPosiReceber(5 , NIL , cCaixa, NIL , NIL , NIL , NIL , (oAmbiente:lRecepago := .T. ))
      Case Op = 7.06 ; NewPosiReceber(6 , NIL , cCaixa, NIL , NIL , NIL , NIL , (oAmbiente:lRecepago := .T. ))
      Case Op = 7.05
        Case Op = 7.08 ; BidoGrafico(1)
      Case Op = 7.09 ; BidoGrafico(2)
      Case Op = 7.10 ; BidoGrafico(3)
      Case Op = 7.11 ; BidoGrafico(4)
        Case Op = 7.12
        Case Op = 7.13 ; BidoGrafico(5)
        Case Op = 7.14 ; BidoGrafico(6)
        Case Op = 7.15
      Case Op = 7.16 ; NewPosiAgeInd()
      Case Op = 7.17 ; NewPosiAgeReg()
      Case Op = 7.18 ; NewPosiAgeAll()
        Case Op = 7.19
      Case Op = 7.20 ; SuporteIni()
      Case Op = 7.21 ; SuporteRecibo()


      Case op = 8.01 ; RegiaoInclusao()
      Case op = 8.02 ; RegiaoConsulta()
      Case op = 8.03 ; RegiaoConsulta()
      Case op = 8.04 ; RegiaoConsulta()

      Case op = 9.01 ; CepInclusao()
      Case op = 9.02 ; MudaCep()
      Case op = 9.03 ; MudaCep()
      Case op = 9.04 ; MudaCep()
      Case op = 9.05 ; CepPrint()

      Case op = 10.01 ; LogConsulta()
      Case op = 10.02 ; ReciboDbedit()
        Case op = 10.03 ; AjustaReciboRecemov()
        Case op = 10.04 ; AjustaRecebidoParaReciboPorFatura()
        Case op = 10.05 ; AjustaRecebidoParaReciboGeral()

      Case op = 11.01 ; CmInclusao()
      Case op = 11.02 ; CmDbEdit()
      Case op = 11.03 ; CmDbEdit()
      Case op = 11.04 ; CmDbEdit()
      Case op = 11.05 ; CmDbEdit()
        EndCase
    end
EndDo
Mensagem("Aguarde, Fechando Arquivos." )
FechaTudo()
SetKey( -1, NIL )
SetKey( -2, NIL )
return nil

function oMenuRecelan()

LOCAL AtPrompt := {}
LOCAL cStr_Suporte
LOCAL cStr_Recibo

if !aPermissao[2]
    return( AtPrompt )
endif

if oAmbiente:Mostrar_Desativados
    cStr_Suporte := "Desativar Consulta Clientes Inativos"
else
    cStr_Suporte := "Ativar Consulta Clientes Inativos"
endif
if oAmbiente:Mostrar_Recibo
    cStr_Recibo := "Desativar Checagem de Recibos"
else
    cStr_Recibo := "Ativar Checagem de Recibos"
endif
AADD( AtPrompt, {"S^air",        {"Encerrar Sessao"}})










AADD( AtPrompt, {"C^lientes",     {"Inclusao", "Alteracao", "Exclusao", "Consulta", "Consulta por Filtro", "Pesq/Altera Todos", "Marcar/Desmarcar Cliente", "Anexar Agenda Antiga", "Anexar Arquivo RECIBO.LOG", "Recebido To Recibo", "Ajustar Campo Telefone"}})













AADD( AtPrompt, {"A^lteracao",      {"Titulos a Receber", "Titulos Recebidos", "Taxa de Juro Geral", "Taxa de Juro Individual", "Regiao de Titulos a Receber", "Regiao de Titulos Recebidos", "Reajuste de Titulos", "Remover Comissao Cobrador", "Remover Agendamento", "Cfop por Regiao", "Cliente de Fatura", "Cobrador do Agendamento", "Agendamento"}})










AADD( AtPrompt, {"L^ancamentos", {"Titulos a Receber",    "Baixa de Recebimentos",    "Exclusao de Titulo",    "Fechamento Periodico",    "Agendamento de Cobranca",    "Imp/Exportacao Dados Externos",    "Cancelamento Contrato",    "Despesas Diversas",    "Recibo/Vale Diversos"    }})



















AADD( AtPrompt, {"I^mpressao",   {"Ficha/Relacao de Clientes", "Titulos a Receber", "Titulos Recebidos", "Etiquetas Clientes", "Carta Cobranca Titulos", "Extrato de Conta", "Duplicata", "Boleto Bancario", "Promissoria", "Recibo Por Regiao", "Recibo Individual", "Recibo/Vale Diversos", "Mala Direta", "Carne de Pagamento", "Carne de Pagamento Caixa", "Carne de Recebimento", "Negativar Clientes no Spc", "Documentos Diveros", "Ficha Atendimento/Ativacao"}})



























AADD( AtPrompt, {"R^eceber",     {"Consulta/Recibo Por C^liente", "Consulta/Recibo Por R^egiao", "Consulta/Recibo Por P^eriodo", "Consulta/Recibo Por T^ipo", "Consulta/Recibo Por F^atura", "Consulta/Recibo G^eral", "Consulta/Recibo Para Re^scisao", "Consulta/Recibo B^anco", "Consulta/Recibo O^utros", "", "Consulta Recebido C^arteira", "Consulta Recebido B^anco", "Consulta Recebido O^utros", "Consulta Recebido G^eral", "", "G^rafico de Contas a Receber", "", "Agendamento I^ndividual", "Agendamento por Regiao", "Agendamento por Periodo", "", cStr_Suporte, cStr_Recibo, "",    "Consulta Maiores Devedores Ativos",    "Consulta Maiores Devedores Inativos",    "Consulta Maiores Devedores"}})





















AADD( AtPrompt, {"R^ecebido",    {"Recebido Por Cliente", "Recebido por Regiao", "Recebido Por Periodo", "Recebido Por Tipo", "Recebido for Fatura", "Recebido Geral", "", "Grafico de Contas Recebidas em Carteira", "Grafico de Contas Recebidas em Banco", "Grafico de Contas Recebidas em Outros", "Grafico de Contas Recebidas Geral", "", "Grafico de Diarias Pagas", "Grafico de Pagamentos diverso", "", "Agendamento individual", "Agendamento por regiao", "Agendamento por periodo", "", cStr_Suporte, cStr_Recibo }})



Aadd( AtPrompt, {"R^egiao",      {"Inclusao", "Alteracao", "Exclusao", "Consulta"}})




Aadd( AtPrompt, {"C^ep",         {"Inclusao", "Alteracao", "Exclusao", "Consulta", "Impressao"}})




Aadd( AtPrompt, {"R^ecibo",      {"Consulta Log", "Em tabela", "Ajustar Recibo->Recemov", "Ajustar Recebido->Recibo por Fatura", "Ajustar Recebido->Recibo Geral"}})




Aadd( AtPrompt, {"C^m",          {"Inclusao", "Alteracao", "Exclusao", "Consulta", "Em tabela"}})
return( AtPrompt )

function aDispRecelan()

    LOCAL oRecelan := TIniNew(oAmbiente:xUsuario + ".INI")
    LOCAL AtPrompt := oMenuRecelan()
    LOCAL nMenuH   := Len(AtPrompt)
    LOCAL aDisp     := Array( nMenuH, 27 )
    LOCAL aMenuV   := {}

    Mensagem("Aguarde, Verificando Diretivas do CONTAS A RECEBER.")
    aDisp := ReadIni("recelan", nMenuH, aMenuV, AtPrompt, aDisp, oRecelan)
    oRecelan:Close()
    return aDisp

static function LogConsulta()


    LOCAL cFile := "RECIBO.LOG"
    oMenu:Limpa()

    if file( cFile )
        M_Title("LOG DOS RECIBOS EMITIDOS")
        M_View( 00, 00, MaxRow(), MaxCol(), cFile,  Cor())
    else
        ErrorBeep()
        alerta("Erro: Arquivo " + cFile + " nao localizado.", Cor())
    endif

static function RefreshClasse()

    oMenu:StatusSup := oMenu:StSupArray[3]
    oMenu:StatusInf := oMenu:StInfArray[3]
    oMenu:Menu         := oMenu:MenuArray[3]
    oMenu:Disp         := oMenu:DispArray[3]
    return nil

static function SuporteRecibo()

    LOCAL lMostrar := oAmbiente:Mostrar_Recibo

    oAmbiente:Mostrar_Recibo := !lMostrar
    oIni:WriteBool("sistema", "Mostrar_Recibo", !lMostrar )
    Alerta("Info: Consulta Recibo foi "+ if(!lMostrar,"LIGADO","DESLIGADO"))
    oMenu:Menu := oMenuRecelan()
    return nil


static function SuporteIni()

    LOCAL lMostrar := oAmbiente:Mostrar_Desativados AS LOGICAL

    oAmbiente:Mostrar_Desativados := !lMostrar
    oIni:WriteBool("sistema", "Mostrar_Desativados", !lMostrar )
    Alerta("Info: Consulta dos Clientes Desativados foi "+ if(!lMostrar,"LIGADO","DESLIGADO"))
    oMenu:Menu := oMenuRecelan()
    return nil

function CliInclusao( lAlteracao )

LOCAL GetList      := {}
LOCAL cScreen      := SaveScreen()
LOCAL nKey          := SetKey( -8 )
LOCAL lModificar := .F.
LOCAL cPraca      := "76970-000"
LOCAL cCep          := "76970-000"
LOCAL aNatu       := {}
LOCAL aCfop       := {}
LOCAL aTxIcms      := {}
LOCAL cSwap
LOCAL cCodi
LOCAL cString
LOCAL cNome
LOCAL cFanta
LOCAL cCgc
LOCAL cInsc
LOCAL cEnde
LOCAL cBair
LOCAL cCivil
LOCAL cCida
LOCAL cEsta
LOCAL cNatural
LOCAL cRg
LOCAL cCpf
LOCAL cEsposa
LOCAL cResp
LOCAL cEnde2
LOCAL cEnde3
LOCAL cPai
LOCAL cMae
LOCAL cEnde1
LOCAL cFone
LOCAL cFax
LOCAL cFone1
LOCAL cProf
LOCAL cCargo
LOCAL cTraba
LOCAL cFone2
LOCAL cTempo
LOCAL cRefCom
LOCAL cRefBco
LOCAL cImovel
LOCAL cVeiculo
LOCAL cConhecida
LOCAL cObs
LOCAL cObs1
LOCAL cObs2
LOCAL cObs3
LOCAL cObs4
LOCAL cObs5
LOCAL cObs6
LOCAL cObs7
LOCAL cObs8
LOCAL cObs9
LOCAL cObs10
LOCAL cObs11
LOCAL cObs12
LOCAL cObs13
LOCAL cRegiao
LOCAL dNasc
LOCAL dData
LOCAL nDepe
LOCAL nRenda
LOCAL nLimite
LOCAL nMedia
LOCAL cSpc
LOCAL dDataSpc
LOCAL cBanco
LOCAL cCancelada
LOCAL cSuporte
LOCAL cSci
LOCAL cAutorizaca
LOCAL cAssAutoriz
LOCAL cCidaAval
LOCAL cEstaAval
LOCAL cBairAval
LOCAL cFoneAval
LOCAL cFaxAval
LOCAL cRgAval
LOCAL cCpfAval
LOCAL cCFop
LOCAL nIcms
LOCAL cNatu
LOCAL lUpdated     := .F.
STATI lAtivaRegNew := .F.

SetKey( -3, {|| AtivaRegNew( @lAtivaRegNew )})
if lAlteracao <> NIL .AND. lAlteracao
    lModificar := .T.
    if !PodeAlterar()
        SetKey( -3, NIL )
        ResTela( cScreen )
        Return
    endif
endif

if !lModificar
    if !PodeIncluir()
        SetKey( -3, NIL )
        Restela( cScreen )
        Return
    endif
endif
SetKey( -8, NIL )
dbSelectArea( "Receber" )
DbSetOrder( 2 )
WHILE .T.
    oMenu:Limpa()
    cNome         := IF( lModificar, Receber->Nome,          Space( Len( Receber->Nome       )))
    cFanta        := IF( lModificar, Receber->Fanta,          Space( Len( Receber->Fanta      )))
    cCgc            := IF( lModificar, Receber->Cgc,           Space( Len( Receber->Cgc          )))
    cInsc         := IF( lModificar, Receber->Insc,          Space( Len( Receber->Insc       )))
    cEnde         := IF( lModificar, Receber->Ende,          Space( Len( Receber->Ende       )))
    cBair         := IF( lModificar, Receber->Bair,          Space( Len( Receber->Bair       )))
    cCivil        := IF( lModificar, Receber->Civil,          Space( Len( Receber->Civil      )))
    cCida         := IF( lModificar, Receber->Cida,          Space( Len( Receber->Cida       )))
    cEsta         := IF( lModificar, Receber->Esta,          Space( Len( Receber->Esta       )))
    cNatural     := IF( lModificar, Receber->Natural,      Space( Len( Receber->Natural  )))
    cRg            := IF( lModificar, Receber->Rg,              Space( Len( Receber->Rg          )))
    cCpf            := IF( lModificar, Receber->Cpf,           Space( Len( Receber->Cpf         )))
    cEsposa        := IF( lModificar, Receber->Esposa,       Space( Len( Receber->Esposa      )))
    cEnde3        := IF( lModificar, Receber->Ende3,          Space( Len( Receber->Ende3      )))
    cPai            := IF( lModificar, Receber->Pai,           Space( Len( Receber->Pai          )))
    cMae            := IF( lModificar, Receber->Mae,           Space( Len( Receber->Mae          )))
    cEnde1        := IF( lModificar, Receber->Ende1,          Space( Len( Receber->Ende1      )))
    cFone         := IF( lModificar, Receber->Fone,          Space( Len( Receber->Fone       )))
    cFax            := IF( lModificar, Receber->Fax,           Space( Len( Receber->Fax          )))
    cFone1        := IF( lModificar, Receber->Fone1,          Space( Len( Receber->Fone1      )))
    cProf         := IF( lModificar, Receber->Profissao,   Space( Len( Receber->Profissao)))
    cCargo        := IF( lModificar, Receber->Cargo,          Space( Len( Receber->Cargo      )))
    cTraba        := IF( lModificar, Receber->Trabalho,      Space( Len( Receber->Trabalho )))
    cFone2        := IF( lModificar, Receber->Fone,          Space( Len( Receber->Fone       )))
    cTempo        := IF( lModificar, Receber->Tempo,          Space( Len( Receber->Tempo      )))
    cRefCom        := IF( lModificar, Receber->RefCom,       Space( Len( Receber->RefCom      )))
    cRefBco        := IF( lModificar, Receber->RefBco,       Space( Len( Receber->RefBco      )))
    cImovel        := IF( lModificar, Receber->Imovel,       Space( Len( Receber->Imovel      )))
    cVeiculo     := IF( lModificar, Receber->Veiculo,      Space( Len( Receber->Veiculo   )))
    cConhecida    := IF( lModificar, Receber->Conhecida,   Space( Len( Receber->Conhecida )))
    cObs            := IF( lModificar, Receber->Obs,           Space( Len( Receber->Obs       )))
    cObs1         := IF( lModificar, Receber->Obs1,          Space( Len( Receber->Obs1   )))
    cObs2         := IF( lModificar, Receber->Obs2,          Space( Len( Receber->Obs2   )))
    cObs3         := IF( lModificar, Receber->Obs3,          Space( Len( Receber->Obs3   )))
    cObs4         := IF( lModificar, Receber->Obs4,          Space( Len( Receber->Obs4   )))
    cObs5         := IF( lModificar, Receber->Obs5,          Space( Len( Receber->Obs5   )))
    cObs6         := IF( lModificar, Receber->Obs6,          Space( Len( Receber->Obs6   )))
    cObs7         := IF( lModificar, Receber->Obs7,          Space( Len( Receber->Obs7   )))
    cObs8         := IF( lModificar, Receber->Obs8,          Space( Len( Receber->Obs8   )))
    cObs9         := IF( lModificar, Receber->Obs9,          Space( Len( Receber->Obs9   )))
    cObs10        := IF( lModificar, Receber->Obs10,          Space( Len( Receber->Obs10  )))
    cObs11        := IF( lModificar, Receber->Obs11,          Space( Len( Receber->Obs11  )))
    cObs12        := IF( lModificar, Receber->Obs12,          Space( Len( Receber->Obs12  )))
    cObs13        := IF( lModificar, Receber->Obs13,          Space( Len( Receber->Obs13  )))
    cRegiao        := IF( lModificar, Receber->Regiao,       Space( Len( Receber->Regiao )))
    cBanco        := IF( lModificar, Receber->Banco,          Space( Len( Receber->Banco  )))
    dNasc         := IF( lModificar, Receber->Nasc,          Ctod("//"))
    dData         := IF( lModificar, Receber->Data,          Date())
    nDepe         := IF( lModificar, Receber->Depe,          0 )
    nRenda        := IF( lModificar, Receber->Media,          0)
    nLimite        := IF( lModificar, Receber->Limite,       0)
    nMedia        := IF( lModificar, Receber->Media,          0)
    cSpc            := IF( lModificar, IF( Receber->Spc = .T., "S", "N"), "N")
    dDataSpc     := IF( lModificar, Receber->DataSpc,  Ctod("//"))
    cCancelada    := IF( lModificar, IF( Receber->Cancelada = .T., "S", "N"), "N")
    cSuporte     := IF( lModificar, IF( Receber->Suporte    = .T., "S", "N"), "S")
    cSci            := IF( lModificar, IF( Receber->Sci         = .T., "S", "N"), "N")
    cFabricante := IF( lModificar, Receber->Fabricante,        Space( Len( Receber->Fabricante )))
    cProduto     := IF( lModificar, Receber->Produto,            Space( Len( Receber->Produto      )))
    cModelo        := IF( lModificar, Receber->Modelo,             Space( Len( Receber->Modelo       )))
    cLocal        := IF( lModificar, Receber->Local,                Space( Len( Receber->Local          )))
    nValor        := IF( lModificar, Receber->Valor,                0 )
    nPrazo        := IF( lModificar, Receber->Prazo,                0 )
    nDataVcto    := IF( lModificar, Receber->DataVcto,            0 )
    nPrazoExt    := IF( lModificar, Receber->PrazoExt,            0 )
    cAutorizaca := IF( lModificar, IF( Receber->Autorizaca = .T., "S", "N"), "N")
    cAssAutoriz := IF( lModificar, IF( Receber->AssAutoriz = .T., "S", "N"), "N")
    cCidaAval    := IF( lModificar, Receber->CidaAval,            Space( Len( Receber->CidaAval    )))
    cEstaAval    := IF( lModificar, Receber->EstaAval,            Space( Len( Receber->EstaAval    )))
    cBairAval    := IF( lModificar, Receber->BairAval,            Space( Len( Receber->BairAval    )))
    cFoneAval    := IF( lModificar, Receber->FoneAval,            Space( Len( Receber->FoneAval    )))
    cFaxAval     := IF( lModificar, Receber->FaxAval,            Space( Len( Receber->FaxAval    )))
    cRgAval        := IF( lModificar, Receber->RgAval,             Space( Len( Receber->RgAval     )))
    cCpfAval     := IF( lModificar, Receber->CpfAval,            Space( Len( Receber->CpfAval    )))
    cCfop         := IF( lModificar, Receber->Cfop,                Space( Len( Receber->Cfop        )))
    nIcms         := IF( lModificar, Receber->Tx_Icms,            0 )
    cNatu         := ""
    cCep            := IF( lModificar, Receber->Cep, "76970-000")

    IF( !lModificar, Receber->(DbGoBottom()),)
    lSair     := .F.
    if lAtivaRegNew
        nNewCodi :=  Receber->(Val( Codi )+1)
        cCodi     := IF( lModificar, Receber->Codi, IF( nNewCodi > 99999, RetProximo(), StrZero( nNewCodi, 5)))
    Else
        IF( lModificar )
            cCodi := Receber->Codi
        Else
            Receber->(Order(0))
            Receber->(DbGobottom())
            cCodi := ProxCli( Receber->Codi )
        endif
    endif
    cString    := IF( lModificar, "ALTERACAO DE CLIENTE", "INCLUSAO DE NOVOS CLIENTES")
    cSwap     := cCodi
    cPraca    := "76970-000"
    aNatu     := LerNatu()
    aCFop     := LerCfop()
    aTxIcms    := LerIcms()
    WHILE .T.
        MaBox( 00 , 00 , 24 , 79, cString )
        Write( 01,         01, "Codigo.....:                                 Data........:")
        Write( Row()+1, 01, "Nome.......:                                              ")
        Write( Row()+1, 01, "Pop........:                                              ")
        Write( Row()+1, 01, "Cidade.....:                                 Estado......:")
        Write( Row()+1, 01, "Pca Pagto..:           Cfop:      Icms:      Regiao......:")
        Write( Row()+1, 01, "Endereco...:                                 Bairro......:")
        Write( Row()+1, 01, "Rg n§......:                                 Cpf.........:")
        Write( Row()+1, 01, "I. Est.....:                                 Cgc/Mf......:")
        Write( Row()+1, 01, "Telefone...:                                 Fax.........:")
        Write( Row()+1, 01, "------------------------------------------------------------------------------")
        Write( Row()+1, 01, "Natural....:                                 Nascimento..:")
        Write( Row()+1, 01, "Estado Civil:                                Dependentes.:")
        Write( Row()+1, 01, "Esposo(a)..:                                              ")
        Write( Row()+1, 01, "Profissao..:                                 Cargo.......:")
        Write( Row()+1, 01, "Trabalho...:                                 Fone........:")
        Write( Row()+1, 01, "Tempo......:                                 Renda Mes...:")
        Write( Row()+1, 01, "Pai........:                                              ")
        Write( Row()+1, 01, "Mae........:                                              ")
        Write( Row()+1, 01, "Endereco...:                                 Fone........:")
        Write( Row()+1, 01, "------------------------------------------------------------------------------")
        Write( Row()+1, 01, "Referencia.:                                         Spc.:   em")
        Write( Row()+1, 01, "Referencia.:")
        Write( Row()+1, 01, "Imoveis....:")
        nCol    := 13
        nCol1 := 59
        nCol2 := 33
        nCol3 := 29
        nCol4 := 40
        SetCursor(1) ; SetPos( 01, nCol ) ; AAdd( GetList, _GET_( cCodi, "cCodi", "99999", {|| RecCerto( @cCodi, lModificar, cSwap )},))
        SetCursor(1) ; SetPos( Row(), nCol1 ) ; AAdd( GetList, _GET_( dData, "dData", "##/##/##",,))
        SetCursor(1) ; SetPos( Row()+1, nCol ) ; AAdd( GetList, _GET_( cNome, "cNome", "@!",,))
        SetCursor(1) ; SetPos( Row()+1, nCol ) ; AAdd( GetList, _GET_( cFanta, "cFanta", "@!",,))
        SetCursor(1) ; SetPos( Row()+1, nCol ) ; AAdd( GetList, _GET_( cCep, "cCep", "#####-###", {|| CepErrado( @cCep, @cCida, @cEsta, @cBair )},))
        SetCursor(1) ; SetPos( Row(), 23 ) ; AAdd( GetList, _GET_( cCida, "cCida", "@!S21",,))
        SetCursor(1) ; SetPos( Row(), nCol1 ) ; AAdd( GetList, _GET_( cEsta, "cEsta", "@!",,))
        SetCursor(1) ; SetPos( Row()+1, nCol ) ; AAdd( GetList, _GET_( cPraca, "cPraca", "#####-###", {|| CepErrado( @cPraca )},))
        SetCursor(1) ; SetPos( Row(), nCol3 ) ; AAdd( GetList, _GET_( cCFop, "cCFop", "9.999", {|| PickTam2( @aNatu, @aCfop, @aTxIcms, @cCfop, @cNatu, @nIcms )},))
        SetCursor(1) ; SetPos( Row(), nCol4 ) ; AAdd( GetList, _GET_( nIcms, "nIcms", "99.99",,))
        SetCursor(1) ; SetPos( Row(), nCol1 ) ; AAdd( GetList, _GET_( cRegiao, "cRegiao", "99", {|| RegiaoErrada( @cRegiao )},))
        SetCursor(1) ; SetPos( Row()+1, nCol ) ; AAdd( GetList, _GET_( cEnde, "cEnde", "@!",,))
        SetCursor(1) ; SetPos( Row(), nCol1 ) ; AAdd( GetList, _GET_( cBair, "cBair", "@!S21",,))
        SetCursor(1) ; SetPos( Row()+1, nCol ) ; AAdd( GetList, _GET_( cRg, "cRg", "@!",,))
        SetCursor(1) ; SetPos( Row(), nCol1 ) ; AAdd( GetList, _GET_( cCpf, "cCpf", "999.999.999-99", {|| TestaCpf( cCpf )},))
        SetCursor(1) ; SetPos( Row()+1, nCol ) ; AAdd( GetList, _GET_( cInsc, "cInsc", "@!",, {|| Empty( Left( cCpf, 3 ))}))
        SetCursor(1) ; SetPos( Row(), nCol1 ) ; AAdd( GetList, _GET_( cCgc, "cCgc", "99.999.999/9999-99", {|| TestaCgc( cCgc )}, {|| Empty( Left( cCpf, 3 ))}))
        SetCursor(1) ; SetPos( Row()+1, nCol ) ; AAdd( GetList, _GET_( cFone, "cFone", "(##)#####-####",,))
        SetCursor(1) ; SetPos( Row(), nCol1 ) ; AAdd( GetList, _GET_( cFax, "cFax", "(##)#####-####",,))

        SetCursor(1) ; SetPos( Row()+2, nCol ) ; AAdd( GetList, _GET_( cNatural, "cNatural", "@!",, {|| !Empty( Left( cCpf, 3 ))}))
        SetCursor(1) ; SetPos( Row(), nCol1 ) ; AAdd( GetList, _GET_( dNasc, "dNasc", "##/##/##",, {|| !Empty( Left( cCpf, 3 ))}))
        SetCursor(1) ; SetPos( Row()+1, nCol ) ; AAdd( GetList, _GET_( cCivil, "cCivil", "@!",, {|| !Empty( Left( cCpf, 3 ))}))
        SetCursor(1) ; SetPos( Row(), nCol1 ) ; AAdd( GetList, _GET_( nDepe, "nDepe", "99",, {|| !Empty( Left( cCpf, 3 ))}))
        SetCursor(1) ; SetPos( Row()+1, nCol ) ; AAdd( GetList, _GET_( cEsposa, "cEsposa", "@!",, {|| !Empty( Left( cCpf, 3 ))}))
        SetCursor(1) ; SetPos( Row()+1, nCol ) ; AAdd( GetList, _GET_( cProf, "cProf", "@!",, {|| !Empty( Left( cCpf, 3 ))}))
        SetCursor(1) ; SetPos( Row(), nCol1 ) ; AAdd( GetList, _GET_( cCargo, "cCargo", "@!",, {|| !Empty( Left( cCpf, 3 ))}))
        SetCursor(1) ; SetPos( Row()+1, nCol ) ; AAdd( GetList, _GET_( cTraba, "cTraba", "@!",, {|| !Empty( Left( cCpf, 3 ))}))
        SetCursor(1) ; SetPos( Row(), nCol1 ) ; AAdd( GetList, _GET_( cFone2, "cFone2", "(##)#####-####",, {|| !Empty( Left( cCpf, 3 ))}))
        SetCursor(1) ; SetPos( Row()+1, nCol ) ; AAdd( GetList, _GET_( cTempo, "cTempo", "@!",, {|| !Empty( Left( cCpf, 3 ))}))
        SetCursor(1) ; SetPos( Row(), nCol1 ) ; AAdd( GetList, _GET_( nRenda, "nRenda", "99999999.99",, {|| !Empty( Left( cCpf, 3 ))}))
        SetCursor(1) ; SetPos( Row()+1, nCol ) ; AAdd( GetList, _GET_( cPai, "cPai", "@!",, {|| !Empty( Left( cCpf, 3 ))}))
        SetCursor(1) ; SetPos( Row()+1, nCol ) ; AAdd( GetList, _GET_( cMae, "cMae", "@!",, {|| !Empty( Left( cCpf, 3 ))}))
        SetCursor(1) ; SetPos( Row()+1, nCol ) ; AAdd( GetList, _GET_( cEnde1, "cEnde1", "@!",, {|| !Empty( Left( cCpf, 3 ))}))
        SetCursor(1) ; SetPos( Row(), 58 ) ; AAdd( GetList, _GET_( cFone1, "cFone1", "(##)#####-####",, {|| !Empty( Left( cCpf, 3 ))}))

        SetCursor(1) ; SetPos( Row()+2, nCol ) ; AAdd( GetList, _GET_( cRefCom, "cRefCom", "@!",,))
        SetCursor(1) ; SetPos( Row(), 60 ) ; AAdd( GetList, _GET_( cSpc, "cSpc", "!", {|| cSpc $ "SN"},))
        SetCursor(1) ; SetPos( Row(), 66 ) ; AAdd( GetList, _GET_( dDataSpc, "dDataSpc", "##/##/##", {|| IF( cSpc = "S", !Empty( dDataSpc ), .T. ) .OR. LastKey() = 5},))
        SetCursor(1) ; SetPos( Row()+1, nCol ) ; AAdd( GetList, _GET_( cRefBco, "cRefBco", "@!",,))
        SetCursor(1) ; SetPos( Row()+1, nCol ) ; AAdd( GetList, _GET_( cImovel, "cImovel", "@!",,))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        if LastKey() = 27
            lSair := .T.
            Exit
        endif
        nCol := 18
        MaBox( 00, 00 , 24 , 79, cString )
        SetCursor(1) ; DevPos( 01, 01 ) ; DevOut( "Veiculos...:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cVeiculo, "cVeiculo", "@!",,))
        SetCursor(1) ; DevPos( Row()+1, 01 ) ; DevOut( "Avalista...:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cConhecida, "cConhecida", "@!",,))
        SetCursor(1) ; DevPos( Row()+1, 01 ) ; DevOut( "Cidade.....:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCidaAval, "cCidaAval", "@!S21",,))
        SetCursor(1) ; DevPos( Row(), 45 ) ; DevOut( "Estado.....:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cEstaAval, "cEstaAval", "@!",,))
        SetCursor(1) ; DevPos( Row()+1, 01 ) ; DevOut( "Endereco...:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cEnde3, "cEnde3", "@!",,))
        SetCursor(1) ; DevPos( Row(), 45 ) ; DevOut( "Bairro.....:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cBairAval, "cBairAval", "@!",,))
        SetCursor(1) ; DevPos( Row()+1, 01 ) ; DevOut( "Telefone...:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cFoneAval, "cFoneAval", "(##)#####-####",,))
        SetCursor(1) ; DevPos( Row(), 45 ) ; DevOut( "Fax........:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cFaxAval, "cFaxAval", "(##)#####-####",,))
        SetCursor(1) ; DevPos( Row()+1, 01 ) ; DevOut( "Rg n§......:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cRgAval, "cRgAval", "@!",,))
        SetCursor(1) ; DevPos( Row(), 45 ) ; DevOut( "Cpf........:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCpfAval, "cCpfAval", "999.999.999-99", {|| TestaCpf( cCpfAval )},))
        SetCursor(1) ; DevPos( Row()+1, 01 ) ; DevOut( "Limite Credito.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nLimite, "nLimite", "99999999.99",,))
        SetCursor(1) ; DevPos( Row(), 45 ) ; DevOut( "Bancos.....:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cBanco, "cBanco", "@!S20",,))
        SetCursor(1) ; DevPos( Row()+1, 01 ) ; DevOut( "Ficha Cancelada:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCancelada, "cCancelada", "!", {|| PickSimNao( @cCancelada )},))
        SetCursor(1) ; DevPos( Row(), 45 ) ; DevOut( "Suporte....:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cSuporte, "cSuporte", "!", {|| PickSimNao( @cSuporte )},))
        SetCursor(1) ; DevPos( Row(), 60 ) ; DevOut( "Cliente Sistema.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cSci, "cSci", "!", {|| PickSimNao( @cSci )},))
        SetCursor(1) ; DevPos( Row()+1, 01 ) ; DevOut( "Autoriza Compra:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cAutorizaca, "cAutorizaca", "!", {|| PickSimNao( @cAutorizaca )},))
        SetCursor(1) ; DevPos( Row(), 45 ) ; DevOut( "Assinou....:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cAssAutoriz, "cAssAutoriz", "!", {|| PickSimNao( @cAssAutoriz )},))
        Write( Row()+1, 01, "------------------------------------------------------------------------------")
        SetCursor(1) ; DevPos( Row()+1, 01 ) ; DevOut( "Observacoes....:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cObs, "cObs", "@!",,))
        SetCursor(1) ; DevPos( Row()+1, 01 ) ; DevOut( "...............:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cObs1, "cObs1", "@!",,))
        SetCursor(1) ; DevPos( Row()+1, 01 ) ; DevOut( "...............:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cObs2, "cObs2", "@!",,))
        SetCursor(1) ; DevPos( Row()+1, 01 ) ; DevOut( "...............:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cObs3, "cObs3", "@!",,))
        SetCursor(1) ; DevPos( Row()+1, 01 ) ; DevOut( "...............:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cObs4, "cObs4", "@!",,))
        SetCursor(1) ; DevPos( Row()+1, 01 ) ; DevOut( "...............:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cObs5, "cObs5", "@!",,))
        SetCursor(1) ; DevPos( Row()+1, 01 ) ; DevOut( "...............:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cObs6, "cObs6", "@!",,))
        SetCursor(1) ; DevPos( Row()+1, 01 ) ; DevOut( "...............:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cObs7, "cObs7", "@!",,))
        SetCursor(1) ; DevPos( Row()+1, 01 ) ; DevOut( "...............:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cObs8, "cObs8", "@!",,))
        SetCursor(1) ; DevPos( Row()+1, 01 ) ; DevOut( "...............:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cObs9, "cObs9", "@!",,))
        SetCursor(1) ; DevPos( Row()+1, 01 ) ; DevOut( "...............:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cObs10, "cObs10", "@!",,))
        SetCursor(1) ; DevPos( Row()+1, 01 ) ; DevOut( "...............:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cObs11, "cObs11", "@!",,))
        SetCursor(1) ; DevPos( Row()+1, 01 ) ; DevOut( "...............:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cObs12, "cObs12", "@!",,))

















        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        if LastKey() = 27
            lSair := .T.
            Exit
        endif
        ErrorBeep()
        nOpcao := Alerta(" Pergunta: Voce Deseja ? ", if(lModificar, {" Alterar ", " Cancelar ", " Sair "}, {" Incluir ", " Alterar ", " Sair "}))
        if nOpcao = 1
            if lModificar
                if !Receber->(TravaReg()) ; Loop ; endif
            else
                if !RecCerto( @cCodi, lModificar ) ; Loop ; endif
                if !Receber->(Incluiu())              ; Loop ; endif
            endif
            Receber->Codi         := cCodi
            Receber->Data         := dData
            Receber->Nome         := cNome
            Receber->Fanta      := cFanta
            Receber->Cep         := cCep
            Receber->Praca      := cPraca
            Receber->Ende         := cEnde
            Receber->Cida         := cCida
            Receber->Bair         := cBair
            Receber->Esta         := cEsta
            Receber->Rg          := cRg
            Receber->Cpf         := cCpf
            Receber->Insc         := cInsc
            Receber->Cgc         := cCgc
            Receber->Media      := nRenda
            Receber->RefCom     := cRefCom
            Receber->RefBco     := cRefBco
            Receber->Imovel     := cImovel
            Receber->Civil      := cCivil
            Receber->Natural     := cNatural
            Receber->Nasc         := dNasc
            Receber->Esposa     := cEsposa
            Receber->Depe         := nDepe
            Receber->Pai         := cPai
            Receber->Mae         := cMae
            Receber->Ende1      := cEnde1
            Receber->Fax         := cFax
            Receber->Fone         := cFone
            Receber->Fone1      := cFone1
            Receber->Profissao := cProf
            Receber->Cargo      := cCargo
            Receber->Trabalho  := cTraba
            Receber->Fone2      := cFone2
            Receber->Tempo      := cTempo
            Receber->Veiculo     := cVeiculo
            Receber->Conhecida := cConhecida
            Receber->Ende3      := cEnde3
            Receber->Spc         := IF( cSpc         = "S", .T., .F. )
            Receber->DataSpc     := dDataSpc
            Receber->Cancelada := IF( cCancelada = "S", .T., .F. )
            Receber->Suporte     := IF( cSuporte     = "S", .T., .F. )
            Receber->Sci         := IF( cSci         = "S", .T., .F. )
            Receber->Obs         := cObs
            Receber->Obs1         := cObs1
            Receber->Obs2         := cObs2
            Receber->Obs3         := cObs3
            Receber->Obs4         := cObs4
            Receber->Obs5         := cObs5
            Receber->Obs6         := cObs6
            Receber->Obs7         := cObs7
            Receber->Obs8         := cObs8
            Receber->Obs9         := cObs9
            Receber->Obs10      := cObs10
            Receber->Obs11      := cObs11
            Receber->Obs12      := cObs12
            Receber->Obs13      := cObs13
            Receber->Limite     := nLimite
            Receber->Regiao     := cRegiao
            Receber->Banco      := cBanco
            Receber->Fabricante := cFabricante
            Receber->Produto      := cProduto
            Receber->Modelo      := cModelo
            Receber->Local       := cLocal
            Receber->Valor       := nValor
            Receber->Prazo       := nPrazo
            Receber->DataVcto   := nDataVcto
            Receber->PrazoExt   := nPrazoExt
            Receber->Autorizaca := IF( cAutorizaca = "S", .T., .F. )
            Receber->AssAutoriz := IF( cAssAutoriz = "S", .T., .F. )
            Receber->CidaAval   := cCidaAval
            Receber->EstaAval   := cEstaAval
            Receber->BairAval   := cBairAval
            Receber->FoneAval   := cFoneAval
            Receber->FaxAval      := cFaxAval
            Receber->RgAval      := cRgAval
            Receber->CpfAval      := cCpfAval
            Receber->Cfop          := cCfop
            Receber->Tx_Icms      := nIcms
            Receber->(Libera())
            lUpdated := .T.
            if lModificar
                lSair := .T.
            endif
            Exit

        Elseif nOpcao = 2
            Loop
        Elseif nOpcao = 3
            lSair := .T.
            Exit
        endif
    EndDo
    if lSair
        SetKey( -3, NIL )
        ResTela( cScreen )
        Exit
    endif
EndDo
return lUpdated

Function RetProximo()

LOCAL cScreen := SaveScreen()
LOCAL cTela   := Mensagem("Aguarde, Localizando Proximo Registro Vago.")
LOCAL nX

For nX := 1 To 10000
     cCodi := StrZero( nX, 4 )
     if Receber->(DbSeek( cCodi ))
         Loop
     endif
     Return( cCodi )
Next
Return( cCodi )

static function Extrato()

LOCAL GetList   := {}
LOCAL cScreen   := SaveScreen()
LOCAL aMenu     := {"Individual","Por Regiao","Geral"}
LOCAL aMenu1    := {"Normal Carteira","Para Tribunal"}
LOCAL lTribunal := .F.
LOCAL nChoice   := 0
LOCAL oBloco
LOCAL cCodi    AS STRING
LOCAL cRegiao  AS STRING
LOCAL dIni     AS DATE
LOCAL dFim     AS DATE
LOCAL dCalculo AS DATE
FIELD Codi     AS STRING


WHILE .T.
    oMenu:Limpa()
    M_Title("FINALIDADE DO EXTRATO DE CONTA" )
    lTribunal := (FazMenu( 03, 20, aMenu1)) == 2

    if LastKey() = 27
        ResTela( cScreen )
        return
    endif

    M_Title("ESCOLHA O EXTRATO DE CONTA" )
    nChoice := FazMenu( 09, 20, aMenu )

    Do Case
    Case nChoice = 0
        ResTela( cScreen )
        return

    Case nChoice = 1
        cCodi    := Space(05)
        dIni     := Ctod("01/01/91")
      dFim     := Ctod("31/12/" + Right(Dtoc(Date()),2))
      dCalculo := Date()
        MaBox( 16, 20, 21, 80 )
        SetCursor(1) ; DevPos( 17, 21 ) ; DevOut( "Cliente......:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodi, "cCodi", "99999", {|| RecErrado( @cCodi )},))
        SetCursor(1) ; DevPos( 18, 21 ) ; DevOut( "Data Inicial.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dIni, "dIni", "##/##/##", {|| AchaUltVcto(cCodi, @dFim)},))
      SetCursor(1) ; DevPos( 19, 21 ) ; DevOut( "Data Final...:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dFim, "dFim", "##/##/##",,))
      SetCursor(1) ; DevPos( 20, 21 ) ; DevOut( "Data Calculo.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dCalculo, "dCalculo", "##/##/##",,))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        if LastKey() = 27
            ResTela( cScreen )
            Loop
        endif
        Mensagem("Aguarde, Filtrando Registros.")
        Receber->(Order( 2 ))
        dbSelectArea( "Recemov" )
        Recemov->(Order( 10 ))
        if Recemov->(!DbSeek( cCodi ))
            Nada()
            Loop
        endif
        if ( ! .F. ) ; dbClearRelation() ; end ; dbSetRelation( "Receber", {|| Recemov->Codi}, "Recemov->Codi", .F. )
        oBloco := {|| Recemov->Codi = cCodi }
        ExtratoImp( oBloco, lTribunal, dIni, dFim, dCalculo )
        Recemov->(DbClearRel())
        Recemov->(DbGoTop())
        Loop

    Case nChoice = 2
        cRegiao  := Space(02)
        dIni     := Ctod("01/01/91")
      dFim     := Ctod("31/12/" + Right(Dtoc(Date()),2))
      dCalculo := Date()
        MaBox( 16, 20, 21, 50 )
        SetCursor(1) ; DevPos( 17, 21 ) ; DevOut( "Regiao.......:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cRegiao, "cRegiao", "99", {|| RegiaoErrada( @cRegiao )},))
        SetCursor(1) ; DevPos( 18, 21 ) ; DevOut( "Data Inicial.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dIni, "dIni", "##/##/##", {|| AchaUltVcto(cCodi, @dFim)},))
      SetCursor(1) ; DevPos( 19, 21 ) ; DevOut( "Data Final...:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dFim, "dFim", "##/##/##",,))
      SetCursor(1) ; DevPos( 20, 21 ) ; DevOut( "Data Calculo.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dCalculo, "dCalculo", "##/##/##",,))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        if LastKey() = 27
            ResTela( cScreen )
            Loop
        endif
        Mensagem("Aguarde, Filtrando Registros.")
        Receber->(Order( 2 ))
        dbSelectArea( "Recemov" )
        Recemov->(Order( 5 ))
        if Recemov->(!DbSeek( cRegiao ))
            Nada()
            Loop
        endif
        if ( ! .F. ) ; dbClearRelation() ; end ; dbSetRelation( "Receber", {|| Recemov->Codi}, "Recemov->Codi", .F. )
        oBloco := {|| Recemov->Regiao = cRegiao }
        ExtratoImp( oBloco, lTribunal, dIni, dFim, dCalculo )
        Recemov->(DbClearRel())
        Recemov->(DbGoTop())
        Loop

    Case nChoice = 3
        MaBox( 16, 20, 20, 50 )
        SetCursor(1) ; DevPos( 17, 21 ) ; DevOut( "Data Inicial.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dIni, "dIni", "##/##/##", {|| AchaUltVcto(cCodi, @dFim)},))
      SetCursor(1) ; DevPos( 18, 21 ) ; DevOut( "Data Final...:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dFim, "dFim", "##/##/##",,))
      SetCursor(1) ; DevPos( 19, 21 ) ; DevOut( "Data Calculo.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dCalculo, "dCalculo", "##/##/##",,))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        if LastKey() = 27
            ResTela( cScreen )
            Loop
        endif
        Receber->(Order( 2 ))
        dbSelectArea( "Recemov" )
        Recemov->(Order( 10 ))
        Recemov->(DbGotop())
        if Recemov->(Eof())
            Nada()
            Loop
        endif
        Mensagem("Aguarde, Filtrando Registros.")
        if ( ! .F. ) ; dbClearRelation() ; end ; dbSetRelation( "Receber", {|| Recemov->Codi}, "Recemov->Codi", .F. )
        oBloco := {|| Recemov->(!Eof()) }
        ExtratoImp( oBloco, lTribunal, dIni, dFim, dCalculo )
        Recemov->(DbClearRel())
        Recemov->(DbGoTop())
        Loop
    EndCase
EndDo

static function LancaDespesasDiversas( cCaixa, cVendedor, cTipo)

LOCAL Arq_Ant     := Alias()
LOCAL Ind_Ant     := IndexOrd()
LOCAL cScreen     := SaveScreen()
LOCAL cNome      := Space(40)
LOCAL cEnde      := Space(40)
LOCAL cCida      := Space(40)
LOCAL cValor     := Space(0)
LOCAL cHist      := Space(40)
LOCAL cRef         := Space(40)
LOCAL cCodiCx1  := Space(04)
LOCAL cCodiCx2  := Space(04)
LOCAL dData     := Date()
LOCAL cCodiCx     := "0000"
LOCAL cDc         := "D"
LOCAL cDc1         := "D"
LOCAL cDc2         := "D"
LOCAL nOpcao     := 1
LOCAL nVlrTotal := 0
LOCAL Larg         := 80
LOCAL nValor     := 0
LOCAL nChSaldo  := 0
LOCAL nTamDoc     := 0
LOCAL nVlrLcto  := 0
LOCAL cTela
LOCAL nRow
LOCAL cNomeFir
LOCAL cStr
LOCAL oObj

cNome     := Space(40)
cEnde     := Space(40)
cCida     := Space(40)
cHist     := Space(40)
cRef        := Space(40)
cCodiCx1 := Space(04)
cCodiCx2 := Space(04)
cCodiCx    := "0000"
cDc        := "D"
cDc1        := "D"
cDc2        := "D"
nValor    := 0
cNomeFir := oAmbiente:xNomefir
o1       := TLancaDespesasDiversas():New()

WHILE .T.
    o1:GeraDocnr()
    nTamDoc    := Len( o1:cDocnr)
    oMenu:Limpa()
    MaBox( 10, 00, 20, 79, "LANCAMENTO DE DESPESAS DIVERSAS" )
   SetCursor(1) ; DevPos( 11, 01 ) ; DevOut( "Nome Emitente..: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cNome, "cNome", "@!", {|| if(Empty(cNome),  ( ErrorBeep(), Alerta("Ooops!: Entre com um nome!", nil , 31), .F. ), .T. )},))
    SetCursor(1) ; DevPos( 12, 01 ) ; DevOut( "Referente......: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cRef, "cRef", "@!", {|| if(Empty(cRef),   ( ErrorBeep(), Alerta("Ooops!: Entre com a referencia!", nil , 31), .F. ), (ValidarcHist(cRef,@cHist), .T.))},))
    SetCursor(1) ; DevPos( 13, 01 ) ; DevOut( "Historico Cx...: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cHist, "cHist", "@!", {|| if(Empty(cHist),  ( ErrorBeep(), Alerta("Ooops!: Entre com o historico!"), .F. ), .T. )},))
    SetCursor(1) ; DevPos( 14, 01 ) ; DevOut( "Data...........: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dData, "dData", "##/##/##", {|| if(Empty(dData), ( ErrorBeep(), Alerta("Ooops!: Entre com uma data!"), .F. ), .T. )},))
    SetCursor(1) ; DevPos( 15, 01 ) ; DevOut( "Documento #....: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( o1:cDocnr, "o1:cDocnr", "@!", {|| CheqDoc(o1:cDocnr)},))
    SetCursor(1) ; DevPos( 16, 01 ) ; DevOut( "Valor R$.......: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nValor, "nValor", "@E 9,999,999.99", {|| if(Empty(nValor), ( ErrorBeep(), Alerta("Ooops!: Entre com um valor!"), .F. ), .T. )},))
    SetCursor(1) ; DevPos( 17, 01 ) ; DevOut( "Conta Caixa....: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodiCx, "cCodiCx", "9999", {|| CheErrado( @cCodiCx,, Row(), 32, .T. )},))
    SetCursor(1) ; DevPos( 17, 24 ) ; DevOut( "D/C.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cDc, "cDc", "!", {|| PickTam({"Credito em conta","Debito em conta"}, {"C","D"}, @cDc )},))
    SetCursor(1) ; DevPos( 18, 01 ) ; DevOut( "C. Partida.....: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodiCx1, "cCodiCx1", "9999", {|| CheErrado( @cCodiCx1,, Row(), 32, .T. )},))
    SetCursor(1) ; DevPos( 18, 24 ) ; DevOut( "D/C.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cDc1, "cDc1", "!", {|| PickTam({"Credito em conta","Debito em conta"}, {"C","D"}, @cDc1 )},))
    SetCursor(1) ; DevPos( 19, 01 ) ; DevOut( "C. Partida.....: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodiCx2, "cCodiCx2", "9999", {|| CheErrado( @cCodiCx2,, Row(), 32, .T. )},))
    SetCursor(1) ; DevPos( 19, 24 ) ; DevOut( "D/C.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cDc2, "cDc2", "!", {|| PickTam({"Credito em conta","Debito em conta"}, {"C","D"}, @cDc2 )},))
    ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
    if LastKey() = 27
        AreaAnt( Arq_Ant, Ind_Ant )
        ResTela( cScreen )
        return
    endif
    ErrorBeep()
    if !Conf("Pergunta: Confirma lancamento ?")
        AreaAnt( Arq_Ant, Ind_Ant )
        ResTela( cScreen )
        Loop
    endif
    nVlrLcto := nValor
    if Cheque->(DbSeek( cCodiCx )) .OR. !Empty( cCodiCx )
        if Cheque->(TravaReg())
            nChSaldo := Cheque->Saldo
            if Chemov->(Incluiu())
                if cDc = "C"
                    nChSaldo       += nVlrLcto
                    Cheque->Saldo += nVlrLcto
                    Chemov->Cre   := nVlrLcto
                else
                    nChSaldo       -= nVlrLcto
                    Cheque->Saldo -= nVlrLcto
                    Chemov->Deb   := nVlrLcto
                endif
                Chemov->Codi    := cCodiCx
                Chemov->Docnr    := o1:cDocnr
                Chemov->Emis    := dData
                Chemov->Data    := dData
                Chemov->Baixa    := Date()
                Chemov->Hist    := cHist
                Chemov->Saldo    := nChSaldo
                Chemov->Tipo    := "OU"
                Chemov->Caixa    := if( cCaixa = Nil, Space(4), cCaixa )
                Chemov->Fatura := o1:cDocnr
            endif
            Chemov->(Libera())
        endif
        Cheque->(Libera())
    endif

    if Cheque->(DbSeek( cCodiCx1 )) .OR. !Empty( cCodiCx1 )
        if Cheque->(TravaReg())
            nChSaldo := Cheque->Saldo
            if Chemov->(Incluiu())
                if cDc1 = "C"
                    nChSaldo       += nVlrLcto
                    Cheque->Saldo += nVlrLcto
                    Chemov->Cre   := nVlrLcto
                else
                    nChSaldo       -= nVlrLcto
                    Cheque->Saldo -= nVlrLcto
                    Chemov->Deb   := nVlrLcto
                endif
                Chemov->Codi    := cCodiCx1
                Chemov->Docnr    := o1:cDocnr
                Chemov->Emis    := dData
                Chemov->Data    := dData
                Chemov->Baixa    := Date()
                Chemov->Hist    := cHist
                Chemov->Saldo    := nChSaldo
                Chemov->Tipo    := "OU"
                Chemov->Caixa    := if( cCaixa = Nil, Space(4), cCaixa )
                Chemov->Fatura := o1:cDocnr
            endif
            Chemov->(Libera())
        endif
        Cheque->(Libera())
    endif



    if Cheque->(DbSeek( cCodiCx2 )) .OR. !Empty( cCodiCx2 )
        if Cheque->(TravaReg())
            nChSaldo := Cheque->Saldo
            if Chemov->(Incluiu())
                if cDc2 = "C"
                    nChSaldo       += nVlrLcto
                    Cheque->Saldo += nVlrLcto
                    Chemov->Cre   := nVlrLcto
                else
                    nChSaldo       -= nVlrLcto
                    Cheque->Saldo -= nVlrLcto
                    Chemov->Deb   := nVlrLcto
                endif
                Chemov->Codi    := cCodiCx2
                Chemov->Docnr    := o1:cDocnr
                Chemov->Emis    := dData
                Chemov->Data    := dData
                Chemov->Baixa    := Date()
                Chemov->Hist    := cHist
                Chemov->Saldo    := nChSaldo
                Chemov->Tipo    := "OU"
                Chemov->Caixa    := if( cCaixa = Nil, Space(4), cCaixa )
                Chemov->Fatura := o1:cDocnr
            endif
            Chemov->(Libera())
        endif
        Cheque->(Libera())
    endif



   if Recibo->(Incluiu())
        Recibo->Nome     := cNome
      Recibo->Vcto    := Date()
      Recibo->Tipo    := "PAGDIV"
      Recibo->Codi    := "00000"
        Recibo->Docnr     := o1:cDocnr
      Recibo->Hora    := Time()
      Recibo->Data    := dData
      Recibo->Usuario := oAmbiente:xUsuario + Space( 10 - Len( oAmbiente:xUsuario ))
      Recibo->Caixa   := cCaixa
      Recibo->Vlr     := -nValor
        Recibo->Hist     := cHist
        Recibo->(Libera())
    endif

EndDo



_HB_CLASS TLancaDespesasDiversas ; function TLancaDespesasDiversas ( ... ) ; STATIC s_oClass ; LOCAL nScope, oClass, oInstance ; IF s_oClass == NIL .AND. __clsLockDef( @s_oClass ) ; BEGIN SEQUENCE ; nScope := 1 ; ( ( nScope ) ) ; oClass := iif( .F.,, HBClass():new( "TLancaDespesasDiversas", iif( .F., { }, { @HBObject() } ), @TLancaDespesasDiversas() ) ) ;
   _HB_MEMBER { cDocnr } ; oClass:AddMultiData(, Space(9), nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"cDocnr"}, .F. )
    _HB_MEMBER { Contador } ; oClass:AddMultiData(, 0, nScope + iif( .F., 16, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ), {"Contador"}, .F. )
    _HB_MEMBER New(); oClass:AddInline( "New", {|Self | ( ( Self ) ), self}, nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )

    _HB_MEMBER GeraDocnr(); oClass:AddMethod( "GeraDocnr", @TLancaDespesasDiversas_GeraDocnr(), nScope + iif( .F., 8, 0 ) + iif( .F., 256, 0 ) + iif( .F., 2048, 0 ) )
oClass:Create() ; ; ALWAYS ; __clsUnlockDef( @s_oClass, oClass ) ; end ; oInstance := oClass:Instance() ; IF __objHasMsg( oInstance, "InitClass" ) ; oInstance:InitClass( ... ) ; END ; RETURN oInstance ; END ; RETURN s_oClass:Instance() AS CLASS TLancaDespesasDiversas ;

static FUNCTION TLancaDespesasDiversas_GeraDocnr( ) ; local Self AS CLASS TLancaDespesasDiversas := QSelf() AS CLASS TLancaDespesasDiversas

    ::cDocnr    := StrZero(Day(Date()),2)
    ::cDocnr += StrZero(Month(Date()),2)
    ::cDocnr += Right(StrZero(Year(Date()),4),2)
    ::cDocnr += "-"
    ::cDocnr += StrZero(++::Contador, 2)
    return self



Proc TrocaCobAgenda()

LOCAL aMenu      := {"Por Cobrador","Por Cliente","Geral"}
LOCAL cScreen     := SaveScreen()
LOCAL cCodiVen  := Space(04)
LOCAL cCobrador := Space(04)
LOCAL cCodi      := Space(05)
LOCAL nChoice     := 0

WHILE .T.
    oMenu:Limpa()
    M_Title("TROCA COBRADOR DO AGENDAMENTO")
    nChoice := FazMenu( 03, 10, aMenu )
    Do Case
    Case nChoice = 0
        ResTela( cScreen )
        return

    Case nChoice = 1
        cCodiVen  := Space( 04 )
        cCobrador := Space( 04 )
        MaBox( 10, 10, 13, 78 )
        SetCursor(1) ; DevPos( 11, 11 ) ; DevOut( "Cobrador Anterior.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodiVen, "cCodiVen", "9999", {|| FunErrado( @cCodiVen,, Row(), Col()+1 )},))
        SetCursor(1) ; DevPos( 12, 11 ) ; DevOut( "Cobrador Atual....:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCobrador, "cCobrador", "9999", {|| FunErrado( @cCobrador,, Row(), Col()+1 )},))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        if LastKey() = 27
            ResTela( cScreen )
            Loop
        endif
        ErrorBeep()
        if Conf("Pergunta: A troca podera demorar. Continua ?")
            Recemov->(DbGotop())
            Mensagem("Aguarde, Trocando de cobrador.")
            While Recemov->(!Eof()) .AND. Rep_Ok()
                if Recemov->Cobrador = cCodiVen
                    if Recemov->(TravaReg())
                        Recemov->Cobrador := cCobrador
                        Recemov->RelCob    := .T.
                        Recemov->(Libera())
                    endif
                endif
              Recemov->(DbSkip(1))
            EndDo
        endif

    Case nChoice = 2
        cCodi      := Space(05)
        cCobrador := Space(04)
        MaBox( 10, 10, 13, 78 )
        SetCursor(1) ; DevPos( 11, 11 ) ; DevOut( "Cliente.......:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodi, "cCodi", "99999", {|| RecErrado( @cCodi,, Row(), Col()+1 )},))
        SetCursor(1) ; DevPos( 12, 11 ) ; DevOut( "Novo Cobrador.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCobrador, "cCobrador", "9999", {|| FunErrado( @cCobrador,, Row(), Col()+1 )},))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        if LastKey() = 27
            ResTela( cScreen )
            Loop
        endif
        ErrorBeep()
        if Conf("Pergunta: Continua ?")
            Mensagem("Aguarde, Trocando de cobrador.")
            Recemov->(Order( 2 ))
            if Recemov->(DbSeek( cCodi ))
                While Recemov->Codi = cCodi
                    if Recemov->(TravaReg())
                        Recemov->Cobrador := cCobrador
                        Recemov->RelCob    := .T.
                        Recemov->(Libera())
                    endif
                    Recemov->(DbSkip(1))
                EndDo
            endif
        endif

    Case nChoice = 3
        cCobrador := Space(04)
        MaBox( 10, 10, 12, 78 )
        SetCursor(1) ; DevPos( 11, 11 ) ; DevOut( "Novo Cobrador.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCobrador, "cCobrador", "9999", {|| FunErrado( @cCobrador,, Row(), Col()+1 )},))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        if LastKey() = 27
            ResTela( cScreen )
            Loop
        endif
        ErrorBeep()
        if Conf("Pergunta: Alteracao podera demorar. Continua ?")
            Recemov->(DbGotop())
            Mensagem("Aguarde, Trocando de cobrador.")
            While Recemov->(!Eof()) .AND. Rep_Ok()
                if !Empty( Recemov->Cobrador)
                    if Recemov->(TravaReg())
                        Recemov->Cobrador := cCobrador
                        Recemov->RelCob    := .T.
                        Recemov->(Libera())
                    endif
                endif
                Recemov->(DbSkip(1))
            EndDo
        endif
    EndCase
EndDo



Proc RemoveCobranca()

LOCAL aMenu     := {"Por Cobrador","Por Cliente","Geral"}
LOCAL cScreen    := SaveScreen()
LOCAL cCodiVen := Space(04)
LOCAL cCodi     := Space(05)
LOCAL nChoice    := 0

WHILE .T.
    oMenu:Limpa()
    M_Title("REMOVE COMISSAO COBRADOR")
    nChoice := FazMenu( 03, 10, aMenu )
    Do Case
    Case nChoice = 0
        ResTela( cScreen )
        return

    Case nChoice = 1
        MaBox( 10, 10, 12, 78 )
        cCodiVen := Space( 04 )
        SetCursor(1) ; DevPos( 11, 11 ) ; DevOut( "Cobrador..:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodiVen, "cCodiVen", "9999", {|| FunErrado( @cCodiVen,, Row(), Col()+1 )},))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        if LastKey() = 27
            ResTela( cScreen )
            Loop
        endif
        ErrorBeep()
        if Conf("Pergunta: Alteracao podera demorar. Continua ?")
            Recemov->(DbGotop())
            Mensagem("Aguarde, Limpando Comissao Cobrador.")
            While Recemov->(!Eof()) .AND. Rep_Ok()
                if Recemov->Cobrador = cCodiVen
                    if Recemov->(TravaReg())
                        Recemov->Cobrador := Space(04)
                        Recemov->RelCob    := .F.
                        Recemov->(Libera())
                    endif
                endif
              Recemov->(DbSkip(1))
            EndDo
        endif

    Case nChoice = 2
        cCodi := Space( 05 )
        MaBox( 10, 10, 12, 78 )
        SetCursor(1) ; DevPos( 11, 11 ) ; DevOut( "Cliente....:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodi, "cCodi", "99999", {|| RecErrado( @cCodi,, Row(), Col()+1 )},))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        if LastKey() = 27
            ResTela( cScreen )
            Loop
        endif
        ErrorBeep()
        if Conf("Pergunta: Continua ?")
            Mensagem("Aguarde, Limpando Comissao Cobrador.")
            Recemov->(Order( 2 ))
            if Recemov->(DbSeek( cCodi ))
                While Recemov->Codi = cCodi
                    if Recemov->(TravaReg())
                        Recemov->Cobrador := Space(04)
                        Recemov->RelCob    := .F.
                        Recemov->(Libera())
                    endif
                    Recemov->(DbSkip(1))
                EndDo
            endif
        endif

    Case nChoice = 3
        ErrorBeep()
        if Conf("Pergunta: Alteracao podera demorar. Continua ?")
            Recemov->(DbGotop())
            Mensagem("Aguarde, Limpando Comissao Cobrador.")
            While Recemov->(!Eof()) .AND. Rep_Ok()
                if Recemov->(TravaReg())
                    Recemov->Cobrador := Space(04)
                    Recemov->RelCob    := .F.
                    Recemov->(Libera())
                endif
                Recemov->(DbSkip(1))
            EndDo
        endif
    EndCase
EndDo



Function ClientesFiltro()

LOCAL cScreen    := SaveScreen()
LOCAL AtPrompt := {"Por Codigo", "Por Cidade", "Por Estado", "Por Regiao", "Todos"}
LOCAL xAlias    := FTempName()
LOCAL xNtx        := FTempName()
LOCAL cCodi     := Space(05)
LOCAL cCida     := Space(25)
LOCAL cEsta     := Space(02)
LOCAL cRegiao    := Space(02)
LOCAL Op1        := 0
LOCAL aStru
LOCAL nLen
LOCAL nField

dbSelectArea( "Receber" )
Receber->(DbGoTop())
if Receber->(Eof())
    Nada()
    ResTela( cScreen )
    return
endif
WHILE .T.
    M_Title( "ESCOLHA A OPCAO DE CONSULTA" )
    Op1    := FazMenu( 04, 10, AtPrompt, Cor() )
    Do Case
    Case Op1 = 0
        ResTela( cScreen )
        Exit

    Case Op1 = 1
        MaBox( 13, 10, 15, 26 )
        cCodi := Space( 05 )
        SetCursor(1) ; DevPos( 14, 11 ) ; DevOut( "Codigo..:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodi, "cCodi", "99999", {|| RecErrado( @cCodi )},))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )

        if LastKey() = 27
            ResTela( cScreen )
            Loop
        endif

        cTela   := Mensagem("Aguarde, Filtrando Registros. ")
        aStru   := Receber->(DbStruct())
        DbCreate( xAlias, aStru )
        dbUseArea( .T.,, ( xAlias ), "xTemp", iif( .F. .OR. .T., ! .T., NIL ), .F. )
        dbSelectArea( "Receber" )
        Receber->(Order( 2 ))
        nLen := Receber->(FCount())
        if Receber->(DbSeek( cCodi ))
            While ( Receber->Codi = cCodi .AND. Rep_Ok() )
                xTemp->(DbAppend())
                For nField := 1 To nLen
                    xTemp->( FieldPut( nField, Receber->(FieldGet( nField ))))
                Next
                Receber->(DbSkip(1))
            EndDo
        endif
        xTemp->(DbGoTop())
        if xTemp->(Eof())
            Alerta("Erro: Nenhum Cliente Atende a Condicao.")
        else
          Clifiltro()
        endif
        xTemp->(DbCloseArea())
        Ferase( xAlias )
        Ferase( xNtx )

    Case Op1 = 2
        MaBox( 13, 10, 15, 47 )
        cCida := Space( 25 )
        SetCursor(1) ; DevPos( 14, 11 ) ; DevOut( "Cidade..:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCida, "cCida", "@!",,))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )

        if LastKey() = 27
            ResTela( cScreen )
            Loop
        endif

        cTela   := Mensagem("Aguarde, Filtrando Registros.")
        aStru   := Receber->(DbStruct())
        DbCreate( xAlias, aStru )
        dbUseArea( .T.,, ( xAlias ), "xTemp", iif( .F. .OR. .T., ! .T., NIL ), .F. )
        dbSelectArea( "Receber" )
        Receber->(Order( 3 ))
        nLen := Receber->(FCount())
        if Receber->(DbSeek( cCida ))
            While ( Receber->Cida = cCida .AND. Receber->(!Eof()).AND. Rep_Ok() )
                xTemp->(DbAppend())
                For nField := 1 To nLen
                    xTemp->( FieldPut( nField, Receber->(FieldGet( nField ))))
                Next
                Receber->(DbSkip(1))
            EndDo
        endif
        xTemp->(DbGoTop())
        if xTemp->(Eof())
            Alerta("Erro: Nenhum Cliente Atende a Condicao.")
        else
          Clifiltro()
        endif
        xTemp->(DbCloseArea())
        Ferase( xAlias )
        Ferase( xNtx )

    Case Op1 = 3
        MaBox( 13, 10, 15, 24 )
        cEsta := Space( 02 )
        SetCursor(1) ; DevPos( 14, 11 ) ; DevOut( "Estado..:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cEsta, "cEsta", "@!",,))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )

        if LastKey() = 27
            ResTela( cScreen )
            Loop
        endif

        cTela   := Mensagem("Aguarde, Filtrando Registros.")
        aStru   := Receber->(DbStruct())
        DbCreate( xAlias, aStru )
        dbUseArea( .T.,, ( xAlias ), "xTemp", iif( .F. .OR. .T., ! .T., NIL ), .F. )
        dbSelectArea( "Receber" )
        Receber->(Order( 5 ))
        nLen := Receber->(FCount())
        if Receber->(DbSeek( cEsta ))
            While ( Receber->Esta = cEsta .AND. Receber->(!Eof()) .AND. Rep_Ok() )
                xTemp->(DbAppend())
                For nField := 1 To nLen
                    xTemp->( FieldPut( nField, Receber->(FieldGet( nField ))))
                Next
                Receber->(DbSkip(1))
            EndDo
        endif
        xTemp->(DbGoTop())
        if xTemp->(Eof())
            Alerta("Erro: Nenhum Cliente Atende a Condicao.")
        else
            Clifiltro()
        endif
        xTemp->(DbCloseArea())
        Ferase( xAlias )
        Ferase( xNtx )

    Case Op1 = 4
        MaBox( 13, 10, 15, 24 )
        cRegiao := Space(2)
        SetCursor(1) ; DevPos( 14, 11 ) ; DevOut( "Regiao..:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cRegiao, "cRegiao", "99", {|| RegiaoErrada( @cRegiao )},))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )

        if LastKey() = 27
            ResTela( cScreen )
            Loop
        endif

        cTela   := Mensagem("Aguarde, Filtrando Registros.")
        aStru   := Receber->(DbStruct())
        DbCreate( xAlias, aStru )
        dbUseArea( .T.,, ( xAlias ), "xTemp", iif( .F. .OR. .T., ! .T., NIL ), .F. )
        dbSelectArea( "Receber" )
        Receber->(Order( 4 ))
        nLen := Receber->(FCount())
        if Receber->(DbSeek( cRegiao ))
            While ( Receber->Regiao = cRegiao .AND. Rep_Ok() )
                xTemp->(DbAppend())
                For nField := 1 To nLen
                    xTemp->( FieldPut( nField, Receber->(FieldGet( nField ))))
                Next
                Receber->(DbSkip(1))
            EndDo
        endif
        xTemp->(DbGoTop())
        if xTemp->(Eof())
            Alerta("Erro: Nenhum Cliente Atende a Condicao.")
        else
            Clifiltro()
        endif
        xTemp->(DbCloseArea())
        Ferase( xAlias )
        Ferase( xNtx )

    Case Op1 = 5
        ClientesDbEdit()

    EndCase
    ResTela( cScreen )

EndDo



Proc Clifiltro()

LOCAL Arq_Ant    := Alias()
LOCAL Ind_Ant    := IndexOrd()
LOCAL cScreen    := SaveScreen()
LOCAL oBrowse    := MsBrowse():New()
SetKey( -8, NIL )

oMenu:Limpa()
dbSelectArea( "xTemp" )
xTemp->(DbGoTop())
oBrowse:Add( "CODIGO",    "Codi")
oBrowse:Add( "NOME",      "Nome")
oBrowse:Add( "CIDADE",    "Cida")
oBrowse:Add( "UF",        "Esta")
oBrowse:Titulo   := "CONSULTA DE CLIENTES"
oBrowse:PreDoGet := NIL
oBrowse:PosDoGet := NIL
oBrowse:PreDoDel := NIL
oBrowse:PosDoDel := NIL
oBrowse:Show()
oBrowse:Processa()
AreaAnt( Arq_Ant, Ind_Ant )
ResTela( cScreen )



Proc RegiaoConsulta()

LOCAL Arq_Ant    := Alias()
LOCAL Ind_Ant    := IndexOrd()
LOCAL cScreen    := SaveScreen()
LOCAL oBrowse    := MsBrowse():New()
SetKey( -8, NIL )

oMenu:Limpa()
dbSelectArea( "Regiao" )
Regiao->(Order( 2 ))
Regiao->(DbGoTop())
oBrowse:Add( "CODIGO",    "Regiao")
oBrowse:Add( "DESCRICAO", "Nome")
oBrowse:Titulo   := "CONSULTA/ALTERACAO DE REGIOES"
oBrowse:PreDoGet := NIL
oBrowse:PosDoGet := NIL
oBrowse:PreDoDel := NIL
oBrowse:PosDoDel := NIL
oBrowse:Show()
oBrowse:Processa()
AreaAnt( Arq_Ant, Ind_Ant )
ResTela( cScreen )



STATIC Proc Exclusao()

LOCAL cScreen := SaveScreen()
LOCAL Doc

Receber->( Order( 2 ))
WHILE .T.
    dbSelectArea( "ReceMov" )
    if ( ! .F. ) ; dbClearRelation() ; end ; dbSetRelation( "Receber", {|| Codi}, "Codi", .F. )
    Recemov->(Order( 1 ))
    Recemov->(DbGoTop())
    MaBox( 16 , 10 , 18 , 30 )
    Doc := Space( 9 )
    SetCursor(1) ; DevPos( 17, 11 ) ; DevOut( "Doc.No..¯" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( doc, "doc", "@K!", {|| DocErrado( @doc )},))
    ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
    if LastKey() = 27
        DbClearRel()
        DbGoTop()
        ResTela( cScreen )
        Exit
    endif
    oMenu:Limpa()
    MaBox(  06 , 10, 17 , 76, "EXCLUSAO DE MOVIMENTO" )
    Write( 07 , 11, "Codigo...¯ " + Codi + "  " + Receber->Nome )
    Write( 08 , 11, "Tipo.....¯ " + Tipo)
    Write( 09 , 11, "Doc.N?..¯ " + Docnr)
    Write( 10 , 11, "Nosso N?¯ " + Nossonr)
    Write( 11 , 11, "Bordero..¯ " + Bordero)
    Write( 12 , 11, "Emissao..¯ " + Dtoc( Emis ))
    Write( 13 , 11, "Vencto...¯ " + Dtoc( Vcto ))
    Write( 14 , 11, "Portador.¯ " + Port)
    Write( 15 , 11, "Valor....¯ " + Tran( Vlr,  "@E 9,999,999,999.99"))
    Write( 16 , 11, "Jr Mes...¯ " + Tran( Juro, "999.99"))
    ErrorBeep()
    if Conf( "Confirma Exclusao deste Movimento ?" )
        if Recemov->(TravaReg())
            DbDelete()
            Recemov->(Libera())
            Alerta(" Registro Excluido ...")
            ResTela( cScreen )
            Loop
        endif
    endif
    ResTela( cScreen )
EndDo



Proc Proc_Altera()

LOCAL cScreen      := SaveScreen()
LOCAL nChoice      := 1
LOCAL aMenuArray := { " A Receber "," Recebidos "}

WHILE .T.
    M_Title("ALTERACAO DE TITULOS")
    nChoice := FazMenu( 10, 10, aMenuArray, Cor())
    if nChoice = 0
        ResTela( cScreen )
        Exit
    elseif nChoice = 1
        AlteraReceber()
    else
        AlteraRecebido()
    endif
EndDO

function AlteraReceber( cDocnr, nRegistro )

LOCAL Arq_Ant    := Alias()
LOCAL Ind_Ant    := IndexOrd()
LOCAL cScreen    := SaveScreen()
LOCAL nCotacao := 0
LOCAL lParam   := if( cDocnr == NIL , .F., .T.)
LOCAL cObs
LOCAL lRetVal  := .F.
LOCAL cCodi

if !lParam
   cDocnr := Space(9)
endif

WHILE .T.
    Receber->(Order( 2 ))
    dbSelectArea( "ReceMov" )
    Recemov->(Order( 1 ))
   if !lParam
       MaBox( 16 , 10 , 18 , 30 )
       SetCursor(1) ; DevPos( 17, 11 ) ; DevOut( "Doc.No..¯" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cDocNr, "cDocNr", "@K!", {|| DocErrado( @cDocNr )},))
       ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
       if LastKey() = 27
           AreaAnt( Arq_Ant, Ind_Ant )
           ResTela( cScreen )
           Exit
       endif
    else
       Recemov->(DbGoto( nRegistro ))
        if Recemov->Docnr <> cDocnr
            DocErrado( @cDocNr )
        endif
    endif
    oMenu:Limpa()
    nRegistro := Recemov->(Recno())
    cCodi     := Recemov->Codi
    cTipo      := Recemov->Tipo
    cDocnr     := Recemov->Docnr
    cNossoNr  := Recemov->NossoNr
    cBordero  := Recemov->Bordero
    dEmis      := Recemov->Emis
    dVcto      := Recemov->Vcto
    cPort      := Recemov->Port
    nVlr         := Recemov->Vlr
    nJuro      := Recemov->Juro
    nVlrAnt     := Recemov->Vlr
    cFatura     := Recemov->Fatura
    cObs         := Recemov->Obs
    dDataPag  := Recemov->DataPag
    nVlrPag   := Recemov->VlrPag

    Receber->(DbSeek( cCodi ))
   MaBox( 06 , 10 , 20 , MaxCol()-4, "ALTERACAO DE MOVIMENTO" )
    Write( 07 , 11 ,    "Codigo...: " + Recemov->Codi + " " + Receber->Nome )
    Write( 08 , 11 ,    "Tipo.....: " + Recemov->Tipo)
    Write( 09 , 11 ,    "Doc.N?..: " + Recemov->Docnr)
    Write( 10 , 11 ,    "Nosso N?: " + Recemov->Nossonr)
    Write( 11 , 11 ,    "Bordero..: " + Recemov->Bordero)
    Write( 12 , 11 ,    "Emissao..: " + Recemov->(Dtoc(Emis)))
    Write( 13 , 11 ,    "Vencto...: " + Recemov->(Dtoc(Vcto)))
    Write( 14 , 11 ,    "Portador.: " + Recemov->Port)
    Write( 15 , 11 ,    "Valor....: " + Recemov->(Tran(Vlr,  "@E 9,999,999,999.99")))
    Write( 16 , 11 ,    "Jr Mes...: " + Recemov->(Tran( Juro, "999.99")))
    Write( 17 , 11 ,    "Obs......: " + Recemov->Obs )
    Write( 18 , 11 ,    "Datapag..: " + Recemov->(Dtoc(Datapag)))
    Write( 19 , 11 ,    "Vlr Pago.: " + Recemov->(Tran(VlrPag,  "@E 9,999,999,999.99")))

    SetCursor(1) ; SetPos( 07, 22 ) ; AAdd( GetList, _GET_( cCodi, "cCodi", "99999", {|| RecErrado( @cCodi, NIL , Row(), Col()+1)},))
    SetCursor(1) ; SetPos( 08, 22 ) ; AAdd( GetList, _GET_( cTipo, "cTipo", "@!",,))
    SetCursor(1) ; SetPos( 09, 22 ) ; AAdd( GetList, _GET_( cDocnr, "cDocnr", "@!",,))
    SetCursor(1) ; SetPos( 10, 22 ) ; AAdd( GetList, _GET_( cNossoNr, "cNossoNr", "@!",,))
    SetCursor(1) ; SetPos( 11, 22 ) ; AAdd( GetList, _GET_( cBordero, "cBordero", "@!",,))
    SetCursor(1) ; SetPos( 12, 22 ) ; AAdd( GetList, _GET_( dEmis, "dEmis", "##/##/##",,))
    SetCursor(1) ; SetPos( 13, 22 ) ; AAdd( GetList, _GET_( dVcto, "dVcto", "##/##/##",,))
    SetCursor(1) ; SetPos( 14, 22 ) ; AAdd( GetList, _GET_( cPort, "cPort", "@!",,))
    SetCursor(1) ; SetPos( 15, 22 ) ; AAdd( GetList, _GET_( nVlr, "nVlr", "@E 9,999,999,999.99",,))
    SetCursor(1) ; SetPos( 16, 22 ) ; AAdd( GetList, _GET_( nJuro, "nJuro", "999.99",,))
    SetCursor(1) ; SetPos( 17, 22 ) ; AAdd( GetList, _GET_( cObs, "cObs", "@!",,))
    SetCursor(1) ; SetPos( 18, 22 ) ; AAdd( GetList, _GET_( dDataPag, "dDataPag", "##/##/##",,))
    SetCursor(1) ; SetPos( 19, 22 ) ; AAdd( GetList, _GET_( nVlrPag, "nVlrPag", "@E 9,999,999,999.99",,))
    ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
    if LastKey() = 27
        AreaAnt( Arq_Ant, Ind_Ant )
        ResTela( cScreen )
        if lParam
           return( lRetVal )
        endif
        Exit
    endif
    DbGoTo( nRegistro )
    ErrorBeep()
    if (lRetVal := Conf( "Confirma Alteracao Do Registro ?"))
        nJdia := Jurodia( nVlr, nJuro )
        if Recemov->(TravaArq())
            DbGoTo( nRegistro )
            Recemov->Codi        := cCodi
            Recemov->Docnr     := cDocNr
            Recemov->Emis        := dEmis
            Recemov->Emis        := dEmis
            Recemov->Port        := cPort
            Recemov->Vcto        := dVcto
            Recemov->Vlr        := nVlr
            Recemov->Tipo        := cTipo
            Recemov->NossoNr    := cNossoNr
            Recemov->Bordero    := cBordero
            Recemov->Juro        := nJuro
            Recemov->Jurodia    := nJDia
            Recemov->VlrDolar := nVlr
            Recemov->Obs        := cObs
            Recemov->DataPag  := dDataPag
            Recemov->VlrPag   := nVlrPag
            Recemov->(Order( 4 ))
            if Recemov->(DbSeek( cFatura ))
                WHILE Recemov->Fatura = cFatura
                    Recemov->VlrFatu -= nVlrAnt
                    Recemov->VlrFatu += nVlr
                    Recemov->(DbSkip(1))
                EndDo
            endif
            Recemov->(Libera())
        endif
    endif
    ResTela( cScreen )
    DbGoTo( nRegistro )
    if lParam
        AreaAnt( Arq_Ant, Ind_Ant )
        return( lRetVal )
    endif
EndDo



Proc AlteraRecebido()

LOCAL cScreen    := SaveScreen()
LOCAL nCotacao := 0
LOCAL cDocnr    := Space(9)
LOCAL nVlrPag    := 0
LOCAL cObs        := ""

Receber->(Order( 2 ))
dbSelectArea( "Recebido" )
Recebido->(Order( 1 ))
if ( ! .F. ) ; dbClearRelation() ; end ; dbSetRelation( "Receber", {|| Codi}, "Codi", .F. )
WHILE .T.
    MaBox( 16 , 10 , 18 , 30 )
    SetCursor(1) ; DevPos( 17, 11 ) ; DevOut( "Doc.No..:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cDocNr, "cDocNr", "@K!", {|| RecebiErrado( @cDocNr )},))
    ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
    if LastKey() = 27
        Recebido->(DbClearRel())
        Recebido->(DbClearFilter())
        Recebido->(DbGoTop())
        ResTela( cScreen )
        Exit
    endif
    oMenu:Limpa()
    MaBox( 06 , 10 , 20 , 76, "ALTERACAO DE TITULO RECEBIDO" )
    Write( 07 , 11 ,    "Codigo...: " + Recebido->Codi + " " + Receber->Nome )
    Write( 08 , 11 ,    "Tipo.....: " + Recebido->Tipo)
    Write( 09 , 11 ,    "Doc.N?..: " + Recebido->Docnr)
    Write( 10 , 11 ,    "Nosso N?: " + Recebido->Nossonr)
    Write( 11 , 11 ,    "Bordero..: " + Recebido->Bordero)
    Write( 12 , 11 ,    "Emissao..: " + Recebido->(Dtoc(Emis)))
    Write( 13 , 11 ,    "Vencto...: " + Recebido->(Dtoc(Vcto)))
    Write( 14 , 11 ,    "Portador.: " + Recebido->Port)
    Write( 15 , 11 ,    "Valor....: " + Recebido->(Tran(Vlr,  "@E 9,999,999,999.99")))
    Write( 16 , 11 ,    "Jr Mes...: " + Recebido->(Tran(Juro, "999.99")))
    Write( 17 , 11 ,    "Data Pgto: " + Recebido->(Dtoc( DataPag)))
    Write( 18 , 11 ,    "Recebido.: " + Recebido->(Tran(VlrPag,"@E 9,999,999,999.99")))
    Write( 19 , 11 ,    "Obs......: " + Recebido->Obs )
    ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
    if LastKey() = 27
        DbClearFilter()
        ResTela( cScreen )
        Exit
    endif
    cCodi     := Recebido->Codi
    cTipo     := Recebido->Tipo
    cDocnr    := Recebido->Docnr
    cNossoNr := Recebido->NossoNr
    cBordero := Recebido->Bordero
    dEmis     := Recebido->Emis
    dVcto     := Recebido->Vcto
    cPort     := Recebido->Port
    nVlr        := Recebido->Vlr
    nJuro     := Recebido->Juro
    nVlrAnt    := Recebido->Vlr
    nVlrPag    := Recebido->VlrPag
    cFatura    := Recebido->Fatura
    dDataPag := Recebido->DataPag
    cObs        := Recebido->Obs

    SetCursor(1) ; SetPos( 07, 22 ) ; AAdd( GetList, _GET_( cCodi, "cCodi", "99999", {|| RecErrado( @cCodi,, Row(), Col()+1 )},))
    SetCursor(1) ; SetPos( 08, 22 ) ; AAdd( GetList, _GET_( cTipo, "cTipo", "@!",,))
    SetCursor(1) ; SetPos( 09, 22 ) ; AAdd( GetList, _GET_( cDocnr, "cDocnr", "@!",,))
    SetCursor(1) ; SetPos( 10, 22 ) ; AAdd( GetList, _GET_( cNossoNr, "cNossoNr", "@!",,))
    SetCursor(1) ; SetPos( 11, 22 ) ; AAdd( GetList, _GET_( cBordero, "cBordero", "@!",,))
    SetCursor(1) ; SetPos( 12, 22 ) ; AAdd( GetList, _GET_( dEmis, "dEmis", "##/##/##",,))
    SetCursor(1) ; SetPos( 13, 22 ) ; AAdd( GetList, _GET_( dVcto, "dVcto", "##/##/##",,))
    SetCursor(1) ; SetPos( 14, 22 ) ; AAdd( GetList, _GET_( cPort, "cPort", "@!",,))
    SetCursor(1) ; SetPos( 15, 22 ) ; AAdd( GetList, _GET_( nVlr, "nVlr", "@E 9,999,999,999.99",,))
    SetCursor(1) ; SetPos( 16, 22 ) ; AAdd( GetList, _GET_( nJuro, "nJuro", "999.99",,))
    SetCursor(1) ; SetPos( 17, 22 ) ; AAdd( GetList, _GET_( dDataPag, "dDataPag", "##/##/##",,))
    SetCursor(1) ; SetPos( 18, 22 ) ; AAdd( GetList, _GET_( nVlrPag, "nVlrPag", "@E 9,999,999,999.99",,))
    SetCursor(1) ; SetPos( 19, 22 ) ; AAdd( GetList, _GET_( cObs, "cObs", "@!",,))
    ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
    if LastKey() = 27
        ResTela( cScreen )
        Loop
    endif
    ErrorBeep()
    if Conf( "Confirma Alteracao Do Registro ?" )
        if Recebido->(TravaReg())
            Recebido->Codi      := cCodi
            Recebido->Docnr     := cDocNr
            Recebido->Emis      := dEmis
            Recebido->Emis      := dEmis
            Recebido->Port      := cPort
            Recebido->Vcto      := dVcto
            Recebido->Vlr         := nVlr
            Recebido->Tipo      := cTipo
            Recebido->NossoNr  := cNossoNr
            Recebido->Bordero  := cBordero
            Recebido->Juro      := nJuro
            Recebido->VlrPag     := nVlrPag
            Recebido->DataPag  := dDataPag
            Recebido->Obs         := cObs
            Recebido->(Libera())
        endif
    endif
    ResTela( cScreen )
EndDo



Function RecebiErrado( Var )

LOCAL Arq_Ant := Alias()
LOCAL Ind_Ant := IndexOrd()

dbSelectArea( "Recebido" )
Recebido->(Order( 1 ))
Recebido->(DbGoTop())
if Recebido->(Eof())
    AreaAnt( Arq_Ant, Ind_Ant )
    Nada()
    return( .F. )
endif
if !( DbSeek( Var ) )
    DbGoTop()
    Escolhe( 03, 01, 22, "Docnr + '? + Receber->Nome", "DOCTO N? NOME DO CLIENTE" )
    Var := Docnr
endif
AreaAnt( Arq_Ant, Ind_Ant )
if Empty( Var )
    return( .F. )
endif
return( .T. )



Proc Lancamentos(cCaixa)

LOCAL cScreen      := SaveScreen()
LOCAL aMenuArray := { " Normal ", " Fechamento Futuro " }
LOCAL nChoice      := 0

oMenu:Limpa()
WHILE .T.
    M_Title( "INCLUIR OS TITULOS COMO ?" )
    nChoice := FazMenu( 02, 10, aMenuArray, Cor())
    Do Case
        Case nChoice = 0
            ResTela( cScreen )
            Exit
      Case nChoice = 1
            ReceNormal(.T., cCaixa)
      Case nChoice = 2
            ReceNormal(.F., cCaixa)
      EndCase
EndDo



Function ReceNormal( lTipo, cCaixa, xDados )

LOCAL cScreen      := SaveScreen()
LOCAL GetList      := {}
LOCAL cCodi       := Space(05)
LOCAL dUltCompra := Date()
LOCAL nCotacao   := 0
LOCAL cDolar      := "R"
LOCAL aRecno      := {}
LOCAL cCond      := nil
LOCAL cFatura    := nil
LOCAL cObs       := "(escreva at 80 letras - CTRL + Y apaga linha)" + space(80-46)
LOCAL aMenu      := {"Promissoria Papel Branco", "Promissoria Papel Continuo", "Duplicata Form Branco","Duplicata Form Personalizado","Boleto Bancario"}
LOCAL PIC_OBS    := iif(MaxCol() <= 80, "@!S40", "@!")

WHILE .T.
    dbSelectArea( "Receber" )
    Receber->(Order( 2 ))
    oMenu:Limpa()
    if xDados <> NIL
       lSair := .T.
        cCodi := xDados[1]
        nVlr    := xDados[2]
        if !RecErrado( @cCodi ) .AND. !VerificaPosicao( cCodi, cCond, cFatura)
         return Nil
      endif
    else
        lSair  := .F.
        cCodi  := Space(05)
        nVlr     := 0
        MaBox( 05 , 10 , 07 , MaxCol()-13 )
        SetCursor(1) ; DevPos( 06, 11 ) ; DevOut( "Cliente.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodi, "cCodi", "99999", {|| RecErrado( @cCodi ) .AND. VerificaPosicao( cCodi, cCond, cFatura)},))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        if LastKey() = 27
            return( ResTela( cScreen))
        endif
    endif
    cNome      := Receber->Nome
    cEnde      := Receber->Ende
    nRecoCli  := Receber->(Recno())
    cRegiao     := Receber->Regiao
    cTipo      := "NP      "
    dVcto      := Date()
   nJuro     := oAmbiente:aSciArray[1,1]
    cPort      := "CARTEIRA  "
    cNosso     := Space( 13 )
    cBorde     := Space( 09 )
    dEmis      := Date()
    cDolar     := "R"

    WHILE .T.
        Nota->(Order( 0 ))
        Nota->(DbGoBottom())
        cDocnr := Nota->(StrZero( Val( Numero ) + 1, 7 )) + "-A"
        MaBox( 08 , 10 , 22 , MaxCol()-13 )
        Write( 09 , 11, "Codigo........: " + cCodi )
        Write( 10 , 11, "Cliente.......: " + cNome )
        Write( 11 , 11, "Endereco......: " + cEnde )
        SetCursor(1) ; DevPos( 12, 11 ) ; DevOut( "Tipo..........:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cTipo, "cTipo", "@K!",,))
        SetCursor(1) ; DevPos( 13, 11 ) ; DevOut( "Documento n?.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cDocnr, "cDocnr", "@K!", {|| LastKey()=5 .OR. DocCerto(@cDocnr)},))
        SetCursor(1) ; DevPos( 14, 11 ) ; DevOut( "Nosso N?.....:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cNosso, "cNosso", "@K!",,))
        SetCursor(1) ; DevPos( 15, 11 ) ; DevOut( "Bordero n?...:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cBorde, "cBorde", "@K!",,))
        SetCursor(1) ; DevPos( 16, 11 ) ; DevOut( "Data Emissao..:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dEmis, "dEmis", "##/##/##",,))
        SetCursor(1) ; DevPos( 17, 11 ) ; DevOut( "Data Vcto.....:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dVcto, "dVcto", "##/##/##", {|| LastKey()=5 .OR. if((dVcto<dEmis), (ErrorBeep(), Alerta("Erro: Entrada Invalida. Vcto tem que ser maior que Emissao."), .F. ), .T. )},))
        SetCursor(1) ; DevPos( 18, 11 ) ; DevOut( "Portador......:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cPort, "cPort", "@K!",,))
        SetCursor(1) ; DevPos( 19, 11 ) ; DevOut( "Valor.........:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nVlr, "nVlr", "@E 9999999999.99", {|| LastKey()=5 .OR. if(nVlr == 0,     (ErrorBeep(), Alerta("Erro: Entrada Invalida. Valor zerado fica dificil."),          .F. ), .T. )},))
        SetCursor(1) ; DevPos( 20, 11 ) ; DevOut( "Juros Mes.....:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nJuro, "nJuro", "999.99",,))
        SetCursor(1) ; DevPos( 21, 11 ) ; DevOut( "Observacao....:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cObs, "cObs", PIC_OBS,,))

        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        if LastKey() = 27
            Exit
        endif
        nOpcao := Alerta( "Voce Deseja ?", {" Incluir ", " Alterar ", " Sair "})
        if nOpcao = 1
            if !DocCerto( @cDocnr )
                Loop
            endif
            Jdia    :=  Jurodia( nVlr, nJuro )
            if Recemov->(!Incluiu())
                Loop
            endif
            aRecno                  := { Recemov->(Recno()) }
            Recemov->Codi          := cCodi
            Recemov->Docnr       := cDocnr
            Recemov->Emis          := dEmis
            Recemov->Qtd_D_Fatu := 1
            Recemov->Caixa       := cCaixa
            Recemov->Vcto          := dVcto
            Recemov->Vlr          := nVlr
            Recemov->Port          := cPort
            Recemov->Tipo          := cTipo
            Recemov->NossoNr      := cNosso
            Recemov->Juro          := nJuro
            Recemov->Bordero      := cBorde
            Recemov->Jurodia      := Jdia
            Recemov->Regiao      := cRegiao
            Recemov->Fatura      := Left( cDocnr, 7)
            Recemov->VlrFatu      := nVlr
            Recemov->VlrDolar   := nVlr
            Recemov->Titulo      := if( lTipo, .T., .F. )
            Recemov->Obs        := cObs
            Recemov->(Libera())

            if ( Receber->(Order( 2 )), Receber->( DbSeek( cCodi )))
                if Receber->UltCompra < dEmis
                    if Receber->(TravaReg())
                        Receber->UltCompra := dEmis
                        Receber->(Libera())
                    endif
                endif
            endif
            if Nota->(!Incluiu())
                Loop
            endif
            aRecno                  := { Recemov->(Recno()) }
            Nota->Numero        := Left(cDocnr,7)
            Nota->Data             := Date()
            Nota->Situacao      := "RECEBER"
            Nota->Caixa         := cCaixa
            Nota->Codi             := cCodi
            Nota->(Libera())

            WHILE .T.
                oMenu:Limpa()
                ErrorBeep()
                M_Title("LANCAMENTO EFETUDO COM SUCESSO. DESEJA IMPRIMIR ?")
                nEscolha := FazMenu( 10, 10, aMenu )
                Do Case
                Case nEscolha = 0
                    lSair := .T.
                    if xDados <> NIL
                       return( ResTela( cScreen))
                    endif
                    Exit
                Case nEscolha = 1
               ProBranco( cCodi, aRecno )
                Case nEscolha = 2
               ProPersonalizado( cCodi, aRecno )
                Case nEscolha = 3
                    DupPapelBco( cCodi, aRecno )
                Case nEscolha = 4
               DupPersonalizado( cCodi, aRecno )
                Case nEscolha = 3
                    DiretaLivre( cCodi, aRecno )
                EndCase
            EndDo

        elseif nOpcao = 2
            Loop

        elseif nOpcao = 3
            lSair := .T.
            Exit

        endif
    EndDo
    if lSair
        ResTela( cScreen )
        Exit
    endif
EndDo
return nil



Proc MenuDuplicata()

LOCAL cScreen    := SaveScreen()
LOCAL aData     := {}
LOCAL aValor    := {}
LOCAL aConta    := {}
LOCAL nRegis    := 0
LOCAL nPosicao := 0
LOCAL nTamanho := 0
LOCAL dIni        := Date()-30
LOCAL dFim        := Date()
LOCAL aMenu    := {"Formulario Branco", "Formulario Personalizado"}
LOCAL oBloco1
LOCAL oBloco2

WHILE .T.
   M_Title( "IMPRESSAO DUPLICATA")
   nChoice := FazMenu( 05, 10, aMenu, Cor() )
   Do Case
   Case nChoice = 0
      ResTela( cScreen )
      return
   Case nChoice = 1
     DupPapelBco()
   Case nChoice = 2
      DupPersonalizado()
   EndCase
ENDDO



Proc MenuPromissoria()

LOCAL cScreen    := SaveScreen()
LOCAL aData     := {}
LOCAL aValor    := {}
LOCAL aConta    := {}
LOCAL nRegis    := 0
LOCAL nPosicao := 0
LOCAL nTamanho := 0
LOCAL dIni        := Date()-30
LOCAL dFim        := Date()
LOCAL aMenu    := {"Formulario Branco", "Formulario Personalizado"}
LOCAL oBloco1
LOCAL oBloco2

WHILE .T.
   M_Title( "IMPRESSAO PROMISSORIA")
   nChoice := FazMenu( 05, 10, aMenu, Cor() )
   Do Case
   Case nChoice = 0
      ResTela( cScreen )
      return
   Case nChoice = 1
     ProBranco()
   Case nChoice = 2
      ProPersonalizado()
   EndCase
ENDDO



Proc Fluxo()

LOCAL cScreen    := SaveScreen()
LOCAL aData     := {}
LOCAL aValor    := {}
LOCAL aConta    := {}
LOCAL nRegis    := 0
LOCAL nPosicao := 0
LOCAL nTamanho := 0
LOCAL dIni        := Date()-30
LOCAL dFim        := Date()
LOCAL aMenu     := {"Por Vcto", "Por Emissao", "Geral"}
LOCAL oBloco1
LOCAL oBloco2

M_Title( "FLUXO SINTETICO")
nChoice := FazMenu( 03, 20, aMenu, Cor() )
Do Case
Case nChoice = 0
    ResTela( cScreen )
    return
Case nChoice = 1
    MaBox( 13 , 18 , 16, 50 )
    SetCursor(1) ; DevPos( 14, 19 ) ; DevOut( "Data Vcto Inicial..:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dIni, "dIni", "##/##/##",,))
    SetCursor(1) ; DevPos( 15, 19 ) ; DevOut( "Data Vcto Final....:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dFim, "dFim", "##/##/##",,))
    oBloco1 := {|| Recemov->Vcto >= dIni .AND. Recemov->Vcto <= dFim }
Case nChoice = 2
    MaBox( 13 , 18 , 16, 50 )
    SetCursor(1) ; DevPos( 14, 19 ) ; DevOut( "Data Emis Inicial..:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dIni, "dIni", "##/##/##",,))
    SetCursor(1) ; DevPos( 15, 19 ) ; DevOut( "Data Emis Final....:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dFim, "dFim", "##/##/##",,))
    oBloco2 := {|| Recemov->Emis >= dIni .AND. Recemov->Emis <= dFim }
EndCase
ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
if LastKey() = 27
    ResTela( cScreen )
    return
endif
oMenu:Limpa()
dbSelectArea( "ReceMov" )
Recemov->(Order( 3 ))
Recemov->(DbGoTop())
Mensagem("Aguarde, Processando. ESC Interrompe.")
nRegis := Lastrec()
WHILE !Eof() .AND. Rep_Ok()
    if nChoice = 1
        if !Eval( oBloco1 )
            Recemov->(DbSkip(1))
            Loop
        endif
    endif
    if nChoice = 2
        if !Eval( oBloco2 )
            Recemov->(DbSkip(1))
            Loop
        endif
    endif
    if ( nPosicao := Ascan( aData, Recemov->Vcto )) = 0
        Aadd( aData,  Recemov->Vcto )
        Aadd( aValor, Recemov->Vlr )
        Aadd( aConta, 1 )
    else
        aValor[ nPosicao ] += Recemov->Vlr
        aConta[ nPosicao ]++
    endif
    Recemov->(DbSkip( 1 ))
EndDo
if ( nTamanho := Len( aData )) = 0
    NaoTem()
    Restela( cScreen )
    return
endif
oMenu:Limpa()
if InsTru80()
    ImprimirFluxo( aData, aValor, aConta, SISTEM_NA3 )
endif
ResTela( cScreen )
return



Proc ImprimirFluxo( aData, aValor, aConta, cSistema )

LOCAL cScreen    := SaveScreen()
LOCAL nTamanho := Len( aData )
LOCAL nTotal    := FT_Asum( aValor )
LOCAL nConta    := FT_Asum( aConta )
LOCAL Tam        := 80
LOCAL Col        := 58
LOCAL Pagina    := 0
LOCAL Relato    := "FLUXO SINTETICO DE VENCIMENTOS"
LOCAL ContaFor := 0

PrintOn()
SetPrc( 0 , 0 )
FOR ContaFor := 1 To nTamanho
    if Col >= 57
        Write( 00, 00, Padr( "Pagina N?" + StrZero( ++Pagina,3 ), ( Tam/2 ) ) + Padl( Time(), ( Tam/2 ) ) )
        Write( 01, 00, Date() )
      Write( 02, 00, Padc( ltrim(rtrim(oAmbiente:xNomefir)), Tam ) )
        Write( 03, 00, Padc( cSistema, Tam ) )
        Write( 04, 00, Padc( Relato, Tam ) )
        Write( 05, 00, Repl( "-", Tam ) )
        Write( 06, 00, "VCTO      QTD                                                          VALOR R$")
        Write( 07, 00, Repl( "-", Tam ) )
        Col := 8
    endif
    Qout( aData[ ContaFor ], Tran( aConta[ContaFor],"9999"), Repl(".", 48 ), Tran( aValor[ ContaFor ],"@E 9,999,999,999.99"))
    Col++
    if Col >= 57
        Write( ++Col, 0, Repl( "-" , Tam ) )
        __Eject()
    endif
Next
Write( ++Col, 00, "*Total*" )
Write(    Col, 09, Tran( nConta, "99999"))
Write(    Col, 62, Tran( nTotal, "@E 999,999,999,999.99" ) )
__Eject()
PrintOff()
ResTela( cScreen )
return



Proc CobTitulo()

LOCAL cScreen      := SaveScreen()
LOCAL aMenuArray := { "Individual", "Geral" }
LOCAL nChoice      := 0
LOCAL xDbf          := FTempName("T*.TMP")
LOCAL dIni          := Date()-30
LOCAL dFim          := Date()
LOCAL cCodi
FIELD Codi
FIELD Vcto

WHILE .T.
    M_Title("CARTA DE COBRANCA")
    nChoice := FazMenu( 03 , 10, aMenuArray, Cor() )
    Do Case
    Case nChoice  = 0
        ResTela( cScreen )
        return

    Case nChoice  = 1
        cCodi := Space(05)
        dIni    := Date()-30
        dFim    := Date()
        MaBox( 09 , 10, 13 , 36 )
        SetCursor(1) ; DevPos( 10, 11 ) ; DevOut( "Cliente......:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodi, "cCodi", "99999", {|| RecErrado( @cCodi )},))
        SetCursor(1) ; DevPos( 11, 11 ) ; DevOut( "Vcto Inicial.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dIni, "dIni", "##/##/##",,))
        SetCursor(1) ; DevPos( 12, 11 ) ; DevOut( "Vcto Final...:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dFim, "dFim", "##/##/##",,))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        if LastKey() = 27
            ResTela( cScreen    )
            Loop
        endif
        dbSelectArea( "ReceMov" )
        Recemov->(Order( 2 ))
        if Recemov->(!DbSeek( cCodi ))
            ErrorBeep()
            Nada()
            ResTela( cScreen )
            Loop
        endif
        __dbCopyStruct( ( xDbf ), { } )
        dbUseArea( .T.,, (xDbf), "xTemp", iif( .F. .OR. .T., ! .T., NIL ), .F. )
        WHILE Recemov->Codi = cCodi
            if Recemov->Vcto >= dIni .AND. Recemov->Vcto <= dFim
                xTemp->(DbAppend())
                For nField := 1 To FCount()
                    xTemp->( FieldPut( nField, Recemov->(FieldGet( nField ))))
                Next
            endif
            Recemov->(DbSkip(1))
        EndDo
        Receber->( Order( 2 ))
        xTemp->(DbGoTop())
        if ( ! .F. ) ; dbClearRelation() ; end ; dbSetRelation( "Receber", {|| xTemp->Codi}, "xTemp->Codi", .F. )
        xTemp->(DbGoTop())
        Prn006()
        xTemp->(DbClearRel())
        xTemp->(DbGoTop())
        xTemp->(DbCloseArea())
        Ferase( xDbf )
        ResTela( cScreen )
        Loop

    Case nChoice  = 2
        dIni    := Date()-30
        dFim    := Date()
        MaBox( 09 , 10, 12 , 36 )
        SetCursor(1) ; DevPos( 10, 11 ) ; DevOut( "Vcto Inicial.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dIni, "dIni", "##/##/##",,))
        SetCursor(1) ; DevPos( 11, 11 ) ; DevOut( "Vcto Final...:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dFim, "dFim", "##/##/##",,))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        if LastKey() = 27
            ResTela( cScreen    )
            Loop
        endif
        dbSelectArea( "ReceMov" )
        Recemov->(Order( 2 ))
        __dbCopyStruct( ( xDbf ), { } )
        dbUseArea( .T.,, (xDbf), "xTemp", iif( .F. .OR. .T., ! .T., NIL ), .F. )
        WHILE Recemov->( !Eof())
            if Recemov->Vcto >= dIni .AND. Recemov->Vcto <= dFim
                xTemp->(DbAppend())
                For nField := 1 To FCount()
                    xTemp->( FieldPut( nField, Recemov->(FieldGet( nField ))))
                Next
            endif
            Recemov->(DbSkip(1))
        EndDo
        Receber->( Order( 2 ))
        xTemp->(DbGoTop())
        if ( ! .F. ) ; dbClearRelation() ; end ; dbSetRelation( "Receber", {|| xTemp->Codi}, "xTemp->Codi", .F. )
        xTemp->(DbGoTop())
        Prn006()
        xTemp->(DbClearRel())
        xTemp->(DbGoTop())
        xTemp->(DbCloseArea())
        Ferase( xDbf )
        ResTela( cScreen )
        Loop

    EndCase
EndDo



Proc Prn006()

LOCAL GetList     := {}
LOCAL cScreen     := SaveScreen()
LOCAL lSair      := .F.
LOCAL NovoNome  := .T.
LOCAL Files      := "*.DOC"
LOCAL Arquivo     := "COBRANCA.DOC"
LOCAL nAtraso     := 0
LOCAL Total      := 0
LOCAL TotJur     := 0
LOCAL nVlrAtual := 0
LOCAL nCarencia := 0
LOCAL nRow         := 0
LOCAL lTitulo     := .F.
LOCAL Imprime
LOCAL UltNome
LOCAL Col
LOCAL Campo
LOCAL Linha
LOCAL Linhas
FIELD Codi
FIELD Vcto
FIELD Vlr
FIELD Docnr
FIELD Emis
FIELD Juro
FIELD Cida
FIELD JuroDia

MaBox( 14 , 10 , 16 , 53 )
SetCursor(1) ; DevPos( 15, 11 ) ; DevOut( "Arquivo Carta de Cobrana.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( Arquivo, "Arquivo", "@!",,))
ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
if LastKey() = 27
    ResTela( cScreen )
    return
endif
ErrorBeep()
lTitulo := Conf("Pergunta: Imprimir relacao dos titulos em atraso na carta?")
if LastKey() = 27
    ResTela( cScreen )
    return
endif
FT_ChDir( oAmbiente:xBaseDoc )
LETO_SET( 7, ( oAmbiente:xBaseDoc ) )
if Empty( Arquivo )
    M_Title( "Setas CIMA/BAIXO Move")

    if Empty( Arquivo )
        FT_ChDir( oAmbiente:xBaseDados )
        LETO_SET( 7, ( oAmbiente:xBaseDados ) )
        ErrorBeep()
        ResTela( cScreen )
        return
  endif
else
    if !File( Arquivo )
        FT_ChDir( oAmbiente:xBaseDados )
        LETO_SET( 7, ( oAmbiente:xBaseDados ) )
        ErrorBeep()
        ResTela( cScreen )
        Alert( Rtrim( Arquivo ) + " Nao Encontrado... " )
        ResTela( cScreen )
        return
    endif
endif
if !InsTru80()
    FT_ChDir( oAmbiente:xBaseDados )
    LETO_SET( 7, ( oAmbiente:xBaseDados ) )
    ResTela( cScreen    )
    return
endif
oMenu:Limpa()
Mensagem("Aguarde, Imprimindo. ESC Cancela.")
UltNome    := Receber->Nome
PrintOn()
SetPrc( 0 , 0 )
WHILE !Eof() .AND. Rel_Ok()
    nAtraso     := Atraso( Date(), Vcto )
    nCarencia := Carencia( Date(), Vcto )
    if nAtraso <= 0
        TotJur := 0
    else
        TotJur := ( Jurodia * nCarencia )
    endif
    nVlrAtual := ( TotJur + Vlr )
    if NovoNome
        NovoNome := .F.
        Total := 0
        Write( 02 , 0, DataExt( Date()))
        Write( 06 , 0, "A" )
        Write( 07 , 0, NG + Receber->Nome + NR )
        Write( 08 , 0, Receber->Ende )
        Write( 09 , 0, Receber->Bair )
        Write( 10 , 0, LIGSUB + Receber->Cep + "/" + Receber->( Rtrim( Cida ) ) + "/" + Receber->Esta + DESSUB )
        Campo  := MemoRead( Arquivo )
        Linhas := MlCount( Campo , 80 )
        FOR Linha  :=    1 To Linhas
            Imprime :=    MemoLine( Campo , 80 , Linha )
            Write( 15 + Linha -1 , 0, Imprime )
        Next
        if lTitulo
            Write( 46 , 0 , "DOCTO N? VENCTO  ATRASO   VALOR ATUAL    DOCTO N? VENCTO  ATRASO   VALOR ATUAL")
            Qout(Repl("-",80))
        endif
        Col := 48
    endif
    if nRow = 0
        if lTitulo
            Qout( Docnr, Vcto, Tran(nAtraso,"99999"),Tran(nVlrAtual, "99,999,999.99"))
        endif
        nRow = 40
    else
        if lTitulo
            QQout(Space(3), Docnr, Vcto, Tran(nAtraso,"99999"),Tran(nVlrAtual, "99,999,999.99"))
        endif
        nRow := 0
        Col++
    endif
    UltNome := Receber->Nome
    Total   += nVlrAtual
    DbSkip(1)
    if Col >= 55 .OR. UltNome <> Receber->Nome .OR. Eof()
        NovoNome := .T.
        if lTitulo
            Qout()
            Qout(" ** Total a Pagar **", Space(12),Tran(Total,"@E 99,999,999.99"))
            Qout(Repl("-",80))
        endif
        __Eject()
    endif
EndDo
PrintOff()
FT_ChDir( oAmbiente:xBaseDados )
LETO_SET( 7, ( oAmbiente:xBaseDados ) )
ResTela( cScreen )
return



Function AchaPortador( cPortador )

Recebido->(Order( 6 ))
if Recebido->(!DbSeek( cPortador ))
    ErrorBeep()
    Alert("Erro: Portador nao localizado.")
    return( .F. )
endif
return( .T. )



Function DocCerto( cDocNr )

LOCAL Arq_Ant := Alias()
LOCAL Ind_Ant := IndexOrd()
if LastKey() = 5
    return( .T. )
endif
if Empty( cDocNr )
    ErrorBeep()
    Alerta( "Erro: Numero Documento Invalido...")
    return( .F. )
endif
dbSelectArea( "ReceMov" )
Recemov->(Order( 1 ))
Recemov->(DbGoTop())
if Recemov->(DbSeek( cDocNr ))
    ErrorBeep()
    Alerta("Erro: Numero Documento Ja Registrado ou,; Incluido por outra Estacao...")
    cDocnr := StrZero( Val( cDocnr ) + 1, 9 )
    AreaAnt( Arq_Ant, Ind_Ant )
    return( .F. )
endif
AreaAnt( Arq_Ant, Ind_Ant )
return( .T. )



Proc PrnAlfabetica( nVctoOuEmis )

LOCAL cScreen        := SaveScreen()
LOCAL xAlfa         := FTempName()
LOCAL aMenuArray    := {"Por Regiao", "Por Periodo *", "Por Tipo", "Individual", "Por Portador"}
LOCAL nField        := 0
LOCAL nChoice        := 0
LOCAL lSair         := .F.
LOCAL Tam            := 93
LOCAL Col            := 8
LOCAL Pagina        := 0
LOCAL cNome         := Space(0)
LOCAL nTotal        := 0
LOCAL nTotalDolar := 0
LOCAL nTotalAtual := 0
LOCAL nQtdDoc        := 0
LOCAL cTitle        := if( nVctoOuEmis == 1, "VCTO : ", "EMISSAO : ") + "ORDEM ALFABETICA"
LOCAL cTitulo        := if( nVctoOuEmis == 1, "VENCIMENTO : ", "EMISSAO : ")
LOCAL nRolRecemov := oIni:ReadInteger("relatorios", "rolrecemov", 2 )
LOCAL cCodi         := ""
LOCAL cPortador    := ""
LOCAL cFatura
LOCAL Titulo
LOCAL UltCodi
LOCAL dIni
LOCAL dFim
LOCAL bBloco
LOCAL cTipo
LOCAL aStru
LOCAL lMarcado

ErrorBeep()
lMarcado := Conf("Pergunta: Incluir no relatorio os marcados ?")
WHILE .T.
    M_Title( cTitle )
    nChoice := FazMenu( 05, 22, aMenuArray, Cor())
    Do Case
    Case nChoice = 0
        ResTela( cScreen )
        return

    Case nChoice = 1
        cRegiao := Space(2)
        dIni      := Date() - 30
        dFim      := Date()
        MaBox( 17, 10, 21, 35 )
        SetCursor(1) ; DevPos( 18, 11 ) ; DevOut( "Regiao.....: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cRegiao, "cRegiao", "99", {|| RegiaoErrada( @cRegiao )},))
        SetCursor(1) ; DevPos( 19, 11 ) ; DevOut( "Data Ini...: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dIni, "dIni", "##/##/##",,))
        SetCursor(1) ; DevPos( 20, 11 ) ; DevOut( "Data Fim...: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dFim, "dFim", "##/##/##",,))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        if LastKey() = 27
            ResTela( cScreen )
            Loop
        endif
        Regiao->(Order( 1 ))
        if Regiao->(DbSeek( cRegiao))
            cNome := Regiao->Nome
        endif
        cIni     := Dtoc( dIni )
        cFim     := Dtoc( dFim )
        Titulo := "ROL DE TITULOS A RECEBER DA REGIAO " + ltrim(rtrim(cNome)) + " REF. &cIni. A &cFim."
        Mensagem("Aguarde... ")
        Saidas->(Order( 3 ))
        Receber->(Order( 2 ))
        dbSelectArea( "Recemov" )
        Recemov->(Order( 5 ))
        if Recemov->(!DbSeek( cRegiao ))
            ErrorBeep()
            Alerta("Erro: Regiao nao localizada.")
            ResTela( cScreen )
            Loop
        endif
        aStru := Recemov->(DbStruct())
        Aadd( aStru, {"NOME",  "C", 40, 0})
        DbCreate( xAlfa, aStru )
        dbUseArea( .T.,, (xAlfa), "xTemp", iif( .F. .OR. .T., ! .T., NIL ), .F. )
        While Recemov->Regiao = cRegiao
            if !lMarcado
                if Receber->(DbSeek( Recemov->Codi ))
                    if Receber->Rol = .T.
                        Recemov->(DbSkip(1))
                        Loop
                    endif
                endif
            endif
            if nVctoOuEmis == 1
                if Recemov->Vcto >= dIni .AND. Recemov->Vcto <= dFim
                    if nRolRecemov = 2
                        cFatura := Recemov->Fatura
                        if Saidas->(DbSeek( cFatura ))
                            if !Saidas->Impresso
                                Recemov->(DbSkip(1))
                                Loop
                            endif
                        endif
                    endif
                    xTemp->(DbAppend())
                    cCodi := Recemov->Codi
                    For nField := 1 To Recemov->(FCount())
                        xTemp->(FieldPut( nField, Recemov->(FieldGet( nField ))))
                    Next
                    Receber->(DbSeek( cCodi ))
                    xTemp->Nome := Receber->Nome
                endif
             else
                if Recemov->Emis >= dIni .AND. Recemov->Emis <= dFim
                    xTemp->(DbAppend())
                    cCodi := Recemov->Codi
                    For nField := 1 To Recemov->(FCount())
                        xTemp->(FieldPut( nField, Recemov->(FieldGet( nField ))))
                    Next
                    Receber->(DbSeek( cCodi ))
                    xTemp->Nome := Receber->Nome
                 endif
             endif
             Recemov->(DbSkip(1))
        EndDo
        PrnAlfaPrint( Titulo )
        xTemp->(DbCloseArea())
        Ferase( xAlfa )
        ResTela( cScreen )
        Loop

    Case nChoice = 2
        dIni := Date()-30
        dFim := Date()
        MaBox( 17, 10, 20, 35 )
        SetCursor(1) ; DevPos( 18, 11 ) ; DevOut( "Data Ini...: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dIni, "dIni", "##/##/##", {|| if( nVctoOuEmis == 1, AchaVcto( @dIni ), AchaEmis( @dIni ))},))
        SetCursor(1) ; DevPos( 19, 11 ) ; DevOut( "Data Fim...: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dFim, "dFim", "##/##/##",,))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        if LastKey() = 27
            ResTela( cScreen )
            Loop
        endif
        cIni     := Dtoc( dIni )
        cFim     := Dtoc( dFim )
        Titulo := "ROL DE TITULOS A RECEBER COM " + cTitulo + " DE &cIni. A &cFim."
        Mensagem("Aguarde... ")
        Saidas->(Order( 3 ))
        Receber->(Order( 2 ))
        dbSelectArea( "Recemov" )
        if nVctoOuEmis == 1
            Recemov->(Order( 3 ))
        else
            Recemov->(Order( 6 ))
        endif
        if Recemov->(!DbSeek( dIni ))
            ErrorBeep()
            Alerta("Erro: Data Emissao Inicial nao localizada.")
            ResTela( cScreen )
            Loop
        endif
        aStru := Recemov->(DbStruct())
        Aadd( aStru, {"NOME",  "C", 40, 0})
        DbCreate( xAlfa, aStru )
        dbUseArea( .T.,, (xAlfa), "xTemp", iif( .F. .OR. .T., ! .T., NIL ), .F. )
        if nVctoOuEmis == 1
            While Recemov->Vcto >= dIni .AND. Recemov->Vcto <= dFim
                if !lMarcado
                    if Receber->(DbSeek( Recemov->Codi ))
                        if Receber->Rol = .T.
                            Recemov->(DbSkip(1))
                            Loop
                        endif
                    endif
                endif
                if nRolRecemov = 2
                    cFatura := Recemov->Fatura
                    if Saidas->(DbSeek( cFatura ))
                        if !Saidas->Impresso
                            Recemov->(DbSkip(1))
                            Loop
                        endif
                    endif
                endif
                xTemp->(DbAppend())
                cCodi := Recemov->Codi
                For nField := 1 To Recemov->(FCount())
                    xTemp->(FieldPut( nField, Recemov->(FieldGet( nField ))))
                Next
                Receber->(DbSeek( cCodi ))
                xTemp->Nome := Receber->Nome
                Recemov->(DbSkip(1))
            EndDo
        else
            While Recemov->Emis >= dIni .AND. Recemov->Emis <= dFim
                if !lMarcado
                    if Receber->(DbSeek( Recemov->Codi ))
                        if Receber->Rol = .T.
                            Recemov->(DbSkip(1))
                            Loop
                        endif
                    endif
                endif
                xTemp->(DbAppend())
                cCodi := Recemov->Codi
                For nField := 1 To Recemov->(FCount())
                    xTemp->(FieldPut( nField, Recemov->(FieldGet( nField ))))
                Next
                Receber->(DbSeek( cCodi ))
                xTemp->Nome := Receber->Nome
                Recemov->(DbSkip(1))
            EndDo
        endif
        PrnAlfaPrint( Titulo )
        xTemp->(DbCloseArea())
        Ferase( xAlfa )
        ResTela( cScreen )
        Loop

    Case nChoice = 3
        cTipo := Space(06)
        dIni    := Date()-30
        dFim    := Date()
        MaBox( 17, 10, 21, 35 )
        SetCursor(1) ; DevPos( 18, 11 ) ; DevOut( "Tipo.......: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cTipo, "cTipo", "@!", {|| AchaTipo( cTipo )},))
        SetCursor(1) ; DevPos( 19, 11 ) ; DevOut( "Data Ini...: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dIni, "dIni", "##/##/##",,))
        SetCursor(1) ; DevPos( 20, 11 ) ; DevOut( "Data Fim...: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dFim, "dFim", "##/##/##",,))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        if LastKey() = 27
            ResTela( cScreen )
            Loop
        endif
        Titulo := "ROL DE TITULOS A RECEBER TIPO " + cTipo
        Mensagem("Aguarde... ")
        Saidas->(Order( 3 ))
        Receber->(Order( 2 ))
        dbSelectArea( "Recemov" )
        Recemov->(Order( 8 ))
        if Recemov->(!DbSeek( cTipo ))
            ErrorBeep()
            Alerta("Erro: Tipo nao localizado.")
            ResTela( cScreen )
            Loop
        endif
        aStru := Recemov->(DbStruct())
        Aadd( aStru, {"NOME",  "C", 40, 0})
        DbCreate( xAlfa, aStru )
        dbUseArea( .T.,, (xAlfa), "xTemp", iif( .F. .OR. .T., ! .T., NIL ), .F. )
        While Recemov->Tipo = cTipo
            if !lMarcado
              if Receber->(DbSeek( Recemov->Codi ))
                    if Receber->Rol = .T.
                        Recemov->(DbSkip(1))
                        Loop
                    endif
                endif
            endif
            if nVctoOuEmis == 1
                if Recemov->Vcto >= dIni .AND. Recemov->Vcto <= dFim
                    if nRolRecemov = 2
                        cFatura := Recemov->Fatura
                        if Saidas->(DbSeek( cFatura ))
                            if !Saidas->Impresso
                                Recemov->(DbSkip(1))
                                Loop
                            endif
                        endif
                    endif
                    xTemp->(DbAppend())
                    cCodi := Recemov->Codi
                    For nField := 1 To Recemov->(FCount())
                        xTemp->(FieldPut( nField, Recemov->(FieldGet( nField ))))
                    Next
                    Receber->(DbSeek( cCodi ))
                    xTemp->Nome := Receber->Nome
                endif
             else
                if Recemov->Emis >= dIni .AND. Recemov->Emis <= dFim
                    xTemp->(DbAppend())
                    cCodi := Recemov->Codi
                    For nField := 1 To Recemov->(FCount())
                        xTemp->(FieldPut( nField, Recemov->(FieldGet( nField ))))
                    Next
                    Receber->(DbSeek( cCodi ))
                    xTemp->Nome := Receber->Nome
                 endif
             endif
             Recemov->(DbSkip(1))
        EndDo
        PrnAlfaPrint( Titulo )
        xTemp->(DbCloseArea())
        Ferase( xAlfa )
        ResTela( cScreen )
        Loop

    Case nChoice = 4
        cCodi := Space(05)
        dIni    := Date()-30
        dFim    := Date()
        MaBox( 17, 10, 21, 32 )
        SetCursor(1) ; DevPos( 18, 11 ) ; DevOut( "Cliente...: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodi, "cCodi", "99999", {|| RecErrado( @cCodi )},))
        SetCursor(1) ; DevPos( 19, 11 ) ; DevOut( "Data Ini..: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dIni, "dIni", "##/##/##",,))
        SetCursor(1) ; DevPos( 20, 11 ) ; DevOut( "Data Fim..: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dFim, "dFim", "##/##/##",,))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        if LastKey() = 27
            ResTela( cScreen )
            Loop
        endif
        Titulo := "ROL DE TITULOS A RECEBER DO CLIENTE " + Receber->(ltrim(rtrim(Nome)))
        Mensagem("Aguarde... ")
        Saidas->(Order( 3 ))
        Receber->(Order( 2 ))
        dbSelectArea( "Recemov" )
        Recemov->(Order( 2 ))
        if Recemov->(!DbSeek( cCodi ))
            ErrorBeep()
            Alerta("Erro: Movimento do Cliente nao localizado.")
            ResTela( cScreen )
            Loop
        endif
        aStru := Recemov->(DbStruct())
        Aadd( aStru, {"NOME",  "C", 40, 0})
        DbCreate( xAlfa, aStru )
        dbUseArea( .T.,, (xAlfa), "xTemp", iif( .F. .OR. .T., ! .T., NIL ), .F. )
        While Recemov->Codi = cCodi
            if !lMarcado
              if Receber->(DbSeek( Recemov->Codi ))
                    if Receber->Rol = .T.
                        Recemov->(DbSkip(1))
                        Loop
                    endif
                endif
            endif
            if nVctoOuEmis == 1
                if Recemov->Vcto >= dIni .AND. Recemov->Vcto <= dFim
                    if nRolRecemov = 2
                        cFatura := Recemov->Fatura
                        if Saidas->(DbSeek( cFatura ))
                            if !Saidas->Impresso
                                Recemov->(DbSkip(1))
                                Loop
                            endif
                        endif
                    endif
                    xTemp->(DbAppend())
                    cCodi := Recemov->Codi
                    For nField := 1 To Recemov->(FCount())
                        xTemp->(FieldPut( nField, Recemov->(FieldGet( nField ))))
                    Next
                    Receber->(DbSeek( cCodi ))
                    xTemp->Nome := Receber->Nome
                 endif
             else
                if Recemov->Emis >= dIni .AND. Recemov->Emis <= dFim
                    xTemp->(DbAppend())
                    cCodi := Recemov->Codi
                    For nField := 1 To Recemov->(FCount())
                        xTemp->(FieldPut( nField, Recemov->(FieldGet( nField ))))
                    Next
                    Receber->(DbSeek( cCodi ))
                    xTemp->Nome := Receber->Nome
                 endif
             endif
             Recemov->(DbSkip(1))
        EndDo
        PrnAlfaPrint( Titulo )
        xTemp->(DbCloseArea())
        Ferase( xAlfa )
        ResTela( cScreen )
        Loop

    Case nChoice = 5
        cPortador := Space(10)
        dIni         := Date()-30
        dFim         := Date()
        MaBox( 17, 10, 21, 40 )
        SetCursor(1) ; DevPos( 18, 11 ) ; DevOut( "Portador...: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cPortador, "cPortador", "@!",,))
        SetCursor(1) ; DevPos( 19, 11 ) ; DevOut( "Data Ini...: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dIni, "dIni", "##/##/##", {|| if( nVctoOuEmis == 1, AchaVcto( @dIni ), AchaEmis( @dIni ))},))
        SetCursor(1) ; DevPos( 20, 11 ) ; DevOut( "Data Fim...: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dFim, "dFim", "##/##/##",,))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        if LastKey() = 27
            ResTela( cScreen )
            Loop
        endif
        Titulo := "ROL DE TITULOS A RECEBER DO PORTADOR " + cPortador
        Mensagem("Aguarde... ")
        Saidas->(Order( 3 ))
        Receber->(Order( 2 ))
        dbSelectArea( "Recemov" )
        if nVctoOuEmis == 1
            Recemov->(Order( 3 ))
        else
            Recemov->(Order( 6 ))
        endif
        if Recemov->(!DbSeek( dIni ))
            ErrorBeep()
            Alerta("Erro: Data Emissao Inicial nao localizada.")
            ResTela( cScreen )
            Loop
        endif
        aStru := Recemov->(DbStruct())
        Aadd( aStru, {"NOME",  "C", 40, 0})
        DbCreate( xAlfa, aStru )
        dbUseArea( .T.,, (xAlfa), "xTemp", iif( .F. .OR. .T., ! .T., NIL ), .F. )
        if nVctoOuEmis == 1
            While Recemov->Emis >= dIni .AND. Recemov->Emis <= dFim
                if !lMarcado
                  if Receber->(DbSeek( Recemov->Codi ))
                        if Receber->Rol = .T.
                            Recemov->(DbSkip(1))
                            Loop
                        endif
                    endif
                endif
                if Recemov->Port = cPortador
                    if nRolRecemov = 2
                        cFatura := Recemov->Fatura
                        if Saidas->(DbSeek( cFatura ))
                            if !Saidas->Impresso
                                Recemov->(DbSkip(1))
                                Loop
                            endif
                        endif
                    endif
                    xTemp->(DbAppend())
                    cCodi := Recemov->Codi
                    For nField := 1 To Recemov->(FCount())
                        xTemp->(FieldPut( nField, Recemov->(FieldGet( nField ))))
                    Next
                    Receber->(DbSeek( cCodi ))
                    xTemp->Nome := Receber->Nome
                endif
                Recemov->(DbSkip(1))
            EndDo
        else
            While Recemov->Emis >= dIni .AND. Recemov->Emis <= dFim
                if !lMarcado
                  if Receber->(DbSeek( Recemov->Codi ))
                        if Receber->Rol = .T.
                            Recemov->(DbSkip(1))
                            Loop
                        endif
                    endif
                endif
                if Recemov->Port = cPortador
                    xTemp->(DbAppend())
                    cCodi := Recemov->Codi
                    For nField := 1 To Recemov->(FCount())
                        xTemp->(FieldPut( nField, Recemov->(FieldGet( nField ))))
                    Next
                    Receber->(DbSeek( cCodi ))
                    xTemp->Nome := Receber->Nome
                endif
                Recemov->(DbSkip(1))
            EndDo
        endif
        PrnAlfaPrint( Titulo )
        xTemp->(DbCloseArea())
        Ferase( xAlfa )
        ResTela( cScreen )
        Loop
    EndCase
EndDo
ResTela( cScreen )
return

Proc PrnAlfaPrint( cTitulo )

LOCAL aOrdem     := {"Nome","Codigo","Documento","Emissao", "Portador", "Tipo", "Valor", "Vencimento *"}
LOCAL xNtx         := FTempName()
LOCAL cScreen     := SaveScreen()
LOCAL Tam         := 132
LOCAL Col         := 8
LOCAL nQtdDoc     := 0
LOCAL nTotal     := 0
LOCAL nAtraso     := 0
LOCAL nCarencia := 0
LOCAL nJuros     := 0
LOCAL nTotTit     := 0
LOCAL nTotJur     := 0
LOCAL cUltLetra := ""
LOCAL nParcDoc  := 0
LOCAL nParcTit  := 0
LOCAL nParcJur  := 0

WHILE .T.
    oMenu:Limpa()
    M_Title("ESCOLHA A ORDEM A IMPRIMIR. ESC RETORNA")
    nOpcao := FazMenu( 05, 10, aOrdem )
    Mensagem("Aguarde, Ordenando.")
    dbSelectArea( "xTemp" )
    if nOpcao = 0
        ResTela( cScreen )
        return
    elseif nOpcao = 1
         ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Nome", {|| xTemp->Nome}, )
    elseif nOpcao = 2
         ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Codi", {|| xTemp->Codi}, )
     elseif nOpcao = 3
         ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Docnr", {|| xTemp->Docnr}, )
     elseif nOpcao = 4
         ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Emis", {|| xTemp->Emis}, )
     elseif nOpcao = 5
         ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Port", {|| xTemp->Port}, )
     elseif nOpcao = 6
         ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Tipo", {|| xTemp->Tipo}, )
     elseif nOpcao = 7
         ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Vlr", {|| xTemp->Vlr}, )
     elseif nOpcao = 8
         ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Vcto", {|| xTemp->Vcto}, )
    endif
    xTemp->(DbGoTop())
    Tam         := 132
    Col         := 8
    nQtdDoc     := 0
    nTotal     := 0
    nAtraso     := 0
    nCarencia := 0
    nJuros     := 0
    nTotTit     := 0
    nTotJur     := 0
    if !InsTru80() .OR. !LptOk()
        ResTela( cScreen )
        return
    endif
    Mensagem("Aguarde, Imprimindo. ESC Cancela.")
    PrintOn()
    FPrint( PQ )
    SetPrc(0, 0)
    cCabec( cTitulo, Tam )
    WHILE !Eof() .AND. Rel_Ok( )
        if Col >= 57
            __Eject()
            cCabec( cTitulo, Tam )
            Col := 8
        endif
        nAtraso     := Atraso( Date(), Vcto )
        nCarencia := Carencia( Date(), Vcto )
        nJuros     := if( nAtraso <=0, 0, JuroDia * nCarencia )


        Qout( Codi, Left( Nome, 35), Tipo, Docnr, Emis, Vcto,    Vlr, Tran( Juro, "999.99"), Tran( nAtraso, "99999"),    Tran( Jurodia,"99999999.99"), Tran( (Vlr + nJuros), "@E 9,999,999,999.99"))
        nQtdDoc     ++
        nParcDoc  ++
        cUltLetra := Left(Nome,1)
        nTotTit     += Vlr
        nParcTit  += Vlr
        nTotJur     += Vlr + nJuros
        nParcJur  += Vlr + nJuros
        Col++
        DbSkip(1)
        if nOpcao = 1
            if Left(Nome,1) <> cUltLetra
                Qout()
                Col++
                Write( Col, 000, " ** Parcial ** " + Tran( nParcDoc, "99999" ))
                Write( Col, 074, Tran( nParcTit, "@E 9,999,999,999.99") )
                Write( Col, 116, Tran( nParcJur, "@E 9,999,999,999.99") )
                Qout()
                Col        ++
                nParcDoc := 0
                nParcTit := 0
                nParcJur := 0
            endif
        endif
        if Col >= 57
          __Eject()
          cCabec( cTitulo, Tam )
          Col := 8
        endif
    EndDo
    Qout()
    Write( ++Col, 000, " ** Total ** " + Tran( nQtdDoc, "99999" ))
    Write(    Col, 074, Tran( nTotTit, "@E 9,999,999,999.99") )
    Write(    Col, 116, Tran( nTotJur, "@E 9,999,999,999.99") )
    __Eject()
    PrintOff()
EndDo
ResTela( cScreen )
return



Function AchaEmis( dEmis )

LOCAL cScreen    := SaveScreen()
LOCAL lRetorno := .T.

Recemov->(Order( 6 ))
if Recemov->(!DbSeek( dEmis ))
    if Conf("Erro: Data Invalida. Localizar Proxima ?")
        Mensagem(SISTEM_NA1 + ";-;Aguarde, Localizando Proxima Emissao.")
        dEmis ++
        While Recemov->(!DbSeek( dEmis ))
            dEmis ++
            Recemov->(DbSkip(1))
        EndDo
    else
        lRetorno := .F.
    endif
endif
ResTela( cScreen )
return( lRetorno )

Function AchaVcto( dVcto )

LOCAL cScreen    := SaveScreen()
LOCAL lRetorno := .T.

Recemov->(Order( 3 ))
if Recemov->(!DbSeek( dVcto ))
    if Conf("Erro: Data Invalida. Localizar Proxima ?")
        Mensagem(SISTEM_NA1 + ";-;Aguarde, Localizando Proximo Vcto.")
        dVcto ++
        While Recemov->(!DbSeek( dVcto ))
            dVcto ++
            Recemov->(DbSkip(1))
        EndDo
    else
        lRetorno := .F.
    endif
endif
ResTela( cScreen )
return( lRetorno )



Function Calcula( nVlr, nVlrDolar, dEmis, dVcto )

LOCAL nCotacao := 0
LOCAL nRetorno := 0
if dEmis >= dVcto
    if dEmis >= Date()
        return( nVlr )
    else
        if Taxas->(DbSeek( Date()))
            nCotacao := Taxas->Cotacao
        endif
    endif
else
    if dVcto >= Date()
        return( nVlr )
    else
        if Taxas->(DbSeek( Date()))
            nCotacao := Taxas->Cotacao
        endif
    endif
endif
nRetorno := ( nVlrDolar * nCotacao )
return( if( nRetorno <= 0, nVlr, nRetorno ))



Proc cCabec( Titulo, Tam )

STATIC Pagina := 0
LOCAL nDiv      := Tam / 2

Write( 00, 000, Padr( "Pagina N?" + StrZero(++Pagina,5), nDiv ) + Padl(Time(), nDiv ))
Write( 01, 001, Dtoc( Date() ))
Write( 02, 000, Padc( ltrim(rtrim(oAmbiente:xNomefir)), Tam ))
Write( 03, 000, Padc( SISTEM_NA3  , Tam ))
Write( 04, 000, Padc( Titulo , Tam ))
Write( 05, 000, Repl( "-" , Tam ) )
Write( 06, 000, "CODI  NOME DO CLIENTE                     TIPO      DOC.N? EMISSAO   VENCTO  VALOR TITULO JR/MES   ATR    JURO/DIA      VALOR+JUROS" )
Write( 07, 000, Repl( "-", Tam ) )
return



Proc Hlp()

LOCAL Tela := SaveScreen()
MaBox( 02 , 09 , 22 , 65, "HELP EDITOR" )
DevPos( 03, 10 ) ; DevOut( "Seta para cima ou Ctrl+E   - Linha para cima" )
DevPos( 04, 10 ) ; DevOut( "Seta para baixo ou Ctrl+X  - Linha para baixo" )
DevPos( 05, 10 ) ; DevOut( "Seta p/esquerda ou Ctrl+S  - Um caractere a esquerda" )
DevPos( 06, 10 ) ; DevOut( "Seta p/direita ou Ctrl+D   - Um caractere a direita" )
DevPos( 07, 10 ) ; DevOut( "Ctrl-Esquerdaa ou Ctrl+A   - Uma palavra a esquerda" )
DevPos( 08, 10 ) ; DevOut( "Ctrl-Direita ou Ctrl+F     - Uma palavra a direita" )
DevPos( 09, 10 ) ; DevOut( "Home                       - Inicio da linha" )
DevPos( 10, 10 ) ; DevOut( "End                        - Fim da linha" )
DevPos( 11, 10 ) ; DevOut( "Ctrl+Home                  - Inicio do Memo" )
DevPos( 12, 10 ) ; DevOut( "Ctrl+End                   - Fim do Memo" )
DevPos( 13, 10 ) ; DevOut( "PgUp                       - Uma Janela para cima" )
DevPos( 14, 10 ) ; DevOut( "PgDn                       - Uma Janela para baixo" )
DevPos( 15, 10 ) ; DevOut( "Ctrl+PgUp                  - Inicio da Janela Corrente" )
DevPos( 16, 10 ) ; DevOut( "Ctrl+PgDn                  - Fim da Janela Corrente" )
DevPos( 17, 10 ) ; DevOut( "Ctrl+Y                     - Apaga a Linha Corrente" )
DevPos( 18, 10 ) ; DevOut( "Ctrl+T                     - Apaga a Palavra a Direita" )
DevPos( 19, 10 ) ; DevOut( "Ctrl+B                     - Reformate memo na Janela" )
DevPos( 20, 10 ) ; DevOut( "Ctrl+W                     - Termina a Edicao e Salva" )
DevPos( 21, 10 ) ; DevOut( "Esc                        - Aborta a Edicao" )
InKey( 0 )
ResTela( Tela )
return



Proc ClientesDbedit()

LOCAL Arq_Ant    := Alias()
LOCAL Ind_Ant    := IndexOrd()
LOCAL cScreen    := SaveScreen()
LOCAL oBrowse    := MsBrowse():New()
SetKey( -8, NIL )

oMenu:Limpa()
dbSelectArea( "Receber" )
Receber->(Order( 1 ))
Receber->(DbGoTop())
oBrowse:Add( "CODIGO",    "Codi")
oBrowse:Add( "NOME",      "Nome")
oBrowse:Add( "CIDADE",    "Cida")
oBrowse:Add( "UF",        "Esta")
oBrowse:Add( "REGIAO",    "Regiao")
oBrowse:Titulo   := "CONSULTA/ALTERACAO DE CLIENTES"
oBrowse:HotKey( -3, {|| oBrowse:DupReg("RECEBER","CODI", 2)})
oBrowse:PreDoGet := {|| PreDoCli( oBrowse ) }
oBrowse:PosDoGet := {|| PosDoCli( oBrowse ) }
oBrowse:PreDoDel := {|| HotPreCli( oBrowse ) }
oBrowse:PosDoDel := NIL
oBrowse:Show()
oBrowse:Processa()
AreaAnt( Arq_Ant, Ind_Ant )
ResTela( cScreen )



Function ProxCodiCli( cCodi )

return( StrZero( Val( cCodi ) + 1, 5))



Function PreDoCli( oBrowse )

LOCAL oCol         := oBrowse:getColumn( oBrowse:colPos )
LOCAL Arq_Ant     := Alias()
LOCAL Ind_Ant     := IndexOrd()

if !PodeAlterar()
    return( .F.)
endif

Do Case
Case oCol:Heading = "CODIGO"
    ErrorBeep()
    Alerta("Opa! Nao pode alterar nao.")
    return( .F. )
OtherWise
EndCase
return( PodeAlterar() )



Function PosDoCli( oBrowse )

LOCAL oCol         := oBrowse:getColumn( oBrowse:colPos )
LOCAL cRegiao     := Space(02)
LOCAL Arq_Ant     := Alias()
LOCAL Ind_Ant     := IndexOrd()

Do Case
Case oCol:Heading = "REGIAO"
    cRegiao := Receber->Regiao
    RegiaoErrada( @cRegiao )
    Receber->Regiao := cRegiao
    AreaAnt( Arq_Ant, Ind_Ant )
OtherWise
EndCase
Receber->Atualizado := Date()
return( .T. )



Function HotPreCli( oBrowse )

LOCAL oCol      := oBrowse:getColumn( oBrowse:colPos )
LOCAL cCodi   := Receber->Codi

Recemov->(Order( 2 ))
if Recemov->(DbSeek( cCodi ))
    ErrorBeep()
    if !Conf("Pergunta: Cliente devendo. Excluir ?")
        return( .F. )
    endif
endif
Recebido->(Order( 4 ))
if Recebido->(DbSeek( cCodi ))
    ErrorBeep()
    if !Conf("Pergunta: Cliente com Movimento. Excluir ?")
        return( .F. )
    endif
endif
return( .T. )



STATIC Proc AbreArea()

LOCAL cScreen := SaveScreen()
ErrorBeep()
Mensagem("Aguarde, Abrindo base de dados.")
FechaTudo()

if !UsaArquivo("RECEBER")
    MensFecha()
    return
endif

if !UsaArquivo("VENDEDOR")
    MensFecha()
    return
endif

if !UsaArquivo("VENDEMOV")
    MensFecha()
    return
endif

if !UsaArquivo("RECEMOV")
    MensFecha()
    return
endif

if !UsaArquivo("NOTA")
    MensFecha()
    return
endif

if !UsaArquivo("RECEBIDO")
    MensFecha()
    return
endif

if !UsaArquivo("REGIAO")
    MensFecha()
    return
endif

if !UsaArquivo("TAXAS")
    MensFecha()
    return
endif

if !UsaArquivo("CHEQUE")
    MensFecha()
    return
endif

if !UsaArquivo("CHEMOV")
    MensFecha()
    return
endif

if !UsaArquivo("CHEPRE")
    MensFecha()
    return
endif

if !UsaArquivo("PAGAMOV")
    MensFecha()
    return
endif

if !UsaArquivo("CEP")
    MensFecha()
    return
endif

if !UsaArquivo("FORMA")
    MensFecha()
    return
endif
if !UsaArquivo("GRUPO")
    MensFecha()
    return
endif
if !UsaArquivo("LISTA")
    MensFecha()
    return
endif
if !UsaArquivo("SAIDAS")
    MensFecha()
    return
endif
if !UsaArquivo("PREVENDA")
    MensFecha()
    return
endif
if !UsaArquivo("RECIBO")
    MensFecha()
    return
endif
if !UsaArquivo("AGENDA")
    MensFecha()
    return
endif
if !UsaArquivo("CM")
    MensFecha()
    return
endif
if !UsaArquivo("LISTA")
    MensFecha()
    return
endif
if !UsaArquivo("SUBGRUPO")
    MensFecha()
    return
endif
if !UsaArquivo("GRUPO")
    MensFecha()
    return
endif
return



Proc CliAlteracao( lDeletar )

LOCAL GetList     := {}
LOCAL cScreen     := SaveScreen()
LOCAL nKey         := SetKey( -8 )
LOCAL nFieldLen := Len( Receber->Codi )

SetKey( -8, NIL )
WHILE .T.
    oMenu:Limpa()
    dbSelectArea( "Receber" )
    Receber->(Order( 2 ))
    MaBox( 14 , 19 , 16 , 34 )
    cCodi := Space(05)
    SetCursor(1) ; DevPos( 15, 20 ) ; DevOut( "Cliente.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodi, "cCodi", "99999", {|| RecErrado( @cCodi )},))
    ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
    if LastKey() = 27
        ResTela( cScreen )
        Exit
    endif
    oMenu:Limpa()
    cCodi     := Receber->Codi
    dData     := Receber->Data
    cNome     := Receber->Nome
    cEnde     := Receber->Ende
    cRg        := Receber->Rg
    cCpf        := Receber->Cpf
    nRenda    := Receber->Media
    cRef1     := Receber->RefCom
    cRef2     := Receber->RefBco
    cImovel    := Receber->Imovel
    cCivil    := Receber->Civil
    cNatural := Receber->Natural
    dNasc     := Receber->Nasc
    cEsposa    := Receber->Esposa
    nDepe     := Receber->Depe
    cPai        := Receber->Pai
    cMae        := Receber->Mae
    cEnde1    := Receber->Ende1
    cFone1    := Receber->Fone1
    cProf     := Receber->Profissao
    cCargo    := Receber->Cargo
    cTraba    := Receber->Trabalho
    cFone2    := Receber->Fone2
    cTempo    := Receber->Tempo
    cVeicul    := Receber->Veiculo
    cConhec    := Receber->Conhecida
    cEnde3    := Receber->Ende3
    cSpc        := Receber->(if( Spc, "S", "N" ))
    cCodi     := Receber->Codi
    cCep        := Receber->Cep
    cCida     := Receber->Cida
    cEsta     := Receber->Esta
    cBair     := Receber->Bair

    lSair := .F.
    if !Receber->(TravaReg())
        Loop
    endif
    WHILE .T.
        MaBox( 00 , 00 , 24 , 79, "ALTERACAO/EXCLUSAO DE CLIENTES" )
        Write( 01, 01, "Codigo.........:                                Data Cadastro..:")
        Write( 02, 01, "Nome...........:")
        Write( 03, 01, "Endereco.......:                                Estado Civil:")
        Write( 04, 01, "Cidade.........:                                Estado......:")
        Write( 05, 01, "Natural........:                                Nascimento..:")
        Write( 06, 01, "Identidade n?.:                                CPF.........:")
        Write( 07, 01, "ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ")
        Write( 08, 01, "Esposo(a)......:                                           Dependentes..:")
        Write( 09, 01, "Pai............:")
        Write( 10, 01, "Mae............:")
        Write( 11, 01, "Endereco.......:                                 Fone.:")
        Write( 12, 01, "ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ")
        Write( 13, 01, "Profissao......:                                 Cargo.:")
        Write( 14, 01, "Trabalho Atual.:                                 Fone..:")
        Write( 15, 01, "Tempo Servico..:                        Renda Mensal...:")
        Write( 16, 01, "ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ")
        Write( 17, 01, "Referencia.....:                                                  Spc...:")
        Write( 18, 01, "Referencia.....:")
        Write( 19, 01, "Bens Imoveis...:")
        Write( 20, 01, "Veiculos.......:")
        Write( 21, 01, "ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ")
        Write( 22, 01, "Pessoa Conhec..:")
        Write( 23, 01, "Endereco.......:")

        SetCursor(1) ; SetPos( 01, 18 ) ; AAdd( GetList, _GET_( cCodi, "cCodi", "99999",,))
        SetCursor(1) ; SetPos( 01, 65 ) ; AAdd( GetList, _GET_( dData, "dData", "##/##/##",,))
        SetCursor(1) ; SetPos( 02, 18 ) ; AAdd( GetList, _GET_( cNome, "cNome", "@!",,))
        SetCursor(1) ; SetPos( 03, 18 ) ; AAdd( GetList, _GET_( cEnde, "cEnde", "@!",,))
        SetCursor(1) ; SetPos( 03, 63 ) ; AAdd( GetList, _GET_( cCivil, "cCivil", "@!",,))
        SetCursor(1) ; SetPos( 04, 18 ) ; AAdd( GetList, _GET_( cCep, "cCep", "#####-###", {|| CepErrado( @cCep, @cCida, @cEsta, @cBair )},))
        SetCursor(1) ; SetPos( 04, 28 ) ; AAdd( GetList, _GET_( cCida, "cCida", "@!S21",,))
        SetCursor(1) ; SetPos( 04, 63 ) ; AAdd( GetList, _GET_( cEsta, "cEsta", "@!",,))
        SetCursor(1) ; SetPos( 05, 18 ) ; AAdd( GetList, _GET_( cNatural, "cNatural", "@!",,))
        SetCursor(1) ; SetPos( 05, 63 ) ; AAdd( GetList, _GET_( dNasc, "dNasc", "##/##/##",,))
        SetCursor(1) ; SetPos( 06, 18 ) ; AAdd( GetList, _GET_( cRg, "cRg", "@!",,))
        SetCursor(1) ; SetPos( 06, 63 ) ; AAdd( GetList, _GET_( cCpf, "cCpf", "999.999.999-99",,))
        SetCursor(1) ; SetPos( 08, 18 ) ; AAdd( GetList, _GET_( cEsposa, "cEsposa", "@!",,))
        SetCursor(1) ; SetPos( 08, 75 ) ; AAdd( GetList, _GET_( nDepe, "nDepe", "99",,))
        SetCursor(1) ; SetPos( 09, 18 ) ; AAdd( GetList, _GET_( cPai, "cPai", "@!",,))
        SetCursor(1) ; SetPos( 10, 18 ) ; AAdd( GetList, _GET_( cMae, "cMae", "@!",,))
        SetCursor(1) ; SetPos( 11, 18 ) ; AAdd( GetList, _GET_( cEnde1, "cEnde1", "@!",,))
        SetCursor(1) ; SetPos( 11, 58 ) ; AAdd( GetList, _GET_( cFone1, "cFone1", "(9999)999-9999",,))
        SetCursor(1) ; SetPos( 13, 18 ) ; AAdd( GetList, _GET_( cProf, "cProf", "@!",,))
        SetCursor(1) ; SetPos( 13, 58 ) ; AAdd( GetList, _GET_( cCargo, "cCargo", "@!",,))
        SetCursor(1) ; SetPos( 14, 18 ) ; AAdd( GetList, _GET_( cTraba, "cTraba", "@!",,))
        SetCursor(1) ; SetPos( 14, 58 ) ; AAdd( GetList, _GET_( cFone2, "cFone2", "(9999)999-9999",,))
        SetCursor(1) ; SetPos( 15, 18 ) ; AAdd( GetList, _GET_( cTempo, "cTempo", "@!",,))
        SetCursor(1) ; SetPos( 15, 58 ) ; AAdd( GetList, _GET_( nRenda, "nRenda", "99999999.99",,))
        SetCursor(1) ; SetPos( 17, 18 ) ; AAdd( GetList, _GET_( cRef1, "cRef1", "@!",,))
        SetCursor(1) ; SetPos( 17, 75 ) ; AAdd( GetList, _GET_( cSpc, "cSpc", "!", {|| cSpc $ "SN"},))
        SetCursor(1) ; SetPos( 18, 18 ) ; AAdd( GetList, _GET_( cRef2, "cRef2", "@!",,))
        SetCursor(1) ; SetPos( 19, 18 ) ; AAdd( GetList, _GET_( cImovel, "cImovel", "@!",,))
        SetCursor(1) ; SetPos( 20, 18 ) ; AAdd( GetList, _GET_( cVeicul, "cVeicul", "@!",,))
        SetCursor(1) ; SetPos( 22, 18 ) ; AAdd( GetList, _GET_( cConhec, "cConhec", "@!",,))
        SetCursor(1) ; SetPos( 23, 18 ) ; AAdd( GetList, _GET_( cEnde3, "cEnde3", "@!",,))
        if lDeletar
            ReadKill( .T. ) ; GetList := {} ; ( GetList )
        else
            ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        endif
        if LastKey() = 27
            Receber->(Libera())
            lSair := .T.
            Exit
        endif
        ErrorBeep()
        if lDeletar
            nOpcao := Alerta(" Pergunta: Voce Deseja ? ", {" Excluir ", " Cancelar ", " Sair "})
        else
            nOpcao := Alerta(" Pergunta: Voce Deseja ? ", {" Alterar ", " Cancelar ", " Sair "})
        endif
        if lDeletar
            if nOpcao = 1
                Receber->(DbDelete())
                Receber->(Libera())
                Exit
            elseif nOpcao = 2
                Receber->(Libera())
                Exit
            endif
        endif
        if nOpcao = 1
            Receber->Codi         := cCodi
            Receber->Data         := dData
            Receber->Nome         := cNome
            Receber->Cep         := cCep
            Receber->Ende         := cEnde
            Receber->Cida         := cCida
            Receber->Esta         := cEsta
            Receber->Rg          := cRg
            Receber->Cpf         := cCpf
            Receber->Media      := nRenda
            Receber->RefCom     := cRef1
            Receber->RefBco     := cRef2
            Receber->Imovel     := cImovel
            Receber->Civil      := cCivil
            Receber->Natural     := cNatural
            Receber->Nasc         := dNasc
            Receber->Esposa     := cEsposa
            Receber->Depe         := nDepe
            Receber->Pai         := cPai
            Receber->Mae         := cMae
            Receber->Ende1      := cEnde1
            Receber->Fone1      := cFone1
            Receber->Profissao := cProf
            Receber->Cargo      := cCargo
            Receber->Trabalho  := cTraba
            Receber->Fone2      := cFone2
            Receber->Tempo      := cTempo
            Receber->Veiculo     := cVeicul
            Receber->Conhecida := cConhec
            Receber->Ende3      := cEnde3
            Receber->Spc         := if( cSpc = "S", .T., .F. )
            Receber->(Libera())
            Exit
        elseif nOpcao = 2
            Loop
        elseif nOpcao = 3
            Receber->(Libera())
            lSair := .T.
            Exit
        endif
    EndDo
    if lSair
        ResTela( cScreen )
        Exit
    endif
EndDo



Proc ReceGrafico()

LOCAL cScreen := SaveScreen()
LOCAL cScreen1
LOCAL nChoice







LOCAL aMenu   := {"Por Cliente                      ",    "Mensal Por Ano Clientes Ativos   ",    "Mensal Por Ano Clientes InAtivos ",    "Mensal Por Ano Todos Clientes    ",    "Ultimos 12 anos Clientes Ativos  ",    "Ultimos 12 anos Clientes InAtivos",    "Ultimos 12 anos todos Clientes   "    }

WHILE .T.
    DbClearFilter()
    DbGoTop()
    M_Title("GRAFICOS DE CONTAS A RECEBER - EM ABERTO" )
    nChoice := FazMenu( 07, 10, aMenu)
    cScreen1 := SaveScreen()
    Do Case
    Case nChoice = 0
        return(ResTela( cScreen))

    Case nChoice = 1
        dbSelectArea( "Receber" )
        Receber->(Order( 2 ))
        cCodi := Space( 05 )
        MaBox( 18, 10, 20, 78 )
        SetCursor(1) ; DevPos( 19, 11 ) ; DevOut( "Cliente...: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodi, "cCodi", "99999", {|| RecErrado( @cCodi,, Row(), Col()+1 )},))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        if LastKey() = 27
            ResTela( cScreen1 )
            Loop
        endif
        GraficoReceberCodigo( cCodi )
        ResTela( cScreen1 )

    Case nChoice > 1
        GraficoReceberGeral(nChoice)
        ResTela( cScreen1 )

    EndCase
EndDo



static function GraficoReceberCodigo(cCodi)

LOCAL cScreen := SaveScreen()
LOCAL nAnual  := 0
LOCAL nBase   := 1
LOCAL aDataIni := {}
LOCAL aDataFim := {}
LOCAL nConta   := 0
LOCAL cValor   := ""
LOCAL aMes[12,2]
LOCAL aValor[12,2]
PRIVA cAno       := Space(02)

MaBox( 21, 10, 23, 45 )
SetCursor(1) ; DevPos( 22, 11 ) ; DevOut( "Entre o ano para Grafico...:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cAno, "cAno", "99", {|| if(Empty(cAno), ( ErrorBeep(), Alerta("Ooops!: Entre com o ano!", nil , 31), .F. ), .T. )},))
ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
if LastKey() = 27
    return(Restela( cScreen))
endif

oMenu:Limpa()
aDataIni := aMesIniMesFim(cAno)[1]
aDataFim := aMesIniMesFim(cAno)[2]

dbSelectArea( "Recemov" )
Recemov->(Order( 2 ))
Recemov->(OrdScope( 0, cCodi))
Recemov->(OrdScope( 1, cCodi))
Recemov->(DbGoTop())
Mensagem(" Aguarde, Calculando Valores.")
For nX := 1 To 12
    ContaReg()
   aMes[nX,1] := 0
    aValor[nX,1] := 0 ; dbEval( {|| aValor[nX,1] := aValor[nX,1] + Recemov->Vlr }, {|| Recemov->Vcto >= aDataIni[nX] .AND. Recemov->Vcto <= aDataFim[nX] .AND. Empty(Recemov->DataPag)},,,, .F. )
    aMes[nX,1] += aValor[nX,1]
   nAnual     += aValor[nX,1]
Next
Recemov->(OrdScope( 0))
Recemov->(OrdScope( 1))
Recemov->(DbGoTop())

aMes   := aMesIniMesFim(cAno, aValor)[3]
cNome  := Receber->( ltrim(rtrim(Nome)) )
cValor := "R$" + ltrim(rtrim(Tran( nAnual, "@E 9,999,999,999.99")))

SetColor("")
Scroll() ; SetPos( 0, 0 )
Grafico( aMes,.T.,"EVOLUCAO MENSAL DE TITULOS A RECEBER - &cNome.", cValor, ltrim(rtrim(oAmbiente:xNomefir)), nBase )
Inkey(0)
return(ResTela(cScreen))

static function GraficoReceberGeral(nChoice)

LOCAL cScreen  := SaveScreen()
LOCAL nAnual   := 0
LOCAL nBase    := 1
LOCAL aDataIni := {}
LOCAL aDataFim := {}
LOCAL nConta   := 0
LOCAL nX       := 0
LOCAL dIni     AS DATE
LOCAL dFim     AS DATE
LOCAL cValor   AS STRING
LOCAL aMes[12,2]
LOCAL aValor[12,2]
PRIVA cAno       := Tran(Year(Date()), "9999")

MaBox( 18, 10, 20, 58 )
SetCursor(1) ; DevPos( 19, 11 ) ; DevOut( "Entre com o ultimo ano para Grafico...:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cAno, "cAno", "9999", {|| if(Empty(cAno), ( ErrorBeep(), Alerta("Ooops!: Entre com o ano!", nil , 31), .F. ), .T. )},))
ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
if LastKey() = 27
    return(Restela(cScreen))
endif
if nChoice > 1 .AND. nChoice < 4
    aDataIni := aMesIniMesFim(cAno)[1]
    aDataFim := aMesIniMesFim(cAno)[2]
else
    aDataIni := aAnoIniAnoFim(cAno)[1]
    aDataFim := aAnoIniAnoFim(cAno)[2]
endif

Receber->(Order( 2 ))
Recibo->(Order( 3 ))
dbSelectArea( "Recemov" )
Recemov->(Order( 3 ))
Mensagem("Aguarde, calculando valores.")

For nX := 1 To 12
    ContaReg()
    aMes[nX,1]   := 0
    aValor[nX,1] := 0
    dIni           := aDataIni[nX]
    dFim           := aDataFim[nX]
    Recemov->(OrdScope( 0, dIni))
    Recemov->(OrdScope( 1, dFim))
    Recemov->(DbGoTop())
    While Recemov->(!Eof())
        if Receber->(DbSeek( Recemov->Codi ))
            if nChoice == 2 .OR. nChoice == 5
                if !Receber->Suporte
                    Recemov->(DbSkip(1))
                    Loop
                endif
            elseif nChoice == 3 .OR. nChoice == 6
                if Receber->Suporte
                    Recemov->(DbSkip(1))
                    Loop
                endif
            endif
        endif
        if Recibo->(!DbSeek( Recemov->Docnr ))
            aValor[nX,1] += Recemov->Vlr
        endif
        Recemov->(DbSkip(1))
    EndDo
    Recemov->(OrdScope( 0))
    Recemov->(OrdScope( 1))
    Recemov->(DbGoTop())
    aMes[nX,1] += aValor[nX,1]
   nAnual     += aValor[nX,1]
Next

if nChoice > 1 .AND. nChoice < 4
    aMes   := aMesIniMesFim(cAno, aValor)[3]
else
    aMes   := aAnoIniAnoFim(cAno, aValor)[3]
endif
cValor := "R$" + ltrim(rtrim(Tran( nAnual, "@E 9,999,999,999.99")))

SetColor("")
Scroll() ; SetPos( 0, 0 )
Grafico( aMes, .T., "EVOLUCAO MENSAL DE TITULOS A RECEBER - &cAno.", cValor, ltrim(rtrim(oAmbiente:xNomefir)), nBase)
Inkey(0)
return(ResTela(cScreen))



Proc FechtoMes()

LOCAL cScreen := SaveScreen()
LOCAL nChoice
LOCAL oBloco
LOCAL nJuro
LOCAL cPort
LOCAL nPorc
LOCAL nJdia
LOCAL dEmis
LOCAL dVcto
LOCAL nValor
LOCAL nCotacao

ErrorBeep()
Alert("ATENCAO!!;Procure conhecer esta opcao junto;ao Depto. de Suporte antes de usa-la.")

WHILE .T.
    M_Title("ENTRADAS POR FORNECEDOR")
    nChoice := FazMenu( 05, 20, { "Individual", "Todos" })
    if nChoice = 0
        ResTela( cScreen )
        Exit

    elseif nChoice = 1
        dbSelectArea( "Receber" )
        Receber->( Order( 2 ))
        Receber->(DbGoTop())
        cCodi := Space( 05)
        dIni    := Date()-30
        dFim    := Date()
        MaBox( 11, 20, 15, 45 )
        SetCursor(1) ; DevPos( 12, 21 ) ; DevOut( "Cliente.....:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodi, "cCodi", "99999", {|| RecErrado( @cCodi )},))
        SetCursor(1) ; DevPos( 13, 21 ) ; DevOut( "Emis Inicial:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dIni, "dIni", "##/##/##",,))
        SetCursor(1) ; DevPos( 14, 21 ) ; DevOut( "Emis Final..:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dFim, "dFim", "##/##/##",,))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        if LastKey( ) = 27
            ResTela( cScreen )
            Loop
        endif
        oCondicao := {|| Receber->Codi = cCodi }

    elseif nChoice = 2
        dbSelectArea( "Receber" )
        Receber->(Order( 2 ))
        Receber->(DbGoTop())
        cCodi      := Space(05)
        oCondicao := {|| cProx( @cCodi ) }
        dIni         := Date()-30
        dFim         := Date()
        MaBox( 12, 20, 15, 45 )
        SetCursor(1) ; DevPos( 13, 21 ) ; DevOut( "Emissao Ini ¯" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dIni, "dIni", "##/##/##",,))
        SetCursor(1) ; DevPos( 14, 21 ) ; DevOut( "Emissao Fim ¯" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dFim, "dFim", "##/##/##",,))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        if LastKey() = 27
            ResTela( cScreen )
            Loop
        endif
    endif
    MaBox( 16, 20, 19, 55 )
    dEmis     := Date()
    dVcto     := Date()+30
    nCotacao := 0
    MaBox( 16, 20, 19, 57 )
    SetCursor(1) ; DevPos( 17, 21 ) ; DevOut( "Emissao do Fechamento..:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dEmis, "dEmis", "##/##/##",,))
    SetCursor(1) ; DevPos( 18, 21 ) ; DevOut( "Vencto  do Fechamento..:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dVcto, "dVcto", "##/##/##", {|| dVcto >= dEmis},))
    ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
    if LastKey() = 27
        ResTela( cScreen )
        Loop
    endif
    lTitulo := Conf("Pergunta: Refazer fechamento no Futuro ?")
    While Eval( oCondicao )
        if nChoice = 1
            oCondicao := {|| .F. }
        endif
        dbSelectArea( "Recemov" )
        Recemov->(Order( 2 ))
        if Recemov->(!Dbseek( cCodi ))
            if nChoice = 1
                ErrorBeep()
                oMenu:Limpa()
                Alerta("Erro: Sem registros a processar deste cliente...")
            endif
            Loop
        endif
        if Recemov->(!TravaArq())
            Loop
        endif
        nJuro         := Recemov->Juro
        cPort         := Recemov->Port
        nPorc         := Recemov->Porc
        cTipo         := Recemov->Tipo
        oBloco        := {|| Recemov->Codi = cCodi }
        cTela         := Mensagem("Aguarde... Verificando e Ordenando Movimento.")
        nValor        := 0
        WHILE Eval( oBloco )
            if Recemov->Titulo .OR. Recemov->Emis < dIni .OR. Recemov->Emis > dFim
                Recemov->(DbSkip(1))
                Loop
            endif
            nValor += Recemov->Vlr
            Recemov->(DbDelete())
            Recemov->(DbSkip(1))
        EndDo
        if nValor <> 0
            cDocnr := Right( cCodi,3) + StrTran( Time(), ":")
            Recemov->(DbAppend())
            Recemov->Codi      := cCodi
            Recemov->Jurodia := JuroDia( nValor, nJuro )
            Recemov->Juro      := nJuro
            Recemov->Port      := cPort
            Recemov->Porc      := nPorc
            Recemov->Emis      := dEmis
            Recemov->Vcto      := dVcto
            Recemov->Docnr   := cDocnr
            Recemov->Fatura  := cDocnr
            Recemov->Tipo      := cTipo
            Recemov->Titulo  := if( lTitulo, .F., .T. )
            Recemov->Vlr      := nValor
            Recemov->Regiao  := Receber->Regiao
            Recemov->(Libera())
            nValor              := 0
        else
            if nChoice = 1
                Recemov->(Libera())
                ErrorBeep()
                oMenu:Limpa()
                Alerta("Erro: Sem registros a processar deste cliente...")
            endif
        endif
    EndDo
    Recemov->(Libera())
    Restela( cScreen )
EndDo



Function cProx( cCodi )

Receber->(DbSkip())
cCodi := Receber->Codi
return( Receber->(!Eof()))



Proc EtiquetasClientes()

LOCAL cScreen         := SaveScreen()
LOCAL aMenu          := { " Individual ", " Por Aniversario ", " Ultima Compra", " Geral Ordem Codigo ", " Geral Ordem Nome ", " Configurar Etiquetas " }
LOCAL cCodi          := Space(04)
LOCAL cTemp          := FTempName("*.TMP")
LOCAL nChoice         := 1
LOCAL nEtiquetas     := 1
LOCAL aConfig         := {}
LOCAL nRecno         := 0
LOCAL nCampos         := 5
LOCAL nTamanho      := 35
LOCAL nMargem         := 0
LOCAL nLinhas         := 1
LOCAL nEspacos      := 1
LOCAL nCarreira     := 1
LOCAL nX              := 0
LOCAL aArray         := {}
LOCAL aGets          := {}
LOCAL lComprimir     := .F.
LOCAL lSpVert         := .F.
LOCAL nAniversario := 5
LOCAL nDias          := 0
LOCAL cDebitos      := "N"
LOCAL oBloco

WHILE .T.
     M_Title("IMPRESSAO DE ETIQUETAS CLIENTES" )
     nChoice := FazMenu( 03, 10, aMenu, Cor())
     Do Case
     Case nChoice = 0
         ResTela( cScreen )
         Exit

     Case nChoice = 1
         WHILE .T.
             dbSelectArea( "Receber" )
             Receber->(Order( 2 ))
             cCodi         := Space(05)
             nEtiquetas  := 1
             cArquivo     := Space(11)
             MaBox( 16 , 10 , 19 , 78 )
             SetCursor(1) ; DevPos( 17, 11 ) ; DevOut( "Cliente....:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodi, "cCodi", "99999", {|| RecErrado( @cCodi,, Row(), Col() + 5 )},))
             SetCursor(1) ; DevPos( 18, 11 ) ; DevOut( "Quantidade.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nEtiquetas, "nEtiquetas", "9999", {|| nEtiquetas > 0},))
             ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
             if LastKey( ) = 27
                 ResTela( cScreen )
                 Exit
             endif
             aConfig := LerEtiqueta()
             if !InsTru80() .OR. !LptOk()
                 ResTela( cScreen )
                 return
             endif
             nLen := Len( aConfig )
             if nLen > 0
                 nCampos     := aConfig[1]
                 nTamanho    := aConfig[2]
                 nMargem     := aConfig[3]
                 nLinhas     := aConfig[4]
                 nEspacos    := aConfig[5]
                 nCarreira    := aConfig[6]
                 lComprimir := aConfig[7] == 1
                 lSpVert     := aConfig[8] == 1
                 For nX := 9 To nLen
                     Aadd( aGets, aConfig[nX] )
                 Next
             endif
             aLinha := Array( aConfig[1] )
             Afill( aLinha, "" )
             PrintOn()
             FPrint( _SALTOOFF )
             if lComprimir
                 FPrint( PQ )
             endif
             if lSpVert
                 Fprint( _SPACO1_8 )
             endif
             SetPrc( 0, 0 )
             nConta := 0
             nCol         := nMargem
             For nY := 1 To nEtiquetas
                 nConta++
                 For nB := 1 To nCampos
                     cVar := aGets[nB]
                     nTam := Len( &cVar. )
                     aLinha[nB] += &cVar. + if( nConta = nCarreira, "", Space( ( nTamanho - nTam ) + nEspacos ))
                 Next
                 if nConta = nCarreira
                     nConta := 0
                     For nC := 1 To nCampos

                         Qout( Space( nMargem) + aLinha[nC] )
                         aLinha[nC] := ""
                     Next
                     For nD := 1 To nLinhas
                         Qout()
                     Next
                 endif
             next
             if nConta >0
                 For nC := 1 To nCampos
                     Qout( Space( nMargem) + aLinha[nC] )
                     aLinha[nC] := ""
                 Next
                 For nD := 1 To nLinhas
                     Qout()
                 Next
             endif
             PrintOFF()
             ResTela( cScreen )
         EndDo

     Case nChoice = 2
         if !Selecao( nAniversario, @oBloco )
             ResTela( cScreen )
             Loop
         endif
         aConfig := LerEtiqueta()
         if !InsTru80() .OR. !LptOk()
             xAlias->(DbCloseArea())
             ResTela( cScreen )
             return
         endif
         nLen := Len( aConfig )
         if nLen > 0
             nCampos     := aConfig[1]
             nTamanho    := aConfig[2]
             nMargem     := aConfig[3]
             nLinhas     := aConfig[4]
             nEspacos    := aConfig[5]
             nCarreira    := aConfig[6]
             lComprimir := aConfig[7] == 1
             lSpVert     := aConfig[8] == 1
             For nX := 9 To nLen
                 Aadd( aGets, aConfig[nX] )
             Next
         endif
         aLinha := Array( aConfig[1] )
         Afill( aLinha, "" )
         PrintOn()
         FPrint( _SALTOOFF )
         if lComprimir
             FPrint( PQ )
         endif
         if lSpVert
             Fprint( _SPACO1_8 )
         endif
         SetPrc( 0, 0 )
         nConta        := 0
         nEtiquetas := 1
         nCol         := nMargem
         WHILE xAlias->(!Eof()) .AND. Rep_Ok()
             For nY := 1 To nEtiquetas
                 nConta++
                 For nB := 1 To nCampos
                     cVar := aGets[nB]
                     nTam := Len( &cVar. )
                     aLinha[nB] += &cVar. + if( nConta = nCarreira, "", Space( ( nTamanho - nTam ) + nEspacos ))
                 Next
                 if nConta = nCarreira
                     nConta := 0
                     For nC := 1 To nCampos

                         Qout( Space( nMargem) + aLinha[nC] )
                         aLinha[nC] := ""
                     Next
                     For nD := 1 To nLinhas
                         Qout()
                     Next
                 endif
             next
             DbSkip(1)
         EndDo
         if nConta >0
             For nC := 1 To nCampos
                 Qout( Space( nMargem) + aLinha[nC] )
                 aLinha[nC] := ""
             Next
             For nD := 1 To nLinhas
                 Qout()
             Next
         endif
         xAlias->(DbCloseArea())
         PrintOFF()
         ResTela( cScreen )

     Case nChoice = 3
         oMenu:Limpa()
         MaBox( 10, 10, 13, 45 )
         SetCursor(1) ; DevPos( 11, 11 ) ; DevOut( "Dias da Ultima Compra........:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nDias, "nDias", "999",,))
         SetCursor(1) ; DevPos( 12, 11 ) ; DevOut( "Imprimir Carta se tem debitos:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cDebitos, "cDebitos", "!", {|| cDebitos $ "SN"},))
         ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
         if LastKey() = 27
             ResTela( cScreen )
             Loop
         endif
         dbSelectArea( "Receber" )
         Receber->(Order( 2 ))
         Receber->(DbGoTop())
         cUltCodigo  := Codi
         aConfig      := LerEtiqueta()
         if !InsTru80() .OR. !LptOk()
             ResTela( cScreen )
             Loop
         endif
         nLen := Len( aConfig )
         if nLen > 0
             nCampos     := aConfig[1]
             nTamanho    := aConfig[2]
             nMargem     := aConfig[3]
             nLinhas     := aConfig[4]
             nEspacos    := aConfig[5]
             nCarreira    := aConfig[6]
             lComprimir := aConfig[7] == 1
             lSpVert     := aConfig[8] == 1
             For nX := 9 To nLen
                 Aadd( aGets, aConfig[nX] )
             Next
         endif
         aLinha := Array( aConfig[1] )
         Afill( aLinha, "" )
         PrintOn()
         FPrint( _SALTOOFF )
         if lComprimir
             FPrint( PQ )
         endif
         if lSpVert
             Fprint( _SPACO1_8 )
         endif
         SetPrc( 0, 0 )
         nConta        := 0
         nEtiquetas := 1
         nCol         := nMargem
         oMenu:Limpa()
         cTela    := Mensagem("Aguarde, Imprimindo. ")
         Recemov->(Order( 2 ))
         WHILE !Eof() .AND. Rep_Ok()
             if ( Date() - UltCompra ) >= nDias
                 if cDebitos = "N"
                     if Recemov->(DbSeek( cUltCodigo ))
                         cUltCodi := Codi
                         DbSkip(1)
                         Loop
                     endif
                 endif
             else
                 cUltCodi := Codi
                 DbSkip(1)
                 Loop
             endif
             For nY := 1 To nEtiquetas
                 nConta++
                 For nB := 1 To nCampos
                     cVar := aGets[nB]
                     nTam := Len( &cVar. )
                     aLinha[nB] += &cVar. + if( nConta = nCarreira, "", Space( ( nTamanho - nTam ) + nEspacos ))
                 Next
                 if nConta = nCarreira
                     nConta := 0
                     For nC := 1 To nCampos
                         Qout( Space( nMargem) + aLinha[nC] )
                         aLinha[nC] := ""
                     Next
                     For nD := 1 To nLinhas
                         Qout()
                     Next
                 endif
             next
             cUltCodi := Codi
             DbSkip(1)
         EndDo
         if nConta >0
             For nC := 1 To nCampos

                 Qout( Space( nMargem) + aLinha[nC] )
                 aLinha[nC] := ""
             Next
             For nD := 1 To nLinhas
                 Qout()
             Next
         endif
         PrintOFF()
         ResTela( cScreen )

     Case nChoice = 4 .OR. nChoice = 5
         dbSelectArea( "Receber" )
         if nChoice = 2
             Receber->(Order( 2 ))
         else
             Receber->(Order( 1 ))
         endif
         Receber->(DbGoTop())
         aConfig := LerEtiqueta()
         if !InsTru80() .OR. !LptOk()
             ResTela( cScreen )
             Loop
         endif
         nLen := Len( aConfig )
         if nLen > 0
             nCampos     := aConfig[1]
             nTamanho    := aConfig[2]
             nMargem     := aConfig[3]
             nLinhas     := aConfig[4]
             nEspacos    := aConfig[5]
             nCarreira    := aConfig[6]
             lComprimir := aConfig[7] == 1
             lSpVert     := aConfig[8] == 1
             For nX := 9 To nLen
                 Aadd( aGets, aConfig[nX] )
             Next
         endif
         aLinha := Array( aConfig[1] )
         Afill( aLinha, "" )
         PrintOn()
         FPrint( _SALTOOFF )
         if lComprimir
             FPrint( PQ )
         endif
         if lSpVert
             Fprint( _SPACO1_8 )
         endif
         SetPrc( 0, 0 )
         nConta        := 0
         nEtiquetas := 1
         nCol         := nMargem
         WHILE !Eof() .AND. Rep_Ok()
             For nY := 1 To nEtiquetas
                 nConta++
                 For nB := 1 To nCampos
                     cVar := aGets[nB]
                     nTam := Len( &cVar. )
                     aLinha[nB] += &cVar. + if( nConta = nCarreira, "", Space( ( nTamanho - nTam ) + nEspacos ))
                 Next
                 if nConta = nCarreira
                     nConta := 0
                     For nC := 1 To nCampos

                         Qout( Space( nMargem) + aLinha[nC] )
                         aLinha[nC] := ""
                     Next
                     For nD := 1 To nLinhas
                         Qout()
                     Next
                 endif
             next
             DbSkip(1)
         EndDo
         if nConta >0
             For nC := 1 To nCampos
                 Qout( Space( nMargem) + aLinha[nC] )
                 aLinha[nC] := ""
             Next
             For nD := 1 To nLinhas
                 Qout()
             Next
         endif
         PrintOFF()
         ResTela( cScreen )

     Case nChoice = 6
         ConfigurarEtiqueta()
         ResTela( cScreen )

     EndCase
EndDo




Proc RelReceber()

LOCAL cScreen     := SaveScreen()
LOCAL AtPrompt  := {"Por Data de Vencimento","Por Data de Emissao","Relatorio de Cobranca","Relatorio de Cobranca Seletiva","Totalizado","Por Vendedor","Fluxo Sintetico","Rol Percentual Pagar/Pago"}
LOCAL cCodiVen  := Space(04)
LOCAL dIni         := Date()-30
LOCAL dFim         := Date()
LOCAL nChoice

WHILE .T.
    oMenu:Limpa()
    M_Title( "ROL DE TITULOS A RECEBER")
    nChoice := FazMenu( 01 , 18,    AtPrompt, Cor() )
    Do Case
    Case nChoice = 0
        ResTela( cScreen )
        Exit
    Case nChoice = 1 .OR. nChoice = 2
        RelRecDual( nChoice, NIL, atPrompt[nChoice])
    Case nChoice = 3
        RelRecCobranca()
    Case nChoice = 4
        RelRecSeletiva()
    Case nChoice = 5
        RelRecTotalizado()
    Case nChoice = 6
        MaBox( 12 , 18 , 14, 77 )
        SetCursor(1) ; DevPos( 13, 19 ) ; DevOut( "Vendedor:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodiVen, "cCodiVen", "9999", {|| FunErrado( @cCodiVen,, Row(), Col()+1 )},))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        if LastKey() = 27
            Loop
        endif
        RelRecDual( nChoice, cCodiVen, atPrompt[nChoice])
    Case nChoice = 7
        Fluxo()
    Case nChoice = 8
        RolPagarPago()
    EndCase
EndDo



Proc RelRecDual( nVctoOuEmis, cCodiVen, cTitle )

LOCAL cScreen     := SaveScreen()
LOCAL AtPrompt  := { "Por Periodo","Individual", "Por Regiao", "Por Tipo", "Por Portador", "Ordem Alfabetica", "Por Cidade", "Por Grupo de Produtos"}
LOCAL aOrDual     := { "Nome","Codigo", "Cidade", "Regiao", "Estado","Fantasia", "Endereco" }
LOCAL cRegiao     := NIL
LOCAL cTipo      := NIL
LOCAL cPortador := NIL
LOCAL cCida      := NIL
LOCAL cGrupo     := NIL
LOCAL cTitulo
LOCAL nChoice
LOCAL nOrDual

WHILE .T.
    M_Title( ltrim(rtrim(Upper( cTitle ))))
    nChoice := FazMenu( 03 , 20,    AtPrompt, Cor() )
    Do Case
    Case nChoice = 0
        ResTela( cScreen )
        Exit

    Case nChoice = 1
        dbSelectArea( "ReceMov" )
        Recemov->(Order( 2 ))
        Recemov->(DbGoTop())
        M_Title("ORDEM A IMPRIMIR")
        nOrDual := FazMenu( 05 , 22, aOrDual )
        if nOrDual = 0
            ResTela( cScreen )
            Exit
        endif
        Receber->( Order( nOrDual ))
        Receber->(DbGoTop())
        oBloco := {|| Receber->(!Eof()) }
        cTitulo := "ROL GERAL DE TITULOS A RECEBER NO PERIODO DE "
        RolPorPeriodo( cTitulo, oBloco, cRegiao, cTipo, cPortador, nVctoOuEmis, nChoice, cCodiVen )

    Case nChoice = 2
        WHILE .T.
            dbSelectArea( "ReceMov" )
            Recemov->(Order( 2 ))
            Recemov->(DbGoTop())
            cCodi := Space(05)
            MaBox( 15 , 20 , 17 , 36 )
            SetCursor(1) ; DevPos( 16, 21 ) ; DevOut( "Cliente.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodi, "cCodi", "99999", {|| RecErrado( @cCodi )},))
            ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
            if LastKey() = 27
                ResTela( cScreen )
                Exit
            endif
            Receber->( Order( 1 ))
            oBloco := {|| Receber->Codi = cCodi }
            cTitulo := "ROL INDIVIDUAL DE TITULOS A RECEBER NO PERIODO DE "
            RolPorPeriodo( cTitulo, oBloco, cRegiao, cTipo, cPortador, nVctoOuEmis, nChoice, cCodiVen )
        EndDo

    Case nChoice = 3
        WHILE .T.
            dbSelectArea( "ReceMov" )
            Recemov->(Order( 2 ))
            Recemov->(DbGoTop())
            cRegiao := Space( 02 )
            MaBox( 15 , 20 , 17 , 36 )
            SetCursor(1) ; DevPos( 16, 21 ) ; DevOut( "Regiao..:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cRegiao, "cRegiao", "99", {|| RegiaoErrada( @cRegiao )},))
            ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
            if LastKey() = 27
                ResTela( cScreen )
                Exit
            endif
            Receber->( Order( 1 ))
            Receber->(DbGoTop())
            oBloco  := {|| Receber->(!Eof()) }
            cTitulo := "ROL GERAL TITULOS A RECEBER DA REGIAO " + cRegiao + " NO PERIODO DE "
            RolPorPeriodo( cTitulo, oBloco, cRegiao, cTipo, cPortador, nVctoOuEmis, nChoice, cCodiVen )
        EndDo

    Case nChoice = 4
        WHILE .T.
            dbSelectArea( "ReceMov" )
            Recemov->(Order( 2 ))
            Recemov->(DbGoTop())
            cTipo := Space( 06 )
            MaBox( 15 , 20 , 17 , 36 )
            SetCursor(1) ; DevPos( 16, 21 ) ; DevOut( "Tipo :" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cTipo, "cTipo", "@!", {|| !Empty( cTipo )},))
            ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
            if LastKey() = 27
                ResTela( cScreen )
                Exit
            endif
            dbSelectArea( "Recemov" )
            Recemov->(Order( 8 ))
            if Recemov->(!DbSeek( cTipo ))
                Alerta("Erro: Tipo nao Localizado.")
                Loop
            endif
            Receber->( Order( 2 ))
            if ( ! .F. ) ; dbClearRelation() ; end ; dbSetRelation( "Receber", {|| Recemov->Codi}, "Recemov->Codi", .F. )
            oBloco := {|| Recemov->Tipo = cTipo }
            cTitulo := "ROL GERAL TITULOS A RECEBER POR TIPO " + cTipo + " NO PERIODO DE "
            RolPorPeriodo( cTitulo, oBloco, cRegiao, cTipo, cPortador, nVctoOuEmis, nChoice, cCodiVen )
            Recemov->(DbClearRel())
            Recemov->(DbGoTop())
        EndDo

    Case nChoice = 5
        WHILE .T.
            dbSelectArea( "ReceMov" )
            Recemov->(Order( 2 ))
            Recemov->(DbGoTop())
            cPortador := Space( 10 )
            MaBox( 15 , 20 , 17 , 42 )
            SetCursor(1) ; DevPos( 16, 21 ) ; DevOut( "Portador :" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cPortador, "cPortador", "@!", {|| !Empty( cPortador )},))
            ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
            if LastKey() = 27
                ResTela( cScreen )
                Exit
            endif
            Receber->( Order( 1 ))
            Receber->(DbGoTop())
            oBloco := {|| Receber->(!Eof()) }
            cTitulo := "ROL GERAL TITULOS A RECEBER POR PORTADOR " + cPortador + " NO PERIODO DE "
            RolPorPeriodo( cTitulo, oBloco, cRegiao, cTipo, cPortador, nVctoOuEmis, nChoice, cCodiVen )
        EndDo

    Case nChoice = 6
        PrnAlfabetica( nVctoOuEmis)

    Case nChoice = 7
        WHILE .T.
            cCida := Space(25)
            MaBox( 15 , 20 , 17 , 56 )
            SetCursor(1) ; DevPos( 16, 21 ) ; DevOut( "Cidade..:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCida, "cCida", "@!",,))
            ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
            if LastKey() = 27
                ResTela( cScreen )
                Exit
            endif
            dbSelectArea( "ReceMov" )
            Recemov->(Order( 2 ))
            Receber->( Order( 1 ))
            Receber->(DbGoTop())
            oBloco  := {|| Receber->(!Eof()) }
            cTitulo := "ROL GERAL TITULOS A RECEBER DA CIDADE " + ltrim(rtrim(cCida)) + " NO PERIODO DE "
            RolPorPeriodo( cTitulo, oBloco, cRegiao, cTipo, cPortador, nVctoOuEmis, nChoice, cCodiVen, cCida )
        EndDo

    Case nChoice = 8
        WHILE .T.
            cGrupo := Space(3)
            MaBox( 15 , 20 , 17 , 56 )
            SetCursor(1) ; DevPos( 16, 21 ) ; DevOut( "Grupo...:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cGrupo, "cGrupo", "999", {|| GrupoErrado( @cGrupo )},))
            ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
            if LastKey() = 27
                ResTela( cScreen )
                Exit
            endif
            dbSelectArea( "ReceMov" )
            Recemov->(Order( 2 ))
            Receber->( Order( 1 ))
            Receber->(DbGoTop())
            oBloco  := {|| Receber->(!Eof()) }
            cTitulo := "ROL GERAL TITULOS A RECEBER DO GRUPO " + cGrupo + " NO PERIODO DE "
            RolPorPeriodo( cTitulo, oBloco, cRegiao, cTipo, cPortador, nVctoOuEmis, nChoice, cCodiVen, cCida, cGrupo )
        EndDo

    EndCase
    ResTela( cScreen )
EndDo



Proc RolPorPeriodo( cTitulo, oBloco, cRegiao, cTipo, cPortador, nVctoOuEmis, nChoice, cCodiVen, cCida, cGrupo )

LOCAL cScreen     := SaveScreen()
LOCAL aMenu      := {"Normal", "Resumido", "Totalizado", "Juntado"}
LOCAL nResumo     := 1
LOCAL lJuntado  := .F.
LOCAL dIni
LOCAL dFim
LOCAL dAtual
LOCAL cCodi

dIni      := Date() - 30
dFim      := Date()
dAtual  := Date()
MaBox( 15 , 20 , 19, 50 )
if nVctoOuEmis = 1  .OR. nVctoOuEmis = 5
    SetCursor(1) ; DevPos( 16, 21 ) ; DevOut( "Data Vcto Inicial..:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dIni, "dIni", "##/##/##",,))
    SetCursor(1) ; DevPos( 17, 21 ) ; DevOut( "Data Vcto Final....:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dFim, "dFim", "##/##/##",,))
    SetCursor(1) ; DevPos( 18, 21 ) ; DevOut( "Data Para Calculo..:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dAtual, "dAtual", "##/##/##",,))
else
    SetCursor(1) ; DevPos( 16, 21 ) ; DevOut( "Data Emis Inicial..:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dIni, "dIni", "##/##/##",,))
    SetCursor(1) ; DevPos( 17, 21 ) ; DevOut( "Data Emis Final....:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dFim, "dFim", "##/##/##",,))
    SetCursor(1) ; DevPos( 18, 21 ) ; DevOut( "Data Para Calculo..:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dAtual, "dAtual", "##/##/##",,))
endif
ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
if LastKey() = 27
    ResTela( cScreen )
    return
endif
M_Title("TIPO REL")
nResumo := FazMenu( 15 , 51 , aMenu, Cor())
if nResumo = 0
    ResTela( cScreen )
    return
endif
if nResumo = 4
    nResumo = 1
    lJuntado := .T.
endif
cTitulo += Dtoc( dIni ) + " A " + Dtoc( dFim )
if nChoice = 4
    RolPorTipo( cTitulo, dIni, dFim, dAtual, oBloco, cRegiao, cTipo, cPortador, nVctoOuEmis, nResumo, cCodiVen )
else
    Prn002( cTitulo, dIni, dFim, dAtual, oBloco, cRegiao, cTipo, cPortador, nVctoOuEmis, nResumo, cCodiVen, cCida, cGrupo, lJuntado )
endif
ResTela( cScreen )
return



Proc Prn002( cTitulo, dIni, dFim, dAtual, oBloco, cRegiao, cTipo, cPortador, nVctoOuEmis, nResumo, cCodiVen, cCida, cGrupo, lJuntado )

LOCAL cScreen      := SaveScreen()
LOCAL lSair       := .F.
LOCAL Lista       := SISTEM_NA3
LOCAL Tam          := 132
LOCAL Col          := 58
LOCAL Pagina      := 0
LOCAL NovoCodi   := .T.
LOCAL lSub          := .F.
LOCAL UltCodi      := Recemov->Codi
LOCAL GrandTotal := 0
LOCAL GrandJuros := 0
LOCAL GrandGeral := 0
LOCAL Atraso      := 0
LOCAL Juros       := 0
LOCAL TotalCli   := 0
LOCAL TotalJur   := 0
LOCAL TotalGer   := 0
LOCAL nJrVlr      := 0
LOCAL nJuros      := 0
LOCAL nJdia       := 0
LOCAL nAtraso      := 0
LOCAL nJuro       := 0
LOCAL nValor      := 0
LOCAL nDesconto  := 0
LOCAL nMulta      := 0
LOCAL nDocumento := 0
LOCAL cTela
LOCAL dEmis
LOCAL dVcto
LOCAL NovoNome
LOCAL UltNome
LOCAL lMarcado

ErrorBeep()
lMarcado := Conf("Pergunta: Incluir no relatorio os marcados ?")
if !InsTru80() .OR. !LptOk()
    ResTela( cScreen )
    return
endif
cTela     := Mensagem("Aguarde, imprimindo.")
PrintOn()
FPrint(PQ)
SetPrc( 0 , 0 )
WHILE Eval( oBloco )
    cCodiReceber := Receber->Codi
    if !lMarcado
        if Receber->Rol = .T.
            Receber->(DbSkip(1))
            Loop
        endif
    endif
    if cCida <> NIL
        if Receber->Cida <> cCida
            Receber->(DbSkip(1))
            Loop
        endif
    endif
    if cRegiao <> NIL
        if Receber->Regiao <> cRegiao
            Receber->(DbSkip(1))
            Loop
        endif
    endif
    if Recemov->(!DbSeek( cCodiReceber ))
        Receber->(DbSkip(1))
        Loop
    endif
    NovoCodi := .T.
    WHILE Recemov->Codi = cCodiReceber .AND. Recemov->(!Eof()) .AND. Rel_Ok()
        if cGrupo <> NIL
            if Recemov->CodGrupo <> cGrupo
                Recemov->(DbSkip(1))
                Loop
            endif
        endif
        if cCodiVen <> NIL
            if Recemov->CodiVen <> cCodiVen
                Recemov->(DbSkip(1))
                Loop
            endif
        endif
        if cTipo <> NIL
            if Recemov->Tipo <> cTipo
                Recemov->(DbSkip(1))
                Loop
            endif
        endif
        if cPortador <> NIL
            if Recemov->Port <> cPortador
                Recemov->(DbSkip(1))
                Loop
            endif
        endif
        if dIni <> NIL
            if nVctoOuEmis = 1 .OR. nVctoOuEmis = 5
                if Recemov->Vcto < dIni .OR. Recemov->Vcto > dFim
                    Recemov->(DbSkip(1))
                    Loop
                endif
            else
                if Recemov->Emis < dIni .OR. Recemov->Emis > dFim
                    Recemov->(DbSkip(1))
                    Loop
                endif
            endif
        endif
        dData      := if( dAtual = Nil, Date(), dAtual )
        Atraso     := Atraso( dData, Recemov->Vcto )
        nCarencia := Carencia( dData, Recemov->Vcto )
        nMulta     := VlrMulta( dData, Recemov->Vcto, Recemov->Vlr )
        nDesconto := VlrDesconto( dData, Recemov->Vcto, Recemov->Vlr )
        if Atraso <= 0
            Juros := 0
        else
            Juros  := Jurodia * nCarencia
        endif
        if Col >= 57
            Write( 01, 001, "Pagina N?" + StrZero( ++Pagina , 3 ) )
            Write( 01, 117, "Horas "+ Time())
            Write( 02, 001, Dtoc( Date() ))
         Write( 03, 000, Padc( ltrim(rtrim(oAmbiente:xNomefir)), Tam ))
            Write( 04, 000, Padc( Lista  , Tam ))
            Write( 05, 000, Padc( cTitulo , Tam ))
            Write( 06, 000, Repl( "=", Tam ) )



                Write( 07, 000, "DOC N?   TIPO    EMISSAO     VCTO PORTADOR     VLR TITULO JR MES ATR  JR DIARIO     DESCONTO        MULTA  TOTAL JUROS  TOTAL GERAL")

            Write( 08, 000, Repl( "=", Tam ) )
            Col := 9
        endif
        if nResumo = 1
            if NovoCodi .OR. Col = 9
                if NovoCodi
                    NovoCodi := .F.
                endif
                Qout( Codi, Receber->Regiao, Receber->Nome, Receber->Fone, Receber->( ltrim(rtrim(Ende))), Receber->(ltrim(rtrim(Bair))), Receber->( ltrim(rtrim(Cida))), Receber->Esta )
                Qout( Space(05), "SPC:" + if( Receber->Spc, "SIM em " + Dtoc( Receber->DataSpc ), "NAO"),Space(1), Receber->Fanta, Receber->Obs )
                Col += 2
            endif
        endif
        cCodi      := Codi
        cNome      := Receber->Nome
        dEmis      := Dtoc( Emis )
        dVcto      := Dtoc( Vcto )
        nJuro      := Tran( Juro,    "999.99")
        nAtraso     := Tran( Atraso, "999")
        nJdia      := Tran( Jurodia,        "@E 999,999.99")
        nValor     := Tran( Vlr,             "@E 9,999,999.99")
        nJuros     := Tran( Juros,            "@E 9,999,999.99")
        cDesconto := Tran( nDesconto,     "@E 9,999,999.99")
        cMulta     := Tran( nMulta,         "@E 9,999,999.99")
        nJrVlr     := Tran(((Vlr + Juros ) + nMulta ) - nDesconto,  "@E 9,999,999.99")

        if nResumo = 1



                Qout( Docnr, Tipo, dEmis, dVcto, Port, nValor, nJuro, nAtraso, nJdia, cDesconto, cMulta, nJuros, nJrVlr )

            Col++
        endif
        TotalCli   += Vlr
        TotalJur   += Juros
        TotalGer   += ((( Vlr + Juros ) + nMulta ) - nDesconto )
        GrandTotal += Vlr
        GrandJuros += Juros
        GrandGeral += ((( Vlr + Juros ) + nMulta ) - nDesconto )
        nDocumento ++
        Recemov->(DbSkip(1))
        if Col >= 57
            if nResumo = 1
                Col++
                Terminou( Tam, Col, TotalCli, TotalJur, TotalGer )
                Col        += 2
                __Eject()
            endif
            TotalCli := 0
            TotalJur := 0
            TotalGer := 0
        endif
  EndDo
  if lJuntado
      Prevenda->(Order( 1 ))
      Prevenda->(DbGotop())
      WHILE Prevenda->(!Eof())
          if Prevenda->Codi = cCodi
              cDesconto := Tran( 0, "@E 9,999,999.99")
              cMulta     := Tran( 0, "@E 9,999,999.99")
              nValor     := Tran( Prevenda->VlrFatura, "@E 9,999,999.99")
              nJuro        := Tran( 0, "999.99")
              nAtraso    := Tran( 0, "999")
              nJdia        := Tran( 0, "@E 999,999.99")
              nJuros     := Tran( 0, "@E 9,999,999.99")
              cMulta     := Tran( 0, "@E 9,999,999.99")
              nJrVlr     := Tran(((Vlr + Juros ) + nMulta ) - nDesconto,  "@E 9,999,999.99")



                  Qout( Prevenda->Fatura, "PREVENDA", Prevenda->Emis, Prevenda->Emis, Space(10), nValor, nJuro, nAtraso, nJdia, cDesconto, cMulta, nJuros, nValor )

              TotalCli     += Prevenda->VlrFatura
              TotalGer     += Prevenda->VlrFatura
              GrandTotal += Prevenda->VlrFatura
              GrandGeral += Prevenda->VlrFatura
              nDocumento ++
              Col++
              xFatura := Prevenda->Fatura
              WHILE Prevenda->Fatura = xFatura
                  Prevenda->(DbSkip(1))
              EndDo
          endif
          Prevenda->(DbSkip(1))
      EndDO
  endif
  if TotalCli <> 0
      if nResumo = 1
          Col++
          Terminou( Tam, Col, TotalCli, TotalJur, TotalGer )
          Col       += 2
      elseif nResumo = 3
          Write(  Col , 000, cCodi )
          Write(  Col , 005, cNome )
          Write(  Col , 048, Tran( TotalCli, "@E 999,999.99" ))
          Write(  Col , 109, Tran( TotalJur, "@E 999,999.99" ))
          Write(  Col , 122, Tran( TotalGer, "@E 999,999.99" ))
          Col++
      endif
      TotalCli := 0
      TotalJur := 0
      TotalGer := 0
  endif
  Receber->(DbSkip(1))
EndDo
Qout()
Col++
Write(  Col , 000, "** Total Geral **" )
Write(  Col , 020, StrZero( nDocumento, 6 ))
Write(  Col , 046, Tran( GrandTotal, "@E 9,999,999.99" ))
Write(  Col , 107, Tran( GrandJuros, "@E 9,999,999.99" ))
Write(  Col , 120, Tran( GrandGeral, "@E 9,999,999.99" ))
__Eject()
PrintOff()
ResTela( cScreen )
return



Proc RolPorTipo( cTitulo, dIni, dFim, dAtual, oBloco, cRegiao, cTipo, cPortador, nVctoOuEmis, nResumo, cCodiVen )

LOCAL cScreen      := SaveScreen()
LOCAL lSair       := .F.
LOCAL Lista       := SISTEM_NA3
LOCAL Tam          := 132
LOCAL Col          := 58
LOCAL Pagina      := 0
LOCAL NovoCodi   := .T.
LOCAL lSub          := .F.
LOCAL GrandTotal := 0
LOCAL GrandJuros := 0
LOCAL GrandGeral := 0
LOCAL Atraso      := 0
LOCAL Juros       := 0
LOCAL TotalCli   := 0
LOCAL TotalJur   := 0
LOCAL TotalGer   := 0
LOCAL nJrVlr      := 0
LOCAL nJuros      := 0
LOCAL nJdia       := 0
LOCAL nAtraso      := 0
LOCAL nJuro       := 0
LOCAL nValor      := 0
LOCAL nDocumento := 0
LOCAL dEmis
LOCAL dVcto
LOCAL NovoNome
LOCAL UltNome
LOCAL UltCodi
LOCAL cTela
LOCAL lMarcado
LOCAL cCodi

ErrorBeep()
lMarcado := Conf("Pergunta: Incluir no relatorio os marcados ?")
if !InsTru80() .OR. !LptOk()
    ResTela( cScreen )
    return
endif
cTela     := Mensagem("Aguarde, imprimindo.")
PrintOn()
FPrint(PQ)
SetPrc( 0 , 0 )
UltCodi    := Recemov->Codi
NovoCodi := .T.
WHILE Recemov->Tipo = cTipo .AND. Rel_Ok()
    cCodi := Recemov->Codi
    if !lMarcado
        Receber->(DbSeek( cCodi ))
        if Receber->Rol = .T.
            Recemov->(DbSkip(1))
            Loop
        endif
    endif
    if cCodiVen <> NIL
        if Recemov->CodiVen <> cCodiVen
            Recemov->(DbSkip(1))
            Loop
        endif
    endif
    if Recemov->Codi <> UltCodi
        NovoCodi := .T.
        UltCodi    := Recemov->Codi
        if TotalCli <> 0
            if nResumo = 1
                Col++
                Terminou( Tam, Col, TotalCli, TotalJur, TotalGer )
                Col        += 2
            endif
            TotalCli := 0
            TotalJur := 0
            TotalGer := 0
        endif
     endif
     if dIni <> NIL
         if nVctoOuEmis = 1 .OR. nVctoOuEmis = 5
             if Recemov->Vcto < dIni .OR. Recemov->Vcto > dFim
                 Recemov->(DbSkip(1))
                 Loop
             endif
         else
             if Recemov->Emis < dIni .OR. Recemov->Emis > dFim
                 Recemov->(DbSkip(1))
                 Loop
             endif
         endif
     endif
     if dAtual = Nil
         Atraso      := Atraso( Date(), Vcto )
         nCarencia := Carencia( Date(), Vcto )
         if Atraso <= 0
             Juros := 0
         else
            Juros  := Jurodia * nCarencia
         endif
     else
         Atraso      := Atraso( dAtual, Vcto )
         nCarencia := Carencia( dAtual, Vcto )
         if Atraso <= 0
             Juros := 0
         else
            Juros  := Jurodia * nCarencia
         endif
     endif
     if Col >= 57
         Write( 01, 001, "Pagina N?" + StrZero( ++Pagina , 3 ) )
         Write( 01, 117, "Horas "+ Time())
         Write( 02, 001, Dtoc( Date() ))
       Write( 03, 000, Padc( ltrim(rtrim(oAmbiente:xNomefir)), Tam ))
         Write( 04, 000, Padc( Lista    , Tam ))
         Write( 05, 000, Padc( cTitulo , Tam ))
         Write( 06, 000, Repl( "=", Tam ) )
         Write( 07, 000, "DOC N?   TIPO   EMISSAO  VCTO      NOSSONR      PORTADOR         VLR TITULO JR MES ATRASO  JUROS DIA   TOTAL JUROS    VALOR + JUROS")
         Write( 08, 000, Repl( "=", Tam ) )
         Col := 9
     endif
     if nResumo = 1
         if NovoCodi .OR. Col = 9
      if NovoCodi
          NovoCodi := .F.
      endif
      Qout( Codi, Receber->Nome, Receber->Fone, Receber->( ltrim(rtrim(Ende))), Receber->(ltrim(rtrim(Bair))),Receber->( ltrim(rtrim(Cida))), Receber->Esta )
      Qout()
      Col += 2
         endif
     endif
     dEmis    := Dtoc( Emis )
     dVcto    := Dtoc( Vcto )
     nValor    := Tran( Vlr,    "@E 9,999,999,999.99")
     nJuro    := Tran( Juro, "999.99")
     nAtraso := Tran( Atraso, "999")
     nJdia    := Tran( Jurodia,  "@E 99,999,999.99")
     nJuros    := Tran( Juros,  "@E 99,999,999.99")
     nJrVlr    := Tran( Juros + Vlr,  "@E 9,999,999,999.99")
     if nResumo = 1
         Qout( Docnr, Tipo, dEmis, dVcto, NossoNr, Port, nValor, nJuro, nAtraso, nJdia, nJuros, nJrVlr )
         Col++
     endif
     Totalcli    += Vlr
     Totaljur    += Juros
     Totalger    += (Juros + Vlr)
     GrandTotal += Vlr
     GrandJuros += Juros
     GrandGeral += ( Vlr+Juros )
     nDocumento ++
     Recemov->(DbSkip(1))
     if Col >= 57
         if nResumo = 1
             Col++
             Terminou( Tam, Col, TotalCli, TotalJur, TotalGer )
             Col         += 2
             __Eject()
         endif
         TotalCli := 0
         TotalJur := 0
         TotalGer := 0
     endif
EndDo
if TotalCli <> 0
    if nResumo = 1
        Col++
        Terminou( Tam, Col, TotalCli, TotalJur, TotalGer )
        Col        += 2
    endif
    TotalCli := 0
    TotalJur := 0
    TotalGer := 0
endif
Write(  Col , 000, "** Total Geral **" )
Write(  Col , 020, StrZero( nDocumento, 6 ))
Write(  Col , 060, Tran( GrandTotal, "@E 9,999,999.99" ))
Write(  Col , 099, Tran( GrandJuros, "@E 9,999,999.99" ))
Write(  Col , 116, Tran( GrandGeral, "@E 9,999,999.99" ))
__Eject()
PrintOff()
ResTela( cScreen )
return



Proc Terminou( Tam, Col, TotalCli, TotalJur, TotalGer )

Write(  Col,    000, "** Total Cliente **")
Write(  Col,    046, Tran( TotalCli, "@E 9,999,999.99"))
Write(  Col,    107, Tran( TotalJur, "@E 9,999,999.99"))
Write(  Col,    120, Tran( Totalger, "@E 9,999,999.99"))
Write(  Col+1, 000, Repl( "-" , Tam ) )
return



Proc RelRecCobranca()

LOCAL cScreen          := SaveScreen()
LOCAL aCodi           := {}
LOCAL aOrdem          := {"Codigo","Nome","Endereco","Bairro", "Cidade","Selecao" }
LOCAL aTipo           := {"Normal", "Total"}
LOCAL nTam              := 0
LOCAL dIni              := Date()-30
LOCAL dFim              := Date()
LOCAL dAtual          := Date()
LOCAL dProxCob       := Date()-30
LOCAL dProxCobFim   := Date()
LOCAL cCodi           := Space(04)
LOCAL cCodiVen       := Space(04)
LOCAL cNomeVen       := ""
LOCAL lTotal          := .F.
LOCAL nChoice          := 0
LOCAL aTodos          := {}
LOCAL lIncluir       := .T.
LOCAL lRolCob          := oSci:ReadBool("permissao","imprimirrolcobranca", .F. )
LOCAL lUsuarioAdmin := oSci:ReadBool("permissao","usuarioadmin", .F. )

MaBox( 13 , 18 , 15 , 77 )
SetCursor(1) ; DevPos( 14, 19 ) ; DevOut( "Cobrador:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodiVen, "cCodiVen", "9999", {|| FunErrado( @cCodiVen,, Row(), Col()+1, @cNomeVen )},))
ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
if LastKey() = 27
    ResTela( cScreen )
    return
endif
Recemov->(Order( 2 ))
WHILE .T.
    cCodi := Space(05)
    MaBox(16, 18, 18, 77 )
    SetCursor(1) ; DevPos( 17, 19 ) ; DevOut( "Cliente.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodi, "cCodi", "99999", {|| RecErrado( @cCodi,, Row(), Col()+1 )},))
    ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
    if LastKey() = 27
        Exit
    endif
    lIncluir := .T.
    if Ascan( aCodi, cCodi ) <> 0
        ErrorBeep()
        Alerta("Erro: Cliente Jah Selecionado.")
        Loop
    endif
    if Recemov->(DbSeek( cCodi ))
        WHILE Recemov->Codi = cCodi
            if Recemov->Cobrador <> Space(04) .AND. Recemov->Cobrador <> cCodiven
                ErrorBeep()
                if !Conf("Pergunta: Cobranca pertence a outro cobrador. Trocar ?")
                    lIncluir := .F.
                endif
                Exit
            endif
            Recemov->(DbSkip(1))
        EndDO
    else
        ErrorBeep()
        Alerta("Erro: Cliente sem debito.")
        Loop
    endif
    if Ascan( aCodi, cCodi ) = 0
        if lIncluir
            ErrorBeep()
            if Conf("Incluir " + Receber->(ltrim(rtrim(Nome))) + " ?")
                Aadd( aCodi, cCodi )
                Aadd( aTodos, { cCodi, Receber->Nome, Receber->Ende, Receber->Bair, Receber->Cida })
            endif
        endif
    else
        ErrorBeep()
        Alerta("Erro: Cliente Jah Selecionado.")
    endif
EndDo
if ( nTam := Len( aCodi )) = 0
    ResTela( cScreen )
    return
endif
cTitulo := "RELACAO DE COBRANCA DO COBRADOR: "
cTitulo += ltrim(rtrim(cNomeVen))
cTitulo += " NO PERIODO DE "
MaBox( 19 , 18 , 23, 67 )
SetCursor(1) ; DevPos( 20, 19 ) ; DevOut( "Vcto Inicial.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dIni, "dIni", "##/##/##",,))
SetCursor(1) ; DevPos( 20, 43 ) ; DevOut( "Vcto Final...:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dFim, "dFim", "##/##/##", {|| if( dIni > dFim, ( ErrorBeep(), Alerta("Erro: Data final menor que inicial"), .F. ), .T. )},))
SetCursor(1) ; DevPos( 21, 19 ) ; DevOut( "Prox Cob Ini.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dProxCob, "dProxCob", "##/##/##",,))
SetCursor(1) ; DevPos( 21, 43 ) ; DevOut( "Prox Cob Fim.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dProxCobFim, "dProxCobFim", "##/##/##", {|| if( dProxCob > dProxCobFim, ( ErrorBeep(), Alerta("Erro: Data final menor que inicial"), .F. ), .T. )},))
SetCursor(1) ; DevPos( 22, 19 ) ; DevOut( "Data Calculo.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dAtual, "dAtual", "##/##/##",,))
ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
if LastKey() = 27
    ErrorBeep()
    if Conf("Pergunta: Deseja Cancelar a Selecao ?")
        ResTela( cScreen )
        return
    endif
endif
M_Title("TIPO")
nChoice := FazMenu( 07, 55,  aTipo )
if nChoice = 0
    ErrorBeep()
    if Conf("Pergunta: Deseja Cancelar a Selecao ?")
        ResTela( cScreen )
        return
    endif
endif
ErrorBeep()
oMenu:Limpa()
Mensagem(SISTEM_NA1 + ";-;Aguarde, Autenticando Permissao do Usuario.")
if !lRolCob
    if !lUsuarioAdmin
        if !PedePermissao( 500 )
            ResTela( cScreen )
            return
        endif
    endif
endif
ErrorBeep()
oMenu:Limpa()
ErrorBeep()
if Conf("Pergunta: Anexar os antigos tambem ?")
    Mensagem(SISTEM_NA1 + ";-;Aguarde, Localizando registros.")
    ErrorBeep()
    Recemov->(Order( 2 ))
    Receber->(Order( 2 ))
    Receber->(DbGoTop())
    While Receber->(!Eof()) .AND. Rel_Ok()
        if Receber->ProxCob < dProxCob .OR. Receber->ProxCob > dProxCobFim .OR. Receber->ProxCob = Ctod("//")
            Receber->(DbSkip(1))
            Loop
        endif
        cCodi     := Receber->Codi
        lIncluir := .F.
        if Recemov->(DbSeek( cCodi ))
            WHILE Recemov->Codi = cCodi
                if Recemov->Cobrador = cCodiven
                    lIncluir := .T.
                    Exit
                endif
                Recemov->(DbSkip(1))
            EndDO
        endif
        if lIncluir
            if Ascan( aCodi, cCodi ) = 0
                Aadd( aCodi, cCodi )
                Aadd( aTodos, { cCodi, Receber->Nome, Receber->Ende, Receber->Bair, Receber->Cida })
            endif
        endif
        Receber->(DbSkip(1))
    EndDo
endif
lTotal := nChoice = 2
WHILE .T.
    oMenu:Limpa()
    M_Title("ESCOLHA A ORDEM A IMPRIMIR. ESC RETORNA")
    nOpcao := FazMenu( 05, 10, aOrdem )
    Mensagem("Aguarde, Ordenando.")
    if nOpcao = 0
        Exit
    elseif nOpcao = 1
        Asort( aTodos,,, {| x, y | y[1] > x[1] } )
    elseif nOpcao = 2
        Asort( aTodos,,, {| x, y | y[2] > x[2] } )
    elseif nOpcao = 3
        Asort( aTodos,,, {| x, y | y[3] > x[3] } )
    elseif nOpcao = 4
        Asort( aTodos,,, {| x, y | y[4] > x[4] } )
    elseif nOpcao = 5
        Asort( aTodos,,, {| x, y | y[5] > x[5] } )
    endif
    nTam     := Len( aCodi )
    aCodi  := {}
    For nX := 1 To nTam
        Aadd( aCodi, aTodos[nX,1] )
    Next
    ErrorBeep()
    if !InsTru80() .OR. !LptOk()
        ResTela( cScreen )
        return
    endif
    cTitulo += Dtoc( dIni ) + " A " + Dtoc( dFim )
    Prn002Cob( cTitulo, dIni, dFim, dAtual, aCodi, cCodiVen, lTotal, NIL, NIL, dProxCob, dProxCobFim )
EndDo
ResTela( cScreen )
return

Proc RelRecTotalizado()

LOCAL cScreen      := SaveScreen()
LOCAL Tam          := 132
LOCAL Col          := 58
LOCAL Pagina      := 0
LOCAL nTotalVlr  := 0
LOCAL nTotalJur  := 0
LOCAL nTotalGer  := 0
LOCAL nTotalMul  := 0
LOCAL nTotalDes  := 0
LOCAL nAtraso      := 0
LOCAL nDesconto  := 0
LOCAL nMulta      := 0
LOCAL nJuros      := 0
LOCAL nCarencia  := 0
LOCAL nDocumento := 0
LOCAL nChoice      := 1
LOCAL dAtual      := Date()
LOCAL cTitulo      := "ROL GERAL DE TITULOS A RECEBER - TOTALIZADO"
LOCAL dIni          := Date()-30
LOCAL dFim          := Date()
LOCAL aMenu       := {"Por Vcto", "Por Emissao", "Geral"}
LOCAL cTela
LOCAL oBloco1
LOCAL oBloco2

M_Title( "TOTALIZADO")
nChoice := FazMenu( 04 , 20, aMenu, Cor() )
Do Case
Case nChoice = 0
    ResTela( cScreen )
    return
Case nChoice = 1
    MaBox( 13 , 18 , 16, 50 )
    SetCursor(1) ; DevPos( 14, 19 ) ; DevOut( "Data Vcto Inicial..:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dIni, "dIni", "##/##/##",,))
    SetCursor(1) ; DevPos( 15, 19 ) ; DevOut( "Data Vcto Final....:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dFim, "dFim", "##/##/##",,))
    oBloco1 := {|| Recemov->Vcto >= dIni .AND. Recemov->Vcto <= dFim }
Case nChoice = 2
    MaBox( 13 , 18 , 16, 50 )
    SetCursor(1) ; DevPos( 14, 19 ) ; DevOut( "Data Emis Inicial..:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dIni, "dIni", "##/##/##",,))
    SetCursor(1) ; DevPos( 15, 19 ) ; DevOut( "Data Emis Final....:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dFim, "dFim", "##/##/##",,))
    oBloco2 := {|| Recemov->Emis >= dIni .AND. Recemov->Emis <= dFim }
EndCase
ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
if LastKey() = 27
    ResTela( cScreen )
    return
endif
if Recemov->(Lastrec()) = 0
    return
endif
if !InsTru80() .OR. !LptOk()
    ResTela( cScreen )
    return
endif
cTela := Mensagem("Aguarde, imprimindo.")
PrintOn()
FPrint( PQ )
SetPrc( 0 , 0 )
dbSelectArea( "ReceMov" )
Recemov->(DbGoTop())
WHILE Recemov->(!Eof()) .AND. Rel_Ok()
    if nChoice = 1
        if !Eval( oBloco1 )
            Recemov->(DbSkip(1))
            Loop
        endif
    endif
    if nChoice = 2
        if !Eval( oBloco2 )
            Recemov->(DbSkip(1))
            Loop
        endif
    endif
    nAtraso     := Atraso( dAtual, Vcto )
    nCarencia := Carencia( dAtual, Vcto )
    nMulta     := VlrMulta( dAtual, Vcto, Vlr )
    nDesconto := VlrDesconto( dAtual, Vcto, Vlr )
    if nAtraso <= 0
        nJuros := 0
    else
        nJuros  := Jurodia * nCarencia
    endif
    if Col >= 57
        Qout( Padr( "Pagina N?" + StrZero( ++Pagina,3 ), ( Tam/2 ) ) + Padl( Time(), ( Tam/2 ) ))
        Qout( Dtoc( Date() ))
      Qout( Padc( ltrim(rtrim(oAmbiente:xNomefir)), Tam ))
        Qout( Padc( SISTEM_NA3, Tam ))
        Qout( Padc( cTitulo , Tam ))
        Qout( Repl( "=", Tam ) )
        Qout("              QTDE DCTOS    TOTAL NOMINAL      TOTAL JUROS      TOTAL MULTA   TOTAL DESCONTO      TOTAL GERAL")
        Qout( Repl( "=", Tam ) )
        Col := 9
    endif
    nDocumento ++
    nTotalVlr  += Vlr
    nTotalJur  += nJuros
    nTotalGer  += (( Vlr + nJuros ) + nMulta ) - nDesconto
    nTotalMul  += nMulta
    nTotalDes  += nDesconto
    Recemov->(DbSkip(1))
EndDo





Qout("** Total Geral **", Tran( nDocumento, "999999" ), Tran( nTotalVlr, "@E 9,999,999,999.99" ), Tran( nTotalJur, "@E 9,999,999,999.99" ), Tran( nTotalMul, "@E 9,999,999,999.99" ), Tran( nTotalDes, "@E 9,999,999,999.99" ), Tran( nTotalGer, "@E 9,999,999,999.99" ))
__Eject()
PrintOff()
ResTela( cScreen )
return



Proc HelpReceber( cProc, nLine, cVar, nChoice )

LOCAL nKey := SetKey( -1 )
SetKey( -1, NIL )
PosiReceber( 1, NIL, cCaixa )
SetKey( -1, {| p, l, v | HelpReceber( p, l, v ) } )
return



Proc Prn001( dIni, dFim, cTitulo )

LOCAL cScreen        := SaveScreen()
LOCAL Tam            := 132
LOCAL Col            := 58
LOCAL nDocumentos := 0
LOCAL nParDoc        := 0
LOCAL Pagina        := 0
LOCAL TotTit        := 0
LOCAL TotRec        := 0
LOCAL nParVlr        := 0
LOCAL nParRec        := 0
LOCAL nAtraso        := 0
LOCAL cIni            := Dtoc( dIni )
LOCAL cFim            := Dtoc( dFim )
LOCAL Relato        := "RELATORIO DE TITULOS RECEBIDOS " + ltrim(rtrim(cTitulo)) + " REF. " + cIni + " A " + cFim

PrintOn()
FPrint( PQ )
SetPrc( 0 , 0 )
WHILE ( !Eof() .AND. Rep_Ok())
    nAtraso := Atraso( DataPag, Vcto )
    if Col >= 56
        Write( 00, 00, Padr( "Pagina N?" + StrZero( ++Pagina,3 ), ( Tam/2 ) ) + Padl( Time(), ( Tam/2 ) ) )
        Write( 01, 00, Date() )
      Write( 02, 00, Padc( ltrim(rtrim(oAmbiente:xNomefir)), Tam ) )
        Write( 03, 00, Padc( SISTEM_NA3, Tam ) )
        Write( 04, 00, Padc( Relato, Tam ) )
        Write( 05, 00, Repl( "-", Tam ) )
        Write( 06, 00, "CODI  NOME CLIENTE    EMISSAO  VENCTO   DOCTO N? TIPO   VLR TITULO DATA PGT   ATR   VLR PAGO PORTADOR OBSERVACOES")
        Write( 07, 00, Repl( "-", Tam ) )
        Col := 08
    endif


    Qout( Codi, Receber->(Left( Nome, 15 )), Emis, Vcto, Docnr, Tipo,    Tran( Vlr, "@E 999,999.99"), DataPag, Tran( nAtraso, "99999"),    Tran( VlrPag, "@E 999,999.99"), Left( Port, Len( Port)-2), Left( Obs, 29 ))
    Col            ++
    nDocumentos ++
    nParDoc        ++
    nParVlr        += Vlr
    nParRec        += VlrPag
    TotTit        += Vlr
    TotRec        += VlrPag
    DbSkip(1)
    if Col >= 56
        Qout()
        Qout( " * Parcial *", Tran( nParDoc, "99999"), Space(31), Tran( nParVlr,"@E 9,999,999,999.99" ), Space(08), Tran( nParRec,"@E 9,999,999,999.99" ))
        nParDoc := 0
        nParVlr := 0
        nParRec := 0
        if !Eof()
            __Eject()
        endif
    endif
EndDo
Qout()
Qout( " * Parcial *", Tran( nParDoc,     "99999"), Space(31), Tran( nParVlr,"@E 9,999,999,999.99" ), Space(08), Tran( nParRec,"@E 9,999,999,999.99" ))
Qout( " ** Total **", Tran( nDocumentos, "99999"), Space(31), Tran( TotTit, "@E 9,999,999,999.99" ), Space(08), Tran( TotRec, "@E 9,999,999,999.99" ))
__Eject()
PrintOff()
ResTela( cScreen )
return



Proc RelCli()

LOCAL cScreen    := SaveScreen()
LOCAL nChoice    := 0
LOCAL aTipo     := {" Completa ", " Parcial ", " Contrato" }

WHILE .T.
    M_Title( "FICHA/RELACAO CLIENTES" )
    nChoice := FazMenu( 04, 17, aTipo, Cor())
    Do Case
    Case nChoice = 0
        ResTela( cScreen )
        Exit

    Case nChoice = 1
        RelCliCompleta()

    Case nChoice = 2
        RelCliParcial()

    Case nChoice = 3
        ContratoMaxMotors()

    EndCase
EndDo



Proc RelCliCompleta()

LOCAL cScreen    := SaveScreen()
LOCAL nChoice    := 0
LOCAL nOpcao    := 0
LOCAL nOrder    := 1
LOCAL nField    := 0
LOCAL AtPrompt := { "Individual ", "Por Regiao", "Por Cidade", "Por Estado", "Geral"}
LOCAL aOrdem    := { "Ordem Nome", "Ordem Codigo", "Ordem Cidade+Nome", "Ordem Regiao", "Ordem Estado"}
LOCAL xAlias
LOCAL xNtx
LOCAL aStru
LOCAL xDado
LOCAL xOrder

WHILE .T.
    xAlias := FTempName("T*.TMP*")
    xNtx     := FTempName("T*.TMP*")
    M_Title( "FICHA/RELACAO CLIENTES" )
    nChoice := FazMenu( 06 , 20 ,  AtPrompt, Cor())
    if nChoice = 0
        ResTela( cScreen )
        Exit
    endif
    MaBox( 15 , 20 , 17 , 78 )
    Do Case
        Case nChoice = 1
            xDado  := Space(05)
           xOrder := 2
            SetCursor(1) ; DevPos( 16, 21 ) ; DevOut( "Cliente.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( xDado, "xDado", "99999", {|| RecErrado(@xDado,, Row(), Col()+1 )},))
        Case nChoice = 2
            xDado  := Space(02)
           xOrder := 4
            SetCursor(1) ; DevPos( 16, 21 ) ; DevOut( "Regiao..:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( xDado, "xDado", "@!", {|| RegiaoErrada(@xDado )},))
        Case nChoice = 3
            xDado  := Space(25)
            xOrder := 3
            SetCursor(1) ; DevPos( 16, 21 ) ; DevOut( "Cidade..:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( xDado, "xDado", "@!",,))
        Case nChoice = 4
            xDado  := Space(02)
            xOrder := 5
            SetCursor(1) ; DevPos( 16, 21 ) ; DevOut( "Estado..:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( xDado, "xDado", "@!",,))
        Case nChoice = 5
            xOrder := 0
    endCase
    ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
    if LastKey( ) = 27
        ResTela( cScreen )
        Loop
    endif
    Receber->(Order( xOrder ))
    if nChoice <> 5
        if Receber->(!DbSeek( xDado ))
            Alerta("Erro: Parametros informados nao Localizado.")
            ResTela( cScreen )
            Loop
        endif
        aStru := Receber->(DbStruct())
        DbCreate( xAlias, aStru )
        dbUseArea( .T.,, ( xAlias ), "xTemp", iif( .F. .OR. .T., ! .T., NIL ), .F. )
        xTemp->(DbAppend())
        For nField := 1 To FCount()
            xTemp->(FieldPut( nField, Receber->(FieldGet( nField ))))
        Next
    else
        dbSelectArea( "Receber" )
        Receber->(DbGoTop())
    endif

    WHILE .T.

        M_Title("ESCOLHA A ORDEM A IMPRIMIR. ESC RETORNA")
        nOpcao := FazMenu( 18 , 20 , aOrdem )
        if nChoice <> 5
            if nOpcao = 0
                xTemp->(DbCloseArea())
                Ferase( xAlias )
                Ferase( xNtx )
                ResTela( cScreen )
                Exit
            elseif nOpcao = 1
                 Mensagem("Aguarde, Ordenando Por Nome. ")
                 dbSelectArea( "xTemp" )
                 ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Codi", {|| xTemp->Codi}, )
             elseif nOpcao = 2
                 Mensagem("Aguarde, Ordenando Por Nome. ")
                 dbSelectArea( "xTemp" )
                 ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Nome", {|| xTemp->Nome}, )
             elseif nOpcao = 3
                 Mensagem("Aguarde, Ordenando Por Cidade+Nome. ")
                 dbSelectArea( "xTemp" )
                 ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Cida + xTemp->Nome", {|| xTemp->Cida + xTemp->Nome}, )
             elseif nOpcao = 4
                 Mensagem("Aguarde, Ordenando Por Regiao. ")
                 dbSelectArea( "xTemp" )
                 ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Regiao", {|| xTemp->Regiao}, )
             elseif nOpcao = 5
                 Mensagem("Aguarde, Ordenando Por Estado. ")
                 dbSelectArea( "xTemp" )
                 ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Esta", {|| xTemp->Esta}, )
            endif
            xTemp->(DbGoTop())
        else
            if nOpcao = 0
                ResTela( cScreen )
                Exit
            endif
            dbSelectArea( "Receber" )
            Receber->(Order( nOpcao ))
            Receber->(DbGoTop())
        endif
        oMenu:Limpa()
        if !Instru80() .OR. !LptOk()
            ResTela( cScreen )
            Loop
        endif
        Mensagem("Aguarde, Imprimindo.")
        ListaCli( nOpcao )
        if nChoice <> 5
            xTemp->(DbClearIndex())
        endif
    EndDo
EndDo
ResTela( cScreen )
return



Proc ContratoMaxMotors()

LOCAL cScreen    := SaveScreen()
LOCAL nChoice    := 0
LOCAL nOpcao    := 0
LOCAL cCodi     := Space(04)
LOCAL cRegiao    := Space(02)
LOCAL cEsta     := Space(02)
LOCAL cCida     := Space(25)
LOCAL nOrder    := 1
LOCAL nField    := 0
LOCAL AtPrompt := { "Individual ", "Por Regiao", "Por Cidade", "Por Estado", "Geral"}
LOCAL aOrdem    := { "Ordem Nome", "Ordem Codigo", "Ordem Cidade+Nome", "Ordem Regiao", "Ordem Estado"}
LOCAL xAlias
LOCAL xNtx
LOCAL aStru

WHILE .T.
    xAlias := FTempName("T*.TMP")
    xNtx     := FTempName("T*.TMP")
    M_Title( "FICHA/RELACAO CLIENTES" )
    nChoice := FazMenu(06 , 20 ,  AtPrompt)
    Do Case
    Case nChoice = 0
        ResTela( cScreen )
        Exit

    Case nChoice = 1
        dbSelectArea( "Receber" )
        cCodi := Space(05)
        MaBox( 19 , 20 , 21 , 78 )
        SetCursor(1) ; DevPos( 20, 21 ) ; DevOut( "Cliente.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodi, "cCodi", "99999", {|| RecErrado( @cCodi,, Row(), Col()+1 )},))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        if LastKey( ) = 27
            ResTela( cScreen )
            Loop
        endif
        Receber->(Order( 2 ))
        if Receber->(!DbSeek( cCodi ))
            Alerta("Erro: Cliente nao Localizado.")
            Loop
        endif
        aStru := Receber->(DbStruct())
        DbCreate( xAlias, aStru )
        dbUseArea( .T.,, ( xAlias ), "xTemp", iif( .F. .OR. .T., ! .T., NIL ), .F. )
        xTemp->(DbAppend())
        For nField := 1 To FCount()
            xTemp->(FieldPut( nField, Receber->(FieldGet( nField ))))
        Next

    Case nChoice = 2
        cRegiao := Space( 02 )
        MaBox( 19 , 20 , 21 , 33 )
        SetCursor(1) ; DevPos( 20, 21 ) ; DevOut( "Regiao..:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cRegiao, "cRegiao", "@!", {|| RegiaoErrada( @cRegiao )},))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        if LastKey() = 27
            Loop
        endif
        Receber->(Order( 4 ))
        if Receber->(!DbSeek( cRegiao ))
            Alerta("Erro: Nenhum Cliente Registrado nesta Regiao.")
            Loop
        endif
        aStru := Receber->(DbStruct())
        DbCreate( xAlias, aStru )
        dbUseArea( .T.,, ( xAlias ), "xTemp", iif( .F. .OR. .T., ! .T., NIL ), .F. )
        WHILE Receber->Regiao = cRegiao
            xTemp->(DbAppend())
            For nField := 1 To FCount()
                xTemp->(FieldPut( nField, Receber->(FieldGet( nField ))))
            Next
            Receber->(DbSkip(1))
        EnDDo

    Case nChoice = 3
        cCida := Space( 25 )
        MaBox( 19 , 20 , 21 , 56 )
        SetCursor(1) ; DevPos( 20, 21 ) ; DevOut( "Cidade..:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCida, "cCida", "@!",,))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        if LastKey() = 27
            Loop
        endif
        Receber->(Order( 3 ))
        if Receber->(!DbSeek( cCida ))
            Alerta("Erro: Nenhum Cliente Registrado nesta Cidade.")
            Loop
        endif
        aStru := Receber->(DbStruct())
        DbCreate( xAlias, aStru )
        dbUseArea( .T.,, ( xAlias ), "xTemp", iif( .F. .OR. .T., ! .T., NIL ), .F. )
        WHILE Receber->Cida = cCida
            xTemp->(DbAppend())
            For nField := 1 To FCount()
                xTemp->(FieldPut( nField, Receber->(FieldGet( nField ))))
            Next
            Receber->(DbSkip(1))
        Enddo

    Case nChoice = 4
        cEsta := Space( 02 )
        MaBox( 19 , 20 , 21 , 56 )
        SetCursor(1) ; DevPos( 20, 21 ) ; DevOut( "Estado..:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cEsta, "cEsta", "@!",,))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        if LastKey() = 27
            Loop
        endif
        Receber->(Order( 5 ))
        if Receber->(!DbSeek( cEsta ))
            Alerta("Erro: Nenhum Cliente Registrado neste Estado.")
            Loop
        endif
        aStru := Receber->(DbStruct())
        DbCreate( xAlias, aStru )
        dbUseArea( .T.,, ( xAlias ), "xTemp", iif( .F. .OR. .T., ! .T., NIL ), .F. )
        WHILE Receber->Esta = cEsta
            xTemp->(DbAppend())
            For nField := 1 To FCount()
                xTemp->(FieldPut( nField, Receber->(FieldGet( nField ))))
            Next
            Receber->(DbSkip(1))
        EndDo

    Case nChoice = 5
        dbSelectArea( "Receber" )
        Receber->(DbGoTop())
    EndCase
    WHILE .T.
        oMenu:Limpa()
        M_Title("ESCOLHA A ORDEM A IMPRIMIR. ESC RETORNA")
        nOpcao := FazMenu( 05, 10, aOrdem )
        if nChoice <> 5
            if nOpcao = 0
                xTemp->(DbCloseArea())
                Ferase( xAlias )
                Ferase( xNtx )
                ResTela( cScreen )
                Exit
            elseif nOpcao = 1
                 Mensagem("Aguarde, Ordenando Por Nome.")
                 dbSelectArea( "xTemp" )
                 ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Codi", {|| xTemp->Codi}, )
             elseif nOpcao = 2
                 Mensagem("Aguarde, Ordenando Por Nome.")
                 dbSelectArea( "xTemp" )
                 ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Nome", {|| xTemp->Nome}, )
             elseif nOpcao = 3
                 Mensagem("Aguarde, Ordenando Por Cidade+Nome.")
                 dbSelectArea( "xTemp" )
                 ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Cida + xTemp->Nome", {|| xTemp->Cida + xTemp->Nome}, )
             elseif nOpcao = 4
                 Mensagem("Aguarde, Ordenando Por Regiao.")
                 dbSelectArea( "xTemp" )
                 ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Regiao", {|| xTemp->Regiao}, )
             elseif nOpcao = 5
                 Mensagem("Aguarde, Ordenando Por Estado.")
                 dbSelectArea( "xTemp" )
                 ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Esta", {|| xTemp->Esta}, )
            endif
            xTemp->(DbGoTop())
        else
            if nOpcao = 0
                ResTela( cScreen )
                Exit
            endif
            dbSelectArea( "Receber" )
            Receber->(Order( nOpcao ))
            Receber->(DbGoTop())
        endif
        oMenu:Limpa()
        if !Instru80() .OR. !LptOk()
            ResTela( cScreen )
            Loop
        endif
        Mensagem("Aguarde, Imprimindo.")
        ListaContrato( nOpcao )
        if nChoice <> 5
            xTemp->(DbClearIndex())
        endif
    EndDo
EndDo
ResTela( cScreen )
return


Proc ListaContrato( nOrdem )

LOCAL cScreen := SaveScreen()
LOCAL lSair   := .T.
LOCAL cRegiao := Regiao
LOCAL Tam      := 80
LOCAL Col      := 6
LOCAL Pagina  := 0
LOCAL Titulo

Regiao->(Order( 1 ))
if Regiao->(DbSeek( cRegiao))
    cRegiao := Regiao->Nome
endif
PrintOn()
SetPrc( 0, 0 )
FPrint( _CPI12 )
WHILE !Eof() .AND. Rel_Ok() .AND. !Eof()
    Write( 10, 00, "")
    Write( Prow()+1, 00, NG + "II - DO COMPRADOR" + NR)
    Write( Prow()+1, 00, Repl( "-" , Tam ))
    Write( Prow()+1, 00, "Nome Completo")
    Write( Prow()+1, 00, NG + Nome  + NR )
    Write( Prow()+1, 00, "Endereco Comercial")
    Write( Prow(),   48, "Bairro")
    Write( Prow(),   69, "Fone")
    Write( Prow()+1, 00, Ende )
    Write( Prow(),   48, Bair )
    Write( Prow(),   69, Fone )
    Write( Prow()+1, 00, "Cidade")
    Write( Prow(),   48, "Estado")
    Write( Prow()+1, 00, Cep + "/" + Cida )
    Write( Prow(),   48, Esta )
    Write( Prow()+1, 00, "CIC")
    Write( Prow(),   48, "Carteira de Identidade N§")
    Write( Prow()+1, 00, Cpf )
    Write( Prow(),   48, Rg )
    Write( Prow()+1, 00, "CGC/MF")
    Write( Prow(),   48, "Inscricao Estadual")
    Write( Prow()+1, 00, Cgc )
    Write( Prow(),   48, Insc )
    Write( Prow()+1, 00, "Data Nascimento")
    Write( Prow(),   48, "Estado Civil")
    Write( Prow()+1, 00, + Dtoc( Nasc ))
    Write( Prow(),   48, Civil )

    Write( Prow()+1, 00, "Profissao")
    Write( Prow()+1, 00, Profissao )
    Write( Prow()+1, 00, "Endereco Residencial")
    Write( Prow(),   48, "Bairro")
    Write( Prow()+1, 00, Ende1 )
    Write( Prow(),   48, Bair )
    Write( Prow()+1, 00, "Cidade")
    Write( Prow(),   48, "Estado")
    Write( Prow()+1, 00, Cep + "/" + Cida )
    Write( Prow(),   48, Esta )
    Write( Prow()+1, 00, "Telefone Residencial")
    Write( Prow()+1, 00, Fone1 )
    Write( Prow()+2, 00, NG + "III - DA MERCADORIA OBJETO" + NR)
    Write( Prow()+1, 00, Repl( "-" , Tam ))
    Write( Prow()+1, 00, "Fabricante")
    Write( Prow()+1, 00, Fabricante )
    Write( Prow()+1, 00, "Produto")
    Write( Prow()+1, 00, Produto )
    Write( Prow()+1, 00, "Modelo")
    Write( Prow()+1, 00, Modelo )
    Write( Prow()+2, 00, NG + "IV - DO VALOR DA MERCADORIA OBJETO" + NR)
    Write( Prow()+1, 00, Repl( "-" , Tam ))
    Write( Prow()+1, 00, "Valor da Mercadoria nesta Data")
    Write( Prow(),   48, "Local da Venda")
    Write( Prow()+1, 00, Tran( Valor, "@E 999,999,999.99"))
    Write( Prow(),   48, Local )
    Write( Prow()+2, 00, NG + "V - DO PRAZO DE PAGAMENTO" + NR)
    Write( Prow()+1, 00, Repl( "-" , Tam ))
    Write( Prow()+1, 00, "N?de Prestacoes Contratadas")
    Write( Prow()+1, 00, Tran( Prazo, "999"))
    Write( Prow()+2, 00, NG + "VI - DATA DE VENCIMENTO DAS PRESTACOES" + NR)
    Write( Prow()+1, 00, Repl( "-" , Tam ))
    Write( Prow()+1, 00, "Dia do vencimento das prestacoes mensais nos meses seguintes")
    Write( Prow()+1, 00, Tran( DataVcto, "99"))
    DbSkip(1)
    __Eject()
EndDo
PrintOff()
ResTela( cScreen )
return

Proc ListaCli( nOrdem )

LOCAL cScreen := SaveScreen()
LOCAL lSair   := .T.
LOCAL cRegiao := Regiao
LOCAL Tam      := 93
LOCAL Col      := 6
LOCAL Pagina  := 0
LOCAL Titulo

Regiao->(Order( 1 ))
if Regiao->(DbSeek( cRegiao))
    cRegiao := Regiao->Nome
endif
if nOrdem = 2
    Titulo := "LISTAGEM DE CLIENTES DA REGIAO " + ltrim(rtrim(cRegiao))
else
    Titulo := "LISTAGEM DE CLIENTES"
endif
PrintOn()
SetPrc( 0 , 0 )
FPrint( _CPI12 )
Pagina++
Write( 00 ,  000, "Pagina N?"+ StrZero( Pagina , 3 ))
Write( 00 ,  065, "Horas "+ Time( ) )
Write( 01 ,  000,  Dtoc( Date( ) ) )
Write( 02 ,  000,  Padc( ltrim(rtrim(oAmbiente:xNomefir)), Tam ))
Write( 03 ,  000,  Padc( SISTEM_NA3, Tam))
Write( 04 ,  000,  Padc( Titulo, Tam))
Col := 5
WHILE !Eof() .AND. Rel_Ok() .AND. !Eof()
    if Col >= 57
        __Eject()
        Pagina++
        Write( 00 ,  000, "Pagina N?"+ StrZero( Pagina , 3 ))
        Write( 00 ,  065, "Horas "+ Time( ) )
        Write( 01 ,  000,  Dtoc( Date( ) ) )
      Write( 02 ,  000,  Padc( ltrim(rtrim(oAmbiente:xNomefir)), Tam ))
        Write( 03 ,  000,  Padc( SISTEM_NA3, Tam))
        Write( 04 ,  000,  Padc( Titulo, Tam))
        Col := 5
    endif
    Write( Col++, 00, Repl( "-" , Tam ))
    Write( Col,   00, "Codigo.........: " + Codi )
    Write( Col++, 48, "Cadastro.: "       + Dtoc( Data ))
    Write( Col++, 00, "Nome...........: " + Nome )
    Write( Col,   00, "Endereco.......: " + Ende )
    Write( Col++, 48, "E. Civil.: "       + Civil )
    Write( Col,   00, "Cidade.........: " + Cida )
    Write( Col,   48, "Estado...: "       + Esta )
    Write( Col++, 64, "CEP.: "            + Cep )
    Write( Col,   00, "Natural........: " + Natural )
    Write( Col++, 48, "Nascto...: "       + Dtoc( Nasc ))
    Write( Col,   00, "Identidade n?.: " + Rg )
    Write( Col++, 48, "CPF......: "       + Cpf )
    Write( Col,   00, "Insc. Estadual.: " + Insc )
    Write( Col++, 48, "CGC/MF...: "       + Cgc )
    Write( Col,   00, "Telefone.......: " + Fone )
    Write( Col++, 48, "Fax......: "       + Fax )
    Write( Col++, 00, "ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ")
    Write( Col,   00, "Esposo(a)......: " + Esposa )
    Write( Col++, 58, "Dependentes..: "   + StrZero( Depe, 2))
    Write( Col++, 00, "Pai............: " + Pai )
    Write( Col++, 00, "Mae............: " + Mae )
    Write( Col,   00, "Endereco.......: " + Ende1 )
    Write( Col++, 48, "Fone.: "           + Fone )
    Write( Col++, 00, "ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ")
    Write( Col,   00, "Profissao......: " + Profissao )
    Write( Col++, 48, "Cargo.: "          + Cargo )
    Write( Col,   00, "Trabalho Atual.: " + Trabalho  )
    Write( Col++, 48, "Fone..: "          + Fone2 )
    Write( Col,   00, "Tempo Servico..: " + Tempo )
    Write( Col++, 48, "Renda Mensal...: " + Tran( Media , "@E 99,999,999.99" ))
    Write( Col,   00, "Autoriza Compra: " + if( Autorizaca, "SIM", "NAO"))
    Write( Col++, 48, "Assinou Autoriz: " + if( AssAutoriz, "SIM", "NAO"))
    Write( Col++, 00, "ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ")
    Write( Col,   00, "Referencia.....: " + RefBco )
    Write( Col++, 65, "Spc...: " + if( Spc, "SIM", "NAO" ))
    Write( Col++, 00, "Referencia.....: " + RefCom)
    Write( Col++, 00, "Bens Imoveis...: " + Imovel )
    Write( Col++, 00, "Veiculos.......: " + Veiculo )
    Write( Col++, 00, "ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ")
    Write( Col++, 00, "Avalista.......: " + Conhecida )
    Write( Col++, 00, "Endereco.......: " + Ende3 )
    Write( Col,   00, "Cidade.........: " + CidaAval )
    Write( Col++, 48, "Estado...: " + EstaAval )
    Write( Col,   00, "Endereco.......: " + Ende3 )
    Write( Col++, 48, "Bairro...: " + BairAval )
    Write( Col,   00, "Telefone.......: " + FoneAval )
    Write( Col++, 48, "Fax......: " + FaxAval )
    Write( Col,   00, "Rg n?.........: " + RgAval )
    Write( Col++, 48, "Cpf......: " + CpfAval )
    Write( Col++, 00, "ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ")
    Write( Col++, 00, "Observacoes....: " + Obs )
    Write( Col++, 00, "                 " + Obs1  )
    Write( Col++, 00, "                 " + Obs2  )
    Write( Col++, 00, "                 " + Obs3  )
    Write( Col++, 00, "                 " + Obs4  )
    Write( Col++, 00, "                 " + Obs5  )
    Write( Col++, 00, "                 " + Obs6  )
    Write( Col++, 00, "                 " + Obs7  )
    Write( Col++, 00, "                 " + Obs8  )
    Write( Col++, 00, "                 " + Obs9  )
    Write( Col++, 00, "                 " + Obs10 )
    Col += 1

    Write( Col+01, 00, "________________________________________  _______________________________________")
    Write( Col+02, 00, "AUTORIZO COMPRAR EM MINHA FICHA")

    Write( Col+05, 00, "________________________________________  _______________________________________")
    Write( Col+06, 00,  Nome )
    Write( Col+06, 42,  Conhecida )

    Write( Col+09, 00, "________________________________________  _______________________________________")
    Write( Col+10, 00, Esposa )
   Write( Col+10, 42, ltrim(rtrim(oAmbiente:xNomefir)) )
    Col := 58
    DbSkip(1)
EndDo
__Eject()
PrintOff()
ResTela( cScreen )
return



Proc RelCliParcial()

LOCAL cScreen    := SaveScreen()
LOCAL nChoice    := 0
LOCAL nOpcao    := 0
LOCAL cCodi     := Space(05)
LOCAL cCodifim := Space(05)
LOCAL cRegiao    := Space(02)
LOCAL cEsta     := Space(02)
LOCAL cCida     := Space(25)
LOCAL nOrder    := 1
LOCAL nField    := 0
LOCAL nDias     := 0
LOCAL dIni        := Date()-30
LOCAL dFim        := Date()
LOCAL AtPrompt := { "Individual ", "Por Regiao", "Por Cidade", "Por Estado", "Geral", "Data Abertura", "Quantitativo de Clientes", "Com Debito e Negativado SPC", "Sem Debito e Negativado SPC", "Com Debito e Positivado SPC", "Clientes com Contrato Ativo", "Clientes Com Contrato Vencido", "Clientes com Contrato Cancelado", "Ultima Compra" }
LOCAL aOrdem    := { "Ordem Nome", "Ordem Codigo", "Ordem Cidade+Nome", "Ordem Regiao", "Ordem Estado", "Ordem Fantasia"}
LOCAL aTipo     := { "Geral", "Por Regiao"}
LOCAL xAlias
LOCAL xNtx
LOCAL nTipo
LOCAL aStru
LOCAL cRegiaoIni
LOCAL cRegiaoFim

WHILE .T.
    xAlias := FTempName("T*.TMP")
    xNtx     := FTempName("T*.TMP")
    M_Title( "FICHA/RELACAO CLIENTES" )
    nChoice := FazMenu( 06, 20 ,    AtPrompt, Cor())
    Do Case
    Case nChoice = 0
        ResTela( cScreen )
        Exit

    Case nChoice = 1
        dbSelectArea( "Receber" )
        cCodi := Space(05)
        MaBox( 19 , 20 , 21 , 78 )
        SetCursor(1) ; DevPos( 20, 21 ) ; DevOut( "Cliente.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodi, "cCodi", "99999", {|| RecErrado( @cCodi,, Row(), Col()+1 )},))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        if LastKey( ) = 27
            ResTela( cScreen )
            Loop
        endif
        Receber->(Order( 2 ))
        if Receber->(!DbSeek( cCodi ))
            Alerta("Erro: Cliente nao Localizado.")
            ResTela( cScreen )
            Loop
        endif
        aStru := Receber->(DbStruct())
        DbCreate( xAlias, aStru )
        dbUseArea( .T.,, ( xAlias ), "xTemp", iif( .F. .OR. .T., ! .T., NIL ), .F. )
        xTemp->(DbAppend())
        For nField := 1 To FCount()
            xTemp->(FieldPut( nField, Receber->(FieldGet( nField ))))
        Next

    Case nChoice = 2
        cRegiao := Space( 02 )
        MaBox( 19 , 20 , 21 , 33 )
        SetCursor(1) ; DevPos( 20, 21 ) ; DevOut( "Regiao..:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cRegiao, "cRegiao", "@!", {|| RegiaoErrada( @cRegiao )},))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        if LastKey() = 27
            ResTela( cScreen )
            Loop
        endif
        Receber->(Order( 4 ))
        if Receber->(!DbSeek( cRegiao ))
            Alerta("Erro: Nenhum Cliente Registrado nesta Regiao.")
            ResTela( cScreen )
            Loop
        endif
        aStru := Receber->(DbStruct())
        DbCreate( xAlias, aStru )
        dbUseArea( .T.,, ( xAlias ), "xTemp", iif( .F. .OR. .T., ! .T., NIL ), .F. )
        WHILE Receber->Regiao = cRegiao
            xTemp->(DbAppend())
            For nField := 1 To FCount()
                xTemp->(FieldPut( nField, Receber->(FieldGet( nField ))))
            Next
            Receber->(DbSkip(1))
        EndDo

    Case nChoice = 3
        cCida := Space( 25 )
        MaBox( 19 , 20 , 21 , 56 )
        SetCursor(1) ; DevPos( 20, 21 ) ; DevOut( "Cidade..:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCida, "cCida", "@!",,))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        if LastKey() = 27
            ResTela( cScreen )
            Loop
        endif
        Receber->(Order( 3 ))
        if Receber->(!DbSeek( cCida ))
            Alerta("Erro: Nenhum Cliente Registrado nesta Cidade.")
            ResTela( cScreen )
            Loop
        endif
        aStru := Receber->(DbStruct())
        DbCreate( xAlias, aStru )
        dbUseArea( .T.,, (xAlias), "xTemp", iif( .F. .OR. .T., ! .T., NIL ), .F. )
        WHILE Receber->Cida = cCida
            xTemp->(DbAppend())
            For nField := 1 To FCount()
                xTemp->(FieldPut( nField, Receber->(FieldGet( nField ))))
            Next
            Receber->(DbSkip(1))
        Enddo

    Case nChoice = 4
        cEsta := Space( 02 )
        MaBox( 19 , 20 , 21 , 56 )
        SetCursor(1) ; DevPos( 20, 21 ) ; DevOut( "Estado..:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cEsta, "cEsta", "@!",,))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        if LastKey() = 27
            ResTela( cScreen )
            Loop
        endif
        Receber->(Order( 5 ))
        if Receber->(!DbSeek( cEsta ))
            ResTela( cScreen )
            Alerta("Erro: Nenhum Cliente Registrado neste Estado.")
            Loop
        endif
        aStru := Receber->(DbStruct())
        DbCreate( xAlias, aStru )
        dbUseArea( .T.,, ( xAlias ), "xTemp", iif( .F. .OR. .T., ! .T., NIL ), .F. )
        WHILE Receber->Esta = cEsta
            xTemp->(DbAppend())
            For nField := 1 To FCount()
                xTemp->(FieldPut( nField, Receber->(FieldGet( nField ))))
            Next
            Receber->(DbSkip(1))
        Enddo

    Case nChoice = 5
        dbSelectArea( "Receber" )
        Receber->(DbGoTop())

    Case nChoice = 6
        dIni          := Date()- 30
        dFim          := Date()
        cRegiaoIni := Space(02)
        cRegiaoFim := Space(02)
        MaBox( 18 , 20 , 23 , 78 )
        SetCursor(1) ; DevPos( 19, 21 ) ; DevOut( "Regiao Inicial...:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cRegiaoIni, "cRegiaoIni", "99", {|| RegiaoErrada( @cRegiaoIni )},))
        SetCursor(1) ; DevPos( 20, 21 ) ; DevOut( "Regiao Final.....:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cRegiaoFim, "cRegiaoFim", "99", {|| RegiaoErrada( @cRegiaoFim )},))
        SetCursor(1) ; DevPos( 21, 21 ) ; DevOut( "Abertura Inicial.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dIni, "dIni", "##/##/##",,))
        SetCursor(1) ; DevPos( 22, 21 ) ; DevOut( "Abertura Final...:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dFim, "dFim", "##/##/##", {|| if( dFim < dIni, ( ErrorBeep(), Alerta("Erro: Data final maior que inicial."), .F. ), .T. )},))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        if LastKey( ) = 27
            ResTela( cScreen )
            Loop
        endif
        ErrorBeep()
        if !Conf("Informa: Relatorio podera demorar. Continuar ?")
            ResTela( cScreen )
            Loop
        endif
        lAchou := .F.
        Receber->(Order( 4 ))
        For nX := Val( cRegiaoIni ) To Val( cRegiaoFim )
            if Receber->(DbSeek( StrZero( nX, 2 )))
                lAchou := .T.
                Exit
            endif
        Next
        if !lAchou
            ErrorBeep()
            Nada()
            Loop
        endif
        aStru := Receber->(DbStruct())
        DbCreate( xAlias, aStru )
        dbUseArea( .T.,, ( xAlias ), "xTemp", iif( .F. .OR. .T., ! .T., NIL ), .F. )
        Mensagem("Aguarde, Trabalhando Duro.")
        WHILE Receber->Regiao >= cRegiaoIni .AND. Receber->Regiao <= cRegiaoFim
            if Receber->Data >= dIni .AND. Receber->Data <= dFim
                xTemp->(DbAppend())
                For nField := 1 To FCount()
                    xTemp->(FieldPut( nField, Receber->(FieldGet( nField ))))
                Next
            endif
            Receber->(DbSkip(1))
        EndDo

    Case nChoice = 7
        ErrorBeep()
        if !Conf("Informa: Relatorio podera demorar. Continuar ?")
            ResTela( cScreen )
            Loop
        endif
        Receber->(Order( 2 ))
        Receber->(DbGoTop())
        aStru := Receber->(DbStruct())
        DbCreate( xAlias, aStru )
        dbUseArea( .T.,, ( xAlias ), "xTemp", iif( .F. .OR. .T., ! .T., NIL ), .F. )
        Mensagem("Aguarde, Trabalhando Duro.")
        WHILE Receber->(!Eof())
            xTemp->(DbAppend())
            For nField := 1 To FCount()
                xTemp->(FieldPut( nField, Receber->(FieldGet( nField ))))
            Next
            Receber->(DbSkip(1))
        EndDo

    Case nChoice = 8
        ErrorBeep()
        if !Conf("Informa: Relatorio podera demorar. Continuar ?")
            ResTela( cScreen )
            Loop
        endif
        Receber->(Order( 2 ))
        Receber->(DbGoTop())
        aStru := Receber->(DbStruct())
        DbCreate( xAlias, aStru )
        dbUseArea( .T.,, ( xAlias ), "xTemp", iif( .F. .OR. .T., ! .T., NIL ), .F. )
        Mensagem("Aguarde, Trabalhando Duro.")
        WHILE Receber->(!Eof())
            if Receber->Spc = .T.
                xTemp->(DbAppend())
                For nField := 1 To FCount()
                    xTemp->(FieldPut( nField, Receber->(FieldGet( nField ))))
                Next
            endif
            Receber->(DbSkip(1))
        EndDo

    Case nChoice = 9
        ErrorBeep()
        if !Conf("Informa: Relatorio podera demorar. Continuar ?")
            ResTela( cScreen )
            Loop
        endif
        Receber->(Order( 2 ))
        Receber->(DbGoTop())
        aStru := Receber->(DbStruct())
        DbCreate( xAlias, aStru )
        dbUseArea( .T.,, ( xAlias ), "xTemp", iif( .F. .OR. .T., ! .T., NIL ), .F. )
        Mensagem("Aguarde, Trabalhando Duro.")
        WHILE Receber->(!Eof())
            if Receber->Spc = .T.
                if Recemov->(!DbSeek( Receber->Codi ))
                    xTemp->(DbAppend())
                    For nField := 1 To FCount()
                        xTemp->(FieldPut( nField, Receber->(FieldGet( nField ))))
                    Next
                endif
            endif
            Receber->(DbSkip(1))
        EndDo

    Case nChoice = 10
        cCodi     := Space(05)
        cCodifim := Space(05)
        MaBox( 19 , 20 , 22 , 78 )
        SetCursor(1) ; DevPos( 20, 21 ) ; DevOut( "Do  Cliente.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodi, "cCodi", "99999", {|| RecErrado( @cCodi,, Row(), Col()+1 )},))
        SetCursor(1) ; DevPos( 21, 21 ) ; DevOut( "Ate Cliente.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodifim, "cCodifim", "99999", {|| RecErrado( @cCodifim,, Row(), Col()+1 )},))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        if LastKey( ) = 27
            ResTela( cScreen )
            Loop
        endif
        ErrorBeep()
        if !Conf("Informa: Relatorio podera demorar. Continuar ?")
            ResTela( cScreen )
            Loop
        endif
        Receber->(Order( 2 ))
        Receber->(DbGoTop())
        aStru  := Receber->(DbStruct())
        DbCreate( xAlias, aStru )
        dbUseArea( .T.,, ( xAlias ), "xTemp", iif( .F. .OR. .T., ! .T., NIL ), .F. )
        Mensagem("Aguarde, Trabalhando Duro.")
        if Receber->(DbSeek( cCodi ))
            WHILE Receber->Codi >= cCodi .AND. Receber->Codi <= cCodifim
                if Receber->Spc = .F.
                    if Recemov->(DbSeek( Receber->Codi ))
                        xTemp->(DbAppend())
                        For nField := 1 To FCount()
                            xTemp->(FieldPut( nField, Receber->(FieldGet( nField ))))
                        Next
                    endif
                endif
                Receber->(DbSkip(1))
            EndDo
        endif

    Case nChoice = 11
        M_Title( "FICHA/RELACAO CLIENTES-TIPO" )
        nTipo := FazMenu( 08, 22 , aTipo )
        Do Case
        Case nTipo = 0
            ResTela( cScreen )
            Loop
        Case nTipo = 1
            ErrorBeep()
            if !Conf("Informa: Relatorio podera demorar. Continuar ?")
                ResTela( cScreen )
                Loop
            endif
            Receber->(Order( 4 ))
            aStru := Receber->(DbStruct())
            DbCreate( xAlias, aStru )
            dbUseArea( .T.,, ( xAlias ), "xTemp", iif( .F. .OR. .T., ! .T., NIL ), .F. )
            Receber->(DbGoTop())
            WHILE Receber->(!Eof())
                if Receber->Suporte = .T.
                    xTemp->(DbAppend())
                    For nField := 1 To FCount()
                        xTemp->(FieldPut( nField, Receber->(FieldGet( nField ))))
                    Next
                endif
                Receber->(DbSkip(1))
            EndDo

        Case nTipo = 2
            cRegiao := Space( 02 )
            MaBox( 21 , 55 , 23 , 80 )
            SetCursor(1) ; DevPos( 22, 56 ) ; DevOut( "Regiao..:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cRegiao, "cRegiao", "@!", {|| RegiaoErrada( @cRegiao)},))
            ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
            if LastKey() = 27
                ResTela( cScreen )
                Loop
            endif
            ErrorBeep()
            if !Conf("Informa: Relatorio podera demorar. Continuar ?")
                ResTela( cScreen )
                Loop
            endif
            Receber->(Order( 4 ))
            if Receber->(!DbSeek( cRegiao ))
                Alerta("Erro: Nenhum Cliente Registrado nesta Regiao.")
                ResTela( cScreen )
                Loop
            endif
            aStru := Receber->(DbStruct())
            DbCreate( xAlias, aStru )
            dbUseArea( .T.,, ( xAlias ), "xTemp", iif( .F. .OR. .T., ! .T., NIL ), .F. )
            WHILE Receber->Regiao = cRegiao
                if Receber->Suporte = .T.
                    xTemp->(DbAppend())
                    For nField := 1 To FCount()
                        xTemp->(FieldPut( nField, Receber->(FieldGet( nField ))))
                    Next
                endif
                Receber->(DbSkip(1))
            EndDo

        EndCase
    Case nChoice = 12
        ErrorBeep()
        if !Conf("Informa: Relatorio podera demorar. Continuar ?")
            ResTela( cScreen )
            Loop
        endif
        Recemov->(Order( 2 ))
        Receber->(Order( 2 ))
        Receber->(DbGoTop())
        aStru := Receber->(DbStruct())
        DbCreate( xAlias, aStru )
        dbUseArea( .T.,, ( xAlias ), "xTemp", iif( .F. .OR. .T., ! .T., NIL ), .F. )
        Mensagem("Aguarde, Trabalhando Duro.")
        WHILE Receber->(!Eof())
            if Receber->Suporte = .T.
                lIncluir := .T.
                if Recemov->(DbSeek( Receber->Codi ))
                    While Recemov->Codi = Receber->Codi
                        if Recemov->Vcto >= Date()
                            lIncluir := .F.
                        endif
                        Recemov->(DbSkip(1))
                    EndDo
                endif
                if lIncluir = .T.
                    xTemp->(DbAppend())
                    For nField := 1 To FCount()
                        xTemp->(FieldPut( nField, Receber->(FieldGet( nField ))))
                    Next
                endif
            endif
            Receber->(DbSkip(1))
        EndDo

    Case nChoice = 13
        M_Title( "FICHA/RELACAO CLIENTES-TIPO" )
        nTipo := FazMenu( 08, 22 , aTipo )
        Do Case
        Case nTipo = 0
            ResTela( cScreen )
            Loop
        Case nTipo = 1
            ErrorBeep()
            if !Conf("Informa: Relatorio podera demorar. Continuar ?")
                ResTela( cScreen )
                Loop
            endif
            Receber->(Order( 4 ))
            aStru := Receber->(DbStruct())
            DbCreate( xAlias, aStru )
            dbUseArea( .T.,, ( xAlias ), "xTemp", iif( .F. .OR. .T., ! .T., NIL ), .F. )
            Receber->(DbGoTop())
            WHILE Receber->(!Eof())
                if Receber->Suporte = .F.
                    xTemp->(DbAppend())
                    For nField := 1 To FCount()
                        xTemp->(FieldPut( nField, Receber->(FieldGet( nField ))))
                    Next
                endif
                Receber->(DbSkip(1))
            EndDo

        Case nTipo = 2
            cRegiao := Space( 02 )
            MaBox( 21 , 55 , 23 , 80 )
            SetCursor(1) ; DevPos( 22, 56 ) ; DevOut( "Regiao..:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cRegiao, "cRegiao", "@!", {|| RegiaoErrada(@cRegiao)},))
            ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
            if LastKey() = 27
                ResTela( cScreen )
                Loop
            endif
            ErrorBeep()
            if !Conf("Informa: Relatorio podera demorar. Continuar ?")
                ResTela( cScreen )
                Loop
            endif
            Receber->(Order( 4 ))
            if Receber->(!DbSeek( cRegiao ))
                Alerta("Erro: Nenhum Cliente Registrado nesta Regiao.")
                ResTela( cScreen )
                Loop
            endif
            aStru := Receber->(DbStruct())
            DbCreate( xAlias, aStru )
            dbUseArea( .T.,, ( xAlias ), "xTemp", iif( .F. .OR. .T., ! .T., NIL ), .F. )
            WHILE Receber->Regiao = cRegiao
                if Receber->Suporte = .F.
                    xTemp->(DbAppend())
                    For nField := 1 To FCount()
                        xTemp->(FieldPut( nField, Receber->(FieldGet( nField ))))
                    Next
                endif
                Receber->(DbSkip(1))
            EndDo
        EndCase

    Case nChoice = 14
        oMenu:Limpa()
        dbSelectArea( "Receber" )
        nDias     := 0
        cDebitos := Space(1)
        cRegiao    := Space( 02 )
        MaBox( 10, 10, 14, 45 )
        SetCursor(1) ; DevPos( 11, 11 ) ; DevOut( "Regiao...................:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cRegiao, "cRegiao", "@!", {|| RegiaoErrada( @cRegiao )},))
        SetCursor(1) ; DevPos( 12, 11 ) ; DevOut( "Dias da Ultima Compra....:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nDias, "nDias", "999",,))
        SetCursor(1) ; DevPos( 13, 11 ) ; DevOut( "Imprimir se tem Debito...:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cDebitos, "cDebitos", "!", {|| cDebitos $ "SN"},))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        if LastKey() = 27 .OR. !Conf("Pergunta: Confirma Procura ?")
            ResTela( cScreen )
            Loop
        endif
        Receber->(Order( 4 ))
        if Receber->(!DbSeek( cRegiao ))
            Alerta("Erro: Nenhum Cliente Registrado nesta Regiao.")
            ResTela( cScreen )
            Loop
        endif
        ErrorBeep()
        lCancelado := Conf("Pergunta: Incluir Cancelados?")
        if !lCancelado
            if Receber->Cancelada
                Saidas->(DbSkip(1))
                Loop
            endif
        endif
        oMenu:Limpa()
        Mensagem("Aguarde, Varrendo Arquivo." )
        Recemov->(Order( 2 ))
        Receber->(Order( 4 ))
        Receber->(DbSeek( cRegiao ))
        aStru := Receber->(DbStruct())
        DbCreate( xAlias, aStru )
        dbUseArea( .T.,, ( xAlias ), "xTemp", iif( .F. .OR. .T., ! .T., NIL ), .F. )
        WHILE Receber->Regiao = cRegiao
            if !lCancelado
                if Receber->Cancelada
                    Receber->(DbSkip(1))
                    Loop
                endif
            endif
            cCodi := Receber->Codi
            if ( Date() - Receber->UltCompra ) >= nDias
                if cDebitos = "N"
                    if Recemov->(DbSeek( cCodi ))
                        Receber->(DbSkip(1))
                        Loop
                    endif
                endif
                xTemp->(DbAppend())
                For nField := 1 To FCount()
                    xTemp->(FieldPut( nField, Receber->(FieldGet( nField ))))
                Next
            endif
            Receber->(DbSkip(1))
        EndDo
    EndCase
    WHILE .T.
        oMenu:Limpa()
        M_Title("ESCOLHA A ORDEM A IMPRIMIR. ESC RETORNA")
        nOpcao := FazMenu( 05, 10, aOrdem )
        if nChoice <> 5
            if nOpcao = 0
                xTemp->(DbCloseArea())
                Ferase( xAlias )
                Ferase( xNtx )
                ResTela( cScreen )
                Exit
            elseif nOpcao = 1
                 Mensagem(" Aguarde, Ordenando Por Nome.")
                 dbSelectArea( "xTemp" )
                 ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Nome", {|| xTemp->Nome}, )
             elseif nOpcao = 2
                 Mensagem(" Aguarde, Ordenando Por Nome.")
                 dbSelectArea( "xTemp" )
                 ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Codi", {|| xTemp->Codi}, )
             elseif nOpcao = 3
                 Mensagem(" Aguarde, Ordenando Por Cidade+Nome.")
                 dbSelectArea( "xTemp" )
                 ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Cida + xTemp->Nome", {|| xTemp->Cida + xTemp->Nome}, )
             elseif nOpcao = 4
                 Mensagem(" Aguarde, Ordenando Por Regiao.")
                 dbSelectArea( "xTemp" )
                 ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Regiao", {|| xTemp->Regiao}, )
             elseif nOpcao = 5
                 Mensagem(" Aguarde, Ordenando Por Estado.")
                 dbSelectArea( "xTemp" )
                 ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Esta", {|| xTemp->Esta}, )
             elseif nOpcao = 6
                 Mensagem(" Aguarde, Ordenando Por Fantasia.")
                 dbSelectArea( "xTemp" )
                 ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Fanta", {|| xTemp->Fanta}, )
            endif
            xTemp->(DbGoTop())
        else
            if nOpcao = 0
                ResTela( cScreen )
                Exit
            endif
            dbSelectArea( "Receber" )
            Receber->(Order( nOpcao ))
            Receber->(DbGoTop())
        endif
        oMenu:Limpa()
        if !Instru80() .OR. !LptOk()
            ResTela( cScreen )
            Loop
        endif
        Mensagem("Aguarde, Imprimindo.")
        Prn009( nOpcao, nChoice, atPrompt )
        if nChoice <> 5
            xTemp->(DbClearIndex())
        endif
    EndDo
EndDo
ResTela( cScreen )
return



Proc Prn009( nOpcao, nChoice, atPrompt )

LOCAL cScreen      := SaveScreen()
LOCAL lSair       := .F.
LOCAL Tam          := 132
LOCAL Col          := 58
LOCAL Pagina      := 0
LOCAL cNome       := Space(0)
LOCAL cRegiao      := Regiao
LOCAL nTotal      := 0
LOCAL nCancel      := 0
LOCAL nTotRegiao := 0
LOCAL nCanRegiao := 0
LOCAL cTitulo
LOCAL cUltRegiao
FIELD Codi
FIELD Nome
FIELD Ende
FIELD Cida
FIELD Esta
FIELD Fone
FIELD Regiao

ErrorBeep()
Regiao->(Order( 1 ))
if Regiao->(DbSeek( cRegiao))
    cNome := Regiao->Nome
endif
Do Case
Case nChoice = 1
    cTitulo := "RELACAO INDIVIDUAL DE CLIENTES"
Case nChoice = 2
    cTitulo := "RELACAO DE CLIENTES DA REGIAO " + ltrim(rtrim(cNome))
Case nChoice = 3
    cTitulo := "RELACAO DE CLIENTES DA CIDADE DE " + Rtrim( Cida ) + "-" + Esta
Case nChoice = 4
    cTitulo := "RELACAO DE CLIENTES DO ESTADO DE " + esta
Case nChoice = 5
    cTitulo := "RELACAO GERAL DE CLIENTES"
Case nChoice = 6
    cTitulo := "RELACAO DE CLIENTES - DATA DE ABERTURA"
Case nChoice = 8
    cTitulo := "RELACAO GERAL DE CLIENTES COM DEBITO E NEGATIVADOS SPC"
Case nChoice = 9
    cTitulo := "RELACAO GERAL DE CLIENTES SEM DEBITO E NEGATIVADOS SPC"
Case nChoice = 10
    cTitulo := "RELACAO GERAL DE CLIENTES COM DEBITO E POSITIVADO SPC"
Case nChoice = 11
    cTitulo := "RELACAO DE " + Upper(atPrompt[nChoice])
Case nChoice = 13
    cTitulo := "RELACAO DE " + Upper(atPrompt[nChoice])
EndCase
PrintOn()
Fprint( PQ )
SetPrc( 0 , 0 )
cUltRegiao := Regiao
WHILE !Eof() .AND. Rel_Ok()
    if Col >= 57
        Pagina++
        Col := 0
        Write( Col ,  000, "Pagina N?" + StrZero( Pagina , 3 ))
        Write( Col ,  113, Dtoc( Date() ) + " - " + Time())

            Write( ++Col,  000, Repl( "=", Tam ))




        Write( ++Col,  000, Padc( cTitulo, Tam))
        Write( ++Col,  000, Repl( "=", Tam ))

            Write( ++Col,  000, "CODI  NOME                                     ENDERECO                       TORRE      CIDADE                    UF       TELEFONE")



        Write( ++Col,  000, Repl( "-", Tam ))
    endif

        Qout( Codi, Nome, Ende, Left( Fanta, 10), Cida, Esta, Fone )



    Col          ++
    nTotal      ++
    nTotRegiao ++
    if Cancelada
        nCancel      ++
        nCanRegiao ++
    endif
    DbSkip( 1 )
    if nOpcao = 4
        if cUltRegiao <> Regiao
            Qout( Repl( "-", Tam ))
            Qout(  Space(00), "** TOTAL REGIAO " + cUltRegiao + " : " + Tran( nTotRegiao,       "99999"))
            QQout( Space(06), "** ATIVAS :" + Tran( nTotRegiao-nCanRegiao, "99999"))
            QQout( Space(06), "** CANCELADAS :" + Tran( nCanRegiao,  "99999"))
            QQout( Space(07), "** STATUS : A=ATIVA|C=CANCELADA")
            Qout( Repl( "-", Tam ))
            Qout()
            Col          += 4
            nTotRegiao := 0
            nCanRegiao := 0
        endif
    endif
    cUltRegiao := Regiao
    if Col >= 55 .OR. Eof()
        Qout( Repl( "-", Tam ))
        if !Eof()
            Qout(  Space(00), "** SUB-TOTAL :" + Tran( nTotal,          "99999"))
        else
            Qout(  Space(00), "** TOTAL     :" + Tran( nTotal,          "99999"))
        endif

            Col += 2






        Qout( Repl( "-", Tam ))
      __Eject()
    endif
EndDo
PrintOff()
return(ResTela(cScreen))



Proc AltRegCfop()

LOCAL GetList := {}
LOCAL cScreen := SaveScreen()
LOCAL cRegiao := Space(02)
LOCAL aNatu   := {}
LOCAL aCfop   := {}
LOCAL aTxIcms := {}
LOCAL cCFop   := Space(05)
LOCAL nIcms   := 0
LOCAL cNatu   := ""
LOCAL oBloco
LOCAL cTela

WHILE .T.
    oMenu:Limpa()
    aNatu   := LerNatu()
    aCFop   := LerCfop()
    aTxIcms := LerIcms()
    cRegiao := Space(2)
    cCFop   := Space(05)
    MaBox( 13, 10, 16, 27 )
    SetCursor(1) ; DevPos( 14, 11 ) ; DevOut( "Regiao..:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cRegiao, "cRegiao", "99", {|| RegiaoErrada( @cRegiao )},))
    SetCursor(1) ; DevPos( 15, 11 ) ; DevOut( "Cfop....:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCFop, "cCFop", "9.999", {|| PickTam2( @aNatu, @aCfop, @aTxIcms, @cCfop, @cNatu, @nIcms )},))
    ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
    if LastKey() = 27
        ResTela( cScreen )
        return
    endif
    ErrorBeep()
    if Conf("Pergunta: Continuar com a alteracao ?")
        Receber->(Order( 4 ))
        oBloco  := {|| Receber->Regiao = cRegiao }
        if Receber->(!DbSeek( cRegiao ))
            ErrorBeep()
            Alerta("Erro: Nenhum cliente atende a condicao.")
            Loop
        endif
        cTela := Mensagem("Aguarde, Atualizando Registros")
        WHILE Eval( oBloco )
            if Receber->(TravaReg())
                Receber->Cfop      := cCfop
                Receber->Tx_Icms := nIcms
                Receber->(LIbera())
            endif
            Receber->(DbSkip(1))
        EndDo
        ResTela( cTela )
    endif
EndDo



Proc AltRegTitRec()

LOCAL GetList := {}
LOCAL cScreen := SaveScreen()
LOCAL cRegiao := Space(02)
LOCAL oBloco
LOCAL cTela

WHILE .T.
    oMenu:Limpa()
    MaBox( 13, 10, 15, 24 )
    cRegiao := Space(2)
    SetCursor(1) ; DevPos( 14, 11 ) ; DevOut( "Regiao..:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cRegiao, "cRegiao", "99", {|| RegiaoErrada( @cRegiao )},))
    ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
    if LastKey() = 27
        ResTela( cScreen )
        return
    endif
    ErrorBeep()
    if Conf("Pergunta: Continuar com a alteracao ?")
        Recemov->(Order( 2 ))
        Receber->(Order( 4 ))
        oBloco  := {|| Receber->Regiao = cRegiao }
        if Receber->(!DbSeek( cRegiao ))
            ErrorBeep()
            Alerta("Erro: Nenhum cliente atende a condicao.")
            Loop
        endif
        cTela := Mensagem("Aguarde, Atualizando Registros")
        WHILE Eval( oBloco )
            cCodi   := Receber->Codi
            if Recemov->(DbSeek( cCodi ))
                WHILE Recemov->Codi = cCodi
                    if Recemov->(TravaReg())
                        Recemov->Regiao := cRegiao
                        Recemov->(LIbera())
                        Recemov->(DbSkip(1))
                    endif
                EndDo
            endif
            Receber->(DbSkip(1))
        EndDo
        ResTela( cTela )
    endif
EndDo



Proc AltRegTitPag()

LOCAL GetList := {}
LOCAL cScreen := SaveScreen()
LOCAL cRegiao := Space(02)
LOCAL oBloco
LOCAL cTela

WHILE .T.
    oMenu:Limpa()
    MaBox( 13, 10, 15, 24 )
    cRegiao := Space(2)
    SetCursor(1) ; DevPos( 14, 11 ) ; DevOut( "Regiao..:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cRegiao, "cRegiao", "99", {|| RegiaoErrada( @cRegiao )},))
    ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
    if LastKey() = 27
        ResTela( cScreen )
        return
    endif
    ErrorBeep()
    if Conf("Pergunta: Continuar com a alteracao ?")
        Receber->(Order( 4 ))
        Recebido->(Order( 4 ))
        oBloco  := {|| Receber->Regiao = cRegiao }
        if Receber->(!DbSeek( cRegiao ))
            ErrorBeep()
            Alerta("Erro: Nenhum cliente atende a condicao.")
            Loop
        endif
        cTela := Mensagem("Aguarde, Atualizando Registros")
        WHILE Eval( oBloco )
            cCodi   := Receber->Codi
            if Recebido->(DbSeek( cCodi ))
                WHILE Recebido->Codi = cCodi
                    if Recebido->(TravaReg())
                        Recebido->Regiao := cRegiao
                        Recebido->(LIbera())
                        Recebido->(DbSkip(1))
                    endif
                EndDo
            endif
            Receber->(DbSkip(1))
        EndDo
        ResTela( cTela )
    endif
EndDo

Proc ReajTitulos()

LOCAL GetList := {}
LOCAL cScreen := SaveScreen()
LOCAL aMenu   := {"Individual","Por Fatura"}
LOCAL nChoice := 0

WHILE .T.
    oMenu:Limpa()
    M_Title("REAJUSTE DE TITULOS" )
    nChoice := FazMenu( 10, 10, aMenu )
    Do Case
    Case nChoice = 0
        ResTela( cScreen )
        return

    Case nChoice = 1
        ReajTitInd()

    Case nChoice = 2
        ReajTitFat()

    EndCase
EndDo

Proc ReajTitFat()

LOCAL cScreen    := SaveScreen()
LOCAL cFatuIni := Space(07)
LOCAL cFatuFim := Space(07)
LOCAL xCodigo    := 0
LOCAL nChoice    := 0
LOCAL nPorc     := 0
LOCAL lAchou    := .F.
LOCAL oBloco
LOCAL cFatura

WHILE .T.
    oMenu:Limpa()
    MaBox( 10, 10, 15, 79 )
    cFatuIni := Space(07)
    cFatuFim := Space(07)
    xCodigo    := 0
    nChoice    := 0
    nPorc     := 0
    SetCursor(1) ; DevPos( 11, 11 ) ; DevOut( "Fatura Inicial.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cFatuIni, "cFatuIni", "@!", {|| VisualAchaFatura( @cFatuIni )},))
    SetCursor(1) ; DevPos( 12, 11 ) ; DevOut( "Fatura Final...:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cFatuFim, "cFatuFim", "@!", {|| VisualAchaFatura( @cFatuFim )},))
    SetCursor(1) ; DevPos( 13, 11 ) ; DevOut( "Produto........:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( xCodigo, "xCodigo", "999999", {|| CodiErrado(@xCodigo,,, Row(), Col()+1)},))
    SetCursor(1) ; DevPos( 14, 11 ) ; DevOut( "Percentual.....:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nPorc, "nPorc", "999.9999", {|| nPorc <> 0},))
    ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
    if LastKey() = 27
        ResTela( cScreen )
        Exit
    endif
    oBloco := {|| Recemov->Fatura >= cFatuIni .AND. Recemov->Fatura <= cFatuFim }
    Saidas->(Order( 3 ))
    dbSelectArea( "Recemov" )
    Recemov->(Order( 4 ))
    ErrorBeep()
    if Conf("Pergunta: Deseja Continuar ?")
        lRedondo := .F.
        LETO_SET( 9, "on" )
        Recemov->(DbSeek( cFatuIni ))
        LETO_SET( 9, "off" )
        While Recemov->(Eval( oBloco ))
            cFatura := Recemov->Fatura
            lAchou := .F.
            if Saidas->(DbSeek( cFatura ))
                While Saidas->Fatura = cFatura
                    if Saidas->Codigo = xCodigo
                        lAchou                := .T.
                        Exit
                    endif
                    Saidas->(DbSkip(1))
                EndDo
            endif
            if lAchou
                if Saidas->(DbSeek( cFatura ))
                    While Saidas->Fatura = cFatura
                        if Saidas->(TravaReg())
                            nReajuste            := ( Saidas->VlrFatura * nPorc ) / 100
                            Saidas->VlrFatura += nReajuste
                            nReajuste            := ( Saidas->Pvendido  * nPorc ) / 100
                            Saidas->Pvendido    += nReajuste
                            Saidas->(Libera())
                            Saidas->(DbSkip(1))
                        endif
                    EndDo
                endif
                While Recemov->Fatura = cFatura
                    nReajuste := ( Recemov->Vlr * nPorc ) / 100
                    if Recemov->(TravaReg())
                        if lRedondo
                            Recemov->Vlr := Round( Recemov->Vlr + nReajuste, 2 )
                        else
                            Recemov->Vlr += nReajuste
                        endif
                        Recemov->(Libera())
                    endif
                    Recemov->(DbSkip(1))
                Enddo
                Recemov->(DbSkip(1))
            else
                Recemov->(DbSkip(1))
            endif
        Enddo
    endif
EndDo

Proc ReajTitInd()

LOCAL cScreen := SaveScreen()
LOCAL cCodi   := Space(05)
LOCAL nChoice := 0
LOCAL nPorc   := 0

WHILE .T.
    oMenu:Limpa()
    MaBox( 10, 10, 13, 79 )
    cCodi := Space( 05 )
    SetCursor(1) ; DevPos( 11, 11 ) ; DevOut( "Cliente....:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodi, "cCodi", "99999", {|| RecErrado( @cCodi, NIL, Row(), Col()+1 )},))
    SetCursor(1) ; DevPos( 12, 11 ) ; DevOut( "Percentual.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nPorc, "nPorc", "999.9999", {|| nPorc <> 0},))
    ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
    if LastKey() = 27
        ResTela( cScreen )
        Exit
    endif
    dbSelectArea( "Recemov" )
    Recemov->(Order( 2 ))
    if Recemov->(DbSeek( cCodi ))
        ErrorBeep()
        if Conf("Pergunta: Deseja Continuar ?")
            lRedondo := Conf("Pergunta: Arredondar Centavos ")
            While Recemov->Codi = cCodi
                nReajuste := ( Recemov->Vlr * nPorc ) / 100
                if Recemov->(TravaReg())
                    if lRedondo
                        Recemov->Vlr := Round( Recemov->Vlr + nReajuste, 2 )
                    else
                        Recemov->Vlr += nReajuste
                    endif
                    Recemov->(Libera())
                endif
                Recemov->(DbSkip(1))
            Enddo
        endif
    else
        ErrorBeep()
        Alerta("Erro: Cliente Sem Movimento.")
        Loop
    endif
EndDo

Proc RelRecSeletiva()

LOCAL GetList     := {}
LOCAL cScreen     := SaveScreen()
LOCAL aTipo      := {"Normal", "Total"}
LOCAL aReg         := {}
LOCAL aCodi      := {}
LOCAL xReg         := {}
LOCAL dAtual     := Date()
LOCAL cCodi      := Space(04)
LOCAL cCodiVen  := Space(04)
LOCAL cNomeVen  := ""
LOCAL nChoice     := 0
LOCAL nTam         := 0
LOCAL nX          := 0
LOCAL lTotal     := .F.
LOCAL lSeletiva := .T.
LOCAL cTitulo     := ""
LOCAL lSemLoop  := .T.

WHILE .T.
    cCodi := Space(05)
    MaBox( 13 , 18 , 15 , 77 )
    SetCursor(1) ; DevPos( 14, 19 ) ; DevOut( "Cliente.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodi, "cCodi", "99999", {|| RecErrado( @cCodi,, Row(), Col()+1 )},))
    ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
    if LastKey() = 27
        if Len( aCodi ) = 0
            ResTela( cScreen )
            return
        endif
        ErrorBeep()
        if Conf("Pergunta: Deseja Cancelar a Selecao ?")
            ResTela( cScreen )
            return
        endif
        Exit
    endif
    __Keyboard( Chr( 13 ) )
    xReg := {}
    xReg := EscolheTitulo( cCodi, lSemLoop )
    if Len( xReg ) <> 0
        if Ascan( aCodi, cCodi ) = 0
            Aadd( aCodi, cCodi )
        endif
        For nX := 1 To Len( xReg )
            Aadd( aReg, xReg[nX])
        Next
    endif
EndDo
nTam := Len( aCodi )
if nTam = 0
    ResTela( cScreen )
    return
endif
MaBox(16, 18, 18, 77 )
cCodiVen := Space( 04 )
SetCursor(1) ; DevPos( 17, 19 ) ; DevOut( "Cobrador:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodiVen, "cCodiVen", "9999", {|| FunErrado( @cCodiVen,, Row(), Col()+1, @cNomeVen )},))
ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
if LastKey() = 27
    ErrorBeep()
    if Conf("Pergunta: Deseja Cancelar a Selecao ?")
        ResTela( cScreen )
        return
    endif
endif
cTitulo := "RELACAO DE COBRANCA SELETIVA DO COBRADOR: "
cTitulo += ltrim(rtrim(cNomeVen))
MaBox( 19 , 18 , 21, 42 )
SetCursor(1) ; DevPos( 20, 19 ) ; DevOut( "Data Calculo.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dAtual, "dAtual", "##/##/##",,))
ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
if LastKey() = 27
    ErrorBeep()
    if Conf("Pergunta: Deseja Cancelar a Selecao ?")
        ResTela( cScreen )
        return
    endif
endif
M_Title("TIPO")
nChoice := FazMenu( 19, 43,  aTipo, Cor() )
if nChoice = 0
    ErrorBeep()
    if Conf("Pergunta: Deseja Cancelar a Selecao ?")
        ResTela( cScreen )
        return
    endif
endif
lTotal := nChoice = 2
Receber->( Order( 2 ))
ErrorBeep()
if !InsTru80() .OR. !LptOk()
    ResTela( cScreen )
    return
endif
Prn002Cob( cTitulo, NIL, NIL, dAtual, aCodi, cCodiVen, lTotal, lSeletiva, aReg )
ResTela( cScreen )
return



Proc CartaSpc()

LOCAL GetList      := {}
LOCAL cScreen      := SaveScreen()
LOCAL aMenuArray := { "Modelo Antigo", "Modelo Novo"}
LOCAL xDbf          := FTempName("T*.TMP")
LOCAL dIni          := Date()-30
LOCAL dFim          := Date()
LOCAL nChoice      := 0
LOCAL nTamForm   := 33
LOCAL i              := 0
LOCAL _QtDup      := 0
LOCAL aReg
LOCAL aStru
LOCAL cCodi
FIELD Codi
FIELD Vcto

WHILE .T.
    M_Title("NEGATIVAR CLIENTES NO SPC")
    nChoice := FazMenu( 03 , 10, aMenuArray )
    Do Case
    Case nChoice  = 0
        ResTela( cScreen )
        return

    Case nChoice  = 1
        cCodi     := Space(05)
        dIni        := Date()-30
        dFim        := Date()
        nTamForm := 33
        MaBox( 09 , 10, 14 , 40 )
        SetCursor(1) ; DevPos( 10, 11 ) ; DevOut( "Cliente..........:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodi, "cCodi", "99999", {|| RecErrado( @cCodi )},))
        SetCursor(1) ; DevPos( 11, 11 ) ; DevOut( "Vcto Inicial.....:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dIni, "dIni", "##/##/##",,))
        SetCursor(1) ; DevPos( 12, 11 ) ; DevOut( "Vcto Final.......:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dFim, "dFim", "##/##/##",,))
        SetCursor(1) ; DevPos( 13, 11 ) ; DevOut( "Comp Formulario..:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nTamForm, "nTamForm", "99", {|| nTamForm = 33 .OR. nTamForm = 66},))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        if LastKey() = 27
            ResTela( cScreen    )
            Loop
        endif
        dbSelectArea( "ReceMov" )
        Recemov->(Order( 2 ))
        if Recemov->(!DbSeek( cCodi ))
            ErrorBeep()
            Nada()
            ResTela( cScreen )
            Loop
        endif
        __dbCopyStruct( ( xDbf ), { } )
        dbUseArea( .T.,, (xDbf), "xTemp", iif( .F. .OR. .T., ! .T., NIL ), .F. )
        WHILE Recemov->Codi = cCodi
            if Recemov->Vcto >= dIni .AND. Recemov->Vcto <= dFim
                xTemp->(DbAppend())
                For nField := 1 To FCount()
                    xTemp->( FieldPut( nField, Recemov->(FieldGet( nField ))))
                Next
            endif
            Recemov->(DbSkip(1))
        EndDo
        Receber->( Order( 2 ))
        xTemp->(DbGoTop())
        if ( ! .F. ) ; dbClearRelation() ; end ; dbSetRelation( "Receber", {|| xTemp->Codi}, "xTemp->Codi", .F. )
        xTemp->(DbGoTop())
        CartaSpcOld( nTamForm )
        Mensagem("Aguarde, Excluindo Arquivo Temporario.")
        xTemp->(DbClearRel())
        xTemp->(DbGoTop())
        xTemp->(DbCloseArea())
        Ferase( xDbf )
        ResTela( cScreen )
        Loop

    Case nChoice  = 2
        cCodi      := Space(05)
        aReg         := {}
        aReg         := EscolheTitulo( cCodi )
        if ( _QtDup := Len( aReg )) = 0
            ResTela( cScreen )
            Loop
        endif
        dbSelectArea( "Recemov" )
        Recemov->(Order( 2 ))
        aStru := Recemov->(DbStruct())
        Aadd( aStru, {"QTD",  "N", 3, 0})
        DbCreate( xDbf, aStru )
        dbUseArea( .T.,, (xDbf), "xTemp", iif( .F. .OR. .T., ! .T., NIL ), .F. )
        FOR i :=  1 TO _qtdup
            Recemov->(DbGoto( aReg[i] ))
            xTemp->(DbAppend())
            For nField := 1 To FCount()
                xTemp->( FieldPut( nField, Recemov->(FieldGet( nField ))))
            Next
            xTemp->Qtd ++
        Next
        nTamForm := 33
        Receber->( Order( 2 ))
        xTemp->(DbGoTop())
        if ( ! .F. ) ; dbClearRelation() ; end ; dbSetRelation( "Receber", {|| xTemp->Codi}, "xTemp->Codi", .F. )
        xTemp->(DbGoTop())
        CartaSpcNew( nTamForm )
        Mensagem("Aguarde, Excluindo Arquivo Temporario.")
        xTemp->(DbClearRel())
        xTemp->(DbGoTop())
        xTemp->(DbCloseArea())
        Ferase( xDbf )
        ResTela( cScreen )
        Loop
    EndCase
EndDo

Proc CartaSpcOld( nTamForm )

LOCAL GetList     := {}
LOCAL cScreen     := SaveScreen()
LOCAL NovoNome  := .T.
LOCAL Tam         := 80
LOCAL cVar1
LOCAL cVar2
LOCAL UltNome
LOCAL Col
FIELD Codi
FIELD Vcto
FIELD Vlr
FIELD Docnr
FIELD Emis
FIELD Juro
FIELD Cida
FIELD JuroDia

WHILE .T.
    xTemp->(DbGoTop())
    Recemov->(Order( 1 ))
    if !InsTru80()
        ResTela( cScreen    )
        return
    endif
    oMenu:Limpa()
    Mensagem("Aguarde, Imprimindo. ESC Cancela.")
    UltNome    := Receber->Nome
    PrintOn()
    FPrInt( Chr(27) + "C" + Chr( nTamForm ))
    SetPrc(0,0)
    WHILE !Eof() .AND. Rel_Ok()
        if Recemov->(DbSeek( xTemp->Docnr ))
            if Recemov->(TravaReg())
                Recemov->Port := "SPC"
                Recemov->(Libera())
            endif
        endif
        if NovoNome
            if Receber->(TravaReg())
                Receber->Spc      := .T.
                Receber->DataSpc := Date()
                Receber->(Libera())
            endif
            if Receber->Cgc = "  .   .   /    -  " .OR. Receber->Cgc = Space( 18 )
                cVar1 := Receber->Cpf
                cVar2 := Receber->Rg
            else
                cVar1 := Receber->Cgc
                cVar2 := Receber->Insc
            endif
            NovoNome := .F.
            Qout( Repl("=", Tam ))
            Qout( Padc("SPC - SISTEMA DE PROTECAO AO CREDITO",Tam ))
            Qout( Repl("=", Tam ))
            Qout(  "Codigo no SPC..:", "______")
         Qout(  "Empresa........:", ltrim(rtrim(oAmbiente:xNomefir)) )
            Qout(  "Nome do Cliente:", NG + Receber->Codi, Receber->Nome, NR)
            Qout(  "Data Nascimento:", Receber->Nasc )
            QQout( Space(16), "Est. Civil:", Receber->Civil )
            Qout(  "Cpf/Cgc........:", cVar1 )
            QQout( Space(10), "Insc/Rg...:", cVar2 )
            Qout(  "Conjuge........:", Receber->Esposa )
            Qout(  "Endereco.......:", Receber->Ende )
            Qout(  "Cidade/Uf......:", ltrim(rtrim(Receber->Cida)) + " - " + Receber->Esta )
            Qout(  "Profissao......:", Receber->Profissao )
            Qout(  "Firma..........:", Receber->Trabalho )
            Qout(  "Nome Mae.......:", Receber->Mae )
            Qout(  "Nome Pai.......:", Receber->Pai )
            Qout()
            Qout( Padc( Repl("_",22) + "P R O T O C O L O  D E  E N T R E G A" + Repl("_",21),Tam ))
            Qout( "DOCTO N?      EMISSAO   TIPO                    VALOR     DT VCTO    DATA ENVIO")
            Col := 18
        endif
        Qout( Docnr, Space(03), Emis, Space(03), Tipo, Space(03), Tran( Vlr,"@E 9,999,999,999.99"), Space(03), Vcto, Space(03), Date())
        Col++
        UltNome := Receber->Nome
        DbSkip(1)
        if Col >= ( nTamForm - 10 ) .OR. UltNome <> Receber->Nome .OR. Eof()
            NovoNome := .T.
            Qout( Repl("=", Tam ))
            Qout( Padl("CARIMBO E ASSINATURA DA EMPRESA", Tam ))
            __Eject()
        endif
    EndDo
    PrintOff()
    ResTela( cScreen )
EndDO



Proc CartaSpcNew( nTamForm )

LOCAL GetList     := {}
LOCAL cScreen     := SaveScreen()
LOCAL NovoNome  := .T.
LOCAL Tam         := 80
LOCAL cVar1
LOCAL cVar2
LOCAL UltNome
LOCAL Col
FIELD Codi
FIELD Vcto
FIELD Vlr
FIELD Docnr
FIELD Emis
FIELD Juro
FIELD Cida
FIELD JuroDia

WHILE .T.
    xTemp->(DbGoTop())
    Recemov->(Order( 1 ))
    if !InsTru80()
        ResTela( cScreen    )
        return
    endif
    oMenu:Limpa()
    Mensagem("Aguarde, Imprimindo. ESC Cancela.")
    UltNome    := Receber->Nome
    PrintOn()
    FPrInt( Chr(27) + "C" + Chr( nTamForm ))
    SetPrc(0,0)
    WHILE !Eof() .AND. Rel_Ok()
        if Recemov->(DbSeek( xTemp->Docnr ))
            if Recemov->(TravaReg())
                Recemov->Port := "SPC"
                Recemov->(Libera())
            endif
        endif
        if NovoNome
            if Receber->(TravaReg())
                Receber->Spc      := .T.
                Receber->DataSpc := Date()
                Receber->(Libera())
            endif
            if Receber->Cgc = "  .   .   /    -  " .OR. Receber->Cgc = Space( 18 )
                cVar1 := Receber->Cpf
                cVar2 := Receber->Rg
            else
                cVar1 := Receber->Cgc
                cVar2 := Receber->Insc
            endif
            NovoNome := .F.
            Qout( Repl("=", Tam ))
            Qout( Padc("SPC - SISTEMA DE PROTECAO AO CREDITO",Tam ))
            Qout( Repl("=", Tam ))
            Qout(  "Codigo no SPC..:", "______")
         Qout(  "Empresa........:", ltrim(rtrim(oAmbiente:xNomefir)) )
            Qout(  "Nome do Cliente:", NG + Receber->Codi, Receber->Nome, NR)
            Qout(  "Data Nascimento:", Receber->Nasc )
            QQout( Space(16), "Est. Civil:", Receber->Civil )
            Qout(  "Cpf/Cgc........:", cVar1 )
            QQout( Space(10), "Insc/Rg...:", cVar2 )
            Qout(  "Conjuge........:", Receber->Esposa )
            Qout(  "Endereco.......:", Receber->Ende )
            Qout(  "Cidade/Uf......:", ltrim(rtrim(Receber->Cida)) + " - " + Receber->Esta )
            Qout(  "Profissao......:", Receber->Profissao )
            Qout(  "Firma..........:", Receber->Trabalho )
            Qout(  "Nome Mae.......:", Receber->Mae )
            Qout(  "Nome Pai.......:", Receber->Pai )
            Qout()
            Qout( Padc( Repl("_",22) + "P R O T O C O L O  D E  E N T R E G A" + Repl("_",21),Tam ))
            Qout( "DATA ENVIO      DOCTO N?   N?DE PREST SALDO EM ATRASO          DESDE")
            Col := 18
        endif
        Qout( Date(), Space(5), Docnr, Space(5), StrZero( Qtd, 3), Space(7), Tran( Vlr,"@E 9,999,999.99"), Space(5), Vcto )
        Col++
        UltNome := Receber->Nome
        DbSkip(1)
        if Col >= ( nTamForm - 10 ) .OR. UltNome <> Receber->Nome .OR. Eof()
            NovoNome := .T.
            Qout( Repl("=", Tam ))
            Qout( Padl("CARIMBO E ASSINATURA DA EMPRESA", Tam ))
            __Eject()
        endif
    EndDo
    PrintOff()
    ResTela( cScreen )
EndDO

Proc ImpExpGetDados()

LOCAL cScreen := SaveScreen()
LOCAL aTipo   := {"Exportacao Recebido", "Importacao Recebido"}

WHILE .T.
    oMenu:Limpa()
    M_Title("ESCOLHA O TIPO")
    nTipo := FazMenu( 05, 08, aTipo )
    Do Case
    Case nTipo = 0
        ResTela( cScreen )
        return
    Case nTipo = 1
        ExportaRecebido()
    Case nTipo = 2
        ImportaRecebido()
    EndCase
EndDo

Proc ExportaRecebido()

LOCAL GetList := {}
LOCAL cScreen := SaveScreen()
LOCAL dIni      := Date()-30
LOCAL dFim      := Date()
LOCAL aStru   := {}
LOCAL nField  := 0
LOCAL oBloco  := {|| !Exportado }
LOCAL bBloco  := {|| Recebido->Baixa >= dIni .AND. Recebido->Baixa <= dFim }
LOCAL cReIni
LOCAL cReFim
LOCAL xBid

oMenu:Limpa()
dIni := Date()-30
dFim := Date()
MaBox( 11, 10, 14, 40 )
SetCursor(1) ; DevPos( 12, 11 ) ; DevOut( "Data Baixa Inicial." ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dIni, "dIni", "##/##/##",,))
SetCursor(1) ; DevPos( 13, 11 ) ; DevOut( "Data Baixa Final..." ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dFim, "dFim", "##/##/##", {|| dFim >= dIni},))
ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
if LastKey() = 27
    return
endif
xBid    := FTempName("BID?????.REM")
aStru := Recebido->(DbStruct())
DbCreate( xBid, aStru )
dbUseArea( .T.,, (xBid), "xRecebido", iif( .F. .OR. .T., ! .T., NIL ), .F. )
dbSelectArea( "Recebido" )
Recebido->(Order( 8 ))
Recebido->(DbSeek( dIni ))
Mensagem("Aguarde, Exportando Recebido.")
While Recebido->(Eval( bBloco )) .AND. Recebido->(!Eof()) .AND. Rep_Ok()
    if Eval( oBloco )
        xRecebido->(DbAppend())
        For nField := 1 To FCount()
            xRecebido->( FieldPut( nField, Recebido->(FieldGet( nField ))))
        Next
        if Recebido->(TravaReg())
            Recebido->Exportado := .T.
            Recebido->(Libera())
        endif
    endif
    Recebido->(DbSkip(1))
EndDo
xRecebido->(DbGoTop())
if xRecebido->(Eof())
    xRecebido->(DbCloseArea())
    Ferase( xBid )
    Nada()
    ResTela( cScreen )
    return
endif
xRecebido->(DbCloseArea())
ResTela( cScreen )
return

Proc ImportaRecebido()

    LOCAL GetList    := {}
    LOCAL cScreen    := SaveScreen()
    LOCAL cFiles    := "BID*.REM"
    LOCAL Arq_Ant    := Alias()
    LOCAL Ind_Ant    := IndexOrd()
    LOCAL dIni
    LOCAL dFim
    LOCAL xArquivo
    LOCAL xNtx

    oMenu:Limpa()
    M_Title("ESCOLHA ARQUIVO DE RECEBIDO PARA IMPORTACAO")
    xArquivo := Mx_PopFile( 05, 10, 20, 74, cFiles )
    if Empty( xArquivo )
        ErrorBeep()
        ResTela( cScreen )
        return
    endif
    Mensagem("Aguarde, Importando Arquivo Recebido.")
    dbSelectArea( "Recebido" )
    __dbApp( ( xArquivo ), { },,,,, .F.,,, )
    dbUseArea( .T.,, (xArquivo), "xRecebido", iif( .F. .OR. .T., ! .T., NIL ), .F. )
    Recemov->(Order( 1 ))
    dbSelectArea( "xRecebido" )
    Mensagem("Aguarde, Indexando Arquivo Importado.")
    ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( (xNtx),, "xRecebido->DataPag", {|| xRecebido->DataPag}, )
    xRecebido->(DbGoBottom())
    dFim := xRecebido->DataPag
    xRecebido->(DbGoTop())
    dIni := xRecebido->DataPag
    Mensagem("Aguarde, Baixando Registro Importados.")
    While xRecebido->(!Eof())
        cDocnr := xRecebido->Docnr
        if Recemov->(DbSeek( cDocnr ))
            if Recemov->(Travareg())
                Recemov->(DbDelete())
            endif
            Recemov->(Libera())
        endif
        xRecebido->(DbSkip(1))
    EndDo
    xRecebido->(DbCloseArea())
    Ferase( xNtx )
    xTemp := StrTran( xArquivo, ".REM")
    FRename( xArquivo, xTemp + ".IMP")
    RecebidoCx("0000","0001", dIni, dFim )
    ResTela(cScreen )
    return

Proc CancelaContrato()

LOCAL cScreen    := SaveScreen()
LOCAL cCodi     := Space(05)
LOCAL cFatura    := Space(07)
LOCAL cObs        := Space(40)
LOCAL dData     := Date()

WHILE .T.
    oMenu:Limpa()
    MaBox( 13, 05, 17, 78 )
    cCodi   := Space(05)
    cFatura := Space(07)
    SetCursor(1) ; DevPos( 14, 06 ) ; DevOut( "Fatura............:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cFatura, "cFatura", "@!", {|| VisualAchaFatura( @cFatura)},))
    SetCursor(1) ; DevPos( 15, 06 ) ; DevOut( "Data Cancelamento.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dData, "dData", "##/##/##", {|| !Empty( dData )},))
    SetCursor(1) ; DevPos( 16, 06 ) ; DevOut( "Motivo............:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cObs, "cObs", "@!",,))
    ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
    if LastKey() = 27
        ResTela( cScreen )
        return
    endif
    Receber->(Order( 2 ))
    Recemov->(Order( 4 ))
    if Conf("Pergunta: Confirma Cancelamento ?")
        WHILE Recemov->(DbSeek( cFatura ))
            cCodi := Recemov->Codi
            Receber->(DbSeek( cCodi ))
            if Recebido->(Incluiu())
                Recebido->Codi      := cCodi
                Recebido->Regiao     := Receber->Regiao
                Recebido->Docnr     := Recemov->Docnr
                Recebido->Emis      := Recemov->Emis
                Recebido->Vcto      := Recemov->Vcto
                Recebido->Baixa     := Date()
                Recebido->Vlr         := Recemov->Vlr
                Recebido->DataPag  := dData
                Recebido->VlrPag     := 0
                Recebido->Port      := Recemov->Port
                Recebido->Tipo      := Recemov->Tipo
                Recebido->Juro      := Recemov->Juro
                Recebido->NossoNr  := Recemov->NossoNr
                Recebido->Bordero  := Recemov->Bordero
                Recebido->Fatura     := Recemov->Fatura
                Recebido->Obs         := cObs
                Recebido->Parcial  := "Q"
                Recebido->(Libera())
                Recebido->(Libera())
                if Recemov->(TravaReg())
                    Recemov->(DbDelete())
                    Recemov->(Libera())
                endif
            endif
        EndDo
    endif
EndDo

Proc TrocaCliente(cCaixa)

LOCAL GetList := {}
LOCAL cScreen := SaveScreen()
LOCAL aMenu   := {"Por Fatura","Por Cliente"}
LOCAL nChoice := 0

WHILE .T.
    oMenu:Limpa()
    M_Title("TROCA DE FATURA" )
    nChoice := FazMenu( 03, 20, aMenu )
    Do Case
    Case nChoice = 0
        ResTela( cScreen )
        return

    Case nChoice = 1
        TrClifatura( cCaixa )

    Case nChoice = 2
        TrCliIndividual( cCaixa )

    EndCase
EndDo

Proc TrClifatura(cCaixa)

LOCAL cScreen    := SaveScreen()
LOCAL cCodi     := Space(05)
LOCAL cFatura    := Space(07)
LOCAL cObs        := Space(40)
LOCAL dData     := Date()

WHILE .T.
    oMenu:Limpa()
    MaBox( 13, 05, 16, 78 )
    cCodi   := Space(05)
    cFatura := Space(07)
    SetCursor(1) ; DevPos( 14, 06 ) ; DevOut( "Fatura.......:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cFatura, "cFatura", "@!", {|| VisualAchaFatura( @cFatura)},))
    SetCursor(1) ; DevPos( 15, 06 ) ; DevOut( "Novo Cliente.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodi, "cCodi", "99999", {|| RecErrado( @cCodi,, Row(), Col()+1 )},))
    ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
    if LastKey() = 27
        ResTela( cScreen )
        return
    endif
    Recebido->(Order( 3 ))
    Recemov->(Order( 4 ))
    Saidas->(Order( 3 ))
    Nota->(Order( 1 ))
    Vendemov->(Order( 4 ))
    Recibo->(Order( 10))
    if Conf("Pergunta: Confirma Alteracao?")
        Mensagem("Informa: Aguarde...")
        if Recemov->(DbSeek( cFatura ))
            WHILE Recemov->Fatura = cFatura
                if Recemov->(TravaReg())
                    Recemov->Codi = cCodi
                    Recemov->(Libera())
                    Recemov->(DbSkip(1))
                endif
            EndDo
        endif
        if Recebido->(DbSeek( cFatura ))
            WHILE Recebido->Fatura = cFatura
                if Recebido->(TravaReg())
                    Recebido->Codi = cCodi
                    Recebido->(Libera())
                    Recebido->(DbSkip(1))
                endif
            EndDo
        endif
        if Saidas->(DbSeek( cFatura ))
            WHILE Saidas->Fatura = cFatura
                if Saidas->(TravaReg())
                    Saidas->Codi         = cCodi
                    Saidas->Situacao     = "ALTERADA"
                    Saidas->Atualizado = Date()
                    Saidas->Caixa         = cCaixa
                    Saidas->(Libera())
                    Saidas->(DbSkip(1))
                endif
            EndDo
        endif
        if Nota->(DbSeek( cFatura ))
            WHILE Nota->Numero = cFatura
                if Nota->(TravaReg())
                    Nota->Codi          = cCodi
                    Nota->Situacao   = "ALTERADA"
                    Nota->Atualizado = Date()
                    Nota->Caixa       = cCaixa
                    Nota->(Libera())
                    Nota->(DbSkip(1))
                endif
            EndDo
        endif
        if Vendemov->(DbSeek( cFatura ))
            WHILE Vendemov->Fatura = cFatura
                if Vendemov->(TravaReg())
                    Vendemov->Codi = cCodi
                    Vendemov->(Libera())
                    Vendemov->(DbSkip(1))
                endif
            EndDo
        endif
        if Recibo->(DbSeek( cFatura ))
            WHILE Recibo->Fatura = cFatura
                if Recibo->(TravaReg())
                    Recibo->Codi = cCodi
                    Recibo->(Libera())
                    Recibo->(DbSkip(1))
                endif
            EndDo
        endif
    endif
EndDo

Proc TrCliIndividual(cCaixa)

LOCAL cScreen    := SaveScreen()
LOCAL cVelho    := Space(05)
LOCAL cCodi     := Space(05)
LOCAL cFatura    := Space(07)
LOCAL cObs        := Space(40)
LOCAL dData     := Date()

WHILE .T.
    oMenu:Limpa()
    MaBox( 13, 05, 16, 78 )
    cVelho  := Space(05)
    cCodi   := Space(05)
    cFatura := Space(07)
    SetCursor(1) ; DevPos( 14, 06 ) ; DevOut( "Cliente Velho.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cVelho, "cVelho", "99999", {|| RecErrado( @cVelho,, Row(), Col()+1 )},))
    SetCursor(1) ; DevPos( 15, 06 ) ; DevOut( "Cliente Novo..:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodi, "cCodi", "99999", {|| RecErrado( @cCodi,,Row(),Col()+1 )},))
    ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
    if LastKey() = 27
        ResTela( cScreen )
        return
    endif
    Recebido->(Order( 3 ))
    Recemov->(Order( 4 ))
    Saidas->(Order( 3 ))
    Vendemov->(Order( 4 ))
    Nota->(Order( 2 ))
    Recibo->(Order( 10 ))
    if Conf("Pergunta: Confirma Alteracao?")
        Mensagem("Informa: Aguarde...")
        if Nota->(!DbSeek( cVelho ))
            ErrorBeep()
            Alerta("Erro: Nenhuma fatura encontrada.")
            Loop
        endif
        Nota->(Order( 2 ))
        WHILE Nota->(DbSeek( cVelho ))
            cFatura := Nota->Numero
            if Recemov->(DbSeek( cFatura ))
                WHILE Recemov->Fatura = cFatura
                    if Recemov->(TravaReg())
                        Recemov->Codi = cCodi
                        Recemov->(Libera())
                      Recemov->(DbSkip(1))
                    endif
                EndDo
            endif
            if Recebido->(DbSeek( cFatura ))
                WHILE Recebido->Fatura = cFatura
                    if Recebido->(TravaReg())
                        Recebido->Codi = cCodi
                        Recebido->(Libera())
                        Recebido->(DbSkip(1))
                    endif
                EndDo
            endif
            if Saidas->(DbSeek( cFatura ))
                WHILE Saidas->Fatura = cFatura
                    if Saidas->(TravaReg())
                        Saidas->Codi         = cCodi
                        Saidas->Situacao     = "ALTERADA"
                        Saidas->Atualizado = Date()
                        Saidas->Caixa         = cCaixa
                        Saidas->(Libera())
                        Saidas->(DbSkip(1))
                    endif
                EndDo
            endif
            Nota->(Order( 1 ))
            if Nota->(DbSeek( cFatura ))
                WHILE Nota->Numero = cFatura
                    if Nota->(TravaReg())
                        Nota->Codi          = cCodi
                        Nota->Situacao   = "ALTERADA"
                        Nota->Atualizado = Date()
                        Nota->Caixa       = cCaixa
                        Nota->(Libera())
                        Nota->(DbSkip(1))
                    endif
                EndDo
            endif
            Nota->(Order( 2 ))
            if Vendemov->(DbSeek( cFatura ))
                WHILE Vendemov->Fatura = cFatura
                    if Vendemov->(TravaReg())
                        Vendemov->Codi = cCodi
                        Vendemov->(Libera())
                        Vendemov->(DbSkip(1))
                  endif
                EndDo
            endif
            Recibo->(Order( 10 ))
            if Recibo->(DbSeek( cFatura ))
                WHILE Recibo->Fatura = cFatura
                    if Recibo->(TravaReg())
                        Recibo->Codi = cCodi
                        Recibo->(Libera())
                        Recibo->(DbSkip(1))
                  endif
                EndDo
            endif
        EndDo
    endif
EndDo

Proc RolPagarPago()

LOCAL cScreen      := SaveScreen()
LOCAL cFatuIni   := Space(07)
LOCAL cFatuFim   := Space(07)
LOCAL nChoice      := 0
LOCAL nPorc       := 0
LOCAL nVlrFatura := 0
LOCAL nPagarPerc := 0
LOCAL nPagoPerc  := 0
LOCAL nTotPagar  := 0
LOCAL nTotPago   := 0
LOCAL lAchou      := .F.
LOCAL aRelato      := {}
LOCAL cCodi       := ""
LOCAL cNome       := ""
LOCAL nX
LOCAL oRelato
LOCAL oBloco
LOCAL cFatura
LOCAL cPagar
LOCAL cPago

WHILE .T.
    oMenu:Limpa()
    MaBox( 10, 10, 14, 79 )
    cFatuIni := Space(07)
    cFatuFim := Space(07)
    xCodigo    := 0
    nChoice    := 0
    nPorc     := 0
    aRelato    := {}
    SetCursor(1) ; DevPos( 11, 11 ) ; DevOut( "Fatura Inicial..:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cFatuIni, "cFatuIni", "@!", {|| VisualAchaFatura( @cFatuIni )},))
    SetCursor(1) ; DevPos( 12, 11 ) ; DevOut( "Fatura Final....:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cFatuFim, "cFatuFim", "@!", {|| VisualAchaFatura( @cFatuFim )},))
    SetCursor(1) ; DevPos( 13, 11 ) ; DevOut( "Percentual Pago.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nPorc, "nPorc", "999.9999", {|| nPorc <> 0},))
    ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
    if LastKey() = 27
        ResTela( cScreen )
        Exit
    endif
    oBloco := {|| Saidas->Fatura >= cFatuIni .AND. Saidas->Fatura <= cFatuFim }
    Receber->(Order( 2 ))
    Recebido->(Order( 3 ))
    Recemov->(Order( 4 ))
    Saidas->(Order( 3 ))
    ErrorBeep()
    if Conf("Pergunta: Deseja Continuar ?")
        lCancelado := Conf("Pergunta: Incluir Cancelados ?")
        Saidas->(DbSeek( cFatuIni ))
        While Saidas->(Eval( oBloco ))
            nTotPagar  := 0
            nTotPago   := 0
            cCodi       := Saidas->Codi
            cFatura      := Saidas->Fatura
            nVlrFatura := Saidas->VlrFatura
            Receber->(DbSeek( cCodi ))
            cNome       := Receber->Nome
            if !lCancelado
                if Receber->Cancelada
                    Saidas->(DbSkip(1))
                    Loop
                endif
            endif
            if Recemov->(DbSeek( cFatura ))
                While Recemov->Fatura = cFatura
                    nTotPagar += Recemov->Vlr
                    Recemov->(DbSkip(1))
                Enddo
            endif
            if Recebido->(DbSeek( cFatura ))
                While Recebido->Fatura = cFatura
                    nTotPago += Recebido->Vlr
                    Recebido->(DbSkip(1))
                Enddo
            endif
            nPagoPerc  := ( nTotPago / nVlrFatura ) * 100
            nPagarPerc := ( 100 - nPagoPerc )
            if nPagarPerc < 0
                nPagarPerc := 0
            endif
            cPago       := Tran( nPagoPerc,  "999%")
            cPagar      := Tran( nPagarPerc, "999%")
            cVlrFatura := Tran( nVlrFatura, "@E 9,999,999.99")
            if Ascan2( aRelato, cFatura, 3 ) <= 0
                if nPagarPerc >= nPorc
                    Aadd( aRelato, { cCodi, cNome, cFatura, cVlrFatura, cPago, cPagar })
                endif
            endif
            Saidas->(DbSkip(1))
        Enddo
        if !InsTru80()
            ResTela( cScreen )
            return
        endif
        PrintOn()
        SetPrc( 0,0 )
        oRelato                := TRelatoNew()
        oRelato:Sistema    := SISTEM_NA3
        oRelato:Titulo     := "RELATORIO DE PERCENTUAL PAGO/PAGAR"
        oRelato:Cabecalho := "CODI  NOME DO CLIENTE                          FATURA      VLR FATURA PAGO PAGAR"
        oRelato:Inicio()
        For nX := 1 To Len( aRelato )
            Qout( aRelato[nX,1], aRelato[nX,2], aRelato[nX,3], aRelato[nX,4], aRelato[nX,5], aRelato[nX,6])
            oRelato:RowPrn ++
        Next
        __Eject()
        PrintOff()
    endif
EndDo


Proc MarDesMarcaCliente()

LOCAL Arq_Ant    := Alias()
LOCAL Ind_Ant    := IndexOrd()
LOCAL cScreen    := SaveScreen()
LOCAL oBrowse    := MsBrowse():New()

oMenu:Limpa()
dbSelectArea( "Receber" )
Receber->(Order( 1 ))
Receber->(DbGoTop())
oBrowse:Add( "ROL",       "Rol")
oBrowse:Add( "CODIGO",    "Codi")
oBrowse:Add( "NOME",      "Nome")
oBrowse:Add( "CIDADE",    "Cida")
oBrowse:Add( "UF",        "Esta")
oBrowse:Titulo   := "MARCA/DESMARCA CLIENTES PARA RELATORIO COBRANCA"
oBrowse:PreDoGet := NIL
oBrowse:PosDoGet := NIL
oBrowse:PreDoDel := {|| HotPreCli( oBrowse ) }
oBrowse:PosDoDel := NIL
oBrowse:Show()
oBrowse:Processa()
AreaAnt( Arq_Ant, Ind_Ant )
ResTela( cScreen )



Proc RemoveAgenda()

LOCAL aMenu     := {"Individual","Por Cliente","Geral"}
LOCAL cScreen    := SaveScreen()
LOCAL cCodiVen := Space(04)
LOCAL cCodi     := Space(05)
LOCAL nChoice    := 0

WHILE .T.
    oMenu:Limpa()
    M_Title("REMOVER AGENDAMENTO COBRANCA")
    nChoice := FazMenu( 03, 10, aMenu )
    Do Case
    Case nChoice = 0
        ResTela( cScreen )
        return

    Case nChoice = 1
        MaBox( 10, 10, 12, 78 )
        cCodiVen := Space( 04 )
        SetCursor(1) ; DevPos( 11, 11 ) ; DevOut( "Cobrador..:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodiVen, "cCodiVen", "9999", {|| FunErrado( @cCodiVen,, Row(), Col()+1 )},))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        if LastKey() = 27
            ResTela( cScreen )
            return
        endif
        ErrorBeep()
        if Conf("Pergunta: Alteracao podera demorar. Continua ?")
            Recemov->(DbGotop())
            Mensagem("Aguarde, Removendo Agendamento por Cobrador.")
            While Recemov->(!Eof()) .AND. Rep_Ok()
                if Recemov->Cobrador = cCodiVen
                    cCodi   := Recemov->Codi
                    oAgenda := oAmbiente:xBaseDados + "\AGE" + cCodi + ".INI"
                    Ferase( oAgenda )
              endif
              Recemov->(DbSkip(1))
            EndDo
        endif

    Case nChoice = 2
        cCodi := Space( 05 )
        MaBox( 10, 10, 12, 78 )
        SetCursor(1) ; DevPos( 11, 11 ) ; DevOut( "Cliente....:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodi, "cCodi", "99999", {|| RecErrado( @cCodi,, Row(), Col()+1 )},))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        if LastKey() = 27
            ResTela( cScreen )
            return
        endif
        ErrorBeep()
        if Conf("Pergunta: Continua ?")
            Mensagem("Aguarde, Removendo Agendamento por Cliente.")
            Recemov->(Order( 2 ))
            if Recemov->(DbSeek( cCodi ))
                While Recemov->Codi = cCodi
                    oAgenda := oAmbiente:xBaseDados + "\AGE" + cCodi + ".INI"
                    Ferase( oAgenda )
                    Recemov->(DbSkip(1))
                EndDo
            endif
        endif

    Case nChoice = 3
        ErrorBeep()
        if Conf("Pergunta: Alteracao podera demorar. Continua ?")
            Recemov->(DbGotop())
            Mensagem("Aguarde, Removendo Agendamento Geral.")
            While Recemov->(!Eof()) .AND. Rep_Ok()
                cCodi   := Recemov->Codi
                oAgenda := oAmbiente:xBaseDados + "\AGE" + cCodi + ".INI"
                Ferase( oAgenda )
                Recemov->(DbSkip(1))
            EndDo
        endif
    EndCase
EndDo

Proc Prn002Cob( cTitulo, dIni, dFim, dAtual, aCodi, cCodiVen, lTotal, lSeletiva, aReg, dProxCob, dProxCobFim )

LOCAL cScreen      := SaveScreen()
LOCAL lSair       := .F.
LOCAL Lista       := SISTEM_NA3
LOCAL Tam          := 132
LOCAL Col          := 58
LOCAL Pagina      := 0
LOCAL NovoCodi   := .T.
LOCAL lSub          := .F.
LOCAL UltCodi      := Recemov->Codi
LOCAL GrandTotal := 0
LOCAL nCarencia  := 0
LOCAL GrandJuros := 0
LOCAL GrandGeral := 0
LOCAL Atraso      := 0
LOCAL Juros       := 0
LOCAL TotalCli   := 0
LOCAL TotalJur   := 0
LOCAL TotalGer   := 0
LOCAL nJrVlr      := 0
LOCAL nJuros      := 0
LOCAL nJdia       := 0
LOCAL nAtraso      := 0
LOCAL nJuro       := 0
LOCAL nValor      := 0
LOCAL nDocumento := 0
LOCAL nClientes  := 0
LOCAL nY           := 0
LOCAL nConta      := 0
LOCAL aRelato      := {}
LOCAL nResuVlr   := 0
LOCAL nResuDocs  := 0
LOCAL nResuJrVlr := 0
LOCAL cTela
LOCAL dEmis
LOCAL dVcto
LOCAL NovoNome
LOCAL UltNome
LOCAL oAgenda
LOCAL cAgenda1
LOCAL cAgenda2
LOCAL cData1
LOCAL cData2

cTela := Mensagem("Aguarde, imprimindo.")
PrintOn()
FPrint(PQ)
SetPrc( 0 , 0 )
dbSelectArea( "ReceMov" )
nLenCodi := Len( aCodi )
For nY := 1 To nLenCodi
    Receber->( Order( 2 ))
    cCodiReceber := aCodi[nY]
    if Receber->(DbSeek( cCodiReceber ))
        Recemov->(Order( 2 ))
        if Recemov->(!DbSeek( cCodiReceber ))
            Loop
        endif
    else
        Loop
    endif
    NovoCodi := .T.
    WHILE Recemov->Codi = cCodiReceber .AND. Recemov->(!Eof()) .AND. Rel_Ok()









        if lSeletiva = NIL .OR. lSeletiva = .F.
            if Recemov->Vcto < dIni .OR. Recemov->Vcto > dFim
                Recemov->(DbSkip(1))
                Loop
            endif
        else
            xRecno := Recemov->(Recno())
            if Ascan( aReg, xRecno ) = 0
                Recemov->(DbSkip(1))
                Loop
            endif
        endif
        Atraso     := Atraso(   dAtual, Vcto )
        nDesconto := VlrDesconto( dAtual, Vcto, Vlr )
        nMulta     := VlrMulta( dAtual, Vcto, Vlr )
        nCarencia := Carencia( dAtual, Vcto )
        if Atraso <= 0
            Juros := 0
        else
            Juros := Jurodia * nCarencia
        endif
        if Col >= 57
            Write( 01, 001, "Pagina N?" + StrZero( ++Pagina , 3 ) )
            Write( 01, 117, "Horas "+ Time())
            Write( 02, 001, Dtoc( Date() ))
         Write( 03, 000, Padc( ltrim(rtrim(oAmbiente:xNomefir)), Tam ))
            Write( 04, 000, Padc( Lista  , Tam ))
            Write( 05, 000, Padc( cTitulo , Tam ))
            Write( 06, 000, Repl( "=", Tam ) )
            Write( 07, 000, "DOC N?RG TIPO    EMISSAO     VCTO PORTADOR     VLR TITULO JR MES ATR  JR DIARIO     DESCONTO        MULTA  TOTAL JUROS  TOTAL GERAL")
            Write( 08, 000, Repl( "=", Tam ) )
            Col := 9
        endif
        if NovoCodi .OR. Col = 9
            if NovoCodi
                NovoCodi := .F.
            endif
            Qout( Codi, Receber->Regiao, Receber->Nome, Receber->Fone, Receber->( ltrim(rtrim(Ende))), Receber->(ltrim(rtrim(Bair))),Receber->( ltrim(rtrim(Cida))), Receber->Esta )
            Qout( Space(05), "SPC:" + if( Receber->Spc, "SIM em " + Dtoc( Receber->DataSpc ), "NAO"), Space(1), Receber->Fanta, Receber->Obs )
            Qout( Space(05), "PROFISSAO: " + Receber->Profissao, "TRABALHO:" + Receber->Trabalho, "CARGO : " + Receber->Cargo )
            Qout( Space(05), "AVALISTA : " + Receber->Conhecida,  "ENDERECO:" + Receber->Ende3 )
            Col += 4
            oAgenda := TIniNew("AGE" + cCodiReceber + ".INI")
            nConta := oAgenda:ReadInteger( Codi, "soma", 0 )
            For nV = 1 To nConta Step 2
                cAgenda1 := Left( oAgenda:ReadString( Codi, StrZero(nV,    2), Repl("_",40), 1), 40)
                cData1    := Dtoc( oAgenda:ReadDate( Codi,   StrZero(nV,    2), cTod("//"), 2))
                cAgenda2 := Left( oAgenda:ReadString( Codi, StrZero(nV+1,2), Repl("_",40), 1), 40)
                cData2    := Dtoc( oAgenda:ReadDate( Codi,   StrZero(nV+1,2), cTod("//"), 2))
                Qout(  Space(05), "AGENDA " + StrZero( nV,   2) + ": " + cData1 + " " + cAgenda1 )
                QQout( Space(05), "AGANDA " + StrZero( nV+1, 2) + ": " + cData2 + " " + cAgenda2 )
                Col++
            Next
            oAgenda:Close()
        endif
        cEmis      := Dtoc( Emis )
        cVcto      := Dtoc( Vcto )
        cJuro      := Tran( Juro,    "999.99")
        cAtraso     := Tran( Atraso, "999")
        cJdia      := Tran( Jurodia,        "@E 999,999.99")
        cValor     := Tran( Vlr,             "@E 9,999,999.99")
        cJuros     := Tran( Juros,            "@E 9,999,999.99")
        cDesconto := Tran( nDesconto,     "@E 9,999,999.99")
        cMulta     := Tran( nMulta,         "@E 9,999,999.99")
        cJrVlr     := Tran((( Juros + Vlr ) + nMulta ) - nDesconto,    "@E 9,999,999.99")
        nJrVlr     := ((( Juros + Vlr ) + nMulta ) - nDesconto)
        if !lTotal
            xPos := Ascan2( aRelato, Codi, 2 )
            if xPos <= 0
                Aadd( aRelato, { 1, Codi, Receber->Nome, Vlr, nJrVlr })
            else
                aRelato[xPos,1] += 1
                aRelato[xPos,4] += Vlr
                aRelato[xPos,5] += nJrVlr
            endif
            Qout( Docnr, Tipo, cEmis, cVcto,Port, cValor, cJuro, cAtraso, cJdia, cDesconto, cMulta,cJuros, cJrVlr )
            Col++
        endif
        Totalcli   += Vlr
        Totaljur   += Juros
        Totalger   += nJrVlr
        GrandTotal += Vlr
        GrandJuros += Juros
        GrandGeral += nJrVlr
        nDocumento ++
        if Recemov->(TravaReg())
            Recemov->Cobrador := cCodiVen
            Recemov->RelCob    := .T.
            Recemov->(Libera())
        endif
        Recemov->(DbSkip(1))
        if Col >= 57
            Col++
            Terminou( Tam, Col, TotalCli, TotalJur, TotalGer )
            TotalCli := 0
            TotalJur := 0
            TotalGer := 0
            Col        += 2
            __Eject()
        endif
    EndDo
    if TotalCli <> 0
        Col++
        Terminou( Tam, Col, TotalCli, TotalJur, TotalGer )
        TotalCli := 0
        TotalJur := 0
        TotalGer := 0
        Col        += 2
    endif
Next
Write(  Col , 000, "** Total Geral **" )
Write(  Col , 020, StrZero( nLenCodi, 6 ) + " - " + StrZero( nDocumento, 6 ))
Write(  Col , 046, Tran( GrandTotal, "@E 9,999,999.99" ))
Write(  Col , 107, Tran( GrandJuros, "@E 9,999,999.99" ))
Write(  Col , 120, Tran( GrandGeral, "@E 9,999,999.99" ))
__Eject()
PrintOff()
oMenu:Limpa()
ErrorBeep()
if Conf("Pergunta: Confirma Impressao do Resumo ?")
    Asort( aRelato,,, {| x, y | y[3] > x[3] } )
    if !InsTru80()
        ResTela( cScreen )
        return
    endif
    PrintOn()
    FPrint(PQ)
    SetPrc( 0,0 )
    oRelato                := TRelatoNew()
    oRelato:Tamanho    := 132
    oRelato:Sistema    := SISTEM_NA3
    oRelato:Titulo     := cTitulo
    oRelato:Cabecalho := "CODI  NOME DO CLIENTE                       QTD DOC        VALOR    VLR C/ JR"
    oRelato:Inicio()
    nResuVlr   := 0
    nResuJrVlr := 0
    nResuDocs  := 0
    For nX := 1 To Len( aRelato )
        Qout( aRelato[nX,2], aRelato[nX,3], Tran( aRelato[nX,1], "9999"), Tran( aRelato[nX,4], "@E 9,999,999.99"), Tran( aRelato[nX,5], "@E 9,999,999.99"))
        oRelato:RowPrn ++
        nResuVlr   += aRelato[nX,4]
        nResuJrVlr += aRelato[nX,5]
        nResuDocs  += aRelato[nX,1]
    Next
    Qout()
    Qout("** Total Geral **", Space(28), Tran( nResuDocs, "9999"), Tran( nResuVlr, "@E 9,999,999.99"), Tran( nResuVlr, "@E 9,999,999.99"))
    __Eject()
    PrintOff()
endif
ResTela( cScreen )
return


Function ReciboDiv( cCaixa, cVendedor )

LOCAL cScreen := SaveScreen()
LOCAL aMenu   := {"Recibo Diarias Semanal","Recibo Diversos","Vale Diversos"}
LOCAL nChoice := 0

WHILE .T.
    oMenu:Limpa()
    M_Title("RECIBOS/VALES DIVERSOS" )
    nChoice := FazMenu( 10, 10, aMenu )
    Do Case
    Case nChoice = 0
        ResTela( cScreen )
        return

    Case nChoice = 1
      DivDiaria( cCaixa, cVendedor, "RECIBO")

    Case nChoice = 2
      DivRecibo( cCaixa, cVendedor, "RECIBO", nChoice)

    Case nChoice = 3
      DivRecibo( cCaixa, cVendedor, "VALE", nChoice)
    EndCase
END

Function DivDiaria( cCaixa, cVendedor, cTipo )

LOCAL Arq_Ant     := Alias()
LOCAL Ind_Ant     := IndexOrd()
LOCAL cScreen     := SaveScreen()
LOCAL cCodiven  := Space(04)
LOCAL dIni         := Date()-5
LOCAL dFim         := Date()
LOCAL cNome      := Space(40)
LOCAL cEnde      := Space(40)
LOCAL cCida      := Space(40)
LOCAL cValor     := Space(0)
LOCAL cHist      := Space(40)
LOCAL cRef         := Space(40)
LOCAL cCodiCx     := "0000"
LOCAL cDc         := "D"
LOCAL nOpcao     := 1
LOCAL nVlrTotal := 0
LOCAL Larg         := 80
LOCAL nValor     := 0
LOCAL nChSaldo  := 0
LOCAL cDocnr     := StrZero( Chemov->(LastRec()), 9 )
LOCAL nTamDoc     := 0
LOCAL nVlrLcto  := 0
LOCAL cTela
LOCAL nRow

WHILE .T.
    oMenu:Limpa()
    cCodiven := Space(04)
    dIni        := Date()-5
    dFim        := Date()
    cNome     := Space(40)
    cEnde     := Space(40)
    cCida     := Space(40)
    cHist     := "QUITACAO DIARIAS SERVICO DE INSTALACAO ANTENAS REF "
    cRef        := cHist
    cCodiCx    := "0000"
    cDc        := "D"
    cDc1        := "D"
    cDc2        := "D"
    nValor    := 0
    cDocnr    := ltrim(rtrim(cDocnr))
    nTamDoc    := Len( cDocnr )
    cDocnr    := StrZero( Val( cDocnr ) + 1, nTamDoc ) + Space( 9 - nTamDoc )
    MaBox( 07, 00, 13, 79, "IMPRESSAO DE " + cTipo + " DIVERSOS" )
    SetCursor(1) ; DevPos( 08, 01 ) ; DevOut( "Funcionario....: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodiven, "cCodiven", "9999", {|| FunErrado( @cCodiven,,Row(),Col()+1)},))
    SetCursor(1) ; DevPos( 09, 01 ) ; DevOut( "Data Inicio....: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dIni, "dIni", "##/##/##", {|| if(Empty(dIni),  ( ErrorBeep(), Alerta("Ooops!: Entre com uma data!"), .F. ), .T. )},))
    SetCursor(1) ; DevPos( 10, 01 ) ; DevOut( "Data Final.....: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dFim, "dFim", "##/##/##", {|| if(Empty(dFim),  ( ErrorBeep(), Alerta("Ooops!: Entre com uma data!"), .F. ), .T. )},))
    SetCursor(1) ; DevPos( 11, 01 ) ; DevOut( "Valor R$.......: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nValor, "nValor", "@E 9,999,999.99", {|| if(Empty(nValor), ( ErrorBeep(), Alerta("Ooops!: Entre com um valor!"), .F. ), .T. )},))
    SetCursor(1) ; DevPos( 12, 01 ) ; DevOut( "Documento N?..: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cDocnr, "cDocnr", "@!", {|| CheqDoc(cDocnr)},))
    ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
    if LastKey() = 27
        AreaAnt( Arq_Ant, Ind_Ant )
        ResTela( cScreen )
        return
    endif
    ErrorBeep()
    if !Conf("Pergunta: Confirma lancamento ?")
        AreaAnt( Arq_Ant, Ind_Ant )
        ResTela( cScreen )
        Loop
    endif
    nVlrLcto := nValor
    cHist     := "QUITACAO DIARIAS SERVICO DE INSTALACAO ANTENAS REF "
    cHist     += dToc( dIni )
    cHist     += " A "
    cHist     += dToc( dFim )
    cRef        := cHist

    Vendedor->(Order( 1 ))
    if Vendedor->(DbSeek( cCodiven ))
        cNome := ltrim(rtrim(Vendedor->Nome))
        cEnde := ltrim(rtrim(Vendedor->Ende))
        cEnde += if(!Empty(Vendedor->Bair)," - ","")
        cEnde += ltrim(rtrim(Vendedor->Bair))
        cCida := ltrim(rtrim(Vendedor->Cida))
        cCida += if(!Empty(Vendedor->Esta),"/","")
        cCida += Vendedor->Esta
    endif

    if Cheque->(DbSeek( cCodiCx )) .OR. !Empty( cCodiCx )
        if Cheque->(TravaReg())
            nChSaldo := Cheque->Saldo
            if Chemov->(Incluiu())
                if cDc = "C"
                    nChSaldo       += nVlrLcto
                    Cheque->Saldo += nVlrLcto
                    Chemov->Cre   := nVlrLcto
                else
                    nChSaldo       -= nVlrLcto
                    Cheque->Saldo -= nVlrLcto
                    Chemov->Deb   := nVlrLcto
                endif
                Chemov->Codi    := cCodiCx
                Chemov->Docnr    := cDocnr
                Chemov->Emis    := Date()
                Chemov->Data    := Date()
                Chemov->Baixa    := Date()
                Chemov->Hist    := cHist
                Chemov->Saldo    := nChSaldo
                Chemov->Tipo    := "OU"
                Chemov->Caixa    := if( cCaixa = Nil, Space(4), cCaixa )
                Chemov->Fatura := cDocnr
            endif
            Chemov->(Libera())
        endif
        Cheque->(Libera())
    endif


    if Recibo->(Incluiu())
        Recibo->Nome     := cNome
      Recibo->Vcto    := dFim
      Recibo->Tipo    := "PAGDIA"

      Recibo->Codi    := cCodiven
        Recibo->Docnr     := cDocnr
      Recibo->Hora    := Time()
      Recibo->Data    := Date()
      Recibo->Usuario := oAmbiente:xUsuario + Space( 10 - Len( oAmbiente:xUsuario ))

        Recibo->Caixa     := cCaixa
      Recibo->Vlr     := -nValor
        Recibo->Hist     := cHist
        Recibo->(Libera())
    endif



    if !Instru80() .OR. !LptOk()
        Restela( cScreen )
        return
    endif
    cTela := Mensagem("Aguarde, Imprimindo Recibo.")
    PrintOn()
    FPrInt( Chr(27) + "C" + Chr( 33 ))
    nVlrTotal := nValor
    cValor     := ltrim(rtrim(Tran( nVlrTotal,"@E 9,999,999.99")))
    nValor     := Extenso( nVlrTotal, 1, 3, Larg )
    SetPrc(0,0)
    nRow := 2
    Write( nRow+00, 00, Repl("=",80))
    Write( nRow+01, 00, GD + Padc( ltrim(rtrim(cNome)), 40) + CA )
    Write( nRow+02, 00, Padc( ltrim(rtrim(cEnde)) + " - " + ltrim(rtrim(cCida)), 80 ))
    Write( nRow+03, 00, Repl("-",80))
    Write( nRow+04, 40, GD + cTipo + CA + NR)
    Write( nRow+05, 00, "N?" + NG + cDocnr + NR )
    Write( nRow+05, 66, "R$ " + NG + cValor + NR )
   Write( nRow+07, 00, "Recebemos de    : " + NG + ltrim(rtrim(oAmbiente:xNomefir))+ NR )
    Write( nRow+08, 00, "Estabelecido  a : " + NG + "AV CASTELO BRANCO, 693 - PIONEIROS" + NR )
    Write( nRow+09, 00, "na Cidade de    : " + NG + "PIMENTA BUENO" + " - " + "RO" + NR )
    Write( nRow+11, 00, "A Importancia por extenso abaixo relacionada")
    Write( nRow+12, 00, NG + Left( nValor, Larg ) + NR  )
    Write( nRow+13, 00, NG + SubStr( nValor, Larg + 1, Larg ) + NR  )
    Write( nRow+14, 00, NG + Right( nValor, Larg ) + NR  )
    Write( nRow+16, 00, "Referente a")
    Write( nRow+17, 00, NG + cRef + NR )
    Write( nRow+19, 00, "Para maior clareza firmo(amos) o presente")
    Write( nRow+20, 00, NG + Padl(DataExt( Date()), 80) + NR)
    Write( nRow+24, 00, Padl(Repl("-",40),80))
    Write( nRow+25, 00, Repl("=",80))
    __Eject()
    PrintOff()
    ResTela( cTela )
EndDo



Proc DivRecibo( cCaixa, cVendedor, cTipo, nChoice )

LOCAL Arq_Ant     := Alias()
LOCAL Ind_Ant     := IndexOrd()
LOCAL cScreen     := SaveScreen()
LOCAL cNome      := Space(40)
LOCAL cEnde      := Space(40)
LOCAL cCida      := Space(40)
LOCAL cValor     := Space(0)
LOCAL cHist      := Space(40)
LOCAL cRef         := Space(40)
LOCAL cCodiCx1  := Space(04)
LOCAL cCodiCx2  := Space(04)
LOCAL cCodiCx     := "0000"
LOCAL cDc         := "D"
LOCAL cDc1         := "D"
LOCAL cDc2         := "D"
LOCAL nOpcao     := 1
LOCAL nVlrTotal := 0
LOCAL Larg         := 80
LOCAL nValor     := 0
LOCAL nChSaldo  := 0
LOCAL cDocnr     := StrZero( Chemov->(LastRec()), 9 )
LOCAL nTamDoc     := 0
LOCAL nVlrLcto  := 0
LOCAL cTela
LOCAL nRow
LOCAL cNomeFir
LOCAL cStr

cNome     := Space(40)
cEnde     := Space(40)
cCida     := Space(40)
cHist     := Space(40)
cRef        := Space(40)
cCodiCx1 := Space(04)
cCodiCx2 := Space(04)
cCodiCx    := "0000"
cDc        := "D"
cDc1        := "D"
cDc2        := "D"
nValor    := 0
cDocnr    := ltrim(rtrim(cDocnr))
nTamDoc    := Len( cDocnr )
cNomeFir := oAmbiente:xNomefir
WHILE .T.
    oMenu:Limpa()
    cDocnr    := StrZero( Val( cDocnr ) + 1, nTamDoc ) + Space( 9 - nTamDoc )
   MaBox( 06, 00, 18, 79, "IMPRESSAO DE " + cTipo + " DIVERSOS" )
   SetCursor(1) ; DevPos( 07, 01 ) ; DevOut( "Recebemos de...: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cNomeFir, "cNomeFir", "@!", {|| if(Empty(cNomeFir),  ( ErrorBeep(), Alerta("Ooops!: Entre com um nome!"), .F. ), .T. )},))
   SetCursor(1) ; DevPos( 08, 01 ) ; DevOut( "Nome Emitente..: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cNome, "cNome", "@!", {|| if(Empty(cNome),  ( ErrorBeep(), Alerta("Ooops!: Entre com um nome!"), .F. ), .T. )},))
    SetCursor(1) ; DevPos( 09, 01 ) ; DevOut( "Estabelecido a : " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cEnde, "cEnde", "@!", {|| if(Empty(cEnde),  ( ErrorBeep(), Alerta("Ooops!: Entre com um Endereco!"), .F. ), .T. )},))
    SetCursor(1) ; DevPos( 10, 01 ) ; DevOut( "Na Cidade de   : " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCida, "cCida", "@!", {|| if(Empty(cCida),  ( ErrorBeep(), Alerta("Ooops!: Entre com uma Cidade!"), .F. ), .T. )},))
    SetCursor(1) ; DevPos( 11, 01 ) ; DevOut( "Documento N?..: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cDocnr, "cDocnr", "@!", {|| CheqDoc(cDocnr)},))
    SetCursor(1) ; DevPos( 12, 01 ) ; DevOut( "Referente......: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cRef, "cRef", "@!", {|| if(Empty(cRef),   ( ErrorBeep(), Alerta("Ooops!: Entre com a referencia!"), .F. ), (ValidarcHist(cRef,@cHist), .T.))},))
    SetCursor(1) ; DevPos( 13, 01 ) ; DevOut( "Historico Cx...: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cHist, "cHist", "@!", {|| if(Empty(cHist),  ( ErrorBeep(), Alerta("Ooops!: Entre com o historico!"), .F. ), .T. )},))
    SetCursor(1) ; DevPos( 14, 01 ) ; DevOut( "Valor R$.......: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nValor, "nValor", "@E 9,999,999.99", {|| if(Empty(nValor), ( ErrorBeep(), Alerta("Ooops!: Entre com um valor!"), .F. ), .T. )},))
    SetCursor(1) ; DevPos( 15, 01 ) ; DevOut( "Conta Caixa....: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodiCx, "cCodiCx", "9999", {|| CheErrado( @cCodiCx,, Row(), 32, .T. )},))
    SetCursor(1) ; DevPos( 15, 24 ) ; DevOut( "D/C.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cDc, "cDc", "!", {|| PickTam({"Credito em conta","Debito em conta"}, {"C","D"}, @cDc )},))
    SetCursor(1) ; DevPos( 16, 01 ) ; DevOut( "C. Partida.....: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodiCx1, "cCodiCx1", "9999", {|| CheErrado( @cCodiCx1,, Row(), 32, .T. )},))
    SetCursor(1) ; DevPos( 16, 24 ) ; DevOut( "D/C.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cDc1, "cDc1", "!", {|| PickTam({"Credito em conta","Debito em conta"}, {"C","D"}, @cDc1 )},))
    SetCursor(1) ; DevPos( 17, 01 ) ; DevOut( "C. Partida.....: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodiCx2, "cCodiCx2", "9999", {|| CheErrado( @cCodiCx2,, Row(), 32, .T. )},))
    SetCursor(1) ; DevPos( 17, 24 ) ; DevOut( "D/C.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cDc2, "cDc2", "!", {|| PickTam({"Credito em conta","Debito em conta"}, {"C","D"}, @cDc2 )},))
    ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
    if LastKey() = 27
        AreaAnt( Arq_Ant, Ind_Ant )
        ResTela( cScreen )
        return
    endif
    ErrorBeep()
    if !Conf("Pergunta: Confirma lancamento ?")
        AreaAnt( Arq_Ant, Ind_Ant )
        ResTela( cScreen )
        Loop
    endif
    nVlrLcto := nValor
    if Cheque->(DbSeek( cCodiCx )) .OR. !Empty( cCodiCx )
        if Cheque->(TravaReg())
            nChSaldo := Cheque->Saldo
            if Chemov->(Incluiu())
                if cDc = "C"
                    nChSaldo       += nVlrLcto
                    Cheque->Saldo += nVlrLcto
                    Chemov->Cre   := nVlrLcto
                else
                    nChSaldo       -= nVlrLcto
                    Cheque->Saldo -= nVlrLcto
                    Chemov->Deb   := nVlrLcto
                endif
                Chemov->Codi    := cCodiCx
                Chemov->Docnr    := cDocnr
                Chemov->Emis    := Date()
                Chemov->Data    := Date()
                Chemov->Baixa    := Date()
                Chemov->Hist    := cHist
                Chemov->Saldo    := nChSaldo
                Chemov->Tipo    := "OU"
                Chemov->Caixa    := if( cCaixa = Nil, Space(4), cCaixa )
                Chemov->Fatura := cDocnr
            endif
            Chemov->(Libera())
        endif
        Cheque->(Libera())
    endif

    if Cheque->(DbSeek( cCodiCx1 )) .OR. !Empty( cCodiCx1 )
        if Cheque->(TravaReg())
            nChSaldo := Cheque->Saldo
            if Chemov->(Incluiu())
                if cDc1 = "C"
                    nChSaldo       += nVlrLcto
                    Cheque->Saldo += nVlrLcto
                    Chemov->Cre   := nVlrLcto
                else
                    nChSaldo       -= nVlrLcto
                    Cheque->Saldo -= nVlrLcto
                    Chemov->Deb   := nVlrLcto
                endif
                Chemov->Codi    := cCodiCx1
                Chemov->Docnr    := cDocnr
                Chemov->Emis    := Date()
                Chemov->Data    := Date()
                Chemov->Baixa    := Date()
                Chemov->Hist    := cHist
                Chemov->Saldo    := nChSaldo
                Chemov->Tipo    := "OU"
                Chemov->Caixa    := if( cCaixa = Nil, Space(4), cCaixa )
                Chemov->Fatura := cDocnr
            endif
            Chemov->(Libera())
        endif
        Cheque->(Libera())
    endif

    if Cheque->(DbSeek( cCodiCx2 )) .OR. !Empty( cCodiCx2 )
        if Cheque->(TravaReg())
            nChSaldo := Cheque->Saldo
            if Chemov->(Incluiu())
                if cDc2 = "C"
                    nChSaldo       += nVlrLcto
                    Cheque->Saldo += nVlrLcto
                    Chemov->Cre   := nVlrLcto
                else
                    nChSaldo       -= nVlrLcto
                    Cheque->Saldo -= nVlrLcto
                    Chemov->Deb   := nVlrLcto
                endif
                Chemov->Codi    := cCodiCx2
                Chemov->Docnr    := cDocnr
                Chemov->Emis    := Date()
                Chemov->Data    := Date()
                Chemov->Baixa    := Date()
                Chemov->Hist    := cHist
                Chemov->Saldo    := nChSaldo
                Chemov->Tipo    := "OU"
                Chemov->Caixa    := if( cCaixa = Nil, Space(4), cCaixa )
                Chemov->Fatura := cDocnr
            endif
            Chemov->(Libera())
        endif
        Cheque->(Libera())
    endif



   if Recibo->(Incluiu())
        Recibo->Nome     := cNome
      Recibo->Vcto    := Date()
      Recibo->Tipo    := if( nChoice = 2, "PAGDIV", "PAGDIV")
      Recibo->Codi    := "00000"
        Recibo->Docnr     := cDocnr
      Recibo->Hora    := Time()
      Recibo->Data    := Date()
      Recibo->Usuario := oAmbiente:xUsuario + Space( 10 - Len( oAmbiente:xUsuario ))
      Recibo->Caixa   := cCaixa
      Recibo->Vlr     := -nValor
        Recibo->Hist     := cHist
        Recibo->(Libera())
    endif



   if !Instru80() .OR. !LptOk()
        Restela( cScreen )
        return
    endif
    Mensagem("Aguarde, Imprimindo Recibo.")
    PrintOn()
    FPrInt( Chr(27) + "C" + Chr( 33 ))
    nVlrTotal := nValor
   cStr   := ltrim(rtrim(Tran( nVlrTotal,"@E 9,999,999.99")))
   cValor := Extenso( nVlrTotal, 1, 3, Larg )
    SetPrc(0,0)
    nRow := 2
    Write( nRow+00, 00, Repl("=",80))
    Write( nRow+01, 00, GD + Padc( ltrim(rtrim(cNome)), 40) + CA )
    Write( nRow+02, 00, Padc( ltrim(rtrim(cEnde)) + " - " + ltrim(rtrim(cCida)), 80 ))
    Write( nRow+03, 00, Repl("-",80))
    Write( nRow+04, 40, GD + cTipo + CA + NR)
    Write( nRow+05, 00, "N?" + NG + cDocnr + NR )
   Write( nRow+05, 66, "R$ " + NG + cStr + NR )
   Write( nRow+07, 00, "Recebemos de    : " + NG + cNomeFir + NR )
    Write( nRow+08, 00, "Estabelecido  a : " + NG + "AV CASTELO BRANCO, 693 - PIONEIROS" + NR )
    Write( nRow+09, 00, "na Cidade de    : " + NG + "PIMENTA BUENO" + " - " + "RO" + NR )
    Write( nRow+11, 00, "A Importancia por extenso abaixo relacionada")
   Write( nRow+12, 00, NG + Left( cValor, Larg ) + NR  )
   Write( nRow+13, 00, NG + SubStr( cValor, Larg + 1, Larg ) + NR  )
   Write( nRow+14, 00, NG + Right( cValor, Larg ) + NR  )
    Write( nRow+16, 00, "Referente a")
    Write( nRow+17, 00, NG + cRef + NR )
    Write( nRow+19, 00, "Para maior clareza firmo(amos) o presente")
    Write( nRow+20, 00, NG + Padl(DataExt( Date()), 80) + NR)
    Write( nRow+24, 00, Padl(Repl("-",40),80))
    Write( nRow+25, 00, Repl("=",80))
    __Eject()
    PrintOff()
EndDo



Proc ValidarcHist(cRef,cHist)

cHist = cRef
return



Proc RelRecebido()

LOCAL GetList         := {}
LOCAL cScreen         := SaveScreen()
LOCAL aTPrompt      := {" Individual ", " Por Portador ", " Por Vendedor ", " Por Forma Pgto", " Por Regiao"," Por Data Baixa *", " Por Tipo", " Por Caixa ", " Totalizado ", " Geral " }
LOCAL aOrdem         := {"Codigo","Data Pgto *", "Documento","Emissao", "Observacoes", "Portador", "Tipo", "Valor", "Valor Pago", "Vencimento"}
LOCAL nRolRecebido := oIni:ReadInteger("relatorios", "rolrecebido", 1)
LOCAL xArquivo      := TempNew()
LOCAL xNtx             := TempNew()
LOCAL cForma         := Space(02)
LOCAL cCodi          := Space(05)
LOCAL dIni             := Date()-30
LOCAL dFim             := Date()
LOCAL cRegiao         := Space(02)
LOCAL dBaixaIni     := Date()-30
LOCAL dBaixaFim     := Date()
LOCAL cTipo          := Space(06)
LOCAL cCaixa         := Space(04)
LOCAL nConta         := 0
LOCAL nOpcao         := 0
LOCAL cTela
LOCAL bPeriodo
LOCAL bTipo
LOCAL nField
LOCAL nChoice
LOCAL oBloco
LOCAL cPortador
LOCAL cCodiVen
LOCAL Tam
LOCAL Col
LOCAL Pagina
LOCAL nTotalVlr
LOCAL nTotalJur
LOCAL nTotalRec
LOCAL nDocumento
LOCAL cFatura
LOCAL bCaixa

WHILE .T.
    oMenu:Limpa()
    Saidas->(Order( 3 ))
    dbSelectArea( "ReceBido" )
    M_Title( "ROL TITULOS RECEBIDOS" )
    nChoice := FazMenu( 01, 20, AtPrompt )
    Do Case
    Case nChoice = 0
        ResTela( cScreen )
        Exit

    Case nChoice = 1
        cCodi := Space(05)
        dIni    := Date()-30
        dFim    := Date()
        MaBox( 15, 20 , 19, 79 )
        SetCursor(1) ; DevPos( 16, 21 ) ; DevOut( "Cliente.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodi, "cCodi", "99999", {|| RecErrado( @cCodi,, Row(), Col()+3 )},))
        SetCursor(1) ; DevPos( 17, 21 ) ; DevOut( "Inicio..:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dIni, "dIni", "##/##/##",,))
        SetCursor(1) ; DevPos( 18, 21 ) ; DevOut( "Fim.....:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dFim, "dFim", "##/##/##",,))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        if LastKey() = 27
            ResTela( cScreen )
            Loop
        endif
        Mensagem("Aguarde, Processando Pesado.")
        dbSelectArea( "ReceBido" )
        Recebido->(Order( 4 ))
        if Recebido->(!DbSeek( cCodi ))
            Nada()
            Restela( cScreen )
            Loop
        endif
        nConta := 0
        __dbCopyStruct( ( xArquivo ), { } )
        dbUseArea( .T.,, (xArquivo), "xTemp", iif( .F. .OR. .T., ! .T., NIL ), .F. )
        WHILE Recebido->Codi = cCodi
            if Recebido->DataPag >= dIni .AND. Recebido->DataPag <= dFim
                if nRolRecebido = 2
                    cFatura := Recebido->Fatura
                    if Saidas->(DbSeek( cFatura ))
                        if !Saidas->Impresso
                            Recebido->(DbSkip(1))
                            Loop
                        endif
                    endif
                endif
                nConta++
                xTemp->(DbAppend())
                For nField := 1 To FCount()
                    xTemp->( FieldPut( nField, Recebido->(FieldGet( nField ))))
                Next
            endif
            Recebido->(DbSkip(1))
        EndDo
        if nConta = 0
            xTemp->(DbCloseArea())
            Ferase( xArquivo )
            Ferase( xNtx )
            ErrorBeep()
            Nada()
            Restela( cScreen )
            Loop
        endif

    Case nChoice = 2
        cPortador := Space( 10 )
        dIni         := Date()-30
        dFim         := Date()
        MaBox( 15 , 20 , 19 , 75 )
        SetCursor(1) ; DevPos( 16, 21 ) ; DevOut( "Portador......... :" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cPortador, "cPortador", "@!", {|| AchaPortador( @cPortador )},))
        SetCursor(1) ; DevPos( 17, 21 ) ; DevOut( "Data Pgto Inicial.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dIni, "dIni", "##/##/##",,))
        SetCursor(1) ; DevPos( 18, 21 ) ; DevOut( "Data Pgto Final...:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dFim, "dFim", "##/##/##",,))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        if LastKey() = 27
            ResTela( cScreen )
            Loop
        endif
        Mensagem("Aguarde, Processando Pesado.")
        dbSelectArea( "ReceBido" )
        Recebido->(Order( 6 ))
        if Recebido->(!DbSeek( cPortador ))
            Nada()
            Restela( cScreen )
            Loop
        endif
        nConta := 0
        __dbCopyStruct( ( xArquivo ), { } )
        dbUseArea( .T.,, (xArquivo), "xTemp", iif( .F. .OR. .T., ! .T., NIL ), .F. )
        WHILE Recebido->Port = cPortador
            if Recebido->DataPag >= dIni .AND. Recebido->DataPag <= dFim
                if nRolRecebido = 2
                    cFatura := Recebido->Fatura
                    if Saidas->(DbSeek( cFatura ))
                        if !Saidas->Impresso
                            Recebido->(DbSkip(1))
                            Loop
                        endif
                    endif
                endif
                nConta++
                xTemp->(DbAppend())
                For nField := 1 To FCount()
                    xTemp->( FieldPut( nField, Recebido->(FieldGet( nField ))))
                Next
            endif
            Recebido->(DbSkip(1))
        EndDo
        if nConta = 0
            xTemp->(DbCloseArea())
            Ferase( xArquivo )
            Ferase( xNtx )
            ErrorBeep()
            Nada()
            Restela( cScreen )
            Loop
        endif

    Case nChoice = 3
        cCodiVen := Space(04)
        dIni        := Date()-30
        dFim        := Date()
        MaBox( 15 , 20 , 19, 75 )
        SetCursor(1) ; DevPos( 16, 21 ) ; DevOut( "Vendedor..........:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodiVen, "cCodiVen", "9999", {|| FunErrado( @cCodiVen )},))
        SetCursor(1) ; DevPos( 17, 21 ) ; DevOut( "Data Pgto Inicial.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dIni, "dIni", "##/##/##",,))
        SetCursor(1) ; DevPos( 18, 21 ) ; DevOut( "Data Pgto Final...:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dFim, "dFim", "##/##/##",,))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        if LastKey() = 27
            ResTela( cScreen )
            Loop
        endif
        Mensagem("Aguarde, Processando Pesado.")
        dbSelectArea( "ReceBido" )
        Recebido->(Order( 5 ))
        if Recebido->(!DbSeek( cCodiVen ))
            Nada()
            Restela( cScreen )
            Loop
        endif
        nConta := 0
        __dbCopyStruct( ( xArquivo ), { } )
        dbUseArea( .T.,, (xArquivo), "xTemp", iif( .F. .OR. .T., ! .T., NIL ), .F. )
        WHILE Recebido->CodiVen = cCodiVen
            if Recebido->DataPag >= dIni .AND. Recebido->DataPag <= dFim
                if nRolRecebido = 2
                    cFatura := Recebido->Fatura
                    if Saidas->(DbSeek( cFatura ))
                        if !Saidas->Impresso
                            Recebido->(DbSkip(1))
                            Loop
                        endif
                    endif
                endif
                nConta++
                xTemp->(DbAppend())
                For nField := 1 To FCount()
                    xTemp->( FieldPut( nField, Recebido->(FieldGet( nField ))))
                Next
            endif
            Recebido->(DbSkip(1))
        EndDo
        if nConta = 0
            xTemp->(DbCloseArea())
            Ferase( xArquivo )
            Ferase( xNtx )
            ErrorBeep()
            Nada()
            Restela( cScreen )
            Loop
        endif

    Case nChoice = 4
        cForma := Space(02)
        dIni     := Date()-30
        dFim     := Date()
        MaBox( 15 , 20 , 19, 75 )
        SetCursor(1) ; DevPos( 16, 21 ) ; DevOut( "Forma.............:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cForma, "cForma", "99", {|| FormaErrada( @cForma )},))
        SetCursor(1) ; DevPos( 17, 21 ) ; DevOut( "Data Pgto Inicial.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dIni, "dIni", "##/##/##",,))
        SetCursor(1) ; DevPos( 18, 21 ) ; DevOut( "Data Pgto Final...:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dFim, "dFim", "##/##/##",,))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        if LastKey() = 27
            ResTela( cScreen )
            Loop
        endif
        Mensagem("Aguarde, Processando Pesado.")
        dbSelectArea( "ReceBido" )
        Recebido->(Order( 7 ))
        if Recebido->(!DbSeek( cForma ))
            Nada()
            Restela( cScreen )
            Loop
        endif
        nConta := 0
        __dbCopyStruct( ( xArquivo ), { } )
        dbUseArea( .T.,, (xArquivo), "xTemp", iif( .F. .OR. .T., ! .T., NIL ), .F. )
        WHILE Recebido->Forma = cForma
            if Recebido->DataPag >= dIni .AND. Recebido->DataPag <= dFim
                if nRolRecebido = 2
                    cFatura := Recebido->Fatura
                    if Saidas->(DbSeek( cFatura ))
                        if !Saidas->Impresso
                            Recebido->(DbSkip(1))
                            Loop
                        endif
                    endif
                endif
                nConta++
                xTemp->(DbAppend())
                For nField := 1 To FCount()
                    xTemp->( FieldPut( nField, Recebido->(FieldGet( nField ))))
                Next
            endif
            Recebido->(DbSkip(1))
        EndDo
        if nConta = 0
            xTemp->(DbCloseArea())
            Ferase( xArquivo )
            Ferase( xNtx )
            ErrorBeep()
            Nada()
            Restela( cScreen )
            Loop
        endif

    Case nChoice = 5
        cRegiao := Space(02)
        dIni      := Date()-30
        dFim      := Date()
        MaBox( 15 , 20 , 19, 75 )
        SetCursor(1) ; DevPos( 16, 21 ) ; DevOut( "Regiao............:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cRegiao, "cRegiao", "99", {|| RegiaoErrada( @cRegiao )},))
        SetCursor(1) ; DevPos( 17, 21 ) ; DevOut( "Data Pgto Inicial.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dIni, "dIni", "##/##/##",,))
        SetCursor(1) ; DevPos( 18, 21 ) ; DevOut( "Data Pgto Final...:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dFim, "dFim", "##/##/##",,))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        if LastKey() = 27
            ResTela( cScreen )
            Loop
        endif
        Mensagem("Aguarde, Processando Pesado.")
        dbSelectArea( "ReceBido" )
        Recebido->(Order( 9 ))
        if Recebido->(!DbSeek( cRegiao ))
            Nada()
            Restela( cScreen )
            Loop
        endif
        nConta := 0
        __dbCopyStruct( ( xArquivo ), { } )
        dbUseArea( .T.,, (xArquivo), "xTemp", iif( .F. .OR. .T., ! .T., NIL ), .F. )
        WHILE Recebido->Regiao = cRegiao
            if Recebido->DataPag >= dIni .AND. Recebido->DataPag <= dFim
                if nRolRecebido = 2
                    cFatura := Recebido->Fatura
                    if Saidas->(DbSeek( cFatura ))
                        if !Saidas->Impresso
                            Recebido->(DbSkip(1))
                            Loop
                        endif
                    endif
                endif
                nConta++
                xTemp->(DbAppend())
                For nField := 1 To FCount()
                    xTemp->( FieldPut( nField, Recebido->(FieldGet( nField ))))
                Next
            endif
            Recebido->(DbSkip(1))
        EndDo
        if nConta = 0
            xTemp->(DbCloseArea())
            Ferase( xArquivo )
            Ferase( xNtx )
            ErrorBeep()
            Nada()
            Restela( cScreen )
            Loop
        endif

    Case nChoice = 6
        dBaixaIni := Date()-30
        dBaixaFim := Date()
        MaBox( 15 , 20 , 18, 75 )
        SetCursor(1) ; DevPos( 16, 21 ) ; DevOut( "Data Baixa Inicial..¯" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dBaixaIni, "dBaixaIni", "##/##/##",,))
        SetCursor(1) ; DevPos( 17, 21 ) ; DevOut( "Data Baixa Final....¯" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dBaixaFim, "dBaixaFim", "##/##/##",,))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        if LastKey() = 27
            ResTela( cScreen )
            Loop
        endif
        Mensagem("Aguarde, Processando Pesado.")
        dIni := dBaixaIni
        dFim := dBaixaFim
        dbSelectArea( "ReceBido" )
        Recebido->(Order( 8 ))
        LETO_SET( 9, "On" )
        Recebido->(DbSeek( dBaixaIni ))
        nConta := 0
        __dbCopyStruct( ( xArquivo ), { } )
        dbUseArea( .T.,, (xArquivo), "xTemp", iif( .F. .OR. .T., ! .T., NIL ), .F. )
        WHILE Recebido->Baixa >= dBaixaIni .AND. Recebido->Baixa <= dBaixaFim
            if nRolRecebido = 2
                cFatura := Recebido->Fatura
                if Saidas->(DbSeek( cFatura ))
                    if !Saidas->Impresso
                        Recebido->(DbSkip(1))
                        Loop
                    endif
                endif
            endif
            nConta++
            xTemp->(DbAppend())
            For nField := 1 To FCount()
                xTemp->( FieldPut( nField, Recebido->(FieldGet( nField ))))
            Next
            Recebido->(DbSkip(1))
        EndDo
        LETO_SET( 9, "Off" )
        if nConta = 0
            xTemp->(DbCloseArea())
            Ferase( xArquivo )
            Ferase( xNtx )
            Nada()
            Restela( cScreen )
            Loop
        endif

    Case nChoice = 7
        cTipo := Space(06)
        dIni    := Date()-30
        dFim    := Date()
        MaBox( 15 , 20 , 19, 75 )
        SetCursor(1) ; DevPos( 16, 21 ) ; DevOut( "Tipo..............:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cTipo, "cTipo", "@!",,))
        SetCursor(1) ; DevPos( 17, 21 ) ; DevOut( "Data Pgto Inicial.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dIni, "dIni", "##/##/##",,))
        SetCursor(1) ; DevPos( 18, 21 ) ; DevOut( "Data Pgto Final...:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dFim, "dFim", "##/##/##",,))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        if LastKey() = 27
            ResTela( cScreen )
            Loop
        endif
        Mensagem("Aguarde, Processando Pesado.")
        dbSelectArea( "ReceBido" )
        Recebido->(Order( 2 ))
        LETO_SET( 9, "On" )
        Recebido->(DbSeek( dIni ))
        nConta    := 0
        bPeriodo := {| dDataPag | dDataPag >= dIni .AND. dDataPag <= dFim }
        bTipo     := {| xTipo     | xTipo        = cTipo }
        __dbCopyStruct( ( xArquivo ), { } )
        dbUseArea( .T.,, (xArquivo), "xTemp", iif( .F. .OR. .T., ! .T., NIL ), .F. )
        WHILE ( Eval( bPeriodo, Recebido->DataPag ) .AND. Rel_Ok() )
            if Eval( bTipo, Recebido->Tipo )
                if nRolRecebido = 2
                    cFatura := Recebido->Fatura
                    if Saidas->(DbSeek( cFatura ))
                        if !Saidas->Impresso
                            Recebido->(DbSkip(1))
                            Loop
                        endif
                    endif
                endif
                nConta++
                xTemp->(DbAppend())
                For nField := 1 To FCount()
                    xTemp->( FieldPut( nField, Recebido->(FieldGet( nField ))))
                Next
            endif
            Recebido->(DbSkip(1))
        EndDo
        LETO_SET( 9, "Off" )
        if nConta = 0
            xTemp->(DbCloseArea())
            Ferase( xArquivo )
            Ferase( xNtx )
            Nada()
            Restela( cScreen )
            Loop
        endif

    Case nChoice = 8
        cCaixa := Space(04)
        dIni     := Date()-30
        dFim     := Date()
        MaBox( 15 , 20 , 19, 79 )
        SetCursor(1) ; DevPos( 16, 21 ) ; DevOut( "Caixa.............:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCaixa, "cCaixa", "9999", {|| FunErrado( @cCaixa,, Row(), Col()+1)},))
        SetCursor(1) ; DevPos( 17, 21 ) ; DevOut( "Data Pgto Inicial.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dIni, "dIni", "##/##/##",,))
        SetCursor(1) ; DevPos( 18, 21 ) ; DevOut( "Data Pgto Final...:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dFim, "dFim", "##/##/##",,))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        if LastKey() = 27
            ResTela( cScreen )
            Loop
        endif
        Mensagem("Aguarde, Processando Pesado.")
        dbSelectArea( "ReceBido" )
        Recebido->(Order( 2 ))
        LETO_SET( 9, "On" )
        Recebido->(DbSeek( dIni ))
        nConta    := 0
        bPeriodo := {| dDataPag | dDataPag >= dIni .AND. dDataPag <= dFim }
        bCaixa    := {| xCaixa    | xCaixa     = cCaixa }
        __dbCopyStruct( ( xArquivo ), { } )
        dbUseArea( .T.,, (xArquivo), "xTemp", iif( .F. .OR. .T., ! .T., NIL ), .F. )
        WHILE ( Eval( bPeriodo, Recebido->DataPag ) .AND. Rel_Ok() )
            if Eval( bCaixa, Recebido->Caixa )
                if nRolRecebido = 2
                    cFatura := Recebido->Fatura
                    if Saidas->(DbSeek( cFatura ))
                        if !Saidas->Impresso
                            Recebido->(DbSkip(1))
                            Loop
                        endif
                    endif
                endif
                nConta++
                xTemp->(DbAppend())
                For nField := 1 To FCount()
                    xTemp->( FieldPut( nField, Recebido->(FieldGet( nField ))))
                Next
            endif
            Recebido->(DbSkip(1))
        EndDo
        LETO_SET( 9, "Off" )
        if nConta = 0
            xTemp->(DbCloseArea())
            Ferase( xArquivo )
            Ferase( xNtx )
            Nada()
            Restela( cScreen )
            Loop
        endif

    Case nChoice = 9
        Tam          := 132
        Col          := 58
        Pagina      := 0
        nTotalVlr  := 0
        nTotalJur  := 0
        nTotalRec  := 0
        nDocumento := 0
        if Recebido->(Lastrec()) = 0
            Nada()
            Loop
        endif
        if !InsTru80() .OR. !LptOk()
            Loop
        endif
        cTela := Mensagem("Aguarde, imprimindo.")
        PrintOn()
        FPrint( PQ )
        SetPrc( 0 , 0 )
        dbSelectArea( "Recebido" )
        Recebido->(DbGoTop())
        WHILE Recebido->(!Eof()) .AND. Rel_Ok()
            if nRolRecebido = 2
                cFatura := Recebido->Fatura
                if Saidas->(DbSeek( cFatura ))
                    if !Saidas->Impresso
                        Recebido->(DbSkip(1))
                        Loop
                    endif
                endif
            endif
            if Col >= 57
                Qout( Padr( "Pagina N?" + StrZero( ++Pagina,3 ), ( Tam/2 ) ) + Padl( Time(), ( Tam/2 ) ))
                Qout( Dtoc( Date() ))
            Qout( Padc( ltrim(rtrim(oAmbiente:xNomefir)), Tam ))
                Qout( Padc( SISTEM_NA3, Tam ))
                Qout( Padc( "ROL GERAL DE TITULOS RECEBIDOS - TOTALIZADO" , Tam ))
                Qout( Repl( "=", Tam ) )
                Qout("              QTDE DCTOS    TOTAL NOMINAL      TOTAL JUROS      TOTAL GERAL")
                Qout( Repl( "=", Tam ) )
                Col := 9
            endif
            nDocumento ++
            nTotalVlr  += Recebido->Vlr
            nTotalRec  += Recebido->VlrPag
            nTotalJur  += ( Recebido->VlrPag - Recebido->Vlr )
            Recebido->(DbSkip(1))
        EndDo



        Qout("** Total Geral **", Tran( nDocumento, "999999" ), Tran( nTotalVlr, "@E 9,999,999,999.99" ), Tran( nTotalJur, "@E 9,999,999,999.99" ), Tran( nTotalRec, "@E 9,999,999,999.99" ))
        __Eject()
        PrintOff()
        ResTela( cScreen )
        Loop

    Case nChoice = 10
        dIni := Date()-30
        dFim := Date()
        MaBox( 15 , 20 , 18 , 75 )
        SetCursor(1) ; DevPos( 16, 21 ) ; DevOut( "Data Pgto Inicial.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dIni, "dIni", "##/##/##",,))
        SetCursor(1) ; DevPos( 17, 21 ) ; DevOut( "Data Pgto Final...:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dFim, "dFim", "##/##/##",,))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        if LastKey() = 27
            ResTela( cScreen )
            Loop
        endif
        Mensagem("Aguarde, Processando Pesado.")
        dbSelectArea( "ReceBido" )
        Recebido->(Order( 2 ))
        LETO_SET( 9, "On" )
        Recebido->(DbSeek( dIni ))
        nConta := 0
        __dbCopyStruct( ( xArquivo ), { } )
        dbUseArea( .T.,, (xArquivo), "xTemp", iif( .F. .OR. .T., ! .T., NIL ), .F. )
        WHILE Recebido->DataPag >= dIni .AND. Recebido->DataPag <= dFim
          if nRolRecebido = 2
              cFatura := Recebido->Fatura
              if Saidas->(DbSeek( cFatura ))
                  if !Saidas->Impresso
                      Recebido->(DbSkip(1))
                      Loop
                  endif
              endif
          endif
            nConta++
            xTemp->(DbAppend())
            For nField := 1 To FCount()
                xTemp->( FieldPut( nField, Recebido->(FieldGet( nField ))))
            Next
            Recebido->(DbSkip(1))
        EndDo
        LETO_SET( 9, "Off" )
        if nConta = 0
            xTemp->(DbCloseArea())
            Ferase( xArquivo )
            Ferase( xNtx )
            Nada()
            Restela( cScreen )
            Loop
        endif
    EndCase
    WHILE .T.
        oMenu:Limpa()
        M_Title("ESCOLHA A ORDEM A IMPRIMIR. ESC RETORNA")
        nOpcao := FazMenu( 05, 10, aOrdem )
        Mensagem(" Aguarde...")
        dbSelectArea( "xTemp" )
        if nOpcao = 0
            xTemp->(DbCloseArea())
            Ferase( xArquivo )
            Ferase( xNtx )
            ResTela( cScreen )
            Exit
        elseif nOpcao = 1
             ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Codi", {|| xTemp->Codi}, )
         elseif nOpcao = 2
             ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->DataPag", {|| xTemp->DataPag}, )
         elseif nOpcao = 3
             ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Docnr", {|| xTemp->Docnr}, )
         elseif nOpcao = 4
             ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Emis", {|| xTemp->Emis}, )
         elseif nOpcao = 5
             ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Obs", {|| xTemp->Obs}, )
         elseif nOpcao = 6
             ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Port", {|| xTemp->Port}, )
         elseif nOpcao = 7
             ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Tipo", {|| xTemp->Tipo}, )
         elseif nOpcao = 8
             ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Vlr", {|| xTemp->Vlr}, )
         elseif nOpcao = 9
             ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->VlrPag", {|| xTemp->VlrPag}, )
         elseif nOpcao = 10
             ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Vcto", {|| xTemp->Vcto}, )
        endif
        oMenu:Limpa()
        if !InsTru80()
            ResTela( cScreen )
            Loop
        endif
        Mensagem("Aguarde, Processando Pesado.")
        Receber->( Order( 2 ))
        if ( ! .F. ) ; dbClearRelation() ; end ; dbSetRelation( "Receber", {|| xTemp->Codi}, "xTemp->Codi", .F. )
        xTemp->(DbGoTop())
        Prn001( dIni, dFim, Upper( AtPrompt[ nChoice ]) )
        xTemp->(DbClearRel())
        xTemp->(DbGoTop())
        ResTela( cScreen )
    EndDo
EndDo

Proc AgendaDbedit(nRecno)

LOCAL Arq_Ant    := Alias()
LOCAL Ind_Ant    := IndexOrd()
LOCAL cScreen    := SaveScreen()
LOCAL oBrowse    := MsBrowse():New()
IF nRecno == NIL ; nRecno := Agenda->(LastRec()) ; END
SetKey( -8, NIL )

oMenu:Limpa()
Receber->(Order(2))
dbSelectArea( "Agenda" )
Agenda->(Order(0))
if ( ! .F. ) ; dbClearRelation() ; end ; dbSetRelation( "Receber", {|| Agenda->Codi}, "Agenda->Codi", .F. )
Agenda->(DbGoTo(nRecno))

oBrowse:Add( "ID",        "Id")
oBrowse:Add( "CODI",      "Codi")

oBrowse:Add( "DATA",      "Data")
oBrowse:Add( "HORARIO",   "Hora")
oBrowse:Add( "HISTORICO", "Hist")
oBrowse:Titulo   := "CONSULTA/ALTERACAO DE AGENDAMENTO"
SetKey( -1,         {|| FiltraAgenda(oBrowse) } )
oBrowse:HotKey( -3, {|| oBrowse:Duplica()})
oBrowse:PreDoGet := {|| PreDoAgenda( oBrowse )}
oBrowse:PosDoGet := {|| PosDoAgenda( oBrowse )}
oBrowse:PreDoDel := NIL
oBrowse:PosDoDel := NIL
oBrowse:Show()
oBrowse:Processa()
AreaAnt( Arq_Ant, Ind_Ant )
ResTela( cScreen )

Function PosDoAgenda( oBrowse )

LOCAL oCol         := oBrowse:getColumn( oBrowse:colPos )
LOCAL cRegiao     := Space(02)
LOCAL Arq_Ant     := Alias()
LOCAL Ind_Ant     := IndexOrd()

Do Case
Case oCol:Heading = "REGIAO"
    cRegiao := Receber->Regiao
    RegiaoErrada( @cRegiao )
    Receber->Regiao := cRegiao
    AreaAnt( Arq_Ant, Ind_Ant )
OtherWise
EndCase
Agenda->Atualizado := Date()
return( .T. )

Function PreDoAgenda( oBrowse )

LOCAL oCol         := oBrowse:getColumn( oBrowse:colPos )
LOCAL Arq_Ant     := Alias()
LOCAL Ind_Ant     := IndexOrd()

if !PodeAlterar()
    return( .F.)
endif

Do Case
Case oCol:Heading = "CLIENTE"
   ErrorBeep()
    Alerta("Opa! Alteracao no permitida. Altere o cadastro do cliente..")
    return( .F. )

Case oCol:Heading = "CODIGO"
    ErrorBeep()
    Alerta("Opa! Nao pode alterar nao.")
    return( .F. )
OtherWise
EndCase
return( PodeAlterar() )



Function FiltraAgenda( oBrowse )

LOCAL Arq_Ant    := Alias()
LOCAL Ind_Ant    := IndexOrd()
LOCAL cScreen    := SaveScreen()
LOCAL cCodi

WHILE .T.
    oMenu:Limpa()
    Receber->(Order( 2 ))
    MaBox( 14 , 19 , 16 , 35 )
    cCodi := Space(05)
    SetCursor(1) ; DevPos( 15, 20 ) ; DevOut( "Cliente.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodi, "cCodi", "99999", {|| RecErrado( @cCodi )},))
    ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
    if LastKey() = 27
        Exit
    endif
    Agenda->(Order( 1 ))
    OrdScope( 0, cCodi)
    OrdScope( 1, cCodi )
    Agenda->(DbGoTop())
    if Sx_KeyCount() == 0
        OrdScope( 0 )
        OrdScope( 1 )
        Nada()
        ResTela( cScreen )
        Loop
    endif
    Exit
EndDo
ResTela( cScreen )
oBrowse:FreshOrder()
return

Proc AnexarAgendaAntiga()

LOCAL GetList    := {}
LOCAL cScreen    := SaveScreen()
LOCAL nConta    := 0
LOCAL dCalculo := Date()
LOCAL cString    := ""
LOCAL cCodi
LOCAL nValorTotal
LOCAL nTotalGeral
LOCAL aTodos
LOCAL aCabec
LOCAL nJuros
LOCAL cTela
LOCAL oBloco
LOCAL cRegiao
LOCAL dIni
LOCAL dFim
LOCAL Col
FIELD Regiao
FIELD Vcto
FIELD Juro
FIELD Codi
FIELD Docnr
FIELD Emis
FIELD Vlr
LOCAL oAgenda

ErrorBeep()
if !Conf("Pergunta: Tem absoluta certeza?")
    return
endif
oMenu:Limpa()
cCodi     := Space(05)
dIni        := Date()-30
dFim        := Date()
dCalculo := Date()
aTodos    := {}
aCodi     := {}
nConta    := 0
cTela     := Mensagem("Aguarde. Anexando registros da agenda velha.")
Receber->(Order( 2 ))
Receber->(DbGoTop())

While Receber->(!Eof())
    cCodi   := Receber->Codi
    oAgenda := TIniNew("AGE" + cCodi + ".INI")
    dAtual  := cTod("//")
    nConta := oAgenda:ReadInteger( cCodi, "soma", 0 )
    For nV = 1 To nConta
        cHist := oAgenda:ReadString( cCodi, StrZero(nV,2), Repl("_",40), 1)
        dData := oAgenda:ReadDate(   cCodi, StrZero(nV,2), cTod("//"), 2)
        if Agenda->(Incluiu())
            Agenda->Codi     := cCodi
            Agenda->Data     := dData
            Agenda->Hist     := cHist
            Agenda->Ultimo  := .F.
            Agenda->(Libera())
            Loop
        endif
    Next
    oAgenda:Close()
    Receber->(DbSkip(1))
EndDo
ResTela( cTela )

Proc AnexarLogRecibo()

LOCAL GetList    := {}
LOCAL cScreen    := SaveScreen()
LOCAL cFileLog := "RECIBO.LOG"
LOCAL xLog        := "RECIBO.TXT"
LOCAL xLixo     := "LIXO.TXT"
LOCAL nErro     := 0
LOCAL aRecibo    := {}
LOCAL Handle
LOCAL nNew
LOCAL nLixo

ErrorBeep()
if !Conf("Pergunta: Tem absoluta certeza?")
    return
endif
oMenu:Limpa()
cTela := Mensagem("FASE #1: Aguarde. Anexando registros do log.")
if !File( cFileLog )
    oMenu:Limpa()
    ErrorBeep()

    Alert("Erro: Arquivos de Log nao disponiveis.;" +     "Verifique os arquivos com extensao .LOG.")
    ResTela( cScreen )
    return
endif
Handle := Fopen( cFileLog )
if ( Ferror() <> 0 )
    ErroConfiguracaoArquivo( Handle, "Abertura do Arquivo", cFileLog )
    ResTela( cScreen )
    return
endif

if !File( xLog )
    nNew := Fcreate( xLog, 0 )
    FClose( nNew )
endif
nNew := FOpen( xLog, 2 + 64 )
if ( Ferror() <> 0 )
    return
endif

if !File( xLixo )
    nLixo := Fcreate( xLixo, 0 )
    FClose( nLixo )
endif
nLixo := FOpen( xLixo, 2 + 64 )
if ( Ferror() <> 0 )
    return
endif

nCount := FLineCount(Handle)
nSoma  := 0
Alerta("Registros no Log: " + Str(nCount))
While !HB_Feof( Handle )
    cLinha := FReadLine( Handle )
    if Left( cLinha, 6) = "BAIXAS" .OR. Left( cLinha, 6) = "RECIBO"
        FWriteLine( nNew, cLinha )
    else
        FWriteLine( nLixo, cLinha )
    endif
    Mensagem("Reg: " + Str(++nSoma))
EndDo
( Handle )->( dbCloseArea() )
( nNew )->( dbCloseArea() )
( nLixo )->( dbCloseArea() )



xLog := "RECIBO.TXT"
if !File( xLog )
    Handle := Fcreate( xLog, 0 )
    FClose( Handle )
endif
Handle := FOpen( xLog, 2 + 64 )
if ( Ferror() <> 0 )
    return
endif
cTela := Mensagem("FASE #2: Aguarde. Anexando registros no banco de dados.")
Receber->(Order( 2 ))
Recebido->(Order( 1 ))
dbSelectArea( "RECIBO" )
nSoma := 0
While nSoma <= 2285 .AND. !HB_Feof( Handle )
    cLinha    := FReadLine( Handle )
    cTipo     := Left( cLinha,6)
    cCodi     := SubStr( cLinha,08,5)
    cDocnr    := SubStr( cLinha,14,9)
    cHora     := SubStr( cLinha,24,8)
    dData     := cTod(SubStr( cLinha,33,8))
    cUsuario := SubStr( cLinha,42,10)
    cCaixa    := SubStr( cLinha,53,04)
    nVlr        := Val( SubStr(cLinha,58,18))
    cHist     := SubStr( cLinha,77,80)

    cNome     := Space(0)
    if Receber->(DbSeek( cCodi ))
        cNome := Receber->Nome
    endif

    dVcto     := cTod("//")
    if Recebido->(DbSeek( cDocnr ))
        dVcto := Recebido->Vcto
    elseif Recebido->(DbSeek( "Q"+ Right(cDocnr,8)))
        dVcto := Recebido->Vcto
    elseif Recebido->(DbSeek( "R"+ Right(cDocnr,8)))
        dVcto := Recebido->Vcto
    elseif Recebido->(DbSeek( "P"+ Right(cDocnr,8)))
        dVcto := Recebido->Vcto
    endif

    if Recibo->(Incluiu())
        Recibo->Nome     := cNome
        Recibo->Vcto     := dVcto

        Recibo->Tipo     := cTipo
        Recibo->Codi     := cCodi
        Recibo->Docnr     := cDocnr
        Recibo->Hora     := cHora
        Recibo->Data     := dData
        Recibo->Usuario := cUsuario
        Recibo->Caixa     := cCaixa
        Recibo->Vlr      := nVlr
        Recibo->Hist     := cHist
        Recibo->(Libera())
    endif
    nSoma++
EndDo



cTela := Mensagem("FASE #3: Aguarde. Anexando registros no banco de dados.")
While nSoma <= 9621 .AND. !HB_Feof( Handle )
    cLinha    := FReadLine( Handle )

    cTipo     := Left( cLinha,6)
    cCodi     := SubStr( cLinha,08,5)
    cNome     := SubStr( cLinha,14,40)
    cDocnr    := SubStr( cLinha,55,9)
    cHora     := SubStr( cLinha,65,8)
    dData     := cTod(SubStr( cLinha,74,8))
    cUsuario := SubStr( cLinha,83,10)
    cCaixa    := SubStr( cLinha,94,04)
    nVlr        := Val( SubStr(cLinha,99,18))
    cHist     := SubStr( cLinha,118,80)

    dVcto     := cTod("//")
    if Recebido->(DbSeek( cDocnr ))
        dVcto := Recebido->Vcto
    elseif Recebido->(DbSeek( "Q"+ Right(cDocnr,8)))
        dVcto := Recebido->Vcto
    elseif Recebido->(DbSeek( "R"+ Right(cDocnr,8)))
        dVcto := Recebido->Vcto
    elseif Recebido->(DbSeek( "P"+ Right(cDocnr,8)))
        dVcto := Recebido->Vcto
    endif

    if Recibo->(Incluiu())
        Recibo->Vcto     := dVcto
        Recibo->Nome     := cNome
        Recibo->Tipo     := cTipo
        Recibo->Codi     := cCodi
        Recibo->Docnr     := cDocnr
        Recibo->Hora     := cHora
        Recibo->Data     := dData
      Recibo->Usuario := cUsuario
        Recibo->Caixa     := cCaixa
        Recibo->Vlr      := nVlr
        Recibo->Hist     := cHist
        Recibo->(Libera())
    endif
    nSoma++
EndDo



cTela := Mensagem("FASE #4: Aguarde. Anexando registros no banco de dados.")
While nSoma > 9621 .AND. !HB_Feof( Handle )
    cLinha    := FReadLine( Handle )
    cTipo     := Left( cLinha,6)
    cCodi     := SubStr( cLinha,08,5)
    cNome     := SubStr( cLinha,14,40)
    cDocnr    := SubStr( cLinha,55,9)
    dVcto     := cTod(SubStr( cLinha,65,8))
    cHora     := SubStr( cLinha,74,8)
    dData     := cTod(SubStr( cLinha,83,8))
    cUsuario := SubStr( cLinha,92,10)
    cCaixa    := SubStr( cLinha,103,04)
    nVlr        := Val( SubStr(cLinha,108,18))
    cHist     := SubStr( cLinha,127,60)

    if Recibo->(Incluiu())
        Recibo->Vcto     := dVcto
        Recibo->Nome     := cNome
        Recibo->Tipo     := cTipo
        Recibo->Codi     := cCodi
        Recibo->Docnr     := cDocnr
        Recibo->Hora     := cHora
        Recibo->Data     := dData
        Recibo->Usuario := cUsuario
        Recibo->Caixa     := cCaixa
        Recibo->Vlr      := nVlr
        Recibo->Hist     := cHist
        Recibo->(Libera())
    endif
    nSoma++
EndDo
( Handle )->( dbCloseArea() )

Proc BidoToRecibo()

LOCAL GetList    := {}
LOCAL cScreen    := SaveScreen()

ErrorBeep()
if !Conf("Pergunta: Tem absoluta certeza?")
    return
endif
oMenu:Limpa()
cTela := Mensagem("FASE #1: Aguarde. Anexando registros do log.")

Vendedor->(Order( 1 ))
Receber->(Order( 2 ))
Recibo->(Order( 3 ))
Recebido->(Order( 1 ))
Recebido->(DbGotop())
While Recebido->(!Eof())
   if Recibo->(DbSeek( Recebido->Docnr ))
      Recebido->(DbSkip(1))
      Loop
   endif
    if Recibo->(Incluiu())
      Receber->(DbSeek( Recebido->Codi ))
      Recibo->Nome    := Receber->Nome
      Recibo->Codi    := Recebido->Codi
      Recibo->Vcto    := Recebido->Vcto
      Recibo->Tipo    := "RECIBO"
      Recibo->Docnr   := Recebido->Docnr
      Recibo->Hora    := Time()
      Recibo->Data    := Recebido->DataPag
      if Vendedor->(DbSeek( Recebido->Caixa ))
         Recibo->Usuario := Left(Vendedor->Nome, 10)
      endif
      Recibo->Caixa   := Recebido->Caixa
      Recibo->Vlr     := Recebido->VlrPag
      Recibo->Hist    := Recebido->Obs
        Recibo->(Libera())
    endif
   Recebido->(DbSkip(1))
EndDo
return

Proc JuroComposto()

LOCAL GetList    := {}
LOCAL cScreen    := SaveScreen()
LOCAL nJuro     := 0
LOCAL nJuroDia := 0
LOCAL cCodi     := Space(05)
LOCAL dData     := Date()
LOCAL nAtraso    := 0
LOCAL nAtraso1 := 0
LOCAL nJuros    := 0
LOCAL nBase     := 31
LOCAL nTotJr    := 0
LOCAL nX         := 0

LETO_SET( 3, 5 )
MaBox( 10, 05, 14, 78 )
SetCursor(1) ; DevPos( 11, 06 ) ; DevOut( "Cliente...............:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodi, "cCodi", "99999", {|| RecErrado( @cCodi,, Row(), Col()+1 )},))
SetCursor(1) ; DevPos( 12, 06 ) ; DevOut( "Taxa de Juros ao Mes..:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nJuro, "nJuro", "999.99",,))
SetCursor(1) ; DevPos( 13, 06 ) ; DevOut( "Calcular ate o dia....:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dData, "dData", "##/##/##",,))
ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
if LastKey() = 27
   LETO_SET( 3, 2 )
    ResTela( cScreen )
    return
endif
if Conf("Pergunta: Confirma atualizacao da taxa de juro ?")
    Recemov->(Order( 2 ))
    if Recemov->(DbSeek( cCodi ))
        Mensagem("Aguarde. Atualizando.")
        if Recemov->(TravaArq())
            WHILE Recemov->Codi = cCodi
            nTipo     := 6
            nAtraso   := dData - Recemov->Vcto
            nTxJuros  := TxEfetiva( nJuro, Recemov->Vcto, dData, nTipo )
            nCapital  := Recemov->Vlr
            nMontante := nCapital * nTxJuros
            nJuros    := nMontante - nCapital
            Recemov->Juro      := nTxJuros
            Recemov->JuroTotal := nJuros
            Recemov->JuroDia   := ( nJuros / nAtraso )
                Recemov->(DbSkip(1))
            EndDo
        endif
        Recemov->(Libera())
        ResTela( cScreen )
        ErrorBeep()
        Alerta("Informa: Taxas Atualizadas.")
    endif
endif
LETO_SET( 3, 2 )

Function TxEfetiva( nJuroMes, dVcto, dAtual, nTipo )

LOCAL nPeriodo
LOCAL nTxJuros
if( nTipo = NIL, nTipo := 1, nTipo )

nAtraso       := (dAtual - dVcto)
nPeriodo      := nAtraso / (if(lAnoBissexto(dAtual), 366, 365))
if nTipo = 1
   nTxEfetiva := (((1 + nJuroMes/100)^12)-1)*100
   nTxJuros   := ((1 + nTxEfetiva/100)^nPeriodo)
elseif nTipo = 2
   nTxEfetiva := (((1 + nJuroMes/100)^6)-1)*100
elseif nTipo = 3
   nTxEfetiva := (((1 + nJuroMes/100)^3)-1)*100
elseif nTipo = 4
   nTxEfetiva := (((1 + nJuroMes/100)^2)-1)*100
elseif nTipo = 5
   nTxEfetiva := (((1 + nJuroMes/100)^(7/30))-1)*100
elseif nTipo = 6
   nTxEfetiva := (((1 + nJuroMes/100)^(1/30))-1)*100
   nTxJuros   := ((1 + nTxEfetiva/100)^nAtraso)
endif
return( nTxJuros )



























































Proc MenuTxJuros( nChoice )

LOCAL GetList  := {}
LOCAL cScreen  := SaveScreen()
LOCAL aMenu1   := {"Geral","Individual"}
LOCAL aMenu2   := {"Juros Simples","Juros Composto","Juros Capitalizado","Juros Sobre Juro"}
LOCAL nChoice1 := 0
LOCAL nChoice2 := 0

WHILE .T.
    oMenu:Limpa()
   if nChoice = NIL
      M_Title("ESCOLHA ALCANCE" )
      nChoice1 := FazMenu( 02, 05, aMenu1 )
      if nChoice1 = 0
         ResTela( cScreen )
         Exit
      else
         if nChoice1 = 1
            nChoice = 3.03
         elseif nChoice1 = 2
            nChoice = 3.04
         endif
      endif
   endif
   WHILE .T.
      M_Title("ESCOLHA TIPO DE CALCULO" )
      nChoice2  := FazMenu( 04, 05, aMenu2 )
      if nChoice2 = 0
         Restela( cScreen)
         Exit
      endif
      Do Case
      Case nChoice2 = 0
         ResTela( cScreen )
         Exit

      Case nChoice = 3.03 .AND. nChoice2 = 1
         AltJrGeral(1, oAmbiente:aSciArray[1,1])

      Case nChoice = 3.03 .AND. nChoice2 >= 2
         AltJrGeral(2, oAmbiente:aSciArray[1,8])

      Case nChoice = 3.04 .AND. nChoice2 = 1
         AltJrInd(1, oAmbiente:aSciArray[1,1])

      Case nChoice = 3.04 .AND. nChoice2 >= 2
         AltJrInd(2, oAmbiente:aSciArray[1,8])
     EndCase
   EndDo
   if LastKey() = 27
      Exit
   endif
EndDo

Function AltJrInd( nChoice, nJuro, xCodi, lMsg, oSender)

LOCAL GetList    := {}
LOCAL cScreen    := SaveScreen()
LOCAL nJuroDia   := 0
LOCAL nValorCm   := 0
LOCAL nVlr       := 0
LOCAL nCm        := 0
LOCAL nJuroTotal := 0
LOCAL dVcto      := Date()
LOCAL dData      := Date()
LOCAL cCodi      := Space(05)
LOCAL aJuro      := {}
LOCAL lResult
hb_default(@nJuro, oAmbiente:aSciArray[1,8])

if xCodi = NIL
   MaBox( 12, 05, 16, 78 )
   SetCursor(1) ; DevPos( 13, 06 ) ; DevOut( "Cliente...............:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodi, "cCodi", "99999", {|| RecErrado( @cCodi,, Row(), Col()+1 )},))
   SetCursor(1) ; DevPos( 14, 06 ) ; DevOut( "Taxa de Juros ao Mes..:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nJuro, "nJuro", "999.99",,))
   SetCursor(1) ; DevPos( 15, 06 ) ; DevOut( "Atualizar ate Data....:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dData, "dData", "##/##/##",,))
   ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
   if LastKey() = 27
      ResTela( cScreen )
      return
   endif
else
   cCodi := xCodi
    if oSender <> nil
        dData := oSender:dCalculo
    endif
    if nJuro <= 0 .OR. nJuro == NIL
        nJuro := 1
       MaBox( 13, 05, 15, 78 )
       SetCursor(1) ; DevPos( 14, 06 ) ; DevOut( "Taxa de Juros ao Mes..:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nJuro, "nJuro", "999.99", {|| nJuro > 0},))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        if LastKey() = 27
            ResTela( cScreen )
            return( lResult := .F. )
        endif
        oini:WriteInteger( "financeiro", "JuroMesComposto", nJuro )
       oAmbiente:aSciArray[1,8] := nJuro
        lMsg    := .T.
        lResult := .T.
    endif
endif

if lMsg = NIL
   lResult := Conf("Pergunta: Confirma atualizacao da taxa de juro ?")
else
   lResult := .T.
endif
if lResult
    Recemov->(Order( 2 ))
    if Recemov->(DbSeek( cCodi ))
      if lMsg = NIL
         Mensagem("Aguarde. Atualizando.")
      endif
        if Recemov->(TravaArq())
         WHILE Recemov->Codi = cCodi .AND. LastKey() <> 27
            if lMsg = NIL
               Mensagem("Aguarde. Atualizando Taxas de Juros # " + Recemov->(Barra()))
            endif
            if nJuro <> 0
               dVcto              := Recemov->Vcto
               nVlr               := Recemov->Vlr
               nDias              := (dData-dVcto)
               nValorCm           := CalculaCm(nVlr, dVcto, dData)
               nCm                := (nValorCm - nVlr)
               if nChoice = 1
                  nJuroDia        := JuroDia( nValorCm, nJuro, (1/30))
                  nJuroTotal      := (nJuroDia * nDias)
                  nJuroTotal      += nCm
                  nJuroDia        := (nJuroTotal / nDias)
               else
                  aJuro           := aAntComposto( nValorCm, nJuro, nDias, (1/30))
                  nJuroDia        := aJuro[6]
                  nJuroTotal      := aJuro[5]
                  nJuroTotal      += nCm
                  nJuroDia        := (nJuroTotal / nDias)
               endif
               Recemov->Juro      := nJuro
               Recemov->JuroDia   := nJuroDia
               Recemov->JuroTotal := nJuroTotal
            else
               Recemov->Juro      := 0
               Recemov->JuroDia   := 0
               Recemov->JuroTotal := 0
            endif
            Recemov->(DbSkip(1))
            if LastKey() = 27
               if Conf("Pergunta: Cancelar?")
                  Exit
               endif
            endif
         EndDo
        endif
        Recemov->(Libera())
        ResTela( cScreen )
      if lMsg = NIL
         ErrorBeep()
         Alerta("Informa: Taxas Atualizadas.")
      endif
    endif
endif
return lResult

function CalcCmJuros( nChoice, nJuro, nVlr, dVcto, dData)

LOCAL nDias      := 0
LOCAL nValorCm   := 0
LOCAL nCm        := 0
LOCAL nJuroDia   := 0
LOCAL nJuroTotal := 0
LOCAL aJuro      := {}

__DefaultNIL(@nChoice, 1)
__DefaultNIL(@nJuro, oAmbiente:aSciArray[1,8])
__DefaultNIL(@nVlr, 0)
__DefaultNIL(@dVcto, Date())
__DefaultNIL(@dData, Date())

aJuro              := {}
nDias              := (dData-dVcto)
nValorCm           := CalculaCm(nVlr, dVcto, dData)
nCm                := (nValorCm - nVlr)
if nChoice = 1
   nJuroDia        := JuroDia( nValorCm, nJuro, (1/30))
   nJuroTotal      := (nJuroDia * nDias)
   nJuroTotal      += nCm
   nJuroDia        := (nJuroTotal / nDias)
else
   aJuro           := aAntComposto( nValorCm, nJuro, nDias, (1/30))
   nJuroDia        := aJuro[6]
   nJuroTotal      := aJuro[5]
   nJuroTotal      += nCm
   nJuroDia        := (nJuroTotal / nDias)
endif
return({nJuro, nJurodia, nJuroTotal})


Proc AltJrGeral(nChoice, nJuro)

LOCAL GetList    := {}
LOCAL aJuro      := {}
LOCAL cScreen    := SaveScreen()
LOCAL nJuroDia   := 0
LOCAL nJuroTotal := 0
LOCAL nValorCm   := 0
LOCAL nCm        := 0
LOCAL nVcto      := 0
LOCAL dData      := Date()
LOCAL nDias      := 0

MaBox( 12, 05, 15, 54 )
SetCursor(1) ; DevPos( 13, 06 ) ; DevOut( "Entre com a Taxa de Juros...:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nJuro, "nJuro", "999.99",,))
SetCursor(1) ; DevPos( 14, 06 ) ; DevOut( "Atualizar ate Data..........:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dData, "dData", "##/##/##",,))
ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
if LastKey() = 27
    ResTela( cScreen )
    return
endif
if Conf("Pergunta: Confirma atualizacao geral da taxa de juro ?")
   oMenu:Limpa()
   Mensagem("Aguarde. Atualizando.")
    if Recemov->(TravaArq())
      Recemov->(Order(0))
      Recemov->(DbGoTop())
      WHILE Recemov->(!Eof()) .AND. LastKey() <> 27
         Mensagem(" Aguarde. Atualizando Taxas de Juros # " + Recemov->(Barra()))
         if nJuro <> 0
            dVcto              := Recemov->Vcto
            nVlr               := Recemov->Vlr
            nDias              := (dData-dVcto)
            nValorCm           := CalculaCm(nVlr, dVcto, dData)
            nCm                := (nValorCm - nVlr)
            if nChoice = 1
               nJuroDia        := JuroDia( nValorCm, nJuro, (1/30))
               nJuroTotal      := (nJuroDia * nDias)
               nJuroTotal      += nCm
               nJuroDia        := (nJuroTotal / nDias)
            else
               aJuro           := aAntComposto( nValorCm, nJuro, nDias, (1/30))
               nJuroDia        := aJuro[6]
               nJuroTotal      := aJuro[5]
               nJuroTotal      += nCm
               nJuroDia        := (nJuroTotal / nDias)
            endif
            Recemov->Juro      := nJuro
            Recemov->JuroDia   := nJuroDia
            Recemov->JuroTotal := nJuroTotal
         else
            Recemov->Juro      := 0
            Recemov->JuroDia   := 0
            Recemov->JuroTotal := 0
         endif
            Recemov->(DbSkip(1))
         if LastKey() = 27
            if Conf("Pergunta: Cancelar?")
               Exit
            endif
         endif
        EndDo
        Recemov->(Libera())
        ResTela( cScreen )
        ErrorBeep()
        Alerta("Informa: Taxas Atualizadas.")
    endif
endif



Function BidoGrafico(nOp)

LOCAL cScreen := SaveScreen()
LOCAL aMenu   := {"Por Cliente", "Mensal Por Ano", "Ultimos 12 anos"}
LOCAL cScreen1
LOCAL nChoice

WHILE .T.
    DbClearFilter()
    DbGoTop()
   M_Title("GRAFICO DE CONTAS RECEBIDAS" )
   nChoice  := FazMenu( 06, 10, aMenu )
    cScreen1 := SaveScreen()
    Do Case
    Case nChoice = 0
        ResTela( cScreen )
        Exit

    Case nChoice = 1
      cCodi := Space( 05 )
      WHILE .T.
         dbSelectArea( "Receber" )
         Receber->(Order( 2 ))
         MaBox( 13, 10, 15, 78 )
         SetCursor(1) ; DevPos( 14, 11 ) ; DevOut( "Cliente...: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodi, "cCodi", "99999", {|| RecErrado( @cCodi,, Row(), Col()+1 )},))
         ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
         if LastKey() = 27
            ResTela( cScreen1 )
            Exit
         endif
         GrafBidoCodigo(cCodi, nOp)
         ResTela(cScreen1)
      ENDDO

    Case nChoice = 2
      GrafBidoGeral(nOp)
      ResTela(cScreen1)

    Case nChoice = 3
      GrafBidoAnual(nOp)
      ResTela(cScreen1)

    EndCase
EndDo



Proc GrafBidoCodigo(cCodi, nOp)

LOCAL cScreen  := SaveScreen()
LOCAL nBase    := 1
LOCAL nAnual   := 0
LOCAL lFiltrar := .T.
LOCAL aDataIni := {}
LOCAL aDataFim := {}
LOCAL nConta   := 0
LOCAL cValor   := ""
LOCAL aMes[12,2]
LOCAL aValor[12,2]
PRIVA cAno     := Space(02)

MaBox( 16, 10, 18, 45 )
SetCursor(1) ; DevPos( 17, 11 ) ; DevOut( "Entre o ano para Grafico...:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cAno, "cAno", "99", {|| if(Empty(cAno), ( ErrorBeep(), Alerta("Ooops!: Entre com o ano!", nil , 31), .F. ), .T. )},))
ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
if LastKey() = 27
    return(Restela(cScreen))
endif

oMenu:Limpa()
if     nOp = 1
   oAmbiente:cTipoRecibo := "RECCAR"
elseif nOp = 2
   oAmbiente:cTipoRecibo := "RECBCO"
elseif nOp = 3
   oAmbiente:cTipoRecibo := "RECOUT"
elseif nOp = 5
   oAmbiente:cTipoRecibo := "PAGDIA"
elseif nOp = 6
   oAmbiente:cTipoRecibo := "PAGDIV"
else
   lFiltrar := .F.
endif
aDataIni := aMesIniMesFim(cAno)[1]
aDataFim := aMesIniMesFim(cAno)[2]

dbSelectArea( "Recebido" )
Recebido->(Order( 4 ))
Recebido->(OrdScope( 0, cCodi))
Recebido->(OrdScope( 1, cCodi ))
Recebido->(DbGoTop())
Mensagem("Aguarde, calculando valores.")

For nX := 1 To 12
    ContaReg()
   aMes[nX,1] := 0
   aValor[nX,1] := 0 ; dbEval( {|| aValor[nX,1] := aValor[nX,1] + Recebido->VlrPag }, {|| Recebido->DataPag >= aDataIni[nX] .AND. Recebido->DataPag <= aDataFim[nX]},,,, .F. )
    aMes[nX,1] += aValor[nX,1]
   nAnual     += aValor[nX,1]
Next
Recebido->(OrdScope( 0 ))
Recebido->(OrdScope( 1 ))
Recebido->(DbGoTop())

dbSelectArea( "Recibo" )
Recibo->(Order( 2 ))
Recibo->(OrdScope( 0, cCodi))
Recibo->(OrdScope( 1, cCodi ))
Recibo->(DbGotop())
For nX := 1 To 12
    ContaReg()
   if lFiltrar
      aValor[nX,1] := 0 ; dbEval( {|| aValor[nX,1] := aValor[nX,1] + Recibo->Vlr }, {|| Recibo->Data >= aDataIni[nX] .AND. Recibo->Data <= aDataFim[nX] .AND. Recibo->Tipo = oAmbiente:cTipoRecibo},,,, .F. )
   else
      aValor[nX,1] := 0 ; dbEval( {|| aValor[nX,1] := aValor[nX,1] + Recibo->Vlr }, {|| Recibo->Data >= aDataIni[nX] .AND. Recibo->Data <= aDataFim[nX]},,,, .F. )
   endif
   aMes[nX,1] += aValor[nX,1]
   nAnual     += aValor[nX,1]
Next
Recibo->(OrdScope( 0 ))
Recibo->(OrdScope( 1 ))
Recibo->(DbGoTop())

aMes   := aMesIniMesFim(cAno, aValor)[3]
cNome  := Receber->( ltrim(rtrim(Nome)) )
cValor := "R$" + ltrim(rtrim(Tran( nAnual, "@E 9,999,999,999.99")))

SetColor("")
Scroll() ; SetPos( 0, 0 )
Grafico( aMes, .T., "EVOLUCAO MENSAL DE TITULOS RECEBIDOS - &cNome.", cValor, ltrim(rtrim(oAmbiente:xNomefir)), nBase )
Inkey(0)
oAmbiente:cTipoRecibo := NIL
return(ResTela( cScreen))



Function GrafBidoGeral(nOp)

LOCAL cScreen  := SaveScreen()
LOCAL nBase    := 1
LOCAL nAnual   := 0
LOCAL lFiltrar := .T.
LOCAL aMes[12,2]
LOCAL aValor[12,2]
LOCAL aDataIni
LOCAL aDataFim
LOCAL dIni
LOCAL dFim
LOCAL nConta
LOCAL cValor
PRIVA cAno      := Space(02)

MaBox( 13, 10, 15, 45 )
SetCursor(1) ;