#line 12 "c:\sci\include\rddName.ch"
    EXTERNAL leto
    EXTERNAL DBFNTX
   EXTERNAL DBFCDX


    EXTERNAL DBFFPT
    EXTERNAL SIXCDX
    EXTERNAL DBFNSX
    EXTERNAL HB_MEMIO
#line 23 "lista1la.prg"
Proc FormaRelatorio()

LOCAL cScreen := SaveScreen()
LOCAL Tam      := 93
LOCAL Col      := 58
LOCAL Pagina  := 0

if !InsTru80()
    ResTela( cScreen )
    return
endif

dbSelectArea( "Forma" )
Forma->(Order( 1 ))
Forma->(DbGoTop())
Mensagem("Aguarde, Imprimindo", 47 )
PrintOn()
FPrint( _CPI12 )
WHILE !Eof() .AND. Rel_Ok()
    if Col >= 58
        Write( 00, 00, Linha1( Tam, @Pagina))
        Write( 01, 00, Linha2())
        Write( 02, 00, Linha3(Tam))
        Write( 03, 00, Linha4(Tam, SISTEM_NA2 ))
        Write( 04, 00, Padc( "LISTAGEM DE FORMAS DE PAGAMENTO",Tam ) )
        Write( 05, 00, Linha5(Tam))
        Write( 06, 00, "ID CONDICOES DE PAGTO                        DESCRICAO                               COMISSAO")
        Write( 07, 00, Linha5(Tam))
        Col := 8
    endif
    Forma->(Qout( Forma, Condicoes, Descricao, Str( Comissao, 5,2 )))
    Col++
    if Col >= 58 .OR. Eof()
        Write( Col, 0,  Repl( "-", Tam ))
        __Eject()
    endif
    Forma->(DbSkip(1))
EndDo
PrintOff()
ResTela( cScreen )
return

Proc IniPequena()

PrintOn()
FPrint( RESETA     )
FPrint( _SALTOOFF )
FPrint( PQ            )
return

Function MostraCodigo( cCodiIni, nCol, nRow)

LOCAL aRotina              := {{||InclusaoProdutos() }}
LOCAL aRotinaAlteracao := {{||InclusaoProdutos(.T.) }}
LOCAL Arq_Ant              := Alias()
LOCAL Ind_Ant              := IndexOrd()

cCodiIni := StrCodigo( cCodiIni )
dbSelectArea( "Lista" )
Lista->(Order( 2 ))
if !DbSeek( cCodiIni )
    Lista->(Order( 3 ))
    Escolhe( 03, 01, 22,"Codigo + '? + Descricao + '? + Sigla","CODIG DESCRICAO DO PRODUTO                     SIGLA", aRotina,,aRotinaAlteracao )
    cCodiIni := Codigo
endif
Write( nCol, nRow, Descricao )
AreaAnt( Arq_Ant, Ind_Ant )
return( .T. )

Proc GraficoVenda()

LOCAL cScreen := SaveScreen()
LOCAL MilharesCruzeiros := 1
LOCAL M[12,2]
LOCAL aDataIni
LOCAL aDataFim
LOCAL nConta
PRIVA cAno := Space(02)

MaBox( 10, 10, 12, 42 )
SetCursor(1) ; DevPos( 11, 11 ) ; DevOut( "Grafico de Vendas do Ano :" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cAno, "cAno", "99",,))
ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
if LastKey() = 27
    Restela( cScreen )
    return
endif
oMenu:Limpa()
dbSelectArea( "Saidas" )
Saidas->(Order( 4 ))
Saidas->(DbGoTop())



aDataIni := { Ctod( "01/01/" + cAno ), Ctod( "01/02/" + cAno ), Ctod( "01/03/" + cAno ), Ctod( "01/04/" + cAno ), Ctod( "01/05/" + cAno ), Ctod( "01/06/" + cAno ), Ctod( "01/07/" + cAno ), Ctod( "01/08/" + cAno ), Ctod( "01/09/" + cAno ), Ctod( "01/10/" + cAno ), Ctod( "01/11/" + cAno ), Ctod( "01/12/" + cAno ) }




aDataFim := {Ctod( "31/01/" + cAno ), Ctod( "28/02/" + cAno ), Ctod( "31/03/" + cAno ), Ctod( "30/04/" + cAno ), Ctod( "31/05/" + cAno ), Ctod( "30/06/" + cAno ), Ctod( "31/07/" + cAno ), Ctod( "31/08/" + cAno ), Ctod( "30/09/" + cAno ), Ctod( "31/10/" + cAno ), Ctod( "30/11/" + cAno ), Ctod( "31/12/" + cAno )}

Mensagem( "Aguarde... Calculando Valores.", 47 )
nTotal     := 0
For nX := 1 To 12
     M[nX,1] := 0
Next
LETO_SET( 9, "On" )
DbSeek( aDataIni[1])
LETO_SET( 9, "Off" )
WHILE !Eof() .AND. ( nAno := Right(StrZero(Year( Emis ),4),2)) = cAno .AND. Rep_Ok()
     if nAno <> cAno
         DbSkip()
         Loop
    endif
    nMes            := Month( Emis )
    cMes            := StrZero( nMes,2)
    M[ nMes, 1] += ( Pvendido * Saida )
    DbSkip()
EndDO
M[1,2]="JAN" ; M[2,2]="FEV" ; M[3,2]="MAR" ; M[4,2]="ABR" ; M[5,2]="MAI" ; M[6,2]="JUN"
M[7,2]="JUL" ; M[8,2]="AGO" ; M[9,2]="SET" ; M[10,2]="OUT"; M[11,2]="NOV" ; M[12,2]="DEZ"

SetColor("")
Scroll() ; SetPos( 0, 0 )

Grafico( M,.T., "EVOLUCAO MENSAL DAS VENDAS  - &cAno.","EM MILHARES", XNOMEFIR, 1000 )
Inkey(0)
ResTela( cScreen )
return

Proc GraficoCompra()

LOCAL cScreen := SaveScreen()
LOCAL MilharesCruzeiros := 1
LOCAL M[12,2]
LOCAL aDataIni
LOCAL aDataFim
LOCAL nConta
PRIVA cAno := Space(02)
MaBox( 10, 10, 12, 42 )
SetCursor(1) ; DevPos( 11, 11 ) ; DevOut( "Grafico de Compra do Ano :" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cAno, "cAno", "99",,))
ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
if LastKey() = 27
    Restela( cScreen )
    return
endif
oMenu:Limpa()
dbSelectArea( "Entradas" )
Entradas->(Order( 3 ))
Entradas->(DbGoTop())



aDataIni := { Ctod( "01/01/" + cAno ), Ctod( "01/02/" + cAno ), Ctod( "01/03/" + cAno ), Ctod( "01/04/" + cAno ), Ctod( "01/05/" + cAno ), Ctod( "01/06/" + cAno ), Ctod( "01/07/" + cAno ), Ctod( "01/08/" + cAno ), Ctod( "01/09/" + cAno ), Ctod( "01/10/" + cAno ), Ctod( "01/11/" + cAno ), Ctod( "01/12/" + cAno ) }




aDataFim := {Ctod( "31/01/" + cAno ), Ctod( "28/02/" + cAno ), Ctod( "31/03/" + cAno ), Ctod( "30/04/" + cAno ), Ctod( "31/05/" + cAno ), Ctod( "30/06/" + cAno ), Ctod( "31/07/" + cAno ), Ctod( "31/08/" + cAno ), Ctod( "30/09/" + cAno ), Ctod( "31/10/" + cAno ), Ctod( "30/11/" + cAno ), Ctod( "31/12/" + cAno )}

Mensagem( "Aguarde... Calculando Valores.", 47 )
nTotal     := 0
For nX := 1 To 12
     M[nX,1] := 0
Next
LETO_SET( 9, "On" )
DbSeek( aDataIni[1])
LETO_SET( 9, "Off" )
WHILE !Eof() .AND. ( nAno := Right(StrZero(Year( Data ),4),2)) = cAno .AND. Rep_Ok()
     if nAno <> cAno
         DbSkip()
         Loop
    endif
    nMes            := Month( Data )
    cMes            := StrZero( nMes,2)
    M[ nMes, 1] += ( Pcusto * Entrada )
    DbSkip()
EndDO
oMenu:Limpa()
M[1,2]="JAN" ; M[2,2]="FEV" ; M[3,2]="MAR" ; M[4,2]="ABR" ; M[5,2]="MAI" ; M[6,2]="JUN"
M[7,2]="JUL" ; M[8,2]="AGO" ; M[9,2]="SET" ; M[10,2]="OUT"; M[11,2]="NOV" ; M[12,2]="DEZ"

SetColor("")
Scroll() ; SetPos( 0, 0 )

Grafico( M,.T., "EVOLUCAO MENSAL DAS COMPRAS  - &cAno.","EM MILHARES",    XNOMEFIR, 1000 )
Inkey(0)
ResTela( cScreen )
return

Proc DebitoValor()

LOCAL cScreen        := SaveScreen()
LOCAL nSubTotal    := 0
LOCAL nTotal        := 0
LOCAL nSobra        := 0
LOCAL nJuro         := 0
LOCAL nSubJuros    := 0
LOCAL nTotalJuros := 0
LOCAL dIni            := Date()-30
LOCAL dFim            := Date()

oMenu:Limpa()
WHILE .T.
    MaBox( 10, 10, 14, 40 )
    SetCursor(1) ; DevPos( 11, 11 ) ; DevOut( "Taxa Juros Mes : " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nJuro, "nJuro", "99.99",,))
    SetCursor(1) ; DevPos( 12, 11 ) ; DevOut( "Data Inicial...: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dIni, "dIni", "##/##/##",,))
    SetCursor(1) ; DevPos( 13, 11 ) ; DevOut( "Data Final.....: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dFim, "dFim", "##/##/##",,))
    ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
    if LastKey() = 27
        Saidas->(DbClearRel())
        ResTela( cScreen )
        Exit
    endif
    Lista->(Order( 2 ))
    dbSelectArea( "Saidas" )
    if ( ! .F. ) ; dbClearRelation() ; end ; dbSetRelation( "Lista", {|| Codigo}, "Codigo", .F. )
    Saidas->(Order( 5 ))
    Saidas->(DbGotop())
    nSubTotal    := 0
    nTotal        := 0
    nSobra        := 0
    nTotalJuros := 0
    cTela := Mensagem(" Aguarde... Verificando Movimento.", Cor())
    WHILE !Eof() .AND. Rep_OK()
        if !Saidas->c_c
            Saidas->(DbSkip(1))
            Loop
        endif
        if Saidas->Saida = Saidas->SaidaPaga
            Saidas->(DbSkip(1))
            Loop
        endif
        if Saidas->Data < dIni .OR. Saidas->Data > dFim
            Saidas->(DbSkip(1))
            Loop
        endif
        nSobra    := ( Saidas->Saida - Saidas->SaidaPaga )
        nConta    := Pvendido * nSobra
        nJurodia := 0
        nJdia     := 0
        nAtraso    := 0
        nAtraso := ( Date() - Data ) - 30
        if nAtraso > 1
            nJdia       := JuroDia( nConta, nJuro )
            nJuroDia   := ( nJdia * nAtraso )
        endif
        nTotal        += nConta
        nTotalJuros += nConta + nJurodia
        Saidas->(DbSkip(1))
    EndDo
    ResTela( cTela )

    Alert("Total.....: " + Tran( nTotal,      "@E 99,999,999.99") +     ";Com Juros.: " + Tran( nTotalJuros, "@E 99,999,999.99"))
    ResTela( cScreen )
EndDo

Function AchaDocEntrada( cDocnr )

LOCAL Arq_Ant := Alias()
LOCAL Ind_Ant := IndexOrd()

Entradas->(Order( 2 ))
if Entradas->(!DbSeek( cDocnr ))
    Entradas->(Escolhe( 03, 01, 22,"Fatura","FATURA" ))
    cDocnr := Entradas->Fatura
endif
AreaAnt( Arq_Ant, Ind_Ant )
return( .T. )

Proc ImprimePorFornecedor( nIndice )

LOCAL GetList        := {}
LOCAL cScreen        := SaveScreen( )
LOCAL nChoice        := 0
LOCAL nCop            := 1
LOCAL Tam            := 93
LOCAL Col            := 58
LOCAL Choice        := 0
LOCAL Var            := 0
LOCAL Var1            := 0
LOCAL Pagina, cTitulo
MaBox( 10, 59, 12, 77 )
SetCursor(1) ; DevPos( 11, 60 ) ; DevOut( "Qtde Copias " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nCop, "nCop", "999", {|| nCop > 0},))
ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
if LastKey() = 27
    ResTela( cScreen )
    return
endif
if !Instru80()
    ResTela( cScreen )
    return
endif
For I := 1 To nCop
    Pagina := 0
    Col     := 58
    if i >= 2
        DbGoTop()
    endif
    PrintOff()
    Mensagem( "Aguarde ... Imprimindo Copia N?" + StrZero(I,4), 47 )
    PrintOn()
    Tam      := 132
    FPrint( PQ )
    SetPrc( 0, 0 )
    cTitulo := "RELATORIO DE FORNECEDOR DE PRODUTOS"
    WHILE !Eof() .AND. REL_OK()
        if Col >= 56
            Write( 00, 00, Linha1(Tam, @Pagina))
            Write( 01, 00, Linha2())
            Write( 02, 00, Linha3(Tam))
            Write( 03, 00, Linha4(Tam, SISTEM_NA2 ))
            Write( 04, 00, Padc( cTitulo, Tam ) )
            Write( 05, 00, Linha5(Tam))
            Write( 06, 00, "ID   DESCRICAO DO PRODUTO                     ESTOQUE  FORNECEDOR TELEFONE       FORNECEDOR TELEFONE       FORNECEDOR TELEFONE")
            Write( 07, 00, Linha5(Tam))
            Col := 8
        endif
        Pagar->(Order( 2 ))
        Qout( Codigo, Ponto( Left(Descricao,39),39), Tran( Quant, "99999.99 "))
        if ( ! .F. ) ; dbClearRelation() ; end ; dbSetRelation( "Pagar", {|| Codi1}, "Codi1", .F. )
        Pagar->(QQout( Sigla, Fone + " "))
        Lista->(DbClearRel())

        if ( ! .F. ) ; dbClearRelation() ; end ; dbSetRelation( "Pagar", {|| Codi2}, "Codi2", .F. )
        Pagar->(QQout( Sigla, Fone + " "))
        Lista->(DbClearRel())

        if ( ! .F. ) ; dbClearRelation() ; end ; dbSetRelation( "Pagar", {|| Codi3}, "Codi3", .F. )
        Pagar->(QQout( Sigla, Fone + " "))
        Lista->(DbClearRel())
        Col++
        DbSkip()
        if Col >= 56 .OR. Eof()
            Write( Col, 0, Repl( "-", Tam ))
            __Eject()
        endif
    EndDo
    if !Rel_Ok()
        Exit
    endif
Next
PrintOff()
ResTela( cScreen )
return

Proc AjustaIcms()

LOCAL GetList     := {}
LOCAL cScreen     := SaveScreen()
LOCAL nTx_Icms  := 0
LOCAL cSituacao := Space(01)
LOCAL cClasse     := Space(02)
LOCAL cTela

MaBox( 10, 10, 14, 50 )
SetCursor(1) ; DevPos( 11, 11 ) ; DevOut( "Entre com a Situacao Tributaria...:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cSituacao, "cSituacao", "9", {|| PickSituacao( @cSituacao )},))
SetCursor(1) ; DevPos( 12, 11 ) ; DevOut( "Entre com a Classificacao Fiscal..:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cClasse, "cClasse", "99", {|| PickClasse( @cClasse )},))
SetCursor(1) ; DevPos( 13, 11 ) ; DevOut( "Entre com a Taxa de Icms..........:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nTx_Icms, "nTx_Icms", "999", {|| PickTaxa( nTx_Icms, cClasse )},))
ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
if LastKey() = 27
    return
endif
ErrorBeep()
if !Conf("Pergunta: Confirma atualizacao  ?")
    return
endif
dbSelectArea( "Lista" )
Lista->(DbGoTop())
cTela := Mensagem("Aguarde, Atualizando.")
WHILE Lista->(!Eof())
    if Lista->Classe = cClasse
        if Lista->(TravaReg())
            Lista->Tx_Icms  := nTx_Icms
            Lista->Situacao := cSituacao
            Lista->(Libera())
        endif
    endif
    Lista->(DbSkip(1))
EndDo
ResTela( cSCreen )
return

Proc PickTaxa( nTx_Icms, cClasse )

if LastKey() = 5
    return( .T. )
endif
if nTx_Icms = 0
    ErrorBeep()
    Alerta("Erro: Taxa Invalida.")
    return( .F. )
endif
if cClasse = "10" .OR. cClasse = "30"
    return( .T. )
endif
ErrorBeep()
Alerta("Erro: Classificacao Fiscal Invalida.")
return( .F. )

Proc Totalizado()

LOCAL cScreen        := SaveScreen()
LOCAL Tam            := 132
LOCAL nRegistros    := 0
LOCAL nMediaAta    := 0
LOCAL nMediaVar    := 0
LOCAL nItens        := 0
LOCAL nTotalCusto := 0
LOCAL nTotalVenda := 0

if !InsTru80()
     ResTela( cScreen )
     return
endif
Mensagem(" Aguarde... Imprimindo. ESC Cancela.")
PrintOn()
FPrint( PQ )
SetPrc( 0, 0 )
Write( 01, 00, Padr( "Pagina N?001", ( Tam/2 ) ) + Padl( Time(), ( Tam/2 ) ) )
Write( 02, 00, Date() )
Write( 03, 00, Padc( XNOMEFIR, Tam ) )
Write( 04, 00, Padc( SISTEM_NA2, Tam ) )
Write( 05, 00, Padc( "RELATORIO DA POSICAO FISICO/FINANCEIRO DO ESTOQUE",Tam ) )
Write( 06, 00, Repl( "-", Tam ))
Write( 07, 00,"REGISTRADOS  ITENS NO ESTOQUE    TOTAL PRECO CUSTO  TOTAL PRECO VENDA    MARGEM MD ATA    MARGEM MD VAR")

dbSelectArea( "Lista" )
Lista->(DbGoTop())
WHILE Lista->(!Eof()) .AND. Rel_Ok()
    nRegistros++
    nMediaAta    += Lista->MarAta
    nMediaVar    += Lista->MarVar
    nItens        += Lista->Quant
    nTotalCusto += Lista->( Pcusto * Quant )
    nTotalVenda += Lista->( Varejo * Quant )
    Lista->(DbSkip(1))
EndDo
nMediaAta /= nRegistros
nMediaVar /= nRegistros

Qout( Tran( nRegistros, "99999999999"), Tran( nItens, "99999999999999.99"),  Trans( nTotalCusto, "@E 9,999,999,999,999.99"), Trans( nTotalVenda, "@E 999,999,999,999.99"), Trans( nMediaAta, "@E 9,999,999,999.99"),   Trans( nMediaVar, "@E 9,999,999,999.99"))
__Eject()
PrintOff()
ResTela( cScreen )
return

Proc RolRepres()

LOCAL GetList     := {}
LOCAL cScreen      := SaveScreen( )
LOCAL aMenuArray := {" Completa Individual  "," Completa Geral ", " Parcial Individual ", " Parcial Geral " }
LOCAL aMenu       := {" Codigo ", " Nome " }
LOCAL nChoice
LOCAL Tecla
LOCAL Escolha
LOCAL cCodi
LOCAL aSelecionado
LOCAL oBloco

FIELD Codi
FIELD Cida
FIELD Esta
FIELD Repres

WHILE .T.
    oMenu:Limpa()
    M_Title("RELACAO DE REPRESENTANTES" )
    nChoice := FazMenu( 04, 10, aMenuArray, Cor())
    Do Case
    Case nChoice = 0
        ResTela( cScreen )
        Exit

    Case nChoice = 1
        cCodi := Space( 4 )
        MaBox( 12, 10, 14, 35 )
        SetCursor(1) ; DevPos( 13, 11 ) ; DevOut( "Codigo..:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodi, "cCodi", "9999", {|| Represrrado( @cCodi )},))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        if LastKey() = 27
            ResTela( cScreen )
            Loop
        endif
        dbSelectArea( "Repres" )
        Repres->(Order( 2 ))
        oBloco := {|| Repres->Repres = cCodi }
        RolRepresGeral( oBloco )
        ResTela( cScreen )
        Loop

    Case nChoice = 2
        M_Title( "ORDEM DE" )
        Escolha := FazMenu( 12, 10, aMenu, Cor())
        dbSelectArea( "Repres" )
        if( Escolha = 1, Repres->(Order( 2 )), Repres->( Order( 1 )))
        oBloco := {|| !Eof() }
        Repres->(DbGoTop())
        RolRepresGeral( oBloco )
        ResTela( cScreen )
        Loop

    Case nChoice = 3
        cCodi := Space( 4 )
        MaBox( 12, 10, 14, 35 )
        SetCursor(1) ; DevPos( 13, 11 ) ; DevOut( "Codigo  :" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodi, "cCodi", "9999", {|| Represrrado( @cCodi )},))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        if LastKey() = 27
            ResTela( cScreen )
            Loop
        endif
        dbSelectArea( "Repres" )
        Repres->(Order( 2 ))
        oBloco := {|| Repres->Repres = cCodi }
        RolRepresParcial( oBloco )
        ResTela( cScreen )
        Loop

    Case nChoice = 4
        M_Title( "ORDEM DE" )
        Escolha := FazMenu( 12, 10, aMenu, Cor())
        dbSelectArea( "Repres" )
        if( Escolha = 1, Repres->(Order( 2 )), Repres->( Order( 1 )))
        oBloco := {|| !Eof() }
        Repres->(DbGoTop())
        RolRepresParcial( oBloco )
        ResTela( cScreen )

    EndCase
EndDo

Proc RolRepresGeral( oBloco )

LOCAL cScreen := SaveScreen()
LOCAL Titulo
LOCAL Tam      := 80
LOCAL Col      := 60
LOCAL Pagina  := 0
FIELD Codi
FIELD Nome
FIELD Fanta
FIELD Ende
FIELD Bair
FIELD Cida
FIELD Esta
FIELD Cep
FIELD Fone
FIELD Fax
FIELD Caixa
FIELD Cgc
FIELD Rg
FIELD Con
FIELD Obs
FIELD Insc
FIELD Cpf

oMenu:Limpa()
Titulo := "LISTAGEM DE REPRESENTANTES"
if !InsTru80()
    ResTela( cScreen )
    return
endif
Mensagem("Aguarde, Imprimindo. ESC Cancela.", Cor())
PrintOn()
SetPrc(0, 0 )
WHILE Eval( oBloco ) .AND. Rel_Ok()
    if ( Col >= 57 )
        Write( 00, 00, Padr( "Pagina N?" + StrZero( ++Pagina,3 ), ( Tam/2 ) ) + Padl( Time(), ( Tam/2 ) ) )
        Write( 01, 00, Date() )
        Write( 02, 00, Padc( XNOMEFIR, Tam ) )
        Write( 03, 00, Padc( SISTEM_NA2, Tam ) )
        Write( 04, 00, Padc( Titulo,Tam ) )
        Col := 5
    endif
    Write(    Col, 0 , Repl( "-",80 ))
    Write( ++Col, 0 , "CODI      ¯  " + REPRES )
    Write( ++Col, 0 , "EMPRESA   ¯  " + NOME)
    Write( ++Col, 0 , "ENDERECO  ¯  " + ENDE)
    Write( ++Col, 0 , "BAIRRO    ¯  " + BAIR)
    Write( ++Col, 0 , "CIDADE    ¯  " + CIDA)
    Write( ++Col, 0 , "ESTADO    ¯  " + ESTA)
    Write( ++Col, 0 , "CEP       ¯  " + CEP)
    Write( ++Col, 0 , "TELEFONE  ¯  " + FONE)
    Write( ++Col, 0 , "FAX       ¯  " + FAX)
    Write( ++Col, 0 , "C.POSTAL  ¯  " + CAIXA)
    Write( ++Col, 0 , "CGC/MF    ¯  " + CGC)
    Write( ++Col, 0 , "INSC.EST  ¯  " + INSC)
    Write( ++Col, 0 , "CONTATO   ¯  " + CON)
    Write( ++Col, 0 , "OBSERV    ¯  " + OBS)
    Write( ++Col, 0 , Repl( "-", 80))
    Col += 3
    if Col >= 57
        __Eject()
    endif
    Repres->(DbSkip(1))
EndDo
__Eject()
PrintOff()
return

Proc RolRepresParcial( oBloco )

LOCAL cScreen := SaveScreen()
LOCAL Tam      := 132
LOCAL Titulo  := "LISTAGEM DE REPRESENTANTES"
LOCAL Col      := 60
LOCAL Pagina  := 0
FIELD Repres
FIELD Nome
FIELD Ende
FIELD Cida
FIELD Esta
FIELD Fone

if !InsTru80()
    ResTela( cScreen )
    return
endif
Mensagem("Aguarde, Imprimindo. ESC Cancela.", Cor())
PrintOn()
FPrint( PQ )
SetPrc( 0, 0 )
WHILE Eval( oBloco ) .AND. Rel_Ok()
    if Col >= 57
         Write( 00, 00, "Pagina N?" + StrZero( ++Pagina, 3 ) )
         Write( 00, 00, Padl( "Horas " + Time(), Tam ) )
         Write( 01, 00, Dtoc( Date() ) )
         Write( 02, 00, Padc( XNOMEFIR, Tam ) )
         Write( 03, 00, Padc( SISTEM_NA2, Tam ) )
         Write( 04, 00, Padc( Titulo, Tam ) )
         Write( 05, 00, Repl( "-", Tam ) )
         Write( 06, 00, "CODI" )
         Write( 06, 05, "EMPRESA" )
         Write( 06, 47, "ENDERECO" )
         Write( 06, 79, "CIDADE" )
         Write( 06,109, "UF" )
         Write( 06,117, "TELEFONE" )
         Write( 07,000, Repl( "-", Tam ) )
         Col := 8
    endif
    Write( Col, 000, Repres )
    Write( Col, 005, Nome )
    Write( Col, 046, Ende )
    Write( Col, 078, Cida )
    Write( Col, 107, Esta )
    Write( Col, 115, Fone )
    Col++
    Repres->(DbSkip(1))
    if Col >= 57
        __Eject()
    endif
EndDo
__Eject()
PrintOff()
return

Proc MenuEstoques()

LOCAL cScreen      := SaveScreen()





LOCAL aMenuArray := {" Estoque Por Fornecedor",    " Estoque Diario",    " Fisico/Financeiro (Balanco)",    " Produtos Por Fornecedor",    " Produtos Por Grupo",    " Fisico/Financeiro Por Grupo"}
LOCAL Op

WHILE .T.
    M_Title("RELATORIOS DE ESTOQUE")
    Op := FazMenu( 03, 10, aMenuArray, Cor())
    Do Case
    Case Op = 0
        ResTela( cScreen )
        Exit
    Case Op = 1
        EstoqueFornecedor()
    Case Op = 2
        EstoqueDia()
    Case Op = 3
        FisicoFinanceiro()
    Case Op = 4
        RolEstoqueFor()
    Case Op = 5
        RolEstGrupo()
    Case Op = 6
        RolFisGrupo()
    EndCase
EndDo

Proc MenuEntSai()

LOCAL Op
LOCAL cScreen      := SaveScreen()




















LOCAL aMenuArray := {" Conferencia Notas de Entradas",    " Entrada/Saida Produtos Individual",    " Entrada/Saida Produtos Parcial",    " Detalhado de Produtos Adquiridos",    " Detalhado de Produtos Vendidos",    " Vendas por Cliente",    " Vendas de Produtos",    " Saidas Por Grupo",    " Entradas Por Grupo",     " Acumulado de Produtos Vendidos",    " Entrada/Saida com Posicao Atual",    " Totalizado Produtos Vendidos",    " Posicao de Entrada por Nota",    " Posicao de Saidas",    " Saidas Por Regiao",    " Relacao de Faturas",    " Relacao de Faturas Vencidas",    " Relacao de Faturas a Vencer",    " Detalhado de Produtos Vendidos com CMV",    " Detalhado de Produtos Vendidos com PME",    " Curva ABC de Vendas"}
WHILE .T.
    oMenu:Limpa()
    M_Title("ROL DE ENTRADAS/SAIDAS")
    Op := FazMenu( 00, 10, aMenuArray, Cor())
    oMenu:Limpa()
    Do Case
    Case Op = 0
        ResTela( cScreen )
        Exit
    Case Op = 1
        RelConfEntradas()
    Case Op = 2
        EntSaiEstoque()
    Case Op = 3
        EntSaiParcial()
    Case Op = 4
        Detalhado_de_Entradas()
    Case Op = 5
        Relatori5( 5 )
    Case Op = 6
        VendasCliente()
    Case Op = 7
        VendasTipo()
    Case Op = 8
        VendasSaiGrupo()
    Case Op = 9
        VendasEntGrupo()
    Case Op = 10
        Relatori5( 10 )
    Case Op = 11
        PosCompra()
    Case Op = 12
        TotalSaidas()
    Case Op = 13
        RolFatEntrada()
    Case Op = 14

            FechaDia()










    Case Op = 15
        VendasSaiRegiao()
    Case Op = 16
        RelFaturas()
    Case Op = 17
        RelFatVencidas()
    Case Op = 18
        RelVencer()
    Case Op = 19
        Relatori5( 5 )
    Case Op = 20
        Relatori5( 5 )
    Case Op = 21
        CurvaAbc()
    EndCase
EndDo

Proc TotalSaidas()

LOCAL cScreen     := SaveScreen()
LOCAL nSaidas     := 0
LOCAL nPcusto     := 0
LOCAL nVarejo     := 0
LOCAL nAtacado  := 0
LOCAL nPvendido := 0
LOCAL Tam         := 132
LOCAL Pagina     := 0

oMenu:Limpa()
dbSelectArea( "Saidas" )
Saidas->(DbGoTop())
if !Instru80()
    ResTela( cScreen )
    return
endif
Mensagem( "Aguarde, Processando.", Cor())
PrintOn()
FPrint( PQ )
SetPrc( 0, 0 )
WHILE Saidas->(!Eof() .AND. Rep_Ok())
    nSaidas     += Saidas->Saida
    nPcusto     += Saidas->Saida * Saidas->Pcusto
    nVarejo     += Saidas->Saida * Saidas->Varejo
    nAtacado  += Saidas->Saida * Saidas->Atacado
    nPvendido += Saidas->Saida * Saidas->Pvendido
    Saidas->(DbSkip( 1 ))
EndDo
Qout( Padr( "Pagina N?" + StrZero( ++Pagina,3 ), ( Tam/2 ) ) + Padl( Time(), ( Tam/2 ) ))
Qout( Dtoc( Date() ))
Qout( Padc( XNOMEFIR, Tam ))
Qout( Padc( SISTEM_NA3, Tam ))
Qout( Padc( "ROL SAIDAS DE PRODUTOS - TOTALIZADO" , Tam ))
Qout( Repl( "=", Tam ) )
Qout("                   PRODUTOS      TOTAL CUSTO     TOTAL VAREJO    TOTAL ATACADO    TOTAL VENDIDO")
Qout( Repl( "=", Tam ) )




Qout("** Total Geral **", Tran( nSaidas, "999999.99" ), Tran( nPcusto,     "@E 9,999,999,999.99" ), Tran( nVarejo,     "@E 9,999,999,999.99" ), Tran( nAtacado,  "@E 9,999,999,999.99" ), Tran( nPvendido, "@E 9,999,999,999.99" ))
__Eject()
PrintOff()
ResTela( cScreen )
return

Proc VendasSaiGrupo()

LOCAL GetList      := {}
LOCAL cScreen      := SaveScreen( )
LOCAL lSair       := .F.
LOCAL aArray      := {}
LOCAL nCop          := 0
LOCAL nTam          := 132
LOCAL Col          := 58
LOCAL Pagin       := 0
LOCAL xAlias      := FTempName("T*.TMP")
LOCAL xNtx          := FTempName("T*.TMP")
LOCAL aMenuArray := { "Codigo", "Descricao", "Estoque", "Total Venda"}
LOCAL cGrupoIni  := Space(03)
LOCAL cGrupoFim  := Space(03)
LOCAL dDataIni   := Date()
LOCAL dDataFim   := Date()



LOCAL aStru       := {{ "CODGRUPO",  "C", 03, 0 },    { "DESGRUPO",  "C", 40, 0 },    { "QUANT",     "N", 09, 2 },    { "TOTAL",     "N", 13, 2 }}
LOCAL cTela

WHILE .T.
    MaBox( 16, 10, 21, 70 )
    cGrupoIni := Space(03)
    cGrupoFim := Space(03)
    SetCursor(1) ; DevPos( 17, 11 ) ; DevOut( "Grupo Inicial....:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cGrupoIni, "cGrupoIni", "999", {|| CodiGrupo( @cGrupoIni )},))
    SetCursor(1) ; DevPos( 18, 11 ) ; DevOut( "Grupo Final......:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cGrupoFim, "cGrupoFim", "999", {|| CodiGrupo( @cGrupoFim )},))
    SetCursor(1) ; DevPos( 19, 11 ) ; DevOut( "Data Inicial.....:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dDataIni, "dDataIni", "##/##/##",,))
    SetCursor(1) ; DevPos( 20, 11 ) ; DevOut( "Data Final.......:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dDataFim, "dDataFim", "##/##/##", {|| dDataFim >= dDataIni},))
    ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
    if LastKey() = 27
        ResTela( cScreen )
        return
    endif
    cTela     := Mensagem(" Aguarde, Filtrando Registros. ", 47 )
    oBloco    := {|| Grupo->CodGrupo >= cGrupoIni .AND. Grupo->CodGrupo <= cGrupoFim }
    bPeriodo := {| dEmis | dEmis >= dDataIni .AND. dEmis <= dDataFim }
    DbCreate( xAlias, aStru )
    dbUseArea( .T.,, ( xAlias ), "xTemp", iif( .F. .OR. .T., ! .T., NIL ), .F. )
    dbSelectArea( "Grupo" )
    Grupo->(Order( 1 ))
    Lista->(Order( 1 ))
    Saidas->(Order( 1 ))
    LETO_SET( 9, "On" )
    Grupo->(DbSeek( cGrupoIni ))
    LETO_SET( 9, "Off" )
    While Eval( oBloco ) .AND. Grupo->(!Eof())
        cGrupo     := Grupo->CodGrupo
        cDesGrupo := Grupo->DesGrupo
        if Lista->(DbSeek( cGrupo ))
            xTemp->(DbAppend())
            xTemp->CodGrupo    := cGrupo
            xTemp->DesGrupo    := cDesGrupo
            While ( Lista->CodGrupo = cGrupo .AND. Rel_Ok() )
                cCodigo := Lista->Codigo
                if Saidas->(DbSeek( cCodigo ))
                    While ( Saidas->Codigo = cCodigo .AND. Rel_Ok() )
                        if Eval( bPeriodo, Saidas->Emis )
                            xTemp->Quant        += Saidas->Saida
                            xTemp->Total        += Saidas->Saida * Saidas->Pvendido
                        endif
                        Saidas->(DbSkip(1))
                    EndDo
                endif
                Lista->(DbSkip(1))
            EndDo
        endif
        Grupo->(DbSkip(1))
    EndDo
    xTemp->(DbGoTop())
    if xTemp->(Eof())
        xTemp->(DbCloseArea())
        Ferase( xAlias )
        Ferase( xNtx )
        Alerta("Erro: Nenhum Produto Atende a Condicao.")
        ResTela( cScreen )
        Loop
    endif
    WHILE .T.
        oMenu:Limpa()
        M_Title("ESCOLHA A ORDEM A IMPRIMIR. ESC RETORNA")
        nOpcao := FazMenu( 05, 10, aMenuArray )
        if nOpcao = 0
            xTemp->(DbCloseArea())
            Ferase( xAlias )
            Ferase( xNtx )
            ResTela( cScreen )
            Exit
        elseif nOpcao = 1
             Mensagem(" Aguarde, Ordenando Por Codigo. ", 47 )
             dbSelectArea( "xTemp" )
             ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->CodGrupo", {|| xTemp->CodGrupo}, )
         elseif nOpcao = 2
             Mensagem("Aguarde, Ordenando Por Descricao. ", 47 )
             dbSelectArea( "xTemp" )
             ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->DesGrupo", {|| xTemp->DesGrupo}, )
         elseif nOpcao = 3
             Mensagem(" Aguarde, Ordenando Por Quantidade. ", 47 )
             dbSelectArea( "xTemp" )
             ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Quant", {|| xTemp->Quant}, )
         elseif nOpcao = 4
             Mensagem(" Aguarde, Ordenando Por Total Venda. ", 47 )
             dbSelectArea( "xTemp" )
             ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Total", {|| xTemp->Total}, )
        endif
        oMenu:Limpa()
        if !Instru80()
            ResTela( cScreen )
            Loop
        endif
        xTemp->(DbGoTop())
        Mensagem("Aguarde, Imprimindo.", 47 )
        nTam            := 80
        Col            := 58
        Pagina        := 0
        lSair         := .F.
        cIni            := Dtoc( dDataIni )
        cFim            := Dtoc( dDataFim )
        Relato        := "RELATORIO DE SAIDAS POR GRUPO NO PERIODO DE " + cIni + " A " + cFim
        nTotVenda    := 0
        nParVenda    := 0
        nTotQuant    := 0
        nParQuant    := 0
        PrintOn()
        SetPrc(0,0)
        WHILE xTemp->(!Eof()) .AND. Rep_Ok()
            if Col >=  57
                if !Rel_OK()
                    Exit
                endif
                Write( 00, 00, Linha1( nTam, @Pagina))
                Write( 01, 00, Linha2())
                Write( 02, 00, Linha3(nTam))
                Write( 03, 00, Linha4(nTam, SISTEM_NA2 ))
                Write( 04, 00, Padc( Relato ,nTam ) )
                Write( 05, 00, Linha5(nTam))
                Write( 06, 00, "GRP DESCRICAO DO GRUPO                           QUANT   T. VENDIDO")
                Write( 07, 00, Linha5(nTam))
                Col := 8
            endif
            xTemp->(Qout( CodGrupo, DesGrupo, Quant, Tran( Total, "@E 9,999,999.99")))
            nTotVenda     += xTemp->Total
            nParVenda     += xTemp->Total
            nTotQuant     += xTemp->Quant
            nParQuant     += xTemp->Quant
            xTemp->(DbSkip(1))
            Col++
            if Col >= 57 .OR. xTemp->(Eof())
                Write( Col, 0, Repl( "-", nTam ))
                Qout("*** PARCIAL ***", Space(28), Tran( nParQuant, "999999.99"), Tran( nParVenda, "@E 9,999,999.99"))
                if xTemp->(Eof())
                    Qout("***  TOTAL  ***", Space(28), Tran( nTotQuant, "999999.99"), Tran( nTotVenda, "@E 9,999,999.99"))
                endif
                __Eject()
            endif
        EndDo
        xTemp->(DbClearIndex())
        PrintOff()
    EndDo
    ResTela( cScreen )
EndDo

Proc VendasSaiRegiao()

LOCAL GetList      := {}
LOCAL cScreen      := SaveScreen( )
LOCAL lSair       := .F.
LOCAL aArray      := {}
LOCAL nCop          := 0
LOCAL nTam          := 132
LOCAL Col          := 58
LOCAL Pagin       := 0
LOCAL xAlias      := FTempName("T*.TMP")
LOCAL xNtx          := FTempName("T*.TMP")
LOCAL aMenuArray := { "Regiao", "Nome Regiao", "Estoque", "Total Venda"}
LOCAL cRegiaoIni := Space(02)
LOCAL cRegiaoFim := Space(02)
LOCAL dDataIni   := Date()
LOCAL dDataFim   := Date()



LOCAL aStru       := {{ "REGIAO",    "C", 02, 0 },    { "NOME",      "C", 40, 0 },    { "QUANT",     "N", 09, 2 },    { "TOTAL",     "N", 13, 2 }}
LOCAL cTela

WHILE .T.
    MaBox( 16, 10, 21, 70 )
    cRegiaoIni := Space(02)
    cRegiaoFim := Space(02)
    SetCursor(1) ; DevPos( 17, 11 ) ; DevOut( "Regiao Inicial...:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cRegiaoIni, "cRegiaoIni", "99", {|| RegiaoErrada( @cRegiaoIni )},))
    SetCursor(1) ; DevPos( 18, 11 ) ; DevOut( "Regiao Final.....:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cRegiaoFim, "cRegiaoFim", "99", {|| RegiaoErrada( @cRegiaoFim )},))
    SetCursor(1) ; DevPos( 19, 11 ) ; DevOut( "Data Inicial.....:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dDataIni, "dDataIni", "##/##/##",,))
    SetCursor(1) ; DevPos( 20, 11 ) ; DevOut( "Data Final.......:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dDataFim, "dDataFim", "##/##/##", {|| dDataFim >= dDataIni},))
    ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
    if LastKey() = 27
        ResTela( cScreen )
        return
    endif
    cTela     := Mensagem(" Aguarde, Filtrando Registros. ", 47 )
    oBloco    := {|| Regiao->Regiao >= cRegiaoIni .AND. Regiao->Regiao <= cRegiaoFim }
    bPeriodo := {| dEmis | dEmis >= dDataIni .AND. dEmis <= dDataFim }
    DbCreate( xAlias, aStru )
    dbUseArea( .T.,, ( xAlias ), "xTemp", iif( .F. .OR. .T., ! .T., NIL ), .F. )
    dbSelectArea( "Regiao" )
    Regiao->(Order( 1))
    Saidas->(Order( 2 ))
    LETO_SET( 9, "On" )
    Regiao->(DbSeek( cRegiaoIni ))
    LETO_SET( 9, "Off" )
    While Eval( oBloco ) .AND. Grupo->(!Eof())
        cRegiao := Regiao->Regiao
        if Saidas->(DbSeek( cRegiao ))
            xTemp->(DbAppend())
            xTemp->Regiao := cRegiao
            xTemp->Nome   := Regiao->Nome
            While ( Saidas->Regiao = cRegiao .AND. Rel_Ok() )
                if Eval( bPeriodo, Saidas->Emis )
                    xTemp->Quant        += Saidas->Saida
                    xTemp->Total        += Saidas->Saida * Saidas->Pvendido
                endif
                Saidas->(DbSkip(1))
            EndDo
        endif
        Regiao->(DbSkip(1))
    EndDo
    xTemp->(DbGoTop())
    if xTemp->(Eof())
        xTemp->(DbCloseArea())
        Ferase( xAlias )
        Ferase( xNtx )
        Alerta("Erro: Nenhum Produto Atende a Condicao.")
        ResTela( cScreen )
        Loop
    endif
    WHILE .T.
        oMenu:Limpa()
        M_Title("ESCOLHA A ORDEM A IMPRIMIR. ESC RETORNA")
        nOpcao := FazMenu( 05, 10, aMenuArray )
        if nOpcao = 0
            xTemp->(DbCloseArea())
            Ferase( xAlias )
            Ferase( xNtx )
            ResTela( cScreen )
            Exit
        elseif nOpcao = 1
             Mensagem(" Aguarde, Ordenando Por Regiao. ", 47 )
             dbSelectArea( "xTemp" )
             ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Regiao", {|| xTemp->Regiao}, )
         elseif nOpcao = 2
             Mensagem("Aguarde, Ordenando Por Nome. ", 47 )
             dbSelectArea( "xTemp" )
             ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Nome", {|| xTemp->Nome}, )
         elseif nOpcao = 3
             Mensagem(" Aguarde, Ordenando Por Quantidade. ", 47 )
             dbSelectArea( "xTemp" )
             ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Quant", {|| xTemp->Quant}, )
         elseif nOpcao = 4
             Mensagem(" Aguarde, Ordenando Por Total Venda. ", 47 )
             dbSelectArea( "xTemp" )
             ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Total", {|| xTemp->Total}, )
        endif
        oMenu:Limpa()
        if !Instru80()
            ResTela( cScreen )
            Loop
        endif
        xTemp->(DbGoTop())
        Mensagem("Aguarde, Imprimindo.", 47 )
        nTam            := 80
        Col            := 58
        Pagina        := 0
        lSair         := .F.
        cIni            := Dtoc( dDataIni )
        cFim            := Dtoc( dDataFim )
        Relato        := "RELATORIO DE SAIDAS POR REGIAO NO PERIODO DE " + cIni + " A " + cFim
        nTotVenda    := 0
        nParVenda    := 0
        nTotQuant    := 0
        nParQuant    := 0
        PrintOn()
        SetPrc(0,0)
        WHILE xTemp->(!Eof()) .AND. Rep_Ok()
            if Col >=  57
                if !Rel_OK()
                    Exit
                endif
                Write( 00, 00, Linha1( nTam, @Pagina))
                Write( 01, 00, Linha2())
                Write( 02, 00, Linha3(nTam))
                Write( 03, 00, Linha4(nTam, SISTEM_NA2 ))
                Write( 04, 00, Padc( Relato ,nTam ) )
                Write( 05, 00, Linha5(nTam))
                Write( 06, 00, "RG DESCRICAO DA REGIAO                          QUANT   T. VENDIDO")
                Write( 07, 00, Linha5(nTam))
                Col := 8
            endif
            xTemp->(Qout( Regiao, Nome, Quant, Tran( Total, "@E 9,999,999.99")))
            nTotVenda     += xTemp->Total
            nParVenda     += xTemp->Total
            nTotQuant     += xTemp->Quant
            nParQuant     += xTemp->Quant
            xTemp->(DbSkip(1))
            Col++
            if Col >= 57 .OR. xTemp->(Eof())
                Write( Col, 0, Repl( "-", nTam ))
                Qout("*** PARCIAL ***", Space(27), Tran( nParQuant, "999999.99"), Tran( nParVenda, "@E 9,999,999.99"))
                if xTemp->(Eof())
                    Qout("***  TOTAL  ***", Space(27), Tran( nTotQuant, "999999.99"), Tran( nTotVenda, "@E 9,999,999.99"))
                endif
                __Eject()
            endif
        EndDo
        xTemp->(DbClearIndex())
        PrintOff()
    EndDo
    ResTela( cScreen )
EndDo

Proc VendasEntGrupo()

LOCAL GetList        := {}
LOCAL cScreen        := SaveScreen( )
LOCAL lSair         := .F.
LOCAL aArray        := {}
LOCAL nCop            := 0
LOCAL nTam            := 132
LOCAL Col            := 58
LOCAL Pagin         := 0
LOCAL xAlias        := FTempName("T*.TMP")
LOCAL xNtx            := FTempName("T*.TMP")
LOCAL aMenuArray    := {"Codigo","Descricao","Estoque","Total Custo","Total Varejo","Total Atacado"}
LOCAL cGrupoIni    := Space(03)
LOCAL cGrupoFim    := Space(03)
LOCAL dDataIni     := Date()
LOCAL dDataFim     := Date()
LOCAL cTela         := SaveScreen( )
LOCAL nVarejo        := 0
LOCAL nAtacado     := 0
LOCAL nTotVenda    := 0
LOCAL nParVenda    := 0
LOCAL nTotQuant    := 0
LOCAL nParQuant    := 0
LOCAL nParVarejo    := 0
LOCAL nTotVarejo    := 0
LOCAL nParAtacado := 0
LOCAL nTotAtacado := 0





LOCAL aStru       := {{ "CODGRUPO",  "C", 03, 0 },    { "DESGRUPO",  "C", 40, 0 },    { "QUANT",     "N", 09, 2 },    { "CUSTO",     "N", 13, 2 },    { "VAREJO",    "N", 13, 2 },    { "ATACADO",   "N", 13, 2 }}
WHILE .T.
    MaBox( 16, 10, 21, 70 )
    cGrupoIni := Space(03)
    cGrupoFim := Space(03)
    SetCursor(1) ; DevPos( 17, 11 ) ; DevOut( "Grupo Inicial....:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cGrupoIni, "cGrupoIni", "999", {|| CodiGrupo( @cGrupoIni )},))
    SetCursor(1) ; DevPos( 18, 11 ) ; DevOut( "Grupo Final......:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cGrupoFim, "cGrupoFim", "999", {|| CodiGrupo( @cGrupoFim )},))
    SetCursor(1) ; DevPos( 19, 11 ) ; DevOut( "Data Inicial.....:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dDataIni, "dDataIni", "##/##/##",,))
    SetCursor(1) ; DevPos( 20, 11 ) ; DevOut( "Data Final.......:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dDataFim, "dDataFim", "##/##/##", {|| dDataFim >= dDataIni},))
    ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
    if LastKey() = 27
        ResTela( cScreen )
        return
    endif
    cTela     := Mensagem(" Aguarde, Filtrando Registros. ", 47 )
    oBloco    := {|| Grupo->CodGrupo >= cGrupoIni .AND. Grupo->CodGrupo <= cGrupoFim }
    bPeriodo := {| dEmis | dEmis >= dDataIni .AND. dEmis <= dDataFim }
    DbCreate( xAlias, aStru )
    dbUseArea( .T.,, ( xAlias ), "xTemp", iif( .F. .OR. .T., ! .T., NIL ), .F. )
    dbSelectArea( "Grupo" )
    Grupo->(Order( 1 ))
    Lista->(Order( 1 ))
    Entradas->(Order( 1 ))
    LETO_SET( 9, "On" )
    Grupo->(DbSeek( cGrupoIni ))
    LETO_SET( 9, "Off" )
    While Eval( oBloco ) .AND. Grupo->(!Eof())
        cGrupo     := Grupo->CodGrupo
        cDesGrupo := Grupo->DesGrupo
        if Lista->(DbSeek( cGrupo ))
            xTemp->(DbAppend())
            xTemp->CodGrupo    := cGrupo
            xTemp->DesGrupo    := cDesGrupo
            While ( Lista->CodGrupo = cGrupo .AND. Rel_Ok() )
                cCodigo    := Lista->Codigo
                nVarejo    := Lista->Varejo
                nAtacado := Lista->Atacado
                if Entradas->(DbSeek( cCodigo ))
                    While ( Entradas->Codigo = cCodigo .AND. Rel_Ok() )
                        if Eval( bPeriodo, Entradas->Data )
                            xTemp->Quant    += Entradas->Entrada
                            xTemp->Custo    += Entradas->Entrada * Entradas->Pcusto
                            xTemp->Varejo    += Entradas->Entrada * nVarejo
                            xTemp->Atacado += Entradas->Entrada * nAtacado
                        endif
                        Entradas->(DbSkip(1))
                    EndDo
                endif
                Lista->(DbSkip(1))
            EndDo
        endif
        Grupo->(DbSkip(1))
    EndDo
    xTemp->(DbGoTop())
    if xTemp->(Eof())
        xTemp->(DbCloseArea())
        Ferase( xAlias )
        Ferase( xNtx )
        Alerta("Erro: Nenhum Produto Atende a Condicao.")
        ResTela( cScreen )
        Loop
    endif
    WHILE .T.
        oMenu:Limpa()
        M_Title("ESCOLHA A ORDEM A IMPRIMIR. ESC RETORNA")
        nOpcao := FazMenu( 05, 10, aMenuArray )
        if nOpcao = 0
            xTemp->(DbCloseArea())
            Ferase( xAlias )
            Ferase( xNtx )
            ResTela( cScreen )
            Exit
        elseif nOpcao = 1
             Mensagem(" Aguarde, Ordenando Por Codigo. ", 47 )
             dbSelectArea( "xTemp" )
             ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->CodGrupo", {|| xTemp->CodGrupo}, )
         elseif nOpcao = 2
             Mensagem("Aguarde, Ordenando Por Descricao. ", 47 )
             dbSelectArea( "xTemp" )
             ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->DesGrupo", {|| xTemp->DesGrupo}, )
         elseif nOpcao = 3
             Mensagem(" Aguarde, Ordenando Por Quantidade. ", 47 )
             dbSelectArea( "xTemp" )
             ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Quant", {|| xTemp->Quant}, )
         elseif nOpcao = 4
             Mensagem(" Aguarde, Ordenando Por Total Custo. ", 47 )
             dbSelectArea( "xTemp" )
             ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Custo", {|| xTemp->Custo}, )
         elseif nOpcao = 5
             Mensagem(" Aguarde, Ordenando Por Total Varejo. ", 47 )
             dbSelectArea( "xTemp" )
             ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Varejo", {|| xTemp->Varejo}, )
         elseif nOpcao = 6
             Mensagem(" Aguarde, Ordenando Por Total Atacado. ", 47 )
             dbSelectArea( "xTemp" )
             ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Atacado", {|| xTemp->Atacado}, )
        endif
        oMenu:Limpa()
        if !Instru80()
            ResTela( cScreen )
            Loop
        endif
        xTemp->(DbGoTop())
        Mensagem("Aguarde, Imprimindo.", 47 )
        nTam            := 132
        Col            := 58
        Pagina        := 0
        lSair         := .F.
        cIni            := Dtoc( dDataIni )
        cFim            := Dtoc( dDataFim )
        Relato        := "RELATORIO DE ENTRADAS POR GRUPO NO PERIODO DE " + cIni + " A " + cFim
        nTotCusto    := 0
        nParCusto    := 0
        nTotQuant    := 0
        nParQuant    := 0
        nParVarejo    := 0
        nTotVarejo    := 0
        nParAtacado := 0
        nTotAtacado := 0
        PrintOn()
        SetPrc(0,0)
        WHILE xTemp->(!Eof()) .AND. Rep_Ok()
            if Col >=  57
                if !Rel_OK()
                    Exit
                endif
                Write( 00, 00, Linha1( nTam, @Pagina))
                Write( 01, 00, Linha2())
                Write( 02, 00, Linha3(nTam))
                Write( 03, 00, Linha4(nTam, SISTEM_NA2 ))
                Write( 04, 00, Padc( Relato ,nTam ) )
                Write( 05, 00, Linha5(nTam))
                Write( 06, 00, "GRP DESCRICAO DO GRUPO                           QUANT    T. PCUSTO    T. VAREJO   T. ATACADO")
                Write( 07, 00, Linha5(nTam))
                Col := 8
            endif
            xTemp->(Qout( CodGrupo, DesGrupo, Quant, Tran(Custo,"@E 9,999,999.99"),Tran(Varejo,"@E 9,999,999.99"),Tran(Atacado,"@E 9,999,999.99")))
            nTotCusto     += xTemp->Custo
            nParCusto     += xTemp->Custo
            nTotQuant     += xTemp->Quant
            nParQuant     += xTemp->Quant
            nParVarejo     += xTemp->Varejo
            nTotVarejo     += xTemp->Varejo
            nParAtacado  += xTemp->Atacado
            nTotAtacado  += xTemp->Atacado
            xTemp->(DbSkip(1))
            Col++
            if Col >= 57 .OR. xTemp->(Eof())
                Write( Col, 0, Repl( "-", nTam ))




                Qout("*** PARCIAL ***", Space(28),    Tran( nParQuant,"999999.99"),    Tran( nParCusto,"@E 9,999,999.99"),    Tran( nParVarejo,"@E 9,999,999.99"),    Tran( nParAtacado,"@E 9,999,999.99"))
                if xTemp->(Eof())




                    Qout("***  TOTAL  ***", Space(28),    Tran( nTotQuant, "999999.99"),    Tran( nTotCusto, "@E 9,999,999.99"),    Tran( nTotVarejo, "@E 9,999,999.99"),    Tran( nTotAtacado, "@E 9,999,999.99"))
                endif
                __Eject()
            endif
        EndDo
        xTemp->(DbClearIndex())
        PrintOff()
    EndDo
    ResTela( cScreen )
EndDo

Proc EntNota()

LOCAL Op
LOCAL cScreen      := SaveScreen()
LOCAL aMenuArray := {"Por Fornecedor", "Data Emissao", "Data Entrada"}
LOCAL aOrdem      := {"Nenhuma","Fornecedor","Documento","Emissao","Entrada","Condicoes","Vlr Fatura","Vlr Nff"}
LOCAL xAlias      := TempNew()
LOCAL xNtx          := TempNew()
LOCAL cCodiIni
LOCAL cCodifim
LOCAL dIni
LOCAL dFim

WHILE .T.
    M_Title("ROL ENTRADAS DE NOTAS")
    Op := FazMenu( 08, 10, aMenuArray, Cor())
    Do Case
    Case Op = 0
        ResTela( cScreen )
        Exit
    Case Op = 1
        cCodiIni := Space(04)
        cCodifim := Space(04)
        dIni        := Date()-30
        dFim        := Date()
        MaBox( 15, 10, 20, 71 )
        SetCursor(1) ; DevPos( 16, 11 ) ; DevOut( "Forn Inicial :" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodiIni, "cCodiIni", "9999", {|| Pagarrado( @cCodiIni, Row(), Col()+1 ) .AND. VerEntradas( cCodiIni )},))
        SetCursor(1) ; DevPos( 17, 11 ) ; DevOut( "Forn Final   :" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodifim, "cCodifim", "9999", {|| Pagarrado( @cCodifim, Row(), Col()+1 ) .AND. VerEntradas( cCodifim )},))
        SetCursor(1) ; DevPos( 18, 11 ) ; DevOut( "Data Inicial :" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dIni, "dIni", "##/##/##",,))
        SetCursor(1) ; DevPos( 19, 11 ) ; DevOut( "Data Final   :" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dFim, "dFim", "##/##/##",,))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        if LastKey() = 27
            ResTela( cScreen )
            Loop
        endif
        dbSelectArea( "EntNota" )
        EntNota->(Order( 2 ))
        if EntNota->(!DbSeek( cCodiIni ))
            ResTela( cScreen )
            Nada()
            Loop
        endif
        nConta := 0
        __dbCopyStruct( ( xAlias ), { } )
        dbUseArea( .T.,, ( xAlias ), "xTemp", iif( .F. .OR. .T., ! .T., NIL ), .F. )
        Mensagem("Aguarde, Processando.", Cor())
        WHILE EntNota->Codi >= cCodiIni .AND. EntNota->Codi <= cCodifim
             if EntNota->Data >= dIni .AND. EntNota->Data <= dFim
                xTemp->(DbAppend())
                For nField := 1 To FCount()
                    FieldPut( nField, EntNota->(FieldGet( nField )))
                Next
                nConta++
             endif
             EntNota->(DbSkip(1))
        EndDo
        Pagar->(Order( 2 ))
        dbSelectArea( "xTemp" )
        if ( ! .F. ) ; dbClearRelation() ; end ; dbSetRelation( "Pagar", {|| xTemp->Codi}, "xTemp->Codi", .F. )
        xTemp->(DbGoTop())
        if nConta = 0
            Nada()
        else
            oMenu:Limpa()
            M_Title("ESCOLHA ORDEM DO RELATORIO")
            nChoice := FazMenu( 05, 10, aOrdem, Cor())
            if nChoice = 2
                ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Codi", {|| xTemp->Codi}, )
            elseif nChoice = 3
                ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Numero", {|| xTemp->Numero}, )
            elseif nChoice = 4
                ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Data", {|| xTemp->Data}, )
            elseif nChoice = 5
                ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Entrada", {|| xTemp->Entrada}, )
            elseif nChoice = 6
                ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Condicoes", {|| xTemp->Condicoes}, )
            elseif nChoice = 7
                ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->VlrFatura", {|| xTemp->VlrFatura}, )
            elseif nChoice = 8
                ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->VlrNff", {|| xTemp->VlrNff}, )
            endif
            xTemp->(DbGoTop())
            RolEntNota( dIni, dFim )
        endif
        xTemp->(DbClearRel())
        xTemp->(DbGoTop())
        xTemp->(DbCloseArea())
        Ferase( xAlias )
        Ferase( xNtx )
        ResTela( cScreen )

    Case Op = 2
        dIni        := Date()-30
        dFim        := Date()
        MaBox( 15, 10, 18, 71 )
        SetCursor(1) ; DevPos( 16, 11 ) ; DevOut( "Data Inicial :" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dIni, "dIni", "##/##/##",,))
        SetCursor(1) ; DevPos( 17, 11 ) ; DevOut( "Data Final   :" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dFim, "dFim", "##/##/##",,))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        if LastKey() = 27
            ResTela( cScreen )
            Loop
        endif
        dbSelectArea( "EntNota" )
        EntNota->(Order( 1 ))
        nConta := 0
        __dbCopyStruct( ( xAlias ), { } )
        dbUseArea( .T.,, ( xAlias ), "xTemp", iif( .F. .OR. .T., ! .T., NIL ), .F. )
        LETO_SET( 9, "On" )
        lAchou := EntNota->(DbSeek( dIni ))
        LETO_SET( 9, "Off" )
        if !lAchou
            EntNota->(DbGoTop())
            Mensagem("Inicial nao localizada. Aguarde, Processando.", Cor())
        else
            Mensagem("Inicial localizada. Aguarde, Processando.", Cor())
        endif
        WHILE EntNota->(!Eof())
             if EntNota->Data >= dIni .AND. EntNota->Data <= dFim
                xTemp->(DbAppend())
                For nField := 1 To FCount()
                    FieldPut( nField, EntNota->(FieldGet( nField )))
                Next
                nConta++
             endif
             EntNota->(DbSkip(1))
        EndDo
        Pagar->(Order( 2 ))
        dbSelectArea( "xTemp" )
        if ( ! .F. ) ; dbClearRelation() ; end ; dbSetRelation( "Pagar", {|| xTemp->Codi}, "xTemp->Codi", .F. )
        xTemp->(DbGoTop())
        if nConta = 0
            Nada()
        else
            oMenu:Limpa()
            M_Title("ESCOLHA ORDEM DO RELATORIO")
            nChoice := FazMenu( 05, 10, aOrdem, Cor())
            if nChoice = 2
                ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Codi", {|| xTemp->Codi}, )
            elseif nChoice = 3
                ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Numero", {|| xTemp->Numero}, )
            elseif nChoice = 4
                ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Data", {|| xTemp->Data}, )
            elseif nChoice = 5
                ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Entrada", {|| xTemp->Entrada}, )
            elseif nChoice = 6
                ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Condicoes", {|| xTemp->Condicoes}, )
            elseif nChoice = 7
                ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->VlrFatura", {|| xTemp->VlrFatura}, )
            elseif nChoice = 8
                ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->VlrNff", {|| xTemp->VlrNff}, )
            endif
            xTemp->(DbGoTop())
            RolEntNota( dIni, dFim )
        endif
        xTemp->(DbClearRel())
        xTemp->(DbGoTop())
        xTemp->(DbCloseArea())
        Ferase( xAlias )
        Ferase( xNtx )
        ResTela( cScreen )
    Case Op = 3
        dIni := Date()-30
        dFim := Date()
        MaBox( 15, 10, 18, 71 )
        SetCursor(1) ; DevPos( 16, 11 ) ; DevOut( "Data Inicial :" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dIni, "dIni", "##/##/##",,))
        SetCursor(1) ; DevPos( 17, 11 ) ; DevOut( "Data Final   :" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dFim, "dFim", "##/##/##",,))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        if LastKey() = 27
            ResTela( cScreen )
            Loop
        endif
        dbSelectArea( "EntNota" )
        EntNota->(Order( 4 ))
        nConta := 0
        __dbCopyStruct( ( xAlias ), { } )
        dbUseArea( .T.,, ( xAlias ), "xTemp", iif( .F. .OR. .T., ! .T., NIL ), .F. )
        LETO_SET( 9, "On" )
        lAchou := EntNota->(DbSeek( dIni ))
        LETO_SET( 9, "Off" )
        if !lAchou
            EntNota->(DbGoTop())
            Mensagem("Inicial nao localizada. Aguarde, Processando.", Cor())
        else
            Mensagem("Inicial localizada. Aguarde, Processando.", Cor())
        endif
        WHILE EntNota->(!Eof())
             if EntNota->Entrada >= dIni .AND. EntNota->Entrada <= dFim
                xTemp->(DbAppend())
                For nField := 1 To FCount()
                    FieldPut( nField, EntNota->(FieldGet( nField )))
                Next
                nConta++
             endif
             EntNota->(DbSkip(1))
        EndDo
        Pagar->(Order( 2 ))
        dbSelectArea( "xTemp" )
        if ( ! .F. ) ; dbClearRelation() ; end ; dbSetRelation( "Pagar", {|| xTemp->Codi}, "xTemp->Codi", .F. )
        xTemp->(DbGoTop())
        if nConta = 0
            Nada()
        else
            oMenu:Limpa()
            M_Title("ESCOLHA ORDEM DO RELATORIO")
            nChoice := FazMenu( 05, 10, aOrdem, Cor())
            if nChoice = 2
                ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Codi", {|| xTemp->Codi}, )
            elseif nChoice = 3
                ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Numero", {|| xTemp->Numero}, )
            elseif nChoice = 4
                ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Data", {|| xTemp->Data}, )
            elseif nChoice = 5
                ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Entrada", {|| xTemp->Entrada}, )
            elseif nChoice = 6
                ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Condicoes", {|| xTemp->Condicoes}, )
            elseif nChoice = 7
                ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->VlrFatura", {|| xTemp->VlrFatura}, )
            elseif nChoice = 8
                ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->VlrNff", {|| xTemp->VlrNff}, )
            endif
            xTemp->(DbGoTop())
            RolEntNota( dIni, dFim )
        endif
        xTemp->(DbClearRel())
        xTemp->(DbGoTop())
        xTemp->(DbCloseArea())
        Ferase( xAlias )
        Ferase( xNtx )
        ResTela( cScreen )
    EndCase
EndDo

Function VerEntradas( cCodi )

EntNota->(Order( 2 ))
if EntNota->(!DbSeek( cCodi ))
    Nada()
    return( .F. )
endif
return( .T. )

Proc RolEntNota( dIni, dFim )

LOCAL cScreen         := SaveScreen()
LOCAL Tam             := 132
LOCAL Col             := 59
LOCAL Pagina         := 00
LOCAL nTotalFatura := 0
LOCAL nSubFatura     := 0
LOCAL nTotalNff     := 0
LOCAL nSubNff         := 0
LOCAL nTotalIcms     := 0
LOCAL nSubIcms      := 0
LOCAL nIcms          := 0

if !Instru80()
    ResTela( cScreen )
    return
endif
Mensagem("Aguarde, Imprimindo.", Cor())
lSair           := .F.
cIni              := Dtoc( dIni )
cFim              := Dtoc( dFim )

PrintOn()
FPrint( PQ )
While !Eof() .AND. REL_OK()
    if Col >=  58
        Write( 01, 00, Padr( "Pagina N?" + StrZero( ++Pagina,3 ), ( Tam/2 ) ) + Padl( Time(), ( Tam/2 ) ) )
        Write( 02, 00, Date() )
        Write( 03, 00, Padc( XNOMEFIR, Tam ) )
        Write( 04, 00, Padc( SISTEM_NA6, Tam ) )
        Write( 05, 00, Padc( "RELATORIO DE NOTAS DE ENTRADAS REF. &cIni. A &cFim.", Tam ) )
        Write( 06, 00, Repl( "-", Tam ) )
        Write( 07, 00,"CODI FORNECEDOR                       DOCTO   EMISSAO   ENTRADA COND PAGTO              VLR FATURA    VALOR NFF TX      VLR ICMS")
        Write( 08, 00, Repl( "-", Tam ) )
        Col := 09
    endif
    nIcms := ( VlrNff * Icms ) / 100

    Qout( Codi, Pagar->(Left( Nome, 32)), Numero, Data, Entrada, Condicoes, Tran( VlrFatura, "@E 999,999.99"), Tran( VlrNff, "@E 9,999,999.99"),    Icms, Tran( nIcms, "@E 999,999.99"))
    nTotalFatura += VlrFatura
    nSubFatura     += VlrFatura
    nTotalNff     += VlrNff
    nSubNff         += VlrNff
    nTotalIcms     += nIcms
    nSubIcms      += nIcms
    Col++
    DbSkip(1)
    if Col >= 55 .OR. Eof()
        Qout()
        Qout("*** SubTotal *** ", Space(67), Tran( nSubFatura, "@E 9,999,999.99" ), Tran( nSubNff, "@E 9,999,999.99" ), Space(3), Tran( nSubIcms,"@E 9,999,999.99" ))
        nSubFatura := 0
        nSubNff      := 0
        nSubIcms   := 0
        if Eof()
            Qout("*** Total Geral *** ", Space(64),Tran( nTotalFatura, "@E 9,999,999.99" ), Tran( nTotalNff, "@E 9,999,999.99" ), Space(3),Tran( nTotalIcms,"@E 9,999,999.99" ))
        else
            Col := 58
            __Eject()
        endif
    endif
EndDo
__Eject()
PrintOff()
ResTela( cScreen )
return

Proc EntSaiParcial()

LOCAL cScreen    := SaveScreen()
LOCAL Tam        := 0
LOCAL cCodiIni := 0
LOCAL cCodifim := 0

WHILE .T.
    dbSelectArea( "Saidas" )
    Saidas->(Order( 1 ))
    cCodiIni := 0
    cCodifim := 0
    dIni      := Date() - 30
    dFim      := Date()
    MaBox( 14, 16, 19, 47, "ROL ENT/SAI PRODUTO")
    SetCursor(1) ; DevPos( 15, 17 ) ; DevOut( "Codigo Inicial.: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodiIni, "cCodiIni", "999999", {|| CodiErrado( @cCodiIni )},))
    SetCursor(1) ; DevPos( 16, 17 ) ; DevOut( "Codigo Final...: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodifim, "cCodifim", "999999", {|| CodiErrado( @cCodifim )},))
    SetCursor(1) ; DevPos( 17, 17 ) ; DevOut( "Data Inicial...: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dIni, "dIni", "##/##/##",,))
    SetCursor(1) ; DevPos( 18, 17 ) ; DevOut( "Data Final.....: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dFim, "dFim", "##/##/##",,))
    ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
    if LastKey() = 27
        Saidas->(DbClearRel())
        Saidas->(DbGoTop())
        ResTela( cScreen )
        Exit
    endif
    Lista->(Order( 2 ))
    dbSelectArea( "Saidas" )
    Saidas->(Order( 1 ))
    if ( ! .F. ) ; dbClearRelation() ; end ; dbSetRelation( "Lista", {|| Codigo}, "Codigo", .F. )
    cTela1          := SaveScreen()
    aTodos          := {}
    bBloco          := {|| Saidas->Codigo >= cCodiIni .AND. Saidas->Codigo <= cCodifim }
    LETO_SET( 9, "On" )
    Saidas->(DbSeek( cCodiIni ))
    LETO_SET( 9, "Off" )
    Mensagem("Aguarde, Localizando Registros.", Cor())
    WHILE Eval( bBloco )
        nEstoAtual      := Lista->Quant
        cDescricao      := Left( Lista->Descricao, 39 )
        if Saidas->Data >= dIni .AND. Saidas->Data <= dFim
            nPos := Ascan2( aTodos, Saidas->Codigo, 1 )
            if nPos = 0
                Aadd( aTodos, { Codigo, cDescricao, nEstoAtual, Saida, 0.00, 0.00, 0.00, 0.00, 0.00 })
            else
                aTodos[nPos, 4] += Saidas->Saida
            endif
        else
            if Saidas->Data < dIni
                nPos := Ascan2( aTodos, Saidas->Codigo, 1 )
                if nPos <> 0
                    aTodos[nPos, 6] += Saidas->Saida
                endif
            endif
            if Saidas->Data > dFim
                nPos := Ascan2( aTodos, Saidas->Codigo, 1 )
                if nPos <> 0
                    aTodos[nPos,7] += Saidas->Saida
                endif
            endif
        endif
        Saidas->(DbSkip(1))
    Enddo
    Saidas->(DbClearRel())
    Saidas->(DbGoTop())
    Lista->(Order( 2 ))
    dbSelectArea( "Entradas" )
    Entradas->(Order( 1 ))
    if ( ! .F. ) ; dbClearRelation() ; end ; dbSetRelation( "Lista", {|| Codigo}, "Codigo", .F. )
    bBloco := {|| Entradas->Codigo >= cCodiIni .AND. Entradas->Codigo <= cCodifim }
    LETO_SET( 9, "On" )
    Entradas->(DbSeek( cCodiIni ))
    LETO_SET( 9, "Off" )
    WHILE Eval( bBloco )
        nEstoAtual      := Lista->Quant
        cDescricao      := Left( Lista->Descricao, 39 )
        if Entradas->Data >= dIni .AND. Entradas->Data <= dFim
            nPos := Ascan2( aTodos, Entradas->Codigo, 1 )
            if nPos = 0
                Aadd( aTodos, { Codigo, cDescricao, nEstoAtual, 0.00, Entradas->Entrada, 0.00, 0.00, 0.00, 0.00 })
            else
                aTodos[nPos, 5] += Entradas->Entrada
            endif
        else
            if Entradas->Data < dIni
                nPos := Ascan2( aTodos, Entradas->Codigo, 1 )
                if nPos <> 0
                    aTodos[nPos, 8] += Entradas->Entrada
                endif
            endif
            if Entradas->Data > dFim
                nPos := Ascan2( aTodos, Entradas->Codigo, 1 )
                if nPos <> 0
                    aTodos[nPos,9] += Entradas->Entrada
                endif
            endif
        endif
        Entradas->(DbSkip(1))
    Enddo
    Entradas->(DbClearRel())
    Entradas->(DbGoTop())

    Asort( aTodos,,, {| x, y | y[ 2 ] > x[ 2 ] } )
    nConta    := Len( aTodos )
    nSaidas    := 0
    nEntrada := 0
    nSaldo    := 0
    Tam              := 132
    Col              := 58
    Pagina          := 0
    nContador      := 0
    lSair           := .F.

    if !Instru80()
        ResTela( cScreen )
        Loop
    endif

    ResTela( cTela1 )
    Mensagem("Aguarde, Imprimindo. ", Cor())
    PrintOn()
    FPrint( PQ )
    SetPrc( 0, 0 )
    For x := 1 To nConta
        if Col >= 58
            Write( 00, 00, Linha1( Tam, @Pagina))
            Write( 01, 00, Linha2())
            Write( 02, 00, Linha3(Tam))
            Write( 03, 00, Linha4(Tam, SISTEM_NA2 ))
            Write( 04, 00, Padc( "RELATORIO DE ENTRADA E SAIDA DE PRODUTO NO PERIODO DE " + DToc( dIni ) + " A " + DToc( dFim ),Tam ))
            Write( 05, 00, Linha5(Tam))
            Write( 06, 00, "CODIGO DESCRICAO                                (+)ANTERIOR  (+)ENTRADAS    (-)SAIDAS     (=)SALDO     (*)ATUAL          Dif")
            Write( 07, 00, Linha5(Tam))
            Col := 8
        endif
        nAtual          := aTodos[x,3]
        nSaidas          := aTodos[x,4]
        nEntradas      := aTodos[x,5]
        nSaiAnt          := aTodos[x,6]
        nSaiDep          := aTodos[x,7]
        nEntAnt          := aTodos[x,8]
        nEntDep          := aTodos[x,9]

        nEstoAnterior := ( nAtual + nSaidas ) - nEntradas
        nEstoAnterior := ( nEstoAnterior + nSaiDep ) - nEntDep

        nSaldo          := ( nEstoAnterior + nEntradas ) - nSaidas
        cCodigo          := aTodos[x,1]
        cDescricao      := aTodos[x,2]
        nAtual          := aTodos[x,3]
        nDif              :=    nSaldo - ( nAtual - nEstoAnterior )






        Qout( cCodigo, cDescricao, Tran( nEstoAnterior,"999999999.99"),    Tran( nEntradas,      "999999999.99"),    Tran( nSaidas,       "999999999.99"),    Tran( nSaldo,          "999999999.99"),    Tran( nAtual,          "999999999.99"),    Tran( nDif,           "999999999.99"))
        Col++
        nContador++
        if Col >= 58 .OR. x = nConta
            Col++
            Write( Col, 0,  Repl( "-", Tam ))
            __Eject()
        endif
    next
    PrintOff()
    ResTela( cTela1 )
EndDo


Proc EtiQueta()

LOCAL cScreen         := SaveScreen()
LOCAL nChoice         := 0
LOCAL nQtde          := 0





LOCAL aMenuArray     := {" Impressora Normal ", " Impressora Codigo de Barra Datamax", " Impressora Codigo de Barra Argox Tipo 1", " Impressora Codigo de Barra Argox Tipo 2", " Impressora Codigo de Barra Argox Tipo 3 ", " Impressora Codigo de Barra Argox Tipo 4 "}
LOCAL cTela
WHILE .T.
    M_Title("ESCOLHA SUA OPCAO")
    nChoice := FazMenu( 05, 12, aMenuArray, Cor())
    Do Case
    Case nChoice = 0
        Exit
    Case nChoice = 1
        ResTela( cScreen )
        EtiNormal()
    Case nChoice = 2
        ResTela( cScreen )
        if .T.
            EtiBarra()
        else
         Alerta("Informa: Informe-se com o suporte.")
        endif
    Case nChoice >= 3 .AND. nChoice <= 6
        ResTela( cScreen )
        if .T.
            EtiArgox( nChoice )
        else
         Alerta("Informa: Informe-se com o suporte.")
        endif
    End
EndDo
ResTela( cScreen )
return

Proc EtiNormal()

LOCAL lJahImpresso := .F.
LOCAL cScreen         := SaveScreen()
LOCAL nChoice         := 0
LOCAL nQtde          := 0
LOCAL aConfig         := {}
LOCAL aGets          := {}




LOCAL aMenuArray     := {" Configurar Etiquetas              ", " Imprimir Conforme Estoque         ", " Imprimir Qtde Selecionada         ", " Imprimir Conforme Nota de Entrada ", " Imprimir Por Grupo                "}
LOCAL cTela
WHILE .T.
    M_Title("ESCOLHA SUA OPCAO")
    nChoice := FazMenu( 05, 12, aMenuArray, Cor())
    if nChoice = 0
        ResTela( cScreen )
        Exit

    endif
    if nChoice = 1
        ConfigurarEtiqueta()
        ResTela( cScreen )
        Loop
    endif
    aConfig := LerEtiqueta()
    nLen      := Len( aConfig )
    if nLen > 0
        nCampos      := aConfig[1]
        nTamanho   := aConfig[2]
        nMargem      := aConfig[3]
        nLinhas      := aConfig[4]
        nEspacos   := aConfig[5]
        nCarreira  := aConfig[6]
        lComprimir := aConfig[7] == 1
        lSpVert      := aConfig[8] == 1
        For nX := 9 To nLen
            Aadd( aGets, aConfig[nX] )
        Next
        aLinha := Array( aConfig[1] )
        Afill( aLinha, "" )
    else
        ErrorBeep()
        Alerta("Erro: Favor Escolher Arquivo de Etiquetas.")
        ResTela( cScreen )
        Loop
    endif
    if nChoice < 4
        WHILE .T.
            Grupo->(Order( 1 ))
            SubGrupo->(Order( 1 ))
            Pagar->(Order( 2 ))
            dbSelectArea( "Lista" )


            if ( ! .F. ) ; dbClearRelation() ; end ; dbSetRelation( "Grupo", {|| CodGrupo}, "CodGrupo", .F. ) ; dbSetRelation( "SubGrupo", {||    CodsGrupo}, "CodsGrupo", .F. ) ; dbSetRelation( "Pagar", {||    Codi}, "Codi", .F. )
            Lista->(Order( 2 ))
            Lista->(DbGoTop())
            cInic       := 0
            cFina       := 0
            nCarreiras := 5
            if nChoice = 2
                MaBox( 14, 12, 17, 44 )
                SetCursor(1) ; DevPos( 15, 13 ) ; DevOut( "Codigo Inicial...¯" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cInic, "cInic", "999999", {|| CodiErrado( @cInic )},))
                SetCursor(1) ; DevPos( 16, 13 ) ; DevOut( "Codigo Final.....¯" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cFina, "cFina", "999999", {|| CodiErrado( @cFina,,.T. )},))
                ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
            else
                MaBox( 14, 12, 18, 44 )
                SetCursor(1) ; DevPos( 15, 13 ) ; DevOut( "Codigo Inicial...¯" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cInic, "cInic", "999999", {|| CodiErrado( @cInic )},))
                SetCursor(1) ; DevPos( 16, 13 ) ; DevOut( "Codigo Final.....¯" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cFina, "cFina", "999999", {|| CodiErrado( @cFina,,.T.)},))
                SetCursor(1) ; DevPos( 17, 13 ) ; DevOut( "Qtde Individual..¯" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nQtde, "nQtde", "999", {|| nQtde > 0}, {|| nChoice = 3}))
                ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
            endif
            if LastKey() = 27
                ResTela( cScreen )
                Exit
            endif
            if !Instru80()
                ResTela( cScreen )
                Loop
            endif
            Mensagem("Aguarde. Imprimindo.", Cor())
            PrintOn()
            FPrint( _SALTOOFF )
            if lComprimir
                FPrint( PQ )
            endif
            if lSpVert
                FPrint( _SPACO1_8 )
            endif
            SetPrc( 0, 0 )
            oBloco := {|| Lista->Codigo >= cInic .AND. Lista->Codigo <= cFina }
            DbSeek( cInic )
            nConta := 0
            WHILE Eval( oBloco ) .AND. Rep_Ok()
                if nChoice = 3
                    nEtiquetas := nQtde
                else
                    nEtiquetas := Lista->Quant
                endif
                nCol := nMargem
                For nY := 1 To nEtiquetas
                    nConta++
                    For nB := 1 To nCampos
                        cVar := aGets[nB]
                        nTam := Len( &cVar. )
                        aLinha[nB] += &cVar. + if( nConta = nCarreira, "", Space( ( nTamanho - nTam ) + nEspacos ))
                    Next
                    if nConta = nCarreira
                        nConta := 0
                        For nC := 1 To nCampos

                            Qout( Space( nMargem ) + aLinha[nC] )
                            aLinha[nC] := ""
                        Next
                        For nD := 1 To nLinhas
                            Qout()
                        Next
                    endif
                next
                DbSkip(1)
            EndDo
            if nConta >0
                For nC := 1 To nCampos

                    Qout( Space( nMargem ) + aLinha[nC] )
                    aLinha[nC] := ""
                Next
                For nD := 1 To nLinhas
                    Qout()
                Next
            endif
            PrintOFF()
            Lista->(DbClearRel())
            ResTela( cScreen )
        EndDo
    elseif nChoice = 5
      cTela := SaveScreen()
        WHILE .T.
            Grupo->(Order( 1 ))
            SubGrupo->(Order( 1 ))
            Pagar->(Order( 2 ))
            dbSelectArea( "Lista" )
            if ( ! .F. ) ; dbClearRelation() ; end ; dbSetRelation( "Grupo", {|| CodGrupo}, "CodGrupo", .F. ) ; dbSetRelation( "SubGrupo", {|| CodsGrupo}, "CodsGrupo", .F. ) ; dbSetRelation( "Pagar", {|| Codi}, "Codi", .F. )
            Lista->(Order( 1 ))
            nCarreiras := 5
            cGrupoIni := Space(3)
            cGrupoFim := Space(3)
            MaBox( 14, 12, 17, 44 )
            SetCursor(1) ; DevPos( 15, 13 ) ; DevOut( "Grupo Inicial.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cGrupoIni, "cGrupoIni", "999", {|| CodiGrupo( @cGrupoIni )},))
            SetCursor(1) ; DevPos( 16, 13 ) ; DevOut( "Grupo Final...:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cGrupoFim, "cGrupoFim", "999", {|| CodiGrupo( @cGrupoFim )},))
            ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
            if LastKey() = 27
                ResTela( cScreen )
                Exit
            endif
            if !Instru80()
                ResTela( cScreen )
                Loop
            endif
            Mensagem("Aguarde. Imprimindo.", Cor())
            PrintOn()
            FPrint( _SALTOOFF )
            if lComprimir
                FPrint( PQ )
            endif
            if lSpVert
                FPrint( _SPACO1_8 )
            endif
            SetPrc( 0, 0 )
            oBloco := {|| Lista->CodGrupo >= cGrupoIni .AND. Lista->CodGrupo <= cGrupoFim }
            LETO_SET( 9, "On" )
            if Lista->(!DbSeek( cGrupoIni ))
                LETO_SET( 9, "Off" )
                Loop
            endif
            LETO_SET( 9, "Off" )
            nConta := 0
            WHILE Lista->(Eval( oBloco )) .AND. Rep_Ok()
                cCodigo      := Lista->Codigo
                nEtiquetas := Lista->Quant
                nCol          := nMargem
                For nY := 1 To nEtiquetas
                    nConta++
                    For nB := 1 To nCampos
                        cVar := aGets[nB]
                        nTam := Len( &cVar. )
                        aLinha[nB] += &cVar. + if( nConta = nCarreira, "", Space( ( nTamanho - nTam ) + nEspacos ))
                    Next
                    if nConta = nCarreira
                        nConta := 0
                        For nC := 1 To nCampos
                            Qout( Space( nMargem ) + aLinha[nC] )
                            aLinha[nC] := ""
                        Next
                        For nD := 1 To nLinhas
                            Qout()
                        Next
                    endif
                next
                Lista->(DbSkip(1))
            EndDo
            if nConta >0
                For nC := 1 To nCampos
                    Qout( Space( nMargem ) + aLinha[nC] )
                    aLinha[nC] := ""
                Next
                For nD := 1 To nLinhas
                    Qout()
                Next
            endif
            PrintOFF()
            Lista->(DbClearRel())
            ResTela( cTela  )
        EndDo
    elseif nChoice = 4
        cTela := SaveScreen()
        WHILE .T.
            Grupo->(Order( 1 ))
            SubGrupo->(Order( 1 ))
            Pagar->(Order( 2 ))
            dbSelectArea( "Lista" )
            if ( ! .F. ) ; dbClearRelation() ; end ; dbSetRelation( "Grupo", {|| CodGrupo}, "CodGrupo", .F. ) ; dbSetRelation( "SubGrupo", {|| CodsGrupo}, "CodsGrupo", .F. ) ; dbSetRelation( "Pagar", {|| Codi}, "Codi", .F. )
            Lista->(Order( 2 ))
            nCarreiras := 5
            Entradas->(Order( 2 ))
            cDocnr := Space(09)
            MaBox( 14, 12, 16, 44 )
            SetCursor(1) ; DevPos( 15, 13 ) ; DevOut( "N?Nota Entrada..:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cDocnr, "cDocnr", "@!", {|| AchaDocEntrada( @cDocnr )},))
            ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
            if LastKey() = 27
                ResTela( cScreen )
                Exit
            endif
            if !Instru80()
                ResTela( cScreen )
                Loop
            endif
            Mensagem("Aguarde. Imprimindo.", Cor())
            PrintOn()
            FPrint( _SALTOOFF )
            if lComprimir
                FPrint( PQ )
            endif
            if lSpVert
                FPrint( _SPACO1_8 )
            endif
            SetPrc( 0, 0 )
            oBloco := {|| Entradas->Fatura = cDocnr }
            if Entradas->(DbSeek( cDocnr ))
                nConta := 0
                WHILE Entradas->(Eval( oBloco )) .AND. Rep_Ok()
                    cCodigo      := Entradas->Codigo
                    nEtiquetas := Entradas->Entrada
                    if Lista->(DbSeek( cCodigo ))
                        nCol          := nMargem
                        For nY := 1 To nEtiquetas
                            nConta++
                            For nB := 1 To nCampos
                                cVar := aGets[nB]
                                nTam := Len( &cVar. )
                                aLinha[nB] += &cVar. + if( nConta = nCarreira, "", Space( ( nTamanho - nTam ) + nEspacos ))
                            Next
                            if nConta = nCarreira
                                nConta := 0
                                For nC := 1 To nCampos
                                    Qout( Space( nMargem ) + aLinha[nC] )
                                    aLinha[nC] := ""
                                Next
                                For nD := 1 To nLinhas
                                    Qout()
                                Next
                            endif
                        next
                    endif
                    Entradas->(DbSkip(1))
                EndDo
                if nConta >0
                    For nC := 1 To nCampos
                        Qout( Space( nMargem ) + aLinha[nC] )
                        aLinha[nC] := ""
                    Next
                    For nD := 1 To nLinhas
                        Qout()
                    Next
                endif
                PrintOFF()
                Lista->(DbClearRel())
                ResTela( cTela  )
            endif
        EndDo
    endif
EndDo

Proc IniGrande()

PrintOn()
FPrint( RESETA     )
FPrint( _SALTOOFF )
FPrint( PQ            )
return

Proc EtiBarra()

LOCAL lJahImpresso := .F.
LOCAL cScreen         := SaveScreen()
LOCAL nChoice         := 0
LOCAL nQtde          := 0
LOCAL aConfig         := {}
LOCAL aGets          := {}
LOCAL xAlias         := FTempName("T*.TMP")
LOCAL xNtx             := FTempName("T*.TMP")
LOCAL aStru
LOCAL cGrupo         := Space(03)
LOCAL cLetra1         := Space(40)
LOCAL cLetra2         := Space(40)
LOCAL aMenuArray     := { "Codigo", "Descricao", "Tamanho", "Cod Fabricante", "Qtde Minima", "Estoque", "Preco Venda" }





LOCAL aMenu          := {" Imprimir Teste                    ", " Imprimir Conforme Estoque         ", " Imprimir Qtde Selecionada         ", " Imprimir Conforme Nota de Entrada ", " Imprimir Por Grupo                ", " Imprimir Por Grupo/Palavra        "}
LOCAL cTela
WHILE .T.
    M_Title("ESCOLHA SUA OPCAO")
    nChoice := FazMenu( 04, 12, aMenu, Cor())
    if nChoice = 0
        ResTela( cScreen )
        Exit
    elseif nChoice = 1
        if !Instru80()
            ResTela( cScreen )
            Loop
        endif
        Mensagem("Aguarde. Imprimindo.", Cor())
        PrintOn()
        Qout( Chr(2) + "f138")
        Qout( Chr(2) + "T")
        Qout( "E"   )
        PrintOff()
        ResTela( cScreen )

    elseif nChoice = 2 .OR. nChoice = 3
        WHILE .T.
            Grupo->(Order( 1 ))
            SubGrupo->(Order( 1 ))
            Pagar->(Order( 2 ))
            dbSelectArea( "Lista" )


            if ( ! .F. ) ; dbClearRelation() ; end ; dbSetRelation( "Grupo", {|| CodGrupo}, "CodGrupo", .F. ) ; dbSetRelation( "SubGrupo", {||    CodsGrupo}, "CodsGrupo", .F. ) ; dbSetRelation( "Pagar", {||    Codi}, "Codi", .F. )
            Lista->(Order( 2 ))
            Lista->(DbGoTop())
            cInic       := 0
            cFina       := 0
            nCarreiras := 3
            if nChoice = 2
                MaBox( 14, 12, 17, 44 )
                SetCursor(1) ; DevPos( 15, 13 ) ; DevOut( "Codigo Inicial...¯" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cInic, "cInic", "999999", {|| CodiErrado( @cInic )},))
                SetCursor(1) ; DevPos( 16, 13 ) ; DevOut( "Codigo Final.....¯" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cFina, "cFina", "999999", {|| CodiErrado( @cFina,,.T. )},))
                ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
            else
                MaBox( 14, 12, 18, 44 )
                SetCursor(1) ; DevPos( 15, 13 ) ; DevOut( "Codigo Inicial...¯" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cInic, "cInic", "999999", {|| CodiErrado( @cInic )},))
                SetCursor(1) ; DevPos( 16, 13 ) ; DevOut( "Codigo Final.....¯" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cFina, "cFina", "999999", {|| CodiErrado( @cFina,,.T.)},))
                SetCursor(1) ; DevPos( 17, 13 ) ; DevOut( "Qtde Individual..¯" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nQtde, "nQtde", "999", {|| nQtde > 0}, {|| nChoice = 3}))
                ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
            endif
            if LastKey() = 27
                ResTela( cScreen )
                Exit
            endif
            if !Instru80()
                ResTela( cScreen )
                Loop
            endif
            Mensagem("Aguarde. Imprimindo.", Cor())
            PrintOn()
            oBloco := {|| Lista->Codigo >= cInic .AND. Lista->Codigo <= cFina }
            DbSeek( cInic )
            nConta := 0
            WHILE Eval( oBloco ) .AND. Rep_Ok()
                if nChoice = 3
                    nEtiquetas := nQtde
                else
                    nEtiquetas := Lista->Quant
                endif
                For nY := 1 To nEtiquetas
                    nConta++
                    if nConta = 1
                        EtiBar1()
                    elseif nConta = 2
                        EtiBar2()
                    elseif nConta = 3
                        EtiBar3()
                    endif
                    if nConta = 3
                        Qout("Q1")
                        Qout("E")
                        nConta := 0
                    endif
                next
                DbSkip(1)
            EndDo
            Qout("Q1")
            Qout("E")
            PrintOFF()
            Lista->(DbClearRel())
            ResTela( cScreen )
        EndDo
    elseif nChoice = 4
        cTela := SaveScreen()
        WHILE .T.
            Grupo->(Order( 1 ))
            SubGrupo->(Order( 1 ))
            Pagar->(Order( 2 ))
            dbSelectArea( "Lista" )
            if ( ! .F. ) ; dbClearRelation() ; end ; dbSetRelation( "Grupo", {|| CodGrupo}, "CodGrupo", .F. ) ; dbSetRelation( "SubGrupo", {|| CodsGrupo}, "CodsGrupo", .F. ) ; dbSetRelation( "Pagar", {|| Codi}, "Codi", .F. )
            Lista->(Order( 2 ))
            nCarreiras := 5
            Entradas->(Order( 2 ))
            cDocnr := Space(09)
            MaBox( 14, 12, 16, 44 )
            SetCursor(1) ; DevPos( 15, 13 ) ; DevOut( "N?Nota Entrada..:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cDocnr, "cDocnr", "@!", {|| AchaDocEntrada( @cDocnr )},))
            ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
            if LastKey() = 27
                ResTela( cScreen )
                Exit
            endif
            if !Instru80()
                ResTela( cScreen )
                Loop
            endif
            Mensagem("Aguarde. Imprimindo.", Cor())
            PrintOn()
            oBloco := {|| Entradas->Fatura = cDocnr }
            if Entradas->(DbSeek( cDocnr ))
                nConta := 0
                WHILE Entradas->(Eval( oBloco )) .AND. Rep_Ok()
                    cCodigo      := Entradas->Codigo
                    nEtiquetas := Entradas->Entrada
                    if Lista->(DbSeek( cCodigo ))
                        For nY := 1 To nEtiquetas
                            nConta++
                            if nConta = 1
                                EtiBar1()
                            elseif nConta = 2
                                EtiBar2()
                            elseif nConta = 3
                                EtiBar3()
                            endif
                            if nConta = 3
                                Qout("Q1")
                                Qout("E")
                                nConta := 0
                            endif
                        next
                    endif
                    Entradas->(DbSkip(1))
                EndDo
                Qout("Q1")
                Qout("E")
                PrintOFF()
                Lista->(DbClearRel())
                ResTela( cTela  )
            endif
        EndDo
    elseif nChoice = 5
        cTela := SaveScreen()
        WHILE .T.
            Grupo->(Order( 1 ))
            SubGrupo->(Order( 1 ))
            Pagar->(Order( 2 ))
            dbSelectArea( "Lista" )
            if ( ! .F. ) ; dbClearRelation() ; end ; dbSetRelation( "Grupo", {|| CodGrupo}, "CodGrupo", .F. ) ; dbSetRelation( "SubGrupo", {|| CodsGrupo}, "CodsGrupo", .F. ) ; dbSetRelation( "Pagar", {|| Codi}, "Codi", .F. )
            Lista->(Order( 1 ))
            nCarreiras := 5
            cGrupoIni := Space(3)
            cGrupoFim := Space(3)
            MaBox( 14, 12, 17, 44 )
            SetCursor(1) ; DevPos( 15, 13 ) ; DevOut( "Grupo Inicial.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cGrupoIni, "cGrupoIni", "999", {|| CodiGrupo( @cGrupoIni )},))
            SetCursor(1) ; DevPos( 16, 13 ) ; DevOut( "Grupo Final...:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cGrupoFim, "cGrupoFim", "999", {|| CodiGrupo( @cGrupoFim )},))
            ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
            if LastKey() = 27
                ResTela( cScreen )
                Exit
            endif
            if !Instru80()
                ResTela( cScreen )
                Loop
            endif
            Mensagem("Aguarde. Imprimindo.", Cor())
            PrintOn()
            oBloco := {|| Lista->CodGrupo >= cGrupoIni .AND. Lista->CodGrupo <= cGrupoFim }
            LETO_SET( 9, "On" )
            if Lista->(!DbSeek( cGrupoIni ))
                LETO_SET( 9, "Off" )
                Loop
            endif
            LETO_SET( 9, "Off" )
            nConta := 0
            WHILE Lista->(Eval( oBloco )) .AND. Rep_Ok()
                cCodigo      := Lista->Codigo
                nEtiquetas := Lista->Quant
                For nY := 1 To nEtiquetas
                    nConta++
                    if nConta = 1
                        EtiBar1()
                    elseif nConta = 2
                        EtiBar2()
                    elseif nConta = 3
                        EtiBar3()
                    endif
                    if nConta = 3
                        Qout("Q1")
                        Qout("E")
                        nConta := 0
                    endif
                next
                Lista->(DbSkip(1))
            EndDo
            Qout("Q1")
            Qout("E")
            PrintOFF()
            Lista->(DbClearRel())
            ResTela( cTela  )
        EndDo

    elseif nChoice = 6
        cTela := SaveScreen()
        WHILE .T.
            MaBox( 14, 12, 18, 72 )
            cGrupo  := Space(03)
            cLetra1 := Space(40)
            cLetra2 := Space(40)
            SetCursor(1) ; DevPos( 15, 13 ) ; DevOut( "Grupo............:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cGrupo, "cGrupo", "999", {|| CodiGrupo( @cGrupo )},))
            SetCursor(1) ; DevPos( 16, 13 ) ; DevOut( "Palavra Inicial..:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cLetra1, "cLetra1", "@!", {|| !Empty( cLetra1 )},))
            SetCursor(1) ; DevPos( 17, 13 ) ; DevOut( "Palavra Final....:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cLetra2, "cLetra2", "@!", {|| !Empty( cLetra2 )},))
            ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
            if LastKey() = 27
                ResTela( cScreen )
                Exit
            endif
            cLetra1 := ltrim(rtrim(cLetra1))
            cLetra2 := ltrim(rtrim(cLetra2))
            cTela   := Mensagem(" Aguarde, Filtrando Registros. ", 47 )
            aStru   := Lista->(DbStruct())
            DbCreate( xAlias, aStru )
            dbUseArea( .T.,, ( xAlias ), "xTemp", iif( .F. .OR. .T., ! .T., NIL ), .F. )
            Grupo->(Order( 1 ))
            SubGrupo->(Order( 1 ))
            Pagar->(Order( 2 ))
            dbSelectArea( "Lista" )
            if ( ! .F. ) ; dbClearRelation() ; end ; dbSetRelation( "Grupo", {|| CodGrupo}, "CodGrupo", .F. ) ; dbSetRelation( "SubGrupo", {|| CodsGrupo}, "CodsGrupo", .F. ) ; dbSetRelation( "Pagar", {|| Codi}, "Codi", .F. )
            Lista->(Order( 1 ))
            if Lista->(DbSeek( cGrupo ))
                While ( Lista->CodGrupo = cGrupo .AND. Rel_Ok() )
                    if Lista->(Left( Descricao, Len( cLetra1 ))) >= cLetra1 .AND. Lista->(Left( Descricao, Len( cLetra2 ))) <= cLetra2
                        xTemp->(DbAppend())
                        xTemp->Codigo        := Lista->Codigo
                        xTemp->N_Original := Lista->N_Original
                        xTemp->Descricao    := Lista->Descricao
                        xTemp->Un            := Lista->Un
                        xTemp->Qmin         := Lista->Qmin
                        xTemp->Quant        := Lista->Quant
                        xTemp->Tam            := Lista->Tam
                        xTemp->Varejo        := Lista->Varejo
                        xTemp->Codi         := Lista->Codi
                        xTemp->CodGrupo    := Lista->CodGrupo
                        xTemp->CodeBar     := Lista->CodeBar
                        xTemp->Varejo        := Lista->Varejo
                    endif
                    Lista->(DbSkip(1))
                EndDo
            endif
            xTemp->(DbGoTop())
            if xTemp->(Eof())
                xTemp->(DbCloseArea())
                Ferase( xAlias )
                Ferase( xNtx )
                Alerta("Erro: Nenhum Produto Atende a Condicao.")
                ResTela( cTela )
                Loop
            endif
            WHILE .T.
                oMenu:Limpa()
                M_Title("ESCOLHA A ORDEM A IMPRIMIR. ESC RETORNA")
                nOpcao := FazMenu( 05, 10, aMenuArray )
                if nOpcao = 0
                    xTemp->(DbCloseArea())
                    Ferase( xAlias )
                    Ferase( xNtx )
                    ResTela( cTela )
                    Exit
                elseif nOpcao = 1
                     Mensagem(" Aguarde, Ordenando Por Codigo. ", 47 )
                     dbSelectArea( "xTemp" )
                     ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Codigo", {|| xTemp->Codigo}, )
                 elseif nOpcao = 2
                     Mensagem("Aguarde, Ordenando Por Descricao. ", 47 )
                     dbSelectArea( "xTemp" )
                     ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Descricao", {|| xTemp->Descricao}, )
                 elseif nOpcao = 3
                     Mensagem(" Aguarde, Ordenando Por Tamanho. ", 47 )
                     dbSelectArea( "xTemp" )
                     ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Tam", {|| xTemp->Tam}, )
                 elseif nOpcao = 4
                     Mensagem(" Aguarde, Ordenando Por Codigo Fabricante. ", 47 )
                     dbSelectArea( "xTemp" )
                     ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->N_Original", {|| xTemp->N_Original}, )
                 elseif nOpcao = 5
                     Mensagem(" Aguarde, Ordenando Por Qtde Minima. ", 47 )
                     dbSelectArea( "xTemp" )
                     ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Qmin", {|| xTemp->Qmin}, )
                 elseif nOpcao = 6
                     Mensagem(" Aguarde, Ordenando Por Estoque. ", 47 )
                     dbSelectArea( "xTemp" )
                     ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Quant", {|| xTemp->Quant}, )
                 elseif nOpcao = 7
                     Mensagem(" Aguarde, Ordenando Por Preco Venda. ", 47 )
                     dbSelectArea( "xTemp" )
                     ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Varejo", {|| xTemp->Varejo}, )
                endif
                oMenu:Limpa()
                if !Instru80()
                    ResTela( cTela )
                    Loop
                endif
                Mensagem("Aguarde. Imprimindo.", Cor())
                PrintOn()
                xTemp->(DbGoTop())
                nConta := 0
                WHILE xTemp->(!Eof()) .AND. Rep_Ok()
                    cCodigo      := xTemp->Codigo
                    nEtiquetas := xTemp->Quant
                    For nY := 1 To nEtiquetas
                        nConta++
                        if nConta = 1
                            EtiBar1()
                        elseif nConta = 2
                            EtiBar2()
                        elseif nConta = 3
                            EtiBar3()
                        endif
                        if nConta = 3
                            Qout("Q1")
                            Qout("E")
                            nConta := 0
                        endif
                    next
                    xTemp->(DbSkip(1))
                EndDo
                Qout("Q1")
                Qout("E")
                PrintOFF()
                Lista->(DbClearRel())
            EndDo
            ResTela( cTela  )
        EndDo
    endif
EndDo

Proc PosCompra1()

LOCAL GetList    := {}
LOCAL cScreen    := SaveScreen()
LOCAL nTam        := 0
LOCAL cCodiIni := 0
LOCAL cCodifim := 0
LOCAL nChoice    := 0
LOCAL nOrdem    := 0
LOCAL lFiltro    := .F.
LOCAL dIni        := Date()
LOCAL dFim        := Date()
LOCAL xAlias    := FTempName("T*.TMP")
LOCAL xNtx        := FTempName("T*.TMP")
LOCAL aMenu     := {"Parcial", "Por Fornecedor"}
LOCAL aOrdem    := {"Codigo","Descricao","Cod Fabr/Ref","Agrupado por Cod Fabr/Ref", "Descricao+Tamanho"}






LOCAL aDbf        := {{"CODIGO",     "C", 06, 0 }, {"DESCRICAO",  "C", 40, 0 }, {"QUANT",      "N", 09, 2 }, {"SAIDA",      "N", 09, 2 }, {"SAIANT",     "N", 09, 2 }, {"SAIPOS",     "N", 09, 2 }, {"ENTRADA",    "N", 09, 2 }, {"ENTANT",     "N", 09, 2 }, {"ENTPOS",     "N", 09, 2 }, {"N_ORIGINAL", "C", 15, 0 }, {"TAM",        "C", 06, 0 }, {"VAREJO",     "N", 11, 2 },  {"PCUSTO",     "N", 11, 2 }, {"DATA",       "D", 08, 0 }}
LOCAL cTela1          := SaveScreen()
LOCAL bBloco          := {}
LOCAL nEstoAtual      := 0
LOCAL nSaida          := 0
LOCAL nVarejo          := 0
LOCAL nPcusto          := 0
LOCAL nEntrada       := 0
LOCAL nSaidas          := 0
LOCAL nSaldo          := 0
LOCAL Col              := 0
LOCAL Pagina          := 0
LOCAL nContador      := 0
LOCAL nAtual          := 0
LOCAL nEntradas      := 0
LOCAL nSaiAnt          := 0
LOCAL nSaiDep          := 0
LOCAL nEntDep          := 0
LOCAL nEntAnt          := 0
LOCAL nDif              := 0
LOCAL nEstoAnterior := 0
LOCAL nParcAnt       := 0
LOCAL nParcEnt       := 0
LOCAL nParcSai       := 0
LOCAL nParcSaldo      := 0
LOCAL nParcAtual      := 0
LOCAL cDescricao      := ""
LOCAL cTam              := ""
LOCAL cOriginal      := ""
LOCAL cCodigo          := ""
LOCAL cCodi           := ""
LOCAL cRefAtual      := ""
LOCAL dData           := Date()
LOCAL cPrazo          := ""
LOCAL lSair           := .F.
LOCAL cRefAnt
FIELD Codigo
FIELD Descricao

WHILE .T.
    oMenu:Limpa()
    M_Title("POSICAO ENTRADA E SAIDA DE PRODUTOS")
    nChoice := FazMenu( 06, 10, aMenu, Cor())
    Do Case
    Case nChoice = 0
        ResTela( cScreen )
        return

    Case nChoice = 1
        cCodiIni := 0
        cCodifim := 0
        dIni        := Date() - 30
        dFim        := Date()
        MaBox( 12, 10, 17, 70, "ROL ENT/SAI PRODUTO")
        SetCursor(1) ; DevPos( 13, 11 ) ; DevOut( "Codigo Inicial.: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodiIni, "cCodiIni", "999999", {|| CodiErrado( @cCodiIni )},))
        SetCursor(1) ; DevPos( 14, 11 ) ; DevOut( "Codigo Final...: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodifim, "cCodifim", "999999", {|| CodiErrado( @cCodifim )},))
        SetCursor(1) ; DevPos( 15, 11 ) ; DevOut( "Data Inicial...: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dIni, "dIni", "##/##/##",,))
        SetCursor(1) ; DevPos( 16, 11 ) ; DevOut( "Data Final.....: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dFim, "dFim", "##/##/##",,))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        if LastKey() = 27
            ResTela( cScreen )
            Loop
        endif
        lFiltro := Conf("Pergunta: Selecionar registros zerados ou negativos ?")
        Lista->(Order( 2 ))
        dbSelectArea( "Saidas" )
        Saidas->(Order( 1 ))
        if ( ! .F. ) ; dbClearRelation() ; end ; dbSetRelation( "Lista", {|| Saidas->Codigo}, "Saidas->Codigo", .F. )
        cTela1          := SaveScreen()
        bBloco          := {|| Saidas->Codigo >= cCodiIni .AND. Saidas->Codigo <= cCodifim }
        LETO_SET( 9, "On" )
        Saidas->(DbSeek( cCodiIni ))
        LETO_SET( 9, "Off" )
        Mensagem("Aguarde, Localizando Registros.", Cor())
        DbCreate( xAlias, aDbf )
        dbUseArea( .T.,, ( xAlias ), "xTemp", iif( .F. .OR. .T., ! .T., NIL ), .F. )
        ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( (xNtx ),, "xTemp->Codigo", {|| xTemp->Codigo}, )

        WHILE Eval( bBloco )
            nEstoAtual      := Lista->Quant
            cDescricao      := Lista->Descricao
            cTam              := Lista->Tam
            cOriginal      := Lista->N_Original
            nVarejo          := Lista->Varejo
            nPcusto          := Lista->Pcusto

            if !( lFiltro )
                if nEstoAtual <= 0
                    Saidas->(DbSkip(1))
                    Loop
                endif
            endif
            cCodigo := Saidas->Codigo
            nSaida  := Saidas->Saida
            dData   := Saidas->Data
            cPrazo  := ""

            if xTemp->(!DbSeek( cCodigo ))
                xTemp->(DbAppend())
                xTemp->Codigo        := cCodigo
                xTemp->Descricao    := cDescricao
                xTemp->Quant        := nEstoAtual
                xTemp->N_Original := cOriginal
                xTemp->Tam            := cTam
                xTemp->Varejo        := nVarejo
                xTemp->Pcusto        := nPcusto
            endif

            if dData >= dIni .AND. dData <= dFim
                xTemp->Saida := nSaida
                xTemp->Data  := dData
            elseif dData < dIni
                xTemp->SaiAnt += nSaida
                xTemp->Data   := dData
            elseif dData > dFim
                xTemp->SaiPos += nSaida
                xTemp->Data   := dData
            endif
            Saidas->(DbSkip(1))
        Enddo
        Saidas->(DbClearRel())
        Saidas->(DbGoTop())



        Lista->(Order( 2 ))
        dbSelectArea( "Entradas" )
        Entradas->(Order( 1 ))
        if ( ! .F. ) ; dbClearRelation() ; end ; dbSetRelation( "Lista", {|| Entradas->Codigo}, "Entradas->Codigo", .F. )
        bBloco := {|| Entradas->Codigo >= cCodiIni .AND. Entradas->Codigo <= cCodifim }
        LETO_SET( 9, "On" )
        Entradas->(DbSeek( cCodiIni ))
        LETO_SET( 9, "Off" )
        WHILE Eval( bBloco )
            nEstoAtual      := Lista->Quant
            cDescricao      := Lista->Descricao
            cTam              := Lista->Tam
            cOriginal      := Lista->n_Original
            nVarejo          := Lista->Varejo
            nPcusto          := Lista->Pcusto

            if !( lFiltro )
                if nEstoAtual <= 0
                    Entradas->(DbSkip(1))
                    Loop
                endif
            endif

            cCodigo    := Entradas->Codigo
            nEntrada := Entradas->Entrada
            dData     := Entradas->Data
            cPrazo    := Entradas->Condicoes

            if xTemp->(!DbSeek( cCodigo ))
                xTemp->(DbAppend())
                xTemp->Codigo        := cCodigo
                xTemp->Descricao    := cDescricao
                xTemp->Quant        := nEstoAtual
                xTemp->N_Original := cOriginal
                xTemp->Tam            := cTam
                xTemp->Varejo        := nVarejo
                xTemp->Pcusto        := nPcusto
            endif

            if dData >= dIni .AND. dData <= dFim
                xTemp->Entrada := nSaida
                xTemp->Data     := dData
            elseif dData < dIni
                xTemp->EntAnt    += nSaida
                xTemp->Data     := dData
            elseif dData > dFim
                xTemp->EntPos    += nSaida
                xTemp->Data     := dData
            endif
            Entradas->(DbSkip(1))
        Enddo
        Entradas->(DbClearRel())
        Entradas->(DbGoTop())

    Case nChoice = 2
        cCodi     := Space(04)
        dIni        := Date() - 30
        dFim        := Date()
        MaBox( 12, 10, 16, 74, "ROL ENT/SAI PRODUTO")
        SetCursor(1) ; DevPos( 13, 11 ) ; DevOut( "Fornecedor.....: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodi, "cCodi", "9999", {|| Pagarrado( @cCodi, Row(), Col()+1 )},))
        SetCursor(1) ; DevPos( 14, 11 ) ; DevOut( "Data Inicial...: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dIni, "dIni", "##/##/##",,))
        SetCursor(1) ; DevPos( 15, 11 ) ; DevOut( "Data Final.....: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dFim, "dFim", "##/##/##",,))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        if LastKey() = 27
            ResTela( cScreen )
            Loop
        endif
        lFiltro := Conf("Pergunta: Selecionar registros zerados ou negativos ?")
        Lista->(Order( 9 ))
        Entradas->(Order( 4 ))
        dbSelectArea( "Saidas" )
        Saidas->(Order( 1 ))
        if Lista->( !DbSeek( cCodi ))
            ErrorBeep()
            Nada()
            Loop
        endif
        if ( ! .F. ) ; dbClearRelation() ; end ; dbSetRelation( "Lista", {|| Saidas->Codigo}, "Saidas->Codigo", .F. )
        cTela1  := SaveScreen()
        bBloco  := {|| Lista->Codi = cCodi }
        Mensagem("Aguarde, Localizando Registros.", Cor())
        DbCreate( xAlias, aDbf )
        dbUseArea( .T.,, ( xAlias ), "xTemp", iif( .F. .OR. .T., ! .T., NIL ), .F. )
        ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( (xNtx ),, "xTemp->Codigo", {|| xTemp->Codigo}, )
        Lista->(DbSeek( cCodi ))
        WHILE Lista->(Eval( bBloco ))
            nEstoAtual      := Lista->Quant
            cDescricao      := Lista->Descricao
            cTam              := Lista->Tam
            cOriginal      := Lista->N_Original
            cCodigo          := Lista->Codigo
            nVarejo          := Lista->Varejo
            nPcusto          := Lista->Pcusto

            if !( lFiltro )
                if nEstoAtual <= 0
                    Lista->(DbSkip(1))
                    Loop
                endif
            endif

            if Saidas->(DbSeek( cCodigo ))
                While Saidas->Codigo = cCodigo
                    nSaida  := Saidas->Saida
                    dData   := Saidas->Data
                    cPrazo  := ""
                    if xTemp->(!DbSeek( cCodigo ))
                        xTemp->(DbAppend())
                        xTemp->Codigo        := cCodigo
                        xTemp->Descricao    := cDescricao
                        xTemp->Quant        := nEstoAtual
                        xTemp->N_Original := cOriginal
                        xTemp->Tam            := cTam
                        xTemp->Varejo        := nVarejo
                        xTemp->Pcusto        := nPcusto
                    endif
                    if dData >= dIni .AND. dData <= dFim
                        xTemp->Saida := nSaida
                        xTemp->Data  := dData
                    elseif dData < dIni
                        xTemp->SaiAnt += nSaida
                        xTemp->Data   := dData
                    elseif dData > dFim
                        xTemp->SaiPos += nSaida
                        xTemp->Data   := dData
                    endif
                    Saidas->(DbSkip(1))
                EndDo
            endif
            Lista->(DbSkip(1))
        Enddo
        Saidas->(DbClearRel())
        Saidas->(DbGoTop())



        Lista->(Order( 2 ))
        dbSelectArea( "Entradas" )
        Entradas->(Order( 4 ))
        if ( ! .F. ) ; dbClearRelation() ; end ; dbSetRelation( "Lista", {|| Entradas->Codigo}, "Entradas->Codigo", .F. )
        bBloco := {|| Entradas->Codi = cCodi }
        Entradas->(DbSeek( cCodi ))
        WHILE Eval( bBloco )
            nEstoAtual      := Lista->Quant
            cDescricao      := Lista->Descricao
            cTam              := Lista->Tam
            cOriginal      := Lista->n_Original
            nVarejo          := Lista->Varejo
            nPcusto          := Lista->Pcusto

            if !( lFiltro )
                if nEstoAtual <= 0
                    Entradas->(DbSkip(1))
                    Loop
                endif
            endif

            cCodigo    := Entradas->Codigo
            nEntrada := Entradas->Entrada
            dData     := Entradas->Data
            cPrazo    := Entradas->Condicoes

            if xTemp->(!DbSeek( cCodigo ))
                xTemp->(DbAppend())
                xTemp->Codigo        := cCodigo
                xTemp->Descricao    := cDescricao
                xTemp->Quant        := nEstoAtual
                xTemp->N_Original := cOriginal
                xTemp->Tam            := cTam
                xTemp->Varejo        := nVarejo
                xTemp->Pcusto        := nPcusto
            endif

            if dData >= dIni .AND. dData <= dFim
                xTemp->Entrada := nEntrada
                xTemp->Data     := dData
            elseif dData < dIni
                xTemp->EntAnt    += nEntrada
                xTemp->Data     := dData
            elseif dData > dFim
                xTemp->EntPos    += nEntrada
                xTemp->Data     := dData
            endif
            Entradas->(DbSkip(1))
        Enddo
        Entradas->(DbClearRel())
        Entradas->(DbGoTop())
    EndCase

    xTemp->(DbGoTop())
    if xTemp->(Eof())
        xTemp->(DbCloseArea())
        Loop
    endif
    WHILE .T.
        oMenu:Limpa()
        M_Title("ESCOLHA ORDEM DO RELATORIO")
        nOrdem := FazMenu( 05, 10, aOrdem, Cor())
        Do Case
        Case nOrdem = 0
            xTemp->(DbCloseArea())
            Exit
        Case nOrdem = 1
            Mensagem("Aguarde: Ordenando Registros.", Cor())
            ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Codigo", {|| xTemp->Codigo}, )

        Case nOrdem = 2
            Mensagem("Aguarde: Ordenando Registros.", Cor())
            ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Descricao", {|| xTemp->Descricao}, )

        Case nOrdem = 3
            Mensagem("Aguarde: Ordenando Registros.", Cor())
            ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->N_Original", {|| xTemp->N_Original}, )

        Case nOrdem = 4
            Mensagem("Aguarde: Ordenando Registros.", Cor())
            ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->N_Original", {|| xTemp->N_Original}, )

        Case nOrdem = 5
            Mensagem("Aguarde: Ordenando Registros.", Cor())
            ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Descricao + xTemp->Tam", {|| xTemp->Descricao + xTemp->Tam}, )

        EndCase
        nSaidas          := 0
        nEntrada       := 0
        nSaldo          := 0
        nTam              := 132
        Col              := 58
        Pagina          := 0
        nContador      := 0
        lSair           := .F.

        if !Instru80()
            Loop
        endif

        ResTela( cTela1 )
        Mensagem("Aguarde, Imprimindo. ", Cor())
        PrintOn()
        FPrint( PQ )
        SetPrc( 0, 0 )
        dbSelectArea( "xTemp" )
        xTemp->(DbGoTop())
        cRefAnt      := xTemp->N_Original
        nParcAnt   := 0
        nParcEnt   := 0
        nParcSai   := 0
        nParcSaldo := 0
        nParcAtual := 0
        WHILE xTemp->( !Eof()) .AND. Rel_Ok()
            if Col >= 58
                Write( 00, 00, Linha1( nTam, @Pagina))
                Write( 01, 00, Linha2())
                Write( 02, 00, Linha3(nTam))
                Write( 03, 00, Linha4(nTam, SISTEM_NA2 ))
                Write( 04, 00, Padc( "POSICAO DE ENTRADA E SAIDA DE PRODUTO NO PERIODO DE " + DToc( dIni ) + " A " + DToc( dFim ), nTam ))
                Write( 05, 00, Linha5(nTam))
                Write( 06, 00,"CODIGO REFERENCIA     TAM     DESCRICAO                               CUSTO      VAREJO   (+)ANT   (+)ENT DATA ENT   (-)SAI   (=)SAL")
                Write( 07, 00, Linha5(nTam))
                Col := 8
            endif
            nAtual          := xTemp->Quant
            nSaidas          := xTemp->Saida
            nEntradas      := xTemp->Entrada
            nSaiAnt          := xTemp->SaiAnt
            nSaiDep          := xTemp->SaiPos
            nEntAnt          := xTemp->EntAnt
            nEntDep          := xtemp->EntPos

            nEstoAnterior := ( nAtual + nSaidas ) - nEntradas
            nEstoAnterior := ( nEstoAnterior + nSaiDep ) - nEntDep

            nSaldo          := ( nEstoAnterior + nEntradas ) - nSaidas
            cCodigo          := xTemp->Codigo
            cDescricao      := xTemp->(Left( Descricao, 33 ))
            nAtual          := xTemp->Quant
            cOriginal      := xTemp->N_Original
            cTam              := xTemp->Tam
            nVarejo          := xTemp->Varejo
            nPcusto          := xTemp->Pcusto
            dData           := xTemp->Data
            nDif              := nSaldo - ( nAtual - nEstoAnterior )








            Qout( cCodigo, cOriginal, cTam, cDescricao,     Tran( nPcusto,       "@E 9999,999.99"),    Tran( nVarejo,       "@E 9999,999.99"),    Tran( nEstoAnterior,"99999.99"),    Tran( nEntradas,      "99999.99"),    dData,    Tran( nSaidas,       "99999.99"),    Tran( nSaldo,          "99999.99"))
            Col++
            nContador++
            nParcAnt   += nEstoAnterior
            nParcEnt   += nEntradas
            nParcSai   += nSaidas
            nParcSaldo += nSaldo
            nParcAtual += nAtual
            cRefAnt      := xTemp->N_Original
            xTemp->(DbSkip(1))
            if nOrdem = 4
                if cRefAnt <> xTemp->N_Original






                    Qout( Repl("-", 86-Len(cPrazo)),    cPrazo,    Tran( nParcAnt,  "99999.99"),    Tran( nParcEnt,  "99999.99"),    Space(08),    Tran( nParcSai,  "99999.99"),    Tran( nParcSaldo,"99999.99"))
                    Col++
                    Qout()
                    Col++
                    nParcAnt   := 0
                    nParcEnt   := 0
                    nParcSai   := 0
                    nParcSaldo := 0
                    nParcAtual := 0
                endif
            endif
            if Col >= 56 .OR. xTemp->(Eof())
                Qout( Repl( "-", nTam ))
                Col := 58
                __Eject()
            endif
        EndDo
        PrintOff()
        ResTela( cTela1 )
    EndDo
EndDo

Function CodVal( Var, Var1, cGrupo, cSub )

LOCAL Ind_Ant := IndexOrd()
LOCAL Arq_Ant := Alias()
LOCAL Reg_Ant := Recno()

if Empty( Var )
    ErrorBeep()
    Alerta( "Erro: Codigo Produto Invalido... ")
    AreaAnt( Arq_Ant, Ind_Ant )
    DbGoto( Reg_Ant )
    return( .F. )

endif
if Var == Var1
    AreaAnt( Arq_Ant, Ind_Ant )
    DbGoto( Reg_Ant )
    return( .T. )

endif
dbSelectArea( "Lista" )
Lista->(Order( 2 ))
Lista->(DbGoTop())
if ( DbSeek( Var ) )
    ErrorBeep()
    Alerta("Erro: Produto Ja Registrado..." )
    AreaAnt( Arq_Ant, Ind_Ant )
    DbGoto( Reg_Ant )
    return( .F. )
endif
AreaAnt( Arq_Ant, Ind_Ant )
DbGoto( Reg_Ant )
return( .T. )

Proc AntProx()

LOCAL nCol := 14

cCodi  := Lista->Codi
cSigla := Lista->Sigla
if !Empty( cCodi )
    Pagarrado( cCodi, 09, nCol+19, @cSigla)
else
    Write( 09, nCol+19, Space(40))
endif
Write( 06, nCol,     "Codigo......: " + Codigo )
Write( 07, nCol,     "Codigo Fab..: " + N_Original )
Write( 08, nCol,     "Descricao...: " + Descricao )
Write( 09, nCol,     "Fornecedor..: " + cCodi )
Write( 10, nCol,     "Unidade.....: " + Un )
Write( 11, nCol,     "Quant.Min...: " + Str( QMin ))
Write( 12, nCol,     "Quant.Max...: " + Str( QMax ))
Write( 13, nCol,     "Embalagem...: " + Str( Emb ))
Write( 14, nCol,     "Porc. Vend..: " + Str( Porc ))
Write( 15, nCol,     "Preco Custo.: " + Tran( Pcusto, "@E 99,999,999.99" ))
Write( 16, nCol,     "Preco Atac..: " + Tran( Atacado,"@E 99,999,999.99" ))
Write( 17, nCol,     "Preco Varejo: " + Tran( Varejo, "@E 99,999,999.99" ))
return

Function Ped_Cli9()

LOCAL cScreen := SaveScreen()
LOCAL GetList := {}
LOCAL cFatura := Space(07)

oMenu:Limpa()
WHILE .T.
     dbSelectArea( "Saidas" )
     Saidas->(Order( 3 ))
     Saidas->(DbGoTop())
     MaBox( 15, 10, 17, 37 )
     cFatura := Space(7)
     SetCursor(1) ; DevPos( 16, 11 ) ; DevOut( "Fatura N?....¯" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cFatura, "cFatura", "@!", {|| VisualAchaFatura( @cFatura )},))
     ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
     if LastKey() = 27
         ResTela( cScreen )
         Exit
     endif
     Saidas->(DbGoTop())
     Ped_Cli9_1( cFatura )
EndDo

Function Fornecedor( cCodi, nCliRecno, nRow, nCol )

LOCAL aRotina := {{|| ForInclusao() }}
LOCAL cScreen := SaveScreen()
LOCAL Ind_Ant := IndexOrd()
LOCAL Arq_Ant := Alias()

dbSelectArea( "Pagar" )
Pagar->(Order( 2 ))
Pagar->(DbGoTop())
if ( Lastrec() = 0 )
    ErrorBeep()
    if Conf( "Nenhum Fornecedor Registrado. Registrar ?" )
        ForInclusao()
    endif
    AreaAnt( Arq_Ant, Ind_Ant )
    ResTela( cScreen )
    return( .F. )
endif
Cor := SetColor()
if !(DbSeek( cCodi ) )
    Pagar->(Order( 1 ))
    Pagar->(DbGoTop())
    Pagar->(Escolhe( 03, 01, 22, "Codi + '? + Nome + '? + Sigla", "CODI NOME DO FORNECEDOR                       SIGLA", aRotina ))
endif
SetColor( Cor )
nCliRecno := Pagar->(Recno())
cCodi      := Pagar->Codi
if nCol <> Nil .AND. nRow <> Nil
    Write( nRow, nCol, Space( 40 ))
    Write( nRow, nCol, Pagar->Nome )
endif
AreaAnt( Arq_Ant, Ind_Ant )
return(.T.)

Function AchaDataIni( dIni, nRecno )

LOCAL Arq_Ant := Alias()
LOCAL Ind_Ant := IndexOrd()

Saidas->(Order( 4 ))
if Saidas->(!DbSeek( dIni ))
    ErrorBeep()
    Alerta("Erro: Data Inicial nao encontrada. ")
    AreaAnt( Arq_Ant, Ind_Ant )
    return(.F.)
endif
nRecno := Saidas->(Recno())
AreaAnt( Arq_Ant, Ind_Ant )
return(.T.)

Proc Cabec002( Pagina, Titulo, Tam, Cabecalho)

Write( 00, 00, Padr( "Pagina N?" + StrZero( Pagina, 4 ), ( Tam/2 ) ) + Padl( Time(), ( Tam/2 ) ) )
Write( 01, 00, Date() )
Write( 02, 00, Padc( XNOMEFIR, Tam ) )
Write( 03, 00, Padc( SISTEM_NA2, Tam ) )
Write( 04, 00, Padc( Titulo ,Tam ) )
Write( 05, 00, Repl( "-", Tam ))
Write( 06, 00, Cabecalho )
Write( 07, 00, Repl( "-", Tam ))
return

Function EntraMov( cCodigo )

LOCAL aRotina              := {{|| InclusaoProdutos() }}
LOCAL aRotinaAlteracao := {{|| InclusaoProdutos(.T.) }}
LOCAL Arq_Ant              := Alias()
LOCAL Ind_Ant              := IndexOrd()
cCodigo                      := StrCodigo( cCodigo )

Lista->(Order( 2 ))
if Lista->(!DbSeek( cCodigo ))
    Lista->(Order( 3 ))
    Lista->(Escolhe( 03, 01, 22,"Codigo + '? + Descricao + '? + Sigla","CODIG DESCRICAO DO PRODUTO                     MARCA", aRotina,,aRotinaAlteracao ))
endif
cCodigo := Lista->Codigo
Entradas->(Order( 1 ))
if Entradas->(!DbSeek( cCodigo ))
    AreaAnt( Arq_Ant, Ind_Ant )
    Nada()
    return( .F. )
endif
AreaAnt( Arq_Ant, Ind_Ant )
return(.T.)

Function CodiMov( cCodigo, nRow, nCol )

LOCAL aRotina              := {{|| InclusaoProdutos() }}
LOCAL aRotinaAlteracao := {{|| InclusaoProdutos(.T.) }}
LOCAL Arq_Ant              := Alias()
LOCAL Ind_Ant              := IndexOrd()
cCodigo                      := StrCodigo( cCodigo )

Lista->(Order( 2 ))
if Lista->(!DbSeek( cCodigo ))
    Lista->(Order( 3 ))
    Lista->(Escolhe( 03, 01, 22,"Codigo + '? + Descricao + '? + Sigla","CODIG DESCRICAO DO PRODUTO                     MARCA", aRotina,,aRotinaAlteracao ))
endif
if nRow <> NIL
    Write( nRow, nCol, Lista->Descricao )
endif
cCodigo := Lista->Codigo
Saidas->(Order( 1 ))
if Saidas->(!DbSeek( cCodigo ))
    AreaAnt( Arq_Ant, Ind_Ant )
    Nada()
    return( .F. )
endif
AreaAnt( Arq_Ant, Ind_Ant )
return(.T.)

Function SGrupoEra( cSubGrupo )

LOCAL aRotina := {{|| Lista1_1() }}
if !( DbSeek( cSubGrupo ) )
    Escolhe( 03, 01, 22, "CodSgrupo + '? + DesSgrupo ", "CODIGO DESCRICAO DO SUBGRUPO", aRotina )
    cSubGrupo := CodSgrupo
endif
return( .T. )

Proc VendasCliente()

LOCAL GetList        := {}
LOCAL cScreen        := SaveScreen( )
LOCAL dIni            := Date()-30
LOCAL dFim            := Date()
LOCAL cCodi         := Space(05)
LOCAL Col            := 10
LOCAL nTotal        := 0
LOCAL nTotalGeral := 0
LOCAL cCodigo
LOCAL cDescricao
LOCAL cUn
LOCAL cOriginal

WHILE .T.
    MaBox( 10, 10, 14, 35 )
    SetCursor(1) ; DevPos( 11, 11 ) ; DevOut( "Cliente......: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodi, "cCodi", "99999", {|| RecErrado( @cCodi )},))
    SetCursor(1) ; DevPos( 12, 11 ) ; DevOut( "Data Inicial.: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dIni, "dIni", "##/##/##",,))
    SetCursor(1) ; DevPos( 13, 11 ) ; DevOut( "Data Final...: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dFim, "dFim", "##/##/##",,))
    ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
    if LastKey() = 27
        ResTela( cScreen )
        Exit
    endif
    Lista->( Order( 2 ))
    dbSelectArea( "Saidas" )
    Saidas->(Order( 5 ))
    if Saidas->(!DbSeek( cCodi ))
        ErrorBeep()
        Nada()
        ResTela( cScreen )
        Loop
    endif
    if Instru80()
        Mensagem("Informa: Aguarde, Localizando Registros")
        PrintOn()
        FPrint( PQ )
        CabecVen( dIni, dFim)
        WHILE Saidas->Codi = cCodi .AND. Rep_Ok()
            if Saidas->Emis >= dIni .AND. Saidas->Emis <= dFim
                cCodigo      := Saidas->Codigo
                if Lista->(DbSeek( cCodigo ))
                    cDescricao := Lista->Descricao
                    cUn          := Lista->Un
                    cOriginal  := Lista->N_Original
                endif

                Qout( Emis, CCodigo, cOriginal, Fatura, Ponto( cDescricao,40 ), cUn,    Placa, Saida, Tran( Pvendido,"@E 999,999,999,999.99"))
                nTotal        += ( Pvendido * Saida )
                nTotalGeral += ( Pvendido * Saida )
                Col++
            endif
            Saidas->(DbSkip(1))
            if Col >= 55
                Write( ++Col, 103, Tran( nTotal,"@E 9,999,999,999,999.99"))
                CabecVen(dIni,dFim)
                Col     := 10
                nTotal := 0
            endif
        EndDo
        Write( ++Col, 103, Tran( nTotal,      "@E 9,999,999,999,999.99"))
        Write( ++Col, 103, Tran( nTotalGeral,"@E 9,999,999,999,999.99"))
        __Eject()
        PrintOff()
    endif
    ResTela( cScreen )
EndDo

Proc CabecVen(dIni, dFim)

LOCAL  Tam      := 132
STATIC Pagina := 0
         cIni   := Dtoc( dIni )
         cFim   := Dtoc( dFim )
Write( 00, 00, Padr( "Pagina N?" + StrZero( ++Pagina, 4 ), ( Tam/2 ) ) + Padl( Time(), ( Tam/2 ) ) )
Write( 01, 00, Date() )
Write( 02, 00, Padc( XNOMEFIR, Tam ) )
Write( 03, 00, Padc( SISTEM_NA2, Tam ) )
Write( 04, 00, Padc( "RELATORIO DE VENDA INDIVIDUAL NO PERIODO DE &cIni. A &cFim" ,Tam ) )
Write( 05, 00, Repl( "-", Tam ))
Write( 06, 00, NG + Receber->Codi + " " + Receber->Nome + " " + Receber->Fone + NR)
Write( 07, 00, Repl( "-", Tam ))
Write( 08, 00, "EMISSAO  CODIGO  COD. FABRIC.   FATURA    DESCRICAO DO PRODUTO                     UN PLACA        QUANT      PRECO VENDIDO")
Write( 09, 00, Repl( "-", Tam ))
return

Proc Ipi()

LOCAL cScreen := SaveScreen()
LOCAL Tela_Impr
LOCAL Conta
LOCAL Relato
LOCAL Tam
LOCAL Pos1
LOCAL Line
LOCAL Pagina
LOCAL Ok
LOCAL Tot_Reg
LOCAL nReg
LOCAL Esc_Data
LOCAL aPedido
LOCAL nRecno
LOCAL aRegis
LOCAL aMenuArray := { " Por Periodo ", " Por Regiao ", " Todos " }

Saidas->(DbClearFilter())
Saidas->(DbClearRel())
Receber->(Order( 2 ))
Lista->(Order( 2 ))
dbSelectArea( "Saidas" )
if ( ! .F. ) ; dbClearRelation() ; end ; dbSetRelation( "Receber", {|| Codi}, "Codi", .F. ) ; dbSetRelation( "Lista", {|| Codigo}, "Codigo", .F. )
Saidas->(DbGoTop())
nItens := 0
M_Title( "IMPRIMIR" )
Esc_Data := FazMenu( 10, 44, aMenuArray, Cor())
Do Case
Case Esc_Data = 0
    DbClearRel()
    ResTela( cScreen )
    return

Case Esc_Data = 1
    dIni     := Date() - 30
    dFim     := Date()
    nRecno := 0
    MaBox( 18, 20, 21, 56 )
    SetCursor(1) ; DevPos( 19, 21 ) ; DevOut( "Digite Emissao Inicial...¯" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dIni, "dIni", "@K##/##/##", {|| AchaDataIni( dIni, @nRecno )},))
    SetCursor(1) ; DevPos( 20, 21 ) ; DevOut( "Digite Emissao Final.....¯" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dFim, "dFim", "@K##/##/##",,))
    ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
    if LastKey() = 27
        DbClearRel()
        ResTela( cScreen )
        return
    endif
    Saidas->(Order( 4 ))
    oMenu:Limpa()
    Mensagem(" Aguarde... Incluindo... ", 47 )
    aPedido := {}
    aRegis  := {}
    bBloco := {|| Emis >= dIni .AND. Emis <= dFim }
    DbGoTo( nRecno )
    While Eval( bBloco )
        if Ascan( aPedido, Pedido ) = 0
            nItens++
            Aadd( aPedido, Pedido  )
            Aadd( aRegis,    Recno() )
        endif
        DbSkip()
    EndDo

Case Esc_Data = 2
    aPedido := {}
    aRegis  := {}
    nItens  := 0
    WHILE .T.
        oMenu:Limpa()
        nRecno         := 0
        cRegiao         := Space(2)
        dIni             := Date()-30
        dFim             := Date()
        MaBox( 18, 20, 22, 56 )
        SetCursor(1) ; DevPos( 19, 21 ) ; DevOut( "Digite a Regiao........:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cRegiao, "cRegiao", "99", {|| RegiaoErrada( @cRegiao )},))
        SetCursor(1) ; DevPos( 20, 21 ) ; DevOut( "Digite Emissao Inicial.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dIni, "dIni", "##/##/##",,))
        SetCursor(1) ; DevPos( 21, 21 ) ; DevOut( "Digite Emissao Final...:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dFim, "dFim", "##/##/##",,))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        if LastKey() = 27
            ResTela( cScreen )
            Exit
        endif
        oMenu:Limpa()
        Saidas->( Order( 2 ))
        bBloco  := {|| Saidas->Emis >= dIni .AND. Saidas->Emis <= dFim }
        cFatura := Space(07)
        if Saidas->(DbSeek( cRegiao ))
            Mensagem("Aguarde, Incluindo.", 47 )
            While Saidas->Regiao = cRegiao
                if Eval( bBloco )
                    cFatura := Saidas->Fatura
                    nRecno  := Saidas->(Recno())
                    if nContaFatura >= 4096
                        ErrorBeep()
                        Alerta("Erro: Maximo de 4096 Faturas.")
                        Exit
                    endif
                    if Ascan( aPedido, cFatura ) = 0
                        nItens++
                        Aadd( aPedido, cFatura    )
                        Aadd( aRegis,    nRecno )
                    endif
                endif
                Saidas->(DbSkip(1))
            EndDO
        else
            ErrorBeep()
            Alerta("Informa: Nenhum produto vendido nessa regiao.")
        endif
    EndDo

Case Esc_Data = 3
    Saidas->(Order( 4 ))
    oMenu:Limpa()
    Mensagem(" Aguarde... Incluindo... ", 47 )
    aPedido := {}
    aRegis  := {}
    While !Eof()
        if Ascan( aPedido, Pedido ) = 0
            nItens++
            Aadd( aPedido, Pedido  )
            Aadd( aRegis,    Recno() )
        endif
        DbSkip()
    EndDo

EndCase
if nItens = 0
    oMenu:Limpa()
    ErrorBeep()
    Alerta( "Erro: Nenhuma Pedido Disponivel...")
    Saidas->( DbClearRel() )
    Saidas->( DbClearFilter() )
    DbGoTop()
    ResTela( cScreen )
    return

endif
oMenu:Limpa()
Conta := 0
Sobra := nItens
MaBox( 06, 00, 08, 79 )
Write( 07, 01, "Total de Pedidos.¯ " + StrZero( nItens,4 ) )
Write( 07, 26, "Selecionadas.....¯ " + StrZero( Conta, 4 ) )
Write( 07, 51, "Disponiveis......¯ " + StrZero( Sobra, 4 ) )
Priv Registro := {},  NoFatu := {}, Col := 11

MaBox( 10, 26, 22, 79 , "PEDIDO   CODI NOME CLIENTE                      " )
WHILE .T.
    MaBox( 10, 00, 20, 20 , "PEDIDOS")
    Escolha := Achoice( 11, 03, 19, 19, aPedido )
    if Escolha = 0
        Exit
    endif
    DbGoTo( aRegis[ Escolha ] )
    Aadd( Registro, aRegis[ Escolha ] )
    Aadd( NoFatu,     aPedido[ Escolha ] )
    Write( 07, 45, StrZero( ++Conta, 4 ) ,"R/W")
    Write( 07, 70, StrZero( --Sobra, 4 ) ,"R/W")
    Write( Col, 27, Pedido + "    " + Codi + " " + Receber->( Left( nome, 36 ) ) , "R/W")
    Adel( aPedido, Escolha )
    Adel( aRegis, Escolha )
    if Col = 21
        Scroll( 11, 27, 21, 78, 1 )
        Col := 21
    else
        Col++
    endif
Enddo
Saidas->(Order( 3 ))
Saidas->(DbGoTop())
if (Tamanho := Len( Nofatu )) > 0
    if Conf( "Confirma Impressao do Demostrativo ?" )
        nUfir := 0
        dbSelectArea( "Taxas" )
        Taxas->(Order( 2 ))
        WHILE !DbSeek( Date())
            ErrorBeep()
            if Conf("Ufir Valida para " + Dtoc(Date()) + " Nao Encontrada. Registrar ? ")
                InclusaoTaxas( Date())
            endif
        EndDo
        nRec := Taxas->(Recno())
        WHILE ( nUfir := Taxas->Ufir ) = 0
            ErrorBeep()
            Alerta(" Registre Valor para Ufir de " + Dtoc( Date()))
            TaxasDbEdit()
            DbGoTo( nRec )
        EndDo
        nUfir   := Taxas->Ufir
        cCodigo := {}
        cDesc   := {}
        nQuant  := {}
        nSaida  := {}
        if !Instru80()
            ResTela( cScreen )
            return
        endif
        Tela_Impr := SaveScreen()
        Mensagem("Aguarde ... Somando...", Cor())
        Cabecalho := "DESCRICAO DO PRODUTO                      QUANT       CUSTO         TOTAL     II      TOTAL II    IPI TOTAL IPI      UFIR/AQU       II/UFIR      IPI/UFIR"
        Relato     := "DEMOSTRATIVO DE APURACAO DO IMPOSTO DE IMPORTACAO E SOBRE PRODUTOS INDUSTRIALIZADOS"
        Tam         := 153
        Line         := 8
        Pagina     := 0
        PosCur     := 0
        dbSelectArea( "Saidas" )
        Saidas->(Order( 2 ))
        For xY := 1 To Len( Nofatu )
            nReco := Registro[ xY ]
            DbGoTo( nReco )
            bBloco := {|| Pedido = Nofatu[ XY ] }
            While Eval( bBloco )
                nPos := Ascan2( cCodigo, Codigo, 1 )
                if nPos = 0
                    Saidas->(Order( 1 ))
                    Aadd( cCodigo, { Codigo, Lista->Descricao, Saida, Lista->Pcompra, Lista->Ii, Lista->Ipi, Lista->Ufir } )
                else
                  nQtAnt := cCodigo[ nPos, 3]
                  cCodigo[ nPos, 3 ] := ( nQtAnt + Saida )
                endif
                Saidas->(Order( 2 ))
                Saidas->(DbSkip(1))
            EndDo
        Next
        Mensagem("Aguarde ... Somando e Imprimindo...", Cor())
        nTamArray := Len( cCodigo )
        Asort( cCodigo,,, {| x,y | y[2] > x[2] } )
        PrintOn()

        FPrint( PQ )
        SetPrc( 0, 0 )
        Cabec002( ++Pagina, Relato, Tam, Cabecalho)
        yCusto      := 0
        yIi          := 0
        yIpi          := 0
        yUfir       := 0
        yIiUfir      := 0
        yIpiUfir   := 0
        For i := 1 To Len( cCodigo )
            if Line >=    58
                __Eject()
                Cabec002( ++Pagina, Relato, Tam, Cabecalho)
                Line := 8
            endif
            xDescricao := cCodigo[i,2]
            xSaida      := cCodigo[i,3]
            xPcusto      := cCodigo[i,4]
            xIi          := cCodigo[i,5]
            xIpi          := cCodigo[i,6]
            xUfir       := cCodigo[i,7]
            nSomaItem  := ( xSaida * xPcusto )
            nSomaIpi   := ( nSomaItem * xIpi ) / 100
            nSomaIi      := ( nSomaItem * xIi    ) / 100
            nRedIpi      := Round(( nSomaIpi / xUfir ),4)
            nRedIi      := Round(( nSomaIi  / xUfir ),4)
            xSaida      := Str( xSaida,9,2)

            yCusto    += nSomaItem
            yIi        += nSomaIi
            yIpi        += nSomaIpi
            yUfir     += xUfir
            yIiUfir    += nRedIi
            yIpiUfir += nRedIpi








            Qout( Ponto( Left( xDescricao,37),37),    Tran( xSaida, "999999.99"),    Tran( xPcusto,"99999999.99"),    Tran( nSomaItem,"9999999999.99"),    Tran( xIi,"999.99"),    Tran( nSomaIi,"9999999999.99"),    Tran( xIpi,"999.99"),    Tran( nSomaIpi,"999999.99"),    xUfir, nRedIi, nRedIpi )
            Line ++
        Next
        if Line >= 51
            __Eject()
            Cabec002( ++Pagina, Relato, Tam, Cabecalho)
            Line := 8
        endif
        Qout("")
        Qout( Repl("-", 153))
        Qout("** TOTAIS **")
        QQout( Space(47), yCusto, Space(6), yIi, Space(2), yIpi, xUfir, yIiUfir, yIpiUfir )
        Qout( Repl("-", 153))
        Qout("VALOR UNIDADE FISCAL DE REFERENCIA - UFIR DE " + Dtoc( Date()))
        QQout( Space( 86 ), nUfir )
        Qout( Repl("-", 153))
        Qout("VALOR TOTAL DO IMPOSTO DE IMPORTACAO E SOBRE PRODUTOS INDUSTRIALIZADOS A RECOLHER")
        QQout( Space(44), Round(yIiUfir * nUfir,2), Round(yIpiUfir * nUfir,2))
        Qout( Repl("-", 153))
        __Eject()
        PrintOff()
        ResTela( Tela_Impr )
        DbClearFilter( )
        DbGoTop()
        DbClearRel()
    endif
endif
ResTela( cScreen )
return

Function Acha_Tem( cFatura, cCodigo, Reg_Atual, Reg_Ant, lJahTem)

LOCAL Arq_Ant    := Alias()
LOCAL Ind_Ant    := IndexOrd()
LOCAL cProcura := cFatura + Space(2) + StrCodigo( cCodigo )

dbSelectArea( "Saidas" )
Saidas->(Order( 3 ))
if !( DbSeek( cProcura ))
    ErrorBeep()
    if Conf( "Produto Nao Consta na Fatura. Incluir ?" )
        Lista->(Order( 2 ))
        if Lista->(!DbSeek( cCodigo ))
            ErrorBeep()
            Alerta("Erro: Produto Nao Registrado...")
            AreaAnt( Arq_Ant, Ind_Ant )
            return( .F. )
        else
            AreaAnt( Arq_Ant, Ind_Ant )



            dbSelectArea( "Saidas" )
            if Saidas->( !Incluiu())
                AreaAnt( Arq_Ant, Ind_Ant )
                return(.F.)
            else
                For nField := 1 To Saidas->(FCount())
                    FieldPut( nField, Saidas->(FieldGet( nField )))
                Next
            endif
            Saidas->Codigo   := Lista->Codigo
            Saidas->Saida      := 0
            Saidas->Pvendido := Lista->Atacado
            Reg_Atual := Saidas->(Recno())
            lJahTem     := .F.
            return(.T.)
        endif
    else
        AreaAnt( Arq_Ant, Ind_Ant )
        return(.F.)
    endif
else
    ErrorBeep()
    if Conf( "Produto Ja Consta na Fatura. Alterar Quantidade ? " )
        Reg_Atual := Saidas->(Recno())
        AreaAnt( Arq_Ant, Ind_Ant )
        lJahTem := .T.
        return(.T.)
    else
        AreaAnt( Arq_Ant, Ind_Ant )
        return(.F.)
    endif
endif

Proc Pedidos()

LOCAL cScreen := SaveScreen()
LOCAL Salva_Tela, nChoice
LOCAL aMenuArray := { " Visualizar Pedido "," Imprimir Pedido   " }

WHILE .T.
    oMenu:Limpa()
    M_Title( "PEDIDOS A FORNECEDOR" )
    nChoice := FazMenu( 02, 08, aMenuArray, Cor())
    if nChoice = 0
        ResTela( cScreen )
        return
    else
        PedidoDbedit( nChoice )
    endif
EndDo

Proc PedidoDbedit( nVerOuImprimir )

LOCAL cScreen        := SaveScreen()
LOCAL aMedia        := {"Normal", "Com Media Venda"}
LOCAL aMenuArray    := {"Individual", "Parcial", "Por Grupo", "Por SubGrupo", "Por Fornecedor", "Geral" }
LOCAL aOrdem        := {"Codigo","Cod Fabrica","Descricao","Pvenda","Pcusto","Estoque"}
LOCAL cArquivo     := FTempName()
LOCAL xNtx            := FTempName()
LOCAL nChoice        := 0
LOCAL nTotalGeral := 0
LOCAL aVetor1
LOCAL aVetor2
LOCAL cSubIni
LOCAL cSubFim
LOCAL nMedia

WHILE .T.
    nMedia := FazMenu( 04, 10, aMedia )
    if nMedia = 0
        ResTela( cScreen )
        Exit
    endif
    if nVerOuImprimir = 1
        M_Title("VISUALIZAR PEDIDOS A FORNECEDOR")
    else
        M_Title("IMPRIMIR PEDIDOS A FORNECEDOR")
    endif
    nChoice := FazMenu( 06, 12, aMenuArray, Cor())
    Do Case
    Case nChoice = 0
        ResTela( cScreen )
        Exit

    Case nChoice = 1
        xCodigo := 0
        MaBox( 16, 12, 18, 68, "ENTRE COM O CODIGO")
        SetCursor(1) ; DevPos( 17, 13 ) ; DevOut( "Codigo.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( xCodigo, "xCodigo", "999999", {|| CodiErrado( @xCodigo, NIL, NIL, Row(), Col()+1)},))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        if LastKey() = 27
            ResTela( cScreen )
            Loop
        endif
        dbSelectArea( "Lista" )
        __dbCopyStruct( ( cArquivo ), { } )
        dbUseArea( .T.,, (cArquivo), "xTemp", iif( .F. .OR. .T., ! .T., NIL ), .F. )
        Lista->(Order( 2 ))
        oBloco := {|| Lista->Codigo = xCodigo }
        cTela := Mensagem("Aguarde...", Cor())
        if Lista->(!DbSeek( xCodigo ))
            Nada()
            xTemp->(DbCloseArea())
            Ferase( cArquivo )
            ResTela( cScreen )
            Loop
        endif
        WHILE Lista->(Eval( oBloco )) .AND. Rep_Ok()
            cCodigo := Lista->Codigo
            if Lista->Quant < Lista->Qmin
                xTemp->(DbAppend())
                For nField := 1 To FCount()
                    FieldPut( nField, Lista->(FieldGet( nField )))
                Next
            endif
            Lista->(DbSkip(1))
        EndDo
        xTemp->(DbGoTop())
        Lista->(Order( 2 ))
        if ( ! .F. ) ; dbClearRelation() ; end ; dbSetRelation( "Lista", {|| Codigo}, "Codigo", .F. )
        ResTela( cTela )
        if nVerOuImprimir = 1
            VerPedido()
        else
            WHILE .T.
                oMenu:Limpa()
                M_Title("ESCOLHA A ORDEM A IMPRIMIR. ESC RETORNA")
                nOpcao := FazMenu( 05, 10, aOrdem )
                if nOpcao = 0
                    Exit
                elseif nOpcao = 1
                     Mensagem(" Aguarde, Ordenando Por Codigo. ", 47 )
                     dbSelectArea( "xTemp" )
                     ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Codigo", {|| xTemp->Codigo}, )
                 elseif nOpcao = 2
                     Mensagem("Aguarde, Ordenando Por Cod Fabricante. ", 47 )
                     dbSelectArea( "xTemp" )
                     ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->N_Original", {|| xTemp->N_Original}, )
                 elseif nOpcao = 3
                     Mensagem("Aguarde, Ordenando Por Descricao. ", 47 )
                     dbSelectArea( "xTemp" )
                     ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Descricao", {|| xTemp->Descricao}, )
                 elseif nOpcao = 4
                     Mensagem(" Aguarde, Ordenando Por Preco Venda. ", 47 )
                     dbSelectArea( "xTemp" )
                     ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Varejo", {|| xTemp->Varejo}, )
                 elseif nOpcao = 5
                     Mensagem(" Aguarde, Ordenando Por Preco Custo. ", 47 )
                     dbSelectArea( "xTemp" )
                     ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Pcusto", {|| xTemp->Pcusto}, )
                 elseif nOpcao = 6
                     Mensagem(" Aguarde, Ordenando Por Estoque. ", 47 )
                     dbSelectArea( "xTemp" )
                     ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Quant", {|| xTemp->Quant}, )
                endif
                PedidoImprime()
            EndDo
        endif
        xTemp->(DbCloseArea())
        Ferase( cArquivo )
        Ferase( xNtx )
        ResTela( cScreen )
        Loop

    Case nChoice = 2
        xCodigoIni := 0
        xCodigoFim := 0
        MaBox( 16, 12, 19, 76, "ENTRE COM OS CODIGOS")
        SetCursor(1) ; DevPos( 17, 13 ) ; DevOut( "Codigo Inicial.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( xCodigoIni, "xCodigoIni", "999999", {|| CodiErrado( @xCodigoIni, NIL, NIL, Row(), Col()+1 )},))
        SetCursor(1) ; DevPos( 18, 13 ) ; DevOut( "Codigo Final...:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( xCodigoFim, "xCodigoFim", "999999", {|| CodiErrado( @xCodigoFim, NIL, NIL, Row(), Col()+1 )},))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        if LastKey() = 27
            ResTela( cScreen )
            Loop
        endif
        dbSelectArea( "Lista" )
        __dbCopyStruct( ( cArquivo ), { } )
        dbUseArea( .T.,, (cArquivo), "xTemp", iif( .F. .OR. .T., ! .T., NIL ), .F. )
        Lista->(Order( 2 ))
        oBloco := {|| Lista->Codigo >= xCodigoIni .AND. Lista->Codigo <= xCodigoFim }
        cTela := Mensagem("Aguarde... ", Cor())
        if Lista->(!DbSeek( xCodigoIni ))
            Nada()
            xTemp->(DbCloseArea())
            Ferase( cArquivo )
            ResTela( cScreen )
            Loop
        endif
        WHILE Lista->(Eval( oBloco )) .AND. Rep_Ok()
            cCodigo := Lista->Codigo
            if Lista->Quant < Lista->Qmin
                xTemp->(DbAppend())
                For nField := 1 To FCount()
                    FieldPut( nField, Lista->(FieldGet( nField )))
                Next
            endif
            Lista->(DbSkip(1))
        EndDo
        xTemp->(DbGoTop())
        Lista->(Order( 2 ))
        if ( ! .F. ) ; dbClearRelation() ; end ; dbSetRelation( "Lista", {|| Codigo}, "Codigo", .F. )
        ResTela( cTela )
        if nVerOuImprimir = 1
            VerPedido()
        else
            WHILE .T.
                oMenu:Limpa()
                M_Title("ESCOLHA A ORDEM A IMPRIMIR. ESC RETORNA")
                nOpcao := FazMenu( 05, 10, aOrdem )
                if nOpcao = 0
                    Exit
                elseif nOpcao = 1
                     Mensagem(" Aguarde, Ordenando Por Codigo. ", 47 )
                     dbSelectArea( "xTemp" )
                     ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Codigo", {|| xTemp->Codigo}, )
                 elseif nOpcao = 2
                     Mensagem("Aguarde, Ordenando Por Cod Fabricante. ", 47 )
                     dbSelectArea( "xTemp" )
                     ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->N_Original", {|| xTemp->N_Original}, )
                 elseif nOpcao = 3
                     Mensagem("Aguarde, Ordenando Por Descricao. ", 47 )
                     dbSelectArea( "xTemp" )
                     ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Descricao", {|| xTemp->Descricao}, )
                 elseif nOpcao = 4
                     Mensagem(" Aguarde, Ordenando Por Preco Venda. ", 47 )
                     dbSelectArea( "xTemp" )
                     ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Varejo", {|| xTemp->Varejo}, )
                 elseif nOpcao = 5
                     Mensagem(" Aguarde, Ordenando Por Preco Custo. ", 47 )
                     dbSelectArea( "xTemp" )
                     ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Pcusto", {|| xTemp->Pcusto}, )
                 elseif nOpcao = 6
                     Mensagem(" Aguarde, Ordenando Por Estoque. ", 47 )
                     dbSelectArea( "xTemp" )
                     ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Quant", {|| xTemp->Quant}, )
                endif
                PedidoImprime()
            EndDo
        endif
        xTemp->(DbCloseArea())
        Ferase( cArquivo )
        Ferase( xNtx )
        ResTela( cScreen )
        Loop

    Case nChoice = 3
        cGrupoIni  := Space(03)
        cGrupoFim  := Space(03)
        xCodigoIni := 0
        xCodigoFim := 0
        MaBox( 16, 12, 19, 73, "ENTRE COM O GRUPO")
        SetCursor(1) ; DevPos( 17, 13 ) ; DevOut( "Grupo Inicial.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cGrupoIni, "cGrupoIni", "999", {|| GrupoCerto( @cGrupoIni, Row(), Col()+1 )},))
        SetCursor(1) ; DevPos( 18, 13 ) ; DevOut( "Grupo Final...:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cGrupoFim, "cGrupoFim", "999", {|| GrupoCerto( @cGrupoFim, Row(), Col()+1 )},))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        if LastKey() = 27
            ResTela( cScreen )
            Loop
        endif
        dbSelectArea( "Lista" )
        __dbCopyStruct( ( cArquivo ), { } )
        dbUseArea( .T.,, (cArquivo), "xTemp", iif( .F. .OR. .T., ! .T., NIL ), .F. )
        Lista->(Order( 1 ))
        oBloco := {|| Lista->CodGrupo >= cGrupoIni .AND. Lista->CodGrupo <= cGrupoFim }
        cTela  := Mensagem("Aguarde... ", Cor())
        lAchou := .F.
        WHILE Lista->(!(lAchou := DbSeek( cGrupoIni )))
            cGrupoIni := StrZero( Val( cGrupoIni ) + 1, 3 )
            if cGrupoIni > cGrupoFim
                Nada()
                xTemp->(DbCloseArea())
                Ferase( cArquivo )
                Exit
            endif
        EndDo
        if !lAchou
            ResTela( cScreen )
            Exit
        endif
        WHILE Lista->(Eval( oBloco )) .AND. Rep_Ok()
            cCodigo := Lista->Codigo
            if Lista->Quant < Lista->Qmin
                xTemp->(DbAppend())
                For nField := 1 To FCount()
                    FieldPut( nField, Lista->(FieldGet( nField )))
                Next
            endif
            Lista->(DbSkip(1))
        EndDo
        xTemp->(DbGoTop())
        Lista->(Order( 2 ))
        if ( ! .F. ) ; dbClearRelation() ; end ; dbSetRelation( "Lista", {|| Codigo}, "Codigo", .F. )
        ResTela( cTela )
        if nVerOuImprimir = 1
            VerPedido()
        else
            WHILE .T.
                oMenu:Limpa()
                M_Title("ESCOLHA A ORDEM A IMPRIMIR. ESC RETORNA")
                nOpcao := FazMenu( 05, 10, aOrdem )
                if nOpcao = 0
                    Exit
                elseif nOpcao = 1
                     Mensagem(" Aguarde, Ordenando Por Codigo. ", 47 )
                     dbSelectArea( "xTemp" )
                     ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Codigo", {|| xTemp->Codigo}, )
                 elseif nOpcao = 2
                     Mensagem("Aguarde, Ordenando Por Cod Fabricante. ", 47 )
                     dbSelectArea( "xTemp" )
                     ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->N_Original", {|| xTemp->N_Original}, )
                 elseif nOpcao = 3
                     Mensagem("Aguarde, Ordenando Por Descricao. ", 47 )
                     dbSelectArea( "xTemp" )
                     ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Descricao", {|| xTemp->Descricao}, )
                 elseif nOpcao = 4
                     Mensagem(" Aguarde, Ordenando Por Preco Venda. ", 47 )
                     dbSelectArea( "xTemp" )
                     ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Varejo", {|| xTemp->Varejo}, )
                 elseif nOpcao = 5
                     Mensagem(" Aguarde, Ordenando Por Preco Custo. ", 47 )
                     dbSelectArea( "xTemp" )
                     ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Pcusto", {|| xTemp->Pcusto}, )
                 elseif nOpcao = 6
                     Mensagem(" Aguarde, Ordenando Por Estoque. ", 47 )
                     dbSelectArea( "xTemp" )
                     ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Quant", {|| xTemp->Quant}, )
                endif
                PedidoImprime()
            EndDo
        endif
        xTemp->(DbCloseArea())
        Ferase( cArquivo )
        Ferase( xNtx )
        ResTela( cScreen )
        Loop

    Case nChoice = 4
        cSubIni      := Space(06)
        cSubFim      := Space(06)
        xCodigoIni := 0
        xCodigoFim := 0
        MaBox( 16, 12, 18, 73, "ENTRE COM O SUBGRUPO")
        SetCursor(1) ; DevPos( 17, 13 ) ; DevOut( "SubGrupo.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cSubIni, "cSubIni", "999.99", {|| SubErrado( @cSubIni, Row(), Col()+1 )},))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        if LastKey() = 27
            ResTela( cScreen )
            Loop
        endif
        dbSelectArea( "Lista" )
        __dbCopyStruct( ( cArquivo ), { } )
        dbUseArea( .T.,, (cArquivo), "xTemp", iif( .F. .OR. .T., ! .T., NIL ), .F. )
        Lista->(Order( 8 ))
        oBloco := {|| Lista->CodSGrupo = cSubIni }
        cTela  := Mensagem("Aguarde... ", Cor())
        if Lista->(!DbSeek( cSubIni ))
            Nada()
            xTemp->(DbCloseArea())
            Ferase( cArquivo )
            ResTela( cScreen )
            Exit
        endif
        WHILE Lista->(Eval( oBloco )) .AND. Rep_Ok()
            cCodigo := Lista->Codigo
            if Lista->Quant < Lista->Qmin
                xTemp->(DbAppend())
                For nField := 1 To FCount()
                    FieldPut( nField, Lista->(FieldGet( nField )))
                Next
            endif
            Lista->(DbSkip(1))
        EndDo
        xTemp->(DbGoTop())
        Lista->(Order( 2 ))
        if ( ! .F. ) ; dbClearRelation() ; end ; dbSetRelation( "Lista", {|| Codigo}, "Codigo", .F. )
        ResTela( cTela )
        if nVerOuImprimir = 1
            VerPedido()
        else
            WHILE .T.
                oMenu:Limpa()
                M_Title("ESCOLHA A ORDEM A IMPRIMIR. ESC RETORNA")
                nOpcao := FazMenu( 05, 10, aOrdem )
                if nOpcao = 0
                    Exit
                elseif nOpcao = 1
                     Mensagem(" Aguarde, Ordenando Por Codigo. ", 47 )
                     dbSelectArea( "xTemp" )
                     ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Codigo", {|| xTemp->Codigo}, )
                 elseif nOpcao = 2
                     Mensagem("Aguarde, Ordenando Por Cod Fabricante. ", 47 )
                     dbSelectArea( "xTemp" )
                     ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->N_Original", {|| xTemp->N_Original}, )
                 elseif nOpcao = 3
                     Mensagem("Aguarde, Ordenando Por Descricao. ", 47 )
                     dbSelectArea( "xTemp" )
                     ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Descricao", {|| xTemp->Descricao}, )
                 elseif nOpcao = 4
                     Mensagem(" Aguarde, Ordenando Por Preco Venda. ", 47 )
                     dbSelectArea( "xTemp" )
                     ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Varejo", {|| xTemp->Varejo}, )
                 elseif nOpcao = 5
                     Mensagem(" Aguarde, Ordenando Por Preco Custo. ", 47 )
                     dbSelectArea( "xTemp" )
                     ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Pcusto", {|| xTemp->Pcusto}, )
                 elseif nOpcao = 6
                     Mensagem(" Aguarde, Ordenando Por Estoque. ", 47 )
                     dbSelectArea( "xTemp" )
                     ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Quant", {|| xTemp->Quant}, )
                endif
                PedidoImprime()
            EndDo
        endif
        xTemp->(DbCloseArea())
        Ferase( cArquivo )
        Ferase( xNtx )
        ResTela( cScreen )
        Loop

    Case nChoice = 5
        cCodi   := Space(04)
        MaBox( 16, 12, 18, 72, "ENTRE COM O FORNECEDOR")
        SetCursor(1) ; DevPos( 17, 13 ) ; DevOut( "Fornecedor.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodi, "cCodi", "9999", {|| Pagarrado( @cCodi, Row(), Col()+1 )},))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        if LastKey() = 27
            ResTela( cScreen )
            Loop
        endif
        dbSelectArea( "Lista" )
        __dbCopyStruct( ( cArquivo ), { } )
        dbUseArea( .T.,, (cArquivo), "xTemp", iif( .F. .OR. .T., ! .T., NIL ), .F. )
        Lista->(Order( 9 ))
        oBloco := {|| Lista->Codi = cCodi }
        cTela := Mensagem("Aguarde... ", Cor())
        if Lista->(!DbSeek( cCodi ))
            Nada()
            xTemp->(DbCloseArea())
            Ferase( cArquivo )
            ResTela( cScreen )
            Loop
        endif
        WHILE Lista->(Eval( oBloco )) .AND. Rep_Ok()
            cCodigo := Lista->Codigo
            if Lista->Quant < Lista->Qmin
                xTemp->(DbAppend())
                For nField := 1 To FCount()
                    FieldPut( nField, Lista->(FieldGet( nField )))
                Next
            endif
            Lista->(DbSkip(1))
        EndDo
        xTemp->(DbGoTop())
        Lista->(Order( 2 ))
        if ( ! .F. ) ; dbClearRelation() ; end ; dbSetRelation( "Lista", {|| Codigo}, "Codigo", .F. )
        ResTela( cTela )
        if nVerOuImprimir = 1
            VerPedido()
        else
            WHILE .T.
                oMenu:Limpa()
                M_Title("ESCOLHA A ORDEM A IMPRIMIR. ESC RETORNA")
                nOpcao := FazMenu( 05, 10, aOrdem )
                if nOpcao = 0
                    Exit
                elseif nOpcao = 1
                     Mensagem(" Aguarde, Ordenando Por Codigo. ", 47 )
                     dbSelectArea( "xTemp" )
                     ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Codigo", {|| xTemp->Codigo}, )
                 elseif nOpcao = 2
                     Mensagem("Aguarde, Ordenando Por Cod Fabricante. ", 47 )
                     dbSelectArea( "xTemp" )
                     ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->N_Original", {|| xTemp->N_Original}, )
                 elseif nOpcao = 3
                     Mensagem("Aguarde, Ordenando Por Descricao. ", 47 )
                     dbSelectArea( "xTemp" )
                     ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Descricao", {|| xTemp->Descricao}, )
                 elseif nOpcao = 4
                     Mensagem(" Aguarde, Ordenando Por Preco Venda. ", 47 )
                     dbSelectArea( "xTemp" )
                     ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Varejo", {|| xTemp->Varejo}, )
                 elseif nOpcao = 5
                     Mensagem(" Aguarde, Ordenando Por Preco Custo. ", 47 )
                     dbSelectArea( "xTemp" )
                     ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Pcusto", {|| xTemp->Pcusto}, )
                 elseif nOpcao = 6
                     Mensagem(" Aguarde, Ordenando Por Estoque. ", 47 )
                     dbSelectArea( "xTemp" )
                     ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Quant", {|| xTemp->Quant}, )
                endif
                PedidoImprime()
            EndDo
        endif
        xTemp->(DbCloseArea())
        Ferase( cArquivo )
        Ferase( xNtx )
        ResTela( cScreen )
        Loop

    Case nChoice = 6
        dbSelectArea( "Lista" )
        Lista->(Order( 3 ))
        Lista->(DbGoTop())
        __dbCopyStruct( ( cArquivo ), { } )
        dbUseArea( .T.,, (cArquivo), "xTemp", iif( .F. .OR. .T., ! .T., NIL ), .F. )
        cTela := Mensagem("Aguarde... ", Cor())
        WHILE Lista->(!Eof())
            if Lista->Quant < Lista->Qmin
                xTemp->(DbAppend())
                For nField := 1 To FCount()
                    FieldPut( nField, Lista->(FieldGet( nField )))
                Next
            endif
            Lista->(DbSkip(1))
        EndDo
        xTemp->(DbGoTop())
        Lista->(Order( 2 ))
        if ( ! .F. ) ; dbClearRelation() ; end ; dbSetRelation( "Lista", {|| Codigo}, "Codigo", .F. )
        ResTela( cTela )
        if nVerOuImprimir = 1
            VerPedido()
        else
            WHILE .T.
                oMenu:Limpa()
                M_Title("ESCOLHA A ORDEM A IMPRIMIR. ESC RETORNA")
                nOpcao := FazMenu( 05, 10, aOrdem )
                if nOpcao = 0
                    Exit
                elseif nOpcao = 1
                     Mensagem(" Aguarde, Ordenando Por Codigo. ", 47 )
                     dbSelectArea( "xTemp" )
                     ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Codigo", {|| xTemp->Codigo}, )
                 elseif nOpcao = 2
                     Mensagem("Aguarde, Ordenando Por Cod Fabricante. ", 47 )
                     dbSelectArea( "xTemp" )
                     ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->N_Original", {|| xTemp->N_Original}, )
                 elseif nOpcao = 3
                     Mensagem("Aguarde, Ordenando Por Descricao. ", 47 )
                     dbSelectArea( "xTemp" )
                     ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Descricao", {|| xTemp->Descricao}, )
                 elseif nOpcao = 4
                     Mensagem(" Aguarde, Ordenando Por Preco Venda. ", 47 )
                     dbSelectArea( "xTemp" )
                     ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Varejo", {|| xTemp->Varejo}, )
                 elseif nOpcao = 5
                     Mensagem(" Aguarde, Ordenando Por Preco Custo. ", 47 )
                     dbSelectArea( "xTemp" )
                     ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Pcusto", {|| xTemp->Pcusto}, )
                 elseif nOpcao = 6
                     Mensagem(" Aguarde, Ordenando Por Estoque. ", 47 )
                     dbSelectArea( "xTemp" )
                     ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Quant", {|| xTemp->Quant}, )
                endif
                PedidoImprime()
            EndDo
        endif
        xTemp->(DbCloseArea())
        Ferase( cArquivo )
        Ferase( xNtx )
        ResTela( cScreen )
        Loop
    EndCase
EndDo

Proc VerPedido()

LOCAL cScreen        := SaveScreen()
LOCAL nTotalGeral := 0
PRIVA aVetor1
PRIVA aVetor2

oMenu:Limpa()
Mensagem("Aguarde... Calculando Pedido. ", 47 )
WHILE xTemp->(!EoF())
    nTotalGeral += Pcusto * (Qmin-Quant)
    xTemp->(DbSkip(1))
EndDo
xTemp->(DbGoTop())



aVetor1 := {"Codigo","N_Original","Descricao", "Un", "Quant", "Qmin",    "Qmax", "(Qmin-Quant)","Tran(Varejo, '@E 9,999,999,999.99')",    "Tran(Pcusto, '@E 9,999,999,999.99')",    "Tran(Pcusto * (Qmin-Quant),'@E 9,999,999,999.99')" }


aVetor2 := {"CODIGO","COD FABR","DESCRICAO DO PRODUTO", "UN", "ESTOQUE", "Q.MIN",    "Q.MAX", "FALTANTE", "P.VENDA VAREJO", "P.CUSTO", "TOTAL PEDIDO" }

oMenu:Limpa()
MaBox( 22, 00, 24, 79)
Write( 23, 01," Total Geral Pedido ¯ " + Tran( nTotalGeral,"@E 999,999,999,999.99"))
MaBox( 00, 00, 21, 79,"CONSULTA DE PRODUTOS ABAIXO DO MINIMO")
Seta1(21)
DbEdit( 01, 01, 20, 78, aVetor1, .T., .T., aVetor2 )
ResTela( cScreen )
return

Function FornFrete( cCodi, nVlrFrete)

LOCAL aRotina := {{|| ForInclusao() }}
LOCAL cScreen := SaveScreen()
LOCAL Ind_Ant := IndexOrd()
LOCAL Arq_Ant := Alias()
if ( Empty( cCodi ) .AND. nVlrFrete = 0 )
    return( .T. )
endif
dbSelectArea( "Pagar" )
Pagar->(Order( 2 ))
if ( Lastrec() = 0 )
    ErrorBeep()
    if Conf( "Nenhum Fornecedor Registrado... Registrar ?" )
        ForInclusao()
    endif
    AreaAnt( Arq_Ant, Ind_Ant )
    ResTela( cScreen )
    return( .F. )
endif
Cor := SetColor()
if !(DbSeek( cCodi ) )
    Pagar->(Order( 1 ))
    DbGoTop()
    Escolhe( 03, 01, 22, "Codi + '? + Nome + '? + Sigla", "CODI NOME DO FORNECEDOR                       SIGLA", aRotina )
endif
SetColor( Cor )
cCodi := Codi
Write( 14, 20 , Space( 40 ) )
Write( 14, 20 , Nome )
AreaAnt( Arq_Ant, Ind_Ant )
return(.T.)

Proc VendasTipo()

LOCAL GetList         := {}
LOCAL cScreen         := SaveScreen()
LOCAL cCodigo         := 999999
LOCAL cCodi          := "99999"
LOCAL cForma         := "99"
LOCAL cTipo          := "999999"
LOCAL dIni             := Date()-30
LOCAL dFim             := Date()
LOCAL Col             := 10
LOCAL nTotal         := 0
LOCAL nTotalGeral  := 0
LOCAL nVarejo         := 0
LOCAL nTotalVarejo := 0
LOCAL nQuant         := 0
LOCAL nQuantGeral  := 0
LOCAL nSobra         := 0
LOCAL lCodigo         := .F.
LOCAL lCodi          := .F.
LOCAL lTipo          := .F.
LOCAL lForma         := .F.
LOCAL xArquivo      := FTempName("T*.TMP")
LOCAL xNtx             := FTempName("T*.TMP")
LOCAL aMenu          := {"Emissao", "Codigo", "Fatura", "Tipo", "Fatura+Codigo", "Emissao+Fatura"}
LOCAL nRolVendas     := oIni:Readinteger("relatorios","rolvendas", 2 )
LOCAL nChoice
LOCAL oBloco
LOCAL nField
LOCAL cTela
FIELD Emis
FIELD Fatura
FIELD Tipo
FIELD Nome
FIELD Codigo
FIELD Descricao
FIELD Saida
FIELD Varejo
FIELD PVendido

WHILE .T.
    cCodigo    := 999999
    cCodi     := "99999"
    cTipo     := "999999"
    cForma    := "99"
    MaBox( 05, 10, 12, 35 )
    SetCursor(1) ; DevPos( 06, 11 ) ; DevOut( "Cliente      : " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodi, "cCodi", "99999", {|| ComSemCli( @cCodi, @lCodi )},))
    SetCursor(1) ; DevPos( 07, 11 ) ; DevOut( "Produto      : " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodigo, "cCodigo", "999999", {|| ComSemProd( @cCodigo, @lCodigo )},))
    SetCursor(1) ; DevPos( 08, 11 ) ; DevOut( "Tipo         : " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cTipo, "cTipo", "@!", {|| ComSemTipo( @cTipo, @lTipo )},))
    SetCursor(1) ; DevPos( 09, 11 ) ; DevOut( "Forma Pgto   : " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cForma, "cForma", "99", {|| ComSemForma( @cForma, @lForma )},))
    SetCursor(1) ; DevPos( 10, 11 ) ; DevOut( "Emis Inicial : " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dIni, "dIni", "##/##/##",,))
    SetCursor(1) ; DevPos( 11, 11 ) ; DevOut( "Emis Final   : " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dFim, "dFim", "##/##/##",,))
    ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
    if LastKey() = 27
        ResTela( cScreen )
        Exit
    endif
    cTela := Mensagem("Aguarde, Processando.", Cor())
    dbSelectArea( "Saidas" )
    Saidas->(Order( 4 ))
    nTotal         := 0
    nVarejo         := 0
    nTotalVarejo := 0
    nTotalGeral  := 0
    nQuant         := 0
    nQuantGeral  := 0
    nSobra         := 0
    oBloco         := {|| Saidas->Emis >= dIni .AND. Saidas->Emis <= dFim }
    __dbCopyStruct( ( xArquivo ), { } )
    dbUseArea( .T.,, (xArquivo), "xNewDbf", iif( .F. .OR. .T., ! .T., NIL ), .F. )
    LETO_SET( 9, "On" )
    Saidas->(DbSeek( dIni ))
    LETO_SET( 9, "Off" )
    WHILE Eval( oBloco ) .AND. Rep_Ok()
        if nRolVendas = 2
            if !Saidas->Impresso
                Saidas->(DbSkip(1))
                Loop
            endif
        endif
        xNewDbf->(DbAppend())
        For nField := 1 To FCount()
            xNewDbf->(FieldPut( nField, Saidas->(FieldGet( nField ))))
        Next
        Saidas->(DbSkip(1))
    EndDo
    ResTela( cTela )
    xNewDbf->(DbGoTop())
    if xNewDbf->(Eof())
        xNewDbf->(DbCloseArea())
        Ferase( xArquivo )
        Ferase( xNtx )
        ErrorBeep()
        Alerta("Informa: Nada Consta.")
        ResTela( cScreen )
        Loop
    endif
    oMenu:Limpa()
    M_Title("ESCOLHA A ORDEM")
    nChoice := FazMenu( 05, 10, aMenu, Cor())
    if nChoice = 0
        xNewDbf->(DbCloseArea())
        Ferase( xArquivo )
        Ferase( xNtx )
        ResTela( cScreen )
        Loop
    elseif nChoice = 1
        ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( (xNtx ),, "xNewDbf->Emis", {|| xNewDbf->Emis}, )
    elseif nChoice = 2
        ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( (xNtx ),, "xNewDbf->Codigo", {|| xNewDbf->Codigo}, )
    elseif nChoice = 3
        ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( (xNtx ),, "xNewDbf->Fatura", {|| xNewDbf->Fatura}, )
    elseif nChoice = 4
        ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( (xNtx ),, "xNewDbf->Tipo", {|| xNewDbf->Tipo}, )
    elseif nChoice = 5
        ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( (xNtx ),, "xNewDbf->Fatura + xNewDbf->Codigo", {|| xNewDbf->Fatura + xNewDbf->Codigo}, )
    elseif nChoice = 6
        ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( (xNtx ),, "Dtos( xNewDbf->Emis ) + xNewDbf->Fatura", {|| Dtos( xNewDbf->Emis ) + xNewDbf->Fatura}, )
    endif
    Lista->( Order( 2 ))
    Receber->( Order( 2 ))
    if ( ! .F. ) ; dbClearRelation() ; end ; dbSetRelation( "Lista", {|| xNewDbf->Codigo}, "xNewDbf->Codigo", .F. ) ; dbSetRelation( "Receber", {|| xNewDbf->Codi}, "xNewDbf->Codi", .F. )
    xNewDbf->(DbGoTop())
    if !InsTru80()
        xNewDbf->(DbCloseArea())
        Ferase( xArquivo )
        Ferase( xNtx )
        ResTela( cScreen )
        Loop
    endif
    Mensagem(" Please, aguarde. Imprimindo.", Cor())
    PrintOn()
    FPrint( _CPI12 )
    FPrint( PQ )
    CabecTipo( cCodi, cTipo, cCodigo, dIni, dFim )
    WHILE xNewDbf->(!Eof()) .AND. Rep_Ok()
        if lCodi
            if xNewDbf->Codi <> cCodi
                xNewDbf->(DbSkip(1))
                Loop
            endif
        endif
        if lCodigo
            if xNewDbf->Codigo <> cCodigo
                xNewDbf->(DbSkip(1))
                Loop
            endif
        endif
        if lTipo
            if xNewDbf->Tipo <> cTipo
                xNewDbf->(DbSkip(1))
                Loop
            endif
        endif
        if lForma
            if xNewDbf->Forma <> cForma
                xNewDbf->(DbSkip(1))
                Loop
            endif
        endif




        Qout( Emis, Fatura, Tipo, Receber->(Left( Nome,20)), Codigo,    Lista->(Ponto( Left( Descricao,32),32)), Saida,    Tran( Varejo, "@E 999,999.99"),    Tran( Pvendido,"@E 999,999.99"),    Tran( Pvendido*Saida,"@E 999,999.99"), Forma)
        nTotal         += ( Pvendido * Saida )
        nTotalGeral  += ( Pvendido * Saida )
        nVarejo         += ( Varejo    * Saida )
        nTotalVarejo += ( Varejo    * Saida )
        nQuant         += Saida
        nQuantGeral  += Saida
        Col++
        nSobra := 0
        DbSkip(1)
        if Col >= 55
            Write( ++Col, 087, Tran( nQuant,  "@E 999999.99"))
            Write(    Col, 097, Tran( nVarejo, "@E 999,999.99"))
            Write(    Col, 119, Tran( nTotal,  "@E 999,999.99"))
            CabecTipo( cCodi, cTipo, cCodigo, dIni, dFim )
            Col      := 8
            nTotal  := 0
            nVarejo := 0
            nQuant  := 0
        endif
    EndDo
    xNewDbf->(DbClearFilter())
    xNewDbf->(DbClearRel())
    xNewDbf->(DbCloseArea())
    Ferase( xArquivo )
    Ferase( xNtx )
    Write( ++Col, 087, Tran( nQuant,         "@E 999999.99"))
    Write(    Col, 097, Tran( nVarejo,        "@E 999,999.99"))
    Write(    Col, 119, Tran( nTotal,         "@E 999,999.99"))
    Write( ++Col, 087, Tran( nQuantGeral,    "@E 999999.99"))
    Write(    Col, 097, Tran( nTotalVarejo, "@E 999,999.99"))
    Write(    Col, 119, Tran( nTotalGeral,    "@E 999,999.99"))
    __Eject()
    PrintOff()
    ResTela( cScreen )
EndDo

Function ComSemProd( cCodigo, lCodigo )

LOCAL xCompare := 999999

if ValType( cCodigo ) = "C"
    xCompare := StrZero( xCompare, 6 )
endif
if cCodigo <> xCompare
    lCodigo := .T.
    CodiErrado( @cCodigo )
endif
return( .T. )

Function ComSemCli( cCodi, lCodi )

if cCodi <> "99999"
    lCodi := .T.
    RecErrado( @cCodi )
endif
return( .T. )

Function ComSemTipo( cTipo, lTipo )

if cTipo <> "999999"
    lTipo := .T.
endif
return( .T. )

Function ComSemForma( cForma, lForma )

if cForma <> "99"
    lForma := .T.
    FormaErrada( @cForma )
endif
return( .T. )

Proc CabecTipo( cCodi, cTipo, cCodigo, dIni, dFim )

LOCAL  Tam      := 132
STATIC Pagina := 0
         cIni   := Dtoc( dIni )
         cFim   := Dtoc( dFim )
Write( 00, 00, Padr( "Pagina N?" + StrZero( ++Pagina, 4 ), ( Tam/2 ) ) + Padl( Time(), ( Tam/2 ) ) )
Write( 01, 00, Date() )
Write( 02, 00, Padc( XNOMEFIR, Tam ) )
Write( 03, 00, Padc( SISTEM_NA2, Tam ) )
Write( 04, 00, Padc( "RELATORIO DE VENDAS NO PERIODO DE &cIni. A &cFim" ,Tam ) )
Write( 05, 00, Repl( "-", Tam ))
Write( 06, 00, "DATA     DOCTO N? TIPO   NOME DO CLIENTE      CODIGO DESCRICAO DO PRODUTO                 QUANT   P.VAREJO  P.VENDIDO  T.VENDIDO FP")
Write( 07, 00, Repl( "-", Tam ))
return


Proc Separacao()

LOCAL GetList         := {}
LOCAL cScreen         := SaveScreen()
LOCAL aFatuTemp     := {}
LOCAL aFatura         := {}
LOCAL aRegis         := {}
LOCAL aRegiTemp     := {}
LOCAL dIni             := Date()-30
LOCAL dFim             := Date()
LOCAL nRecno         := 0
LOCAL nItens         := 0
LOCAL nConta         := 0
LOCAL nContaFatura := 0
LOCAL nTamanho      := 0
LOCAL cRegiao         := Space(02)
LOCAL cFatura         := Space(07)
LOCAL nChoice         := 1
LOCAL Col             := 0
LOCAL nQuant
LOCAL cSigla
LOCAL cDescricao
LOCAL cCodi
LOCAL cNome
LOCAL bBloco
LOCAL cTela
LOCAL cRelato
LOCAL nTam
LOCAL Pos1
LOCAL Line
LOCAL nPagina
LOCAL Ok
LOCAL Tot_Reg
LOCAL nReg
LOCAL nSobra
LOCAL Escolha
LOCAL aCodigo
LOCAL cCodigo
LOCAL cDesc
LOCAL nSaida
LOCAL cCabecalho
LOCAL PosCur
LOCAL nX
LOCAL nPos
FIELD Codigo
Field Saida

BuscaFatura( @aFatuTemp, @aFatura, @aRegis, @aRegiTemp, "RELACAO DE SEPARACAO" )
if ( nTamanho := Len( aFatura )) > 0
    oMenu:Limpa()
    ErrorBeep()
    if Conf("Pergunta: Imprimir Relacao de Separacao ?" )
        if !InsTru80()
            ResTela( cScreen )
            return
        endif
        Lista->(Order( 2 ))
        Saidas->(Order( 3 ))
        Saidas->(DbGoTop())
        aCodigo     := {}
        cDesc      := {}
        cTela      := SaveScreen()
        Mensagem("Aguarde, Somando.", Cor())
        cRelato      := "RELACAO DE PRODUTOS PARA SEPARACAO"
        cCabecalho := "CODIGO DESCRICAO DO PRODUTO                     FORNECEDOR     QUANT   ESTOQUE"
        nTam          := 80
        Line          := 08
        nPagina      := 00
        PosCur      := 00
        nTamanho   := Len( aFatura )
        For nX := 1 To nTamanho
            nRecno := aRegis[ nX ]
            Saidas->(DbGoTo( nRecno ))
            bBloco := {|| Saidas->Fatura = aFatura[ nX ] }
            While Saidas->(Eval( bBloco ))
                cCodigo      := Saidas->Codigo
                nSaida      := Saidas->Saida
                nQuant      := 0
                cDescricao := Lista->(Space(Len( Descricao )))
                cSigla      := Lista->(Space(Len( Sigla      )))
                if ( nPos := Ascan2( aCodigo, cCodigo, 1 )) = 0
                    if Lista->(DbSeek( cCodigo ))
                        nQuant      := Lista->Quant
                        cDescricao := Lista->Descricao
                        cSigla      := Lista->Sigla
                    endif
                    Aadd( aCodigo, { cCodigo, cDescricao, nSaida, nQuant, cSigla } )
                else
                  aCodigo[ nPos, 3 ] += nSaida
                endif
                Saidas->(DbSkip(1))
            EndDo
        Next
        nTamanho := Len( aCodigo )
        For nX := 1 To nTamanho
            aCodigo[ nX, 3 ] := StrZero( aCodigo[ nX, 3 ], 9, 2 )
            aCodigo[ nX, 4 ] := StrZero( aCodigo[ nX, 4 ], 9, 2 )
        Next
        Asort( aCodigo,,, {| x, y | y[2] > x[2] } )
        Mensagem("Aguarde, Somando e Imprimindo.", Cor())
        PrintOn()
        SetPrc( 0, 0 )
        Cabec002( ++nPagina, cRelato, nTam, cCabecalho)
        For nX := 1 To Len( aFatura )
            if Poscur >= 79
                Poscur := 0
                Line++
             endif
             Write( Line, PosCur, NG + aFatura[ nX ] + Chr( 27) + NR )
             PosCur += 8
        Next
        Line += 2
        For nX := 1 To Len( aCodigo )
            if Line >=    58
                __Eject()
                Cabec002( ++nPagina, cRelato, nTam, cCabecalho)
                Line := 8
            endif
            Qout( aCodigo[ nX,1 ], Ponto( aCodigo[ nX,2 ],40), Left( aCodigo[ nX,5 ], 14 ) , aCodigo[ nX,3 ], aCodigo[ nX, 4 ] )
            Line ++
        Next
        __Eject()
        PrintOff()
        ResTela( cTela )
    endif
endif
ResTela( cScreen )
return

Proc Espelho( cNoFatura )

LOCAL cScreen         := SaveScreen()
LOCAL aFatuTemp     := {}
LOCAL aFatura         := {}
LOCAL aRegis         := {}
LOCAL aRegiTemp     := {}
LOCAL nTamanho      := 0
LOCAL nDesconto     := 0
LOCAL nRow             := 0
LOCAL nTotal         := 0
LOCAL nTotalNota     := 0
LOCAL nItens         := 0
LOCAL Pagina         := 0
LOCAL nBaseIcms     := 0
LOCAL nBaseSubs     := 0
LOCAL nVlrIcms      := 0
LOCAL nVlrSubs      := 0
LOCAL nAliquota     := 0
LOCAL nTaxa          := 0
LOCAL cForma         := ""
LOCAL cCodiVen      := ""
LOCAL nReducao      := 0
LOCAL cTela
LOCAL cCodi

if cNoFatura = NIL
    BuscaFatura( @aFatuTemp, @aFatura, @aRegis, @aRegiTemp, "ESPELHO DE NOTA" )
else
    Aadd( aFatura, cNofatura )
endif
if ( nTamanho := Len( aFatura )) > 0
    oMenu:Limpa()
    ErrorBeep()
    if Conf("Pergunta: Imprimir Espelho de Nota ?" )
        nDesconto := 0
        MaBox( 10, 10, 12, 70, "INFORMACOES COMPLEMENTARES")
        SetCursor(1) ; DevPos( 11, 11 ) ; DevOut( "Desconto.........:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nDesconto, "nDesconto", "99.99",,))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        if LastKey() = 27 .OR. !InsTru80()
            ResTela( cScreen )
            return
        endif
        Cep->(Order( 1 ))
        Receber->(Order( 2 ))
        Lista->(Order( 2 ))
        Saidas->(Order( 3 ))
        cTela      := SaveScreen()
        nTamanho  := Len( aFatura )
        Mensagem("Aguarde, Imprimindo.", Cor())
        PrintOn()
        FPrint( _CPI12 )
        For nX := 1 To nTamanho
            cFatura      := aFatura[ nX ]
            nRow          := 11
            nTotal      := 0
            nTotalNota := 0
            nBaseIcms  := 0
            nBaseSubs  := 0
            nVlrIcms   := 0
            nVlrSubs   := 0
            nBaseRed   := 0

            bBloco  := {|| Saidas->Fatura = cFatura }
            if Saidas->(DbSeek( cFatura ))
                dEmis     := Saidas->Emis
                cForma    := Saidas->Forma
                cCodiVen := Saidas->CodiVen
                nItens    := 0
                Receber->(DbSeek( Saidas->Codi ))
                Cep->(DbSeek( Receber->Cep ))
                sCpf         := Receber->Cpf
                cCodi      := Receber->Codi
            nAliquota := Receber->Tx_Icms
                cEsta      := Cep->Esta
                WHILE Saidas->(EVal( bBloco )) .AND. Rel_Ok()
                    if nItens = 0
                        Front( Pagina, cFatura, dEmis, cForma, cCodiVen, cCodi )
                    endif
                    nPvendido := Saidas->Pvendido
                    nPvendido -= ( nPvendido * nDesconto ) / 100
                    nSoma      := ( Saidas->Saida * nPvendido )
                    Lista->(DbSeek( Saidas->Codigo ))






                    Qout( Saidas->Saida,    Lista->Un,    Lista->Codigo,    Lista->Descricao,    Lista->Sigla,    Tran( nPvendido,"@E 999,999.99" ),    Tran( nSoma,     "@E 999,999.99" ))
                    nItens++
                    nRow++
                    nTotal      += nSoma
                    nTotalNota += nSoma

                    cClasse    := Lista->Classe
                    if cClasse = "10"
                        if "RO" <> cEsta
                            cClasse = "00"
                        endif
                    endif
                    cCodigo    := Lista->Codigo
                    nReducao := ReducaoBase( cEsta )
                    nTaxa     := Lista->Tx_Icms
                    nSomaRed := nSoma - (( nSoma * nReducao ) / 100 )
                    if nSomaRed = 0
                        nSomaRed = nSoma
                    endif
                    nSomaSub := ( nSoma + (( nSoma * nTaxa ) / 100 ))
                    nIcmsRed := ( nSomaRed * nAliquota ) / 100
                    nIcms     := ( nSoma * nAliquota ) / 100
                    nSub        := (( nSomaSub * nAliquota ) / 100 ) - nIcms
                    Do Case
                    Case cClasse = "00"
                        nBaseIcms += nSoma
                        nBaseSubs += 0
                        nVlrIcms  += nIcms
                        nVlrSubs  += 0
                    Case cClasse = "10"
                        nBaseIcms  += nSoma
                        nBaseSubs  += nSomaSub
                        nVlrIcms   += nIcms
                        nVlrSubs   += nSub
                        nTotalNota += nSub
                    Case cClasse = "20"
                        nBaseIcms += nSomaRed
                        nBaseSubs += 0
                        nVlrIcms  += nIcmsRed
                        nVlrSubs  += 0
                    Case cClasse = "30"
                        nBaseIcms += 0
                        nBaseSubs += nSomaSub
                        nVlrIcms  += 0
                        nVlrSubs  += nSub
                    Case cClasse = "40"
                        nBaseIcms += 0
                        nBaseSubs += 0
                        nVlrIcms  += 0
                        nVlrSubs  += 0
                    Case cClasse = "41"
                        nBaseIcms += 0
                        nBaseSubs += 0
                        nVlrIcms  += 0
                        nVlrSubs  += 0
                    Case cClasse = "50"
                    Case cClasse = "51"
                    Case cClasse = "60"
                    Case cClasse = "70"
                    Case cClasse = "90"
                    EndCase

                    if nItens = 23
                        nItens := 0
                        FechaEspelho( nTotal, nRow, nDesconto, nBaseIcms, nBaseSubs, nVlrIcms, nVlrSubs, nTotalNota )
                        __Eject()
                        nRow          := 11
                        nTotal      := 0
                        nTotalNota := 0
                        nBaseIcms  := 0
                        nBaseSubs  := 0
                        nVlrIcms   := 0
                        nVlrSubs   := 0
                    endif
                    Saidas->(DbSkip(1))
                EndDo
                if nItens <> 0
                    FechaEspelho( nTotal, nRow, nDesconto, nBaseIcms, nBaseSubs, nVlrIcms, nVlrSubs, nTotalNota )
                    __Eject()
                endif
            endif
        Next
        PrintOff()
        ResTela( cTela )
    endif
endif
ResTela( cScreen )
return

Proc FrontParcial( Pagina, cFatura, dEmis, cForma, cCodiVen )

LOCAL Tam := 93

Forma->(Order( 1))
Forma->(DbSeek( cForma ))
SetPrc( 0, 0)
Write( 00, 00 , "Emissao....: " + Dtoc( dEmis ))
Write( 00, 52 , "Fatura N?.: " + cFatura )
Write( 01, 00 , "Transporte.: " + "RODOVIARIO" )

Write( 02, 00 , "F. Pagto...: " + Forma->Forma + "  " + Forma->Condicoes )
Write( 03, 00 , "Cliente....: " + NG + Receber->Codi  + " " + Receber->Nome + NR )
Write( 04, 00 , "Fantasia...: " + NG + Left(Receber->Fanta,30) + NR )
Write( 04, 52 , "Vendedor...: " + cCodiVen )
Write( 05, 00 , "Endereco...: " + Receber->Ende )
Write( 05, 52 , "Telefone...: ")
Write( 06, 00 , "Cidade.....: " + Receber->Cep + "/" + Receber->Cida )
Write( 06, 52 , "Estado.....: " + Receber->Esta )
Write( 07, 00 , "CGC/CPF....: " + if( Empty( Receber->Cgc ), Receber->Cpf, Receber->Cgc ))
Write( 07, 52 , "Insc/Rg....: " + if( Empty( Receber->Rg  ), Receber->Rg, Receber->Insc ))
Write( 08, 00 , Repl( "-", Tam ) )



   Write( 09, 00 , "    QUANT UN CODIGO       DESCRICAO DO PRODUTO               MARCA      P.UNITARIO      TOTAL")

Write( 10, 00 , Repl( "-", Tam ))
return

Proc Front( Pagina, cFatura, dEmis, cForma, cCodiVen )

LOCAL Tam := 93

Forma->(Order( 1))
Forma->(DbSeek( cForma ))
SetPrc( 0, 0)
Write( 00, 00 , "Emissao....: " + Dtoc( dEmis ))
Write( 00, 52 , "Fatura N?.: " + cFatura )
Write( 01, 00 , "Transporte.: " + "RODOVIARIO" )
Write( 01, 52 , "Nat. Oper..: " + Receber->Cfop )
Write( 02, 00 , "F. Pagto...: " + Forma->Forma + "  " + Forma->Condicoes )
Write( 03, 00 , "Cliente....: " + NG + Receber->Codi  + " " + Receber->Nome + NR )
Write( 04, 00 , "Fantasia...: " + NG + Left( Receber->Fanta, 30) + NR )
Write( 04, 52 , "Vendedor...: " + cCodiven )
Write( 05, 00 , "Endereco...: " + Receber->Ende )
Write( 05, 52 , "Telefone...: " + Receber->Fone )
Write( 06, 00 , "Cidade.....: " + Receber->Cep + "/" + Receber->Cida )
Write( 06, 52 , "Estado.....: " + Receber->Esta )
Write( 07, 00 , "CGC/CPF....: " + if( Empty( Receber->Cgc ), Receber->Cpf, Receber->Cgc ))
Write( 07, 52 , "Insc/Rg....: " + if( Empty( Receber->Cgc ), Receber->Rg,  Receber->Insc ))
Write( 08, 00 , Repl( "-", Tam ) )
Write( 09, 00 , "    QUANT UN CODIGO DESCRICAO DO PRODUTO                     MARCA      P.UNITARIO      TOTAL")
Write( 10, 00 , Repl( "-", Tam ))
return

Proc FechaEspelho( nTotal, nRow, nDesconto, nBaseIcms, nBaseSubs, nVlrIcms, nVlrSubs, nTotalNota )

LOCAL Tam        := 93
LOCAL nSoma     := 0
LOCAL nCol1     := 00
LOCAL nCol2     := 20
LOCAL nCol3     := 39
LOCAL nCol4     := 58
LOCAL nCol5     := 77
LOCAL oBloco

nRow := 37
Write( ++nRow, 00, Repl( "=", Tam ))
Write( ++nRow, 00,     "|BASE DO ICMS       |VALOR DO ICMS     |CALCULO ICMS SUBS |VALOR ICMS SUBS   |VALOR PRODUTOS|")
Write( ++nRow, nCol1, "|" + Tran( nBaseIcms, "@E 99,999,999.99" ))
Write(    nRow, nCol2, "|" + Tran( nVlrIcms,  "@E 99,999,999.99" ))
Write(    nRow, nCol3, "|" + Tran( nBaseSubs, "@E 99,999,999.99" ))
Write(    nRow, nCol4, "|" + Tran( nVlrSubs,  "@E 99,999,999.99" ))
Write(    nRow, nCol5, "|" + Tran( nTotal,    "@E 99,999,999.99" ))
Write( ++nRow, 00, Repl( "-", Tam ))
Write( ++nRow, 00,     "|VALOR DO FRETE     |VALOR DO SEGURO   |OUTRAS DESPESAS   |VALOR TOTAL IPI   |VLR TOTAL NOTA|")
Write( ++nRow, nCol1, "|" + Tran( 0,          "@E 99,999,999.99" ))
Write(    nRow, nCol2, "|" + Tran( 0,          "@E 99,999,999.99" ))
Write(    nRow, nCol3, "|" + Tran( 0,          "@E 99,999,999.99" ))
Write(    nRow, nCol4, "|" + Tran( 0,          "@E 99,999,999.99" ))
Write(    nRow, nCol5, "|" + Tran( nTotalNota, "@E 99,999,999.99" ))
Write( ++nRow, 00, Repl( "=", Tam ))
FechaTit( nRow, nDesconto )
return

Proc FechaTit( nRow, nDesconto )

LOCAL Tam      := 93
LOCAL nAberto := 0
LOCAL nRecebi := 0
LOCAL oBloco
LOCAL cDocnr

nRow := 45
Write( nRow++, 00, "DCTO N?  TP     EMISSAO  VENCTO   PORTADOR    VLR NOMINAL DT PAGTO     VLR PAGO STATUS")
Write( nRow++, 00, Repl( "-", Tam ) )
Recemov->(Order( 1 ))
Recebido->(Order( 3 ))
if Recebido->( DbSeek( cFatura ))
    oBloco := {|| Recebido->Fatura = cFatura .AND. Recebido->Emis = dEmis }
    WHILE EVal( oBloco ) .AND. Rel_Ok()
        nVlr      := Recebido->Vlr
        nVlr      -= ( nVlr * nDesconto ) / 100
        cDocnr  := Recebido->Docnr
        cStatus := "QUITADO"
        if Recemov->(DbSeek( cDocnr ))
            cStatus := "PARCIAL"
        endif
        Recebido->(Qout( Docnr, Tipo, Emis, Vcto, Port, Tran( nVlr, "@E 9,999,999.99"), DataPag, Tran( VlrPag, "@E 9,999,999.99"), cStatus ))
        nRow    ++
        nRecebi += Recebido->VlrPag
        Recebido->(DbSkip(1))
    EndDo
endif
oBloco := {|| Recemov->Fatura = cFatura }
Recemov->(Order( 4 ))
cStatus := "ABERTO"
if Recemov->(DbSeek( cFatura ))
    WHILE EVal( oBloco ) .AND. Rel_Ok()
        nVlr    := Recemov->Vlr
        nVlr    -= ( nVlr * nDesconto ) / 100
        Recemov->(Qout( Docnr, Tipo, Emis, Vcto, Port, Tran( nVlr, "@E 9,999,999.99"), Ctod("//"), Tran( 0, "@E 9,999,999.99"), cStatus ))
        nRow      ++
        nAberto += nVlr
        Recemov->(DbSkip(1))
    EndDo
endif
Qout()
Qout("*** Totais ***", Space(30), Tran( nAberto, "@E 9,999,999.99"), Space(08), Tran( nRecebi, "@E 9,999,999.99"))
return

Proc EspelhoParcial( cNoFatura )

LOCAL Tam             := 93
LOCAL cScreen         := SaveScreen()
LOCAL aFatuTemp     := {}
LOCAL aFatura         := {}
LOCAL aRegis         := {}
LOCAL aRegiTemp     := {}
LOCAL aAp             := {}
LOCAL nTamanho      := 0
LOCAL nDesconto     := 0
LOCAL nRow             := 0
LOCAL nTotal         := 0
LOCAL nItens         := 0
LOCAL nLen             := 0
LOCAL cForma         := ""
LOCAL cCodiVen      := ""
LOCAL cTela

if cNoFatura = NIL
    BuscaFatura( @aFatuTemp, @aFatura, @aRegis, @aRegiTemp, "ESPELHO NOTA PARCIAL" )
else
    Aadd( aFatura, cNofatura )
endif
if ( nTamanho := Len( aFatura )) > 0
    oMenu:Limpa()
    ErrorBeep()
    if Conf("Pergunta: Imprimir Espelho de Nota Parcial ?" )
        nDesconto := 0
        MaBox( 10, 10, 12, 70, "INFORMACOES COMPLEMENTARES")
        SetCursor(1) ; DevPos( 11, 11 ) ; DevOut( "Desconto.........:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nDesconto, "nDesconto", "99.99",,))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        if LastKey() = 27 .OR. !InsTru80() .OR. !LptOk()
            ResTela( cScreen )
            return
        endif
        Cep->(Order( 1 ))
        Receber->(Order( 2 ))
        Lista->(Order( 2 ))
        Saidas->(Order( 3 ))
        cTela      := SaveScreen()
        nTamanho  := Len( aFatura )
        Mensagem("Aguarde, Imprimindo.", Cor())
        PrintOn()
        FPrint( _CPI12 )
        For nX := 1 To nTamanho
            cFatura := aFatura[ nX ]
            nRow      := 11
            nTotal  := 0
            bBloco  := {|| Saidas->Fatura = cFatura }
            if Saidas->(DbSeek( cFatura ))
                cForma    := Saidas->Forma
                cCodiVen := Saidas->CodiVen
                dEmis     := Saidas->Emis
                nItens    := 0
                aP         := {}
                Receber->(DbSeek( Saidas->Codi ))
                Cep->(DbSeek( Receber->Cep ))
                WHILE Saidas->(EVal( bBloco )) .AND. Rel_Ok()
                    nVlr         := Saidas->Pvendido
                    nVlr         -= ( nVlr * nDesconto ) / 100
                    Lista->(DbSeek( Saidas->Codigo ))
               Aadd( aP, { Saidas->Saida, Lista->Un, Lista->Codigo, Lista->(Left( Descricao, 34 )), Lista->Sigla, nVlr, ( Saidas->Saida * nVlr ), Lista->N_Original })
                    Saidas->(DbSkip(1))
                EndDo
                Asort( aP,,, {|x, y| y[4] > x[4]} )
                nItens := 0
                Pagina := 1
                nLen     := Len( aP )
                For nT := 1 To nLen
                    if nItens = 0
                        FrontParcial( Pagina, cFatura, dEmis, cForma, cCodiven )
                    endif
                    FPrint( _CPI12 )
















                 Qout( Tran( Ap[nT,1], "999999.99"), Ap[nT, 2 ], Ap[nT, 3 ], Space(05), Ap[nT, 4 ], Ap[nT, 5 ], Tran( Ap[nT,6],"@E 999,999.99"), Tran( Ap[nT,7],"@E 999,999.99"))

                    nItens++
                    nRow++
                    nTotal += Ap[nT, 7]
                    if nItens = 49
                        Pagina++
                        nRow     := 11
                        nItens := 0
                      __Eject()
                    endif
                Next
                Write(  nRow, 00, Repl( "-", Tam ))
                Write(++nRow, 40, "*** Valor Total do Faturamento ***" )
                Write(  nRow, 77, Tran( nTotal,"@E 9,999,999,999.99" ) )
                nRow += 2
                if nRow >= 45
                    __Eject()
                    FrontParcial( ++Pagina, cFatura, dEmis, cForma, cCodiven )
                    nRow := 11
                endif
                FechaTit( nRow, nDesconto )
                __Eject()
            endif
        Next
        PrintOff()
        ResTela( cTela )
    endif
endif
ResTela( cScreen )
return

Proc RelacaoEntrega()

LOCAL Tam             := 93
LOCAL cScreen         := SaveScreen()
LOCAL aFatuTemp     := {}
LOCAL aFatura         := {}
LOCAL aRegis         := {}
LOCAL aRegiTemp     := {}
LOCAL aAp             := {}
LOCAL nRow             := 58
LOCAL nTamanho      := 0
LOCAL nDesconto     := 0
LOCAL nTotal         := 0
LOCAL nParcial      := 0
LOCAL nItens         := 0
LOCAL nLen             := 0
LOCAL Pagina         := 0
LOCAL cTela

BuscaFatura( @aFatuTemp, @aFatura, @aRegis, @aRegiTemp, "RELACAO DE ENTREGA" )
if ( nTamanho := Len( aFatura )) > 0
    oMenu:Limpa()
    ErrorBeep()
    if Conf("Pergunta: Imprimir Relacao de Entrega ?" )
        if !InsTru80()
            ResTela( cScreen )
            return
        endif
        Forma->(Order( 1 ))
        Cep->(Order( 1 ))
        Receber->(Order( 2 ))
        Lista->(Order( 2 ))
        Saidas->(Order( 3 ))
        cTela     := SaveScreen()
        nTamanho := Len( aFatura )
        nParcial := 0
        nTotal    := 0
        Mensagem("Aguarde, Imprimindo.", Cor())
        PrintOn()
        FPrint( _CPI12 )
        For nX := 1 To nTamanho
            cFatura := aFatura[ nX ]
            if Saidas->(DbSeek( cFatura ))
                if nRow >= 52
                    Write( 00, 00, Linha1( Tam, @Pagina))
                    Write( 01, 00, Linha2())
                    Write( 02, 00, Linha3(Tam))
                    Write( 03, 00, Linha4(Tam, SISTEM_NA2 ))
                    Write( 04, 00, Padc("RELACAO DE FATURAS PARA ENTREGA",Tam ) )
                    nRow := 5
                endif
                Qout( Repl( "-", Tam ))
                Receber->(DbSeek( Saidas->Codi ))
                Forma->(DbSeek(Saidas->Forma))




                Qout( NG + Receber->Codi, Receber->Nome, NR, Receber->Ende, Receber->Fone )





                Qout( Space(04),    Receber->Bair,    Receber->Cida,    Receber->Esta,    Saidas->Forma,    Forma->Condicoes )




                Qout( Space(04),    "PEDIDO: "  + Saidas->Fatura,    "FATURA: "  + Saidas->Fatura,    "EMISSAO: " + Saidas->(Dtoc( Emis )),    "VALOR: "   + NG + Saidas->(Tran( VlrFatura, "@E 9,999,999,999.99")) + NR )
                Qout( Space(04), "RECEBI TODAS AS MERCADORIAS DA FATURA ACIMA:")
                nRow        += 5
                nParcial += Saidas->VlrFatura
                nTotal    += Saidas->VlrFatura
                if nRow >= 52 .OR. nX = nTamanho
                    Qout( Repl( "-", Tam ))
                    Qout( NG + " ** SUBTOTAL RELACAO DE ENTREGA ** " + Space(31) + Tran( nParcial, "@E 9,999,999,999.99") + NR)
                    nRow        += 3
                    nParcial := 0
                    if nX = nTamanho
                        Qout( NG + " ** TOTAL RELACAO DE ENTREGA    ** " + Space(31) + Tran( nTotal,   "@E 9,999,999,999.99") + NR )
                    endif
                    __Eject()
                endif
            endif
        Next
        PrintOff()
        ResTela( cTela )
    endif
endif
ResTela( cScreen )
return

Proc Sefaz()

LOCAL GetList := {}
LOCAL cScreen := SaveScreen()
LOCAL cFile   := "SEFAZ.TXT"
LOCAL aMestre := { "10", "50" }
LOCAL cCgc      := StrTran(StrTran(StrTran( "620.269.179-49", "."),"/"),"-")
LOCAL cInsc   := StrTran(StrTran( "3.708.860-9 SSP/PR", "."), "-")
LOCAL cNome   := Left( XNOMEFIR, 35 )
LOCAL cCida   := Left( "PIMENTA BUENO", 30 )
LOCAL cEsta   := "RO"
LOCAL cFone   := StrTran( StrTran( StrTran( StrTran( "(69)3451-3085", "(" ), ")" ),"."), "-")
LOCAL dIni      := Date()-30
LOCAL dFim      := Date()
LOCAL cIni
LOCAL cFim
LOCAL oBloco
LOCAL Handle
LOCAL nBaseIcms  := 0
LOCAL nVlrIcms   := 0
LOCAL nBaseSubs  := 0
LOCAL nVlrSubs   := 0
LOCAL nTotal      := 0
LOCAL nTotalNota := 0
LOCAL cCodi
LOCAL cData
LOCAL cFatura
LOCAL cNumero
LOCAL cModelo
LOCAL cSerie
LOCAL cSubSerie
LOCAL cFop
LOCAL cCep
LOCAL cSituacao
LOCAL nAliquota
LOCAL nIsenta
LOCAL nOutras
LOCAL nSoma
LOCAL cClasse
LOCAL nReducao
LOCAL nTaxa
LOCAL cDrive

oMenu:Limpa()
MaBox( 10, 10, 13, 40 )
SetCursor(1) ; DevPos( 11, 11 ) ; DevOut( "Data Inicial...." ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dIni, "dIni", "##/##/##", {|| if((Nota->(Order( 3 )), Nota->(!DbSeek( dIni ))), ( ErrorBeep(), Alerta("Erro: Data Inicial Nao Localizada."), .F. ), .T. )},))
SetCursor(1) ; DevPos( 12, 11 ) ; DevOut( "Data Final......" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dFim, "dFim", "##/##/##",,))
ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
if LastKey() = 27
    ResTela( cScreen )
    return
endif
Receber->(Order( 2 ))
Cep->(Order( 1 ))
dbSelectArea( "Nota" )
Nota->(Order( 3 ))
if Nota->(!DbSeek( dIni ))
    Nada()
    ResTela( cScreen )
    return
endif
oMenu:Limpa()
ErrorBeep()
if ( cDrive := MacroCopia()) = NIL
    ResTela( cScreen )
    return
endif
Mensagem("þþþ Aguarde, Gerando arquivo.")
cFile  := cDrive + cFile
Handle := FCreate( cFile )
if ( Ferror() <> 0 )
    ErrorBeep()
    Alert("Informa: Erro na abertura do arquivo " + cFile )
    ResTela( cScreen )
    return
endif
Mensagem("þþþ Aguarde, Escrevendo no Arquivo.")
__SetCentury( "On" )
LETO_SET( 4, iif( __SetCentury(), "yyyy/mm/dd", "yy/mm/dd" ) )
cInsc           += Space(14-Len( ltrim(rtrim(cInsc))))
cNome           += Space(35-Len( ltrim(rtrim(cNome))))
cCida           += Space(30-Len( ltrim(rtrim(cCida))))
cFone           += Space(10-Len( ltrim(rtrim(cFone))))
cIni              := StrTran( Dtoc( dIni ), "/")
cFim              := StrTran( Dtoc( dFim ), "/")

FWriteLine( Handle, aMestre[1] + cCgc + cInsc + cNome + cCida + cEsta + cFone + cIni + cFim )
oBloco := {|| Nota->Data >= dIni .AND. Nota->Data <= dFim }
WHILE Nota->( Eval( oBloco ))
    cCodi      := Nota->Codi
    cData      := StrTran( Dtoc( Nota->Data ), "/")
    cFatura     := Nota->Numero
    cNumero     := Right( Nota->Numero, 6 )
    cCgc         := "00000000000000"
    cInsc      := "000000000"
    cEsta      := "00"
    cModelo     := "01"
    cSerie     := "000"
    cSubSerie := "00"
    cFop         := "000"
    cCep         := ""
    cSituacao := "N"
    nAliquota := 0
    if Receber->(DbSeek( cCodi ))
      cCgc      := StrTran(StrTran(StrTran( Receber->Cgc, "."),"/"),"-")
      cInsc     := StrTran(StrTran( Receber->Insc, "."), "-")
      cEsta     := Receber->Esta
      cCep      := Receber->Cep
      cFop      := Receber->Cfop
      nAliquota := Receber->Tx_Icms
    endif
    cInsc       += Space(14-Len( ltrim(rtrim(cInsc))))
    cInsc       := Left( cInsc, 14 )
    cCgc          := Left( cCgc, 14 )
    cFop          := StrTran( cFop, ".")
    nBaseIcms  := 0
    nVlrIcms   := 0
    nBaseSubs  := 0
    nVlrSubs   := 0
    nTotal      := 0
    nTotalNota := 0
    CalculoIcms( cFatura, nAliquota, @nBaseIcms, @nVlrIcms, @nBaseSubs, @nVlrSubs, @nTotal, @nTotalNota )
    nIsenta      := nTotalNota - nBaseIcms
    nAliquota  := IntToStrRepl( nAliquota,  04 )
    nTotalNota := IntToStrRepl( nTotalNota, 13 )
    nBaseIcms  := IntToStrRepl( nBaseIcms,  13 )
    nVlrIcms   := IntToStrRepl( nVlrIcms,     13 )
    nIsenta      := IntToStrRepl( nIsenta,     13 )
    nOutras      := IntToStrRepl( 0,             13 )

    FWriteLine( Handle, aMestre[2] + cCgc + cInsc + cData + cEsta + cModelo + cSerie + cSubSerie + cNumero +     cFop + nTotalNota + nBaseIcms + nVlrIcms + nIsenta + nOutras + nAliquota + cSituacao )
    Nota->(DbSkip(1))
EndDo
FClose( Handle )
oMenu:Limpa()
M_Title( "ESC - Retorna ?etas CIMA/BAIXO Move")

LETO_SET( 4, iif( __SetCentury(), "dd/mm/yyyy", "dd/mm/yy" ) )
__SetCentury( "Off" )
ResTela( cScreen )
return

Proc CalculoIcms( cFatura, nAliquota, nBaseIcms, nVlrIcms, nBaseSubs, nVlrSubs, nTotal, nTotalNota )

LOCAL nPvendido := 0
LOCAL nDesconto := 0
LOCAL nBaseRed  := 0
LOCAL nSoma      := 0
LOCAL cClasse
LOCAL nReducao
LOCAL nTaxa
LOCAL nSomaRed
LOCAL nSomaSub
LOCAL nIcms
LOCAL nSub
LOCAL nChoice
LOCAL nIcmsRed

Saidas->(Order( 3 ))
if Saidas->(DbSeek( cFatura ))
    WHILE Saidas->Fatura = cFatura
        Lista->(DbSeek( Saidas->Codigo ))
        nPvendido  := Saidas->Pvendido
        nPvendido  -= ( nPvendido * nDesconto ) / 100
        nSoma       := ( Saidas->Saida * nPvendido )
        nTotal      += nSoma
        nTotalNota += nSoma

        cClasse    := Lista->Classe
        nReducao := Lista->Reducao
        nTaxa     := Lista->Tx_Icms
        nSomaRed := ( nSoma * nReducao ) / 100
        nSomaSub := ( nSoma + (( nSoma * nTaxa ) / 100 ))
        nIcmsRed := ( nSomaRed * nAliquota ) / 100
        nIcms     := ( nSoma * nAliquota ) / 100
        nSub        := (( nSomaSub * nAliquota ) / 100 ) - nIcms
        Do Case
        Case cClasse = "00"
            nBaseIcms += nSoma
            nBaseSubs += 0
            nVlrIcms  += nIcms
            nVlrSubs  += 0
        Case cClasse = "10"
            nBaseIcms  += nSoma
            nBaseSubs  += nSomaSub
            nVlrIcms   += nIcms
            nVlrSubs   += nSub
            nTotalNota += nSub
        Case cClasse = "20"
            nBaseIcms += nSomaRed
            nBaseSubs += 0
            nVlrIcms  += nIcmsRed
            nVlrSubs  += 0
        Case cClasse = "30"
            nBaseIcms += 0
            nBaseSubs += nSomaSub
            nVlrIcms  += 0
            nVlrSubs  += nSub
            nTotalNota += nSub
        Case cClasse = "40"
            nBaseIcms += 0
            nBaseSubs += 0
            nVlrIcms  += 0
            nVlrSubs  += 0
        Case cClasse = "41"
            nBaseIcms += 0
            nBaseSubs += 0
            nVlrIcms  += 0
            nVlrSubs  += 0
        Case cClasse = "50"
        Case cClasse = "51"
        Case cClasse = "60"
        Case cClasse = "70"
        Case cClasse = "90"
        EndCase
        Saidas->(DbSkip(1))
    EndDo
endif
return

Function MacroCopia()

LOCAL GetList    := {}
LOCAL aArray    := { "A:", "B:", "C:", "D:", "E:", "F:" }
LOCAL cScreen    := SaveScreen()
LOCAL cComando := Space(256)
LOCAL cOldDir    := Curdir()
LOCAL cPath
LOCAL xDiretorio
LOCAL xString
LOCAL xDrive
LOCAL nChoice
LOCAL i

WHILE .T.
    M_Title("DRIVE PARA COPIA DO ARQUIVO")
    nChoice := FazMenu( 10, 10, aArray, Cor())
    if nChoice = 0
        ResTela( cScreen )
        return( NIL )
    endif
    xDrive := aArray[nChoice]
    if nChoice = 1 .OR. nChoice = 2
        if !IsDisk( xDrive )
            ErrorBeep()
            Alerta("Erro: Drive invalido!")
            Loop
        endif
    endif
    ResTela( cScreen )
    return( xDrive )
EndDo

Function VerVcto( Vcto, dMemis, cMcond )

LOCAL nVerifica2, nVerifica3, nVerifica4
LOCAL nVerifica5, nVerifica6, nVerifica7
LOCAL nVerifica8, nConta
Aadd( Vcto, dMemis + Val( Left( cMcond, 2 ) ) )
if Val( Right( cMcond, 14 ) ) = 0
    if Vcto[1] ==    dMemis
        Write( 04, 66, "A VISTA" )
        nConta := 1
    else
        Write( 04, 66, Dtoc( Vcto[ 1 ] ) )
        nConta := 1
    endif
    nVerifica2 := 0
else
    Write( 04, 66, "ABAIXO" )
    nVerifica2 := Val( SubStr( cMcond, 3, 2 ) )
    if nVerifica2 > 0
        nConta := 2
        Aadd(Vcto, dMemis + Val( SubStr( cMcond, 3, 2 ) ) )
    endif
    nVerifica3 := Val( SubStr( cMcond, 5, 2 ) )
    if nVerifica3 > 0
        nConta := 3
        Aadd(Vcto, dMemis + Val( SubStr( cMcond, 5, 2 ) ) )
    endif
    nVerifica4 := Val( SubStr( cMcond, 7, 2 ) )
    if nVerifica4 > 0
        nConta := 4
        Aadd(Vcto, dMemis + Val( SubStr( cMcond, 7, 2 ) ) )
    endif
    nVerifica5 := Val( SubStr( cMcond, 9, 2 ) )
    if nVerifica5 > 0
        nConta := 5
        Aadd(vcto, dMemis + Val( SubStr( cMcond, 9, 2 ) ) )
    endif
    nVerifica6 := Val( SubStr( cMcond, 11, 2 ) )
    if nVerifica6 > 0
        nConta := 6
        Aadd(vcto, dMemis + Val( SubStr( cMcond, 11, 2 ) ) )
    endif
    nVerifica7 := Val( SubStr( cMcond, 13, 2 ) )
    if nVerifica7 > 0
        nConta := 7
        Aadd(Vcto, dMemis + Val( SubStr( cMcond, 13, 2 ) ) )
    endif
    nVerifica8 := Val( SubStr( cMcond, 15, 2 ) )
    if nVerifica8 > 0
        nConta := 8
        Aadd(Vcto, dMemis + Val( SubStr( cMcond, 15, 2 ) ) )
    endif
endif
return nConta

Function ReducaoBase( cEsta )

LOCAL nReducao := 0

if cEsta = "AC"
    nReducao := Lista->Ac
elseif cEsta = "AM"
    nReducao := Lista->Am
elseif cEsta = "MT"
    nReducao := Lista->Mt
elseif cEsta = "RO"
    nReducao := Lista->Ro
elseif cEsta = "RR"
    nReducao := Lista->Rr
else
    nReducao := 0
endif
return( nReducao )

Proc CargaDescarga( cNoFatura )

LOCAL GetList         := {}
LOCAL cScreen         := SaveScreen()
LOCAL Tam             := 132
LOCAL aFatuTemp     := {}
LOCAL aFatura         := {}
LOCAL aRegis         := {}
LOCAL aRegiTemp     := {}
LOCAL aCarga         := {}
LOCAL aDesCarga     := {}
LOCAL nTamanho      := 0
LOCAL nDesconto     := 0
LOCAL nRow             := 0
LOCAL nItens         := 0
LOCAL nLen             := 0
LOCAL cForma         := ""
LOCAL cCodi          := ""
LOCAL cCodiDes      := ""
LOCAL cFatura         := Space(07)
LOCAL cDescarga     := Space(07)
LOCAL cTela

oMenu:Limpa()
MaBox(10, 10, 13, 40)
SetCursor(1) ; DevPos( 11, 11 ) ; DevOut( "Fatura Carga.....:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cFatura, "cFatura", "@!", {|| VisualAchaFatura( @cFatura )},))
SetCursor(1) ; DevPos( 12, 11 ) ; DevOut( "Fatura DesCarga..:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cDescarga, "cDescarga", "@!", {|| VisualAchaFatura( @cDescarga )},))
ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
if LastKey() = 27
    ResTela( cScreen )
    return
endif
oMenu:Limpa()
ErrorBeep()
if Conf("Pergunta: Imprimir Relacao Carga/Descarga ?" )
    Cep->(Order( 1 ))
    Receber->(Order( 2 ))
    Lista->(Order( 2 ))
    Saidas->(Order( 3 ))
    cTela      := SaveScreen()
    Mensagem("Aguarde, Localizando Movimento.", Cor())
    nRow      := 11
    bBloco  := {|| Saidas->Fatura = cFatura }
    cBloco  := {|| Saidas->Fatura = cDescarga }
    if Saidas->(DbSeek( cFatura ))
        cForma    := Saidas->Forma
        cCodi     := Saidas->Codi
        dEmis     := Saidas->Emis
        nVlr        := 0
        nItens    := 0
        aCarga    := {}
        Receber->(DbSeek( Saidas->Codi ))
        Cep->(DbSeek( Receber->Cep ))
        WHILE Saidas->(EVal( bBloco )) .AND. Rel_Ok()
            nVlr := Saidas->Pvendido
            Lista->(DbSeek( Saidas->Codigo ))
            Aadd( aCarga, { Saidas->Saida, Lista->Un, Lista->Codigo, Lista->(Left( Descricao, 34 )), Lista->Sigla, nVlr, ( Saidas->Saida * nVlr )})
            Saidas->(DbSkip(1))
        EndDo
    endif
    if Saidas->(DbSeek( cDescarga ))
        cFormaDes     := Saidas->Forma
        cCodiDes      := Saidas->Codi
        dEmisDes      := Saidas->Emis
        nItens         := 0
        nVlr             := 0
        aDesCarga     := {}
        Receber->(DbSeek( Saidas->Codi ))
        Cep->(DbSeek( Receber->Cep ))
        WHILE Saidas->(EVal( cBloco )) .AND. Rel_Ok()
            nVlr := Saidas->Pvendido
            Lista->(DbSeek( Saidas->Codigo ))
            Aadd( aDesCarga, { Saidas->Saida, Lista->Un, Lista->Codigo, Lista->(Left( Descricao, 34 )), Lista->Sigla, nVlr, ( Saidas->Saida * nVlr )})
            Saidas->(DbSkip(1))
        EndDo
    endif
    Asort( aCarga,,, {|x, y| y[4] > x[4]} )
    nItens  := 0
    Pagina  := 1
    nLen      := Len( aCarga )
    nLenDes := Len( aDescarga )
    if !Instru80()
        ResTela( cScreen )
        return
    endif
    Mensagem("Aguarde, Imprimindo.", Cor())
    PrintOn()
    FPrint( PQ )
    nQuantCarga := 0
    nQuantDesca := 0
    nQuantSaldo := 0
    nTotalCarga := 0
    nTotalDesca := 0
    nSaldoSaldo := 0
    For nT := 1 To nLen
        if nItens = 0
            FrontCargaDes(cFatura, cDescarga, dEmis, dEmisDes, cForma, cFormaDes, cCodi, cCodiDes )
        endif
        nQuant     := 0
        nUnitario := 0
        nTot         := 0
        nPos         :=0
        if nLenDes <> 0
            cCodigo     := aCarga[nT,3]
            nPos         := Ascan( aDesCarga, {|aVal|Aval[3] == cCodigo })
            if nPos <> 0
                nQuant     := aDesCarga[nPos, 1 ]
                nUnitario := aDesCarga[nPos, 6 ]
                nTot         := aDesCarga[nPos, 7 ]
            endif
        endif











        Qout( aCarga[nT, 3],    aCarga[nT, 2],    aCarga[nT, 4],    Tran( aCarga[nT, 1],         "999999.99"),    Tran( nQuant,                    "999999.99"),    Space(2),    Tran( aCarga[nT,1]-nQuant, "999999.99"),    Tran( aCarga[nT, 6],         "@E 999,999.99"),    Tran( nUnitario,                "@E 999,999.99"),    Tran( aCarga[nT, 7],         "@E 999,999.99"),    Tran( nTot,                     "@E 999,999.99"),    Tran( aCarga[nT,7]-nTot,    "@E 999,999.99"))

        nQuantCarga += aCarga[nT,1]
        nQuantDesca += nQuant
        nQuantSaldo += aCarga[nT,1] - nQuant
        nTotalCarga += aCarga[nT,7]
        nTotalDesca += nTot
        nSaldoSaldo += aCarga[nT,7] - nTot
        nItens++
        nRow++
        if nItens = 49
            Pagina++
            nRow     := 11
            nItens := 0
          __Eject()
        endif
    Next
    Qout(Repl( "-", Tam ))









    Qout( "** TOTAIS **",    Space(31),    Tran( nQuantCarga,         "999999.99"),    Tran( nQuantDesca,         "999999.99"),    Space(2),    Tran( nQuantSaldo,         "999999.99"),    Space(21),    Tran( nTotalCarga,         "@E 999,999.99"),    Tran( nTotalDesca,         "@E 999,999.99"),    Tran( nSaldoSaldo,         "@E 999,999.99"))
    Qout(Repl( "-", Tam ))
    __Eject()
    PrintOff()
    ResTela( cTela )
endif
ResTela( cScreen )
return

Proc FrontCargaDes(cFatura, cDescarga, dEmis, dEmisDes, cForma, cFormaDes, cCodi, cCodiDes )

LOCAL Tam := 132
SetPrc( 0, 0)
Write( 00, 00 , Padc("RELATORIO DE CARGA E DESCARGA", Tam))
Write( 01, 00 , Repl( "-", Tam ) )
Write( 02, 00 , "Emissao....: " + Dtoc( dEmis ))
Write( 02, 66 , "Emissao....: " + Dtoc( dEmisDes ))
Write( 03, 00 , "Fatura N?.: " + cFatura )
Write( 03, 66 , "Fatura N?.: " + cDescarga )
Forma->(Order( 1))
Forma->(DbSeek( cForma ))
Write( 04, 00 , "F. Pagto...: " + Forma->Forma + "  " + Forma->Condicoes )
Forma->(DbSeek( cFormaDes ))
Write( 04, 66 , "F. Pagto...: " + Forma->Forma + "  " + Forma->Condicoes )
Receber->(DbSeek( cCodi ))
Write( 05, 00 , "Cliente....: " + Receber->Codi  + " " + Receber->Nome )
Receber->(DbSeek( cCodiDes ))
Write( 05, 66 , "Cliente....: " + Receber->Codi  + " " + Receber->Nome )
Receber->(DbSeek( cCodi ))
Write( 06, 00 , "Fantasia...: " + Receber->Fanta )
Receber->(DbSeek( cCodiDes ))
Write( 06, 66 , "Fantasia...: " + Receber->Fanta )
Write( 07, 00 , Repl( "-", Tam ) )
Write( 08, 00 , "                                                 CARGA  DESCARGA                   CARGA   DESCARGA      CARGA   DESCARGA      SALDO")
Write( 09, 00 ,"CODIGO UN DESCRICAO DO PRODUTO                   QUANT     QUANT        SALDO   UNITARIO   UNITARIO      TOTAL      TOTAL      TOTAL")
Write( 10, 00 , Repl( "-", Tam ))
return

Proc IniBarra()

PrintOn()
FPrint( RESETA     )
FPrint( _SALTOOFF )
FPrint( PQ            )
return

Proc EtiBar1()

FPrint( "f138")
FPrint( "O0220")
FPrint( "L")
FPrint( "D11")
FPrint( "H15")
Qout("420100000000022" + Descricao )
Qout("102400000100030" + "TURBONET" )
Qout("422200002000060" + Tam )
Qout("4F1305000350090" + CodeBar )
Qout("401100000100095" + "CODIGO : " + Codigo )
Qout("401100000100100" + "FORN...: " + Codi )
Qout("401100000100105" + "GRUPO..: " + CodGrupo )
Qout("401100000100110" + "REFE...: " + N_Original )
Qout("421100001700110" + "R$ " + ltrim(rtrim(Tran( Varejo, "@E 9,999,999,999.99"))))
Qout("401100000100120" + ltrim(rtrim(XNOMEFIR)) + " - " + ltrim(rtrim("PIMENTA BUENO")))
return

Proc EtiBar2()

Qout("420100000000156" + Descricao )
Qout("102400000100164" + "TURBONET" )
Qout("422200002000194" + Tam )
Qout("4F1305000350224" + CodeBar )
Qout("401100000100229" + "CODIGO : " + Codigo )
Qout("401100000100234" + "FORN...: " + Codi )
Qout("401100000100239" + "GRUPO..: " + CodGrupo )
Qout("401100000100244" + "REFE...: " + N_Original)
Qout("421100001700244" + "R$ " + ltrim(rtrim(Tran( Varejo, "@E 9,999,999,999.99"))))
Qout("401100000100254" + ltrim(rtrim(XNOMEFIR)) + " - " + ltrim(rtrim("PIMENTA BUENO")))
return

Proc EtiBar3()

Qout("420100000000290" + Descricao )
Qout("102400000100294" + "TURBONET" )
Qout("422200002000324" + Tam )
Qout("4F1305000350354" + CodeBar )
Qout("401100000100359" + "CODIGO : " + Codigo )
Qout("401100000100364" + "FORN...: " + Codi )
Qout("401100000100369" + "GRUPO..: " + CodGrupo )
Qout("401100000100374" + "REFE...: " + N_Original )
Qout("421100001700374" + "R$ " + ltrim(rtrim(Tran( Varejo, "@E 9,999,999,999.99"))))
Qout("401100000100384" + ltrim(rtrim(XNOMEFIR)) + " - " + ltrim(rtrim("PIMENTA BUENO")))
return

Proc EtiArgox( nArgox )

LOCAL lJahImpresso := .F.
LOCAL cScreen         := SaveScreen()
LOCAL nChoice         := 0
LOCAL nQtde          := 0
LOCAL aConfig         := {}
LOCAL aGets          := {}
LOCAL xAlias         := FTempName("T*.TMP")
LOCAL xNtx             := FTempName("T*.TMP")
LOCAL aStru
LOCAL cGrupo         := Space(03)
LOCAL cLetra1         := Space(40)
LOCAL cLetra2         := Space(40)
LOCAL aMenuArray     := { "Codigo", "Descricao", "Tamanho", "Cod Fabricante", "Qtde Minima", "Estoque", "Preco Venda" }





LOCAL aMenu          := {" Imprimir Teste                    ", " Imprimir Conforme Estoque         ", " Imprimir Qtde Selecionada         ", " Imprimir Conforme Nota de Entrada ", " Imprimir Por Grupo                ", " Imprimir Por Grupo/Palavra        "}
LOCAL cTela
WHILE .T.
    M_Title("ESCOLHA SUA OPCAO")
    nChoice := FazMenu( 04, 12, aMenu, Cor())
    if nChoice = 0
        ResTela( cScreen )
        Exit
    elseif nChoice = 1
        if !Instru80()
            ResTela( cScreen )
            Loop
        endif
        Mensagem("Aguarde. Imprimindo.", Cor())
        PrintOn()
        Qout( Chr(2) + "f138")
        Qout( Chr(2) + "T")
        Qout( Chr(2) + "E"   )
        PrintOff()
        ResTela( cScreen )

    elseif nChoice = 2 .OR. nChoice = 3
        WHILE .T.
            Grupo->(Order( 1 ))
            SubGrupo->(Order( 1 ))
            Pagar->(Order( 2 ))
            dbSelectArea( "Lista" )


            if ( ! .F. ) ; dbClearRelation() ; end ; dbSetRelation( "Grupo", {|| CodGrupo}, "CodGrupo", .F. ) ; dbSetRelation( "SubGrupo", {||    CodsGrupo}, "CodsGrupo", .F. ) ; dbSetRelation( "Pagar", {||    Codi}, "Codi", .F. )
            Lista->(Order( 2 ))
            Lista->(DbGoTop())
            cInic       := 0
            cFina       := 0
            nCarreiras := 3
            if nChoice = 2
                MaBox( 14, 12, 17, 44 )
                SetCursor(1) ; DevPos( 15, 13 ) ; DevOut( "Codigo Inicial...¯" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cInic, "cInic", "999999", {|| CodiErrado( @cInic )},))
                SetCursor(1) ; DevPos( 16, 13 ) ; DevOut( "Codigo Final.....¯" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cFina, "cFina", "999999", {|| CodiErrado( @cFina,,.T. )},))
                ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
            else
                MaBox( 14, 12, 18, 44 )
                SetCursor(1) ; DevPos( 15, 13 ) ; DevOut( "Codigo Inicial...¯" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cInic, "cInic", "999999", {|| CodiErrado( @cInic )},))
                SetCursor(1) ; DevPos( 16, 13 ) ; DevOut( "Codigo Final.....¯" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cFina, "cFina", "999999", {|| CodiErrado( @cFina,,.T.)},))
                SetCursor(1) ; DevPos( 17, 13 ) ; DevOut( "Qtde Individual..¯" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nQtde, "nQtde", "999", {|| nQtde > 0}, {|| nChoice = 3}))
                ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
            endif
            if LastKey() = 27
                ResTela( cScreen )
                Exit
            endif
            if !Instru80()
                ResTela( cScreen )
                Loop
            endif
            Mensagem("Aguarde. Imprimindo.", Cor())
            PrintOn()
            oBloco := {|| Lista->Codigo >= cInic .AND. Lista->Codigo <= cFina }
            DbSeek( cInic )
            nConta := 0
            WHILE Eval( oBloco ) .AND. Rep_Ok()
                if nChoice = 3
                    nEtiquetas := nQtde
                else
                    nEtiquetas := Lista->Quant
                endif
                For nY := 1 To nEtiquetas
                    nConta++
                    if nConta = 1
                        Print1Argox( nArgox )
                    elseif nConta = 2
                        Print2Argox( nArgox )
                    elseif nConta = 3
                        Print3Argox( nArgox )
                    endif
                    if nConta = 3
                        Qout("Q0001")
                        Qout( Chr(2) + "E")
                        nConta := 0
                    endif
                next
                DbSkip(1)
            EndDo
            Qout("Q0001")
            Qout(Chr(2) + "E")
            PrintOFF()
            Lista->(DbClearRel())
            ResTela( cScreen )
        EndDo
    elseif nChoice = 4
        cTela := SaveScreen()
        WHILE .T.
            Grupo->(Order( 1 ))
            SubGrupo->(Order( 1 ))
            Pagar->(Order( 2 ))
            dbSelectArea( "Lista" )
            if ( ! .F. ) ; dbClearRelation() ; end ; dbSetRelation( "Grupo", {|| CodGrupo}, "CodGrupo", .F. ) ; dbSetRelation( "SubGrupo", {|| CodsGrupo}, "CodsGrupo", .F. ) ; dbSetRelation( "Pagar", {|| Codi}, "Codi", .F. )
            Lista->(Order( 2 ))
            nCarreiras := 5
            Entradas->(Order( 2 ))
            cDocnr := Space(09)
            MaBox( 14, 12, 16, 44 )
            SetCursor(1) ; DevPos( 15, 13 ) ; DevOut( "N?Nota Entrada..:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cDocnr, "cDocnr", "@!", {|| AchaDocEntrada( @cDocnr )},))
            ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
            if LastKey() = 27
                ResTela( cScreen )
                Exit
            endif
            if !Instru80()
                ResTela( cScreen )
                Loop
            endif
            Mensagem("Aguarde. Imprimindo.", Cor())
            PrintOn()
            oBloco := {|| Entradas->Fatura = cDocnr }
            if Entradas->(DbSeek( cDocnr ))
                nConta := 0
                WHILE Entradas->(Eval( oBloco )) .AND. Rep_Ok()
                    cCodigo      := Entradas->Codigo
                    nEtiquetas := Entradas->Entrada
                    if Lista->(DbSeek( cCodigo ))
                        For nY := 1 To nEtiquetas
                            nConta++
                            if nConta = 1
                                Print1Argox( nArgox )
                            elseif nConta = 2
                                Print2Argox( nArgox )
                            elseif nConta = 3
                                Print3Argox( nArgox )
                            endif
                            if nConta = 3
                                Qout("Q0001")
                                Qout(Chr(2) + "E")
                                nConta := 0
                            endif
                        next
                    endif
                    Entradas->(DbSkip(1))
                EndDo
                Qout("Q0001")
                Qout(Chr(2) + "E")
                PrintOFF()
                Lista->(DbClearRel())
                ResTela( cTela  )
            endif
        EndDo
    elseif nChoice = 5
        cTela := SaveScreen()
        WHILE .T.
            Grupo->(Order( 1 ))
            SubGrupo->(Order( 1 ))
            Pagar->(Order( 2 ))
            dbSelectArea( "Lista" )
            if ( ! .F. ) ; dbClearRelation() ; end ; dbSetRelation( "Grupo", {|| CodGrupo}, "CodGrupo", .F. ) ; dbSetRelation( "SubGrupo", {|| CodsGrupo}, "CodsGrupo", .F. ) ; dbSetRelation( "Pagar", {|| Codi}, "Codi", .F. )
            Lista->(Order( 1 ))
            nCarreiras := 5
            cGrupoIni := Space(3)
            cGrupoFim := Space(3)
            MaBox( 14, 12, 17, 44 )
            SetCursor(1) ; DevPos( 15, 13 ) ; DevOut( "Grupo Inicial.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cGrupoIni, "cGrupoIni", "999", {|| CodiGrupo( @cGrupoIni )},))
            SetCursor(1) ; DevPos( 16, 13 ) ; DevOut( "Grupo Final...:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cGrupoFim, "cGrupoFim", "999", {|| CodiGrupo( @cGrupoFim )},))
            ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
            if LastKey() = 27
                ResTela( cScreen )
                Exit
            endif
            if !Instru80()
                ResTela( cScreen )
                Loop
            endif
            Mensagem("Aguarde. Imprimindo.", Cor())
            PrintOn()
            oBloco := {|| Lista->CodGrupo >= cGrupoIni .AND. Lista->CodGrupo <= cGrupoFim }
            LETO_SET( 9, "On" )
            if Lista->(!DbSeek( cGrupoIni ))
                LETO_SET( 9, "Off" )
                Loop
            endif
            LETO_SET( 9, "Off" )
            nConta := 0
            WHILE Lista->(Eval( oBloco )) .AND. Rep_Ok()
                cCodigo      := Lista->Codigo
                nEtiquetas := Lista->Quant
                For nY := 1 To nEtiquetas
                    nConta++
                    if nConta = 1
                        Print1Argox( nArgox )
                    elseif nConta = 2
                        Print2Argox( nArgox )
                    elseif nConta = 3
                        Print3Argox( nArgox )
                    endif
                    if nConta = 3
                        Qout("Q0001")
                        Qout(Chr(2) + "E")
                        nConta := 0
                    endif
                next
                Lista->(DbSkip(1))
            EndDo
            Qout("Q0001")
            Qout(Chr(2) + "E")
            PrintOFF()
            Lista->(DbClearRel())
            ResTela( cTela  )
        EndDo

    elseif nChoice = 6
        cTela := SaveScreen()
        WHILE .T.
            MaBox( 14, 12, 18, 72 )
            cGrupo  := Space(03)
            cLetra1 := Space(40)
            cLetra2 := Space(40)
            SetCursor(1) ; DevPos( 15, 13 ) ; DevOut( "Grupo............:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cGrupo, "cGrupo", "999", {|| CodiGrupo( @cGrupo )},))
            SetCursor(1) ; DevPos( 16, 13 ) ; DevOut( "Palavra Inicial..:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cLetra1, "cLetra1", "@!", {|| !Empty( cLetra1 )},))
            SetCursor(1) ; DevPos( 17, 13 ) ; DevOut( "Palavra Final....:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cLetra2, "cLetra2", "@!", {|| !Empty( cLetra2 )},))
            ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
            if LastKey() = 27
                ResTela( cScreen )
                Exit
            endif
            cLetra1 := ltrim(rtrim(cLetra1))
            cLetra2 := ltrim(rtrim(cLetra2))
            cTela   := Mensagem(" Aguarde, Filtrando Registros. ", 47 )
            aStru   := Lista->(DbStruct())
            DbCreate( xAlias, aStru )
            dbUseArea( .T.,, ( xAlias ), "xTemp", iif( .F. .OR. .T., ! .T., NIL ), .F. )
            Grupo->(Order( 1 ))
            SubGrupo->(Order( 1 ))
            Pagar->(Order( 2 ))
            dbSelectArea( "Lista" )
            if ( ! .F. ) ; dbClearRelation() ; end ; dbSetRelation( "Grupo", {|| CodGrupo}, "CodGrupo", .F. ) ; dbSetRelation( "SubGrupo", {|| CodsGrupo}, "CodsGrupo", .F. ) ; dbSetRelation( "Pagar", {|| Codi}, "Codi", .F. )
            Lista->(Order( 1 ))
            if Lista->(DbSeek( cGrupo ))
                While ( Lista->CodGrupo = cGrupo .AND. Rel_Ok() )
                    if Lista->(Left( Descricao, Len( cLetra1 ))) >= cLetra1 .AND. Lista->(Left( Descricao, Len( cLetra2 ))) <= cLetra2
                        xTemp->(DbAppend())
                        xTemp->Codigo        := Lista->Codigo
                        xTemp->N_Original := Lista->N_Original
                        xTemp->Descricao    := Lista->Descricao
                        xTemp->Un            := Lista->Un
                        xTemp->Qmin         := Lista->Qmin
                        xTemp->Quant        := Lista->Quant
                        xTemp->Tam            := Lista->Tam
                        xTemp->Varejo        := Lista->Varejo
                        xTemp->Codi         := Lista->Codi
                        xTemp->CodGrupo    := Lista->CodGrupo
                        xTemp->CodeBar     := Lista->CodeBar
                        xTemp->Varejo        := Lista->Varejo
                    endif
                    Lista->(DbSkip(1))
                EndDo
            endif
            xTemp->(DbGoTop())
            if xTemp->(Eof())
                xTemp->(DbCloseArea())
                Ferase( xAlias )
                Ferase( xNtx )
                Alerta("Erro: Nenhum Produto Atende a Condicao.")
                ResTela( cTela )
                Loop
            endif
            WHILE .T.
                oMenu:Limpa()
                M_Title("ESCOLHA A ORDEM A IMPRIMIR. ESC RETORNA")
                nOpcao := FazMenu( 05, 10, aMenuArray )
                if nOpcao = 0
                    xTemp->(DbCloseArea())
                    Ferase( xAlias )
                    Ferase( xNtx )
                    ResTela( cTela )
                    Exit
                elseif nOpcao = 1
                     Mensagem(" Aguarde, Ordenando Por Codigo. ", 47 )
                     dbSelectArea( "xTemp" )
                     ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Codigo", {|| xTemp->Codigo}, )
                 elseif nOpcao = 2
                     Mensagem("Aguarde, Ordenando Por Descricao. ", 47 )
                     dbSelectArea( "xTemp" )
                     ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Descricao", {|| xTemp->Descricao}, )
                 elseif nOpcao = 3
                     Mensagem(" Aguarde, Ordenando Por Tamanho. ", 47 )
                     dbSelectArea( "xTemp" )
                     ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Tam", {|| xTemp->Tam}, )
                 elseif nOpcao = 4
                     Mensagem(" Aguarde, Ordenando Por Codigo Fabricante. ", 47 )
                     dbSelectArea( "xTemp" )
                     ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->N_Original", {|| xTemp->N_Original}, )
                 elseif nOpcao = 5
                     Mensagem(" Aguarde, Ordenando Por Qtde Minima. ", 47 )
                     dbSelectArea( "xTemp" )
                     ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Qmin", {|| xTemp->Qmin}, )
                 elseif nOpcao = 6
                     Mensagem(" Aguarde, Ordenando Por Estoque. ", 47 )
                     dbSelectArea( "xTemp" )
                     ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Quant", {|| xTemp->Quant}, )
                 elseif nOpcao = 7
                     Mensagem(" Aguarde, Ordenando Por Preco Venda. ", 47 )
                     dbSelectArea( "xTemp" )
                     ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Varejo", {|| xTemp->Varejo}, )
                endif
                oMenu:Limpa()
                if !Instru80()
                    ResTela( cTela )
                    Loop
                endif
                Mensagem("Aguarde. Imprimindo.", Cor())
                PrintOn()
                xTemp->(DbGoTop())
                nConta := 0
                WHILE xTemp->(!Eof()) .AND. Rep_Ok()
                    cCodigo      := xTemp->Codigo
                    nEtiquetas := xTemp->Quant
                    For nY := 1 To nEtiquetas
                        nConta++
                        if nConta = 1
                            Print1Argox( nArgox )
                        elseif nConta = 2
                            Print2Argox( nArgox )
                        elseif nConta = 3
                            Print3Argox( nArgox )
                        endif
                        if nConta = 3
                            Qout("Q0001")
                            Qout(Chr(2) + "E")
                            nConta := 0
                        endif
                    next
                    xTemp->(DbSkip(1))
                EndDo
                Qout("Q0001")
                Qout(Chr(2) + "E")
                PrintOFF()
                Lista->(DbClearRel())
            EndDo
            ResTela( cTela  )
        EndDo
    endif
EndDo


Proc Print1Argox( nArgox )

if nArgox = 3
    EtiArgox1()
elseif nArgox = 4
    EtiBArgox1()
elseif nArgox = 5
    EtiDArgox1()
elseif nArgox = 6
    EtiEArgox1()
endif

Proc Print2Argox( nArgox )

if nArgox = 3
    EtiArgox2()
elseif nArgox = 4
    EtiBArgox2()
elseif nArgox = 5
    EtiDArgox2()
elseif nArgox = 6
    EtiEArgox2()
endif

Proc Print3Argox( nArgox )

if nArgox = 3
    EtiArgox3()
elseif nArgox = 4
    EtiBArgox3()
elseif nArgox = 5
    EtiDArgox3()
elseif nArgox = 6
    EtiEArgox3()
endif

Proc EtiArgox1()

FPrint( "L")
FPrint( "m")
FPrint( "e")
FPrint( "PC")
FPrint( "D11")
FPrint( "H10")
FPrint( "z")
Qout("102400000100030" + "TURBONET" )
Qout("402400003500120" + Tam )
Qout("412100000700055" + Descricao)
Qout("4F1212000500220" + Left(CodeBar,12))
Qout("401100000700230" + "CODIGO : " + Codigo )
Qout("401100000700245" + "FORN...: " + Codi )
Qout("401100000700260" + "GRUPO..: " + CodGrupo )
Qout("401100000700275" + "REFE...: " + N_Original )
Qout("421100003000275" + "R$ " + ltrim(rtrim(Tran( Varejo, "@E 9,999,999,999.99"))))
Qout("401100000700290" + ltrim(rtrim(XNOMEFIR)))
return

Proc EtiArgox2()

Qout("102400000100335" + "TURBONET" )
Qout("412100000700360" + Descricao)
Qout("402400003500455" + Tam )
Qout("4F1212000500525" + Left(CodeBar,12))
Qout("401100000700535" + "CODIGO : " + Codigo )
Qout("401100000700550" + "FORN...: " + Codi )
Qout("401100000700565" + "GRUPO..: " + CodGrupo )
Qout("401100000700580" + "REFE...: " + N_Original )
Qout("421100003000580" + "R$ " + ltrim(rtrim(Tran( Varejo, "@E 9,999,999,999.99"))))
Qout("401100000700595" + ltrim(rtrim(XNOMEFIR)))
return

Proc EtiArgox3()

Qout("102400000100640" + "TURBONET" )
Qout("412100000700665" + Descricao)
Qout("402400003500760" + Tam )
Qout("4F1212000500830" + Left(CodeBar,12))
Qout("401100000700840" + "CODIGO : " + Codigo )
Qout("401100000700855" + "FORN...: " + Codi )
Qout("401100000700870" + "GRUPO..: " + CodGrupo )
Qout("401100000700885" + "REFE...: " + N_Original )
Qout("421100003000885" + "R$ " + ltrim(rtrim(Tran( Varejo, "@E 9,999,999,999.99"))))
Qout("401100000700900" + ltrim(rtrim(XNOMEFIR)))
return

Proc EtiBArgox1()

LOCAL cFantaCodeBar := oIni:ReadString("sistema","fantacodebar", "TURBONET" )
FPrint( "L")
FPrint( "m")
FPrint( "e")
FPrint( "PC")
FPrint( "D11")
FPrint( "H10")
FPrint( "z")

Qout("122400002700050" + cFantaCodeBar )
Qout("1F2207001400050" + Left(CodeBar,12))
Qout("101100001200050" + Descricao )
Qout("121100000300050" + Tam )
return

Proc EtiBArgox2()

LOCAL cFantaCodeBar := oIni:ReadString("sistema","fantacodebar", "TURBONET" )
Qout("122400002700410" + cFantaCodeBar )
Qout("1F2207001400410" + Left(CodeBar,12))
Qout("101100001200410" + Descricao )
Qout("121100000300410" + Tam )
return

Proc EtiBArgox3()

LOCAL cFantaCodeBar := oIni:ReadString("sistema","fantacodebar", "TURBONET" )
Qout("122400002700750" + cFantaCodeBar )
Qout("1F2207001400750" + Left(CodeBar,12))
Qout("101100001200750" + Descricao )
Qout("121100000300750" + Tam )
return

Proc EtiDArgox1()

FPrint( "L")
FPrint( "m")
FPrint( "e")
FPrint( "PC")
FPrint( "D11")
FPrint( "H10")
FPrint( "z")

Qout("121100001700050MOSQUITEIRO")
Qout("121100001400050" + Descricao )
Qout("121100001100050100% POLIAMIDA")
Qout("1F2207000100050" + Left(CodeBar,12))
return

Proc EtiDArgox2()

Qout("121100001700410MOSQUITEIRO")
Qout("121100001400410" + Descricao )
Qout("121100001100410100% POLIAMIDA")
Qout("1F2207000100410" + Left(CodeBar,12))
return

Proc EtiDArgox3()

Qout("121100001700750MOSQUITEIRO")
Qout("121100001400750" + Descricao )
Qout("121100001100750100% POLIAMIDA")
Qout("1F2207000100750" + Left(CodeBar,12))
return

Proc EtiEArgox1()

FPrint( "L")
FPrint( "m")
FPrint( "e")
FPrint( "PC")
FPrint( "D11")
FPrint( "H10")
FPrint( "z")

Qout("121100001700050REF:" + ltrim(rtrim(N_ORIGINAL)) + " TAM:" + ltrim(rtrim(TAM)))
Qout("101000001400050" + Descricao )
Qout("1F2207000200050" + Left(CodeBar,12))
return

Proc EtiEArgox2()

Qout("121100001700410REF:" + ltrim(rtrim(N_ORIGINAL)) + " TAM:" + ltrim(rtrim(TAM)))
Qout("101000001400410" + Descricao )
Qout("1F2207000200410" + Left(CodeBar,12))
return

Proc EtiEArgox3()

Qout("121100001700750REF:" + ltrim(rtrim(N_ORIGINAL)) + " TAM:" + ltrim(rtrim(TAM)))
Qout("101000001400750" + Descricao )
Qout("1F2207000200750" + Left(CodeBar,12))
return

Function Ped_Cli9_1( cNrfatu )

LOCAL cScreen      := SaveScreen()
LOCAL nTotFatu   := 0
LOCAL nTotRece   := 0
LOCAL nTotBido   := 0
LOCAL nPagarPerc := 0
LOCAL nPagoPerc  := 0
LOCAL nVlrFatura := 0
LOCAL nPos       := MaxRow() - 9
LOCAL cFile1
LOCAL cFile2
LOCAL cFile3

oMenu:Limpa()
Lista->(Order( 2 ))
dbSelectArea( "Saidas" )
if ( ! .F. ) ; dbClearRelation() ; end ; dbSetRelation( "Lista", {|| Codigo}, "Codigo", .F. )
Saidas->(Order( 3 ))
Saidas->(DbGoTop())
bBloco := {|| Saidas->Fatura = cNrFatu }
Saidas->(DbSeek( cNrFatu ))
cCodi  := Codi
cFile1 := TempNew()
__dbCopyStruct( ( cFile1 ), { "Codigo", "Serie", "Saida", "Data", "Fatura", "Pedido", "Pvendido", "Placa", "Forma", "Codiven" } )
dbUseArea( .T.,, ( cFile1 ), "SaiTemp", iif( .F. .OR. .T., ! .T., NIL ), .F. )
WHILE Eval( bBloco )
    SaiTemp->( DbAppend())
    SaiTemp->Codigo     := Saidas->Codigo
    SaiTemp->Saida      := Saidas->Saida
    SaiTemp->Data         := Saidas->Data
    SaiTemp->Fatura     := Saidas->Fatura
    SaiTemp->Pedido     := Saidas->Pedido
    SaiTemp->PVendido  := Saidas->Pvendido
    SaiTemp->Placa      := Saidas->Placa
    SaiTemp->Forma      := Saidas->Forma
    SaiTemp->Serie      := Saidas->Serie
   SaiTemp->Codiven   := Saidas->Codiven
    nTotFatu              += Saidas->Saida * Saidas->Pvendido
    nVlrFatura             := Saidas->VlrFatura
    Saidas->(DbSkip(1))
Enddo
dbSelectArea( "SaiTemp" )
if ( ! .F. ) ; dbClearRelation() ; end ; dbSetRelation( "Lista", {|| Codigo}, "Codigo", .F. )
oSaidas := CriaBrowse( nPos, 01, nPos+8, MaxCol()-1, "VALOR TOTAL DA FATURA ¯ " + Tran( nTotFatu, "@E 9,999,999,999.99") )
oSaidas:AddColumn( TBColumnNew( "CODIGO ",   {||codigo } ))
oSaidas:AddColumn( TBColumnNew( "DESCRICAO DO PRODUTO",{|| Lista->Descricao } ))
oSaidas:AddColumn( TBColumnNew( "N?SERIE",  {||Serie }))
oSaidas:AddColumn( TBColumnNew( "QUANT",     {||Saida }))
oSaidas:AddColumn( TBColumnNew( "PVENDIDO",  {||Tran( Pvendido,"@E 999,999.99") } ) )
oSaidas:AddColumn( TBColumnNew( "TOTAL ITEM",{||Tran( (saida * pvendido) ,"@E 9,999,999.99") } ) )
oSaidas:AddColumn( TBColumnNew( "UN",        {||Lista->Un } ))
oSaidas:AddColumn( TBColumnNew( "EMISSAO",   {||Data } ) )
oSaidas:AddColumn( TBColumnNew( "FORMA PGTO",{||Forma } ) )
oSaidas:AddColumn( TBColumnNew( "FATURA N§", {||Fatura } ) )
oSaidas:AddColumn( TBColumnNew( "PEDIDO N§", {||Pedido } ) )
oSaidas:AddColumn( TBColumnNew( "PLACA"    , {||Placa  } ) )
oSaidas:AddColumn( TBColumnNew( "VENDEDOR" , {||Codiven } ) )
Coluna:=oSaidas:GetColumn(5)
Coluna:DefColor := { 7, 8 }
Coluna:=oSaidas:GetColumn(6)
Coluna:DefColor := { 7, 8 }

WHILE ( !oSaidas:Stabilize() )
EndDo

dbSelectArea( "Receber" )
Receber->(Order(2 ))
Receber->(DbSeek( cCodi ))
cFile2 := TempNew()
__dbCopy( ( cFile2 ), { },,,, Recno(), .F.,,, )
dbUseArea( .T.,, ( cFile2 ), "ReceTemp", iif( .F. .OR. .T., ! .T., NIL ), .F. )
oReceber := CriaBrowse( nPos-5, 01, nPos-3, MaxCol()-1, "DADOS DO CLIENTE" )
For i := 1 To Fcount()
    oReceber:AddColumn( TbColumnnew( FieldName( i ), FieldwBlock( FieldName( i ), Sele() ) ) )
Next
WHILE ( !oReceber:Stabilize() )
EndDo

dbSelectArea( "ReceMov" )
Recemov->(Order( 4 ))
Recemov->(DbGoTop())
oBloco := {|| Recemov->Fatura = cNrFatu }
Recemov->(DbSeek( cNrFatu ))
cFile3 := TempNew()
__dbCopyStruct( ( cFile3 ), { "Docnr", "Vlr", "Vcto", "Tipo", "Emis", "Juro", "Port", "VlrFatu" } )
dbUseArea( .T.,, ( cFile3), "MovTemp", iif( .F. .OR. .T., ! .T., NIL ), .F. )
WHILE Eval( oBloco )
    MovTemp->( DbAppend())
    MovTemp->Docnr      := Recemov->Docnr
    MovTemp->Vlr         := Recemov->Vlr
    MovTemp->Emis         := Recemov->Emis
    MovTemp->Vcto         := Recemov->Vcto
    MovTemp->Tipo         := Recemov->Tipo
    MovTemp->Juro         := Recemov->Juro
    MovTemp->Port         := "NAO"
    MovTemp->VlrFatu     := 0
    nTotRece              += Recemov->Vlr
    Recemov->( DbSkip())
Enddo

Recebido->(Order( 3 ))
bBloco := {|| Recebido->Fatura = cNrFatu }
Recebido->(DbSeek( cNrFatu ))
WHILE Eval( bBloco )
    MovTemp->( DbAppend())
    MovTemp->Docnr      := Recebido->Docnr
    MovTemp->Vlr         := Recebido->Vlr
    MovTemp->Emis         := Recebido->Emis
    MovTemp->Vcto         := Recebido->Vcto
    MovTemp->Tipo         := Recebido->Tipo
    MovTemp->Juro         := Recebido->Juro
    MovTemp->Port         := Recebido->(Dtoc( DataPag))
    MovTemp->VlrFatu     := Recebido->VlrPag
    nTotBido              += Recebido->Vlr
    Recebido->(DbSkip())
Enddo
nPagoPerc  := ( nTotBido / nVlrFatura ) * 100
nPagarPerc := ( 100 - nPagoPerc )
oRecemov   := CriaBrowse( 01, 01, nPos-8, MaxCol()-1, "ALT+F1|ALT+F2|ALT+F3|TOTAL FATURA: " + ltrim(rtrim(Tran( nTotRece+nTotBido, "@E 999,999.99"))) + "|" + " PERC PAGO : " + ltrim(rtrim(Tran( nPagoPerc, "999%" + "|" + " PERC PAGAR : " + ltrim(rtrim(Tran( nPagarPerc, "999%")))))))
DbGotop()
oRecemov:AddColumn(TBColumnNew( "TITULO N?", {|| DocNr } ))
oRecemov:AddColumn(TBColumnNew( "TIPO",       {|| tipo } ))
oRecemov:AddColumn(TBColumnNew( "EMIS",       {|| Emis } ))
oRecemov:AddColumn(TBColumnNew( "VCTO",       {|| vcto } ))
oRecemov:AddColumn(TBColumnNew( "VALOR",      {|| Tran( Vlr,"@E 999,999.99") } ))
oRecemov:AddColumn(TBColumnNew( "VLR REC",    {|| VlrFatu } ) )
oRecemov:AddColumn(TBColumnNew( "BX",         {|| port } ) )
coluna:=oRecemov:GetColumn(5)
coluna:DefColor := { 7, 8 }
coluna:=oRecemov:GetColumn(6)
coluna:DefColor := { 7, 8 }
WHILE ( !oRecemov:Stabilize())
EndDo

oBrowse := oSaidas
dbSelectArea( "SaiTemp" )
WHILE .T.
    WHILE (! oBrowse:Stabilize())
        Tecla := InKey()
        if (Tecla <> 0 )
            Exit

        endif
    EndDo
    if oBrowse:HitTop .OR. oBrowse:HitBottom
        ErrorBeep()

    endif
    Tecla := InKey( 0 )
    if Tecla == 27
         DbClearRel()
         SaiTemp->( DbCloseArea())
         ReceTemp->( DbCloseArea())
         MovTemp->( DbCloseArea())
         Ferase( cFile1 )
         Ferase( cFile2 )
         Ferase( cFile3 )
         ResTela( cScreen )
         dbSelectArea( "Saidas" )
         Exit

  elseif Tecla == -30
      MudaTab1()
  elseif Tecla == -31
      MudaTab2()
  elseif Tecla == -32
      MudaTab3()
  elseif Tecla == -9
      Calc()
  elseif Tecla == -4
      TabPreco()
  else
        TestaTecla(Tecla, oBrowse)
    endif
EndDo

Function MudaTab1()

oBrowse := oRecemov
dbSelectArea( "MovTemp" )

Function MudaTab2()

oBrowse := oReceber
dbSelectArea( "ReceTemp" )

Function MudaTab3()

oBrowse := oSaidas
dbSelectArea( "SaiTemp" )

Function Ped_Cli9_2( cNrfatu )

LOCAL cScreen      := SaveScreen()
LOCAL nTotFatu   := 0
LOCAL nTotRece   := 0
LOCAL nTotBido   := 0
LOCAL nPagarPerc := 0
LOCAL nPagoPerc  := 0
LOCAL nVlrFatura := 0
LOCAL nPos       := MaxRow() - 9
LOCAL cFile1
LOCAL cFile2
LOCAL cFile3

oMenu:Limpa()
Lista->(Order( 2 ))
dbSelectArea( "Saidas" )
if ( ! .F. ) ; dbClearRelation() ; end ; dbSetRelation( "Lista", {|| Codigo}, "Codigo", .F. )
Saidas->(Order( 3 ))
Saidas->(DbGoTop())
bBloco := {|| Saidas->Fatura = cNrFatu }
Saidas->(DbSeek( cNrFatu ))
cCodi  := Codi
cFile1 := TempNew()
__dbCopyStruct( ( cFile1 ), { "Codigo", "Serie", "Saida", "Data", "Fatura", "Pedido", "Pvendido", "Placa", "Forma", "Codiven" } )
dbUseArea( .T.,, ( cFile1 ), "SaiTemp", iif( .F. .OR. .T., ! .T., NIL ), .F. )
WHILE Eval( bBloco )
    SaiTemp->( DbAppend())
    SaiTemp->Codigo     := Saidas->Codigo
    SaiTemp->Saida      := Saidas->Saida
    SaiTemp->Data         := Saidas->Data
    SaiTemp->Fatura     := Saidas->Fatura
    SaiTemp->Pedido     := Saidas->Pedido
    SaiTemp->PVendido  := Saidas->Pvendido
    SaiTemp->Placa      := Saidas->Placa
    SaiTemp->Forma      := Saidas->Forma
    SaiTemp->Serie      := Saidas->Serie
   SaiTemp->Codiven   := Saidas->Codiven
    nTotFatu              += Saidas->Saida * Saidas->Pvendido
    nVlrFatura             := Saidas->VlrFatura
    Saidas->(DbSkip(1))
Enddo
dbSelectArea( "SaiTemp" )
if ( ! .F. ) ; dbClearRelation() ; end ; dbSetRelation( "Lista", {|| Codigo}, "Codigo", .F. )
oSaidas := CriaBrowse( 01, 01, MaxRow()/2-1, MaxCol()-1, "VALOR TOTAL DA FATURA ¯ " + Tran( nTotFatu, "@E 9,999,999,999.99") )
oSaidas:AddColumn( TBColumnNew( "CODIGO ",   {||codigo } ))
oSaidas:AddColumn( TBColumnNew( "DESCRICAO DO PRODUTO",{|| Lista->Descricao } ))
oSaidas:AddColumn( TBColumnNew( "N?SERIE",  {||Serie }))
oSaidas:AddColumn( TBColumnNew( "QUANT",     {||Saida }))
oSaidas:AddColumn( TBColumnNew( "PVENDIDO",  {||Tran( Pvendido,"@E 999,999.99") } ) )
oSaidas:AddColumn( TBColumnNew( "TOTAL ITEM",{||Tran( (saida * pvendido) ,"@E 9,999,999.99") } ) )
oSaidas:AddColumn( TBColumnNew( "UN",        {||Lista->Un } ))
oSaidas:AddColumn( TBColumnNew( "EMISSAO",   {||Data } ) )
oSaidas:AddColumn( TBColumnNew( "FORMA PGTO",{||Forma } ) )
oSaidas:AddColumn( TBColumnNew( "FATURA N§", {||Fatura } ) )
oSaidas:AddColumn( TBColumnNew( "PEDIDO N§", {||Pedido } ) )
oSaidas:AddColumn( TBColumnNew( "PLACA"    , {||Placa  } ) )
oSaidas:AddColumn( TBColumnNew( "VENDEDOR" , {||Codiven } ) )
Coluna:=oSaidas:GetColumn(5)
Coluna:DefColor := { 7, 8 }
Coluna:=oSaidas:GetColumn(6)
Coluna:DefColor := { 7, 8 }

WHILE ( !oSaidas:Stabilize() )
EndDo

dbSelectArea( "ReceMov" )
Recemov->(Order( 4 ))
Recemov->(DbGoTop())
oBloco := {|| Recemov->Fatura = cNrFatu }
Recemov->(DbSeek( cNrFatu ))
cFile3 := TempNew()
__dbCopyStruct( ( cFile3 ), { "Docnr", "Vlr", "Vcto", "Tipo", "Emis", "Juro", "Port", "VlrFatu" } )
dbUseArea( .T.,, ( cFile3), "MovTemp", iif( .F. .OR. .T., ! .T., NIL ), .F. )
WHILE Eval( oBloco )
    MovTemp->( DbAppend())
    MovTemp->Docnr      := Recemov->Docnr
    MovTemp->Vlr         := Recemov->Vlr
    MovTemp->Emis         := Recemov->Emis
    MovTemp->Vcto         := Recemov->Vcto
    MovTemp->Tipo         := Recemov->Tipo
    MovTemp->Juro         := Recemov->Juro
    MovTemp->Port         := "NAO"
    MovTemp->VlrFatu     := 0
    nTotRece              += Recemov->Vlr
    Recemov->( DbSkip())
Enddo

Recebido->(Order( 3 ))
bBloco := {|| Recebido->Fatura = cNrFatu }
Recebido->(DbSeek( cNrFatu ))
WHILE Eval( bBloco )
    MovTemp->( DbAppend())
    MovTemp->Docnr      := Recebido->Docnr
    MovTemp->Vlr         := Recebido->Vlr
    MovTemp->Emis         := Recebido->Emis
    MovTemp->Vcto         := Recebido->Vcto
    MovTemp->Tipo         := Recebido->Tipo
    MovTemp->Juro         := Recebido->Juro
    MovTemp->Port         := Recebido->(Dtoc( DataPag))
    MovTemp->VlrFatu     := Recebido->VlrPag
    nTotBido              += Recebido->Vlr
    Recebido->(DbSkip())
Enddo
nPagoPerc  := ( nTotBido / nVlrFatura ) * 100
nPagarPerc := ( 100 - nPagoPerc )
oRecemov   := CriaBrowse( MaxRow()/2+1, 01, MaxRow()-1, MaxCol()-1, "ALT+F1|ALT+F2|ALT+F3|TOTAL FATURA: " + ltrim(rtrim(Tran( nTotRece+nTotBido, "@E 999,999.99"))) + "|" + " PERC PAGO : " + ltrim(rtrim(Tran( nPagoPerc, "999%" + "|" + " PERC PAGAR : " + ltrim(rtrim(Tran( nPagarPerc, "999%")))))))
DbGotop()
oRecemov:AddColumn(TBColumnNew( "TITULO N?", {|| DocNr } ))
oRecemov:AddColumn(TBColumnNew( "TIPO",       {|| tipo } ))
oRecemov:AddColumn(TBColumnNew( "EMIS",       {|| Emis } ))
oRecemov:AddColumn(TBColumnNew( "VCTO",       {|| vcto } ))
oRecemov:AddColumn(TBColumnNew( "VALOR",      {|| Tran( Vlr,"@E 999,999.99") } ))
oRecemov:AddColumn(TBColumnNew( "VLR REC",    {|| VlrFatu } ) )
oRecemov:AddColumn(TBColumnNew( "BX",         {|| port } ) )
coluna:=oRecemov:GetColumn(5)
coluna:DefColor := { 7, 8 }
coluna:=oRecemov:GetColumn(6)
coluna:DefColor := { 7, 8 }
WHILE ( !oRecemov:Stabilize())
EndDo

oBrowse := oSaidas
oBrowse:GoTop()
dbSelectArea( "SaiTemp" )
WHILE .T.
    WHILE (! oBrowse:Stabilize())
        Tecla := InKey()
        if (Tecla <> 0 )
            Exit

        endif
    EndDo
    if oBrowse:HitTop .OR. oBrowse:HitBottom
        ErrorBeep()

    endif
    Tecla := InKey( 0 )
    if Tecla == 27
         DbClearRel()
         SaiTemp->( DbCloseArea())
         MovTemp->( DbCloseArea())
         Ferase( cFile1 )
         Ferase( cFile2 )
         Ferase( cFile3 )
         ResTela( cScreen )
         dbSelectArea( "Saidas" )
         Exit

  elseif Tecla == -9
      Calc()
  elseif Tecla == -4
      TabPreco()
  else
        TestaTecla(Tecla, oBrowse)
    endif
EndDo

Proc RelFaturas()

LOCAL cScreen    := SaveScreen()
LOCAL Tam        := 93
LOCAL Col        := 58
LOCAL Pagina    := 0
LOCAL dDataIni := Date()
LOCAL dDataFim := Date()
LOCAL nDocto    := 0
LOCAL nQtd
LOCAL cFatura
LOCAL cUltFatura

WHILE .T.
    oMenu:Limpa()
    MaBox( 10, 10, 13, 40 )
    SetCursor(1) ; DevPos( 11, 11 ) ; DevOut( "Emissao Inicial..:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dDataIni, "dDataIni", "##/##/##",,))
    SetCursor(1) ; DevPos( 12, 11 ) ; DevOut( "Emissao Final....:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dDataFim, "dDataFim", "##/##/##",,))
    ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
    if LastKey() = 27
        Restela( cScreen )
        return
    endif
    Receber->(Order( 2 ))
    Saidas->(Order( 3 ))
    dbSelectArea( "NOTA" )
    Nota->(Order( 3 ))
    LETO_SET( 9, "On" )
    if Nota->(!DbSeek( dDataIni ))
        Nada()
        Loop
        LETO_SET( 9, "Off" )
    endif
    LETO_SET( 9, "Off" )
    if !InsTru80()
        ResTela( cScreen )
        return
    endif
    Col          := 58
    nDocto      := 0
    nQtd          := 0
    nTotal      := 0
    nParcial   := 0
    cUltFatura := ""
    Pagina      := 0
    oBloco      := {|| Nota->Data >= dDataIni .AND. Nota->Data <= dDataFim }
    Mensagem("Aguarde, Imprimindo", 47 )
    PrintOn()
    FPrint( _CPI12 )
    WHILE Nota->(Eval( oBloco )) .AND. Rel_Ok()
        if Col >= 58
            Write( 00, 00, Linha1( Tam, @Pagina))
            Write( 01, 00, Linha2())
            Write( 02, 00, Linha3(Tam))
            Write( 03, 00, Linha4(Tam, SISTEM_NA2 ))
            Write( 04, 00, Padc( "RELATORIO DE FATURAS",Tam ) )
            Write( 05, 00, Linha5(Tam))
            Write( 06, 00, "EMISSAO  DOCTO   CP VEND NOME DO CLIENTE                          QDM VLR FATURA")
            Write( 07, 00, Linha5(Tam))
            Col := 8
        endif
        cFatura        := Nota->Numero
        cCodi         := Nota->Codi
        cNome         := if( Receber->(DbSeek( cCodi )), Receber->Nome, Space(40))
        cForma        := if( Saidas->(DbSeek( cFatura )), Saidas->Forma, Space(02))
        cCodiVen     := if( Saidas->(DbSeek( cFatura )), Saidas->Codiven, Space(04))
        nQtd_d_Fatu := if( Saidas->(DbSeek( cFatura )), Saidas->Qtd_D_Fatu, 0)
        nVlrFatura    := if( Saidas->(DbSeek( cFatura )), Saidas->VlrFatura, 0)
        Qout( Nota->Data, cFatura, cForma, cCodiven, cNome, StrZero( nQtd_D_Fatu, 3), Tran( nVlrFatura, "@E 999,999.99"))
        Col++
        nDocto++
        nQtd        += nQtd_d_Fatu
        nTotal    += nVlrFatura
        nParcial += nVlrFatura
        Nota->(DbSkip(1))
        if Col >= 56 .OR. Nota->(!Eval( oBloco ))
            Qout(Repl( "-", Tam ))
            Col++
            Qout("*** SubTotal *** ", StrZero( nDocto, 5 ), space(39), StrZero( nQtd, 5 ), Tran( nParcial, "@E 999,999.99" ))
            Col++
            if Nota->(!Eval( oBloco ))
                Qout("***  Total   *** ", StrZero( nDocto, 5 ), space(39), StrZero( nQtd, 5 ), Tran( nParcial, "@E 999,999.99" ))
                Col++
                __Eject()
                PrintOff()
            else
                __Eject()
            endif
        endif
    EndDo
    PrintOff()
EndDo
ResTela( cScreen )
return


Proc RelVencer()

LOCAL cScreen     := SaveScreen()
LOCAL Tam         := 93
LOCAL Col         := 58
LOCAL Pagina     := 0
LOCAL dDataIni  := Date()
LOCAL dDataFim  := Date()
LOCAL nDocto     := 0
LOCAL nTotPagar := 0
LOCAL nQtd
LOCAL cFatura
LOCAL cUltFatura

WHILE .T.
    oMenu:Limpa()
    MaBox( 10, 10, 13, 40 )
    SetCursor(1) ; DevPos( 11, 11 ) ; DevOut( "Emissao Inicial..:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dDataIni, "dDataIni", "##/##/##",,))
    SetCursor(1) ; DevPos( 12, 11 ) ; DevOut( "Emissao Final....:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dDataFim, "dDataFim", "##/##/##",,))
    ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
    if LastKey() = 27
        Restela( cScreen )
        return
    endif
    Receber->(Order( 2 ))
    Saidas->(Order( 3 ))
    Recemov->(Order( 4 ))
    dbSelectArea( "NOTA" )
    Nota->(Order( 3 ))
    LETO_SET( 9, "On" )
    if Nota->(!DbSeek( dDataIni ))
        Nada()
        Loop
        LETO_SET( 9, "Off" )
    endif
    LETO_SET( 9, "Off" )
    if !InsTru80()
        ResTela( cScreen )
        return
    endif
    Col          := 58
    nDocto      := 0
    nQtd          := 0
    nTotal      := 0
    nTotPagar  := 0
    cUltFatura := ""
    Pagina      := 0
    oBloco      := {|| Nota->Data >= dDataIni .AND. Nota->Data <= dDataFim }
    Mensagem("Aguarde, Imprimindo", 47 )
    PrintOn()
    FPrint( _CPI12 )
    WHILE Nota->(Eval( oBloco )) .AND. Rel_Ok()
        if Col >= 58
            Write( 00, 00, Linha1( Tam, @Pagina))
            Write( 01, 00, Linha2())
            Write( 02, 00, Linha3(Tam))
            Write( 03, 00, Linha4(Tam, SISTEM_NA2 ))
            Write( 04, 00, Padc( "RELATORIO DE FATURAS E/OU CONTRATOS A VENCER",Tam ) )
            Write( 05, 00, Linha5(Tam))
            Write( 06, 00, "EMISSAO  DOCTO   CP VEND NOME DO CLIENTE                          QDM VLR FATURA   TOT PAGO")
            Write( 07, 00, Linha5(Tam))
            Col := 8
        endif
        cFatura        := Nota->Numero
        cCodi         := Nota->Codi
        cNome         := if( Receber->(DbSeek( cCodi )), Receber->Nome, Space(40))
        cForma        := if( Saidas->(DbSeek( cFatura )), Saidas->Forma, Space(02))
        cCodiVen     := if( Saidas->(DbSeek( cFatura )), Saidas->Codiven, Space(04))
        nQtd_d_Fatu := if( Saidas->(DbSeek( cFatura )), Saidas->Qtd_D_Fatu, 0)
        nVlrFatura    := if( Saidas->(DbSeek( cFatura )), Saidas->VlrFatura, 0)
        if Recemov->(DbSeek( cFatura ))
            WHILE Recemov->Fatura = cFatura
                nParPagar := Recemov->Vlr
                Recemov->(DbSkip(1))
            EndDO
            Qout( Nota->Data, cFatura, cForma, cCodiven, cNome, StrZero( nQtd_D_Fatu, 3), Tran( nVlrFatura, "@E 999,999.99"), Tran( nParPagar, "@E 999,999.99"))
            Col++
            nDocto++
            nTotPagar += nParPagar
            nQtd         += nQtd_d_Fatu
            nTotal     += nVlrFatura
        endif
        Nota->(DbSkip(1))
        if Col >= 57 .OR. Nota->(!Eval( oBloco ))
            Qout( Repl( "-", Tam ))
            Col++
            Qout("*** SubTotal *** ", StrZero( nDocto, 5 ), space(39), StrZero( nQtd, 5 ), Tran( nTotal, "@E 999,999.99"), Tran( nTotPagar, "@E 999,999.99"))
            Col++
            if Nota->(!Eval( oBloco ))
                Qout("***  Total   *** ", StrZero( nDocto, 5 ), space(39), StrZero( nQtd, 5 ), Tran( nTotal, "@E 999,999.99"), Tran( nTotPagar, "@E 999,999.99"))
                Col++
                __Eject()
                PrintOff()
            else
                __Eject()
            endif
        endif
    EndDo
    PrintOff()
EndDo
ResTela( cScreen )
return

Proc RelFatVencidas()

LOCAL cScreen    := SaveScreen()
LOCAL Tam        := 132
LOCAL Col        := 58
LOCAL Pagina    := 0
LOCAL dDataIni := Date()
LOCAL dDataFim := Date()
LOCAL nDocto    := 0
LOCAL nQtd
LOCAL cFatura
LOCAL cUltFatura

WHILE .T.
    oMenu:Limpa()
    MaBox( 10, 10, 13, 40 )
    SetCursor(1) ; DevPos( 11, 11 ) ; DevOut( "Pagamento Inicial.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dDataIni, "dDataIni", "##/##/##",,))
    SetCursor(1) ; DevPos( 12, 11 ) ; DevOut( "Pagamento Final...:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dDataFim, "dDataFim", "##/##/##",,))
    ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
    if LastKey() = 27
        Restela( cScreen )
        return
    endif
    Receber->(Order( 2 ))
    Recemov->(Order( 4 ))
    Saidas->(Order( 3 ))
    dbSelectArea( "RECEBIDO" )
    Recebido->(Order( 2 ))
    LETO_SET( 9, "On" )
    if Recebido->(!DbSeek( dDataIni ))
        Nada()
        LETO_SET( 9, "Off" )
        Loop
    endif
    LETO_SET( 9, "Off" )
    if !InsTru80()
        ResTela( cScreen )
        return
    endif
    Col          := 58
    nDocto      := 0
    nQtd          := 0
    nTotal      := 0
    nParcial   := 0
    cUltFatura := ""
    Pagina      := 0
    oBloco      := {|| Recebido->DataPag >= dDataIni .AND. Recebido->DataPag <= dDataFim }
    Mensagem("Aguarde, Imprimindo", 47 )
    PrintOn()
    FPrint( PQ )
    WHILE Recebido->(Eval( oBloco )) .AND. Rel_Ok()
        if Col >= 58
            Write( 00, 00, Linha1( Tam, @Pagina))
            Write( 01, 00, Linha2())
            Write( 02, 00, Linha3(Tam))
            Write( 03, 00, Linha4(Tam, SISTEM_NA2 ))
            Write( 04, 00, Padc( "RELATORIO DE FATURAS E/OU CONTRATOS VENCIDOS",Tam ) )
            Write( 05, 00, Linha5(Tam))
            Write( 06, 00, "EMISSAO  VENCTO   DOCTO     CP VEND NOME DO CLIENTE                          QDM VLR FATURA VLR TITULO   VLR PAGO")
            Write( 07, 00, Linha5(Tam))
            Col := 8
        endif
        cFatura        := Recebido->Fatura
        cCodi         := Recebido->Codi
        cNome         := if( Receber->(DbSeek( cCodi )), Receber->Nome, Space(40))
        cForma        := if( Saidas->(DbSeek( cFatura )), Saidas->Forma, Space(02))
        cCodiVen     := if( Saidas->(DbSeek( cFatura )), Saidas->Codiven, Space(04))
        nQtd_d_Fatu := if( Saidas->(DbSeek( cFatura )), Saidas->Qtd_D_Fatu, 0)
        nVlrFatura    := if( Saidas->(DbSeek( cFatura )), Saidas->VlrFatura, 0)
        if Recemov->(!DbSeek( cFatura ))
            Qout( Recebido->Emis, Recebido->Vcto, cFatura, cForma, cCodiven, cNome, StrZero( nQtd_d_Fatu, 3), Tran( nVlrFatura, "@E 999,999.99"), Tran( Recebido->Vlr,"@E 999,999.99"), Tran( Recebido->Vlrpag, "@E 999,999.99"))
            Col++
            nDocto++
            nQtd        += nQtd_d_Fatu
            nTotal    += nVlrFatura
            nParcial += nVlrFatura
        endif
        Recebido->(DbSkip(1))
        if Col >= 56 .OR. Recebido->(!Eval( oBloco ))
            Qout(Repl( "-", Tam ))
            Col++
            Qout("*** SubTotal *** ", StrZero( nDocto, 5 ), space(50), StrZero( nQtd, 5 ), Tran( nParcial, "@E 999,999.99" ))
            Col++
            if Recebido->(!Eval( oBloco ))
                Qout("***  Total   *** ", StrZero( nDocto, 5 ), space(50), StrZero( nQtd, 5 ), Tran( nParcial, "@E 999,999.99" ))
                Col++
                __Eject()
                PrintOff()
            else
                __Eject()
            endif
        endif
    EndDo
    PrintOff()
EndDo
ResTela( cScreen )
return

Proc PosCompra()

LOCAL GetList    := {}
LOCAL cScreen    := SaveScreen()
LOCAL nTam        := 0
LOCAL cCodiIni := 0
LOCAL cCodifim := 0
LOCAL nChoice    := 0
LOCAL nOrdem    := 0
LOCAL lFiltro    := .F.
LOCAL dIni        := Date()
LOCAL dFim        := Date()
LOCAL xAlias    := FTempName()
LOCAL xNtx        := FTempName()
LOCAL aMenu     := {"Parcial", "Por Fornecedor", "Ponta de Estoque por Fornecedor", "Ponta de Estoque Por Grupo"}
LOCAL aOrdem    := {"Codigo","Descricao","Cod Fabr/Ref","Agrupado por Cod Fabr/Ref", "Descricao+Tamanho","Agrupado por Grupo"}







LOCAL aDbf        := {{"CODIGO",     "C", 06, 0 }, {"DESCRICAO",  "C", 40, 0 }, {"QUANT",      "N", 09, 2 }, {"SAIDA",      "N", 09, 2 }, {"SAIANT",     "N", 09, 2 }, {"SAIPOS",     "N", 09, 2 }, {"CODGRUPO",   "C", 03, 0 }, {"CODSGRUPO",  "C", 06, 0 }, {"ENTRADA",    "N", 09, 2 }, {"ENTANT",     "N", 09, 2 }, {"ENTPOS",     "N", 09, 2 }, {"N_ORIGINAL", "C", 15, 0 }, {"TAM",        "C", 06, 0 }, {"VAREJO",     "N", 11, 2 },  {"PCUSTO",     "N", 11, 2 }, {"DATA",       "D", 08, 0 }}
LOCAL cTela1          := SaveScreen()
LOCAL bBloco          := {}
LOCAL nEstoAtual      := 0
LOCAL nSaida          := 0
LOCAL nVarejo          := 0
LOCAL nPcusto          := 0
LOCAL nEntrada       := 0
LOCAL nSaidas          := 0
LOCAL nSaldo          := 0
LOCAL Col              := 0
LOCAL Pagina          := 0
LOCAL nContador      := 0
LOCAL nAtual          := 0
LOCAL nEntradas      := 0
LOCAL nSaiAnt          := 0
LOCAL nSaiDep          := 0
LOCAL nEntDep          := 0
LOCAL nEntAnt          := 0
LOCAL nDif              := 0
LOCAL nEstoAnterior := 0
LOCAL nParcAnt       := 0
LOCAL nParcEnt       := 0
LOCAL nParcSai       := 0
LOCAL nParcSaldo      := 0
LOCAL nParcAtual      := 0
LOCAL cDescricao      := ""
LOCAL cTam              := ""
LOCAL cOriginal      := ""
LOCAL cCodigo          := ""
LOCAL cCodi           := ""
LOCAL cRefAtual      := ""
LOCAL dData           := Date()
LOCAL cPrazo          := ""
LOCAL lSair           := .F.
LOCAL cString          := ""
LOCAL nMin              := 0
LOCAL aGrade          := {}
LOCAL nPos              := 0
LOCAL cRefAnt
LOCAL cGrupoAnt
LOCAL nTotAnt
LOCAL nTotEnt
LOCAL nTotSai
FIELD Codigo
FIELD Descricao

WHILE .T.
    oMenu:Limpa()
    M_Title("POSICAO ENTRADA E SAIDA DE PRODUTOS")
    nChoice := FazMenu( 04, 10, aMenu, Cor())
    Do Case
    Case nChoice = 0
        ResTela( cScreen )
        return

    Case nChoice = 1
        cCodiIni := 0
        cCodifim := 0
        dIni        := Date() - 30
        dFim        := Date()
        MaBox( 12, 10, 17, 70, "ROL ENT/SAI PRODUTO")
        SetCursor(1) ; DevPos( 13, 11 ) ; DevOut( "Codigo Inicial.: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodiIni, "cCodiIni", "999999", {|| CodiErrado( @cCodiIni )},))
        SetCursor(1) ; DevPos( 14, 11 ) ; DevOut( "Codigo Final...: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodifim, "cCodifim", "999999", {|| CodiErrado( @cCodifim )},))
        SetCursor(1) ; DevPos( 15, 11 ) ; DevOut( "Data Inicial...: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dIni, "dIni", "##/##/##",,))
        SetCursor(1) ; DevPos( 16, 11 ) ; DevOut( "Data Final.....: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dFim, "dFim", "##/##/##",,))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        if LastKey() = 27
            ResTela( cScreen )
            Loop
        endif
        cString    := "CODIGO: " + cCodiIni + " A " + cCodifim
        bBloco    := {|| Lista->Codigo >= cCodiIni .AND. Lista->Codigo <= cCodifim }
        Lista->(Order( 2 ))

    Case nChoice = 2
        cCodiIni := Space(04)
        dIni        := Date() - 30
        dFim        := Date()
        MaBox( 12, 10, 16, 74, "ROL ENT/SAI PRODUTO")
        SetCursor(1) ; DevPos( 13, 11 ) ; DevOut( "Fornecedor.....: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodiIni, "cCodiIni", "9999", {|| Pagarrado( @cCodiIni, Row(), Col()+1 )},))
        SetCursor(1) ; DevPos( 14, 11 ) ; DevOut( "Data Inicial...: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dIni, "dIni", "##/##/##",,))
        SetCursor(1) ; DevPos( 15, 11 ) ; DevOut( "Data Final.....: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dFim, "dFim", "##/##/##",,))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        if LastKey() = 27
            ResTela( cScreen )
            Loop
        endif
        cString := "FORNECEDOR: " + Pagar->Codi + " - " + ltrim(rtrim(Pagar->Nome))
        bBloco  := {|| Lista->Codi = cCodiIni }
        Lista->(Order( 9 ))

    Case nChoice = 3
        nMin        := 0
        dIni        := Date() - 30
        dFim        := Date()
        cCodiIni := Space(04)
        MaBox( 12, 10, 17, 74, "ROL ENT/SAI PRODUTO")
        SetCursor(1) ; DevPos( 13, 11 ) ; DevOut( "Fornecedor.....: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodiIni, "cCodiIni", "9999", {|| Pagarrado( @cCodiIni, Row(), Col()+1 )},))
        SetCursor(1) ; DevPos( 14, 11 ) ; DevOut( "Estoque Grade..: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nMin, "nMin", "999999.99",,))
        SetCursor(1) ; DevPos( 15, 11 ) ; DevOut( "Data Inicial...: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dIni, "dIni", "##/##/##",,))
        SetCursor(1) ; DevPos( 16, 11 ) ; DevOut( "Data Final.....: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dFim, "dFim", "##/##/##",,))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        if LastKey() = 27
            ResTela( cScreen )
            Loop
        endif
        cString := "FORNECEDOR: " + Pagar->Codi + " - " + ltrim(rtrim(Pagar->Nome))
        bBloco  := {|| Lista->Codi = cCodiIni }
        Lista->(Order( 9 ))

    Case nChoice = 4
        nMin        := 0
        dIni        := Date() - 30
        dFim        := Date()
        cCodiIni := Space(03)
        MaBox( 12, 10, 17, 74, "ROL ENT/SAI PRODUTO")
        SetCursor(1) ; DevPos( 13, 11 ) ; DevOut( "Grupo..........: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodiIni, "cCodiIni", "9999", {|| GrupoErrado( @cCodiIni )},))
        SetCursor(1) ; DevPos( 14, 11 ) ; DevOut( "Estoque Grade..: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nMin, "nMin", "999999.99",,))
        SetCursor(1) ; DevPos( 15, 11 ) ; DevOut( "Data Inicial...: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dIni, "dIni", "##/##/##",,))
        SetCursor(1) ; DevPos( 16, 11 ) ; DevOut( "Data Final.....: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dFim, "dFim", "##/##/##",,))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        if LastKey() = 27
            ResTela( cScreen )
            Loop
        endif
        cString := "GRUPO: " + Grupo->CodGrupo + " - " + ltrim(rtrim(Grupo->DesGrupo))
        bBloco  := {|| Lista->CodGrupo = cCodiIni }
        Lista->(Order( 1 ))

    EndCase
    aGrade  := {}
    lFiltro := Conf("Pergunta: Selecionar registros zerados ou negativos ?")
    Entradas->(Order( 1 ))
    Saidas->(Order( 1 ))
    if Lista->( !DbSeek( cCodiIni ))
        ErrorBeep()
        Nada()
        Loop
    endif
    cTela1  := SaveScreen()
    Mensagem("Aguarde, Localizando Registros.", Cor())
    DbCreate( xAlias, aDbf )
    dbUseArea( .T.,, ( xAlias ), "xTemp", iif( .F. .OR. .T., ! .T., NIL ), .F. )
    ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( (xNtx ),, "xTemp->Codigo", {|| xTemp->Codigo}, )
    WHILE Lista->(Eval( bBloco )) .AND. Rep_Ok()
        nEstoAtual      := Lista->Quant
        cDescricao      := Lista->Descricao
        cTam              := Lista->Tam
        cOriginal      := Lista->N_Original
        cCodGrupo      := Lista->CodGrupo
        cCodsGrupo      := Lista->CodsGrupo
        cCodi           := Lista->Codi
        cCodigo          := Lista->Codigo
        nVarejo          := Lista->Varejo
        nPcusto          := Lista->Pcusto

        if !( lFiltro )
            if nEstoAtual <= 0
                Lista->(DbSkip(1))
                Loop
            endif
        endif

        if nChoice = 3 .OR. nChoice = 4
            nPos := Ascan( aGrade, cOriginal + cCodi )
            if nPos > 0
                Lista->(DbSkip(1))
                Loop
            endif
            nRecno := Lista->(Recno())
            nSoma  := SomaGrade( cCodiIni )
            Lista->(Order( 9 ))
            Lista->(DbGoTo( nRecno ))
            if nSoma > nMin
                Aadd( aGrade, cOriginal + cCodi )
                Lista->(DbSkip(1))
                Loop
            endif
        endif

        if Saidas->(DbSeek( cCodigo ))
            Mensagem("Aguarde, Somando Saidas.", Cor())
            While Saidas->Codigo = cCodigo
                nSaida  := Saidas->Saida
                dData   := Saidas->Data
                cPrazo  := ""
                if xTemp->(!DbSeek( cCodigo ))
                    xTemp->(DbAppend())
                    xTemp->Codigo        := cCodigo
                    xTemp->CodGrupo    := cCodGrupo
                    xTemp->CodsGrupo    := cCodsGrupo
                    xTemp->Descricao    := cDescricao
                    xTemp->Quant        := nEstoAtual
                    xTemp->N_Original := cOriginal
                    xTemp->Tam            := cTam
                    xTemp->Varejo        := nVarejo
                    xTemp->Pcusto        := nPcusto
                endif
                if dData >= dIni .AND. dData <= dFim
                    xTemp->Saida += nSaida
                    xTemp->Data  := dData
                elseif dData < dIni
                    xTemp->SaiAnt += nSaida
                    xTemp->Data   := dData
                elseif dData > dFim
                    xTemp->SaiPos += nSaida
                    xTemp->Data   := dData
                endif
                Saidas->(DbSkip(1))
            EndDo
        endif

        if Entradas->(DbSeek( cCodigo ))
            Mensagem("Aguarde, Somando Entradas.", Cor())
            While Entradas->Codigo = cCodigo
                nEntrada := Entradas->Entrada
                dData     := Entradas->Data
                cPrazo    := Entradas->Condicoes
                if xTemp->(!DbSeek( cCodigo ))
                    xTemp->(DbAppend())
                    xTemp->Codigo        := cCodigo
                    xTemp->CodGrupo    := cCodGrupo
                    xTemp->CodsGrupo    := cCodsGrupo
                    xTemp->Descricao    := cDescricao
                    xTemp->Quant        := nEstoAtual
                    xTemp->N_Original := cOriginal
                    xTemp->Tam            := cTam
                    xTemp->Varejo        := nVarejo
                    xTemp->Pcusto        := nPcusto
                endif
                if dData >= dIni .AND. dData <= dFim
                    xTemp->Entrada += nEntrada
                    xTemp->Data     := dData
                elseif dData < dIni
                    xTemp->EntAnt    += nEntrada
                    xTemp->Data     := dData
                elseif dData > dFim
                    xTemp->EntPos    += nEntrada
                    xTemp->Data     := dData
                endif
                Entradas->(DbSkip(1))
            Enddo
        endif
        Lista->(DbSkip(1))
    Enddo
    xTemp->(DbGoTop())
    if xTemp->(Eof())
        xTemp->(DbCloseArea())
        Ferase( xAlias )
        Ferase( xNtx )
        Loop
    endif
    WHILE .T.
        oMenu:Limpa()
        M_Title("ESCOLHA ORDEM DO RELATORIO")
        nOrdem := FazMenu( 05, 10, aOrdem, Cor())
        Do Case
        Case nOrdem = 0
            xTemp->(DbCloseArea())
            Ferase( xAlias )
            Ferase( xNtx )
            Exit
        Case nOrdem = 1
            Mensagem("Aguarde: Ordenando Registros.", Cor())
            ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Codigo", {|| xTemp->Codigo}, )

        Case nOrdem = 2
            Mensagem("Aguarde: Ordenando Registros.", Cor())
            ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Descricao", {|| xTemp->Descricao}, )

        Case nOrdem = 3
            Mensagem("Aguarde: Ordenando Registros.", Cor())
            ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->N_Original", {|| xTemp->N_Original}, )

        Case nOrdem = 4
            Mensagem("Aguarde: Ordenando Registros.", Cor())
            ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->CodGrupo + xTemp->N_Original", {|| xTemp->CodGrupo + xTemp->N_Original}, )

        Case nOrdem = 5
            Mensagem("Aguarde: Ordenando Registros.", Cor())
            ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Descricao + xTemp->Tam", {|| xTemp->Descricao + xTemp->Tam}, )

        Case nOrdem = 6
            Mensagem("Aguarde: Ordenando Registros.", Cor())
            ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->CodGrupo + xTemp->N_Original", {|| xTemp->CodGrupo + xTemp->N_Original}, )

        EndCase
        nSaidas          := 0
        nEntrada       := 0
        nSaldo          := 0
        nTam              := 132
        Col              := 58
        Pagina          := 0
        nContador      := 0
        lSair           := .F.

        if !Instru80()
            Loop
        endif

        ResTela( cTela1 )
        Mensagem("Aguarde, Imprimindo. ", Cor())
        PrintOn()
        FPrint( PQ )
        SetPrc( 0, 0 )
        dbSelectArea( "xTemp" )
        xTemp->(DbGoTop())
        cRefAnt      := xTemp->N_Original
        cGrupoAnt  := xTemp->CodGrupo
        nParcAnt   := 0
        nParcEnt   := 0
        nParcSai   := 0
        nParcSaldo := 0
        nParcAtual := 0
        nTotAnt      := 0
        nTotEnt      := 0
        nTotSai      := 0
        WHILE xTemp->( !Eof()) .AND. Rel_Ok()
            if Col >= 58
                Write( 00, 00, Linha1( nTam, @Pagina))
                Write( 01, 00, Linha2())
                Write( 02, 00, Linha3(nTam))
                Write( 03, 00, Linha4(nTam, SISTEM_NA2 ))
                Write( 04, 00, Padc( "ROL DE ENTRADA/SAIDA E POSICAO ATUAL NO PERIODO DE " + DToc( dIni ) + " A " + DToc( dFim ), nTam ))
                Write( 05, 00, Padc( cString, nTam ))
                Write( 06, 00, Linha5(nTam))
                Write( 07, 00,"CODIGO REFERENCIA TAM  DESCRICAO                                      CUSTO      VAREJO   (+)ANT   (+)ENT DATA ENT   (-)SAI   (=)SAL")
                Write( 08, 00, Linha5(nTam))
                Col := 9
            endif
            nAtual          := xTemp->Quant
            nSaidas          := xTemp->Saida
            nEntradas      := xTemp->Entrada
            nSaiAnt          := xTemp->SaiAnt
            nSaiDep          := xTemp->SaiPos
            nEntAnt          := xTemp->EntAnt
            nEntDep          := xtemp->EntPos
            nTotEnt          += xTemp->Entrada
            nTotAnt          += xTemp->EntAnt
            nTotSai          += xTemp->Saida
            nEstoAnterior := ( nAtual + nSaidas ) - nEntradas
            nEstoAnterior := ( nEstoAnterior + nSaiDep ) - nEntDep
            nSaldo          := ( nEstoAnterior + nEntradas ) - nSaidas
            cCodigo          := xTemp->Codigo
            cDescricao      := xTemp->Descricao
            nAtual          := xTemp->Quant
            cOriginal      := Left( xTemp->N_Original, 11 )
            cTam              := Left( xTemp->Tam, 3 )
            nVarejo          := xTemp->Varejo
            nPcusto          := xTemp->Pcusto
            dData           := xTemp->Data
            nDif              := nSaldo - ( nAtual - nEstoAnterior )








            Qout( cCodigo, cOriginal, cTam, cDescricao,     Tran( nPcusto,       "@E 9999,999.99"),    Tran( nVarejo,       "@E 9999,999.99"),    Tran( nEstoAnterior,"99999.99"),    Tran( nEntradas,      "99999.99"),    dData,    Tran( nSaidas,       "99999.99"),    Tran( nSaldo,          "99999.99"))
            Col++
            nContador++
            nParcAnt   += nEstoAnterior
            nParcEnt   += nEntradas
            nParcSai   += nSaidas
            nParcSaldo += nSaldo
            nParcAtual += nAtual
            cRefAnt      := xTemp->N_Original
            cGrupoAnt  := xTemp->CodGrupo
            cPorc       := Tran(((nVarejo / nPcusto ) * 100 ) - 100, "999.99%")
            nLen          := Len( cPorc + cPrazo )
            xTemp->(DbSkip(1))
            if nOrdem = 4
                if cRefAnt <> xTemp->N_Original
                    Qout()







                    Qout( Repl("-", 85-nLen ),    cPorc,    cPrazo,    Tran( nParcAnt,  "99999.99"),    Tran( nParcEnt,  "99999.99"),    Space(08),    Tran( nParcSai,  "99999.99"),    Tran( nParcSaldo,"99999.99"))
                    Qout()
                    Col++
                    Col++
                    Col++
                    nParcAnt   := 0
                    nParcEnt   := 0
                    nParcSai   := 0
                    nParcSaldo := 0
                    nParcAtual := 0
                endif
            endif
            if nOrdem = 6
                if cGrupoAnt <> xTemp->CodGrupo
                    Qout()







                    Qout( Repl("-", 85-nLen ),    cPorc,    cPrazo,    Tran( nParcAnt,  "99999.99"),    Tran( nParcEnt,  "99999.99"),    Space(08),    Tran( nParcSai,  "99999.99"),    Tran( nParcSaldo,"99999.99"))
                    Qout()
                    Col++
                    Col++
                    Col++
                    nParcAnt   := 0
                    nParcEnt   := 0
                    nParcSai   := 0
                    nParcSaldo := 0
                    nParcAtual := 0
                endif
            endif
            if Col >= 56 .OR. xTemp->(Eof())
                Qout( Repl("=", 87), Tran( nTotAnt,"99999.99"), Tran( nTotEnt,"99999.99"), Space(8), Tran( nTotSai, "99999.99"), Tran( nTotEnt-nTotSai, "99999.99"))
                Col := 58
                __Eject()
            endif
        EndDo
        xTemp->(DbClearIndex())
        PrintOff()
        ResTela( cTela1 )
    EndDo
EndDo

Function SomaGrade( cCodiIni )

LOCAL cOriginal := Lista->N_Original
LOCAL nSoma      := 0

Mensagem("Aguarde, Somando Grade.", Cor())
Lista->(Order( 10 ))
Lista->(DbSeek( cOriginal ))
While Lista->N_Original = cOriginal
    if Lista->Quant <= 0 .OR. Lista->Codi <> cCodiIni
        Lista->(DbSkip(1))
        Loop
    endif
    nSoma += Lista->Quant
    Lista->(DbSkip(1))
EndDo
return( nSoma )

Proc CurvaAbc()

LOCAL GetList    := {}
LOCAL cScreen    := SaveScreen()
LOCAL nTam        := 0
LOCAL cCodi     := Space(04)
LOCAL cCodiIni := 0
LOCAL cCodifim := 0
LOCAL nChoice    := 0
LOCAL nOrdem    := 0
LOCAL lFiltro    := .F.
LOCAL dIni        := Date()
LOCAL dFim        := Date()
LOCAL xAlias    := FTempName()
LOCAL xNtx        := FTempName()
LOCAL aMenu     := {"Por Produto Parcial", "Por Fornecedor", "Por Grupo de Produto", "Por Cliente"}
LOCAL aOrdem    := {"Codigo","Descricao","Cod Fabr/Ref","Agrupado por Cod Fabr/Ref", "Descricao+Tamanho","Agrupado por Grupo", "Ranking (Ascendente)", "Ranking (Descendente)"}







LOCAL aDbf        := {{"CODIGO",     "C", 06, 0 }, {"DESCRICAO",  "C", 40, 0 }, {"QUANT",      "N", 09, 2 }, {"SAIDA",      "N", 09, 2 }, {"SAIANT",     "N", 09, 2 }, {"SAIPOS",     "N", 09, 2 }, {"CODGRUPO",   "C", 03, 0 }, {"CODSGRUPO",  "C", 06, 0 }, {"ENTRADA",    "N", 09, 2 }, {"ENTANT",     "N", 09, 2 }, {"ENTPOS",     "N", 09, 2 }, {"N_ORIGINAL", "C", 15, 0 }, {"TAM",        "C", 06, 0 }, {"VAREJO",     "N", 11, 2 },  {"PCUSTO",     "N", 11, 2 }, {"DATA",       "D", 08, 0 }}
LOCAL cTela1          := SaveScreen()
LOCAL bBloco          := {}
LOCAL nEstoAtual      := 0
LOCAL nSaida          := 0
LOCAL nVarejo          := 0
LOCAL nPcusto          := 0
LOCAL nEntrada       := 0
LOCAL nSaidas          := 0
LOCAL nSaldo          := 0
LOCAL Col              := 0
LOCAL Pagina          := 0
LOCAL nContador      := 0
LOCAL nAtual          := 0
LOCAL nEntradas      := 0
LOCAL nSaiAnt          := 0
LOCAL nSaiDep          := 0
LOCAL nEntDep          := 0
LOCAL nEntAnt          := 0
LOCAL nDif              := 0
LOCAL nEstoAnterior := 0
LOCAL nParcAnt       := 0
LOCAL nParcEnt       := 0
LOCAL nParcSai       := 0
LOCAL nParcSaldo      := 0
LOCAL nParcAtual      := 0
LOCAL cDescricao      := ""
LOCAL cTam              := ""
LOCAL cOriginal      := ""
LOCAL cCodigo          := ""
LOCAL cRefAtual      := ""
LOCAL dData           := Date()
LOCAL cPrazo          := ""
LOCAL lSair           := .F.
LOCAL cString          := ""
LOCAL nMin              := 0
LOCAL aGrade          := {}
LOCAL nPos              := 0
LOCAL cRefAnt
LOCAL cGrupoAnt
LOCAL nTotAnt
LOCAL nTotEnt
LOCAL nTotSai
FIELD Codigo
FIELD Descricao

WHILE .T.
    oMenu:Limpa()
    M_Title("CURVA ABC DE VENDAS")
    nChoice := FazMenu( 04, 10, aMenu, Cor())
    Do Case
    Case nChoice = 0
        ResTela( cScreen )
        return

    Case nChoice = 1
        cCodiIni := 0
        cCodifim := 0
        dIni        := Date() - 30
        dFim        := Date()
        MaBox( 12, 10, 17, 70, "CURVA ABC POR PRODUTO")
        SetCursor(1) ; DevPos( 13, 11 ) ; DevOut( "Codigo Inicial.: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodiIni, "cCodiIni", "999999", {|| CodiErrado( @cCodiIni )},))
        SetCursor(1) ; DevPos( 14, 11 ) ; DevOut( "Codigo Final...: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodifim, "cCodifim", "999999", {|| CodiErrado( @cCodifim )},))
        SetCursor(1) ; DevPos( 15, 11 ) ; DevOut( "Data Inicial...: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dIni, "dIni", "##/##/##",,))
        SetCursor(1) ; DevPos( 16, 11 ) ; DevOut( "Data Final.....: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dFim, "dFim", "##/##/##",,))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        if LastKey() = 27
            ResTela( cScreen )
            Loop
        endif
        cString    := "CODIGO: " + cCodiIni + " A " + cCodifim
        bBloco    := {|| Lista->Codigo >= cCodiIni .AND. Lista->Codigo <= cCodifim }
        Lista->(Order( 2 ))

    Case nChoice = 2
        cCodiIni := Space(04)
        dIni        := Date() - 30
        dFim        := Date()
        MaBox( 12, 10, 16, 74, "CURVA ABC POR FORNECEDOR")
        SetCursor(1) ; DevPos( 13, 11 ) ; DevOut( "Fornecedor.....: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodiIni, "cCodiIni", "9999", {|| Pagarrado( @cCodiIni, Row(), Col()+1 )},))
        SetCursor(1) ; DevPos( 14, 11 ) ; DevOut( "Data Inicial...: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dIni, "dIni", "##/##/##",,))
        SetCursor(1) ; DevPos( 15, 11 ) ; DevOut( "Data Final.....: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dFim, "dFim", "##/##/##",,))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        if LastKey() = 27
            ResTela( cScreen )
            Loop
        endif
        cString := "FORNECEDOR: " + Pagar->Codi + " - " + ltrim(rtrim(Pagar->Nome))
        bBloco  := {|| Lista->Codi = cCodiIni }
        Lista->(Order( 9 ))

    Case nChoice = 3
        nMin        := 0
        dIni        := Date() - 30
        dFim        := Date()
        cCodiIni := Space(03)
        MaBox( 12, 10, 16, 74, "CURVA ABC POR GRUPO")
        SetCursor(1) ; DevPos( 13, 11 ) ; DevOut( "Grupo..........: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCodiIni, "cCodiIni", "9999", {|| GrupoErrado( @cCodiIni )},))
        SetCursor(1) ; DevPos( 14, 11 ) ; DevOut( "Data Inicial...: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dIni, "dIni", "##/##/##",,))
        SetCursor(1) ; DevPos( 15, 11 ) ; DevOut( "Data Final.....: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dFim, "dFim", "##/##/##",,))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        if LastKey() = 27
            ResTela( cScreen )
            Loop
        endif
        cString := "GRUPO: " + Grupo->CodGrupo + " - " + ltrim(rtrim(Grupo->DesGrupo))
        bBloco  := {|| Lista->CodGrupo = cCodiIni }
        Lista->(Order( 1 ))

    Case nChoice = 4
        AbcMaiorais()
        Loop
    end
    aGrade  := {}
    lFiltro := Conf("Pergunta: Selecionar registros zerados ou negativos ?")
    Entradas->(Order( 1 ))
    Saidas->(Order( 1 ))
    if Lista->( !DbSeek( cCodiIni ))
        ErrorBeep()
        Nada()
        Loop
    endif
    cTela1  := SaveScreen()
    Mensagem("Aguarde, Localizando Registros.", Cor())
    DbCreate( xAlias, aDbf )
    dbUseArea( .T.,, ( xAlias ), "xTemp", iif( .F. .OR. .T., ! .T., NIL ), .F. )
    ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( (xNtx ),, "xTemp->Codigo", {|| xTemp->Codigo}, )
    WHILE Lista->(Eval( bBloco )) .AND. Rep_Ok()
        nEstoAtual      := Lista->Quant
        cDescricao      := Lista->Descricao
        cTam              := Lista->Tam
        cOriginal      := Lista->N_Original
        cCodGrupo      := Lista->CodGrupo
        cCodsGrupo      := Lista->CodsGrupo
        cCodi           := Lista->Codi
        cCodigo          := Lista->Codigo
        nVarejo          := Lista->Varejo
        nPcusto          := Lista->Pcusto

        if !( lFiltro )
            if nEstoAtual <= 0
                Lista->(DbSkip(1))
                Loop
            endif
        endif

        if nChoice = 3 .OR. nChoice = 4
            nPos := Ascan( aGrade, cOriginal + cCodi )
            if nPos > 0
                Lista->(DbSkip(1))
                Loop
            endif
            nRecno := Lista->(Recno())
            nSoma  := SomaGrade( cCodiIni )
            Lista->(Order( 9 ))
            Lista->(DbGoTo( nRecno ))
            if nSoma > nMin
                Aadd( aGrade, cOriginal + cCodi )
                Lista->(DbSkip(1))
                Loop
            endif
        endif

        if Saidas->(DbSeek( cCodigo ))
            Mensagem("Aguarde, Somando Saidas.", Cor())
            While Saidas->Codigo = cCodigo
                if nChoice = 4 .AND. Saidas->Codi <> cCodi
                    Saidas->(DbSkip(1))
                    Loop
                endif
                nSaida  := Saidas->Saida
                dData   := Saidas->Data
                cPrazo  := ""
                if xTemp->(!DbSeek( cCodigo ))
                    xTemp->(DbAppend())
                    xTemp->Codigo        := cCodigo
                    xTemp->CodGrupo    := cCodGrupo
                    xTemp->CodsGrupo    := cCodsGrupo
                    xTemp->Descricao    := cDescricao
                    xTemp->Quant        := nEstoAtual
                    xTemp->N_Original := cOriginal
                    xTemp->Tam            := cTam
                    xTemp->Varejo        := nVarejo
                    xTemp->Pcusto        := nPcusto
                endif
                if dData >= dIni .AND. dData <= dFim
                    xTemp->Saida += nSaida
                    xTemp->Data  := dData
                elseif dData < dIni
                    xTemp->SaiAnt += nSaida
                    xTemp->Data   := dData
                elseif dData > dFim
                    xTemp->SaiPos += nSaida
                    xTemp->Data   := dData
                endif
                Saidas->(DbSkip(1))
            EndDo
        endif
        Lista->(DbSkip(1))
    Enddo
    xTemp->(DbGoTop())
    if xTemp->(Eof())
        xTemp->(DbCloseArea())
        Ferase( xAlias )
        Ferase( xNtx )
        Loop
    endif
    WHILE .T.
        oMenu:Limpa()
        M_Title("ESCOLHA ORDEM DO RELATORIO")
        nOrdem := FazMenu( 05, 10, aOrdem, Cor())
        Do Case
        Case nOrdem = 0
            xTemp->(DbCloseArea())
            Ferase( xAlias )
            Ferase( xNtx )
            Exit
        Case nOrdem = 1
            Mensagem("Aguarde: Ordenando Registros.", Cor())
            ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Codigo", {|| xTemp->Codigo}, )

        Case nOrdem = 2
            Mensagem("Aguarde: Ordenando Registros.", Cor())
            ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Descricao", {|| xTemp->Descricao}, )

        Case nOrdem = 3
            Mensagem("Aguarde: Ordenando Registros.", Cor())
            ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->N_Original", {|| xTemp->N_Original}, )

        Case nOrdem = 4
            Mensagem("Aguarde: Ordenando Registros.", Cor())
            ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->CodGrupo + xTemp->N_Original", {|| xTemp->CodGrupo + xTemp->N_Original}, )

        Case nOrdem = 5
            Mensagem("Aguarde: Ordenando Registros.", Cor())
            ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Descricao + xTemp->Tam", {|| xTemp->Descricao + xTemp->Tam}, )

        Case nOrdem = 6
            Mensagem("Aguarde: Ordenando Registros.", Cor())
            ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->CodGrupo + xTemp->N_Original", {|| xTemp->CodGrupo + xTemp->N_Original}, )

        Case nOrdem = 7
            Mensagem("Aguarde: Ordenando Registros.", Cor())
            ordCondSet(,,,,,, RecNo(),,,,,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Saida", {|| xTemp->Saida}, )

        Case nOrdem = 8
            Mensagem("Aguarde: Ordenando Registros.", Cor())
            ordCondSet(,,,,,, RecNo(),,,, .T.,,,,,,,,, ) ; ordCreate( ( xNtx ),, "xTemp->Saida", {|| xTemp->Saida}, )

        end
        nSaidas          := 0
        nEntrada       := 0
        nSaldo          := 0
        nTam              := 132
        Col              := 58
        Pagina          := 0
        nContador      := 0
        lSair           := .F.

        if !Instru80()
            Loop
        endif

        ResTela( cTela1 )
        Mensagem("Aguarde, Imprimindo. ", Cor())
        PrintOn()
        FPrint( PQ )
        SetPrc( 0, 0 )
        dbSelectArea( "xTemp" )
        xTemp->(DbGoTop())
        cRefAnt      := xTemp->N_Original
        cGrupoAnt  := xTemp->CodGrupo
        nParcAnt   := 0
        nParcEnt   := 0
        nParcSai   := 0
        nParcSaldo := 0
        nParcAtual := 0
        nTotAnt      := 0
        nTotEnt      := 0
        nTotSai      := 0
        WHILE xTemp->( !Eof()) .AND. Rel_Ok()
            if Col >= 58
                Write( 00, 00, Linha1( nTam, @Pagina))
                Write( 01, 00, Linha2())
                Write( 02, 00, Linha3(nTam))
                Write( 03, 00, Linha4(nTam, SISTEM_NA2 ))
                Write( 04, 00, Padc( "ROL DE ENTRADA/SAIDA E POSICAO ATUAL NO PERIODO DE " + DToc( dIni ) + " A " + DToc( dFim ), nTam ))
                Write( 05, 00, Padc( cString, nTam ))
                Write( 06, 00, Linha5(nTam))
                Write( 07, 00,"CODIGO REFERENCIA TAM  DESCRICAO                                      CUSTO      VAREJO   (+)ANT   (+)ENT DATA ENT   (-)SAI   (=)SAL")
                Write( 08, 00, Linha5(nTam))
                Col := 9
            endif
            nAtual          := xTemp->Quant
            nSaidas          := xTemp->Saida
            nEntradas      := xTemp->Entrada
            nSaiAnt          := xTemp->SaiAnt
            nSaiDep          := xTemp->SaiPos
            nEntAnt          := xTemp->EntAnt
            nEntDep          := xtemp->EntPos
            nTotEnt          += xTemp->Entrada
            nTotAnt          += xTemp->EntAnt
            nTotSai          += xTemp->Saida
            nEstoAnterior := ( nAtual + nSaidas ) - nEntradas
            nEstoAnterior := ( nEstoAnterior + nSaiDep ) - nEntDep
            nSaldo          := ( nEstoAnterior + nEntradas ) - nSaidas
            cCodigo          := xTemp->Codigo
            cDescricao      := xTemp->Descricao
            nAtual          := xTemp->Quant
            cOriginal      := Left( xTemp->N_Original, 11 )
            cTam              := Left( xTemp->Tam, 3 )
            nVarejo          := xTemp->Varejo
            nPcusto          := xTemp->Pcusto
            dData           := xTemp->Data
            nDif              := nSaldo - ( nAtual - nEstoAnterior )








            Qout( cCodigo, cOriginal, cTam, cDescricao,     Tran( nPcusto,       "@E 9999,999.99"),    Tran( nVarejo,       "@E 9999,999.99"),    Tran( nEstoAnterior,"99999.99"),    Tran( nEntradas,      "99999.99"),    dData,    Tran( nSaidas,       "99999.99"),    Tran( nSaldo,          "99999.99"))
            Col++
            nContador++
            nParcAnt   += nEstoAnterior
            nParcEnt   += nEntradas
            nParcSai   += nSaidas
            nParcSaldo += nSaldo
            nParcAtual += nAtual
            cRefAnt      := xTemp->N_Original
            cGrupoAnt  := xTemp->CodGrupo
            cPorc       := Tran(((nVarejo / nPcusto ) * 100 ) - 100, "9999.99%")
            nLen          := Len( cPorc + cPrazo )
            xTemp->(DbSkip(1))
            if nOrdem = 4
                if cRefAnt <> xTemp->N_Original
                    Qout()







                    Qout( Repl("-", 85-nLen ),    cPorc,    cPrazo,    Tran( nParcAnt,  "99999.99"),    Tran( nParcEnt,  "99999.99"),    Space(08),    Tran( nParcSai,  "99999.99"),    Tran( nParcSaldo,"99999.99"))
                    Qout()
                    Col++
                    Col++
                    Col++
                    nParcAnt   := 0
                    nParcEnt   := 0
                    nParcSai   := 0
                    nParcSaldo := 0
                    nParcAtual := 0
                endif
            endif
            if nOrdem = 6
                if cGrupoAnt <> xTemp->CodGrupo
                    Qout()







                    Qout( Repl("-", 85-nLen ),    cPorc,    cPrazo,    Tran( nParcAnt,  "99999.99"),    Tran( nParcEnt,  "99999.99"),    Space(08),    Tran( nParcSai,  "99999.99"),    Tran( nParcSaldo,"99999.99"))
                    Qout()
                    Col++
                    Col++
                    Col++
                    nParcAnt   := 0
                    nParcEnt   := 0
                    nParcSai   := 0
                    nParcSaldo := 0
                    nParcAtual := 0
                endif
            endif
            if Col >= 56 .OR. xTemp->(Eof())
                Qout( Repl("=", 87), Tran( nTotAnt,"99999.99"), Tran( nTotEnt,"99999.99"), Space(8), Tran( nTotSai, "99999.99"), Tran( nTotEnt-nTotSai, "99999.99"))
                Col := 58
                __Eject()
            endif
        EndDo
        xTemp->(DbClearIndex())
        PrintOff()
        ResTela( cTela1 )
    EndDo
EndDo

Proc AbcMaiorais()

LOCAL GetList    := {}
LOCAL cScreen    := SaveScreen()
LOCAL nQuant    := 1
LOCAL dIni        := Date()-30
LOCAL dFim        := Date()
LOCAL m            := {}
LOCAL oBloco
LOCAL oRelato
LOCAL cCodi
LOCAL nTotal

MaBox( 12, 10, 16, 74, "CURVA ABC POR CLIENTE")
SetCursor(1) ; DevPos( 13, 11 ) ; DevOut( "Imprimir ate Posicao (max 4096).: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nQuant, "nQuant", "99999", {|| nQuant >= 1 .AND. nQuant <= 4096},))
SetCursor(1) ; DevPos( 14, 11 ) ; DevOut( "Data Venda Inicial..............: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dIni, "dIni", "##/##/##",,))
SetCursor(1) ; DevPos( 15, 11 ) ; DevOut( "Data Venda Final................: " ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dFim, "dFim", "##/##/##",,))
ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
IF LastKey() = 27
    ResTela( cScreen )
    Return
EndIF
ErrorBeep()
IF !Conf("Pergunta: Podera ser extremamente demorado. Continuar ?")
    ResTela( cScreen )
    Return
EndIF
Receber->(Order( 2 ))
Receber->(DbGoTop())
Saidas->(Order( 5 ))
Mensagem("Aguarde, processando valores.")
oBloco := {|| Saidas->Data >= dIni .AND. Saidas->Data <= dFim }
m := Array( nQuant, 3 )
For nX := 1 To nQuant
    m[nX,1] := 0
   m[nX,3] := 0
Next
While Receber->(!Eof())
    cCodi  := Receber->Codi
    nTotal := 0
   nCmv   := 0
   nCusto := 0
    IF Saidas->(DbSeek( cCodi ))
        While Saidas->Codi = cCodi
            IF Saidas->( Eval( oBloco ))
                nTotal += Saidas->Saida * Saidas->Pvendido
            nCusto += Saidas->Saida * Saidas->Pcusto
            EndIF
            Saidas->(DbSkip(1))
        EndDo
        IF nTotal <> 0
            Asort( m,,, {| x, y | y[ 1 ] > x[ 1 ] } )
            For nX := 1 To nQuant
                IF m[nX,1] < nTotal
                    m[nX,1] := nTotal
                    m[nX,2] := cCodi
               m[nX,3] := ( nCusto / nTotal ) * 100
                    Exit
                EndIF
          Next
        EndIF
    EndIF
    Receber->(DbSkip(1))
EndDo
IF !InsTru80()
   ResTela( cScreen )
   Return
EndIF
Mensagem("Aguarde... Ordenando Registros.")
Asort( m,,, {| x, y | y[ 1 ] > x[ 1 ] } )
PrintOn()
SetPrc( 0,0 )
oRelato           := TRelatoNew()
oRelato:Sistema   := SISTEM_NA2
oRelato:Titulo    := "RANKING DOS MAIORES CLIENTES NO PERIODO DE " + Dtoc( dIni ) + " A " + Dtoc( dFim )
oRelato:Cabecalho := "CODI  NOME DO CLIENTE                                   VALOR RANKING CMV"
oRelato:Inicio()
nConta :=  0
For nX := nQuant To 1 Step -1
   IF m[nX,1] <= 0
      Loop
   EndIF
   nConta++
   cCodi  := m[nX,2]
   nTotal := m[nX,1]
   nCmv   := m[nX,3]
   Receber->(DbSeek( cCodi ))
   Qout( cCodi, Receber->Nome, Tran( nTotal, "@E 999,999,999.99"), Tran( nConta, "9999§" ),"", Tran( nCmv, "@E 999.99%"))
   oRelato:RowPrn ++
Next
__Eject()
PrintOff()
ResTela( cScreen )
Return

Proc BuscaFatura( aFatuTemp, aFatura, aRegis, aRegiTemp, cTitulo )

LOCAL GetList         := {}
LOCAL cScreen         := SaveScreen()
LOCAL aMenuArray     := { "Por Periodo", "Por Regiao", "Selecionar"}
LOCAL dIni             := Date()-30
LOCAL dFim             := Date()
LOCAL nRecno         := 0
LOCAL nItens         := 0
LOCAL nConta         := 0
LOCAL nContaFatura := 0
LOCAL nTamanho      := 0
LOCAL cRegiao         := Space(02)
LOCAL cFatura         := Space(07)
LOCAL nChoice         := 1
LOCAL Col             := 0
LOCAL nQuant
LOCAL cSigla
LOCAL cDescricao
LOCAL cCodi
LOCAL cNome
LOCAL bBloco
LOCAL cTela
LOCAL cRelato
LOCAL nTam
LOCAL Pos1
LOCAL Line
LOCAL nPagina
LOCAL Ok
LOCAL Tot_Reg
LOCAL nReg
LOCAL nSobra
LOCAL Escolha
LOCAL aCodigo
LOCAL cCodigo
LOCAL cDesc
LOCAL nSaida
LOCAL cCabecalho
LOCAL PosCur
LOCAL nX
LOCAL nPos

FIELD Codigo
Field Saida

M_Title( cTitulo )
nChoice := FazMenu( 11, 44, aMenuArray, Cor())
Do Case
Case nChoice = 0
    ResTela( cScreen )
    return

Case nChoice = 1
    dIni     := Date() - 30
    dFim     := Date()
    nRecno := 0
    MaBox( 18, 20, 21, 56 )
    SetCursor(1) ; DevPos( 19, 21 ) ; DevOut( "Digite Emissao Inicial.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dIni, "dIni", "@K##/##/##", {|| AchaDataIni( dIni, @nRecno )},))
    SetCursor(1) ; DevPos( 20, 21 ) ; DevOut( "Digite Emissao Final...:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dFim, "dFim", "@K##/##/##",,))
    ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
    if LastKey() = 27
        ResTela( cScreen )
        return
    endif
    Saidas->(Order( 4 ))
    oMenu:Limpa()
    Mensagem("Aguarde, Incluindo.", 47 )
    aFatuTemp     := {}
    aRegiTemp     := {}
    bBloco         := {|| Saidas->Emis >= dIni .AND. Saidas->Emis <= dFim }
    cFatura         := Space(07)
    nContaFatura := 0
    Saidas->(DbGoTo( nRecno ))
    While Saidas->(Eval( bBloco ))
        cFatura := Saidas->Fatura
        nRecno  := Saidas->(Recno())
        if nContaFatura >= 4096
            ErrorBeep()
            Alerta("Erro: Maximo de 4096 Faturas.")
            Exit
        endif
        if Ascan( aFatuTemp, cFatura ) = 0
            nContaFatura++
            Aadd( aFatuTemp, cFatura  )
            Aadd( aRegiTemp, nRecno )
        endif
        Saidas->(DbSkip(1))
    EndDo

Case nChoice = 2
    aFatuTemp     := {}
    aRegiTemp     := {}
    nContaFatura := 0
    WHILE .T.
        oMenu:Limpa()
        nRecno         := 0
        cRegiao         := Space(2)
        dIni             := Date()-30
        dFim             := Date()
        MaBox( 18, 20, 22, 56 )
        SetCursor(1) ; DevPos( 19, 21 ) ; DevOut( "Digite a Regiao........:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cRegiao, "cRegiao", "99", {|| RegiaoErrada( @cRegiao )},))
        SetCursor(1) ; DevPos( 20, 21 ) ; DevOut( "Digite Emissao Inicial.:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dIni, "dIni", "##/##/##",,))
        SetCursor(1) ; DevPos( 21, 21 ) ; DevOut( "Digite Emissao Final...:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dFim, "dFim", "##/##/##",,))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        if LastKey() = 27
            ResTela( cScreen )
            Exit
        endif
        oMenu:Limpa()
        Saidas->( Order( 2 ))
        bBloco  := {|| Saidas->Emis >= dIni .AND. Saidas->Emis <= dFim }
        cFatura := Space(07)
        if Saidas->(DbSeek( cRegiao ))
            Mensagem("Aguarde, Incluindo.", 47 )
            While Saidas->Regiao = cRegiao
                if Eval( bBloco )
                    cFatura := Saidas->Fatura
                    nRecno  := Saidas->(Recno())
                    if nContaFatura >= 4096
                        ErrorBeep()
                        Alerta("Erro: Maximo de 4096 Faturas.")
                        Exit
                    endif
                    if Ascan( aFatuTemp, cFatura ) = 0
                        nContaFatura++
                        Aadd( aFatuTemp, cFatura  )
                        Aadd( aRegiTemp, nRecno )
                    endif
                endif
                Saidas->(DbSkip(1))
            EndDO
        else
            ErrorBeep()
            Alerta("Informa: Nenhum produto vendido nessa regiao.")
        endif
    EndDo

Case nChoice = 3
    oMenu:Limpa()
    nConta := 0
    nItens := Nota->(Lastrec())
    MaBox( 00, 00, 02, 79 )
    Write( 01, 01, "Total de Faturas.: " + StrZero( nItens, 4 ))
    Write( 01, 26, "Selecionadas.....: " + StrZero( nConta, 4 ))
    Write( 01, 51, "Disponiveis......: " + StrZero( nItens - nConta, 4 ))
    aRegis         := {}
    aFatura         := {}
    Col             := 4
    nContaFatura := 0
    MaBox( 03, 26, 22, 79 , "FATURA   CODI NOME CLIENTE                      " )
    WHILE .T.
        cFatura := Space( 07 )
        MaBox( 20, 01, 22, 25 )
        SetCursor(1) ; DevPos( 21, 02 ) ; DevOut( "Fatura N?..:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cFatura, "cFatura", "@!", {|| VisualAchaFatura( @cFatura )},))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        if LastKey() = 27
            ResTela( cScreen )
            Exit
        endif
        Receber->(Order( 2 ))
        Lista->(Order( 2 ))
        Saidas->(Order( 3 ))
        if Saidas->( DbSeek( cFatura ))
            cCodi   := Saidas->Codi
            cFatura := Saidas->Fatura
            nRecno  := Saidas->(Recno())
            if Receber->(!DbSeek( cCodi ))
                cNome := "CLIENTE NAO LOCALIZADO"
            else
                cNome := Receber->Nome
            endif
            if nContaFatura >= 4096
                ErrorBeep()
                Alerta("Erro: Maximo de 4096 Faturas.")
                Exit
            endif
            nContaFatura++
            Aadd( aFatura,   cFatura )
            Aadd( aRegis,      nRecno )
            Write( 01,    45, StrZero( ++nConta,    4 ) ,"R/W")
            Write( 01,    70, StrZero( --nItens, 4 ) ,"R/W")
            Write( Col, 27, cFatura + " " + cCodi + " " + Left( cNome, 36 ) , "R/W")
            if Col = 21
                Scroll( 04, 27, 21, 78, 1 )
                Col := 21
            else
                Col++
            endif
        else
            ErrorBeep()
            Alerta("Erro: Favor reindexar.")
        endif
    Enddo
EndCase
if nContaFatura = 0
    ResTela( cScreen )
    return
endif
if nChoice <> 3
    oMenu:Limpa()
    nConta := 0
    nSobra := nContaFatura
    MaBox( 00, 00, 02, 79 )
    Write( 01, 01, "Total de Faturas.¯ " + StrZero( nContaFatura, 4 ))
    Write( 01, 26, "Selecionadas.....¯ " + StrZero( nConta,       4 ))
    Write( 01, 51, "Disponiveis......¯ " + StrZero( nSobra,       4 ))
    aRegis    := {}
    aFatura    := {}
    Col        := 4
    Receber->(Order( 2 ))
    Lista->(Order( 2 ))
    Saidas->(Order( 3 ))
    MaBox( 03, 26, 22, 79 , "FATURA   CODI NOME CLIENTE                      " )
    WHILE .T.
        MaBox( 03, 00, 22, 20 , "FATURAS")
        Escolha := Achoice( 04, 03, 21, 19, aFatuTemp )
        if Escolha = 0
            Exit
        endif
        Saidas->(DbGoTo( aRegiTemp[ Escolha ] ))
        Aadd( aFatura,   aFatuTemp[ Escolha ] )
        Aadd( aRegis,      aRegiTemp[ Escolha ] )
        Write( 01, 45, StrZero( ++nConta,  4 ) ,"R/W")
        Write( 01, 70, StrZero( --nSobra,  4 ) ,"R/W")
        cFatura := aFatuTemp[ Escolha ]
        nRecno  := aRegiTemp[ Escolha ]
        cNome   := "CLIENTE NAO LOCALIZADO"
        if Saidas->( DbSeek( cFatura ))
            cCodi   := Saidas->Codi
            cFatura := Saidas->Fatura
            nRecno  := Saidas->(Recno())
            if Receber->(DbSeek( cCodi ))
                cNome := Receber->Nome
            endif
        endif
        Write( Col, 27, cFatura + " " + cCodi + " " + Left( cNome, 36 ) , "R/W")
        Adel( aFatuTemp, Escolha )
        Adel( aRegiTemp, Escolha )
        if Col = 21
            Scroll( 04, 27, 21, 78, 1 )
            Col := 21
        else
            Col++
        endif
    Enddo
endif


   Proc NotaFiscal( cNoFatura )

    LOCAL Getlist      := {}
    LOCAL cScreen      := SaveScreen()
    LOCAL aMenuArray := { " Por Periodo ", " Selecionar " }
    LOCAL nChoice      := 0
    LOCAL lSair       := .F.
    LOCAL lInicio      := .T.
    LOCAL aFatuTemp  := {}
    LOCAL aFatura      := {}
    LOCAL aRegis      := {}
    LOCAL aRegiTemp  := {}
    LOCAL nX           := 0
    LOCAL nTotal      := 0
    LOCAL dEmissao   := Date()
    LOCAL dSaida      := Date()
    LOCAL nDesconto  := 0
    LOCAL nAliquota  := 0
    LOCAL nLine       := 0
    LOCAL nPvendido  := 0
    LOCAL nSoma       := 0
    LOCAL cNatu       := Space(20)
    LOCAL cCFop       := Space(05)
    LOCAL cCupom      := Space(06)
   LOCAL nTxIcms    := 0
   LOCAL nQtfaturas := 0
   LOCAL Arq_Ant
   LOCAL Ind_Ant
   LOCAL cFatura
   LOCAL aNatu
   LOCAL aCfop
   LOCAL aTxIcms
    LOCAL cCodigo
    LOCAL bBloco
    LOCAL dIni
    LOCAL dFim
    LOCAL nItens
    LOCAL cPedido
    LOCAL nRegis
    LOCAL cTela
    LOCAL aList
    LOCAL aRetorno

    if cNoFatura = NIL
        BuscaFatura( @aFatuTemp, @aFatura, @aRegis, @aRegiTemp, "NOTA FISCAL" )
    else
        Aadd( aFatura, cNofatura )
    endif
    Saidas->(Order( 3 ))
    Saidas->(DbGoTop())
   oMenu:Limpa()
   nQtFaturas := Len( aFatura )
   Alerta("Informa: " + StrZero( nQtFaturas, 5) + " a imprimir.")
   if nQtFaturas <> 0
      For nX := 1 To nQtFaturas
         cFatura := aFatura[nX]
         Saidas->(DbSeek( cFatura ))
         Receber->(DbSeek( Saidas->Codi ))
         nAliquota := Receber->Tx_Icms
         cCfop     := Receber->Cfop
         if nAliquota = 0 .OR. cCfop = "0.000" .OR. cCfop = " .   " .OR. cCfop = Space(05)
            oMenu:Limpa()
            ErrorBeep()
            Alerta("Erro: Cliente sem CFOP. Necessario ajustar.")
            Arq_Ant := Alias()
            Ind_Ant := IndexOrd()
            CliInclusao( .T. )
            AreaAnt( Arq_Ant, Ind_Ant )
            nAliquota := Receber->Tx_Icms
            cCfop     := Receber->Cfop
            if nAliquota = 0 .OR. cCfop = "0.000" .OR. cCfop = " .   " .OR. cCfop = Space(05)
               oMenu:Limpa()
               ErrorBeep()
               if Conf("Erro: Cliente ainda sem CFOP. Deseja Cancelar ?.")
                  ResTela( cScreen )
                  return
               endif
               nX--
               Loop
            endif
         endif
      Next
        oMenu:Limpa()
      aNatu     := LerNatu()
      aCFop     := LerCfop()
      aTxIcms   := LerIcms()
        dSaida     := Date()
        dEmissao  := Date()
        nDesconto := 0
        cNatu      := Space(20)
        cCFop      := Space(05)
        cCupom     := Space(06)
      MaBox( 10, 10, 15, 70, "INFORMACOES COMPLEMENTARES")
      SetCursor(1) ; DevPos( 11, 11 ) ; DevOut( "Desconto..........:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( nDesconto, "nDesconto", "99.99",,))
      SetCursor(1) ; DevPos( 12, 11 ) ; DevOut( "Emissao...........:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dEmissao, "dEmissao", "##/##/##",,))
      SetCursor(1) ; DevPos( 13, 11 ) ; DevOut( "Saida.............:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( dSaida, "dSaida", "##/##/##",,))
      SetCursor(1) ; DevPos( 14, 11 ) ; DevOut( "Cupom Fiscal n?..:" ) ; SetCursor(1) ; SetPos( Row(), Col()+1 ) ; AAdd( GetList, _GET_( cCupom, "cCupom", "@!",,))
        ReadModal( GetList, NIL,,,,, ) ; GetList := {} ; ( GetList )
        if LastKey() = 27
            ResTela( cScreen )
            return
        endif
        ErrorBeep()
        if Conf("Pergunta: Confirma Impressao da Nota Fiscal ?" )
            if !InsTru80()
                ResTela( cScreen )
                return
         endif
            Receber->(Order( 2 ))
            Lista->(Order( 2 ))
            Saidas->(Order( 3 ))
         cTela      := SaveScreen()
         nQtFaturas := Len( aFatura )
            Mensagem("Aguarde, Imprimindo.", Cor())
         FOR nX := 1 To nQtFaturas
                if nX > 1
                    PrintOff()
                    if !Conf("Esperando para imprimir proxima Nota. Imprimir ?")
                        lSair := .T.
                        Exit
                    endif
                endif
                cTela  := Mensagem("Aguarde, Imprimindo.", Cor())
                nTotal := 0
                bBloco := {|| Saidas->Fatura = aFatura[ nX ] }
                Saidas->(DbSeek( aFatura[ nX ]))
                Receber->(DbSeek( Saidas->Codi ))
            nAliquota := Receber->Tx_Icms
            cCfop     := Receber->Cfop
            if nAliquota = 0 .OR. cCfop = "0.000" .OR. cCfop = " .   "
               PickTam2( @aNatu, @aCfop, @aTxIcms, @cCfop, @cNatu, @nAliquota )
               if Receber->(TravaReg())
                  Receber->Tx_Icms := nAliquota
                  Receber->Cfop    := cCfop
                  Receber->(Libera())
               endif
            endif
            cNatu := AscancNatu( aCfop, cCfop, aNatu )
                PrintOn()
                SetPrc(0, 0)
                nLine   := 23
                nItens  := 0
                lSair   := .F.
                WHILE EVal( bBloco ) .AND. Rel_Ok()
                    if nItens = 0
                        if !lInicio
                            ResTela( cTela )
                            if !Conf("Confirma Impressao Restante Nota Fiscal ?")
                                lSair := .T.
                                Exit
                            endif
                            nLine := 23
                        endif
                        CabNota( dEmissao, dSaida, cCfop, cNatu )
                    endif
                    cCodigo     := Saidas->Codigo
                    nPvendido := Saidas->Pvendido
                    nPvendido -= ( nPvendido * nDesconto ) / 100
                    nSoma      := ( Saidas->Saida * nPvendido )
                    Lista->(DbSeek( cCodigo ))













                    Qout( Space(06),    Saidas->Codigo,    " ",    Lista->Descricao,    Space(24),    Lista->Situacao,    Space(04),    Lista->Un,    Saidas->Saida,    Tran( nPvendido, "@E 999,999,999.99"),    Space(1),    Tran( nSoma,  "@E 9,999,999,999.99"),    Space(1),    Tran( nAliquota,"99"))
                    nItens++
                    nLine++
                    nTotal += nSoma
                    if nItens = 19
                        nItens := 0
                        SubNota( nLine, nTotal, nAliquota, cCupom )
                        __Eject()
                        nLine   := 23
                        nTotal  := 0
                        lInicio := .F.
                    endif
                    Saidas->(DbSkip(1))
                EndDo
                if !lSair
                    SubNota( nLine, nTotal, nAliquota, cCupom )
                endif
                __Eject()
            Next
            PrintOff()
            ResTela( cTela )
        endif
    endif
    ResTela( cScreen )
    return

    Proc CabNota( dEmissao, dSaida, cCfop, cNatu )

    LOCAL nCol    := 03

    FPrint( PQ )
    Write( nCol+00, 82 , "XX")
    Write( nCol+08, 07 , cNatu )
    Write( nCol+08, 43 , cCfop )
    Write( nCol+11, 07 , Receber->Nome )
    if Empty( Receber->Cgc ) .OR. Receber->Cgc = "  .   .   /    -  "
        Write( nCol+11, 92, Receber->Cpf )
    else
        Write( nCol+11, 92, Receber->Cgc )
    endif
    Write( nCol+11, 127 , dEmissao )
    Write( nCol+13, 007 , Receber->Ende )
    Write( nCol+13, 072 , Receber->Bair )
    Write( nCol+13, 104 , Receber->Cep )
    Write( nCol+13, 127 , dSaida )
    Write( nCol+15, 007 , Receber->Cida )
    Write( nCol+15, 084 , Receber->Esta )
    if Empty( Receber->Cgc ) .OR. Receber->Cgc = "  .   .   /    -  "
        Write( nCol+15, 92, Receber->Rg )
    else
        Write( nCol+15, 92, Receber->Insc )
    endif
    Fprint( PQ )
    Qout("")
    Qout("")
    Qout("")
    Qout("")
    return

    Proc SubNota( nLine, nTotal, nAliquota, cCupom )

    LOCAL nIcms := ( nTotal * nAliquota / 100 )

    Write( 44, 003, Tran( nTotal, "@E 99,999,999,999.99"))
    Write( 44, 023, Tran( nIcms,    "@E 99,999,999,999.99"))
    Write( 44, 117, Tran( nTotal, "@E 99,999,999,999.99"))
    Write( 46, 117, Tran( nTotal, "@E 99,999,999,999.99"))
    if !Empty( cCupom )
        Write( 75, 13, "NOTAL FISCAL REF. AO CUPOM N? " + cCupom )
    endif
    return
